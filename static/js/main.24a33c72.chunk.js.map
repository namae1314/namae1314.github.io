{"version":3,"sources":["../../index.ts","../../../src/EthersLiquityConnection.ts","../../../src/Decimal.ts","../../../src/_utils.ts","../../../src/constants.ts","../../../../src/hooks/useLiquityStore.ts","../../../src/WebSocketAugmentedProvider.ts","../../../src/WebSocketProvider.ts","../../../src/contracts.ts","../../../src/ReadableEthersLiquity.ts","../../../src/BlockPolledLiquityStore.ts","../../../src/PopulatableEthersLiquity.ts","../../../src/SendableEthersLiquity.ts","../../../../src/components/LiquityStoreProvider.tsx","../../../../src/utils/equals.ts","../../../src/BatchedProvider.ts","../../../src/Trove.ts","../../../src/StabilityDeposit.ts","../../../src/LQTYStake.ts","../../../src/Fees.ts","../../../src/TransactableLiquity.ts","../../../src/SendableLiquity.ts","../../../src/LiquityStore.ts","../../../src/_CachedReadableLiquity.ts","../../../src/_Multicall.ts","../../../src/ObservableEthersLiquity.ts","../../../src/parseLogs.ts","../../../src/EthersLiquity.ts","../../../../src/hooks/useLiquityReducer.ts","../../../../src/hooks/useLiquitySelector.ts","config/index.ts","hooks/LiquityContext.tsx","connectors/injectedConnector.ts","components/Icon.tsx","components/Dialog.tsx","components/RetryDialog.tsx","components/WaitingDialog.tsx","components/ConnectionConfirmationDialog.tsx","components/MetaMaskIcon.tsx","components/Modal.tsx","components/WalletConnector.tsx","hooks/useAuthorizedConnection.ts","components/Tooltip.tsx","components/Transaction.tsx","theme.ts","testUtils/DisposableWalletProvider.ts","strings.ts","utils/shortenAddress.ts","components/UserAccount.tsx","components/InfoIcon.tsx","components/Statistic.tsx","components/SystemStats.tsx","components/SystemStatsPopup.tsx","components/LiquityLogo.tsx","components/Link.tsx","components/Nav.tsx","components/SideNav.tsx","components/Header.tsx","components/ActionDescription.tsx","components/Trove/Editor.tsx","components/LoadingOverlay.tsx","components/Trove/CollateralRatio.tsx","components/Trove/TroveEditor.tsx","components/Trove/TroveAction.tsx","components/Trove/context/TroveViewContext.tsx","components/ErrorDescription.tsx","components/Trove/validation/validateTroveChange.tsx","components/Trove/TroveManager.tsx","components/Trove/ReadOnlyTrove.tsx","components/InfoMessage.tsx","components/Trove/NoTrove.tsx","hooks/useStableTroveChange.ts","components/Warning.tsx","components/Trove/ExpensiveTroveChangeWarning.tsx","components/Trove/Opening.tsx","components/Trove/Adjusting.tsx","components/CollateralSurplusAction.tsx","components/Trove/RedeemedTrove.tsx","components/Trove/LiquidatedTrove.tsx","components/Trove/Trove.tsx","components/Stability/StabilityDepositEditor.tsx","components/Stability/StabilityDepositAction.tsx","components/Stability/context/StabilityViewContext.tsx","components/Stability/StabilityActionDescription.tsx","components/Stability/validation/validateStabilityDepositChange.tsx","components/Stability/StabilityDepositManager.tsx","components/Stability/actions/ClaimAndMove.tsx","components/Stability/actions/ClaimRewards.tsx","components/Stability/RemainingLQTY.tsx","components/Badge.tsx","components/Stability/context/fetchLqtyPrice.ts","components/Stability/Yield.tsx","components/Stability/ActiveDeposit.tsx","components/Stability/NoDeposit.tsx","components/Stability/Stability.tsx","components/PriceManager.tsx","components/Staking/context/StakingViewContext.tsx","components/Staking/StakingGainsAction.tsx","components/Staking/ReadOnlyStake.tsx","components/Staking/StakingEditor.tsx","components/Staking/StakingManagerAction.tsx","components/Staking/StakingManager.tsx","components/Staking/NoStake.tsx","components/Staking/Staking.tsx","pages/Dashboard.tsx","pages/UnregisteredFrontend.tsx","pages/FrontendRegistration.tsx","pages/FrontendRegistrationSuccess.tsx","pages/PageSwitcher.tsx","components/Farm/context/FarmViewContext.tsx","components/Farm/views/RemainingLQTY.tsx","components/Farm/context/fetchPrices.ts","components/Farm/views/Yield.tsx","components/Farm/views/Inactive/Inactive.tsx","components/Farm/context/useValidationState.ts","components/Farm/views/Confirm.tsx","components/Farm/views/Description.tsx","components/Farm/views/Approve.tsx","components/Farm/views/Validation.tsx","components/Farm/views/Staking/Staking.tsx","components/Farm/views/Adjusting/Adjusting.tsx","components/Farm/views/Active/ClaimReward.tsx","components/Farm/views/UnstakeAndClaim.tsx","components/Farm/views/Active/Active.tsx","components/Farm/views/Disabled/Disabled.tsx","components/Farm/Farm.tsx","pages/Farm.tsx","components/LiquidationManager.tsx","components/Abbreviation.tsx","components/RiskyTroves.tsx","pages/RiskyTrovesPage.tsx","components/Redemption/DisabledRedemption.tsx","components/Redemption/RedemptionAction.tsx","components/Redemption/RedemptionManager.tsx","components/Redemption/Redemption.tsx","pages/RedemptionPage.tsx","components/Trove/context/TroveViewProvider.tsx","components/Stability/context/StabilityViewProvider.tsx","components/Staking/context/StakingViewProvider.tsx","components/Farm/context/transitions.ts","components/Farm/context/FarmViewProvider.tsx","LiquityFrontend.tsx","App.tsx","index.tsx"],"names":["exports","WebSocketProvider","address","overrides","a","readable","defaultConfig","frontendTag","AddressZero","hasKey","o","k","parseConfig","json","config","isAddress","getAddress","console","error","log","infuraApiKey","testnetOnly","configPromise","undefined","fetchConfig","fetch","response","ok","Error","status","getConfig","LiquityContext","createContext","webSocketSupportedNetworks","LiquityProvider","children","loader","unsupportedNetworkFallback","unsupportedMainnetFallback","useWeb3React","provider","library","account","chainId","useState","setConfig","connection","useMemo","_connectByChainId","getSigner","userAddress","useStore","useEffect","then","isBatchedProvider","isWebSocketAugmentedProvider","network","getNetwork","name","includes","openWebSocket","wsParams","_isDev","window","location","hostname","closeWebSocket","liquity","EthersLiquity","_from","store","logging","Provider","value","useLiquity","liquityContext","useContext","injectedConnector","InjectedConnector","add","faCircleNotch","faCheck","faCheckCircle","faExclamationTriangle","faInfoCircle","faTimes","faTrash","faChartLine","faRedo","faHistory","faChevronLeft","faChevronRight","faClipboard","faClipboardCheck","faUserCircle","faWallet","faExternalLinkAlt","faCog","faPlug","faExclamationCircle","faAngleUp","faAngleDoubleUp","faAngleDown","faAngleDoubleDown","faPen","faHandPaper","faHeartbeat","faBars","faQuestionCircle","getIcon","Icon","style","rest","icon","iconFromIntent","intent","color","aria-label","Dialog","title","cancelLabel","onCancel","sx","p","borderRadius","height","bg","justifyContent","alignItems","borderBottom","borderColor","pb","as","textAlign","fontSize","px","variant","onClick","size","RetryDialog","retryLabel","onRetry","borderTop","flexDirection","mr","mb","width","WaitingDialog","waitReason","ConnectionConfirmationDialog","fontWeight","MetaMaskIcon","viewBox","fill","xmlns","d","x","y","Modal","connectionReducer","state","action","type","connector","message","match","warn","WalletConnector","activate","deactivate","active","triedAuthorizedConnection","tried","setTried","isAuthorized","tryToActivateIfAuthorized","useAuthorizedConnection","useReducer","connectionState","dispatch","isMetaMask","ethereum","detectMetaMask","ml","lineHeight","href","target","Tooltip","placement","event","useRef","show","setShow","referenceElement","setReferenceElement","popperElement","setPopperElement","usePopper","styles","attributes","React","cloneElement","Children","only","onMouseOver","current","onMouseOut","setTimeout","ref","popper","circularProgressbarStyle","strokeLinecap","pathColor","trailColor","slowProgress","strokeWidth","buildStyles","pathTransitionDuration","fastProgress","TransactionContext","TransactionProvider","transactionState","useTransactionState","useMyTransactionState","myId","id","useTransactionFunction","send","setTransactionState","useCallback","tx","Transaction","tooltip","tooltipPlacement","showFailure","requires","sendTransaction","trigger","failureReasons","filter","map","push","clonedTrigger","length","disabled","tryToGetRevertReason","call","blockNumber","result","hexDataLength","hexDataSlice","defaultAbiCoder","decode","Donut","memo","CircularProgressbarWithChildren","TransactionProgressDonut","setValue","maxValue","spin","TransactionMonitor","cancelled","finished","txHash","rawSentTransaction","hash","waitForConfirmation","waitForReceipt","receipt","confirmations","rawReceipt","reason","EthersTransactionCancelledError","pl","position","bottom","overflow","baseColors","colors","primary","secondary","accent","success","warning","danger","dangerHover","info","invalid","text","background","muted","buttonBase","display","cursor","button","py","border","opacity","buttonOutline","hoverColor","iconButton","padding","cardHeadingFontSize","cardGapX","cardGapY","card","mt","boxShadow","infoCard","h2","formBase","flexShrink","formCell","modalOverlay","left","top","headerGradient","theme","breakpoints","space","fonts","body","join","heading","monospace","fontSizes","fontWeights","light","medium","bold","lineHeights","borders","shadows","fontFamily","buttons","outline","cancel","dangerIcon","titleIcon","cards","pr","infoPopup","right","overflowY","zIndex","forms","label","unit","input","flex","editor","layout","header","footer","minHeight","main","maxWidth","mx","columns","flexWrap","justifyItems","actions","disabledOverlay","modal","infoOverlay","infoMessage","m","minWidth","sidenav","badge","backgroundColor","root","textDecoration","links","nav","textTransform","letterSpacing","DisposableWalletProvider","url","funderPrivateKey","ethAmount","wallet","funderWallet","haveFunded","this","Wallet","createRandom","Decimal","from","find","toLowerCase","to","hex","gas","hexlify","method","params","fund","Promise","all","nonce","findWallet","signTransaction","gasLimit","headers","JSON","stringify","jsonrpc","Object","assign","COIN","GT","LP","shortenAddress","substr","select","accountBalance","lusdBalance","lqtyBalance","UserAccount","useLiquitySelector","i","currency","balance","prettify","InfoIcon","interactive","content","Statistic","selectBalances","Balances","GitHubCommit","numberOfTroves","price","total","lusdInStabilityPool","borrowingRate","redemptionRate","totalStakedLQTY","frontend","kickbackRate","SystemStats","showBalances","contractsVersion","version","deploymentDate","lusdInStabilityPoolPct","debt","nonZero","Percent","div","totalCollateralRatioPct","collateralRatio","borrowingFeePct","kickbackRatePct","mul","toString","collateral","shorten","collateralRatioIsBelowCritical","toLocaleString","process","SystemStatsPopup","systemStatsOpen","setSystemStatsOpen","systemStatsOverlayRef","pt","e","LiquityLogo","boxProps","src","ExactLink","props","exact","Link","Nav","SideNav","isVisible","setIsVisible","overlay","Header","isFrontendRegistered","borderLeft","ActionDescription","Amount","whiteSpace","Row","labelId","labelFor","infoIcon","htmlFor","PendingAmount","startsWith","StaticAmounts","inputId","labelledBy","amount","pendingAmount","pendingColor","aria-labelledby","staticStyle","flexGrow","editableStyle","StaticRow","DisabledEditableRow","EditableRow","editingState","editedAmount","setEditedAmount","maxAmount","maxedOut","editing","setEditing","setInvalid","autoFocus","step","defaultValue","onChange","onBlur","stopPropagation","LoadingOverlay","CollateralRatio","change","collateralRatioPct","changePct","gt","CRITICAL_COLLATERAL_RATIO","lte","positive","absoluteValue","negative","nonZeroish","lt","TroveEditor","original","edited","fee","changePending","feePct","originalCollateralRatio","isEmpty","collateralRatioChange","Difference","between","LUSD_LIQUIDATION_RESERVE","TroveAction","transactionId","maxBorrowingRate","borrowingFeeDecayToleranceMinutes","openTrove","bind","closeTrove","adjustTrove","TroveViewContext","useTroveView","context","ErrorDescription","mcrPercent","MINIMUM_COLLATERAL_RATIO","ccrPercent","TroveChangeDescription","depositCollateral","borrowLUSD","repayLUSD","withdrawCollateral","selectForTroveChangeValidation","validateTroveChange","originalTrove","adjustedTrove","selectedState","whatChanged","resultingTrove","apply","recoveryMode","wouldTriggerRecoveryMode","subtract","LUSD_MINIMUM_DEBT","errorDescription","validateTroveCreation","validateTroveClosure","validateTroveAdjustment","LUSD_MINIMUM_NET_DEBT","isOpenableInRecoveryMode","collateralRatioIsBelowMinimum","sub","init","trove","Trove","debtDirty","addedMinimumDebt","reduceWith","reduce","addMinimumDebt","removeMinimumDebt","finishChange","revert","newCollateral","newValue","newState","setCollateral","isZero","setDebt","changeCommitted","stateChange","troveBeforeRedistribution","feeFrom","ZERO","fees","validationContext","transactionIdPrefix","transactionIdMatcher","RegExp","TroveManager","useLiquityReducer","validChange","description","dispatchEvent","handleCancel","openingNewTrove","myTransactionState","ReadOnlyTrove","handleAdjustTrove","handleCloseTrove","InfoMessage","NoTrove","handleOpenTrove","paramsEq","b","eq","useStableTroveChange","troveChange","stableTroveChange","setStableTroveChange","Warning","ExpensiveTroveChangeWarning","gasEstimationState","setGasEstimationState","timeoutId","populate","populatedTx","rawPopulatedTransaction","clearTimeout","gasHeadroom","selector","EMPTY_TROVE","TRANSACTION_ID","GAS_ROOM_ETH","Opening","borrowAmount","setBorrowAmount","totalDebt","isDirty","maxCollateral","collateralMaxedOut","isTransactionPending","handleCancelPressed","reset","Adjusting","previousTrove","netDebt","setNetDebt","nextCollateral","unsavedChanges","applyUnsavedCollateralChanges","nextNetDebt","applyUnsavedNetDebtChanges","isDebtIncrease","debtIncreaseAmount","updatedTrove","availableEth","collateralSurplusBalance","CollateralSurplusAction","myTransactionId","claimCollateralSurplus","hasSurplusCollateral","RedeemedTrove","LiquidatedTrove","view","StabilityDepositEditor","originalDeposit","editedLUSD","currentLUSD","lusdInStabilityPoolAfterChange","originalPoolShare","mulDiv","newPoolShare","poolShareChange","infinite","concat","collateralGain","lqtyReward","selectFrontendRegistered","StabilityDepositAction","depositLUSD","depositLUSDInStabilityPool","withdrawLUSDFromStabilityPool","withdrawLUSD","StabilityViewContext","useStabilityView","StabilityActionDescription","selectForStabilityDepositChangeValidation","ownFrontend","haveUndercollateralizedTroves","haveOwnFrontend","stabilityDeposit","updatedDeposit","initialLUSD","StabilityDepositManager","validateStabilityDepositChange","makingNewDeposit","ClaimAndMove","transferCollateralGainToTrove","ClaimRewards","withdrawGainsFromStabilityPool","remainingStabilityPoolLQTYReward","RemainingLQTY","Badge","hasProp","validateCoinGeckoSimplePriceResponse","expectedCoinIds","expectedCurrencies","coinId","coinPrices","fetchCoinGeckoSimplePrice","coinIds","vsCurrencies","simplePriceUrl","URLSearchParams","ids","vs_currencies","accept","fetchLqtyPrice","lqtyPriceUSD","usd","dailyIssuanceFraction","dailyIssuancePercentage","Yield","lqtyPrice","setLqtyPrice","hasZeroValue","aprPercentage","remainingLqtyInUSD","ActiveDeposit","poolShare","handleAdjustDeposit","hasReward","hasGain","hasTrove","isWaitingForTransaction","NoDeposit","Stability","selectPrice","PriceManager","canSetPrice","_priceFeedIsTestnet","editedPrice","setEditedPrice","setPrice","StakingViewContext","useStakingView","selectLQTYStake","lqtyStake","StakingGainsAction","lusdGain","withdrawGainsFromStaking","ReadOnlyStake","stakedLQTY","StakingEditor","originalStake","editedLQTY","totalStakedLQTYAfterChange","StakingManagerAction","stakeLQTY","unstakeLQTY","updatedStake","selectLQTYBalance","StakingManagerActionDescription","StakingManager","dispatchStakingViewAction","makingNewStake","NoStake","Staking","Dashboard","UnregisteredFrontend","FrontendRegistrationAction","registerFrontend","FrontendRegistration","setKickbackRate","cut","setCut","kickbackRateString","setKickbackRateString","newKickbackRate","newCut","ONE","FrontendRegistrationSuccess","onDismiss","selectFrontend","PageSwitcher","unregistered","registering","setRegistering","FarmViewContext","useFarmView","remainingLiquidityMiningLQTYReward","uniswapQuery","lqtyTokenAddress","uniTokenAddress","fetchPrices","query","variables","reject","data","errors","token","derivedETH","pair","reserveUSD","totalSupply","bundle","ethPrice","ethPriceUSD","uniLpPriceUSD","totalStakedUniTokens","addresses","liquidityMiningLQTYRewardRate","uniLpPrice","setUniLpPrice","daysRemaining","totalStakedUniLpInUSD","yieldPercentage","Inactive","lusdAddress","handleStakePressed","uniTokenBalance","uniTokenAllowance","liquidityMiningStake","useValidationState","isWithdrawing","amountChanged","maximumStake","hasSetMaximumStake","isValid","hasApproved","hasEnoughUniToken","gte","Confirm","transactionAction","unstakeUniTokens","stakeUniTokens","shouldDisable","Description","Approve","approveUniTokens","Validation","setAmount","nextTotalStakedUniTokens","liquidityMiningLQTYReward","maximumAmount","hasSetMaximumAmount","ClaimReward","withdrawLQTYRewardFromLiquidityMining","UnstakeAndClaim","exitLiquidityMining","Active","handleAdjustPressed","hasStakeAndRewards","Disabled","hasStake","Farm","LiquidationManager","numberOfTrovesToLiquidate","setNumberOfTrovesToLiquidate","min","liquidateUpTo","parseInt","Abbreviation","short","rowHeight","liquidatableInNormalMode","liquidatableInRecoveryMode","totalCollateralRatio","blockTag","RiskyTroves","pageSize","loading","setLoading","troves","setTroves","reload","setReload","forceReload","page","setPage","numberOfPages","Math","ceil","clampedPage","mounted","getTroves","first","sortedBy","startingAt","copied","setCopied","ownerAddress","onCopy","liquidate","RiskyTrovesPage","DisabledRedemption","disabledDays","unlockDate","RedemptionAction","lusdAmount","maxRedemptionRate","redeemLUSD","RedemptionManager","setLUSDAmount","setChangePending","dirty","ethFee","canRedeem","selectBlockTimestamp","blockTimestamp","Redemption","bootstrapPeriod","bootstrapPeriodDays","round","bootstrapEndTime","getTime","bootstrapEndDate","Date","RedemptionPage","transitions","NONE","OPEN_TROVE_PRESSED","TROVE_OPENED","LIQUIDATED","TROVE_SURPLUS_COLLATERAL_CLAIMED","REDEEMED","OPENING","CANCEL_ADJUST_TROVE_PRESSED","ADJUSTING","TROVE_ADJUSTED","TROVE_CLOSED","TROVE_LIQUIDATED","TROVE_REDEEMED","CLOSING","ACTIVE","ADJUST_TROVE_PRESSED","CLOSE_TROVE_PRESSED","troveStatusEvents","open","closedByOwner","closedByLiquidation","closedByRedemption","TroveViewProvider","troveStatus","getInitialView","setView","viewRef","nextView","transition","DEPOSIT_PRESSED","DEPOSITING","CANCEL_PRESSED","DEPOSIT_CONFIRMED","REWARDS_CLAIMED","ADJUST_DEPOSIT_PRESSED","DEPOSIT_EMPTIED","StabilityViewProvider","adjusting","oldStake","oldState","StakingViewProvider","stakingTransactionState","INACTIVE","STAKE_PRESSED","STAKING","STAKE_CONFIRMED","STAKE_APPROVED","ADJUST_PRESSED","CLAIM_REWARD_CONFIRMED","UNSTAKE_AND_CLAIM_CONFIRMED","UNSTAKE_CONFIRMED","DISABLED","FarmViewProvider","LiquityFrontend","path","autoRefreshOnNetworkChange","REACT_APP_DEMO_MODE","EthersWeb3ReactProvider","getLibrary","BatchedWebSocketAugmentedWeb3Provider","UnsupportedMainnetFallback","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"ogBAAA,YACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,SAAAA,I,2ZAZA,YAEA,YACA,YACA,a,wgBCHA,IAAI,EAAJ,MAEA,OAEA,YACA,YACA,YACA,YACA,YACA,YACA,YAEA,QAGA,SAOA,SAEM,EAAM,UAEN,EAAW,UAGd,UAAQ,QAAU,WAHJ,IAId,UAAQ,QAAU,WAJJ,IAKd,UAAQ,QAAU,WALJ,IAMd,UAAO,QAAU,WANH,IAOd,UAAM,QAAU,WAPF,IAQd,UAAK,QAAU,WARD,GAUH,OAAR,OAAkB,EAAI,QAAU,GAAQ,IAiExC,EAAiB,SACrB,EACA,EACA,EACA,EAJqB,EAWrB,GACoC,IANlC,EAMkC,EANlC,eACA,EAKkC,EALlC,6BACA,EAIkC,EAJlC,8BACG,EAG+B,uFAClC,GACA,QAC4B,IAA5B,EAAe,WACd,EAAkB,SAAS,EAAe,UAE3C,MAAM,IAAI,MAAJ,iCAAoC,EAAe,WAG3D,OAAc,KACZ,WACA,SACA,aACA,aACA,eAAgB,IAAI,KAAK,GACzB,6BAA8B,UAAQ,KAAK,GAC3C,8BAA+B,UAAQ,KAAK,IACzC,GACA,IAKM,gBAAgB,SAAC,GAAD,OAC1B,EAAgD,YAEnD,IAAM,EAAe,SAAC,GAAD,OAClB,EAAgD,YAE7C,EAAwB,qBAAG,WAGpB,qBAAqB,SAChC,GAEmB,QADnB,EACmB,uDADE,SACF,OAE4D,QAF5D,EAEK,QAFL,EAEnB,EAAa,UAAW,eAAE,yBAAyB,CAAE,aAAY,KAAK,oBAAS,QAC/E,eAAa,GAAY,SAAS,GAAU,KAAK,IAGtC,iBAAiB,SAAC,GAAqD,aACjE,QADiE,EAClF,EAAW,cAAM,QAAI,QAAM,IAAI,MAAM,wCAG1B,eAAe,SAAC,GAAD,OAC1B,EAAW,UAIA,kBAAkB,SAC7B,EACA,GACU,eAC+B,QAD/B,EACK,QADL,EACD,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YAAI,QAAI,EAAW,mBAAW,QAAI,QAAM,IAAI,MAAM,gCAGlD,0BAA0B,SAAC,GAA+C,aAC/D,QAD+D,EACrF,EAAW,mBAAW,QAAI,QAAM,IAAI,MAAM,oCAG/B,cAAc,SACzB,GADyB,YAGD,IAAxB,EAAW,U,IAUA,E,8BAKX,WAAY,GAAe,wBACzB,uDAAwC,EAAxC,OACK,KAAO,0BACZ,EAAK,QAAU,EAHU,E,YALgB,QAA7C,4BAYA,IAAM,EAAuB,SAC3B,G,MAQA,MAAO,CAN0B,SAAO,SAAS,GACpB,QAA1B,EAAC,EAAiB,gBAAQ,QAAI,QAAM,IAAI,MAAM,gCAC7C,EAEW,SAAO,SAAS,GAAoB,OAAmB,IAM3D,uBAAuB,SAClC,EACA,EACA,GAHkC,OAKlC,EAAc,WAAd,IACK,EAAqB,IAD1B,QAEE,sBAAoB,EAAkB,QACtC,EACA,EACA,MAgBJ,IAAM,EAAoB,CAAC,eAiE3B,SAAgB,EACd,EACA,EACA,EACA,G,MAEM,EACgB,QADN,EACd,EAAY,UAAQ,QAAI,QAAM,IAAI,EAAwB,IAE5D,OAAO,EACL,EACA,EACA,sBAA0B,OAAN,QAAM,IAAN,IAAU,EAAU,GACxC,sBAA0B,OAAN,QAAM,IAAN,IAAU,EAAU,GACxC,EACA,GAfJ,sBAoBO,IAAM,EAAQ,2BAAG,WACtB,EACA,GAFsB,gFAIK,EAAqB,GAJ1B,SAIf,EAJe,OAIL,EAJK,+BAOgB,KAAlB,OAAd,QAAc,IAAd,OAAc,EAAd,EAAgB,aAPA,sBAQZ,IAAI,MAAM,6DARE,+BAYf,GAZe,iBAaC,EAAO,aAbR,yBAalB,YAbkB,MAWpB,GAXoB,4CAiBf,EAjBe,KAiBG,EAjBH,KAiBa,EAjBb,UAiB4B,EAAS,aAjBrC,2BAiBmD,QAjBnD,KAiB4D,EAjB5D,6FAAH,wDAAR,WAAQ,G,kOCpUrB,eAEA,QAEM,EAAY,SAAC,GAAD,OAAuB,EAAI,IAAI,IAG3C,EAAY,GACZ,EAAM,YAAU,KAAK,GACrB,EAAM,YAAU,KAAK,IACrB,EAAS,EAAU,GAEnB,EAA6B,qCAC7B,EAAgB,MAChB,EAAa,CAAC,GAAI,IAAK,IAAK,IAAK,KAEjC,EAAa,SAAC,EAAc,GAAf,OAAgC,EAAE,IAAI,GAAG,IAAI,EAAQ,KAAK,KAAK,IAAI,IAkBzE,E,WAkBT,SAAF,EAAoB,GACd,GADkC,UAClC,EAAU,aACN,UAAI,MAAM,sCAGd,KAAC,WAAa,E,2BAdpB,WACE,OAAO,KAAK,WAAW,gB,qBAIzB,WACE,OAAO,KAAK,WAAW,a,6CA8EjB,WACN,IAAM,EAAiB,KAAK,WAAW,IAAI,GACrC,EAAW,KAAK,WAAW,IAAI,GAErC,GAAI,EAAS,SACX,OAAO,EAAe,WAEtB,IACM,EADiB,EAAS,WAAW,SAAS,EAAW,KACxB,QAAQ,EAAe,IAC9D,OAAO,EAAe,WAAa,IAAM,I,sBAIrC,SAAS,GACf,IAAM,EAAY,EAAU,GAAgB,GAAW,IAAI,GAC3D,OAAO,KAAK,WAAW,IAAI,K,oCAGrB,SAAuB,GAC7B,GAAI,EAAY,EACd,MAAM,IAAI,MAAM,kCAGlB,IAAM,EAAQ,EAAY,EAAY,KAAK,SAAS,GAAa,KAAK,WAChE,EAAiB,EAAM,IAAI,GAC3B,EAAW,EAAM,IAAI,GAE3B,GAAkB,IAAd,EACF,OAAO,EAAe,WAEtB,IACM,EADiB,EAAS,WAAW,SAAS,EAAW,KACxB,OAAO,EAAG,GACjD,OAAO,EAAe,WAAa,IAAM,I,sBAI7C,SAAS,GACP,OAAI,KAAK,SACA,cACgB,IAAd,EACF,KAAK,uBAAuB,GAE5B,KAAK,oC,sBAIhB,WAAsB,IAAb,EAAa,uDAAD,EAAC,EACe,KAAK,SAAS,GAAW,MAAM,KAD9C,SACb,EADa,KACG,EADH,KAEd,EAAuB,EAAe,QAAQ,0BAA2B,OAE/E,YAAoB,IAAb,EAAyB,EAAuB,IAAM,EAAW,I,qBAG1E,WACE,IAAM,EAAuB,KAAK,SAAS,GAAG,OACxC,EAAY,KAAK,IAAI,KAAK,OAAO,EAAuB,GAAK,GAAI,EAAW,OAAS,GAErF,EAAY,KAAK,IAAI,GAAK,EAAY,GAAK,EAAsB,GAGvE,OAFmB,KAAK,IAAI,IAAI,EAAQ,EAAU,EAAY,EAAI,KAEhD,SAAS,GAAa,EAAW,K,iBAGrD,SAAI,GACI,OAAC,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAQ,e,iBAG9D,SAAI,GACF,OAAO,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAY,e,iBAGlE,SAAI,GACF,OAAO,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAY,YAAY,IAAI,M,iBAGlF,SAAI,GAGF,OAFM,EAAI,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EAAQ,KAAK,WAAW,IAAI,GAAQ,IAAI,EAAQ,e,sBAI7D,SAAS,GAGP,OAFA,EAAU,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EACT,KAAK,WAAW,IAAI,GAAQ,IAAI,EAAQ,WAAW,IAAI,IAAM,IAAI,EAAQ,e,oBAI7E,SAAO,EAAwB,GAI7B,OAHA,EAAa,EAAQ,KAAK,IAC1B,EAAU,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAW,YAAY,IAAI,EAAQ,e,iBAG5E,SAAI,GAIF,GAHA,UAAO,OAAO,UAAU,IACxB,UAAO,GAAK,GAAY,GAAY,YAEnB,IAAb,EACF,OAAO,EAAQ,IAGjB,GAAiB,IAAb,EACF,OAAO,KAMT,IAHA,IAAI,EAAI,KAAK,WACT,EAAI,EAED,EAAW,EAAG,KAAc,EAClB,EAAX,IACF,EAAI,EAAW,EAAG,IAGpB,EAAI,EAAW,EAAG,GAGpB,OAAO,IAAI,EAAQ,EAAW,EAAG,M,kBAGnC,WACQ,OAAC,KAAK,WAAW,W,gBAGzB,WACE,GAAI,KAAK,OACP,OAAO,O,mBAIX,WACE,IAAK,KAAK,OACR,OAAO,O,oBAIX,WACE,GAAI,KAAK,GAAG,EAAQ,UAClB,OAAO,O,kBAIX,WACE,IAAK,KAAK,GAAG,EAAQ,UACnB,OAAO,O,yBAKX,WACE,OAAO,O,gBAGT,SAAG,GACD,OAAO,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,gBAG/C,SAAG,GACK,OAAC,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,gBAG/C,SAAG,GACD,OAAO,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,iBAG/C,SAAI,GACF,OAAO,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAM,c,iBAGhD,SAAI,GACF,OAAO,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAM,e,kCA5PhD,SAA2B,GACnB,OAAC,IAAI,EAAQ,YAAU,KAAK,M,yBAG5B,SAAmB,GACzB,IAAK,IAAmB,EAAe,MAAM,GAC3C,MAAM,IAAI,MAAJ,+BAAkC,EAAlC,MAGF,GAAF,EAAe,SAAS,KAAM,OAEF,EAAe,MAAM,KAFnB,SAE3B,EAF2B,KAEd,EAFc,KAIhC,OAAI,EAAS,WAAW,KACf,IAAI,EACT,EAAQ,YAAY,GAAa,WAAW,IAC1C,EAAI,IAAI,YAAU,KAAK,EAAS,OAAO,QAKzC,EAAS,WAAW,OACZ,EAAC,EAAS,OAAO,IAGtB,IAAI,EACT,EAAQ,YAAY,GAAa,WAAW,IAAI,EAAI,IAAI,YAAU,KAAK,OAI3E,IAAK,EAAe,SAAS,KAC3B,OAAO,IAAI,EAAQ,YAAU,KAAK,GAAgB,IAAI,IA3BT,MA+Bd,EAAe,MAAM,KA/BP,SA+B1C,EA/B0C,KA+B1B,EA/B0B,KAuC/C,OANI,EAAS,OAAS,EACpB,GAAY,IAAI,OAAO,EAAY,EAAS,QAE5C,EAAW,EAAS,OAAO,EAAG,GAGzB,IAAI,EACT,YAAU,KAAK,GAAkB,GAC9B,IAAI,GACJ,IAAI,M,kBAIX,SAAY,GACV,cAAe,GACb,IAAK,SACH,GAAI,aAAsB,EACxB,OAAO,EAEP,MAAM,IAAI,MAAM,4BAEpB,IAAK,SACH,OAAO,EAAQ,YAAY,GAC7B,IAAK,SACH,OAAO,EAAQ,YAAY,EAAW,YACxC,QACE,MAAM,IAAI,MAAM,+B,iBAgMtB,SAAW,EAAe,GAIxB,OAHA,EAAI,EAAQ,KAAK,GACjB,EAAI,EAAQ,KAAK,GAEV,EAAE,GAAG,GAAK,EAAI,I,iBAGvB,SAAW,EAAe,GAIxB,OAHA,EAAI,EAAQ,KAAK,GACjB,EAAI,EAAQ,KAAK,GAEV,EAAE,GAAG,GAAK,EAAI,M,KApSzB,YACkB,WAAW,EAAQ,oBA7BhB,sEA8BH,OAAO,EAAQ,KAAK,GACpB,OAAO,EAAQ,KAAK,IACpB,MAAM,EAAQ,KAAK,G,IAuSxB,E,WAGT,SAAF,EAAoB,GAAiC,UAC/C,KAAC,QAAU,E,kCA0BjB,SAAS,GACP,OAAK,KAAK,QAIH,KAAK,QAAQ,KAAO,KAAK,QAAQ,cAAc,SAAS,GAHtD,Q,sBAMX,SAAS,GACP,OAAK,KAAK,QAIH,KAAK,QAAQ,KAAO,KAAK,QAAQ,cAAc,SAAS,GAHtD,KAAK,a,iBAMhB,SAAI,GACF,OAAO,IAAI,EACT,KAAK,SAAW,CACd,KAAM,KAAK,QAAQ,KACnB,cAAe,KAAK,QAAQ,cAAc,IAAI,O,mBAKpD,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,UAAW,O,oBAGhD,W,MACE,MAA8B,OAAX,QAAZ,OAAK,eAAO,eAAE,MAAe,UAAO,I,oBAG7C,W,MACE,MAA8B,OAAX,QAAZ,OAAK,eAAO,eAAE,MAAe,UAAO,I,yBAG7C,W,MACE,OAAmB,QAAnB,EAAO,KAAK,eAAO,eAAE,gB,oBAGvB,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,WAAY,O,kBAGjD,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,SAAU,Q,sBArE/C,SAAe,EAA4B,GACzC,YAAW,IAAP,QAA2B,IAAP,EACf,IAAI,OAAW,IAGxB,EAAK,EAAQ,KAAK,GAClB,EAAK,EAAQ,KAAK,GAEd,EAAG,UAAY,EAAG,SACb,IAAI,OAAW,GACb,EAAG,SACL,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,IACzC,EAAG,SACL,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,IACzC,EAAG,GAAG,GACR,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,EAAQ,KAAK,GAAI,IAAI,KAC9D,EAAG,GAAG,GACR,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,EAAQ,KAAK,GAAI,IAAI,KAEhE,IAAI,EAAW,CAAE,KAAM,GAAI,cAAe,EAAQ,Y,KA1B/D,e,IAiFa,E,WAaX,WAAmB,GAAQ,UACzB,KAAK,SAAW,EAAM,UAAa,EAAM,KAAO,EAAM,IAAI,MAAS,E,oCAGrE,SAAW,G,MACH,EAAO,YAAQ,IAAI,OAAO,GAAnB,KAEb,GAA+B,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,GACnC,OAAO,O,sBAIX,SAAS,GACP,OACE,KAAK,SAAS,SAAS,IACtB,KAAK,SAAS,gBAAkB,KAAK,SAAS,SAAW,IAAM,M,sBAIpE,W,QACE,OAA+B,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,SAC5B,KAAK,SAAS,IACe,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,OACnC,KAAK,SAAS,GAEd,KAAK,SAAS,O,KAtC3B,a,gaF9ZA,YACA,YACA,a,6cAFA,YACE,wGAIA,mDAAE,YAAF,EAAE,IAAF,+CAGF,YACA,YACA,YACA,YACA,SAAAA,GACA,YACA,a,6IGZA,WAEa,YAAY,SAAC,GAAD,OAAkC,EAAU,YAExD,aAAa,SAAC,GAAD,OACxB,UAAQ,oBAAoB,EAAU,gBAE3B,QAAQ,SAAI,GACvB,MAAM,GAMK,mBAAmB,SAAI,GAClC,IAAM,EAAO,OAAO,KAAK,GAEzB,OAAO,QAAQ,IAAI,OAAO,OAAO,IAAS,MAAK,YAAM,OACnD,OAAO,YAAY,EAAO,KAAI,SAAC,EAAO,GAAR,MAAc,CAAC,EAAK,GAAI,Y,6SCpB1D,YAOa,4BAA4B,UAAQ,KAAK,KAOzC,2BAA2B,UAAQ,KAAK,KAOxC,2BAA2B,UAAQ,KAAK,KAWxC,wBAAwB,UAAQ,KAAK,MAUrC,oBAAoB,2BAAyB,IAAI,yBAWjD,yBAAyB,UAAQ,KAAK,MAOtC,yBAAyB,UAAQ,KAAK,KAOtC,0BAA0B,UAAQ,KAAK,O,uGCnEpD,WAIA,SAEa,kBAAkB,WAC3B,IAAI,EAAQ,aAAW,uBAEvB,IAAG,EACH,MAAM,IAAI,MAAM,4DAGlB,OAAO,I,4RCHT,aAGA,OAEA,SAOM,EAAqC,GAE9B,+BAA+B,SAC1C,GAD0C,OAG1C,EAA4B,MAC1B,YAA0B,OAAI,aAAoB,MAGtD,IAYM,EAAoB,SAAC,GAAD,MACH,kBAAd,GAAuD,KAA7B,gBAAc,IAG3C,EAAQ,SAAC,GAAD,OAAgB,IAAI,SAAQ,YAAO,OAAI,WAAW,EAAS,OAOnE,EAAU,SAAO,GAAP,OAA0C,SAAC,GAAD,OAAuB,SAC/E,EAD+E,GAG7E,IADA,EACA,EADA,SAEI,EAAJ,GAAG,MAAK,YACE,OAAN,GAAc,KAChB,EAAE,SAKF,EAAO,SAAI,GAAF,OAAwB,SAAC,EAAM,GACxC,EAAF,KAGE,EAAW,SAAI,GAAF,OAAwB,SAAC,EAAD,GAA6C,IAApC,EAAoC,EAApC,SAC9C,EAAF,GACE,MAgBO,qBAAqB,SAAiD,GAC/E,IAAE,EAA0B,8BAAG,qC,2BAK/B,WAAa,EACP,EAAN,yBAA0B,EAEX,EAAN,gBAAkB,IAAI,IAChB,EAAN,eAAiB,EAAK,SAAS,KAAd,MATK,EAAH,uCAW5B,SAAc,EAAa,GACjB,KAAH,YAAc,IAAI,oBAAkB,EAAK,GACtC,KAAH,YAAY,QAAU,KAAK,kBAAkB,KAAK,MAC/C,KAAH,UAAY,CAAC,EAAK,GACf,KAAH,gBAfqB,+BAkB5B,WAAiB,WACP,KAAH,iBACL,QAAQ,KAAK,2DACb,KAAK,kBAAoB,YAAW,kBAAM,EAAK,cAAL,QAAI,EAAkB,EAAK,cAAa,OArBxD,4BAwB5B,WACM,KAAK,cACP,KAAK,YAAY,QAAU,KACjB,KAAL,YAAY,MAAM,KACvB,KAAK,iBAAc,EACnB,KAAK,mBAE0B,IAA3B,KAAK,oBACP,aAAa,KAAK,mBAClB,KAAK,uBAAoB,MAjCH,yBAsC5B,WACM,KAAK,gBAAgB,KAAO,IAC1B,KAAK,aACP,uCAAU,QAAS,KAAK,gBAE1B,KAAK,uBA3CmB,sBA+C5B,SAAS,GAAmB,WAC1B,KAAK,WAAa,EAEb,KAAK,0BACR,KAAK,yBAA0B,EAE/B,YAAW,WACT,EAAK,yBAA0B,EAC/B,EAAI,EAAK,iBAAiB,SAAQ,mBAAkB,EAAlB,WAA2B,EAAK,iBACjE,OAxDqB,wDA4D5B,WAAyB,EAA2B,GAApD,qEACqB,EADrB,gCAGwB,IAHxB,cAGY,EAHZ,yBAOa,GAPb,mCASU,KAAK,aAAe,IA7Hf,kBADY,EA8H0C,OA5H9C,kBAAlB,EAAM,UACZ,EAAM,QAAQ,SAEb,qBAEA,EAAM,QAAQ,SAEZ,8EA4GF,qDAeU,EArH6B,KAsGvC,yDArH0B,IAAC,IAqH3B,oBA5D4B,sGA+E5B,WACE,EACA,GAFQ,IAAV,WAAU,OAAV,oBAAY,OAAZ,6CAIiC,EAJjC,cAIQ,EAJR,OAMQ,EAAU,W,MACd,OAAgB,QAAhB,IAAK,mBAAW,eAAE,SACd,EAAK,YAAY,KAAK,EAAa,GADvC,kCAEe,EAAa,IAThC,kBAWS,IAAqB,KAAK,WAC7B,KAAK,gBAAgB,EAAS,KAAK,YACnC,KAbN,gDA/E4B,4GA+F5B,WACE,EACA,GAFF,8FAIiC,EAJjC,cAIQ,EAJR,OAMQ,EAAU,W,MACd,OAAgB,QAAhB,IAAK,mBAAW,eAAE,SACd,EAAK,YAAY,WAAW,EAAe,GAD/C,wCAEqB,EAAe,IATxC,kBAWS,IAAqB,KAAK,WAC7B,KAAK,gBAAgB,EAAS,KAAK,YACnC,KAbN,gDA/F4B,wFA+G5B,WACM,KAAK,aACP,QAAQ,IAAI,iDACZ,KAAK,YAAY,GAAG,QAAS,KAAK,kBAElC,QAAQ,IAAI,8CACZ,sCAAS,QAAS,KAAK,mBArHC,8BAyH5B,WACM,KAAK,YACP,KAAK,YAAY,IAAI,QAAS,KAAK,gBAEnC,uCAAU,QAAS,KAAK,kBA7HA,mBAiI5B,SACE,EACA,GAA4E,WAE5E,MAAO,CACL,EACA,SAAC,GAAD,OACE,EA/II,SAAI,GAAJ,OAA0B,SAAC,GACnC,YAAO,WACH,EAAJ,KACD,IA4IO,CAAM,GAAR,CAAY,EAAG,CACb,SAAU,kBAAM,EAAK,gBAAgB,IAAI,IACzC,SAAU,kBAAM,EAAK,gBAAgB,OAAO,UA1IxB,gBA+I5B,SAAG,EAAsB,GACvB,GAAI,EAAkB,GAAY,CAChC,IAAM,EAAe,KAAK,iCAAiC,KAAK,KAAM,GADtC,EAER,KAAK,MAAM,EAAU,EAAQ,IAA5C,EAFuB,UAMhC,OAFA,OAAY,GAEL,KAAK,kBAAkB,EAAU,GACnC,MAAkB,UAAd,EACF,KAAK,kBAAL,aAA0B,KAAK,MAAM,EAAU,KAEtD,sCAAgB,EAAW,KA1JH,+BA8J5B,SAAkB,EAAyB,GAQjC,OAPH,KAAK,gBAAgB,IAAI,KAC5B,KAAK,gBAAgB,IAAI,EAAK,GAEI,IAA9B,KAAK,gBAAgB,MACvB,KAAK,qBAGF,OAtKmB,kBAyK5B,SAAK,EAAsB,GACjB,GAAJ,EAAkB,GAAY,CACtB,IAAJ,EAAe,KAAK,iCAAiC,KAAK,KAAM,GADtC,EAEJ,KAAK,MAAM,GAzL7C,EAyLgE,EAAQ,GAxLxE,EAwLuF,EAvLpF,SAAC,GAAG,OAAmB,SAAC,EAAM,GAC3B,GAAJ,YAAS,OAAJ,EAAE,EAAF,CAAK,EAAG,KAAT,CAAmB,EAAG,OAsLb,EAFuB,UAMhC,OAFA,OAAgB,GAET,KAAK,kBAAkB,EAAU,GACnC,MAAkB,UAAd,EACF,KAAK,kBAAL,aAA0B,KAAK,MAAM,EAAU,KAEtD,wCAAkB,EAAW,GAlMpB,IACf,EACA,IAY8B,iBAwL5B,SAAI,EAAsB,GAChB,OAAJ,EAAkB,IAA4B,UAAd,EAC3B,KAAK,qBAAqB,GAEjC,uCAAiB,EAAW,KA5LJ,kCAgM5B,SAAqB,GAOnB,OANI,KAAK,gBAAgB,IAAI,KAC3B,KAAK,gBAAgB,OAAO,GACM,IAA9B,KAAK,gBAAgB,MACvB,KAAK,oBAGF,OAvMmB,uDA0M5B,WAAqB,GAArB,oFACQ,EADR,mDAEyB,IAFzB,UAGwB,QAAhB,OAAK,mBAAW,eAAE,SAAU,CAAC,KAAK,YAAY,eAAe,IAAoB,KAHzF,SAMsB,QAAQ,KAAK,GANnC,UAOkB,QADV,EANR,cAOkB,IAAL,EAPb,qBAOa,EAPb,wCAO6B,QAAQ,IAAI,GAPzC,oBAOsD,MAAK,YAAE,OAAW,OAAP,KAPjE,gBAOU,EAPV,UAO6E,OAP7E,sCAO6E,MAP7E,uCAO6E,EAP7E,6BAOiF,KAPjF,eAOQ,EAPR,uBASS,GATT,iDA1M4B,0FAsN5B,SAAsB,G,MACpB,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,sBAAsB,GADpC,yDAEyB,KAzNN,iCA4N5B,SACE,EACA,G,MAEA,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,oBAAoB,EAAe,GADjD,uDAEuB,EAAe,KAlOnB,sBAqO5B,SAAS,G,MACP,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,SAAS,GADvB,4CAEY,KAxOO,sCA2O5B,SAAyB,G,MACvB,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,yBAAyB,GADvC,4DAE4B,KA9OT,yDAiP5B,WAAuB,EAAqB,GAA5C,qEAGO,EAAQ,KAHf,UAGsB,EAHtB,gCAIU,EA/R6B,KA2RvC,uBAG2C,KAAK,SAAS,GAHzD,OAG6B,EAH7B,sDAOS,EAAM,aAAa,MAAK,YAAa,OAAI,IAAkB,MAPpE,iDAjP4B,kIA2P5B,WAAuC,EAAkC,GAAzE,qFACiB,EADjB,OACE,EADF,OAGqB,EAHrB,uBAI2B,KAAK,sBAAsB,GAJtD,UAIU,EAJV,iBAOsB,IAAhB,EAPN,8BAQmB,OAAZ,GARP,uCAQmC,KAAK,iBAAiB,EAAa,GARtE,uFASmB,OAAZ,GAAoB,EAAQ,YAAc,EAAQ,cAAgB,GAAK,EAT9E,2DAca,GAdb,yBAkBU,EAvT6B,KAqSvC,wEA3P4B,oHAiR5B,WAAyB,EAAgB,EAAwB,GAAjE,sFACkB,IAAZ,EADN,+FAGoC,EAAQ,EAAe,IAH3D,OAMM,OAAkC,EANxC,uBAQ0B,KAAK,iCAAiC,EAAQ,GARxE,UAWkB,QAHR,EARV,gBAYyB,IAAlB,GAA+B,EAAQ,eAAiB,GAZ/D,yCAca,GAdb,wBAiBwB,IAAI,SAAgB,YAAO,OAAI,EAAK,KAAK,QAAS,MAjB1E,QAiBI,EAjBJ,+EAjR4B,gEAAiB,GAyS/C,OAFA,EAA4B,KAAK,GAE1B,GAGI,iCAAiC,qBAAmB,iB,+JCpYjE,IAEa,E,mHACX,WACE,OAAQ,KAAK,WAAyB,aAAe,UAAU,O,mBAGjE,SAAY,GACT,KAAK,WAAyB,QAAU,I,mBAG3C,SAAM,GACH,KAAK,WAAyB,MAAM,K,sDAGvC,qGACS,KAAK,SADd,gD,2DAfF,OAEuC,mBAAvCA,EAAQC,kBAAoB,G,yTCE5B,aAUA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YA2Ga,E,8BAGX,WACE,EACA,EACA,GAAgD,MA3BlD,EACA,EA0BkD,kBAEhD,cAAM,EAAe,EAAmB,IAGnC,qBAhCP,EAgCqD,EAAK,YA/B1D,EA+BuE,EAAK,oBA7B5E,OAAO,YACL,OAAO,KAAK,GAAmB,KAAI,YAAY,MAAI,CACjD,EADiD,2BAEjD,WAAO,EAAW,GAAlB,sGAAqC,EAArC,iCAAqC,EAArC,kBAC6B,IAAvB,EAAU,SADhB,gCAE+B,EAAkB,GAAlB,QAAmC,EAAlB,QAAwB,KAFxE,OAEU,EAFV,OAII,EAAS,OACJ,GADI,IAEP,SAAU,EAAe,KAN/B,gCAUS,EAAU,GAAV,QAA2B,EAAlB,QAAwB,MAV1C,2CAFiD,8DAuBH,E,uCAQlD,SAAc,EAAa,GAAY,WACrC,OAAO,EACJ,QAAO,YAAG,OAAI,EAAI,UAAY,EAAK,WACnC,KAAI,YAAG,OAAI,EAAK,UAAU,SAAS,MACnC,QAAO,YAAC,OAAI,EAAE,OAAS,S,GAlBQ,YAAtC,qBAgDa,sBAAsB,SACjC,GADiC,MAEC,aAAc,GAGrC,kBAAkB,SAAC,GAAD,MAC7B,SAAU,GAsDC,sBAAsB,SACjC,EADiC,GAGZ,IAhDP,EAA6B,EAsB3C,EACA,EAwBE,EACmB,EADnB,UAAW,EACQ,EADR,oBAAqB,EACb,EADa,gBAE5B,GAjDQ,EAiDK,EAjDwB,EAiDH,EAjDqD,CAC7F,WAAY,UACZ,mBAAoB,UACpB,aAAc,UACd,UAAW,UACX,kBAAmB,UACnB,YAAa,UACb,UAAW,UACX,YAAa,UACb,sBAAuB,UACvB,YAAa,UACb,iBAAkB,UAClB,UAAW,EAAqB,UAAsB,UACtD,aAAc,UACd,cAAe,UACf,QAAS,UACT,gBAAiB,UACjB,QAAS,UACT,SAAU,EAAiB,UAAe,YAiC1C,OA7BA,EA8BE,EA7BF,EA8BE,SAAC,EAAS,GAAV,OACE,IAAI,EAAiB,EAAS,EAAI,GAAM,IA7B5C,OAAO,YACL,OAAO,QAAQ,GAAW,KAAI,yBAAE,EAAF,KAAO,EAAP,WAAc,CAAC,EAAK,EAAE,EAAG,U,gKCnO3D,IAuCK,EAvCL,OAiBA,QAGA,QAWA,SAKM,EAAsB,UAAQ,KAAK,wBACnC,EAAO,UAAQ,KAAK,IAE1B,SAAK,GACH,iCACA,uBACA,qCACA,iDACA,+CALF,CAAK,MAAkB,KAQvB,IAAM,EAAsB,SAAC,GAAD,OAC1B,IAAkB,EAAmB,YACjC,cACA,IAAkB,EAAmB,OACrC,OACA,IAAkB,EAAmB,cACrC,gBACA,IAAkB,EAAmB,oBACrC,sBACA,IAAkB,EAAmB,mBACrC,qBACA,QAAM,IAAI,MAAJ,gCAAmC,MAEzC,EAAgB,SAAC,GAAD,OAAuB,IAAI,KAAiB,IAAZ,IAEhD,EAAsB,CAAC,2BAA4B,6BAEnD,EAAoB,SAAmB,EAA4B,GACrE,QAAe,IAAb,EAAI,GAAoB,CACtB,IAAC,OAAO,UAAU,EAAI,IACxB,MAAM,IAAI,MAAJ,UAAa,EAAb,wBAGR,GAAI,EAAI,GAAO,EACb,MAAM,IAAI,MAAJ,UAAa,EAAb,4BAUC,E,WAIT,SAAF,EAAY,GAAmC,UACzC,KAAC,WAAa,E,kCAwDpB,WACE,OAAO,I,8DAIT,WAA4B,GAApB,IAAR,YAAQ,OAAR,oBAAU,OAAV,sCAC2B,gBAAc,KAAK,YAApC,EADV,EACU,aADV,SAGmC,QAAQ,IAAI,CAC3C,EAAa,MAAb,KAAwB,IAAa,KAAK,cAC1C,EAAa,WAAb,KAA6B,IAAa,KAAK,gBALnD,gCAGS,EAHT,KAGqB,EAHrB,uBAQS,IAAI,QAAM,EAAY,IAR/B,gD,4HAYA,WACE,EACA,GAFF,sFAIS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aAJnC,EAK2B,gBAAc,KAAK,YAApC,EALV,EAKU,aALV,SAOkC,QAAQ,IAAI,CAC1C,EAAa,OAAO,EAApB,KAAkC,IAClC,EAAa,gBAAgBC,EAA7B,KAA2CC,MAT/C,4BAOS,EAPT,KAOgB,EAPhB,KAYM,EAAM,SAAW,EAAmB,OAZ1C,0CAaW,IAAI,iCACT,EACA,EAAoB,EAAM,QAC1B,aAAW,EAAM,MACjB,aAAW,EAAM,MACjB,aAAW,EAAM,OACjB,IAAI,QAAM,aAAW,EAAS,KAAM,aAAW,EAAS,aAnB9D,iCAsBW,IAAI,iCAA+B,EAAS,EAAoB,EAAM,UAtBjF,iD,0GA2BA,WAAe,EAAkB,GAAjC,2FAC4C,QAAQ,IAAI,CACpD,KAAK,6BAA6B,EAAS,GAC3C,KAAK,sBAAsB,KAH/B,gCACS,EADT,KACgB,EADhB,uBAMS,EAAM,oBAAoB,IANnC,gD,mHAUA,WAAwB,GAAxB,gFAC2B,gBAAc,KAAK,YAApC,EADV,EACU,aADV,SAGgB,EAAa,oBAAb,KAAsC,IAHtD,uCAGoE,YAHpE,gD,6EAOA,SAAS,GAGP,OAFsB,gBAAc,KAAK,YAAjC,UAES,WAAW,WAArB,KAAqC,IAAa,KAAK,gB,uDAIhE,WAAqB,GAArB,wFACyB,gBAAc,KAAK,YAAlC,EADV,EACU,WADV,SAG+C,QAAQ,IACnD,CACE,EAAW,OAAX,KAAuB,IACvB,EAAW,YAAX,KAA4B,KAC5B,KAAI,YAAY,OAAI,EAAa,KAAK,kBAP5C,gCAGS,EAHT,KAG2B,EAH3B,uBAUS,IAAI,QAAM,EAAkB,IAVrC,gD,+GAcA,WAAsB,GAAtB,wFAC0B,gBAAc,KAAK,YAAnC,EADV,EACU,YADV,SAGmD,QAAQ,IACvD,CACE,EAAY,OAAZ,KAAwB,IACxB,EAAY,YAAZ,KAA6B,KAC7B,KAAI,YAAY,OAAI,EAAa,KAAK,kBAP5C,gCAGS,EAHT,KAG+B,EAH/B,uBAUS,IAAI,QAAM,EAAsB,IAVzC,gD,wGAcA,WAAe,GAAf,2FAC0C,QAAQ,IAAI,CAClD,KAAK,eAAe,GACpB,KAAK,gBAAgB,KAHzB,gCACS,EADT,KACqB,EADrB,uBAMS,EAAW,IAAI,IANxB,gD,mHAUA,WACE,EACA,GAFM,IAAR,oBAAQ,OAAR,oBAAU,OAAV,oCAIS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aAJnC,EAK4B,gBAAc,KAAK,YAArC,EALV,EAKU,cALV,SAYY,QAAQ,IAAI,CACpB,EAAc,SAAS,EAAvB,KAAqC,IACrC,EAAc,yBAAyB,EAAvC,KAAqD,IACrD,EAAc,oBAAoB,EAAlC,KAAgD,IAChD,EAAc,qBAAqB,EAAnC,KAAiD,MAhBrD,uCAQM,EARN,EAQM,YAAa,EARnB,EAQmB,aACf,EATJ,KAUI,EAVJ,KAWI,EAXJ,uBAmBS,IAAI,mBACT,aAAW,GACX,aAAW,GACX,aAAW,GACX,aAAW,GACX,IAxBJ,iD,qIA6BA,WAA0C,GAA1C,oFACgC,gBAAc,KAAK,YAAzC,EADV,EACU,kBAEF,EAAc,KAAK,WAAW,6BAHtC,KAI0B,EAJ1B,SAI2C,EAAkB,gBAAlB,KAAuC,IAJlF,0BAIQ,EAJR,KAI0B,WAJ1B,kCAOS,EAAY,IAAI,IAPzB,gD,2FAWA,SAAuB,GAGrB,OAF0B,gBAAc,KAAK,YAArC,cAEa,qBAAd,KAAwC,IAAa,KAAK,gB,4BAInE,SAAe,EAAkB,GAI/B,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACX,gBAAc,KAAK,YAAjC,UAES,UAAU,EAApB,KAAkC,IAAa,KAAK,gB,4BAI7D,SAAe,EAAkB,GAI/B,OAHO,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACX,gBAAc,KAAK,YAAjC,UAES,UAAU,EAApB,KAAkC,IAAa,KAAK,gB,gCAI7D,SAAmB,EAAkB,GAInC,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACZ,gBAAc,KAAK,YAAhC,SAEQ,UAAU,EAAnB,KAAiC,IAAa,KAAK,gB,kCAI5D,SAAqB,EAAkB,GAC9B,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aADmC,MAEtC,gBAAc,KAAK,YAAzC,EAF4D,EAE5D,SAAU,EAFkD,EAElD,QAElB,OAAO,EAAS,UAAU,EAAS,EAAQ,QAApC,KAAkD,IAAa,KAAK,gB,yFAI7E,WACE,GADF,4FAGsB,gBAAc,KAAK,YAA/B,EAHV,EAGU,QAHV,SAKwE,QAAQ,IAAI,CAChF,EAAQ,YAAR,KAAyB,IACzB,EAAQ,WAAR,KAAwB,IAAa,KAAK,cAC1C,EAAQ,aAAR,KAA0B,IAAa,KAAK,aAC5C,EAAQ,eAAR,KAA4B,IAAa,KAAK,eATlD,gCAKS,EALT,KAKsB,EALtB,KAKkC,EALlC,KAKgD,EALhD,wBAYS,SAAC,GAAD,OACL,EAAW,IACT,KAAK,IAAI,EAAG,GAAgB,EAAY,SAAW,EAAiB,QAd1E,iD,qIAmBA,WAA4C,GAA5C,2FACyD,QAAQ,IAAI,CACjE,KAAK,iDAAiD,GACtD,KAAK,mBAA4B,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YAHvC,gCACS,EADT,KACiC,EADjC,uBAMS,EAAuB,IANhC,gD,4FAUA,SAAwB,EAAkB,GAIlC,OAHC,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACb,gBAAc,KAAK,YAA/B,QAEO,UAAU,EAAlB,KAAgC,IAAa,KAAK,gB,qCAI3D,SAAwB,GAGtB,OAFoB,gBAAc,KAAK,YAA/B,QAEO,YAAR,KAAyB,IAAa,KAAK,gB,0CAIpD,SAA6B,EAAkB,GAIvC,OAHC,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACb,gBAAc,KAAK,YAA/B,QAEO,OAAO,EAAf,KAA6B,IAAa,KAAK,gB,yCAIxD,SAA4B,EAAkB,GAI5C,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACL,gBAAc,KAAK,YAAvC,gBAEe,cAAc,EAA9B,KAA4C,IAAa,KAAK,gB,kDAYvE,WACE,EACA,GAFM,IAAR,kBAAQ,OAAR,oBAAU,OAAV,kCAI+B,gBAAc,KAAK,YAAxC,EAJV,EAIU,iBAER,EAAkB,EAAQ,SAC1B,EAAkB,EAAQ,cAErB,EAAoB,SAAS,EAAO,UAT3C,sBAUU,IAAI,MAAJ,mCACwB,EAAoB,KAAI,YAAC,iBAAQ,EAAR,QAAc,KAAK,QAX9E,uBAeoD,QAAQ,IAAI,CAC5D,EAAO,0BAAuB,EAAY,KAAK,sBAAL,KAAgC,IAC1E,EAAiB,wBACK,8BAApB,EAAO,SACc,QAAlB,EAAC,EAAO,kBAAU,QAAI,KACD,QAAlB,EAAC,EAAO,kBAAU,QAAI,GAAK,GACjC,EAAO,MAJT,KAKO,MAtBX,4BAeS,EAfT,KAe6B,EAf7B,KA0BQ,EAAS,EAAiB,IAE5B,EA5BN,0CA6BW,EAAO,KAAI,YAAK,OAAI,EAAM,oBAAoB,OA7BzD,iCA+BW,GA/BX,iD,yFAoCA,SAAmB,GACX,OAAC,qBAAmB,KAAK,WAAY,K,wDAI7C,WACE,GADF,wFAG2B,gBAAc,KAAK,YAApC,EAHV,EAGU,aAHV,SAK6D,QAAQ,IAAI,CACrE,EAAa,qBAAb,KAAuC,IACvC,EAAa,SAAb,KAA2B,IAAa,KAAK,gBAPjD,gCAKS,EALT,KAK+B,EAL/B,wBAUS,SAAC,EAAgB,GAAjB,OACL,IAAI,OACF,EACA,EACA,EACA,EAAc,EAAqB,YACnC,EAAc,GACd,MAjBN,gD,uGAsBA,WAAc,GAAd,+FAC2D,QAAQ,IAAI,CACnE,KAAK,gBAAgB,GACrB,KAAK,SAAS,GACd,KAAK,SAAS,GACd,KAAK,mBAA4B,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YALvC,gCACS,EADT,KACqB,EADrB,KAC4B,EAD5B,KACmC,EADnC,uBAQS,EAAW,EAAgB,EAAM,+BAA+B,KARzE,gD,4GAYA,WAAmB,EAAkB,GAArC,wFACS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aADnC,EAE0B,gBAAc,KAAK,YAAnC,EAFV,EAEU,YAFV,SAIuD,QAAQ,IAC3D,CACE,EAAY,OAAO,EAAnB,KAAiC,IACjC,EAAY,kBAAkB,EAA9B,KAA4C,IAC5C,EAAY,mBAAmB,EAA/B,KAA6C,KAC7C,KAAI,YAAY,OAAI,EAAa,KAAK,kBAT5C,gCAIS,EAJT,KAIqB,EAJrB,KAIqC,EAJrC,uBAYS,IAAI,YAAU,EAAY,EAAgB,IAZnD,iD,oHAgBA,WAAyB,GAAzB,gFAC0B,gBAAc,KAAK,YAAnC,EADV,EACU,YADV,kBAGS,EAAY,gBAAZ,KAAiC,IAAa,KAAK,eAH5D,gD,iHAOA,WACE,EACA,GAFF,oFAIS,OAAP,QAAO,IAAP,MAAY,0BAAwB,KAAK,aAJ3C,EAK4B,gBAAc,KAAK,YAArC,EALV,EAKU,cALV,SAO6C,EAAc,UAAU,EAAxB,KAAsC,IAPnF,uBAOU,EAPV,EAOU,WAAY,EAPtB,EAOsB,aAPtB,kBASS,EACH,CAAE,OAAQ,aAAc,aAAc,aAAW,IACjD,CAAE,OAAQ,iBAXhB,gD,8EA3YA,SAAa,GACL,MAAW,IAAI,EAAsB,GAE3C,MAA+B,gBAAxB,EAAW,SACd,IAAI,EAAkC,GACtC,I,gDAqBN,WACE,EACA,GAFF,2EAIS,EAJT,SAI2C,WAAS,EAAkB,GAJtE,iDAI+B,MAJ/B,4D,gEA3CF,0BA8aA,IAAM,EAAmB,SAAC,GAAD,OACvB,EAAO,KACL,YAAK,OACH,IAAI,iCACF,EAAM,MACN,OACA,aAAW,EAAM,MACjB,aAAW,EAAM,MACjB,aAAW,EAAM,OACjB,IAAI,QAAM,aAAW,EAAM,aAAc,aAAW,EAAM,wBAe5D,E,WAOJ,WAAY,GAA+B,UACzC,IAAM,EAAQ,IAAI,0BAAwB,GAE1C,KAAK,MAAQ,EACb,KAAK,WAAa,EAAS,WAC3B,KAAK,UAAY,E,mCAGX,SAAU,GAChB,OACG,QACsB,IAAvB,EAAU,UACV,EAAU,WAAa,KAAK,MAAM,MAAM,W,sBAIpC,SAAS,EAAkB,GACjC,OACE,KAAK,UAAU,UACF,IAAZ,GAAyB,IAAY,KAAK,MAAM,WAAW,e,0BAIxD,SAAa,EAAkB,GACrC,OACE,KAAK,UAAU,UACF,IAAZ,GAAyB,IAAY,KAAK,MAAM,WAAW,e,sBAIhE,SAAS,GACP,YAAiB,IAAV,GAAiC,gBAAV,I,8DAGhC,WAA4B,GAA5B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,mBACjB,KAAK,UAAU,sBAAsB,IAH3C,gD,4HAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,0BACjB,KAAK,UAAU,6BAA6B,EAAS,IAN3D,gD,0GASA,WAAe,EAAkB,GAAjC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,MACjB,KAAK,UAAU,SAAS,EAAS,IAHvC,gD,mHAMA,WAAwB,GAAxB,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,eACjB,KAAK,UAAU,kBAAkB,IAHvC,gD,wGAMA,WAAe,GAAf,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,MAAQ,KAAK,UAAU,SAAS,IADtF,gD,wGAIA,WAAe,GAAf,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,MAAQ,KAAK,UAAU,SAAS,IADtF,gD,mHAIA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,iBACjB,KAAK,UAAU,oBAAoB,EAAS,IANlD,gD,qIASA,WAA0C,GAA1C,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,iCACjB,KAAK,UAAU,oCAAoC,IAHzD,gD,sHAMA,WAA6B,GAA7B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,oBACjB,KAAK,UAAU,uBAAuB,IAH5C,gD,8GAMA,WAAqB,EAAkB,GAAvC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,YACjB,KAAK,UAAU,eAAe,EAAS,IAH7C,gD,gHAMA,WAAqB,EAAkB,GAAvC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,YACjB,KAAK,UAAU,eAAe,EAAS,IAH7C,gD,oHAMA,WAAyB,EAAkB,GAA3C,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,gBACjB,KAAK,UAAU,mBAAmB,EAAS,IAHjD,gD,sHAMA,WAA2B,EAAkB,GAA7C,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,kBACjB,KAAK,UAAU,qBAAqB,EAAS,IAHnD,gD,uIAMA,WAA4C,GAA5C,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,mCACjB,KAAK,UAAU,sCAAsC,IAH3D,gD,uHAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,qBACjB,KAAK,UAAU,wBAAwB,EAAS,IANtD,gD,yHASA,WAA8B,GAA9B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,qBACjB,KAAK,UAAU,wBAAwB,IAH7C,gD,4HAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,0BACjB,KAAK,UAAU,6BAA6B,EAAS,IAN3D,gD,6HASA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,yBACjB,KAAK,UAAU,4BAA4B,EAAS,IAN1D,gD,oHASA,WAAyB,GAAzB,wFACS,KAAK,UAAU,CAAE,aACpB,KAAK,MAAM,MAAM,eACjB,KAAK,UAAU,mBAAmB,IAHxC,gD,+GAMA,WACE,GADF,wFAGS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,aACjB,KAAK,UAAU,gBAAgB,IALrC,gD,uGAQA,WAAc,GAAd,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,KAAO,KAAK,UAAU,QAAQ,IADpF,gD,4GAIA,WAAmB,EAAkB,GAArC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,UACjB,KAAK,UAAU,aAAa,EAAS,IAH3C,gD,oHAMA,WAAyB,GAAzB,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,gBACjB,KAAK,UAAU,mBAAmB,IAHxC,gD,iHAMA,WACE,EACA,GAFF,wFAIS,KAAK,aAAa,EAAS,GAC9B,KAAK,MAAM,MAAM,SACjB,KAAK,UAAU,kBAAkB,EAAS,IANhD,gD,gFAgBA,SAAU,EAA4B,GACpC,OAAO,KAAK,UAAU,UAAU,EAAQ,K,4BAG1C,WACE,MAAM,IAAI,MAAM,6B,6BAGlB,WACE,MAAM,IAAI,MAAM,6B,8DAGlB,WACE,MAAM,IAAI,MAAM,+B,gMCpvBpB,YAEA,OAWA,QAEA,QAyCa,E,8BAMT,SAAF,EAAY,GAA+B,wBACrC,EAAJ,cAEK,WAAa,EAAS,WACvB,EAAC,UAAY,EACb,EAAC,UAAY,eAAa,EAAS,YALE,E,0FAQnC,WACN,GADM,qFAGuB,KAAK,UAAU,UAC1C,CAAE,MAAO,EAAG,SAAU,2BAA4B,sBAAsB,GACxE,GALI,UAQwB,KALxB,EAHA,QAQa,OARb,yCASG,IAAI,iCAA+B,cAAa,gBATnD,gCAYC,EAAe,IAZhB,gD,oGAeA,WACN,GADM,4FAG+B,KAAK,WAAlC,EAHF,EAGE,YAAa,EAHf,EAGe,YAHf,SAUI,sBACR,eAAgB,KAAK,UAAU,mBAAmB,GAClD,aAAc,KAAK,UAAU,gBAAgB,CAAE,aAC/C,uBAAwB,KAAK,UAAU,iDAAiD,CACtF,aAGF,MAAO,KAAK,UAAU,SAAS,CAAE,aACjC,eAAgB,KAAK,UAAU,kBAAkB,CAAE,aACnD,mBAAoB,KAAK,UAAU,sBAAsB,CAAE,aAC3D,MAAO,KAAK,UAAU,SAAS,CAAE,aACjC,oBAAqB,KAAK,UAAU,uBAAuB,CAAE,aAC7D,gBAAiB,KAAK,UAAU,mBAAmB,CAAE,aACrD,mCAAoC,KAAK,sCAAsC,CAAE,aACjF,qBAAsB,KAAK,UAAU,wBAAwB,CAAE,aAC/D,iCAAkC,KAAK,UAAU,oCAAoC,CACnF,aAGF,SAAU,EACN,KAAK,UAAU,kBAAkB,EAAa,CAAE,aAChD,CAAE,OAAQ,iBAEV,EACA,CACE,eAAgB,KAAK,UAAU,WAAW,EAAa,GAAU,KAAK,cACtE,YAAa,KAAK,UAAU,eAAe,EAAa,CAAE,aAC1D,YAAa,KAAK,UAAU,eAAe,EAAa,CAAE,aAC1D,gBAAiB,KAAK,UAAU,mBAAmB,EAAa,CAAE,aAClE,kBAAmB,KAAK,UAAU,qBAAqB,EAAa,CAAE,aACtE,qBAAsB,KAAK,UAAU,wBAAwB,EAAa,CAAE,aAC5E,0BAA2B,KAAK,UAAU,6BAA6B,EAAa,CAClF,aAEF,yBAA0B,KAAK,UAAU,4BAA4B,EAAa,CAChF,aAEF,0BAA2B,KAAK,UAAU,6BAA6B,EAAa,CAClF,aAEF,iBAAkB,KAAK,UAAU,oBAAoB,EAAa,CAAE,aACpE,UAAW,KAAK,UAAU,aAAa,EAAa,CAAE,aACtD,YAAa,KAAK,UAAU,kBAAkB,EAAa,CAAE,cAE/D,CACE,eAAgB,UAAQ,KACxB,YAAa,UAAQ,KACrB,YAAa,UAAQ,KACrB,gBAAiB,UAAQ,KACzB,kBAAmB,UAAQ,KAC3B,qBAAsB,UAAQ,KAC9B,0BAA2B,UAAQ,KACnC,yBAA0B,UAAQ,KAClC,0BAA2B,IAAI,iCAC7B,cACA,eAEF,iBAAkB,IAAI,mBACpB,UAAQ,KACR,UAAQ,KACR,UAAQ,KACR,UAAQ,KACR,eAEF,UAAW,IAAI,YACf,YAAa,CAAE,OAAQ,mBA3EzB,uBAMJ,EANI,EAMJ,eACA,EAPI,EAOJ,aACA,EARI,EAQJ,uBACG,EATC,kFA+EC,QAEA,GAFA,IAGH,kBAAmB,EAAa,GAAgB,GAChD,mCAAoC,EAAuB,KAE7D,CACE,WACA,iBACA,kBAxFE,gD,6EA8FE,WAAQ,WAChB,KAAK,OAAO,MAAK,YACV,EAAK,SACR,EAAK,MAAL,QAAI,EAAU,OAIlB,IAAM,EAAa,2BAAG,WAAO,GAAP,qFACA,EAAK,KAAK,GADV,OACd,EADc,OAGhB,EAAK,QACP,EAAK,QAAL,QAAI,EAAY,IAEhB,EAAK,MAAL,QAAI,EAAU,IANI,2CAAH,sDAYnB,OAFA,KAAK,UAAU,GAAG,QAAS,GAEpB,WACL,EAAK,UAAU,IAAI,QAAS,M,0BAKtB,SACR,EACA,G,UAEA,MAAO,CACL,SAA8B,QAAtB,EAAE,EAAY,gBAAQ,QAAI,EAAS,SAC3C,eAA0C,QAA5B,EAAE,EAAY,sBAAc,QAAI,EAAS,eACvD,aAAsC,QAA1B,EAAE,EAAY,oBAAY,QAAI,EAAS,kB,GA3JZ,gBAA7C,6B,0ICqDU,G,6UA7GV,eAGA,QAEA,OAGA,OAqCA,QAOA,QACA,SACA,SAGM,EAAe,SAAC,EAAc,GAAf,OAAmC,OAAD,QAAC,IAAD,OAAC,EAAD,EAAG,GAAG,IAAK,EAAI,GAIzD,uBAAuB,GAEpC,IA0DY,EA1DN,EAAwC,UAAQ,KAAK,MACrD,EAAyC,UAAQ,KAAK,MAGtD,EAAY,aAEZ,EAAU,SAAU,EAAgB,GAA1B,OAA6C,SAAC,GAAD,OAAU,EAAE,EAAE,MAErE,EAAK,SAAI,GAAJ,OAAa,GAIlB,EAA0B,eAAC,EAAD,uDAA6B,GAA7B,OAAoC,SAAC,GAAD,OAClE,EAAI,IAAI,IAAQ,KAAO,KAAK,KAAK,KAAK,KAAK,EAA4B,OAInE,EAAkC,SAAC,GAAD,OAAoB,EAAI,IAAI,MAE9D,EAAwB,SAAC,GAAD,OAAoB,EAAI,IAAI,MAEpD,EAA+B,SAAC,GAAD,OAAoB,EAAI,IAAI,MAyBjE,SAAU,EAAe,GAAvB,IAAF,EAAE,OAAF,oBAAI,OAAJ,6BACE,UAAO,OAAO,UAAU,IAAwB,EAAsB,GADxE,WAGS,EAHT,gBAKI,OADM,EAAiB,KAAK,IAAI,EANJ,MAEhC,SAKU,EALV,OAOI,GAAuB,EAP3B,uDAYA,SAAY,GACR,EAAF,wCACE,EAAF,kCACE,EAAF,gCACE,EAAF,gCAJF,CAAY,wCAAe,KAO3B,IAAM,EAA2C,CAC/C,EAAgB,sBAChB,EAAgB,qBAChB,EAAgB,sBAwBZ,EAAU,SAAsB,EAAM,GAA5B,OAAqE,KAAK,GAQpF,EAA6B,SAAC,GAAD,OACjC,EAAQ,EAAO,SACf,EAAM,OAAS,YAAU,sBACzB,EAAQ,EAAO,WACf,EAA8B,SAAS,EAAM,SAOlC,E,8BAKT,SAAF,EAAY,GAAsC,uBAC5C,EAAJ,QAAO,EAAS,SAAW,EAAgB,uBAEvC,EAAJ,kCAAqB,EAAS,UACzB,KAAO,4BACZ,EAAK,sBAAwB,EAAS,QACtC,EAAK,SAAW,EANgC,E,YALC,QAArD,oC,IAuBa,E,WAUX,WACE,EACA,EACA,GAAkD,UAElD,KAAK,mBAAqB,EAC1B,KAAK,YAAc,EACnB,KAAK,OAAS,E,sCAGR,SAAa,GAA2C,WAC9D,OAAO,EACH,EAAW,OACT,qBAAmB,EAAY,KAAK,OAAO,IAAa,kBACtD,eAAa,EAAY,gBAAc,EAAK,iBAE9C,iBAAe,GACjB,oB,2DAGE,WAAyB,GAAzB,wFAES,KAAK,mBAAmB,KAAK,GAFtC,6EAIA,gBAAiB,OAJjB,oBAtEwB,EA2EE,MA1ElC,EAAQ,EAAO,SACf,EAAM,OAAS,YAAU,iBACzB,EAAQ,EAAO,WACf,EAAM,SAAW,EAAgB,mBAkEzB,0CAMO,KAAM,SANb,YASE,EAA0B,MAT5B,qBAUI,KAAM,UAVV,uBAWQ,IAAI,EAAJ,MAXR,iCAaS,KAAM,SAbf,qDAtEuB,IAAC,IAsExB,oB,0GAuBR,wFACS,KADT,SACiC,KAAK,mBAAmB,GADzD,iDACc,aADd,iE,6GAUA,aAAQ,IAAR,EAAQ,OAAR,oBAAU,OAAE,OAAZ,eAAc,KAAd,cACkB,KADlB,SAC0C,KAAK,qBADjC,KAAd,qBACQ,EADR,KACuB,aADvB,gBAGE,UAA0B,YAAnB,EAAQ,QAHjB,kBAIS,GAJK,KAAd,EAAc,IAAd,qC,6DA/DF,iCAuGA,IAAM,EAA4C,SAChD,EACA,G,QAKE,QAAuC,IAArC,EACE,MAAG,CACL,iBACiE,QADjD,EACM,OAApB,QAAoB,IAApB,OAAoB,EAApB,EAAsB,IAAI,UAAqC,QAAK,UAAQ,KACxE,kCAtPqC,IAwPxC,GACuC,kBAArC,GACqC,kBAArC,GACP,aAA4C,UAExC,MAAG,CACC,iBAAY,UAAQ,KAAK,GAC/B,kCA/P2C,IAiQxC,IACG,EAAwD,EAAxD,iBAAkB,EAAsC,EAAtC,kCAE1B,MAAO,CACL,sBACuB,IAArB,EACI,UAAQ,KAAK,GACkD,QAAhE,EAAqB,OAApB,QAAoB,IAApB,OAAoB,EAApB,EAAsB,IAAI,UAAqC,QAAK,UAAQ,KAElF,kCACmC,OAAjC,QAAiC,IAAjC,IA3QyC,KAwRpC,E,WA0BT,SAAF,EACE,EACA,EACA,EACA,GAAoB,UAEhB,KAAC,wBAA0B,EAC3B,KAAC,YAAc,EACf,KAAC,OAAS,OAEM,IAAhB,IACI,KAAD,YAAc,G,yDAKvB,wFACa,EADb,SAEU,iBAAe,KAAK,aAAa,gBAAgB,KAAK,yBAFhE,+BAGI,KAAK,YAHT,KAII,KAAK,OAJT,4F,6DA1CF,sC,IAwDa,E,8BAsBT,SAAF,EACE,EACA,EACA,EACA,EACA,GAEuC,oBAE/B,EAAiB,gBAAc,GAA/B,aAF+B,OAInC,EAAJ,YACE,EACA,GAEA,gBAAG,EAAH,EAAG,KAAH,OACE,EACG,cAAc,EAAM,cACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,SAAU,EAArB,EAAqB,QAAS,EAA9B,EAA8B,kBAAmB,EAAjD,EAAiD,qBAAjD,MAA+E,CAClF,oBAAqB,aAAW,GAChC,iBAAkB,aAAW,GAC7B,gBAAiB,aAAW,GAC5B,IAAK,aAAW,OACd,OAGL,oBAAsB,EACvB,EAAC,qBAAuB,EACxB,EAAC,YAAc,EAAqB,GAAG,GACvC,EAAC,gCAAkC,EAtBA,E,wDA0BzC,SACE,GAEM,IAAD,KAAK,gCACR,MAAM,IAAI,MACR,2GAKJ,OAAO,KAAK,gCAAgC,O,GAhEtC,GADV,8B,IAiFa,E,WAST,SAAF,EAAY,GAA+B,UACrC,KAAC,UAAY,E,gDAGX,SACN,GAEM,OAAC,IAAI,EACT,EACA,KAAK,UAAU,WACf,K,sCAII,SACN,EACA,EACA,GAAoB,IAEZ,EAAuB,gBAAc,KAAK,UAAU,YAApD,mBAEF,OAAC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KAAU,EACQ,EAChB,cAAc,EAAM,gBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,MAAO,EAAlB,EAAkB,MAAlB,OAAgC,IAAI,QAAM,aAAW,GAAQ,aAAW,OAFxE,EADI,YAKG,EACX,cAAc,EAAM,wBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,SAAX,OAA4B,aAAW,MAFvC,EALI,UASX,MAAO,CACL,SACA,WACU,IAAV,KAIJ,K,0DAII,WACN,GADM,kFAG4B,gBAAc,KAAK,UAAU,YAAvD,EAHF,EAGE,WAAY,EAHd,EAGc,UAHd,kBAKC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAgC,IAA7B,EAA6B,EAA7B,KAAY,EAAiB,EAAvB,KAAuB,EACV,EACjB,cAAc,EAAM,YACpB,QAAO,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,GAAjB,OAA4B,IAAS,GAAe,IAAO,iBAClE,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAHpC,EADuB,YAMD,EAC1B,cAAc,EAAM,aACpB,QAAO,qBAAG,KAAQ,MAAoB,KACtC,KAAI,gBAAW,EAAX,EAAG,KAAQ,QAAX,OAA2B,aAAW,MAHtC,EANuB,UAW9B,MAAO,CACL,OAAQ,EAAU,QAAU,CAAE,qBAAoB,aAAc,CAAE,2BArBlE,gD,qFA2BA,SACN,GAAmD,IAE3C,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAER,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KACK,EAAsB,EACzB,cAAc,EAAM,mBACpB,KAAI,qBAAG,KAAQ,aAHP,EAKM,EACd,cAAc,EAAM,eACpB,KACC,oBACE,KAAQ,EADV,EACU,qBAAsB,EADhC,EACgC,qBAAsB,EADtD,EACsD,gBAAiB,EADvE,EACuE,gBADvE,MAEO,CACL,0BAA2B,aAAW,GACtC,oBAAqB,aAAW,GAChC,gBAAiB,IAAI,QAAM,aAAW,GAAkB,aAAW,QARlE,EALI,UAiBX,UACE,uBACG,Q,yDAMH,SACN,GAAW,IAEH,EAAkB,gBAAc,KAAK,UAAU,YAA/C,cAFG,EAIc,EACtB,cAAc,EAAM,sBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,YAAX,OAA+B,aAAW,MAF1C,EAJI,YAQ0B,EAClC,cAAc,EAAM,oBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,UAAjB,MAAmC,CAAC,aAAW,GAAO,aAAW,OAV7D,qBAQH,EARG,KAQa,EARb,OAYU,EAClB,cAAc,EAAM,uBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAE3C,MAAO,CACL,WACA,iBACA,iBACA,WApBS,a,+CAwBL,SACN,GAAmD,WAEnD,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YACf,gBAAG,EAAH,EAAG,KAAH,OAAc,EAAK,4CAA4C,Q,wCAI3D,SACN,EACA,GAAmD,WAEnD,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,gBAAG,EAAH,EAAG,KAAH,cACK,EAAK,4CAA4C,IADtD,IAEE,gB,wEAKE,WACN,GADM,yFAG+B,gBAAc,KAAK,UAAU,YAA1D,EAHF,EAGE,cAAe,EAHjB,EAGiB,UAHjB,kBAKC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAgC,IAA7B,EAA6B,EAA7B,KAAY,EAAiB,EAAvB,KACD,EAAyB,EAAK,4CAA4C,GADlD,EAGP,EACpB,cAAc,EAAM,YACpB,QAAO,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,GAAjB,OAA4B,IAAS,EAAc,SAAW,IAAO,KAC5E,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAHpC,EAHuB,UAQ9B,cACK,GADL,IAEE,OAAQ,CAAE,eAAc,gBAAiB,EAAuB,eAAe,cAnB/E,gD,gGAyBA,SACN,GAAmD,WAE3C,EAAuB,gBAAc,KAAK,UAAU,YAApD,mBAER,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KAAU,EACQ,EAChB,cAAc,EAAM,gBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,MAAO,EAAlB,EAAkB,MAAlB,OAAgC,IAAI,QAAM,aAAW,GAAQ,aAAW,OAFxE,EADI,UAKX,cACK,EAAK,4CAA4C,IADtD,IAEE,kB,4EAMA,WACN,EACA,GAFM,gHAIgC,gBAAc,KAAK,UAAU,YAA3D,EAJF,EAIE,aAAc,EAJhB,EAIgB,YAJhB,SAKuB,KAAK,UAAU,oBALtC,UAKA,EALA,gDAQG,CAAC,cAAa,gBARjB,WAWF,EAAuB,SAXrB,6BAYI,cAZJ,UAYuB,EAAa,WAZpC,yEAeA,EAAsB,KAAK,KAAK,GAAK,KAAK,KAAK,IAf/C,EAgBiC,EAAe,GAhBhD,OAgBC,EAhBD,KAgBiB,EAhBjB,WAkBA,EAAoB,WAQxB,GARwB,IAEtB,EAFsB,EAEtB,iBACA,EAHsB,EAGtB,QAHsB,OAUxB,EACG,cAAc,EAAuB,IAAK,EAAgB,GAC1D,MAAK,gBAAG,EAAH,EAAG,iBAAqB,EAAxB,gCAAsC,CAC1C,mBACA,QAAO,YAAM,GAAN,CAAe,SAhCtB,UAmCoB,EAAa,QACrC,SAAC,EAAG,GAAJ,OAAuB,EAAE,MAAK,YAAK,OAAI,EAAkB,EAAO,QAChE,EAAkB,CAAE,iBAxnBE,KAAK,MAAM,KAAK,SAAW,OAAO,kBAwnBD,QAAS,IAAM,IArClE,wBAmCE,EAnCF,EAmCE,QAnCF,EAwCkB,EAAQ,QAAO,SAAC,EAAG,GAAJ,OAAW,EAAE,KAAK,GAAG,EAAE,MAAQ,EAAI,KAAlE,EAxCF,EAwCE,YAxCF,UA0CmB,EAAa,mBACpC,EAAuB,IACvB,EACA,GA7CI,6BA0CD,EA1CC,KA0CK,EA1CL,MAgDF,EAhDE,oBAoDA,IAAS,EApDT,kCAqDW,EAAa,QAAQ,GArDhC,QAqDF,EArDE,kCAsDO,IAAS,EAtDhB,kCAuDW,EAAa,QAAQ,GAvDhC,QAuDF,EAvDE,sBA6DF,IAAS,cACX,EAAO,EACE,IAAS,gBAClB,EAAO,GAhEH,kBAmEC,CAAC,EAAM,IAnER,iD,4GAsEA,WAAiB,EAAc,GAA/B,oEACF,aAAiB,kCADf,sBAEE,IAAI,MAAM,yCAFZ,gCAKC,KAAK,oCAAoC,EAAM,wBAAyB,IALzE,gD,sHAQA,WACN,GADM,kGAWkB,gBAAc,KAAK,UAAU,YAA7C,EAXF,EAWE,YAXF,SAYc,KAAK,UAAU,WAZ7B,cAYA,EAZA,gBAkBI,EAAY,mBAAmB,EAAO,IAAK,EAAM,IAAK,wBAlB1D,mBAeJ,EAfI,EAeJ,oBACA,EAhBI,EAgBJ,0BACA,EAjBI,EAiBJ,qBAME,EAA0B,SAvBxB,sBAwBF,CAAC,cAAa,eAxBZ,yCAyBI,KAAK,oCACT,aAAW,IA1BX,mDAqBJ,EArBI,KAsBJ,EAtBI,uBA8BC,CACL,aAAW,GACX,EACA,EACA,EACA,IAnCI,iD,yGAwCR,WACE,EACA,EACA,GAHF,8IAKiC,gBAAc,KAAK,UAAU,YAApD,EALV,EAKU,mBAEF,EAAmB,0BAAwB,GACzC,EAAkC,EAAlC,kBAAmB,EAAe,EAAf,WAR7B,SAUqD,QAAQ,IAAI,CAC7D,KAAK,UAAU,kBACf,KAAK,UAAU,qBACf,KAAK,UAAU,WACf,KAAK,UAAU,aAdnB,gCAUS,EAVT,KAUe,EAVf,KAU+B,EAV/B,KAUsC,EAVtC,KAiBQ,EAAe,EAAM,+BAA+B,GAKpD,GAHA,EAAqB,SAAC,GAAD,OACzB,EAAK,EAAiB,EAAS,GAAc,kBAEC,GAC1C,EAAW,QAAM,OAAO,EAAkB,GAvBlD,UAwBsB,KAAK,WAAW,GAxBtC,WAwBQ,EAxBR,SA6BM,EACF,EACA,GAJA,EA3BJ,EA2BI,iBACA,EA5BJ,EA4BI,kCAMI,EAAW,SAAC,GAAD,OACf,EAAiB,IACjB,EAAW,KAFI,SAGZ,GAHY,IAIb,MAAO,EAAkB,KAAQ,WAKT,KAAf,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,UA3CjB,oBA4CU,EAAuB,EAAmB,GAAK,GAC/C,EAAe,QAAM,OAAO,EAAkB,GA7CxD,EA8CsD,QAAM,SACtD,EACA,GAFkB,EA9CxB,EA8CY,YAKJ,EAAa,KAAK,GAAG,qBAnD7B,uBAoDY,IAAI,MACR,wCAAiC,oBAAjC,sBACY,EADZ,aArDR,yBA0DqC,QAAQ,IAAI,EAC3C,IAAmB,aAAY,UAA/B,UAA4C,EAAS,MACrD,IAAmB,aAAY,UAA/B,UAA4C,EAAS,OA5D3D,0BA0DW,EA1DX,KA0DmB,EA1DnB,KA+DU,EAAW,EAAwB,EAAxB,CACf,EAAa,EAAgC,GAAS,IAGxD,EAAc,EAAS,IAAI,GAAQ,WACnC,EAAS,OAAQ,GAAR,IAAmB,aApEhC,oBAuES,KAvET,KAwEI,EAxEJ,WAyEU,IAAmB,qBAAoB,UAAvC,UAAoD,EAAS,KAzEvE,gCA0EI,EA1EJ,uBAuEc,yBAvEd,4E,8GA+EA,WACE,GADF,gFAGiC,gBAAc,KAAK,UAAU,YAApD,EAHV,EAGU,mBAHV,KAKS,KALT,SAMU,EAAmB,oBAAoB,WAAvC,KAAuD,GAAa,GAN9E,iDAKc,kBALd,iE,sFAWA,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,kBAAmB,QAAU,EAAW,K,gCAIpE,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,mBAAoB,QAAU,EAAW,K,wBAIrE,SACE,EACA,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,WAAY,GAAU,EAAkB,K,uBAIpE,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,UAAW,QAAU,EAAW,K,oDAI5D,WACE,EACA,EACA,GAHF,4IAKQ,EAAU,kBAAgB,KAAK,UAAU,WAAY,GAL7D,EAMiC,gBAAc,KAAK,UAAU,YAApD,EANV,EAMU,mBAEF,EAAmB,4BAA0B,GAC3C,EAAiE,EAAjE,kBAAmB,EAA8C,EAA9C,mBAAoB,EAA0B,EAA1B,WAAY,EAAc,EAAd,UAT7D,SAWiC,QAAQ,IAAI,CACzC,KAAK,UAAU,SAAS,GACxB,GACE,mBAAiB,CACf,KAAM,KAAK,UAAU,kBACrB,eAAgB,KAAK,UAAU,qBAC/B,MAAO,KAAK,UAAU,WACtB,MAAO,KAAK,UAAU,eAlB9B,gCAWS,EAXT,KAWgB,EAXhB,KA8BQ,GARA,EAAqB,SAAC,GAAD,OAClB,OAAP,QAAO,IAAP,OAAO,EAAP,EACI,KACA,EAAQ,eAAiB,EACzB,EAAQ,MAAM,+BAA+B,EAAQ,QAEtD,kBAE2C,GAC1C,EAAgB,EAAM,OAAO,EAAkB,GA/BvD,UAgCsB,KAAK,WAAW,EAAe,GAhCrD,WAgCQ,EAhCR,SAqCM,EACF,EACA,GAJA,EAnCJ,EAmCI,iBACA,EApCJ,EAoCI,kCAMI,EAAW,SAAC,G,MAA4E,OAC5F,EAAiB,KACE,OAAlB,QAAkB,IAAlB,IAAsB,UAAQ,MAAM,KACb,QAAxB,EAAW,OAAV,QAAU,IAAV,IAAc,SAAS,QAAI,UAAQ,MAAM,MACxC,GAJ0F,SAKzF,GALyF,IAM1F,MAAwB,OAAjB,QAAiB,IAAjB,OAAiB,EAAjB,EAAmB,KAAQ,WAKV,KAAf,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,UArDjB,oBAsDU,EAAuB,EAAmB,GAAK,GAC/C,EAAe,EAAM,OAAO,EAAkB,GAvDxD,EAwDsD,EAAM,SACtD,EACA,GAFkB,EAxDxB,EAwDY,YAKJ,EAAa,KAAK,GAAG,qBA7D7B,uBA8DY,IAAI,MACR,wCAAiC,oBAAjC,sBACY,EADZ,aA/DR,yBAoEqC,QAAQ,IAAI,EAC3C,IAAmB,aAAY,YAA/B,UAA8C,EAAS,KACvD,IACE,IAAmB,aAAY,YAA/B,UAA8C,EAAS,OAvE/D,0BAoEW,EApEX,KAoEmB,EApEnB,KA0EQ,EAAW,EAAa,EAAgC,GAAS,GAEjE,IACF,EAAW,EAAwB,EAAxB,CAA2D,IAGxE,EAAc,EAAS,IAAI,GAAQ,WACnC,EAAS,OAAQ,GAAR,IAAmB,aAjFhC,oBAoFS,KApFT,KAqFI,EArFJ,WAsFU,IAAmB,qBAAoB,YAAvC,UAAsD,EAAS,KAtFzE,gCAuFI,EAvFJ,uBAoFc,yBApFd,4E,0HA4FA,WACE,GADF,gFAGiC,gBAAc,KAAK,UAAU,YAApD,EAHV,EAGU,mBAHV,KAKS,KALT,SAMU,EAAmB,oBAAoB,gBAAvC,KAA4D,GAAa,GANnF,iDAKc,uBALd,iE,wGAWA,WACE,EACA,GAFF,4EAIwB,gBAAc,KAAK,UAAU,YAA3C,EAJV,EAIU,UAEH,sBAAoB,GAN3B,sBAOU,IAAI,MAAM,wDAPpB,mBAUS,KAVT,SAWU,EAAU,oBAAoB,SAA9B,KAA4C,GAAa,EAAI,UAAQ,KAAK,GAAO,KAX3F,iDAUc,uBAVd,iE,2GAgBA,WACE,EACA,GAFF,4EAI2B,gBAAc,KAAK,UAAU,YAA9C,EAJV,EAIU,cAEJ,MAAM,QAAQ,GANpB,4BAOW,KAPX,SAQY,EAAa,oBAAoB,qBAAjC,KACC,GACL,EACA,GAXR,iDAOgB,iBAPhB,oCAeW,KAfX,UAgBY,EAAa,oBAAoB,UAAjC,KACC,GACL,EACA,GAnBR,kDAegB,iBAfhB,kE,+GA0BA,WACE,EACA,GAFF,gFAI2B,gBAAc,KAAK,UAAU,YAA9C,EAJV,EAIU,aAJV,KAMS,KANT,SAOU,EAAa,oBAAoB,gBAAjC,KACC,GACL,EACA,GAVN,iDAMc,iBANd,iE,4HAgBA,WACE,EACA,EACA,GAHF,oFAK4B,gBAAc,KAAK,UAAU,YAA/C,EALV,EAKU,cACF,EAAc,UAAQ,KAAK,GANnC,KAQS,KART,KASI,CAAE,eATN,SAUU,EAAc,oBAAoB,YAAlC,KACC,GACL,EACA,EAAY,IACwC,QADrC,EACJ,OAAX,QAAW,IAAX,IAAe,KAAK,UAAU,WAAW,mBAAW,QAAI,eAd9D,iDAQc,2BARd,sE,iIAoBA,WACE,EACA,GAFF,gFAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,KAMS,KANT,SAOU,EAAc,oBAAoB,eAAlC,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,gCANd,iE,gIAgBA,WACE,GADF,gFAG4B,gBAAc,KAAK,UAAU,YAA/C,EAHV,EAGU,cAHV,KAKS,KALT,SAMU,EAAc,oBAAoB,eAAlC,KACC,GACL,EACA,UAAQ,KAAK,KATnB,iDAKc,kCALd,iE,6HAeA,WACE,GADF,4FAGQ,EAAU,kBAAgB,KAAK,UAAU,WAAY,GAH7D,EAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,SAMiD,QAAQ,IAAI,CACzD,KAAK,UAAU,SAAS,GACxB,KAAK,UAAU,oBAAoB,KARvC,gCAMS,EANT,KAMuB,EANvB,KAWQ,EAAa,EAAa,cAAc,EAAiB,gBAXjE,KAaS,KAbT,MAcU,IAAc,qBAAoB,uBAd5C,kBAeW,GACL,EAAQ,EAAiC,IAhB/C,iBAiBgB,KAAK,WAAW,EAAY,GAjB5C,4KAac,4BAbd,kE,wGAuBA,WACE,EACA,EACA,GAHF,gFAKwB,gBAAc,KAAK,UAAU,YAA3C,EALV,EAKU,UALV,KAOS,KAPT,SAQU,EAAU,oBAAoB,SAA9B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAZ3B,iDAOc,uBAPd,iE,4GAkBA,WACE,EACA,EACA,GAHF,gFAKwB,gBAAc,KAAK,UAAU,YAA3C,EALV,EAKU,UALV,KAOS,KAPT,SAQU,EAAU,oBAAoB,SAA9B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAZ3B,iDAOc,uBAPd,iE,8GAkBA,WACE,EACA,EACA,GAHF,6GAK2B,gBAAc,KAAK,UAAU,YAA9C,EALV,EAKU,aACF,EAAsB,UAAQ,KAAK,GAN3C,SAYY,QAAQ,IAAI,CACpB,KAAK,UAAU,UACf,KAAK,UAAU,WACf,KAAK,qBAAqB,KAf9B,4BASI,EATJ,KAUI,EAVJ,eAWK,EAXL,KAWsB,EAXtB,KAW8C,EAX9C,YAkBM,EAAgB,OAlBtB,uBAmBU,IAAI,MAAJ,6DACkD,wBADlD,MAnBV,eAwBQ,EAA2B,SAAC,GAAD,OAC/B,UAAQ,IACN,EAAK,eAAe,EAAO,IAAI,EAAM,OAAO,IAAI,GAChD,UAAQ,MAGN,EA9BR,2BA8B6B,WACzB,EACA,GAFyB,8FAGzB,EAHyB,+BAGE,EAC3B,EAJyB,+BAIsB,CAAC,cAAa,cAAa,GAEpE,OACkB,IAAtB,EACI,UAAQ,KAAK,GACb,EAAyB,GATN,KAWd,EAXc,UAYjB,IAAa,qBAAoB,iBAAjC,cACC,GACL,IACA,EAAgB,IAChB,GAJI,SAKD,GALC,CAMJ,uBACA,EAA2B,OAnBN,+BAsBvB,EAAK,UAAU,WAtBQ,KAuBvB,EAvBuB,KAwBvB,EAxBuB,KA0BvB,EAAgB,GAAG,GACf,YAAoB,OAClB,EACE,EAAgB,IAAI,yBACA,OAApB,QAAoB,IAApB,IAAwB,SAE5B,EAhCmB,kGA9B7B,0EAkES,EAAmB,EAAqB,EAAmB,EAAiB,IAlErF,iD,6GAsEA,WACE,EACA,GAFF,gFAI0B,gBAAc,KAAK,UAAU,YAA7C,EAJV,EAIU,YAJV,KAMS,KANT,SAOU,EAAY,oBAAoB,MAAhC,KAA2C,GAAa,EAAI,UAAQ,KAAK,GAAQ,KAP3F,iDAMc,uBANd,iE,6GAYA,WACE,EACA,GAFF,gFAI0B,gBAAc,KAAK,UAAU,YAA7C,EAJV,EAIU,YAJV,KAMS,KANT,SAOU,EAAY,oBAAoB,QAAhC,KAA6C,GAAa,EAAI,UAAQ,KAAK,GAAQ,KAP7F,iDAMc,uBANd,iE,+FAYA,SACE,GAEA,OAAO,KAAK,YAAY,UAAQ,KAAM,K,yDAIxC,WACE,EACA,GAFF,gFAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,KAMS,KANT,SAOU,EAAc,oBAAoB,iBAAlC,KACC,GACL,EACA,UAAQ,KAAK,GAAc,KAVjC,iDAMc,uBANd,iE,+GAgBA,WACE,EACA,EACA,GAHF,0EAKS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,WAAY,IALzD,EAMuB,gBAAc,KAAK,UAAU,YAA1C,EANV,EAMU,SAEH,kBAAgB,GARvB,sBASU,IAAI,MAAM,6DATpB,mBAYS,KAZT,SAaU,EAAS,oBAAoB,KAA7B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAjB3B,iDAYc,uBAZd,iE,oHAuBA,WACE,EACA,GAFF,kFAIgC,gBAAc,KAAK,UAAU,YAAnD,EAJV,EAIU,SAAU,EAJpB,EAIoB,QAJpB,KAMS,KANT,SAOU,EAAS,oBAAoB,QAA7B,KACC,GACL,EACA,EAAQ,QACR,UAAQ,KAAc,OAAT,QAAS,IAAT,IAAa,UAAQ,UAAU,KAXlD,iDAMc,uBANd,iE,gHAiBA,WACE,EACA,GAFF,gFAIsB,gBAAc,KAAK,UAAU,YAAzC,EAJV,EAIU,QAJV,KAMS,KANT,SAOU,EAAQ,oBAAoB,MAA5B,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,uBANd,iE,kHAgBA,WACE,EACA,GAFF,gFAIsB,gBAAc,KAAK,UAAU,YAAzC,EAJV,EAIU,QAJV,KAMS,KANT,SAOU,EAAQ,oBAAoB,SAA5B,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,uBANd,iE,uIAgBA,WACE,GADF,gFAGsB,gBAAc,KAAK,UAAU,YAAzC,EAHV,EAGU,QAHV,KAKS,KALT,SAMU,EAAQ,oBAAoB,YAA5B,KAA6C,GAAa,GANpE,iDAKc,uBALd,iE,mHAWA,WACE,GADF,gFAGsB,gBAAc,KAAK,UAAU,YAAzC,EAHV,EAGU,QAHV,KAKS,KALT,SAMU,EAAQ,oBAAoB,iBAA5B,KACC,GACL,GARN,iDAKc,uBALd,iE,8DA55BF,8B,gJCtcA,IAAM,EAAkB,SAAI,GAAJ,OAAiD,EAAG,QAO/D,E,WAIT,SAAF,EAAY,GAAqC,UAC/C,KAAK,UAAY,E,8DAInB,WACE,EACA,EACA,GAHF,wFAKS,KAAK,UACT,UAAU,EAAQ,EAAkC,GACpD,KAAK,IAPV,gD,mFAWA,SACE,GAEA,OAAO,KAAK,UAAU,WAAW,GAAW,KAAK,K,yBAInD,SACE,EACA,EACA,GAEA,OAAO,KAAK,UACT,YAAY,EAAQ,EAAkC,GACtD,KAAK,K,+BAIV,SACE,EACA,GAEA,OAAO,KAAK,UAAU,kBAAkB,EAAQ,GAAW,KAAK,K,gCAIlE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,mBAAmB,EAAQ,GAAW,KAAK,K,wBAInE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,WAAW,EAAQ,EAAkB,GAAW,KAAK,K,uBAI7E,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAQ,GAAW,KAAK,K,sBAI1D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAO,GAAW,KAAK,K,uBAIxD,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAS,GAAW,KAAK,K,2BAI3D,SACE,EACA,GAEA,OAAO,KAAK,UACT,cAAc,EAAkC,GAChD,KAAK,K,wCAIV,SACE,EACA,EACA,GAEA,OAAO,KAAK,UACT,2BAA2B,EAAQ,EAAa,GAChD,KAAK,K,2CAIV,SACE,EACA,GAEA,OAAO,KAAK,UAAU,8BAA8B,EAAQ,GAAW,KAAK,K,4CAI9E,SACE,GAEA,OAAO,KAAK,UAAU,+BAA+B,GAAW,KAAK,K,2CAIvE,SACE,GAEA,OAAO,KAAK,UAAU,8BAA8B,GAAW,KAAK,K,sBAItE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAW,EAAQ,GAAW,KAAK,K,sBAIpE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAW,EAAQ,GAAW,KAAK,K,wBAIpE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,WAAW,EAAQ,EAAmB,GAAW,KAAK,K,oCAI9E,SACE,GAEA,OAAO,KAAK,UAAU,uBAAuB,GAAW,KAAK,K,uBAI/D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAQ,GAAW,KAAK,K,yBAI1D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,YAAY,EAAQ,GAAW,KAAK,K,sCAI5D,SACE,GAEA,OAAO,KAAK,UAAU,yBAAyB,GAAW,KAAK,K,8BAIjE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAc,GAAW,KAAK,K,2BAIvE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,cAAc,EAAQ,EAAS,GAAW,KAAK,K,8BAIvE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAW,GAAW,KAAK,K,4BAIpE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,eAAe,EAAQ,GAAW,KAAK,K,8BAI/D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAQ,GAAW,KAAK,K,mDAIjE,SACE,GAEA,OAAO,KAAK,UAAU,sCAAsC,GAAW,KAAK,K,iCAI9E,SACE,GAEA,OAAO,KAAK,UAAU,oBAAoB,GAAW,KAAK,O,KA9O9D,2B,yqBClCA,IAAI,EAAJ,QAEa,sBAAsB,qBAAwC,GAO9D,uBAA4D,YAIpE,IAHH,EAGG,EAHH,MACA,EAEG,EAFH,OACA,EACG,EADH,SACG,EACmC,aADnC,SACI,EADJ,KACiB,EADjB,KAcD,OAXA,EAAF,WAAU,WACR,EAAM,SAAW,kBAAM,EAAe,IACtC,IAAM,EAAO,EAAM,QAEnB,OAAO,WACL,EAAM,cAAW,EACjB,OAAe,GACf,OAED,CAAC,IAEC,EAIE,wBAAC,sBAAoB,SAAQ,CAAC,MAAO,GAAc,GAHjD,gDAAG,K,8FC3Bd,IAGM,EAAgB,SAAC,EAAkB,GACrC,IAAI,EAAQ,OAAO,KAAK,GACpB,EAAQ,OAAO,KAAK,GAE1B,OACE,EAAM,SAAW,EAAM,QACvB,EAAM,OAAM,YAAG,OATI,SAAC,EAAkB,GAAnB,OACrB,OAAO,UAAU,eAAe,KAAK,EAAG,GAQnB,CAAe,EAAG,IAAQ,OAAO,GAAG,EAAE,GAAM,EAAE,QAI/D,EAAW,SAAC,GAAD,OAA0C,OAAN,GAA2B,kBAAN,GAE7D,SAAS,SAAC,EAAY,GAAb,OACpB,EAAS,IAAM,EAAS,GAAK,EAAc,EAAG,GAAK,OAAO,GAAG,EAAG,K,6QClBlE,YAKA,SACA,OAEA,SAEM,EAAmB,CACrB,EAAC,6CACD,EAAC,6CACH,EAAG,6CACH,EAAG,6CACH,GAAI,8CAMA,EAAe,CACnB,CACI,KAAI,WACJ,KAAI,YACJ,gBAAe,aACf,UAAQ,EACR,SAAO,EAEP,OAAM,CACN,CACM,WAAQ,CACV,CACE,KAAM,SACN,KAAM,WAER,CACE,KAAM,WACN,KAAM,UAGN,KAAE,QACF,KAAE,YAIR,QAAO,CACP,CACE,KAAM,cACN,KAAM,WAER,CACE,KAAM,aACN,KAAM,aAKZ,CACI,KAAI,WACJ,KAAI,gBACJ,gBAAe,OACf,UAAQ,EACR,SAAO,EAEP,OAAM,CACN,CACE,KAAM,OACN,KAAM,YAIV,QAAS,CACP,CACE,KAAM,UACN,KAAM,cAsDR,EAAgB,SAAC,GAAD,YACC,IAArB,EAAQ,eAA+C,IAArB,EAAQ,eAA4C,IAAlB,EAAQ,OAExE,EAAc,SAAC,EAAqC,GAAtC,OAClB,EAAQ,KAAO,GACS,kBAAjB,EAAQ,MACf,EAAQ,KAAK,WAAW,eAOpB,EAA0B,GAEnB,oBAAoB,SAAC,GAAD,OAC/B,EAAiB,MAAK,YAAe,OAAI,aAAoB,MAElD,UAAU,SAAiD,GACpE,IAAI,EAAe,8BAAG,qC,2BACtB,gBAAkB,GAEZ,EAAN,SAAW,EAGL,EAAN,SArCoC,CAAE,MAAO,GAAI,UAAW,IAuCtD,EAAN,sBAAwB,EAClB,EAAN,qBAAuB,EATD,EAAH,+BAYnB,WACE,OAAO,KAAK,UAbK,IAgBnB,SAAY,GACF,GAAJ,KAAK,WACP,MAAM,IAAI,MAAM,8BApJH,SAAC,GAAD,OACnB,KAAW,GAsJH,CAAa,KACf,KAAK,WAAa,IAAI,WAAS,EAAiB,GAAU,EAAc,OAGlE,KAAH,SAAW,IAzBC,uDA4BnB,+FACyC,KAAK,SAApC,EADV,EACU,MAAO,EADjB,EACiB,UAAW,EAD5B,EAC4B,SAC1B,KAAK,SA7D6B,CAAE,MAAO,GAAI,UAAW,IA2D5D,WAMM,EAAM,OAAS,GANrB,gCAOgB,KAAK,WAAY,WAAW,UAAU,EAAO,CAAE,aAAY,MAC/D,YAAC,OAAI,EAAE,cARnB,mGAU4B,CAAE,GAAI,EAAM,GAAG,OAAQ,KAAM,EAAM,GAAG,UAAY,GAV9E,wCAKU,EALV,KAYI,EAAU,SAAQ,WAAY,GAAZ,OAAkB,EAAlB,WAA0B,EAAQ,OAZxD,kDAcI,EAAU,SAAQ,mBAAgB,EAAhB,WAAsB,SAd5C,0DA5BmB,gFA8CnB,SAAa,GAAiB,WAQ5B,YAPwB,IAApB,KAAK,YACP,aAAa,KAAK,YAGpB,KAAK,SAAS,MAAM,KAAK,GACzB,KAAK,WAAa,YAAW,kBAAM,EAAK,mBAAkB,KAAK,iBAExD,IAAI,SAAQ,SAAC,EAAS,GAAV,OAAqB,EAAK,SAAS,UAAU,KAAK,CAAC,EAAS,SAtD9D,8CAyDnB,SAAiC,G,MAC/B,OACiC,IAA/B,KAAK,SAAS,MAAM,SACX,OAAR,QAAQ,IAAR,IAAY,aAAqC,QAAvB,EAAC,KAAK,SAAS,gBAAQ,QAAI,YA5DvC,6CAgEnB,WACE,EACA,GAFF,gFAIO,KAAK,WAJZ,iFAKsB,EAAS,IAL/B,OAOU,GAAM,IAAI,MAAO,eAEY,IAA/B,KAAK,sBACP,KAAK,sBAAwB,EAEG,EAAM,KAAK,uBAEZ,KAAS,KAAK,uBAO3C,KAAK,sBAAwB,EAC7B,KAAK,qBAAuB,EAC5B,KAAK,sBAAwB,GAvBrC,uBA4BoD,QAAQ,IAAI,CAC5D,oBAAkB,GAClB,IA9BJ,4BA4BS,EA5BT,KA4B0B,EA5B1B,MAkCI,EAAY,EAAiB,KAAK,WAAW,UAC5C,EAAc,KACf,KAAK,iCAAiC,GApC1C,wBAsCI,KAAK,uBAtCT,0DAwCsB,EAAiB,IAxCvC,eA0CI,KAAK,wBAE8B,IAA/B,KAAK,SAAS,MAAM,SACtB,KAAK,SAAS,SAAW,GA7C/B,kBAgDW,KAAK,aAAa,CAAE,OAAQ,EAAgB,GAAK,SAAU,EAAgB,QAhDtF,iDAhEmB,4GAoHnB,WACE,EACA,GAFF,iGAI0D,QAAQ,IAAI,CAAC,EAAe,IAJtF,4BAIS,EAJT,KAIgC,EAJhC,KAMO,YAAU,IAA2B,KAAK,WANjD,uFAO4B,EAAuB,IAPnD,wBAU0B,KAAK,WAAW,UAAU,cAAc,EAAuB,CACrF,SAAU,IAXd,iCAUS,EAVT,uBAcS,GAdT,iDApHmB,8DAAiB,GAwItC,OAFA,EAAiB,KAAK,GAEf,GAGI,wCAAwC,UAAQ,mC,uYC/R7D,eAEA,QAEA,SAuNM,EAAuB,SAC3B,EACA,GAF2B,MAGD,CAC1B,KAAM,kBACN,eACI,MAAJ,IAGI,EAAgB,SAAI,GAAJ,MAA0D,CAC9E,KAAM,WACF,OAAJ,IAGI,EAAe,SAAI,GAAJ,MAAwD,CAC3E,KAAM,UACN,WAGI,EAAkB,SACtB,EACA,GAFsB,MAGE,CACxB,KAAM,aACN,SACI,UAAJ,IAGI,EAAiB,SAAI,GAAJ,YACR,IAAb,EAAM,IASF,EAA8D,CAClE,oBACA,cAeF,IAaM,EAAa,yBAAK,EAAL,KAAQ,EAAR,WAA8C,CAAC,EAAG,UAAQ,KAAK,KAC5E,EAAU,6BAAwC,QAG3C,0BAA0B,SACrC,GAEE,IAAI,EAAiB,OAAO,QAAQ,GAAQ,OAAO,GAInD,OApCJ,SACE,GAEE,IAAI,EAAU,EACb,QAAO,YAAI,IAAF,EAAF,UAAI,OAAO,EAAsC,SAAS,MACjE,KAAI,YAAI,IAAF,EAAF,UAAI,MAAJ,WAAa,EAAb,QAEL,GAAE,EAAQ,OAAS,EACnB,MAAM,IAAI,MAAJ,wCAA2C,EAAQ,KAAK,MAAxD,iBAyBN,CAA4B,GArBO,SACrC,GAEE,IAAI,EAAS,OAAO,YAAY,GAC5B,EAAc,EAAyB,QAAO,YAAC,QAAM,KAAK,MAAS,KAAI,YAAC,iBAAQ,EAAR,QAE5E,GAAE,EAAY,OAAS,EACnB,MAAE,IAAI,MAAJ,wCAA2C,EAAY,KAAK,MAA5D,aAGN,OAAK,EAcA,CAFgB,EAAe,IAAI,KAK5C,IAAM,EAAkE,CACtE,oBACA,qBACA,aACA,aAeF,IAuCM,EAAmC,SACvC,GAEA,IAAM,EAAS,OAAO,YAAY,GAI5B,EA9CqB,YAGiE,IAF5F,EAE4F,EAF5F,kBACA,EAC4F,EAD5F,mBAEE,QAAwB,IAAtB,QAA0D,IAAvB,EACrC,MAAM,IAAI,MACR,yGAKF,YAAwB,IAAtB,EACK,CAAE,0BAGgB,IAAvB,EACK,CAAE,2BADT,EA+BuB,CAAqB,GACxC,EA3Be,YAGiE,IAFtF,EAEsF,EAFtF,WACA,EACsF,EADtF,UAEE,QAAiB,IAAf,QAA0C,IAAd,EAC9B,MAAM,IAAI,MACR,yFAIF,YAAiB,IAAf,EACK,CAAE,mBAGO,IAAd,EACK,CAAE,kBADT,EAaiB,CAAe,GAElC,QAAyB,IAArB,QAAiD,IAAf,EACpC,cAAY,GAAqB,GAGnC,QAAyB,IAArB,EACF,OAAO,EAGP,QAAiB,IAAf,EACE,OAAG,EAGP,MAAI,IAAI,MAAM,wEAIL,4BAA4B,SACvC,GAEE,IAAI,EAAiB,OAAO,QAAQ,GAAQ,OAAO,IAhFvD,SACE,GAEE,IAAI,EAAU,EACb,QAAO,gBAAE,EAAF,iBAAW,EAAwC,SAAS,MACnE,KAAI,gBAAE,EAAF,2BAAa,EAAb,QAEL,GAAE,EAAQ,OAAS,EACnB,MAAM,IAAI,MAAJ,0CAA6C,EAAQ,KAAK,MAA1D,iBAyEN,CAA8B,GAC9B,IAAI,EAAiB,EAAe,IAAI,GAAY,OAAO,GAE7D,OAAO,EAAiC,IAG1C,IAAM,EAAW,SAAC,EAA2B,GAA5B,OACf,EAAa,IAAI,UAAQ,IAAI,IAAI,KAE7B,EAAa,SAAC,EAA2B,GAA5B,OACjB,EAAa,SAAS,UAAQ,IAAI,IAAI,KAElC,EAAqC,UAAQ,KAAK,KAO3C,E,WAQT,SAAF,IAA0D,IAA9C,EAA8C,uDAAjC,UAAQ,KAAM,EAAmB,uDAAZ,UAAQ,KAAI,UACpD,KAAC,WAAa,EACd,KAAC,KAAO,E,+BAGd,WACE,OAAO,KAAK,WAAW,QAAU,KAAK,KAAK,S,mBAS7C,WACE,GAAI,KAAK,KAAK,GAAG,4BACf,MAAM,IAAI,MAAJ,iDAAoD,6BAG5D,OAAO,KAAK,KAAK,IAAI,8B,mCAIvB,WACE,OAAO,KAAK,WAAW,OAAO,EAAoC,KAAK,Q,6BAIzE,SAAgB,GACd,OAAO,KAAK,WAAW,OAAO,EAAO,KAAK,Q,2CAU5C,SAA8B,GAC5B,OAAO,KAAK,gBAAgB,GAAO,GAAG,8B,4CAoBxC,SAA+B,GAC7B,OAAO,KAAK,gBAAgB,GAAO,GAAG,+B,sCAIxC,SAAyB,GACvB,OAAO,KAAK,gBAAgB,GAAO,IAAI,+B,sBAIzC,WACE,8BAAwB,KAAK,WAA7B,mBAAkD,KAAK,KAAvD,Q,oBAGF,SAAO,GACL,OAAO,KAAK,WAAW,GAAG,EAAK,aAAe,KAAK,KAAK,GAAG,EAAK,Q,iBAGlE,SAAI,GACF,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,EAAK,YAAa,KAAK,KAAK,IAAI,EAAK,S,2BAG5E,SAAc,GACZ,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,GAAa,KAAK,Q,qBAGzD,SAAQ,GACN,OAAO,IAAI,EAAM,KAAK,WAAY,KAAK,KAAK,IAAI,M,sBAGlD,SAAS,GAAW,IACV,EAAqB,EAArB,WAAY,EAAS,EAAT,KAEpB,OAAO,IAAI,EACT,KAAK,WAAW,GAAG,GAAc,KAAK,WAAW,IAAI,GAAc,UAAQ,KAC3E,KAAK,KAAK,GAAG,GAAQ,KAAK,KAAK,IAAI,GAAQ,UAAQ,Q,gCAIvD,SAAmB,GACjB,OAAO,IAAI,EACT,KAAK,WAAW,GAAG,GAAc,KAAK,WAAW,IAAI,GAAc,UAAQ,KAC3E,KAAK,Q,0BAIT,SAAa,GACX,OAAO,IAAI,EAAM,KAAK,WAAY,KAAK,KAAK,GAAG,GAAQ,KAAK,KAAK,IAAI,GAAQ,UAAQ,Q,sBAGvF,SAAS,GACP,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,GAAa,KAAK,KAAK,IAAI,M,2BAGlE,SAAc,GACZ,OAAO,IAAI,EAAM,UAAQ,KAAK,GAAa,KAAK,Q,qBAGlD,SAAQ,GACN,OAAO,IAAI,EAAM,KAAK,WAAY,UAAQ,KAAK,M,yBAGzC,WAA6B,GAAyB,IAAxC,EAAwC,EAAxC,KACpB,OAAO,EAAK,GAAG,KAAK,MAChB,CAAE,WAAY,EAAW,EAAe,EAAK,IAAI,KAAK,QACtD,CAAE,UAAW,KAAK,KAAK,IAAI,M,+BAGzB,YAAuC,IAAnB,EAAmB,EAAnB,WAC1B,OAAO,EAAW,GAAG,KAAK,YACtB,CAAE,kBAAmB,EAAW,IAAI,KAAK,aACzC,CAAE,mBAAoB,KAAK,WAAW,IAAI,M,yBAYhD,SACE,GACkD,I,EAAlD,EAAkD,uDAAtB,yBAE5B,IAAI,KAAK,WAAW,GAAG,EAAK,cAAe,KAAK,KAAK,GAAG,EAAK,MAI7D,OAAI,KAAK,QACH,EAAK,KAAK,GAAG,4BACR,EAAqB,EAAM,6BAG7B,EAAc,CACnB,kBAAmB,EAAK,WACxB,WAAY,EAAW,EAAe,EAAK,WAI3C,EAAK,QACA,EACL,KAAK,QAAQ,QACT,CAAE,mBAAoB,KAAK,WAAY,UAAW,KAAK,SACvD,CAAE,mBAAoB,KAAK,aAI5B,KAAK,WAAW,GAAG,EAAK,YAC3B,EAAyB,KAAK,YAAY,EAAM,GAAgB,EAAK,KAAK,MAAQ,QAClF,KAAK,KAAK,GAAG,EAAK,MAClB,EAAyB,KAAK,kBAAkB,GAAO,EAAK,WAAW,MAAQ,cAC/E,EAAe,OAER,KAAK,YAAY,EAAM,IACvB,KAAK,kBAAkB,IAEF,QADzB,EACA,EAAK,KAAK,MAAQ,cAAO,QAAK,EAAK,WAAW,MAAQ,gB,mBAU/D,SACE,GACkD,IAAlD,EAAkD,uDAAtB,yBAE5B,IAAK,EACH,OAAO,KAGT,OAAQ,EAAO,MACb,IAAK,kBACH,IAAK,KAAK,QACR,MAAM,IAAI,MAAM,oCAGlB,OAAO,EAAO,aAEhB,IAAK,WACH,IAAK,KAAK,QACR,MAAM,IAAI,MAAM,oCAFH,MAK2B,EAAO,OAAzC,EALO,EAKP,kBAAmB,EALZ,EAKY,WAE3B,OAAO,IAAI,EACT,EACA,2BAAyB,IAAI,EAAS,EAAe,KAIzD,IAAK,UACH,GAAI,KAAK,QACP,MAAM,IAAI,MAAM,2BAGlB,OAAO,cAET,IAAK,aAAc,IAEf,EAEE,EAFF,UAFe,EAIb,EADF,OAAU,EAHK,EAGL,kBAAmB,EAHd,EAGc,mBAAoB,EAHlC,EAGkC,WAAY,EAH9C,EAG8C,UAGzD,EAAuC,OAAlB,QAAkB,IAAlB,IAAsB,UAAQ,KACnD,EAAsC,OAAjB,QAAiB,IAAjB,IAAqB,UAAQ,KAClD,EAAwB,OAAT,QAAS,IAAT,IAAa,UAAQ,KACpC,EAAe,EAAa,EAAS,EAAe,GAAc,UAAQ,KAEhF,MAAqB,eAAd,EACH,KAAK,cAAc,UAAQ,MAAM,QAAQ,GAAc,aAAa,GACtD,SAAd,EACA,KAAK,QAAQ,UAAQ,MAClB,cAAc,GACd,mBAAmB,GACtB,KAAK,IAAI,IAAI,EAAM,EAAoB,IAAe,SACpD,IAAI,EAAM,EAAoB,O,oBAoC1C,SAAO,EAA2C,GAChD,OAAO,KAAK,MAAM,EAAgB,4BAA0B,IAAU,K,sBAUxE,SAAS,EAAa,GACpB,IAAM,EAAS,KAAK,YAAY,EAAM,GAEtC,OADA,UAAwB,gBAAX,OAAN,QAAM,IAAN,OAAM,EAAN,EAAQ,OACR,EAAO,U,qBAtChB,SAAc,EAAyC,GACrD,OAAO,cAAY,MAAM,EAAc,0BAAwB,IAAU,K,sBAU3E,SAAgB,EAAa,GAC3B,IAAM,EAAS,cAAY,YAAY,EAAM,GAE7C,OADA,UAAwB,cAAX,OAAN,QAAM,IAAN,OAAM,EAAN,EAAQ,OACR,EAAO,W,KAtRlB,UAmTa,cAAc,IAAI,E,IA2BlB,E,8BAQX,WAAY,EAAsB,EAAyB,EAAsB,GAAc,wBAC7F,cAAM,EAAY,IAEb,aAAe,EACpB,EAAK,OAAS,EAJ+E,E,gCAO/F,SAAO,GACL,OACE,0CAAa,IAAS,KAAK,eAAiB,EAAK,cAAgB,KAAK,SAAW,EAAK,S,sBAK1F,WACE,MACE,2BAAoB,KAAK,aAAzB,6BACiB,KAAK,YADtB,kBAEW,KAAK,MAFhB,qBAGc,KAAK,OAHnB,W,GAxByB,GAA/B,c,IA0Ca,E,8BAKX,WACE,EACA,EACA,EACA,GAE0C,MAD1C,EAC0C,uDADlC,UAAQ,KAChB,EAA0C,uDAAX,cAAW,kBAE1C,cAAM,EAAc,EAAQ,EAAY,IAEnC,MAAQ,EACb,EAAK,6BAA+B,EALM,E,6CAQ5C,SAAoB,GAClB,IAAM,EAAsB,KAAK,IAC/B,EAAmB,SAAS,KAAK,8BAA8B,SAAS,KAAK,QAG/E,OAAO,IAAI,EACT,KAAK,aACL,KAAK,OACL,EAAoB,WACpB,EAAoB,Q,oBAIxB,SAAO,GACL,OACE,0CAAa,IACb,KAAK,MAAM,GAAG,EAAK,QACnB,KAAK,6BAA6B,OAAO,EAAK,kC,GApCA,GAApD,oC,4HChxBA,YAgBa,E,WAuBT,SAAF,EACE,EACA,EACA,EACA,EACA,GAQI,GARe,UAEnB,KAAK,YAAc,EACnB,KAAK,YAAc,EACnB,KAAK,eAAiB,EACtB,KAAK,WAAa,EAClB,KAAK,YAAc,EAEf,KAAK,YAAY,GAAG,KAAK,aACrB,UAAI,MAAM,iD,+BAIpB,WACE,OACE,KAAK,YAAY,QACjB,KAAK,YAAY,QACjB,KAAK,eAAe,QACpB,KAAK,WAAW,S,sBAKpB,WACE,MACE,yBAAkB,KAAK,aAAvB,yBACkB,KAAK,aADvB,4BAEqB,KAAK,gBAF1B,wBAGiB,KAAK,YAHtB,0BAImB,KAAK,YAJxB,S,oBAWJ,SAAO,GACL,OACE,KAAK,YAAY,GAAG,EAAK,cACzB,KAAK,YAAY,GAAG,EAAK,cACzB,KAAK,eAAe,GAAG,EAAK,iBAC5B,KAAK,WAAW,GAAG,EAAK,aACxB,KAAK,cAAgB,EAAK,c,yBAS9B,SAAY,GAGV,OAFA,EAAW,UAAQ,KAAK,IAEX,GAAG,KAAK,aACZ,CAAE,aAAc,KAAK,YAAY,IAAI,GAAW,gBAAiB,EAAS,QAG/E,EAAS,GAAG,KAAK,aACZ,CAAE,YAAa,EAAS,IAAI,KAAK,mBAD1C,I,mBAUF,SAAM,GACJ,OAAK,OAIuB,IAAxB,EAAO,aACF,EAAO,iBAAmB,KAAK,YAAY,IAAI,EAAO,cACzD,UAAQ,KACR,KAAK,YAAY,IAAI,EAAO,cAEzB,KAAK,YAAY,IAAI,EAAO,aAR5B,KAAK,gB,KAlGlB,sB,qHChBA,YAmBa,E,WAWT,SAAF,IAA6F,IAAjF,EAAiF,uDAApE,UAAQ,KAAM,EAAsD,uDAArC,UAAQ,KAAM,EAAuB,uDAAZ,UAAQ,KAAI,UAC3F,KAAK,WAAa,EACd,KAAC,eAAiB,EAClB,KAAC,SAAW,E,+BAGlB,WACE,OAAO,KAAK,WAAW,QAAU,KAAK,eAAe,QAAU,KAAK,SAAS,S,sBAI/E,WACE,MACE,wBAAiB,KAAK,YAAtB,4BACqB,KAAK,gBAD1B,sBAEe,KAAK,SAFpB,Q,oBASJ,SAAO,GACL,OACE,KAAK,WAAW,GAAG,EAAK,aACxB,KAAK,eAAe,GAAG,EAAK,iBAC5B,KAAK,SAAS,GAAG,EAAK,Y,yBAS1B,SAAY,GAGJ,OAFN,EAAiB,UAAQ,KAAK,IAEX,GAAG,KAAK,YAClB,CACL,YAAa,KAAK,WAAW,IAAI,GACjC,eAAgB,EAAe,QAI/B,EAAe,GAAG,KAAK,YAClB,CAAE,UAAW,EAAe,IAAI,KAAK,kBAD9C,I,mBAUF,SAAM,GACJ,OAAK,OAIsB,IAAvB,EAAO,YACF,EAAO,gBAAkB,KAAK,WAAW,IAAI,EAAO,aACvD,UAAQ,KACR,KAAK,WAAW,IAAI,EAAO,aAExB,KAAK,WAAW,IAAI,EAAO,WAR3B,KAAK,e,KApElB,e,gMCnBA,eAEA,QAEA,SAca,E,WAST,SAAF,EACE,EACA,EACA,EACA,EACA,EACA,GAAqB,UAErB,KAAK,sBAAwB,UAAQ,KAAK,GACtC,KAAC,mBAAqB,UAAQ,KAAK,GACnC,KAAC,MAAQ,UAAQ,KAAK,GACtB,KAAC,kBAAoB,EACrB,KAAC,mBAAqB,EACtB,KAAC,cAAgB,EAErB,UAAO,KAAK,mBAAmB,GAAG,I,0CAIpC,SAAiB,GACT,OAAC,IAAI,EACT,KAAK,sBACL,KAAK,mBACL,KAAK,MACL,KAAK,kBACL,KAAK,mBACL,K,oBAOJ,SAAO,GACL,OACE,KAAK,sBAAsB,GAAG,EAAK,wBACnC,KAAK,mBAAmB,GAAG,EAAK,qBAChC,KAAK,MAAM,GAAG,EAAK,QACnB,KAAK,kBAAkB,YAAc,EAAK,kBAAkB,WAC5D,KAAK,mBAAmB,YAAc,EAAK,mBAAmB,WAC9D,KAAK,gBAAkB,EAAK,gB,sBAKhC,WACE,MACE,kCAA2B,KAAK,uBAAhC,+BACwB,KAAK,kBAAkB,iBAD/C,+BAEmB,KAAK,cAFxB,S,sBAOJ,WAAuC,IAA9B,EAA8B,uDAAvB,KAAK,mBACb,EAAoC,KAAK,IAC7C,EAAK,UAAY,KAAK,kBAAkB,UACxC,GAII,EAA+B,KAAK,MAAM,EAAoC,KAEpF,OAAO,KAAK,mBAAmB,IAAI,GAA8B,IAAI,KAAK,yB,2BAwB5E,SAAc,GACZ,OAAO,KAAK,cACR,UAAQ,KACR,UAAQ,IAAI,yBAAuB,IAAI,KAAK,SAAS,IAAQ,4B,4BAgCnE,WAA+E,IAAhE,EAAgE,uDAAzB,UAAQ,KAAM,EAAW,uCAC7E,EAA2B,UAAQ,KAAK,GACxC,IAAI,EAAW,KAAK,SAAS,GAM7B,OAJI,EAAyB,UAC3B,EAAW,EAAyB,IAAI,KAAK,OAAO,IAAI,IAGnD,UAAQ,IAAI,0BAAwB,IAAI,GAAW,UAAQ,S,KA3ItE,U,oTCRa,E,8BAIT,SAAF,EAAY,EAAc,EAAiB,GAAgB,wBACzD,cAAM,IACD,KAAO,EACZ,EAAK,cAAgB,EAHoC,E,YAJwB,QAArF,4B,yJC8Ca,kBAAkC,CAAE,OAAQ,WAgB5C,iBAAiB,SAAI,GAAJ,MAAyC,CACrE,OAAQ,SACR,eAyBW,qBAAqB,SAChC,EACA,EACA,GAHgC,UAKhC,OAAQ,YACR,aACA,WACI,EAAW,CAAE,YAAa,M,uSC3GhC,eAkLM,EAAe,SAAI,EAAM,GAAV,OAAmB,IAAM,GACxC,EAAK,SAAqC,EAAM,GAA3C,OAAoD,EAAE,GAAG,IAC9D,EAAS,SAAyC,EAAM,GAA/C,OAAwD,EAAE,OAAO,IAE1E,EAAuB,SAAC,EAAmB,GAApB,MACd,iBAAb,EAAE,OACe,iBAAb,EAAE,OACW,eAAb,EAAE,QAA2B,EAAE,aAAa,GAAG,EAAE,eAEjD,EAAqB,SAAC,GAAD,MACZ,iBAAb,EAAE,OACE,6BADJ,gDAE6C,EAAE,aAF/C,OAsBoB,E,WAApB,SAAF,IAAI,EAAJ,QAEE,cAAU,EAWA,cAAU,EAOZ,gBAAa,IAAI,I,6BAWzB,WACE,OAAO,OAAO,OAAO,GAAI,KAAK,WAAY,KAAK,cAAe,KAAK,e,mBAiBrE,WAAK,WACG,EAAS,KAAK,WAEpB,OAAO,WACL,IAEA,EAAK,8B,sCAID,gBACwB,IAA1B,KAAK,kBACP,aAAa,KAAK,oB,6BAId,WAAe,WACrB,KAAK,2BAEL,KAAK,iBAAmB,YAAW,WACjC,EAAK,sBAAmB,EACxB,EAAK,YACJ,O,wBAGG,SAAc,EAAc,EAAS,GAK3C,OAJI,KAAK,SACP,QAAQ,IAAR,UAAe,EAAf,uBAAkC,EAAO,EAAK,GAAQ,IAGjD,I,8BAGD,SACN,EACA,EACA,EACA,EACA,GAEA,YAAgB,IAAT,GAAuB,EAAO,EAAM,GAA4C,EAApC,KAAK,WAAW,EAAM,EAAM,K,sCAGzE,SAA4B,EAAiC,EAAS,GAC5E,YAAgB,IAAT,GAAuB,EAAO,EAAM,GAAe,EAAP,I,yBAG7C,SAAY,EAAc,EAAY,GAC5C,OAAI,IAAS,EAAK,OAAO,IAGnB,UAAG,KAAH,UAAiB,IACnB,KAAK,WAAW,EAAM,GAEjB,GAEA,I,qBAIH,SACN,EACA,GAEA,MAAO,CACL,SAAU,KAAK,iBACb,EACA,WACA,EAAU,SACV,EAAgB,SAChB,GAGF,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,YAChB,GAGF,eAAgB,KAAK,iBACnB,EACA,iBACA,EAAU,eACV,EAAgB,gBAGlB,eAAgB,KAAK,iBACnB,EACA,iBACA,EAAU,eACV,EAAgB,gBAGlB,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,aAGlB,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,aAGlB,gBAAiB,KAAK,iBACpB,EACA,kBACA,EAAU,gBACV,EAAgB,iBAGlB,kBAAmB,KAAK,iBACtB,EACA,oBACA,EAAU,kBACV,EAAgB,mBAGlB,mCAAoC,KAAK,yBACvC,EACA,EAAU,mCACV,EAAgB,oCAGlB,qBAAsB,KAAK,iBACzB,EACA,uBACA,EAAU,qBACV,EAAgB,sBAGlB,qBAAsB,KAAK,iBACzB,EACA,uBACA,EAAU,qBACV,EAAgB,sBAGlB,0BAA2B,KAAK,yBAC9B,EACA,EAAU,0BACV,EAAgB,2BAGlB,yBAA0B,KAAK,iBAC7B,EACA,2BACA,EAAU,yBACV,EAAgB,0BAGlB,MAAO,KAAK,iBAAiB,EAAI,QAAS,EAAU,MAAO,EAAgB,OAE3E,oBAAqB,KAAK,iBACxB,EACA,sBACA,EAAU,oBACV,EAAgB,qBAGlB,MAAO,KAAK,iBAAiB,EAAQ,QAAS,EAAU,MAAO,EAAgB,OAE/E,mBAAoB,KAAK,iBACvB,EACA,qBACA,EAAU,mBACV,EAAgB,oBAGlB,0BAA2B,KAAK,iBAC9B,EACA,4BACA,EAAU,0BACV,EAAgB,2BAGlB,iBAAkB,KAAK,iBACrB,EACA,mBACA,EAAU,iBACV,EAAgB,kBAGlB,iCAAkC,KAAK,yBACrC,EACA,EAAU,iCACV,EAAgB,kCAGlB,kBAAmB,KAAK,yBACtB,EACA,EAAU,kBACV,EAAgB,mBAGlB,UAAW,KAAK,iBACd,EACA,YACA,EAAU,UACV,EAAgB,WAGlB,gBAAiB,KAAK,iBACpB,EACA,kBACA,EAAU,gBACV,EAAgB,iBAGlB,mCAAoC,KAAK,yBACvC,EACA,EAAU,mCACV,EAAgB,uC,qBAKd,YAOgB,IANtB,EAMsB,EANtB,0BACA,EAKsB,EALtB,mBACA,EAIsB,EAJtB,kBACA,EAGsB,EAHtB,MACA,EAEsB,EAFtB,MACA,EACsB,EADtB,mCAEM,EAAO,EAAkB,iBAAiB,EAAM,+BAA+B,IAErF,MAAO,CACL,MAAO,EAA0B,oBAAoB,GACrD,OACA,cAAe,EAAK,gBACpB,eAAgB,EAAK,iBACrB,8BAA+B,EAC5B,oBAAoB,GACpB,8BAA8B,M,4BAI7B,SACN,EACA,GAEA,MAAO,CACL,KAAM,KAAK,YAAY,OAAQ,EAAa,KAAM,EAAmB,MAErE,MAAO,KAAK,iBAAiB,EAAQ,QAAS,EAAa,MAAO,EAAmB,OAErF,cAAe,KAAK,yBAClB,EACA,EAAa,cACb,EAAmB,eAGrB,eAAgB,KAAK,yBACnB,EACA,EAAa,eACb,EAAmB,gBAGrB,8BAA+B,KAAK,iBAClC,EACA,gCACA,EAAa,8BACb,EAAmB,kC,qBAQjB,SAAQ,GAAqC,WAOnD,EAAI,KAAK,YAAY,SAAQ,YACvB,EAAK,WAAW,IAAI,IACtB,EAAS,Q,uBAWf,SAAU,GAAyD,IA3W/B,EA2W+B,OAC3D,GA5W4B,EA4WN,EA5W+B,kBAAgB,EAAC,WAAD,eAgX3E,OAFA,KAAK,WAAW,IAAI,GAEb,WACL,EAAK,WAAW,OAAO,M,mBAKjB,SAAM,EAAkC,GAChD,WAAQ,KAAK,SAEb,KAAK,WAAa,EAClB,KAAK,cAAgB,KAAK,QAAQ,GAClC,KAAK,YAAc,EACnB,KAAK,SAAU,EAEf,KAAK,kBAED,KAAK,UACP,KAAK,a,qBAKC,SACR,EACA,GAEA,UAAO,KAAK,YAAc,KAAK,eAE/B,IA1YmB,EAAM,EA0YnB,EAAW,KAAK,MAElB,IACF,KAAK,WAAa,KAAK,QAAQ,KAAK,WAAY,IAIlD,KAAK,cAAgB,KAAK,eAAe,KAAK,cAAe,KAAK,QAAQ,KAAK,aAE3E,IACF,UAAO,KAAK,aACZ,KAAK,YAAc,KAAK,aAAa,KAAK,YAAa,IAGzD,KAAK,kBAEL,KAAK,QAAQ,CACX,SAAU,KAAK,MACf,WACA,aA7ZiB,EA6ZO,KAAK,MA7ZN,EA6Za,EA5ZxC,OAAO,YACL,OAAO,QAAQC,GAAG,QAAO,yBAAE,EAAF,mBAA6B,EAA8B,c,KAcxF,kB,6KCrKa,E,WAKT,SAAF,EAAY,EAA8C,GAA2B,UACnF,KAAK,UAAY,EACjB,KAAK,OAAS,E,0EAGhB,2HAEqD,QAD5C,GACL,OAAK,QAAO,sBAAZ,kBAAiD,SACjD,OAAK,WAAU,sBAAf,YAHJ,gD,2HAOA,WACE,GADF,0GAEK,EAFL,iCAEK,EAFL,mCAKqE,QAD5D,GACL,OAAK,QAAO,6BAAZ,SAAyC,GAAzC,OAAqD,WAAY,SACjE,OAAK,WAAU,6BAAf,SAA4C,GAA5C,OAAwD,KAN5D,gD,wGAUA,WAAe,GAAf,4GAAoC,EAApC,iCAAoC,EAApC,0BACgE,QAAQ,IAAI,CACxE,KAAK,6BAAL,YAAkC,GAAlC,OAA8C,IAC9C,KAAK,sBAAL,WAA8B,KAHlC,gCACS,EADT,KACoC,EADpC,uBAMS,EAA0B,oBAAoB,IANvD,gD,iHASA,2HAEiD,QADxC,GACL,OAAK,QAAO,kBAAZ,kBAA6C,SAC7C,OAAK,WAAU,kBAAf,YAHJ,gD,uGAOA,aAAQ,IAAR,kBAAQ,OAAR,oBAAU,OAAV,sDAC6C,QAA3C,GAAO,OAAK,QAAO,SAAZ,kBAAoC,SAAI,OAAK,WAAU,SAAf,YADjD,gD,uGAIA,aAAQ,IAAR,kBAAQ,OAAR,oBAAU,OAAV,sDAC6C,QAA3C,GAAO,OAAK,QAAO,SAAZ,kBAAoC,SAAI,OAAK,WAAU,SAAf,YADjD,gD,kHAIA,WAA0B,GAA1B,0GAA+C,EAA/C,iCAA+C,EAA/C,mCAE4D,QADnD,GACL,OAAK,QAAO,oBAAZ,SAAgC,GAAhC,OAA4C,WAAY,SACxD,OAAK,WAAU,oBAAf,SAAmC,GAAnC,OAA+C,KAHnD,gD,mIAOA,2HAEmE,QAD1D,GACL,OAAK,QAAO,oCAAZ,kBAA+D,SAC/D,OAAK,WAAU,oCAAf,YAHJ,gD,qHAOA,2HAEsD,QAD7C,GACL,OAAK,QAAO,uBAAZ,kBAAkD,SAClD,OAAK,WAAU,uBAAf,YAHJ,gD,6GAOA,WAAqB,GAArB,0GAA0C,EAA1C,iCAA0C,EAA1C,mCAEuD,QAD9C,GACL,OAAK,QAAO,eAAZ,SAA2B,GAA3B,OAAuC,WAAY,SACnD,OAAK,WAAU,eAAf,SAA8B,GAA9B,OAA0C,KAH9C,gD,8GAOA,WAAqB,GAArB,0GAA0C,EAA1C,iCAA0C,EAA1C,mCAEuD,QAD9C,GACL,OAAK,QAAO,eAAZ,SAA2B,GAA3B,OAAuC,WAAY,SACnD,OAAK,WAAU,eAAf,SAA8B,GAA9B,OAA0C,KAH9C,gD,kHAOA,WAAyB,GAAzB,0GAA8C,EAA9C,iCAA8C,EAA9C,mCAE2D,QADlD,GACL,OAAK,QAAO,mBAAZ,SAA+B,GAA/B,OAA2C,WAAY,SACvD,OAAK,WAAU,mBAAf,SAAkC,GAAlC,OAA8C,KAHlD,gD,oHAOA,WAA2B,GAA3B,0GAAgD,EAAhD,iCAAgD,EAAhD,mCAE6D,QADpD,GACL,OAAK,QAAO,qBAAZ,SAAiC,GAAjC,OAA6C,WAAY,SACzD,OAAK,WAAU,qBAAf,SAAoC,GAApC,OAAgD,KAHpD,gD,qIAOA,2HAEqE,QAD5D,GACL,OAAK,QAAO,sCAAZ,kBAAiE,SACjE,OAAK,WAAU,sCAAf,YAHJ,gD,sHAOA,WAA8B,GAA9B,0GAAmD,EAAnD,iCAAmD,EAAnD,mCAEgE,QADvD,GACL,OAAK,QAAO,wBAAZ,SAAoC,GAApC,OAAgD,WAAY,SAC5D,OAAK,WAAU,wBAAf,SAAuC,GAAvC,OAAmD,KAHvD,gD,uHAOA,2HAEuD,QAD9C,GACL,OAAK,QAAO,wBAAZ,kBAAmD,SACnD,OAAK,WAAU,wBAAf,YAHJ,gD,2HAOA,WAAmC,GAAnC,0GAAwD,EAAxD,iCAAwD,EAAxD,mCAEqE,QAD5D,GACL,OAAK,QAAO,6BAAZ,SAAyC,GAAzC,OAAqD,WAAY,SACjE,OAAK,WAAU,6BAAf,SAA4C,GAA5C,OAAwD,KAH5D,gD,2HAOA,WAAkC,GAAlC,0GAAuD,EAAvD,iCAAuD,EAAvD,mCAEoE,QAD3D,GACL,OAAK,QAAO,4BAAZ,SAAwC,GAAxC,OAAoD,WAAY,SAChE,OAAK,WAAU,4BAAf,SAA2C,GAA3C,OAAuD,KAH3D,gD,yGAcA,WAAgB,GAAhB,2GACU,EAA0C,EAA1C,qBAAyB,EADnC,EACoD,EADpD,qCAA+C,EAA/C,iCAA+C,EAA/C,0BAG6C,QAAQ,IAAI,CACrD,OAAuB,EAAY,KAAK,sBAAL,WAA8B,GACqB,Q,GAAtF,OAAK,QAAO,UAAZ,YAAwB,sBAAsB,GAAS,IAAvD,OAA0E,WAAY,SACpF,OAAK,WAAU,UAAf,YAA2B,sBAAsB,GAAS,IAA1D,OAA6E,MANnF,4BAGS,EAHT,KAG6B,EAH7B,MASM,EATN,0CAUW,EAAO,KAAI,YAAK,OAAI,EAAM,oBAAoB,OAVzD,iCAYW,GAZX,iD,uGAgBA,2HAC4C,QAA1C,GAAO,OAAK,QAAO,QAAZ,kBAAmC,SAAI,OAAK,WAAU,QAAf,YADhD,gD,2GAIA,WAAmB,GAAnB,0GAAwC,EAAxC,iCAAwC,EAAxC,mCAEqD,QAD5C,GACL,OAAK,QAAO,aAAZ,SAAyB,GAAzB,OAAqC,WAAY,SACjD,OAAK,WAAU,aAAf,SAA4B,GAA5B,OAAwC,KAH5C,gD,kHAOA,2HAEkD,QADzC,GACL,OAAK,QAAO,mBAAZ,kBAA8C,SAC9C,OAAK,WAAU,mBAAf,YAHJ,gD,gHAOA,WAAwB,GAAxB,0GAA6C,EAA7C,iCAA6C,EAA7C,mCAE0D,QADjD,GACL,OAAK,QAAO,kBAAZ,SAA8B,GAA9B,OAA0C,WAAY,SACtD,OAAK,WAAU,kBAAf,SAAiC,GAAjC,OAA6C,KAHjD,gD,8DAhLF,4B,wjlHC1CA,aAIM,EAAe,CACnB,CACI,UAAQ,EACR,OAAM,GACN,KAAI,2BACJ,QAAO,CACP,CACE,KAAM,YACN,KAAM,YAGV,SAAS,EACT,gBAAiB,OACjB,KAAM,aAIJ,EAAmB,CACrB,EAAC,6CACH,EAAG,6CACH,EAAG,6CACH,EAAG,6CACD,GAAE,8CAUO,sBAAsB,SACjC,EACA,GAFiC,OAPd,SAAC,GAAD,OACnB,KAAW,EAUX,CAAa,GACP,IAAI,WACJ,EAAiB,GACjB,EACA,QAEF,I,kNCtCN,YAKM,EAAW,SAAC,GACd,IAAE,OAAuD,EACvD,EAAc,EAEhB,OAAK,WAAuB,MACtB,GAAK,EAAQ,UAAK,OAAS,GAAtB,gDAEe,IAAtB,EAAM,aAA6B,EAAM,YAAc,IACzD,EAAc,EAAM,kBAGJ,IAAd,GACF,aAAa,GAGX,EAAQ,YAAW,WACrB,EAAS,GACT,OAAY,IAnBQ,MAyBb,E,WAGT,SAAF,EAAY,GAA+B,UACzC,KAAK,UAAY,E,iDAGnB,SACE,GAAgE,aAE5B,gBAAc,KAAK,UAAU,YAAzD,EAFwD,EAExD,WAAY,EAF4C,EAE5C,YACd,EAAY,EAAW,QAAQ,YAE/B,EAAyB,GAAS,SAAC,GACvC,EAAK,UAAU,sBAAsB,CAAE,aAAY,KAAK,MAGpD,EAAoB,SAAC,EAAmB,EAAoB,GAC5D,IAAc,EAAY,SAC5B,EAAuB,IAM3B,OAFA,EAAW,GAAG,EAAW,GAElB,WACL,EAAW,eAAe,EAAW,M,sCAIzC,SACE,EACA,GAAgB,WAET,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aAF3B,MAI6B,gBAAc,KAAK,UAAU,YAAlE,EAJQ,EAIR,aAAc,EAJN,EAIM,mBAChB,EAA6B,EAAa,QAAQ,aAAa,GAC/D,EAAmC,EAAmB,QAAQ,aAAa,GAE3E,EAAgB,GAAS,SAAC,GAC9B,EAAK,UAAU,6BAA6B,EAAS,CAAE,aAAY,KAAK,MAMpE,OAHN,EAAa,GAAG,EAA4B,GAC5C,EAAmB,GAAG,EAAkC,GAEjD,WACL,EAAa,eAAe,EAA4B,GACxD,EAAmB,eAAe,EAAkC,M,iCAIxE,SAAoB,GAAyD,WACnE,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAEF,GAAe,EADI,EAAa,QAA9B,gBAGF,EAAuB,GAAS,SAAC,GACrC,EAAK,UAAU,kBAAkB,CAAE,aAAY,KAAK,MAKhD,OAFA,EAAO,GAAG,EAAc,GAEvB,WACL,EAAa,eAAe,EAAc,M,wBAK9C,SAAW,GAIT,MAAM,IAAI,MAAM,6B,wBAGlB,SAAW,GAAsC,WACvC,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAEF,GAAe,EADI,EAAa,QAA9B,gBAGF,EAAgB,GAAS,SAAC,GAC9B,EAAK,UAAU,SAAS,CAAE,aAAY,KAAK,MAK7C,OAFA,EAAa,GAAG,EAAc,GAEvB,WACL,EAAa,eAAe,EAAc,M,mCAI9C,SACE,EACA,GAAgB,WAET,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aAF3B,MAIsB,gBAAc,KAAK,UAAU,YAA3D,EAJQ,EAIR,WAAY,EAJJ,EAII,cACZ,EAAuB,EAAc,QAArC,mBACA,EAAc,EAAW,QAAzB,UAEF,EAAqB,EAAmB,GACxC,EAAY,IAEZ,EAAkB,GAAS,SAAC,GAChC,EAAK,UAAU,oBAAoB,EAAS,CAAE,aAAY,KAAK,MAG3D,EAAoB,SAAC,EAAmB,EAAoB,GAC5D,IAAc,EAAc,SAG9B,EAAgB,IAOpB,OAHA,EAAc,GAAG,EAAoB,GACrC,EAAW,GAAG,EAAW,GAElB,WACL,EAAc,eAAe,EAAoB,GACjD,EAAW,eAAe,EAAW,M,sCAIzC,SACE,GAAoE,aAE/B,gBAAc,KAAK,UAAU,YAA1D,EAF4D,EAE5D,UAAW,EAFiD,EAEjD,cACX,EAAa,EAAU,QAAvB,SAKF,EAA2B,CAHK,EAAS,EAAc,SACzB,EAAS,KAAM,EAAc,UAI3D,EAA4B,GAAS,SAAC,GAC1C,EAAK,UAAU,uBAAuB,CAAE,aAAY,KAAK,MAK3D,OAFA,EAAyB,SAAQ,YAAM,OAAI,EAAU,GAAG,EAAQ,MAEzD,kBACL,EAAyB,SAAQ,YAAM,OACrC,EAAU,eAAe,EAAQ,S,8BAIvC,SAAiB,EAAkD,GAAgB,WAC1E,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aADsC,IAGzE,EAAc,gBAAc,KAAK,UAAU,YAA3C,UACA,EAAa,EAAU,QAAvB,SAIF,EAAsB,CAHC,EAAS,GACX,EAAS,KAAM,IAIpC,EAAuB,GAAS,SAAC,GACrC,EAAK,UAAU,eAAe,EAAS,CAAE,aAAY,KAAK,MAK5D,OAFA,EAAoB,SAAQ,YAAM,OAAI,EAAU,GAAG,EAAQ,MAEpD,kBACL,EAAoB,SAAQ,YAAM,OAAI,EAAU,eAAe,EAAQ,W,KAvK7E,6B,kICvCA,YACA,QAIA,OAgDM,EAAY,SAChB,EACA,GAEE,IAAI,EAA0B,GAC1B,EAAsB,GAY1B,OAVF,EAAK,SAAQ,YACX,IAAM,EAvBY,SAAC,EAAU,GAA2D,IAClF,EAAY,EAAZ,QAER,GAAI,KAAW,EACb,IACE,MAAO,CAAE,UAAS,eAAgB,EAAgB,GAAS,SAAS,IACpE,MAAO,GACP,QAAQ,KAAK,wBACb,QAAQ,KAAK,GACP,QAAE,KAAK,WACb,QAAQ,KAAK,IAaG,CAAc,EAAK,GAEjC,EACF,EAAW,KAAK,GAEhB,EAAa,KAAK,MAIf,CAAC,EAAY,IAGhB,EAAW,YAAU,KAAK,IAAI,IAAI,GAoBlC,EAAyB,SAAC,EAAgC,GAC9D,IAAM,EAAgB,OAAO,QAAQ,EAAe,MACjD,QAAO,6BAAgB,MAAM,aAC7B,KAAI,yBAAE,EAAF,KAAO,EAAP,qBAAqB,EAArB,aArBQ,SAAC,EAAc,GAC5B,OAAE,YAAU,YAAY,GACpB,EAAI,IAAI,GACV,UAAU,UAAQ,oBAAoB,EAAI,eAA1C,OAEO,EAAI,WAEW,kBAAR,EACT,IAAQ,cACX,aACA,GAAc,KAAO,EACrB,EAAW,GACX,EAEG,OAAO,GAOoB,CAAS,EAAO,OAEpD,gBAAU,EAAe,KAAzB,cAAmC,EAAc,KAAK,MAAtD,QAGW,eAAe,SAAC,EAA6B,GACxD,IAAM,EAAkB,EAClB,EAlFoB,SAAC,GACzB,OAAK,OAAO,YACZ,OAAO,QAAQ,GAAgB,KAAI,gBAAI,EAAJ,gBAAkB,CAAC,EAAS,QAAS,EAAS,eAgF3D,CAAoB,GACtC,EA7Ee,SAAC,GACpB,OAAK,OAAO,YACZ,OAAO,QAAQ,GAAgB,KAAI,yBAAE,EAAF,WAAsB,CAAtB,KAAgC,QAAS,OA2EnD,CAAe,GAEpC,EAAU,OACb,EAAQ,KAAO,QACb,GAP2F,EAU7D,EAAU,EAAQ,KAAM,GAVqC,SAUzF,EAVyF,KAU7E,EAV6E,KAiBhG,OALI,EAAa,OAAS,IACxB,QAAQ,KAAK,qDACb,QAAQ,KAAK,IAGX,EAAW,OAAS,EAEpB,qBAAc,EAAQ,gBAAtB,OACA,EACG,KACC,gBAAG,EAAH,EAAG,QAAS,EAAZ,EAAY,eAAZ,kBACO,EAAmB,GAD1B,YACsC,EAAuB,EAAgB,OAE9E,KAAK,MAGV,oCAAoC,EAAQ,mB,uLC/HhD,WA2BA,QAgBA,SAKA,SACA,SAQa,E,8BAGT,SAAF,EAAY,EAAiB,GAAsD,6BAC3E,+BAAgC,EAAS,G,UAJD,0BAAlD,iCAQA,IAAM,EAAc,2BAAG,WAAU,GAAV,qFACC,EAAG,iBADJ,UAGE,eAFjB,EADe,QAGT,OAHS,sBAIb,IAAI,EAA6B,qBAAsB,GAJ1C,gCAOd,EAAQ,SAPM,2CAAH,sDAeP,E,WAaT,SAAF,EAAY,GAA+B,UACrC,KAAC,UAAYC,EACjB,KAAK,WAAa,EAAS,WAC3B,KAAK,SAAW,IAAI,2BAAyB,GAC7C,KAAK,KAAO,IAAI,wBAAsB,KAAK,U,kCAwD7C,WACE,OAAO,I,mCAIT,SAAsB,GACpB,OAAO,KAAK,UAAU,sBAAsB,K,0CAI9C,SACE,EACA,GAEA,OAAO,KAAK,UAAU,6BAA6B,EAAS,K,sBAI9D,SAAS,EAAkB,GACnB,OAAC,KAAK,UAAU,SAAS,EAAS,K,+BAI1C,SAAkB,GAChB,OAAO,KAAK,UAAU,kBAAkB,K,sBAI1C,SAAS,GACP,OAAO,KAAK,UAAU,SAAS,K,4BAIjC,SAAe,GACb,OAAO,KAAK,UAAU,eAAe,K,6BAIvC,SAAgB,GACd,OAAO,KAAK,UAAU,gBAAgB,K,sBAIxC,SAAS,GACP,OAAO,KAAK,UAAU,SAAS,K,iCAIjC,SAAoB,EAAkB,GACpC,OAAO,KAAK,UAAU,oBAAoB,EAAS,K,iDAIrD,SAAoC,GAClC,OAAO,KAAK,UAAU,oCAAoC,K,oCAI5D,SAAuB,GACrB,OAAO,KAAK,UAAU,uBAAuB,K,4BAI/C,SAAe,EAAkB,GAC/B,OAAO,KAAK,UAAU,eAAe,EAAS,K,4BAIhD,SAAe,EAAkB,GAC/B,OAAO,KAAK,UAAU,eAAe,EAAS,K,gCAIhD,SAAmB,EAAkB,GACnC,OAAO,KAAK,UAAU,mBAAmB,EAAS,K,kCAIpD,SAAqB,EAAkB,GACrC,OAAO,KAAK,UAAU,qBAAqB,EAAS,K,8DAItD,SACE,GAEA,OAAO,KAAK,UAAU,iDAAiD,K,mDAIzE,SAAsC,GACpC,OAAO,KAAK,UAAU,sCAAsC,K,qCAI9D,SAAwB,EAAkB,GACxC,OAAO,KAAK,UAAU,wBAAwB,EAAS,K,qCAIzD,SAAwB,GACtB,OAAO,KAAK,UAAU,wBAAwB,K,0CAIhD,SAA6B,EAAkB,GAC7C,OAAO,KAAK,UAAU,6BAA6B,EAAS,K,yCAI9D,SAA4B,EAAkB,GAC5C,OAAO,KAAK,UAAU,4BAA4B,EAAS,K,uBAY7D,SAAU,EAA4B,GACpC,OAAO,KAAK,UAAU,UAAU,EAAQ,K,gCAI1C,SAAmB,GACjB,OAAO,KAAK,UAAU,mBAAmB,K,6BAI3C,SACE,GAEA,OAAO,KAAK,UAAU,gBAAgB,K,qBAIxC,SAAQ,GACN,OAAO,KAAK,UAAU,QAAQ,K,0BAIhC,SAAa,EAAkB,GAC7B,OAAO,KAAK,UAAU,aAAa,EAAS,K,gCAI9C,SAAmB,GACjB,OAAO,KAAK,UAAU,mBAAmB,K,+BAI3C,SAAkB,EAAkB,GAClC,OAAO,KAAK,UAAU,kBAAkB,EAASF,K,uBAUnD,SACE,EACA,EACA,GAEA,OAAO,KAAK,KACT,UAAU,EAAQ,EAAkC,GACpD,KAAK,K,wBAUV,SAAW,GACT,OAAO,KAAK,KAAK,WAAW,GAAW,KAAK,K,yBAU9C,SACE,EACA,EACA,GAEA,OAAO,KAAK,KACT,YAAY,EAAQ,EAAkC,GACtD,KAAK,K,+BAUV,SACE,EACA,GAEA,OAAO,KAAK,KAAK,kBAAkB,EAAQ,GAAW,KAAK,K,gCAU7D,SACE,EACA,GAEA,OAAO,KAAK,KAAK,mBAAmB,EAAQ,GAAW,KAAK,K,wBAU9D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,WAAW,EAAQ,EAAkB,GAAW,KAAK,K,uBAUxE,SACE,EACA,GAEA,OAAO,KAAK,KAAK,UAAU,EAAQ,GAAW,KAAK,K,sBAIrD,SAAS,EAAmB,GAC1B,OAAO,KAAK,KAAK,SAAS,EAAO,GAAW,KAAK,K,uBAUnD,SACE,EACA,GAEA,OAAO,KAAK,KAAK,UAAU,EAAS,GAAW,KAAK,K,2BAUtD,SACE,EACA,GAEA,OAAO,KAAK,KAAK,cAAc,EAAkC,GAAW,KAAK,K,wCAUnF,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,2BAA2B,EAAQ,EAAa,GAAW,KAAK,K,2CAUnF,SACE,EACA,GAEA,OAAO,KAAK,KAAK,8BAA8B,EAAQ,GAAW,KAAK,K,4CAUzE,SACE,GAEA,OAAO,KAAK,KAAK,+BAA+B,GAAW,KAAK,K,2CAUlE,SACE,GAEA,OAAO,KAAK,KAAK,8BAA8B,GAAW,KAAK,K,sBAUjE,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,SAAS,EAAW,EAAQ,GAAW,KAAK,K,sBAU/D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,SAAS,EAAW,EAAQ,GAAW,KAAK,K,wBAU/D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,WAAW,EAAQ,EAAmB,GAAW,KAAK,K,oCAUzE,SAAuB,GACrB,OAAO,KAAK,KAAK,uBAAuB,GAAW,KAAK,K,uBAU1D,SAAU,EAAoB,GAC5B,OAAO,KAAK,KAAK,UAAU,EAAQ,GAAW,KAAK,K,yBAUrD,SAAY,EAAoB,GAC9B,OAAO,KAAK,KAAK,YAAY,EAAQ,GAAW,KAAK,K,sCAUvD,SAAyB,GACvB,OAAO,KAAK,KAAK,yBAAyB,GAAW,KAAK,K,8BAU5D,SAAiB,EAA0B,GACzC,OAAO,KAAK,KAAK,iBAAiB,EAAc,GAAW,KAAK,K,2BAIlE,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,cAAc,EAAQ,EAAS,GAAW,KAAK,K,8BAUlE,SAAiB,EAAwB,GACvC,OAAO,KAAK,KAAK,iBAAiB,EAAW,GAAW,KAAK,K,4BAU/D,SAAe,EAAoB,GACjC,OAAO,KAAK,KAAK,eAAe,EAAQ,GAAW,KAAK,K,8BAU1D,SAAiB,EAAoB,GACnC,OAAO,KAAK,KAAK,iBAAiB,EAAQ,GAAW,KAAK,K,mDAU5D,SAAsC,GACpC,OAAO,KAAK,KAAK,sCAAsC,GAAW,KAAK,K,iCAUzE,SAAoB,GAClB,OAAO,KAAK,KAAK,oBAAoB,GAAW,KAAK,M,oBA1iBvD,SAAa,GACX,OAAI,cAAY,GACP,IAAI,EAAwB,wBAAsB,MAAM,IAExD,IAAI,EAAc,wBAAsB,MAAM,M,gDAsBzD,WACE,EACA,GAFF,2EAIS,EAJT,SAImC,WAAS,EAAkB,GAJ9D,iDAIuB,MAJvB,4D,gEAvDF,kB,IAslBM,E,8BAKJ,WAAY,GAA2C,wBACrD,cAAM,IAED,MAAQ,EAAS,MAH+B,E,kCAMvD,SAAS,GACP,YAAiB,IAAV,GAAuB,IAAU,KAAK,WAAW,a,GAXlD,I,qICzqBV,WAIA,SACA,SASa,oBAAoB,SAC/B,EACA,GAEE,IAAI,EAAQ,oBACR,EAAW,SAAO,GAClB,EAAQ,SAAO,EAAK,EAAM,QAHoB,EAI/B,cAAW,iBAAO,KAAK,IAAnC,EAJ2C,UAM9C,EAAW,eACf,SAAC,GACC,IAAM,EAAW,EAAO,EAAM,QAAS,GAElC,SAAO,EAAU,EAAM,WAC1B,EAAM,QAAU,EAChB,OAGJ,CAAC,IAaH,OAVA,aAAU,kBAAM,EAAM,WAAU,YAAM,OAAI,EAAQ,GAAG,KAAM,eAAkB,SAAY,CACvF,EACA,IAGE,EAAS,UAAY,IACvB,EAAM,QAAU,EAAK,EAAM,OAC3B,EAAS,QAAU,GAGd,CAAC,EAAM,QAAS,K,sHC7CzB,WAIA,SACA,SAEa,qBAAqB,SAAO,GACrC,IAAI,EAAQ,oBAD0E,EAEnE,cAAW,iBAAO,KAAK,IAAnC,EAF+E,UAcxF,OAVE,EAAF,WACE,WAAI,OACF,EAAM,WAAU,YAA2B,IAAxB,EAAwB,EAAxB,SAAU,EAAc,EAAd,SACtB,SAAO,EAAO,GAAW,EAAO,KACnC,SAGN,CAAC,EAAO,IAGH,EAAO,EAAM,S,wMCZhBG,EAAuC,CAC3CC,YAAaC,KAGf,SAASC,EAAyBC,EAAWC,GAC3C,OAAOA,KAAKD,EAGd,IAAME,EAAc,SAACC,GACnB,IAAMC,EAAM,eAAQR,GAEpB,GAAoB,kBAATO,GAA8B,OAATA,EAAe,CAC7C,GAAIJ,EAAOI,EAAM,gBAAuC,KAArBA,EAAKN,YAAoB,CAAC,IACnDA,EAAgBM,EAAhBN,YAEmB,kBAAhBA,GAA4BQ,oBAAUR,GAC/CO,EAAOP,YAAcS,qBAAWT,IAEhCU,QAAQC,MAAM,0BACdD,QAAQE,IAAIZ,IAIhB,GAAIE,EAAOI,EAAM,iBAAyC,KAAtBA,EAAKO,aAAqB,CAAC,IACrDA,EAAiBP,EAAjBO,aAEoB,kBAAjBA,EACTN,EAAOM,aAAeA,GAEtBH,QAAQC,MAAM,2BACdD,QAAQE,IAAIC,IAIhB,GAAIX,EAAOI,EAAM,eAAgB,CAAC,IACxBQ,EAAgBR,EAAhBQ,YAEmB,mBAAhBA,EACTP,EAAOO,YAAcA,GAErBJ,QAAQC,MAAM,0BACdD,QAAQE,IAAIE,UAIhBJ,QAAQC,MAAM,qBACdD,QAAQE,IAAIN,GAGd,OAAOC,GAGLQ,OAA4DC,EAE1DC,EAAW,uCAAG,4BAAApB,EAAA,+EAEOqB,MAAM,eAFb,WAEVC,EAFU,QAIFC,GAJE,sBAKR,IAAIC,MAAJ,8CAAiDF,EAASG,OAA1D,MALQ,mBAQTjB,EARS,SAQSc,EAASb,OARlB,qGAUhBI,QAAQC,MAAR,MAVgB,iCAWJZ,IAXI,0DAAH,qDAeJwB,EAAY,WAKvB,OAJKR,IACHA,EAAgBE,KAGXF,G,OC5DHS,EAAiBC,6BAA+CT,GAahEU,EAA6B,CAAC,YAAa,QAAS,UAAW,UAAW,UAEnEC,EAAkD,SAAC,GAKzD,IAJLC,EAII,EAJJA,SACAC,EAGI,EAHJA,OACAC,EAEI,EAFJA,2BACAC,EACI,EADJA,2BACI,EAC4CC,cAA/BC,EADb,EACIC,QAAmBC,EADvB,EACuBA,QAASC,EADhC,EACgCA,QADhC,EAEwBC,qBAFxB,mBAEG9B,EAFH,KAEW+B,EAFX,KAIEC,EAAaC,mBAAQ,WACzB,GAAIjC,GAAU0B,GAAYE,GAAWC,EACnC,IACE,OAAOK,4BAAkBR,EAAUA,EAASS,UAAUP,GAAUC,EAAS,CACvEO,YAAaR,EACbnC,YAAaO,EAAOP,YACpB4C,SAAU,gBAEZ,aAEH,CAACrC,EAAQ0B,EAAUE,EAASC,IAkC/B,GAhCAS,qBAAU,WACRtB,IAAYuB,KAAKR,KAChB,IAEHO,qBAAU,WACR,GAAItC,GAAUgC,EAAY,CAAC,IACjBN,EAAsBM,EAAtBN,SAAUG,EAAYG,EAAZH,QAMlB,GAJIW,4BAAkBd,IAAaA,EAASG,UAAYA,IACtDH,EAASG,QAAUA,GAGjBY,uCAA6Bf,GAAW,CAC1C,IAAMgB,EAAUC,YAAWd,GAY3B,OATEa,EAAQE,MACRzB,EAA2B0B,SAASH,EAAQE,OAC5C5C,EAAOM,aAEPoB,EAASoB,cAAT,MAAApB,EAAQ,YAhDD,SAACgB,EAAiBpC,GAAlB,MAA6D,CAAC,SAAD,OACvD,cAAZoC,EAA0B,UAAYA,EAD6B,4BACFpC,GAC1EoC,GA8CkCK,CAASL,EAAQE,KAAM5C,EAAOM,gBAC/C0B,EAAWgB,QACpBtB,EAASoB,cAAT,eAA+BG,OAAOC,SAASC,SAA/C,SAAgEtB,GAG3D,WACLH,EAAS0B,sBAId,CAACpD,EAAQgC,KAEPhC,IAAW0B,IAAaE,IAAYC,EACvC,OAAO,mCAAGP,IAGZ,GAAItB,EAAOO,aAA2B,IAAZsB,EACxB,OAAO,mCAAGL,IAGZ,IAAKQ,EACH,OAAOT,EAA6B,mCAAGA,EAA2BM,KAAe,KAGnF,IAAMwB,EAAUC,gBAAcC,MAAMvB,GAGpC,OAFAqB,EAAQG,MAAMC,SAAU,EAGtB,cAACxC,EAAeyC,SAAhB,CAAyBC,MAAO,CAAE3D,SAAQ4B,UAASF,WAAU2B,WAA7D,SACGhC,KAKMuC,EAAa,WACxB,IAAMC,EAAiBC,qBAAW7C,GAElC,IAAK4C,EACH,MAAM,IAAI/C,MAAM,yDAGlB,OAAO+C,GCtHIE,EAAoB,I,OAAIC,GAAkB,I,8CCgCvDrC,IAAQsC,IACNC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,KAGF,IAAMC,EAAU,SAACnD,GACf,OAAQA,GACN,IAAK,YACH,MAAO,CAAC,MAAO,aACjB,IAAK,kBACH,MAAO,CAAC,MAAO,mBACjB,QACE,OAAOA,IAQAoD,EAA4B,SAAC,GAAD,IAAGpD,EAAH,EAAGA,KAAMqD,EAAT,EAASA,MAAUC,EAAnB,uCACvC,cAAC,IAAD,aAAiBD,MAAOA,EAAOE,KAAMJ,EAAQnD,IAAWsD,KCnEpDE,EAAiB,SAACC,GACtB,OAAQA,GACN,IAAK,UACH,OAAO,cAAC,EAAD,CAAMzD,KAAK,eAAe0D,MAAM,UAAUC,aAAW,YAC9D,IAAK,UACH,OAAO,cAAC,EAAD,CAAM3D,KAAK,uBAAuB0D,MAAM,UAAUC,aAAW,YACtE,IAAK,SACH,OAAO,cAAC,EAAD,CAAM3D,KAAK,uBAAuB0D,MAAM,SAASC,aAAW,WACrE,IAAK,OACH,OAAO,cAAC,EAAD,CAAM3D,KAAK,cAAc0D,MAAM,OAAOC,aAAW,SAE5D,OAAO,MAGIC,EAAgC,SAAC,GAAD,IAC3CH,EAD2C,EAC3CA,OACAI,EAF2C,EAE3CA,MACAN,EAH2C,EAG3CA,KACAO,EAJ2C,EAI3CA,YACAC,EAL2C,EAK3CA,SACAtF,EAN2C,EAM3CA,SAN2C,OAQ3C,eAAC,IAAD,CAAMuF,GAAI,CAAEC,EAAG,EAAGC,aAAc,OAAhC,UACGT,EAAS,cAAC,IAAD,CAAKO,GAAI,CAAEG,OAAQ,MAAOC,GAAIX,EAAQS,aAAc,iBAAsB,KACpF,eAAC,IAAD,CACEF,GAAI,CACFK,eAAgB,gBAChBC,WAAY,SACZC,aAAc,EACdC,YAAa,QACbP,EAAG,CAAC,EAAG,GACPQ,GAAI,GAPR,UAUGlB,GAAQC,EAAeC,GACxB,cAAC,IAAD,CAASiB,GAAG,KAAKV,GAAI,CAAEW,UAAW,SAAUC,SAAU,CAAC,EAAG,GAAIC,GAAI,CAAC,EAAG,IAAtE,SACGhB,IAEH,cAAC,IAAD,CAAQiB,QAAQ,OAAOC,QAAShB,EAAhC,SACE,cAAC,EAAD,CAAM/D,KAAK,QAAQgF,KAAK,KAAKrB,aAAYG,GAAe,gBAG3DrF,MC5CQwG,EAA0C,SAAC,GAAD,IACrDpB,EADqD,EACrDA,MACAC,EAFqD,EAErDA,YACAC,EAHqD,EAGrDA,SACAmB,EAJqD,EAIrDA,WACAC,EALqD,EAKrDA,QACA1G,EANqD,EAMrDA,SANqD,OAQrD,eAAC,EAAD,CAAQgF,OAAO,SAASI,MAAOA,EAAOC,YAAaA,EAAaC,SAAUA,EAA1E,UACE,cAAC,IAAD,CAAKC,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SAAyBxF,IACzB,eAAC,IAAD,CACEuF,GAAI,CACFC,EAAG,CAAC,EAAG,GACPmB,UAAW,EACXZ,YAAa,QACbH,eAAgB,WAChBgB,cAAe,CAAC,SAAU,OAC1Bf,WAAY,UAPhB,UAUE,cAAC,IAAD,CACEQ,QAAQ,SACRd,GAAI,CACFsB,GAAI,CAAC,EAAG,GACRC,GAAI,CAAC,EAAG,GACRC,MAAO,CAAC,OAAQ,SAElBT,QAAShB,EAPX,SASGD,GAAe,WAElB,cAAC,IAAD,CAAQE,GAAI,CAAEwB,MAAO,CAAC,OAAQ,SAAWT,QAASI,EAAlD,SACGD,GAAc,iBChCVO,EAA8C,SAAC,GAAD,IACzD5B,EADyD,EACzDA,MACAN,EAFyD,EAEzDA,KACAmC,EAHyD,EAGzDA,WACA5B,EAJyD,EAIzDA,YACAC,EALyD,EAKzDA,SACAtF,EANyD,EAMzDA,SANyD,OAQzD,eAAC,EAAD,CAAQoF,MAAOA,EAAON,KAAMA,EAAMO,YAAaA,EAAaC,SAAUA,EAAtE,UACGtF,EACD,cAAC,IAAD,CAAKuF,GAAI,CAAEa,GAAI,CAAC,EAAG,GAAIJ,GAAI,CAAC,EAAG,IAA/B,SACE,eAAC,IAAD,CACET,GAAI,CACFqB,cAAe,CAAC,SAAU,OAC1BjB,GAAI,QACJH,EAAG,CAAC,EAAG,GACPK,WAAY,CAAC,SAAU,SAL3B,UAQE,cAAC,IAAD,CAASU,KAAK,MAAMhB,GAAI,CAAEsB,GAAI,CAAC,EAAG,GAAIC,GAAI,CAAC,EAAG,MAC9C,cAAC,IAAD,CAAMvB,GAAI,CAAEqB,cAAe,SAAUf,WAAY,CAAC,SAAU,eAA5D,SACGoB,aCvBEC,EAA4E,SAAC,GAAD,IACvF9B,EADuF,EACvFA,MACAN,EAFuF,EAEvFA,KACAQ,EAHuF,EAGvFA,SACAtF,EAJuF,EAIvFA,SAJuF,OAMvF,cAAC,EAAD,CACEoF,MAAOA,EACPN,KAAMA,EACNmC,WACE,qCACE,cAAC,IAAD,CAAM1B,GAAI,CAAE4B,WAAY,QAAxB,oDACA,cAAC,IAAD,oDAGJ9B,YAAY,oBACZC,SAAUA,EAVZ,SAYE,cAAC,IAAD,CAAKC,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SAAyBxF,OC3BhBoH,EAAyB,kBACpC,sBAAKL,MAAM,KAAKrB,OAAO,KAAK2B,QAAQ,YAAYC,KAAK,OAAOC,MAAM,6BAAlE,UACE,4DACA,sBACEC,EAAE,+IACFF,KAAK,YAEP,sBAAME,EAAE,oDAAoDF,KAAK,YACjE,sBAAMG,EAAE,UAAUC,EAAE,UAAUX,MAAM,UAAUrB,OAAO,IAAI4B,KAAK,YAC9D,sBACEE,EAAE,ylFACFF,KAAK,gBCVEK,EAAkB,SAAC,GAAD,IAAG3H,EAAH,EAAGA,SAAH,OAC7B,cAAC,IAAD,CAAWqG,QAAQ,eAAnB,SACE,cAAC,IAAD,CAAWA,QAAQ,QAAnB,SAA4BrG,OC2B1B4H,EAAsE,SAACC,EAAOC,GAClF,OAAQA,EAAOC,MACb,IAAK,kBACH,MAAO,CACLA,KAAM,aACNC,UAAWF,EAAOE,WAEtB,IAAK,mBACH,MAAO,CACLD,KAAM,SACNC,UAA0B,aAAfH,EAAME,KAAsBrF,EAAoBmF,EAAMG,WAErE,IAAK,OACH,GAAmB,aAAfH,EAAME,KACR,MAAO,CACLA,KAAMD,EAAO/I,MAAMkJ,QAAQC,MAAM,kBAC7B,iBACAJ,EAAO/I,MAAMkJ,QAAQC,MAAM,oBAC3B,iBACA,SACJF,UAAWH,EAAMG,WAGrB,MACF,IAAK,QACH,GAAmB,aAAfH,EAAME,KACR,MAAO,CACLA,KAAM,aACNC,UAAWH,EAAMG,WAGrB,MACF,IAAK,SAIL,IAAK,aACH,MAAO,CACLD,KAAM,YASZ,OALAjJ,QAAQqJ,KAAK,sCACbrJ,QAAQE,IAAI8I,GACZhJ,QAAQE,IAAI,eACZF,QAAQE,IAAI6I,GAELA,GASIO,EAAkD,SAAC,GAA0B,IAAxBpI,EAAuB,EAAvBA,SAAUC,EAAa,EAAbA,OAAa,EACvCG,cAAxCiI,EAD+E,EAC/EA,SAAUC,EADqE,EACrEA,WAAYC,EADyD,EACzDA,OAAQxJ,EADiD,EACjDA,MAChCyJ,EC1ED,WAA6C,IAAD,EACpBpI,cAArBiI,EADyC,EACzCA,SAAUE,EAD+B,EAC/BA,OAD+B,EAEvB9H,oBAAS,GAFc,mBAE1CgI,EAF0C,KAEnCC,EAFmC,KAyBjD,OArBAzH,qBAAU,YACuB,uCAAG,sBAAAhD,EAAA,+EAEpByE,EAAkBiG,eAFE,kDAGtBN,EAAS3F,OAAmBtD,GAAW,GAHjB,mCAKtB,IAAIK,MAAM,gBALY,yDAQ9BiJ,GAAS,GARqB,0DAAH,oDAW/BE,KACC,CAACP,IAEJpH,qBAAU,WACJsH,GACFG,GAAS,KAEV,CAACH,IAEGE,EDiD2BI,GAFqD,EAGnDC,qBAAWlB,EAAmB,CAAEG,KAAM,aAHa,mBAGhFgB,EAHgF,KAG/DC,EAH+D,KAIjFC,EAVe,8CAAOrH,OAA4BsH,gBAAnC,aAAM,EAAuCD,kBAA7C,SAUFE,GAiBnB,OAfAlI,qBAAU,WACJlC,IACFiK,EAAS,CAAEjB,KAAM,OAAQhJ,UACzBuJ,OAED,CAACvJ,EAAOuJ,IAEXrH,qBAAU,WAEN+H,EADET,EACO,CAAER,KAAM,oBAER,CAAEA,KAAM,iBAElB,CAACQ,IAECC,EAIwB,WAAzBO,EAAgBhB,KACX,mCAAG/H,IAIV,qCACE,cAAC,IAAD,CAAMuF,GAAI,CAAEG,OAAQ,QAASE,eAAgB,SAAUC,WAAY,UAAnE,SACE,cAAC,IAAD,CACES,QAAS,WACP0C,EAAS,CAAEjB,KAAM,kBAAmBC,UAAWtF,IAC/C2F,EAAS3F,IAHb,SAMGuG,EACC,qCACE,cAAC,EAAD,IACA,cAAC,IAAD,CAAK1D,GAAI,CAAE6D,GAAI,GAAf,oCAGF,qCACE,cAAC,EAAD,CAAM7H,KAAK,OAAOgF,KAAK,OACvB,cAAC,IAAD,CAAKhB,GAAI,CAAE6D,GAAI,GAAf,mCAMkB,WAAzBL,EAAgBhB,MACf,cAAC,EAAD,UACE,eAAC,EAAD,CACE3C,MAAO6D,EAAa,gCAAkC,2BACtD3D,SAAU,kBAAM0D,EAAS,CAAEjB,KAAM,YACjCrB,QAAS,WACPsC,EAAS,CAAEjB,KAAM,UACjBM,EAASU,EAAgBf,YAL7B,UAQE,cAAC,IAAD,CAAKzC,GAAI,CAAEW,UAAW,UAAtB,4EAGA,eAAC,IAAD,CAAMX,GAAI,CAAE8D,WAAY,GAAKC,KAAK,oCAAoCC,OAAO,SAA7E,wBACa,cAAC,EAAD,CAAMhD,KAAK,KAAKhF,KAAK,8BAMd,eAAzBwH,EAAgBhB,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MACE6D,EAAa,iCAAmC,oCAElDnE,KAAMmE,EAAa,cAAC,EAAD,IAAmB,cAAC,EAAD,CAAM1H,KAAK,SAASgF,KAAK,OAC/DjB,SAAU,kBAAM0D,EAAS,CAAEjB,KAAM,YALnC,SAOE,eAAC,IAAD,CAAMxC,GAAI,CAAEW,UAAW,UAAvB,sDAEG+C,EACC,mHAEA,+GAOgB,mBAAzBF,EAAgBhB,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MAAM,qBACNE,SAAU,kBAAM0D,EAAS,CAAEjB,KAAM,YACjCrB,QAAS,WACPsC,EAAS,CAAEjB,KAAM,UACjBM,EAASU,EAAgBf,YAL7B,SAQE,cAAC,IAAD,6EAKoB,mBAAzBe,EAAgBhB,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MAAM,+BACNE,SAAU,kBAAM0D,EAAS,CAAEjB,KAAM,YACjCrB,QAAS,WACPsC,EAAS,CAAEjB,KAAM,UACjBM,EAASU,EAAgBf,YAL7B,SAQE,cAAC,IAAD,iGAhGD,mCAAG/H,K,0CE7FP,SAASuJ,EAAT,GAIc,IAHnBxJ,EAGkB,EAHlBA,SACAiI,EAEkB,EAFlBA,QAEkB,IADlBwB,iBACkB,MADN,MACM,EACZC,EAAQC,mBADI,EAEMlJ,oBAAS,GAFf,mBAEXmJ,EAFW,KAELC,EAFK,OAG8BpJ,qBAH9B,mBAGXqJ,EAHW,KAGOC,EAHP,OAIwBtJ,qBAJxB,mBAIXuJ,EAJW,KAIIC,EAJJ,OAMaC,YAAUJ,EAAkBE,EAAe,CAAEP,cAApEU,EANU,EAMVA,OAAQC,EANE,EAMFA,WAEhB,OACE,qCACGC,IAAMC,aAAaD,IAAME,SAASC,KAAQxK,GAAW,CAIpDyK,YAAa,WACXf,EAAMgB,QAAU,OAEXd,GACHC,GAAQ,IAIZc,WAAY,WACVjB,EAAMgB,QAAU,MAEhBE,YAAW,WACa,QAAlBlB,EAAMgB,SACRb,GAAQ,KAET,IAGLgB,IAAKd,IAGNH,GACC,cAAC,IAAD,yBAAMvD,QAAQ,UAAUwE,IAAKZ,EAAkBrF,MAAOuF,EAAOW,QAAYV,EAAWU,QAApF,aACG7C,QCzCX,IAEM8C,GAA2B,CAC/BC,cAAe,OACfC,UAAW,QACXC,WAAY,6BAGRC,GAAe,CACnBC,YATkB,GAUlBjB,OAAQkB,YAAY,2BACfN,IADc,IAEjBO,uBAAwB,OAItBC,GAAe,CACnBH,YAjBkB,GAkBlBjB,OAAQkB,YAAY,2BACfN,IADc,IAEjBO,uBAAwB,QAiDtBE,GAAqBnB,IAAMxK,mBAE/BT,GAEWqM,GAAgC,SAAC,GAAkB,IAAhBzL,EAAe,EAAfA,SACxC0L,EAAmBjL,mBAA2B,CAAEsH,KAAM,SAC5D,OACE,cAACyD,GAAmBnJ,SAApB,CAA6BC,MAAOoJ,EAApC,SAAuD1L,KAIrD2L,GAAsB,WAC1B,IAAMD,EAAmBjJ,qBAAW+I,IAEpC,IAAKE,EACH,MAAM,IAAIjM,MAAM,iEAGlB,OAAOiM,GAGIE,GAAwB,SAACC,GAA6C,IAAD,EACrDF,KAApBD,EADyE,oBAGhF,MAAiC,SAA1BA,EAAiB3D,OACL,kBAAT8D,EAAoBH,EAAiBI,KAAOD,EAAOH,EAAiBI,GAAG5D,MAAM2D,IACnFH,EACA,CAAE3D,KAAM,SAkCDgE,GAAyB,SACpCD,EACAE,GACgF,IAAD,EAC/BL,KAD+B,mBACxED,EADwE,KACtDO,EADsD,KA6B/E,MAAO,CA1BiBC,sBAAW,sBAAC,4BAAAjO,EAAA,6DAClCgO,EAAoB,CAAElE,KAAM,qBAAsB+D,OADhB,kBAIfE,IAJe,OAI1BG,EAJ0B,OAMhCF,EAAoB,CAClBlE,KAAM,yBACN+D,KACAK,OAT8B,gDApCnB,kBADCpN,EAiDC,EAAD,KA/CR,OAAVA,GACA,YAAaA,GACsC,kBAA3CA,EAA+BkJ,SA6CV,KAAMA,QAAQzG,SAAS,qCAC9CyK,EAAoB,CAAElE,KAAM,YAAa+D,QAEzChN,QAAQC,MAAR,MAEAkN,EAAoB,CAClBlE,KAAM,SACN+D,KACA/M,MAAO,IAAIU,MAAM,6CApBW,kCArCnB,IAACV,IAqCkB,oBAwBjC,CAACiN,EAAMF,EAAIG,IAEWP,IAGpB,SAASU,GAAT,GAQkB,IAAD,EAPtBN,EAOsB,EAPtBA,GACAO,EAMsB,EANtBA,QACAC,EAKsB,EALtBA,iBACAC,EAIsB,EAJtBA,YACAC,EAGsB,EAHtBA,SACAR,EAEsB,EAFtBA,KACAhM,EACsB,EADtBA,SACsB,EACsB+L,GAAuBD,EAAIE,GADjD,mBACfS,EADe,KACEf,EADF,KAEhBgB,EAAUrC,IAAME,SAASC,KAAQxK,GAEjC2M,GAAkBH,GAAY,IACjCI,QAAO,0CACPC,KAAI,0CAGqB,uBAA1BnB,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,MAEjB4E,EAAeG,KAAK,kCAMtB,IAAMC,EACY,iBAJlBR,EACEI,EAAeK,OAAS,EAAxB,UAA4BT,SAA5B,QAA4CF,EAAU,YAAc,mBAAiBjN,GAIjFiL,IAAMC,aACJoC,EACA,CACEO,UAAU,EACV5G,QAAS,UAEXsG,EAAe,IAED,cAAhBJ,EACAlC,IAAMC,aAAaoC,EAAS,CAAEO,UAAU,IACxC5C,IAAMC,aAAaoC,EAAS,CAAEpG,QAASmG,IAM7C,MAJoB,cAAhBF,IACFF,EAAUM,EAAe,IAGpBN,EACL,mCACE,cAAC7C,EAAD,CAASvB,QAASoE,EAAS5C,UAAW6C,GAAoB,QAA1D,SACGS,MAILA,EAMJ,IAAMG,GAAoB,uCAAG,WAAO7M,EAAoB8L,GAA3B,eAAAlO,EAAA,+EAEJoC,EAAS8M,KAAKhB,EAAIA,EAAGiB,aAFjB,UAEnBC,EAFmB,OAIrBC,wBAAcD,GAAU,KAAO,GAAoC,eAA/BE,uBAAaF,EAAQ,EAAG,GAJvC,yCAKfG,IAAgBC,OAAO,CAAC,UAAWF,uBAAaF,EAAQ,IAAiB,IAL1D,qFAQlBjO,GARkB,yDAAH,wDAYpBsO,GAAQrD,IAAMsD,KAClBC,KACA,uBAAGtL,QAAH,EAAoBA,SAOhBuL,GAAoE,SAAC,GAAe,IAAbhG,EAAY,EAAZA,MAAY,EAC7DpH,mBAAS,GADoD,mBAChF6B,EADgF,KACzEwL,EADyE,KAYvF,OARA7M,qBAAU,WACM,cAAV4G,EACF+C,YAAW,kBAAMkD,EAJJ,KAIwB,IAErClD,YAAW,kBAAMkD,EAASC,OAAkB,MAE7C,CAAClG,IAEa,cAAVA,EACL,cAAC6F,GAAD,wCAAapL,QAAOyL,SAXL,GAWkBxC,KAAjC,aACE,cAAC,EAAD,CAAMhK,KAAK,QAAQ0D,MAAM,QAAQsB,KAAK,UAE5B,WAAVsB,GAAgC,cAAVA,EACxB,cAAC6F,GAAD,yBAAOpL,MAAO,GAAd,aAAuByL,SAfR,GAeqBxC,KAApC,aACE,cAAC,EAAD,CAAMhK,KAAK,QAAQ0D,MAAM,QAAQsB,KAAK,UAGxC,cAACmH,GAAD,wCAAapL,QAAOyL,SAnBL,GAmBkB5C,KAAjC,aACE,cAAC,EAAD,CAAM5J,KAAK,MAAM0D,MAAM,QAAQsB,KAAK,KAAKyH,MAAI,QAKtCC,GAA+B,WAAO,IACzC5N,EAAakC,IAAblC,SADwC,EAEAsL,KAFA,mBAEzCD,EAFyC,KAEvBO,EAFuB,KAI1CH,EAA+B,SAA1BJ,EAAiB3D,KAAkB2D,EAAiBI,QAAK1M,EAC9D+M,EAA+B,2BAA1BT,EAAiB3D,KAAoC2D,EAAiBS,QAAK/M,EA2GtF,OAzGA6B,qBAAU,WACR,GAAI6K,GAAMK,EAAI,CACZ,IAAI+B,GAAY,EACZC,GAAW,EAETC,EAASjC,EAAGkC,mBAAmBC,KAE/BC,EAAmB,uCAAG,kCAAAtQ,EAAA,+EAEFkO,EAAGqC,iBAFD,UAElBC,EAFkB,QAIpBP,EAJoB,oDAQhBQ,EAAkBD,EAAQE,WAA1BD,cACFtB,EAAcqB,EAAQE,WAAWvB,YAAcsB,EAAgB,EACrE5P,QAAQE,IAAR,iBAAsBoO,EAAtB,YAAqCsB,EAArC,wBAAkEN,IAClEtP,QAAQE,IAAR,+BAAoCoP,IACpCD,GAAW,EAEY,cAAnBM,EAAQ/O,OAdY,iBAetBZ,QAAQE,IAAR,UAAeyP,IAEfxC,EAAoB,CAClBlE,KAAM,mBACN+D,OAnBoB,yCAsBDoB,GAAqB7M,EAAUoO,EAAQE,YAtBtC,WAsBhBC,EAtBgB,QAwBlBV,EAxBkB,mDA4BtBpP,QAAQC,MAAR,aAAoBqP,EAApB,YACIQ,GACF9P,QAAQC,MAAR,yBAAgC6P,IAGlC3C,EAAoB,CAClBlE,KAAM,SACN+D,KACA/M,MAAO,IAAIU,MAAMmP,EAAM,oBAAgBA,GAAW,YApC9B,8DAwCpBV,EAxCoB,mDA4CxBC,GAAW,EAEP,gBAAoBU,mCACtB/P,QAAQE,IAAR,uBAA4BoP,IAC5BnC,EAAoB,CAAElE,KAAM,YAAa+D,SAEzChN,QAAQC,MAAR,uCAA8CqP,IAC9CtP,QAAQC,MAAR,MAEAkN,EAAoB,CAClBlE,KAAM,SACN+D,KACA/M,MAAO,IAAIU,MAAM,aAxDG,0DAAH,qDAiEzB,OAHAX,QAAQE,IAAR,8BAAmCoP,IACnCG,IAEO,WACAJ,IACHlC,EAAoB,CAAElE,KAAM,SAC5BjJ,QAAQE,IAAR,+BAAoCoP,IACpCF,GAAY,OAIjB,CAAC7N,EAAUyL,EAAIK,EAAIF,IAEtBhL,qBAAU,WACR,GAA8B,qBAA1ByK,EAAiB3D,MAA+B+D,EAElDG,EAAoB,CAAElE,KAAM,YAAa+D,YACpC,GACqB,cAA1BJ,EAAiB3D,MACS,WAA1B2D,EAAiB3D,MACS,cAA1B2D,EAAiB3D,KACjB,CACA,IAAImG,GAAY,EAQhB,OANAtD,YAAW,WACJsD,GACHjC,EAAoB,CAAElE,KAAM,WAE7B,KAEI,WACLmG,GAAY,MAGf,CAACxC,EAAiB3D,KAAMkE,EAAqBH,IAElB,SAA1BJ,EAAiB3D,MAA6C,uBAA1B2D,EAAiB3D,KAChD,KAIP,eAAC,IAAD,CACExC,GAAI,CACFM,WAAY,SACZF,GAC4B,cAA1B+F,EAAiB3D,KACb,UAC0B,cAA1B2D,EAAiB3D,KACjB,UAC0B,WAA1B2D,EAAiB3D,KACjB,SACA,UACNvC,EAAG,EACHsJ,GAAI,EACJC,SAAU,QACVhI,MAAO,QACPiI,OAAQ,EACRC,SAAU,UAhBd,UAmBE,cAAC,IAAD,CAAK1J,GAAI,CAAEsB,GAAI,EAAGE,MAAO,OAAQrB,OAAQ,QAAzC,SACE,cAAC,GAAD,CAA0BmC,MAAO6D,EAAiB3D,SAGpD,cAAC,IAAD,CAAMxC,GAAI,CAAEY,SAAU,EAAGlB,MAAO,SAAhC,SAC6B,2BAA1ByG,EAAiB3D,KACd,2BAC0B,cAA1B2D,EAAiB3D,KACjB,YAC0B,WAA1B2D,EAAiB3D,KACjB2D,EAAiB3M,MAAMkJ,QACvB,kBChbNiH,GACE,UASFC,GAAS,CACbC,QAASF,GACTG,UAVQ,UAWRC,OAVM,UAYNC,QAXO,UAYPC,QAXQ,UAYRC,OAXK,UAYLC,YAXU,UAYVC,KAAMT,GACNU,QAAS,OAETC,KAAM,UACNC,WAAY,QACZC,MAAO,WAGHC,GAAiC,CACrCC,QAAS,OACTpK,WAAY,SACZD,eAAgB,SAEhB,WAAY,CAAEsK,OAAQ,YAGlBC,GAA0B,2BAC3BH,IAD2B,IAG9B5J,GAAI,OACJgK,GAAI,OAEJnL,MAAO,QACPoL,OAAQ,EAERlJ,WAAY,OAEZ,YAAa,CACXmJ,QAAS,MAIPC,GAAgB,SAACtL,EAAeuL,GAAhB,MAA4D,CAChFvL,QACAc,YAAad,EACb6K,WAAY,OAEZ,iBAAkB,CAChB7K,MAAO,aACPU,GAAI6K,EACJzK,YAAayK,KAIXC,GAA8B,2BAC/BT,IAD+B,IAGlCU,QAAS,EACT3J,MAAO,OACPrB,OAAQ,OAERoK,WAAY,OAEZ,YAAa,CACX7K,MAAO,OACPqL,QAAS,OAIPK,GAAsB,QAEtBC,GAAW,CAAC,EAAG,EAAG,GAClBC,GAAW,CAAC,EAAG,EAAG,GAElBC,GAA2B,CAC/B/B,SAAU,WACVgC,GAAIF,GACJR,OAAQ,EACRW,UAAW,CAAC,EAAG,KAAM,IAGjBC,GAA4B,2BAC7BH,IAD6B,IAGhCJ,QAAS,EAET3K,YAAa,wBACb+J,WAAY,4CAEZoB,GAAI,CACFpK,GAAI,EACJX,SAAUwK,MAIRQ,GAA+B,CACnClB,QAAS,QACTlJ,MAAO,OACPqK,WAAY,EACZV,QAAS,EACTvK,SAAU,GAGNkL,GAA4B,2BAC7BF,IAD6B,IAGhCxL,GAAI,aACJ0K,OAAQ,EACRtK,YAAa,QACbN,aAAc,EACduL,UAAW,CAAC,EAAG,KAYXM,GAAmC,CACvCvC,SAAU,QAEVwC,KAAM,EACNC,IAAK,EACLzK,MAAO,QACPrB,OAAQ,SAGJ+L,GAAqC,CACzC3B,WAAW,0BAAD,OAA4BX,GAAOW,WAAnC,aAAkDX,GAAOY,MAAzD,MA0VG2B,GAvVM,CACnBC,YAAa,CAAC,OAAQ,OAAQ,QAE9BC,MAAO,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAEvCC,MAAO,CACLC,KAAM,CACJ,YACA,gBACA,qBACA,aACA,SACA,mBACA,cACAC,KAAK,MACPC,QAAS,UACTC,UAAW,oBAGbC,UAAW,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAE5CC,YAAa,CACXL,KAAM,IACNE,QAAS,IAETI,MAAO,IACPC,OAAQ,IACRC,KAAM,KAGRC,YAAa,CACXT,KAAM,IACNE,QAAS,MAGX7C,UAEAqD,QAAS,CAAC,EAAG,YAAa,aAE1BC,QAAS,CAAC,IAAK,oCAAqC,sCAEpD5C,KAAM,CACJ9R,QAAS,CACP2U,WAAY,YACZvM,SAAU,IAIdwM,QAAS,CACPvD,QAAQ,2BACHe,IADE,IAGLxK,GAAI,UACJI,YAAa,UAEb,iBAAkB,CAChBJ,GAAI,YACJI,YAAa,eAIjB6M,QAAQ,2BACHzC,IACAI,GAAc,UAAW,cAG9BsC,OAAO,uCACF1C,IACAI,GAAc,OAAQ,SAFrB,IAIJD,QAAS,KAGXb,OAAO,2BACFU,IADC,IAGJxK,GAAI,SACJI,YAAa,SAEb,iBAAkB,CAChBJ,GAAI,cACJI,YAAa,iBAIjBjB,KAAK,2BACA2L,IADD,IAEFxL,MAAO,UACP,iBAAkB,CAAEA,MAAO,YAG7B6N,WAAW,2BACNrC,IADK,IAERxL,MAAO,SACP,iBAAkB,CAAEA,MAAO,iBAG7B8N,UAAU,2BACLtC,IADI,IAEPxL,MAAO,OACP,iBAAkB,CAAEA,MAAO,cAI/B+N,MAAO,CACL5D,QAAQ,2BACH0B,IADE,IAGLJ,QAAS,EAET3K,YAAa,QACbJ,GAAI,aAEJ,OAAQ,CACNsK,QAAS,OACTrK,eAAgB,gBAChBC,WAAY,SAEZH,OAAQ,OAERoJ,GAAI,EACJsB,GAAI,EACJ6C,GAAI,EAEJtN,GAAI,QAEJQ,SAAUwK,MAIdhB,KAAK,2BACAsB,IADD,IAGFhB,QAAS,CAAC,OAAQ,WAGpBiD,UAAU,2BACLjC,IADI,IAGPlC,SAAU,QACVyC,IAAK,EACL2B,MAAO,EACP5B,KAAM,EACNR,GAAI,OACJrL,OAAQ,MACR0N,UAAW,WAGb/G,QAAS,CACPqE,QAAS,EAETL,OAAQ,EACRtK,YAAa,QACbN,aAAc,MACdE,GAAI,aACJqL,UAAW,EAEX7K,SAAU,EACVlB,MAAO,OACPkC,WAAY,OACZkM,OAAQ,IAIZC,MAAO,CACLC,MAAM,eACDpC,IAGLqC,KAAK,2BACAnC,IADD,IAGFnL,UAAW,SACXP,GAAI,UAGN8N,MAAM,2BACDpC,IADA,IAGHqC,KAAM,IAGRC,OAAQ,IAGVC,OAAQ,CACNC,OAAO,yBACL5D,QAAS,OACTrK,eAAgB,gBAChBC,WAAY,UAEZkJ,SAAU,CAAC,QAAS,YACpBhI,MAAO,QACPyK,IAAK,EACL6B,OAAQ,EAERjN,GAAI,CAAC,EAAG,OAAQ,OAAQ,GACxBgK,GAAI,CAAC,EAAG,OAAQ,SAEbqB,IAbC,IAcJT,UAAW,CAAC,EAAG,UAGjB8C,OAAQ,CACN7D,QAAS,OACTpK,WAAY,SACZD,eAAgB,SAEhBmL,GAAIF,GACJzK,GAAI,EACJ2N,UAAW,OAEXpO,GAAI,SAGNqO,KAAM,CACJjN,MAAO,OACPkN,SAAU,QACVC,GAAI,OACJnD,GAAI,CAAC,OAAQ,GACbjK,GAAI,CAAC,OAAQ,QACbV,GAAIwK,IAGNuD,QAAS,CACPlE,QAAS,OACTmE,SAAU,OACVC,aAAc,UAGhB9C,KAAM,CACJ0B,GAAIrC,GACJ7J,MAAO,CAAC,OAAQ,QAGlBoM,MAAO,CACLpM,MAAO,CAAC,OAAQ,QAGlBuN,QAAS,CACP1O,eAAgB,WAChBmL,GAAI,EAEJZ,OAAQ,CACN/G,GAAI,IAIRmL,gBAAgB,2BA9QgB,CAClCxF,SAAU,WAEVwC,KAAM,EACNC,IAAK,EACLzK,MAAO,OACPrB,OAAQ,SAwQS,IAGbC,GAAI,6BAGN2L,aAAa,2BACRA,IADO,IAGV3L,GAAI,qBAEJsK,QAAS,OACTrK,eAAgB,SAChBC,WAAY,WAGd2O,MAAO,CACL9D,QAAS,EACT3J,MAAO,CAAC,OAAQ,SAGlB0N,YAAY,2BACPnD,IADM,IAGTrB,QAAS,CAAC,QAAS,QAEnBtK,GAAI,6BAGN+O,YAAa,CACXzE,QAAS,OACTrK,eAAgB,SAChB+O,EAAG,EACH9O,WAAY,SACZ+O,SAAU,SAGZC,QAAQ,aACN5E,QAAS,CAAC,OAAQ,QAClBrJ,cAAe,SACfpB,EAAG,EACHmP,EAAG,EACH5O,YAAa,QACbc,GAAI,OACJnB,OAAQ,QACL+L,IAGLqD,MAAO,CACLzE,OAAQ,EACR5K,aAAc,EACdD,EAAG,EACHY,GAAI,EACJ2O,gBAAiB,QACjB9P,MAAO,QACPkB,SAAU,EACVgB,WAAY,SAIhBgD,OAAQ,CACN6K,KAAM,CACJtC,WAAY,OACZrJ,WAAY,OACZlC,WAAY,OAEZzB,OAAQ,OAER,QAAS,CACPA,OAAQ,SAIZzH,EAAG,CACDgH,MAAO,UACP,SAAU,CAAEA,MAAO,UACnBgQ,eAAgB,OAChB9N,WAAY,SAIhB+N,MAAO,CACLC,IAAK,CACH/O,GAAI,EACJgK,GAAI,EACJjJ,WAAY,SACZhB,SAAU,EACViP,cAAe,YACfC,cAAe,MACftO,MAAO,CAAC,OAAQ,QAChBgK,GAAI,CAAC,EAAG,W,iCC/dDuE,GAAb,WAUE,WAAYC,EAAaC,GAAwD,IAA9BC,EAA6B,uDAAL,IAAK,0BAT/DF,SAS+D,OARxEzJ,GAAa,EAQ2D,KAN/D4J,YAM+D,OAL/DC,kBAK+D,OAH/DF,eAG+D,OAFxEG,YAAa,EAGnBC,KAAKN,IAAMA,EACXM,KAAKH,OAASI,KAAOC,eACrBF,KAAKF,aAAe,IAAIG,KAAON,GAC/BK,KAAKJ,UAAYO,WAAQC,KAAKR,GAdlC,+CAiBE,SAAmB1X,GACjB,IAAM2X,EAAS,CAACG,KAAKH,OAAQG,KAAKF,cAAcO,MAC9C,SAAAR,GAAM,OAAIA,EAAO3X,QAAQoY,gBAAkBpY,EAAQoY,iBAGrD,IAAKT,EACH,MAAM,IAAIjW,MAAJ,yBAA4B1B,IAGpC,OAAO2X,IA1BX,yDA6BE,uGACSG,KAAK7J,KAAK,sBAAuB,CACtC,CACEiK,KAAMJ,KAAKF,aAAa5X,QACxBqY,GAAIP,KAAKH,OAAO3X,QAChBuE,MAAOuT,KAAKJ,UAAUY,IACtBC,IAAKC,kBAAQ,UANnB,gDA7BF,+GA0CE,WAAWC,EAAgBC,GAA3B,gCAAAxY,EAAA,yDACO4X,KAAKD,WADZ,uBAEIC,KAAKD,YAAa,EAFtB,SAGUC,KAAKa,OAHf,YAMUF,EANV,OAOS,iBAPT,MAQS,wBART,OAWS,wBAXT,gDASa,CAACX,KAAKH,OAAO3X,UAT1B,mBAYa8X,KAZb,UAccc,QAAQC,IACZH,EAAO5J,IAAP,uCAAW,mCAAA5O,EAAA,yDAASgY,EAAT,EAASA,KAAMY,EAAf,EAAeA,MAAOP,EAAtB,EAAsBA,IAAQzR,EAA9B,2CACKzF,IAAVyX,EADK,gCAEO,EAAK7K,KAAK,0BAA2B,CAACiK,IAF7C,OAEPY,EAFO,uCAKF,EAAKC,WAAWb,GAAMc,gBAAtB,yBACLd,OACAY,cACYzX,IAARkX,EAAoB,CAAEU,SAAUV,GAAQ,IACzCzR,KATI,2CAAX,wDAfV,kDAYkBmH,KAZlB,UAaQ,yBAbR,gCAiCyB1M,MAAMuW,KAAKN,IAAK,CACrCiB,OAAQ,OACRS,QAAS,CACP,eAAgB,oBAElBnF,KAAMoF,KAAKC,UAAU,CACnBX,OAAQA,EACRC,OAAQA,EACR3K,GAAI+J,KAAK/J,KACTsL,QAAS,UA1Cf,eAiCQ7X,EAjCR,iBA8CqBA,EAASb,OA9C9B,aA8CQA,EA9CR,QAkDWK,MAlDX,yBAmDiCL,EAAKK,MAA1BkJ,EAnDZ,EAmDYA,QAAYpD,EAnDxB,2BAoDU9F,EAAQ,IAAIU,MAAJ,UAAawI,EAAb,YAAwBiP,KAAKC,UAAUtS,KAC/CwS,OAAOC,OAAOvY,EAAO8F,GArD/B,iCAwDSnG,EAAK2O,QAxDd,iDA1CF,8EAqGE,YAAgE,IAAtDmJ,EAAqD,EAArDA,OAAQC,EAA6C,EAA7CA,OAChB,OAAOZ,KAAK7J,KAAKwK,EAAQC,OAtG7B,K,2BCLac,GAAO,OACPC,GAAK,OACLC,GAAK,SCFLC,GAAiB,SAAC3Z,GAAD,OAAqBA,EAAQ4Z,OAAO,EAAG,GAAK,MAAQ5Z,EAAQ4Z,QAAQ,ICY5FC,GAAS,SAAC,GAAD,MAAsE,CACnFC,eADa,EAAGA,eAEhBC,YAFa,EAAmBA,YAGhCC,YAHa,EAAgCA,cAMlCC,GAAwB,WAAO,IAClCzX,EAAYgC,IAAZhC,QADiC,EAEY0X,8BAAmBL,IAAhEC,EAFiC,EAEjCA,eAAgBC,EAFiB,EAEjBA,YAAaC,EAFI,EAEJA,YAErC,OACE,eAAC,IAAD,CAAKxS,GAAI,CAAE0K,QAAS,CAAC,OAAQ,SAA7B,UACE,eAAC,IAAD,CAAM1K,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMtE,KAAK,cAAcgF,KAAK,OAC9B,eAAC,IAAD,CAAMhB,GAAI,CAAE6D,GAAI,EAAGvC,GAAI,EAAGD,cAAe,UAAzC,UACE,cAAC,IAAD,CAASrB,GAAI,CAAEY,SAAU,GAAzB,0BACA,cAAC,IAAD,CAAMF,GAAG,OAAOV,GAAI,CAAEY,SAAU,GAAhC,SACGuR,GAAenX,WAKtB,eAAC,IAAD,CAAMgF,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMtE,KAAK,SAASgF,KAAK,OAEvB,CACA,CAAC,MAAOsR,GACR,CAACN,GAAMO,GACP,CAACN,GAAIO,IACKlL,KAAI,WAAsBqL,GAAtB,uBAAEC,EAAF,KAAYC,EAAZ,YACd,eAAC,IAAD,CAAc7S,GAAI,CAAE6D,GAAI,EAAGxC,cAAe,UAA1C,UACE,cAAC,IAAD,CAASrB,GAAI,CAAEY,SAAU,GAAzB,SAA+BgS,IAC/B,cAAC,IAAD,CAAM5S,GAAI,CAAEY,SAAU,GAAtB,SAA4BiS,EAAQC,eAF3BH,a,UChCRI,GAAoC,SAAC,GAAmD,IAAD,IAAhD7O,iBAAgD,MAApC,QAAoC,EAA3B4C,EAA2B,EAA3BA,QAA2B,IAAlB9F,YAAkB,MAAX,KAAW,EAClG,OACE,cAAC,KAAD,CAAOgS,aAAa,EAAM9O,UAAWA,EAAW+O,QAASnM,EAAS4H,SAAS,QAA3E,SACE,wCAEE,cAAC,EAAD,CAAM1S,KAAK,kBAAkBgF,KAAMA,UCN9BkS,GAAsC,SAAC,GAAiC,IAA/BlX,EAA8B,EAA9BA,KAAM8K,EAAwB,EAAxBA,QAASrM,EAAe,EAAfA,SACnE,OACE,eAAC,IAAD,CAAMuF,GAAI,CAAEO,aAAc,EAAGC,YAAa,sBAA1C,UACE,eAAC,IAAD,CAAMR,GAAI,CAAEM,WAAY,SAAUD,eAAgB,aAAc8N,KAAM,IAAKvM,WAAY,KAAvF,UACE,cAAC,IAAD,UAAO5F,IACN8K,GAAW,cAAC,GAAD,CAAU9F,KAAK,KAAK8F,QAAS,cAAC,IAAD,CAAMhG,QAAQ,UAAd,SAAyBgG,SAEpE,cAAC,IAAD,CAAM9G,GAAI,CAAEK,eAAgB,aAAc8N,KAAM,GAAK7N,WAAY,UAAjE,SAA8E7F,QCN9E0Y,GAAiB,SAAC,GAAD,MAAsE,CAC3Fb,eADqB,EAAGA,eAExBC,YAFqB,EAAmBA,YAGxCC,YAHqB,EAAgCA,cAMjDY,GAAqB,WAAO,IAAD,EACsBV,8BAAmBS,IAAhEb,EADuB,EACvBA,eAAgBC,EADO,EACPA,YAAaC,EADN,EACMA,YAErC,OACE,eAAC,IAAD,CAAKxS,GAAI,CAAEuB,GAAI,GAAf,UACE,cAAC,IAAD,kCACA,eAAC,GAAD,CAAWvF,KAAK,MAAhB,cAAwBsW,EAAeQ,SAAS,MAChD,eAAC,GAAD,CAAW9W,KAAMgW,GAAjB,cAAyBO,EAAYO,cACrC,cAAC,GAAD,CAAW9W,KAAMiW,GAAjB,SAAsBO,EAAYM,iBAKlCO,GAAgD,SAAC,GAAD,IAAG5Y,EAAH,EAAGA,SAAH,OAC5C,OAARA,QAAQ,IAARA,OAAA,EAAAA,EAAUkI,MAAM,iBACd,cAAC,IAAD,CAAMoB,KAAI,gDAA2CtJ,GAArD,SAAkEA,EAAS2X,OAAO,EAAG,KAErF,gDAQEC,GAAS,SAAC,GAAD,IACbiB,EADa,EACbA,eACAC,EAFa,EAEbA,MACAC,EAHa,EAGbA,MACAC,EAJa,EAIbA,oBACAC,EALa,EAKbA,cACAC,EANa,EAMbA,eACAC,EAPa,EAObA,gBACAC,EARa,EAQbA,SARa,MASW,CACxBP,iBACAC,QACAC,QACAC,sBACAC,gBACAC,iBACAC,kBACAE,aAAkC,eAApBD,EAAS1Z,OAA0B0Z,EAASC,aAAe,OAG9DC,GAA0C,SAAC,GAAwC,IAAD,IAArCjT,eAAqC,MAA3B,OAA2B,EAAnBkT,EAAmB,EAAnBA,aAAmB,EAKzFhX,IAHFP,QACErB,WAAuB6Y,EAHkE,EAG3EC,QAA2BC,EAHgD,EAGhDA,eAAgBtb,EAHgC,EAGhCA,YAHgC,EAezF6Z,8BAAmBL,IAPrBiB,EAR2F,EAQ3FA,eACAC,EAT2F,EAS3FA,MACAE,EAV2F,EAU3FA,oBACAD,EAX2F,EAW3FA,MACAE,EAZ2F,EAY3FA,cACAE,EAb2F,EAa3FA,gBACAE,EAd2F,EAc3FA,aAGIM,EACJZ,EAAMa,KAAKC,SAAW,IAAIC,WAAQd,EAAoBe,IAAIhB,EAAMa,OAC5DI,EAA0B,IAAIF,WAAQf,EAAMkB,gBAAgBnB,IAC5DoB,EAAkB,IAAIJ,WAAQb,GAC9BkB,EAAkB/b,IAAgBC,IAAc,MAA9B,OAAsCgb,QAAtC,IAAsCA,OAAtC,EAAsCA,EAAce,IAAI,KAAK/B,WAErF,OACE,eAAC,IAAD,CAAYhS,UAAZ,UACGkT,GAAgB,cAAC,GAAD,IAEjB,cAAC,IAAD,iCAEA,cAAC,IAAD,CAAStT,GAAG,KAAKV,GAAI,CAAEwL,GAAI,EAAG5J,WAAY,QAA1C,sBAIA,cAAC,GAAD,CACE5F,KAAK,gBACL8K,QAAQ,sMAFV,SAIG6N,EAAgBG,SAAS,KAG5B,eAAC,GAAD,CACE9Y,KAAK,MACL8K,QAAQ,qHAFV,UAIG0M,EAAMuB,WAAWC,UAJpB,IAI+B,cAAC,IAAD,CAAMhV,GAAI,CAAEY,SAAU,GAAtB,qBAC7B,eAAC,IAAD,CAAMZ,GAAI,CAAEY,SAAU,GAAtB,mBACW6P,WAAQC,KAAK8C,EAAMuB,WAAWF,IAAItB,IAAQyB,UADrD,UAIF,cAAC,GAAD,CAAWhZ,KAAK,SAAS8K,QAAQ,mDAAjC,SACG2J,WAAQC,KAAK4C,GAAgBR,SAAS,KAEzC,cAAC,GAAD,CAAW9W,KAAK,cAAc8K,QAAQ,iDAAtC,SACG0M,EAAMa,KAAKW,YAEbZ,GACC,eAAC,GAAD,CACEpY,KAAK,yBACL8K,QAAQ,oHAFV,UAKG2M,EAAoBuB,UACrB,eAAC,IAAD,CAAMhV,GAAI,CAAEY,SAAU,GAAtB,kBAAmCwT,EAAuBU,SAAS,GAAnE,UAGJ,cAAC,GAAD,CACE9Y,KAAK,cACL8K,QAAQ,mEAFV,SAIG8M,EAAgBoB,YAEnB,cAAC,GAAD,CACEhZ,KAAK,yBACL8K,QAAQ,yHAFV,SAIG2N,EAAwB3B,aAE3B,cAAC,GAAD,CACE9W,KAAK,gBACL8K,QAAQ,2UAFV,SAIG0M,EAAMyB,+BAA+B1B,GAAS,cAAC,IAAD,CAAK7T,MAAM,SAAX,iBAAgC,OAIjF,cAAC,IAAD,CAASgB,GAAG,KAAKV,GAAI,CAAEwL,GAAI,EAAG5J,WAAY,QAA1C,sBAGCgT,GACC,eAAC,GAAD,CACE5Y,KAAK,gBACL8K,QAAQ,iLAFV,UAIG8N,EAJH,OAQF,eAAC,IAAD,CAAK5U,GAAI,CAAEwL,GAAI,EAAGT,QAAS,KAA3B,UACE,eAAC,IAAD,CAAK/K,GAAI,CAAEY,SAAU,GAArB,gCACqB,cAAC,GAAD,UAAeqT,OAEpC,eAAC,IAAD,CAAKjU,GAAI,CAAEY,SAAU,GAArB,uBAAqCuT,EAAee,oBACpD,eAAC,IAAD,CAAKlV,GAAI,CAAEY,SAAU,GAArB,8BACoB,IAIhB,cAAC,GAAD,UAAeuU,uDC/JrB9C,GAAS,SAAC,GAAD,MAA0C,CAAEmB,MAA5C,EAAGA,MAAgDD,MAAnD,EAAUA,QAEZ6B,GAA6B,WAAO,IAAD,EACrB1C,8BAAmBL,IAApCkB,EADsC,EACtCA,MAAOC,EAD+B,EAC/BA,MAD+B,EAGAtY,oBAAS,GAHT,mBAGvCma,EAHuC,KAGtBC,EAHsB,KAIxCC,EAAwBnR,iBAAuB,MAErD,OACE,qCACE,eAAC,IAAD,CACErD,QAAS,kBAAMuU,GAAoBD,IACnCvU,QAAQ,OACRd,GAAI,CACFwJ,SAAU,WACVkB,QAAS,CAAC,QAAS,SALvB,UAQE,cAAC,EAAD,CAAM1O,KAAK,cAAcgF,KAAK,OAE7BwS,EAAMyB,+BAA+B1B,IACpC,cAAC,IAAD,CACEvT,GAAI,CACFwJ,SAAU,WACVoE,MAAO,EACP3B,IAAK,EACLzK,MAAO,OACPrB,OAAQ,OAERG,WAAY,aACZD,eAAgB,WAChBmV,GAAI,MAEJ9V,MAAO,UAZX,SAeE,cAAC,EAAD,CAAM1D,KAAK,qBAAqBgF,KAAK,YAK1CqU,GACC,cAAC,IAAD,CACEvU,QAAQ,cACRwE,IAAKiQ,EACLxU,QAAS,SAAA0U,GACHA,EAAEzR,SAAWuR,EAAsBpQ,SACrCmQ,GAAmB,IALzB,SASE,cAAC,GAAD,CAAaxU,QAAQ,YAAYkT,cAAY,UCrD1C0B,GAA0C,SAAC,GAAD,IAAGvV,EAAH,EAAGA,OAAWwV,EAAd,iCACrD,cAAC,IAAD,yBAAK3V,GAAI,CAAE8D,WAAY,IAAS6R,GAAhC,aACE,cAAC,IAAD,CAAOC,IAAI,kBAAkB5V,GAAI,CAAEG,gBCJjC0V,GAAqC,SAAAC,GACzC,OAAO,cAAC,KAAD,aAAYC,OAAK,GAAKD,KAGlBE,GAAgC,SAAAF,GAC3C,OAAO,cAAC,IAAD,2BAAoBA,GAApB,IAA2BpV,GAAImV,OCP3BI,GAAgB,WAC3B,OACE,eAAC,IAAD,CAAKvV,GAAG,MAAMV,GAAI,CAAE0K,QAAS,CAAC,OAAQ,QAASpK,WAAY,SAAU6N,KAAM,GAA3E,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CAAM0C,GAAG,IAAT,uBACA,cAAC,GAAD,CAAMA,GAAG,QAAT,qBAEF,eAAC,IAAD,CAAM7Q,GAAI,CAAEK,eAAgB,WAAYiB,GAAI,EAAG6M,KAAM,GAArD,UACE,cAAC,GAAD,CAAMnO,GAAI,CAAEY,SAAU,GAAKiQ,GAAG,gBAA9B,0BAGA,cAAC,GAAD,CAAM7Q,GAAI,CAAEY,SAAU,GAAKiQ,GAAG,cAA9B,+BCNKqF,GAAoB,WAAO,IAAD,EACHhb,oBAAS,GADN,mBAC9Bib,EAD8B,KACnBC,EADmB,KAE/BC,EAAUjS,iBAAuB,MAEvC,OAAK+R,EAQH,cAAC,IAAD,CACErV,QAAQ,cACRwE,IAAK+Q,EACLtV,QAAS,SAAA0U,GACHA,EAAEzR,SAAWqS,EAAQlR,SACvBiR,GAAa,IALnB,SASE,eAAC,IAAD,CAAMtV,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEd,GAAI,CAAEwJ,SAAU,QAASoE,MAAO,OAAQwB,EAAG,GAC3CtO,QAAQ,OACRC,QAAS,kBAAMqV,GAAa,IAH9B,SAKE,cAAC,EAAD,CAAMpa,KAAK,QAAQgF,KAAK,SAE1B,cAAC,GAAD,CAAab,OA/BF,OA+BsBF,EAAG,IACpC,eAAC,IAAD,CAAKS,GAAG,MAAMV,GAAI,CAAEoP,EAAG,EAAG5D,GAAI,EAAGvL,EAAG,GAAKc,QAAS,kBAAMqV,GAAa,IAArE,UACE,cAAC,GAAD,CAAMvF,GAAG,IAAT,uBACA,cAAC,GAAD,CAAMA,GAAG,QAAT,kBACA,cAAC,GAAD,CAAMA,GAAG,gBAAT,0BACA,cAAC,GAAD,CAAMA,GAAG,cAAT,gCA5BJ,cAAC,IAAD,CAAQ7Q,GAAI,CAAE0K,QAAS,CAAC,OAAQ,SAAW5J,QAAQ,OAAOC,QAAS,kBAAMqV,GAAa,IAAtF,SACE,cAAC,EAAD,CAAMpa,KAAK,OAAOgF,KAAK,UCFzBqR,GAAS,SAAC,GAAD,MAAsC,CACnDwB,SADa,EAAGA,WAILyC,GAAmB,SAAC,GAAkB,IAAhB7b,EAAe,EAAfA,SAErB5B,EACRmE,IADF5D,OAAUP,YAEJgb,EAAanB,8BAAmBL,IAAhCwB,SACF0C,EAAuB1d,IAAgBC,KAAmC,eAApB+a,EAAS1Z,OAErE,OACE,eAAC,IAAD,CAAW2G,QAAQ,SAAnB,UACE,eAAC,IAAD,CAAMd,GAAI,CAAEM,WAAY,SAAU6N,KAAM,GAAxC,UACE,cAAC,GAAD,CAAahO,OAhBF,SAkBX,cAAC,IAAD,CACEH,GAAI,CACF2O,GAAI,CAAC,EAAG,GACRnN,MAAO,MACPrB,OAAQ,OACRqW,WAAY,CAAC,OAAQ,0BAGxBD,GACC,qCACE,cAAC,GAAD,IACA,cAAC,GAAD,UAKL9b,MCzCMgc,GAA8B,SAAC,GAAD,IAAGhc,EAAH,EAAGA,SAAH,OACzC,cAAC,IAAD,CACEuF,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEH6K,OAAQ,EACR5K,aAAc,MACdM,YAAa,SACbiL,UAAW,EACXrL,GAAI,4BAbR,SAgBE,eAAC,IAAD,CAAMJ,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMtE,KAAK,cAAcgF,KAAK,OAC9B,cAAC,IAAD,CAAMhB,GAAI,CAAE6D,GAAI,GAAhB,SAAsBpJ,UAKfic,GAAmB,SAAC,GAAD,IAAGjc,EAAH,EAAGA,SAAH,OAC9B,cAAC,IAAD,CAAMuF,GAAI,CAAE4B,WAAY,OAAQ+U,WAAY,UAA5C,SAAyDlc,KCjB9Cmc,GAA0B,SAAC,GAA0D,IAAxD5W,EAAuD,EAAvDA,GAAIgO,EAAmD,EAAnDA,MAAO6I,EAA4C,EAA5CA,QAASC,EAAmC,EAAnCA,SAAUrc,EAAyB,EAAzBA,SAAUsc,EAAe,EAAfA,SAChF,OACE,eAAC,IAAD,CAAM/W,GAAE,aAAIM,WAAY,WAAcN,GAAtC,UACE,cAAC,IAAD,CACEuG,GAAIsQ,EACJG,QAASF,EACT9W,GAAI,CACFC,EAAG,EACHsJ,GAAI,EACJiM,GAAI,OACJhM,SAAU,WAEV5I,SAAU,EACVkK,OAAQ,EACRtK,YAAa,eAXjB,SAcE,eAAC,IAAD,CAAMR,GAAI,CAAEM,WAAY,UAAxB,UACG0N,EACA+I,GAAYA,OAGhBtc,MASDwc,GAAuD,SAAC,GAAD,IAAGjX,EAAH,EAAGA,GAAIjD,EAAP,EAAOA,MAAP,OAC3D,eAAC,IAAD,CAAYiD,KAAZ,cAEa,OAAVjD,EACC,cAAC,EAAD,CAAMf,KAAK,oBACC,OAAVe,EACF,cAAC,EAAD,CAAMf,KAAK,uBACJ,OAALe,QAAK,IAALA,OAAA,EAAAA,EAAOma,WAAW,MACpB,qCACE,cAAC,EAAD,CAAMlb,KAAK,aADb,IAC4Be,EAAMqV,OAAO,OAElC,OAALrV,QAAK,IAALA,OAAA,EAAAA,EAAOma,WAAW,MACpB,qCACE,cAAC,EAAD,CAAMlb,KAAK,eADb,IAC8Be,EAAMqV,OAAO,MAG3CrV,EAfJ,QAgCWoa,GAAuD,SAAC,GAW9D,IAVLnX,EAUI,EAVJA,GACAoX,EASI,EATJA,QACAC,EAQI,EARJA,WACAC,EAOI,EAPJA,OACArJ,EAMI,EANJA,KACAvO,EAKI,EALJA,MACA6X,EAII,EAJJA,cACAC,EAGI,EAHJA,aACAzW,EAEI,EAFJA,QACAtG,EACI,EADJA,SAEA,OACE,eAAC,IAAD,CACE8L,GAAI6Q,EACJK,kBAAiBJ,EACXtW,UACNf,GAAE,qCACAK,eAAgB,gBAChBC,WAAY,UAERS,EAAU,CAAE4J,OAAQ,QAAW,IAEhC+M,IACA1X,GAXP,UAcE,eAAC,IAAD,CAAMA,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,IAAD,CAAMN,GAAI,CAAEN,QAAOkC,WAAY,UAA/B,SAA4C0V,IAE3CrJ,GACC,4CAEE,cAAC,IAAD,CAAMjO,GAAI,CAAE4B,WAAY,QAASmJ,QAAS,IAA1C,SAAkDkD,OAIrDsJ,GACC,4CAEE,cAAC,GAAD,CACEvX,GAAI,CAAEN,MAAO8X,EAAczM,QAAS,GAAKnK,SAAU,WACnD7D,MAAOwa,UAMd9c,MAKDid,GAAoC,CACxCC,SAAU,EAEVpW,GAAI,EACJgI,GAAI,EACJmE,GAAI,OACJjN,GAAI,EACJ+U,GAAI,OAEJ5U,SAAU,EAEVkK,OAAQ,EACRtK,YAAa,eAGToX,GAAsC,CAC1CD,SAAU,EAEVpW,GAAI,CAAC,EAAG,GACRgI,GAAI,EACJmE,GAAI,OACJjN,GAAI,EACJ+U,GAAI,OAEJ5U,SAAU,EAEV6K,UAAW,CAAC,EAAG,GACfX,OAAQ,EACRtK,YAAa,SAKFqX,GAAsC,SAAC,GAAD,IACjD7J,EADiD,EACjDA,MACA6I,EAFiD,EAEjDA,QACAC,EAHiD,EAGjDA,SACAC,EAJiD,EAIjDA,SACGjB,EAL8C,gEAOjD,cAAC,GAAD,CAAW9H,QAAO6I,UAASC,WAAUC,WAAY/W,GAAI,CAAEwL,GAAI,EAAE,GAAI,GAAI/K,GAAI,CAAC,EAAG,IAA7E,SACE,cAAC,GAAD,eAAmBqV,OAQVgC,GAA0D,SAAC,GAAD,IACrEV,EADqE,EACrEA,QACApJ,EAFqE,EAErEA,MACAC,EAHqE,EAGrEA,KACAqJ,EAJqE,EAIrEA,OACA5X,EALqE,EAKrEA,MACA6X,EANqE,EAMrEA,cACAC,EAPqE,EAOrEA,aAPqE,OASrE,cAAC,GAAD,CAAKX,QAAO,UAAKO,EAAL,UAA4BpJ,QAAOC,OAA/C,SACE,cAAC,GAAD,CACEjO,GAAE,2BAAO4X,IAAP,IAAsBnM,UAAW,IACnC4L,WAAU,UAAKD,EAAL,UACJA,UAASE,SAAQrJ,OAAMvO,QAAO6X,gBAAeC,oBAa5CO,GAA0C,SAAC,GAajD,IAZL/J,EAYI,EAZJA,MACAoJ,EAWI,EAXJA,QACAnJ,EAUI,EAVJA,KACAqJ,EASI,EATJA,OACA5X,EAQI,EARJA,MACA6X,EAOI,EAPJA,cACAC,EAMI,EANJA,aACAQ,EAKI,EALJA,aACAC,EAII,EAJJA,aACAC,EAGI,EAHJA,gBACAC,EAEI,EAFJA,UACAC,EACI,EADJA,SACI,cAC0BJ,EAD1B,GACGK,EADH,KACYC,EADZ,OAE0Bpd,oBAAS,GAFnC,mBAEGmP,EAFH,KAEYkO,EAFZ,KAIJ,OAAOF,IAAYjB,EACjB,cAAC,GAAD,CAAWpJ,QAAO8I,SAAUM,EAASnJ,OAArC,SACE,cAAC,IAAD,CACEuK,WAAS,EACTjS,GAAI6Q,EACJ5U,KAAK,SACLiW,KAAK,MACLC,aAAcT,EACR5N,UACNsO,SAAU,SAAAlD,GACR,IACEyC,EAAgBzC,EAAEzR,OAAOjH,OACzBwb,GAAW,GACX,SACAA,GAAW,KAGfK,OAAQ,WACNN,OAAWze,GACX0e,GAAW,IAEbzX,QAAQ,SACRd,GAAE,2BACG4X,IADH,IAEAhW,WAAY,SACZxB,GAAIiK,EAAU,UAAY,mBAKhC,cAAC,GAAD,CAAKwM,QAAO,UAAKO,EAAL,UAA4BpJ,QAAOC,OAA/C,SACE,cAAC,GAAD,CACEjO,GAAE,2BACG4X,IADH,IAEAxX,GAAIiK,EAAU,UAAY,eAE5BgN,WAAU,UAAKD,EAAL,UACVrW,QAAS,kBAAMuX,EAAWlB,IACpBA,UAASE,SAAQrJ,OAAMvO,QAAO6X,gBAAeC,eAAcnN,UAPnE,SASG8N,GACC,cAAC,IAAD,CACEnY,GAAI,CAAEY,SAAU,EAAGX,EAAG,EAAGY,GAAI,GAC7BE,QAAS,SAAAoD,GACP+T,EAAgBC,GAChBhU,EAAM0U,mBAERnR,SAAU0Q,EANZ,sBCnQGU,GAA2B,kBACtC,cAAC,IAAD,CACEhY,QAAQ,kBACRd,GAAI,CAAEC,EAAG,OAAQyK,QAAS,OAAQrK,eAAgB,YAFpD,SAIE,cAAC,IAAD,CAASW,KAAK,OAAOhB,GAAI,CAAEN,MAAO,aCQzBqZ,GAAkD,SAAC,GAAuB,IAAD,UAApBhc,EAAoB,EAApBA,MAAOic,EAAa,EAAbA,OACjEC,EAAqB,IAAI1E,WAAJ,OAAYxX,QAAZ,IAAYA,IAAS,CAAE+X,SAAU,iBAAM,SAC5DoE,EAAYF,GAAU,IAAIzE,WAAQyE,GACxC,OACE,qCACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAKhZ,GAAI,CAAEwL,GAAI,CAAC,EAAG,GAAI3H,GAAI,EAAGvC,IAAK,EAAGV,SAAU,QAAhD,SACE,cAAC,EAAD,CAAM5E,KAAK,gBAGb,cAAC,GAAD,CACEgS,MAAM,mBACNoJ,QAAQ,yBACRE,OAAQ2B,EAAmBnG,WAC3BpT,OACO,OAAL3C,QAAK,IAALA,OAAA,EAAAA,EAAOoc,GAAGC,+BACN,WACK,OAALrc,QAAK,IAALA,OAAA,EAAAA,EAAOoc,GAAG,MACV,WACK,OAALpc,QAAK,IAALA,OAAA,EAAAA,EAAOsc,IAAI,MACX,SACA,QAEN9B,eACQ,OAANyB,QAAM,IAANA,GAAA,UAAAA,EAAQM,gBAAR,mBAAkBC,qBAAlB,eAAiCJ,GAAG,KAChC,MACM,OAANH,QAAM,IAANA,GAAA,UAAAA,EAAQQ,gBAAR,mBAAkBD,qBAAlB,eAAiCJ,GAAG,KACpC,KADA,OAEAD,QAFA,IAEAA,GAFA,UAEAA,EAAWO,WAAW,UAFtB,aAEA,EAA0B3G,WAEhC0E,cAAoB,OAANwB,QAAM,IAANA,OAAA,EAAAA,EAAQM,UAAW,UAAY,SAC7CvC,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,gXAYJ,OAALzE,QAAK,IAALA,OAAA,EAAAA,EAAO2c,GAAG,OACT,cAAC,GAAD,6FC/BFrH,GAAS,SAAC,GAAD,MAAmC,CAAEkB,MAArC,EAAGA,QAELoG,GAA0C,SAAC,GAOjD,IANLlf,EAMI,EANJA,SACAmf,EAKI,EALJA,SACAC,EAII,EAJJA,OACAC,EAGI,EAHJA,IACApG,EAEI,EAFJA,cACAqG,EACI,EADJA,cAEQxG,EAAUb,8BAAmBL,IAA7BkB,MAEFyG,EAAS,IAAIzF,WAAQb,GAErBuG,EAA2BL,EAASM,aAA4CrgB,EAAlC+f,EAASlF,gBAAgBnB,GACvEmB,EAAmBmF,EAAOK,aAA0CrgB,EAAhCggB,EAAOnF,gBAAgBnB,GAC3D4G,EAAwBC,cAAWC,QAAQ3F,EAAiBuF,GAElE,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBAEA,eAAC,IAAD,CAAKja,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,aACNoJ,QAAQ,mBACRE,OAAQuC,EAAO9E,WAAWjC,SAAS,GACnC7E,KAAK,QAGP,cAAC,GAAD,CAAWD,MAAM,OAAOoJ,QAAQ,aAAaE,OAAQuC,EAAOxF,KAAKvB,WAAY7E,KAAM+D,KAElF4H,EAASM,SACR,cAAC,GAAD,CACElM,MAAM,sBACNoJ,QAAQ,4BACRE,OAAM,UAAKgD,6BACXrM,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAWV,cAAC,GAAD,CACEwM,MAAM,gBACNoJ,QAAQ,sBACRE,OAAQwC,EAAIhF,SAAS,GACrByC,cAAeyC,EAAOlF,SAAS,GAC/B7G,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAAC,GAAD,CAAiBzE,MAAO2X,EAAiBsE,OAAQmB,IAEhD1f,KAGFsf,GAAiB,cAAC,GAAD,QC7FXQ,GAA0C,SAAC,GAMjD,IALL9f,EAKI,EALJA,SACA+f,EAII,EAJJA,cACAxB,EAGI,EAHJA,OACAyB,EAEI,EAFJA,iBACAC,EACI,EADJA,kCAEQje,EAAYO,IAAZP,QADJ,EAGsB+J,GACxBgU,EACgB,aAAhBxB,EAAOxW,KACH/F,EAAQgK,KAAKkU,UAAUC,KAAKne,EAAQgK,KAAMuS,EAAO9H,OAAQ,CACvDuJ,mBACAC,sCAEc,YAAhB1B,EAAOxW,KACP/F,EAAQgK,KAAKoU,WAAWD,KAAKne,EAAQgK,MACrChK,EAAQgK,KAAKqU,YAAYF,KAAKne,EAAQgK,KAAMuS,EAAO9H,OAAQ,CACzDuJ,mBACAC,uCAXDxT,EAHH,oBAkBJ,OAAO,cAAC,IAAD,CAAQnG,QAASmG,EAAjB,SAAmCzM,KC9B/BsgB,GAAmBzgB,wBAA2C,MAE9D0gB,GAAe,WAC1B,IAAMC,EAAuC/d,qBAAW6d,IAExD,GAAgB,OAAZE,EACF,MAAM,IAAI/gB,MAAM,0DAGlB,OAAO+gB,GCbIC,GAA6B,SAAC,GAAD,IAAGzgB,EAAH,EAAGA,SAAH,OACxC,cAAC,IAAD,CACEuF,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEH6K,OAAQ,EACR5K,aAAc,MACdM,YAAa,SACbiL,UAAW,EACXrL,GAAI,2BAbR,SAgBE,eAAC,IAAD,CAAMJ,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMtE,KAAK,uBAAuBgF,KAAK,OACvC,cAAC,IAAD,CAAMhB,GAAI,CAAE6D,GAAI,GAAhB,SAAsBpJ,UCHtB0gB,GAAa,IAAI5G,WAAQ6G,6BAA0BtG,SAAS,GAC5DuG,GAAa,IAAI9G,WAAQ6E,8BAA2BtE,SAAS,GAM7DwG,GAAqE,SAAC,GAAD,IAAGpK,EAAH,EAAGA,OAAH,OACzE,eAAC,GAAD,WACGA,EAAOqK,mBAAqBrK,EAAOsK,WAClC,yDACmB,eAAC,GAAD,WAAStK,EAAOqK,kBAAkBzI,WAAlC,UADnB,eAC0F,IACxF,eAAC,GAAD,WACG5B,EAAOsK,WAAW1I,WADrB,IACkCd,SAGlCd,EAAOuK,WAAavK,EAAOwK,mBAC7B,oDACe,IACb,eAAC,GAAD,WACGxK,EAAOuK,UAAU3I,WADpB,IACiCd,MACvB,IAJZ,eAKc,eAAC,GAAD,WAASd,EAAOwK,mBAAmB5I,WAAnC,aAEZ5B,EAAOqK,mBAAqBrK,EAAOuK,UACrC,yDACmB,eAAC,GAAD,WAASvK,EAAOqK,kBAAkBzI,WAAlC,UADnB,WACsF,IACpF,eAAC,GAAD,WACG5B,EAAOuK,UAAU3I,WADpB,IACiCd,SAGjCd,EAAOsK,YAActK,EAAOwK,mBAC9B,yDACmB,eAAC,GAAD,WAASxK,EAAOwK,mBAAmB5I,WAAnC,UADnB,OACmF,IACjF,eAAC,GAAD,WACG5B,EAAOsK,WAAW1I,WADrB,IACkCd,SAGlCd,EAAOqK,kBACT,yDACmB,eAAC,GAAD,WAASrK,EAAOqK,kBAAkBzI,WAAlC,aAEjB5B,EAAOwK,mBACT,yDACmB,eAAC,GAAD,WAASxK,EAAOwK,mBAAmB5I,WAAnC,aAEjB5B,EAAOsK,WACT,wDACmB,IACjB,eAAC,GAAD,WACGtK,EAAOsK,WAAW1I,WADrB,IACkCd,SAIpC,oDACe,IACb,eAAC,GAAD,WACGd,EAAOuK,UAAU3I,WADpB,IACiCd,SAjDvC,QAyDW2J,GAAiC,SAAC,GAAD,MAMpB,CAAEpI,MANkB,EAC5CA,MAKiCC,MANW,EAE5CA,MAIwClB,eANI,EAG5CA,eAGwDC,YANZ,EAI5CA,YAEqEe,eANzB,EAK5CA,iBAYWsI,GAAsB,SACjCC,EACAC,EACApI,EACAqI,GAII,IACIvI,EAAiBuI,EAAjBvI,MAAOD,EAAUwI,EAAVxI,MACTyF,EAAS6C,EAAcG,YAAYF,EAAepI,GAExD,IAAKsF,EACH,MAAO,MAACnf,OAAWA,GAKrB,IAAMoiB,EAAiBJ,EAAcK,MAAMlD,EAAQtF,GAC7CyI,EAAe3I,EAAMyB,+BAA+B1B,GACpD6I,EAA2B5I,EAC9B6I,SAASR,GACTxe,IAAI4e,GACJhH,+BAA+B1B,GAE5B0H,EAAqC,2BACtCc,GADsC,IAEzCF,gBACAI,iBACAE,eACAC,6BAGF,GAAoB,oBAAhBpD,EAAOxW,KAET,MAAO,MACL3I,EACA,eAAC,GAAD,yCAC8B,IAC5B,eAAC,GAAD,WACGyiB,qBAAkBxH,WADrB,IACkC9C,MAHpC,QAUJ,IAAMuK,EACY,aAAhBvD,EAAOxW,KACHga,GAAsBxD,EAAO9H,OAAQ+J,GACrB,YAAhBjC,EAAOxW,KACPia,GAAqBzD,EAAO9H,OAAQ+J,GACpCyB,GAAwB1D,EAAO9H,OAAQ+J,GAE7C,OAAIsB,EACK,MAAC1iB,EAAW0iB,GAGd,CAACvD,EAAQ,cAAC,GAAD,CAAwB9H,OAAQ8H,EAAO9H,WAGnDsL,GAAwB,SAAC,EAAD,GASJ,IARtBjB,EAQqB,EARrBA,kBAAmBC,EAQE,EARFA,WAEnBS,EAMqB,EANrBA,eACAE,EAKqB,EALrBA,aACAC,EAIqB,EAJrBA,yBACA9J,EAGqB,EAHrBA,eACAiB,EAEqB,EAFrBA,MAGF,GAAIiI,EAAW9B,GAAGiD,0BAChB,OACE,eAAC,GAAD,sCAC2B,IACzB,eAAC,GAAD,WACGA,yBAAsB7H,WADzB,IACsC9C,MAHxC,OAUJ,GAAImK,GACF,IAAKF,EAAeW,yBAAyBrJ,GAC3C,OACE,eAAC,GAAD,gEACoD,cAAC,GAAD,UAAS8H,KAD7D,gGAMC,CACL,GAAIY,EAAeY,8BAA8BtJ,GAC/C,OACE,eAAC,GAAD,gDACoC,cAAC,GAAD,UAAS4H,KAD7C,OAMJ,GAAIiB,EACF,OACE,eAAC,GAAD,2GAEQ,cAAC,GAAD,UAASf,KAFjB,sDAQN,OAAIE,EAAkBpC,GAAG7G,GAErB,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WAASiJ,EAAkBuB,IAAIxK,GAAgBQ,WAA/C,UAFF,OAOG,MAGH4J,GAA0B,SAAC,EAAD,GAWN,IAVtBnB,EAUqB,EAVrBA,kBAAmBG,EAUE,EAVFA,mBAAoBF,EAUlB,EAVkBA,WAAYC,EAU9B,EAV8BA,UAEnDI,EAQqB,EARrBA,cACAI,EAOqB,EAPrBA,eACAE,EAMqB,EANrBA,aACAC,EAKqB,EALrBA,yBACA7I,EAIqB,EAJrBA,MACAjB,EAGqB,EAHrBA,eACAC,EAEqB,EAFrBA,YAGF,GAAI4J,EAAc,CAChB,GAAIT,EACF,OACE,cAAC,GAAD,8EAMJ,GAAIF,EAAY,CACd,GAAIS,EAAehH,+BAA+B1B,GAChD,OACE,eAAC,GAAD,qDACyC,cAAC,GAAD,UAAS8H,KADlD,4EAOJ,GAAIY,EAAevH,gBAAgBnB,GAAOmG,GAAGmC,EAAcnH,gBAAgBnB,IACzE,OACE,cAAC,GAAD,8FAMD,CACL,GAAI0I,EAAeY,8BAA8BtJ,GAC/C,OACE,eAAC,GAAD,gDACoC,cAAC,GAAD,UAAS4H,KAD7C,OAMJ,GAAIiB,EACF,OACE,eAAC,GAAD,uGAC4F,IAC1F,cAAC,GAAD,UAASf,KAFX,sDAQN,GAAII,EAAW,CACb,GAAIQ,EAAe5H,KAAKqF,GAAG4C,sBACzB,OACE,eAAC,GAAD,yCAC8B,IAC5B,eAAC,GAAD,WACGA,qBAAkBxH,WADrB,IACkC9C,MAHpC,OAUJ,GAAIyJ,EAAUtC,GAAG5G,GACf,OACE,eAAC,GAAD,uEAC4D,IAC1D,eAAC,GAAD,WACGkJ,EAAUqB,IAAIvK,GAAaO,WAD9B,IAC2Cd,MAH7C,OAWN,cAAIuJ,QAAJ,IAAIA,OAAJ,EAAIA,EAAmBpC,GAAG7G,IAEtB,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WAASiJ,EAAkBuB,IAAIxK,GAAgBQ,WAA/C,UAFF,OAOG,MAGH2J,GAAuB,SAAC,EAAD,GAQH,IAPtBhB,EAOqB,EAPrBA,UAEAU,EAKqB,EALrBA,aACAC,EAIqB,EAJrBA,yBACA9I,EAGqB,EAHrBA,eACAf,EAEqB,EAFrBA,YAGF,OAAuB,IAAnBe,EAEA,cAAC,GAAD,mGAMA6I,EAEA,cAAC,GAAD,4EAMJ,OAAIV,QAAJ,IAAIA,OAAJ,EAAIA,EAAWtC,GAAG5G,IAEd,eAAC,GAAD,sBACW,IACT,eAAC,GAAD,WACGkJ,EAAUqB,IAAIvK,GAAaO,WAD9B,IAC2Cd,MACjC,IAJZ,+BAUAoK,EAEA,eAAC,GAAD,oHAEa,cAAC,GAAD,UAASf,KAFtB,+DAQG,MC7VH0B,GAAO,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAH,MAAmC,CAC9CpD,SAAUoD,EACVnD,OAAQ,IAAIoD,SAAMD,EAAMjI,WAAYiI,EAAM3I,MAC1C0F,eAAe,EACfmD,WAAW,EACXC,kBAAkB,IASdC,GAAa,SAAC7a,GAAD,OAAgC,SAACD,GAAD,OACjD+a,GAAO/a,EAAOC,KAEV+a,GAAiBF,GAAW,CAAE5a,KAAM,mBACpC+a,GAAoBH,GAAW,CAAE5a,KAAM,sBACvCgb,GAAeJ,GAAW,CAAE5a,KAAM,iBAClCib,GAASL,GAAW,CAAE5a,KAAM,WAE5B6a,GAAS,SAAC/a,EAA0BC,GAAkD,IAIlFqX,EAAiEtX,EAAjEsX,SAAUC,EAAuDvX,EAAvDuX,OAAQE,EAA+CzX,EAA/CyX,cAAemD,EAAgC5a,EAAhC4a,UAAWC,EAAqB7a,EAArB6a,iBAEpD,OAAQ5a,EAAOC,MACb,IAAK,cAEH,OADAjJ,QAAQE,IAAI,mBACL,2BAAK6I,GAAZ,IAAmByX,eAAe,IAGpC,IAAK,eACH,OAAO,2BAAKzX,GAAZ,IAAmByX,eAAe,IAEpC,IAAK,gBACH,IAAM2D,EAAgBjN,WAAQC,KAAKnO,EAAOob,UAEpCC,EAAQ,2BACTtb,GADS,IAEZuX,OAAQA,EAAOgE,cAAcH,KAG/B,IAAKR,EAAW,CACd,GAAIrD,EAAOK,SAAWwD,EAAcpJ,QAClC,OAAOgJ,GAAeM,GAExB,GAAIT,GAAoBO,EAAcI,OACpC,OAAOP,GAAkBK,GAI7B,OAAOA,EAGT,IAAK,UACH,OAAO,2BACFtb,GADL,IAEEuX,OAAQA,EAAOkE,QAAQxb,EAAOob,UAC9BT,WAAW,IAGf,IAAK,iBACH,OAAO,2BACF5a,GADL,IAEEuX,OAAQA,EAAOkE,QAAQzB,sBACvBa,kBAAkB,IAGtB,IAAK,oBACH,OAAO,2BACF7a,GADL,IAEEuX,OAAQA,EAAOkE,QAAQ,GACvBZ,kBAAkB,IAGtB,IAAK,SACH,OAAO,2BACF7a,GADL,IAEEuX,OAAQ,IAAIoD,SAAMrD,EAAS7E,WAAY6E,EAASvF,MAChD6I,WAAW,EACXC,kBAAkB,IAGtB,IAAK,cAAgB,IAELH,EAEVza,EAFFqb,SAAYZ,MAC8BgB,EACxCzb,EADF0b,YAAeC,0BAGXN,EAAQ,2BACTtb,GADS,IAEZsX,SAAUoD,IAGZ,GAAIjD,GAAiBiE,EACnB,OAAOR,GAAaC,GAAOG,IAG7B,IAAM5E,EAASY,EAASoC,YAAYnC,EAAQ,GAE5C,MACoB,cAAX,OAANb,QAAM,IAANA,OAAA,EAAAA,EAAQxW,QAAwBwa,EAAM9C,SACrB,aAAX,OAANlB,QAAM,IAANA,OAAA,EAAAA,EAAQxW,OAAsBwa,EAAM9C,QAE9BuD,GAAOG,GAGT,2BAAKA,GAAZ,IAAsB/D,OAAQmD,EAAMd,MAAMlD,EAAQ,OAKlDmF,GAAU,SAACvE,EAAiBC,EAAenG,GAC/C,IAAMsF,EAASY,EAASoC,YAAYnC,EAAQnG,GAE5C,OAAIsF,GAA0B,oBAAhBA,EAAOxW,MAA8BwW,EAAO9H,OAAOsK,WACxDxC,EAAO9H,OAAOsK,WAAW3G,IAAInB,GAE7BjD,WAAQ2N,MAIb/L,GAAS,SAAC/P,GAAD,MAA+B,CAC5C+b,KAAM/b,EAAM+b,KACZC,kBAAmB3C,GAA+BrZ,KAG9Cic,GAAsB,SACtBC,GAAuB,IAAIC,OAAJ,WAAeF,KAO/BG,GAA4C,SAAC,GAA0B,IAAxB3J,EAAuB,EAAvBA,WAAYV,EAAW,EAAXA,KAAW,EACzBsK,6BAAkBtB,GAAQN,IADD,0BACxEnD,EADwE,EACxEA,SAAUC,EAD8D,EAC9DA,OAAQE,EADsD,EACtDA,cAAiBtW,EADqC,OAE7CiP,8BAAmBL,IAA/CgM,EAFyE,EAEzEA,KAAMC,EAFmE,EAEnEA,kBAEd5iB,qBAAU,gBACW7B,IAAfkb,GACFtR,EAAS,CAAEjB,KAAM,gBAAiBmb,SAAU5I,SAEjClb,IAATwa,GACF5Q,EAAS,CAAEjB,KAAM,UAAWmb,SAAUtJ,MAEvC,CAACU,EAAYV,EAAM5Q,IAEtB,IAAMiQ,EAAgB2K,EAAK3K,gBACrB+G,EAAmB/G,EAAcrW,IAAI,MAdsC,EAgB9Cue,GACjChC,EACAC,EACAnG,EACA4K,GApB+E,mBAgB1EM,EAhB0E,KAgB7DC,EAhB6D,KAuBzEC,EAAkB9D,KAAlB8D,cAEFC,EAAepY,uBAAY,WAC/BmY,EAAc,iCACb,CAACA,IAEEE,EAAkBpF,EAASM,QAE3B+E,EAAqB5Y,GAAsBmY,IAmBjD,OAjBA9iB,qBAAU,WAEsB,uBAA5BujB,EAAmBzc,MACS,2BAA5Byc,EAAmBzc,KAEnBiB,EAAS,CAAEjB,KAAM,gBACoB,WAA5Byc,EAAmBzc,MAAiD,cAA5Byc,EAAmBzc,KACpEiB,EAAS,CAAEjB,KAAM,iBACoB,qBAA5Byc,EAAmBzc,OACxByc,EAAmB1Y,KAAnB,UAA6BgY,GAA7B,WACFO,EAAc,gBAEdA,EAAc,qBAGjB,CAACG,EAAoBxb,EAAUqb,IAGhC,eAAC,GAAD,CACElF,SAAUA,EACVC,OAAQA,EACRC,IAAKqE,GAAQvE,EAAUC,EAAQnG,GAC/BA,cAAeA,EACfqG,cAAeA,EACftW,SAAUA,EANZ,iBAQGob,QARH,IAQGA,IACEG,EACC,cAAC,GAAD,uFAIA,cAAC,GAAD,4EAKJ,eAAC,IAAD,CAAMle,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASge,EAAlC,oBAICH,EACC,cAAC,GAAD,CACEpE,cAAa,UAAK+D,IAAL,OAA2BK,EAAYpc,MACpDwW,OAAQ4F,EACRnE,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQhT,UAAQ,EAAhB,4BCxOJ2K,GAAS,SAAC,GAAD,MAA0C,CAAE2K,MAA5C,EAAGA,MAAgDzJ,MAAnD,EAAUA,QAEZ2L,GAA0B,WAAO,IACpCJ,EAAkB9D,KAAlB8D,cACFK,EAAoBxY,uBAAY,WACpCmY,EAAc,0BACb,CAACA,IACEM,EAAmBzY,uBAAY,WACnCmY,EAAc,yBACb,CAACA,IAPuC,EASlBpM,8BAAmBL,IAApC2K,EATmC,EASnCA,MAAOzJ,EAT4B,EAS5BA,MAGf,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAKvT,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CACE+N,MAAM,aACNoJ,QAAQ,mBACRE,OAAQ0F,EAAMjI,WAAWjC,SAAS,GAClC7E,KAAK,QAGP,cAAC,GAAD,CACED,MAAM,OACNoJ,QAAQ,aACRE,OAAQ0F,EAAM3I,KAAKvB,WACnB7E,KAAM+D,KAGR,cAAC,GAAD,CAAiBjV,MAAOigB,EAAMtI,gBAAgBnB,QAGhD,eAAC,IAAD,CAAMzS,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,UAAUC,QAASqe,EAAnC,yBAGA,eAAC,IAAD,CAAQre,QAASoe,EAAjB,UACE,cAAC,EAAD,CAAMnjB,KAAK,MAAMgF,KAAK,OADxB,0BCzCGqe,GAA0C,SAAC,GAAD,IAAGxf,EAAH,EAAGA,MAAOpF,EAAV,EAAUA,SAAU8E,EAApB,EAAoBA,KAApB,OACrD,eAAC,IAAD,CAAKS,GAAI,CAAE2O,GAAI,EAAGpN,GAAI,GAAtB,UACE,eAAC,IAAD,CAAMvB,GAAI,CAAEM,WAAY,SAAUiB,GAAI,QAAtC,UACE,cAAC,IAAD,CAAKvB,GAAI,CAAEsB,GAAI,OAAQV,SAAU,QAAjC,SAA4CrB,GAAQ,cAAC,EAAD,CAAMvD,KAAK,kBAE/D,cAAC,IAAD,CAAS0E,GAAG,KAAZ,SAAkBb,OAGpB,cAAC,IAAD,CAAMG,GAAI,CAAEY,SAAU,GAAtB,SAA4BnG,QCZnB6kB,GAAoB,SAAAxJ,GAAU,IACjCgJ,EAAkB9D,KAAlB8D,cAEFS,EAAkB5Y,uBAAY,WAClCmY,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9e,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,qCAAnB,qDAIA,cAAC,IAAD,CAAMiB,QAAQ,iBAAd,SACE,cAAC,IAAD,CAAQC,QAASwe,EAAjB,iCChBJC,GAAW,SAAC9mB,EAAa+mB,GAAd,OAA+B/mB,GAAK+mB,EAAI/mB,EAAEgnB,GAAGD,IAAM/mB,IAAM+mB,GAY7DE,GAAuB,SAClCC,GACkC,IAAD,EACiB1kB,mBAAS0kB,GAD1B,mBAC1BC,EAD0B,KACPC,EADO,KAWjC,OARApkB,qBAAU,WAfG,IAAChD,EAAqB+mB,IAgB3BI,MAAwBD,EAC5BE,EAAqBF,IACZC,IAAqBD,IAlBCH,EAkByCG,GAlB9DlnB,EAkB2CmnB,GAhBrDrd,OAASid,EAAEjd,MACbgd,GAAS9mB,EAAEwY,OAAOsK,WAAYiE,EAAEvO,OAAOsK,aACvCgE,GAAS9mB,EAAEwY,OAAOuK,UAAWgE,EAAEvO,OAAOuK,YACtC+D,GAAS9mB,EAAEwY,OAAOqK,kBAAmBkE,EAAEvO,OAAOqK,oBAC9CiE,GAAS9mB,EAAEwY,OAAOwK,mBAAoB+D,EAAEvO,OAAOwK,sBAa7CoE,EAAqBF,KAEtB,CAACC,EAAmBD,IAEhBC,GC1BIE,GAAoB,SAAC,GAAD,IAAGtlB,EAAH,EAAGA,SAAH,OAC/B,cAAC,IAAD,CACEuF,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEH6K,OAAQ,EACR5K,aAAc,MACdM,YAAa,UACbiL,UAAW,GAZf,SAgBE,eAAC,IAAD,CAAMzL,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMtE,KAAK,uBAAuBgF,KAAK,OACvC,cAAC,IAAD,CAAMhB,GAAI,CAAE6D,GAAI,GAAhB,SAAsBpJ,UCHfulB,GAA2E,SAAC,GAMlF,IALLJ,EAKI,EALJA,YACAnF,EAII,EAJJA,iBACAC,EAGI,EAHJA,kCACAuF,EAEI,EAFJA,mBACAC,EACI,EADJA,sBAEQzjB,EAAYO,IAAZP,QAsCR,OApCAf,qBAAU,WACR,GAAIkkB,GAAoC,YAArBA,EAAYpd,KAAoB,CACjD0d,EAAsB,CAAE1d,KAAM,eAE9B,IAAImG,GAAY,EAEVwX,EAAY9a,WAAU,sBAAC,4BAAA3M,EAAA,sEACqB,aAArBknB,EAAYpd,KACnC/F,EAAQ2jB,SAASzF,UAAUiF,EAAY1O,OAAQ,CAC7CuJ,mBACAC,sCAEFje,EAAQ2jB,SAAStF,YAAY8E,EAAY1O,OAAQ,CAC/CuJ,mBACAC,sCARqB,OACrB2F,EADqB,OAWtB1X,IACHuX,EAAsB,CAAE1d,KAAM,WAAY6d,gBAC1C9mB,QAAQE,IACN,sBACEgX,WAAQC,KAAR,UAAgB2P,EAAYC,wBAAwB7O,WAAYqB,SAAS,KAfpD,2CAkB1B,KAEH,OAAO,WACLyN,aAAaJ,GACbxX,GAAY,GAGduX,EAAsB,CAAE1d,KAAM,WAG/B,CAACod,IAGFA,GAC4B,aAA5BK,EAAmBzd,WAC4B3I,IAA/ComB,EAAmBI,YAAYG,aAC/BP,EAAmBI,YAAYG,aAAe,IAElB,aAArBZ,EAAYpd,KACjB,cAAC,GAAD,oJAKA,cAAC,GAAD,wJAOG,MCvDHie,GAAW,SAACne,GAEhB,MAAO,CACL+b,KAFsC/b,EAAhC+b,KAGN9K,MAHsCjR,EAA1BiR,MAIZjB,eAJsChQ,EAAnBgQ,eAKnBgM,kBAAmB3C,GAA+BrZ,KAIhDoe,GAAc,IAAIzD,SAAMxM,WAAQ2N,KAAM3N,WAAQ2N,MAC9CuC,GAAiB,iBACjBC,GAAenQ,WAAQC,KAAK,IAErBmQ,GAAoB,WAAO,IAC9B/B,EAAkB9D,KAAlB8D,cAD6B,EAEsBpM,8BAAmB+N,IAAtEpC,EAF6B,EAE7BA,KAAM9K,EAFuB,EAEvBA,MAAOjB,EAFgB,EAEhBA,eAAgBgM,EAFA,EAEAA,kBAC/B5K,EAAgB2K,EAAK3K,gBACrBsE,EAAe9c,qBAJgB,EAMDA,mBAAkBuV,WAAQ2N,MANzB,mBAM9BrJ,EAN8B,KAMlB8I,EANkB,OAOG3iB,mBAAkBuV,WAAQ2N,MAP7B,mBAO9B0C,EAP8B,KAOhBC,EAPgB,KAS/BtG,EAAmB/G,EAAcrW,IAAI,MAErCyc,EAAMgH,EAAajM,IAAInB,GACvBsG,EAAS,IAAIzF,WAAQb,GACrBsN,EAAYF,EAAazjB,IAAIid,6BAA0Bjd,IAAIyc,GAC3DmH,GAAWlM,EAAW+I,SAAWgD,EAAahD,OAC9Cd,EAAQiE,EAAU,IAAIhE,SAAMlI,EAAYiM,GAAaN,GACrDQ,EAAgB5O,EAAe6G,GAAGyH,IACpCtO,EAAewK,IAAI8D,IACnBnQ,WAAQ2N,KACN+C,EAAqBpM,EAAW2K,GAAGwB,GACnCxM,EACHK,EAAW+I,QAAWgD,EAAahD,YAAwCjkB,EAA/BmjB,EAAMtI,gBAAgBnB,GArBhC,EAuBFqI,GACjC8E,GACA1D,EACAtJ,EACA4K,GA3BmC,mBAuB9BsB,EAvB8B,KAuBjBf,EAvBiB,KA8B/BgB,EAAoBF,GAAqBC,GA9BV,EA+Be1kB,mBAA6B,CAAEsH,KAAM,SA/BpD,mBA+B9Byd,EA/B8B,KA+BVC,EA/BU,KAiC/B/Z,EAAmBE,GAAsBsa,IACzCS,EACsB,uBAA1Bjb,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KAEb6e,EAAsB1a,uBAAY,WACtCmY,EAAc,iCACb,CAACA,IAEEwC,EAAQ3a,uBAAY,WACxBkX,EAAcpN,WAAQ2N,MACtB2C,EAAgBtQ,WAAQ2N,QACvB,IAQH,OANA1iB,qBAAU,YACHqZ,EAAW+I,QAAUgD,EAAahD,QACrCiD,EAAgBpE,4BAEjB,CAAC5H,EAAY+L,IAGd,eAAC,IAAD,WACE,eAAC,IAAD,mBAEGG,IAAYG,GACX,cAAC,IAAD,CAAQtgB,QAAQ,YAAYd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WAAcqB,QAASugB,EAApF,SACE,cAAC,EAAD,CAAMtlB,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,aACNoJ,QAAQ,mBACRE,OAAQvC,EAAWjC,SAAS,GAC5BqF,UAAW+I,EAAcpM,WACzBsD,SAAU+I,EACVnJ,aAAcA,EACd/J,KAAK,MACLgK,aAAclD,EAAWD,SAAS,GAClCoD,gBAAiB,SAACZ,GAAD,OAAoBuG,EAAcpN,WAAQC,KAAK4G,OAGlE,cAAC,GAAD,CACEtJ,MAAM,SACNoJ,QAAQ,sBACRE,OAAQwJ,EAAahO,WACrB7E,KAAM+D,GACNgG,aAAcA,EACdC,aAAc6I,EAAahM,SAAS,GACpCoD,gBAAiB,SAACZ,GAAD,OAAoByJ,EAAgBtQ,WAAQC,KAAK4G,OAGpE,cAAC,GAAD,CACEtJ,MAAM,sBACNoJ,QAAQ,4BACRE,OAAM,UAAKgD,6BACXrM,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAUR,cAAC,GAAD,CACEwM,MAAM,gBACNoJ,QAAQ,sBACRE,OAAQwC,EAAIhH,SAAS,GACrByE,cAAeyC,EAAOlF,SAAS,GAC/B7G,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAAC,GAAD,CACEwM,MAAM,aACNoJ,QAAQ,mBACRE,OAAQ0J,EAAUlO,SAAS,GAC3B7E,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,eAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,2DACiD,IAC9Cyf,GACC,+DAC0BD,EAAUlE,IAAIxC,6BAA0BxH,SAAS,GAAI,IAD/E,oCAEoCwH,4BAAyBxF,WAF7D,iDAYZ,cAAC,GAAD,CAAiB/X,MAAO2X,IAlF1B,OAoFGmK,QApFH,IAoFGA,IACC,cAAC,GAAD,uFAKF,cAAC,GAAD,CACEe,YAAaC,EACbpF,iBAAkBA,EAClBC,kCAAmC,GACnCuF,mBAAoBA,EACpBC,sBAAuBA,IAGzB,eAAC,IAAD,CAAMpf,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsgB,EAAlC,oBAI6B,eAA5BpB,EAAmBzd,KAClB,cAAC,IAAD,CAAQkF,UAAQ,EAAhB,SACE,cAAC,IAAD,CAAS1G,KAAK,OAAOhB,GAAI,CAAEN,MAAO,kBAElCmgB,EACF,cAAC,GAAD,CACErF,cAAemG,GACf3H,OAAQ6G,EACRpF,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQhT,UAAQ,EAAhB,2BAIL0Z,GAAwB,cAAC,GAAD,QCvMzBX,GAAW,SAACne,GAEhB,MAAO,CACL0a,MAF6C1a,EAAvC0a,MAGNqB,KAH6C/b,EAAhC+b,KAIb9K,MAJ6CjR,EAA1BiR,MAKnBjB,eAL6ChQ,EAAnBgQ,eAM1BgM,kBAAmB3C,GAA+BrZ,KAIhDqe,GAAiB,mBACjBC,GAAenQ,WAAQC,KAAK,IA0CrB6Q,GAAsB,WAAO,IAChCzC,EAAkB9D,KAAlB8D,cAD+B,EAE2BpM,8BAAmB+N,IAA7EzD,EAF+B,EAE/BA,MAAOqB,EAFwB,EAExBA,KAAM9K,EAFkB,EAElBA,MAAOjB,EAFW,EAEXA,eAAgBgM,EAFL,EAEKA,kBACtCtG,EAAe9c,qBACfsmB,EAAgBpd,iBAAc4Y,GAJG,EAKH9hB,mBAAkB8hB,EAAMjI,YALrB,mBAKhCA,EALgC,KAKpB8I,EALoB,OAMT3iB,mBAAkB8hB,EAAMyE,SANf,mBAMhCA,EANgC,KAMvBC,EANuB,KAQjCvb,EAAmBE,GAAsBsa,IACzCjN,EAAgB2K,EAAK3K,gBAE3BhY,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,oBAEf,CAAC3Y,EAAiB3D,KAAMsc,IAE3BpjB,qBAAU,WACR,IAAK8lB,EAAcrc,QAAQ4P,WAAW2K,GAAG1C,EAAMjI,YAAa,CAC1D,IACM4M,EAlD0B,SAACC,EAA4B5E,GACjE,OAAI4E,EAAerI,cACbqI,EAAetI,SACV0D,EAAMjI,WAAW1X,IAAIukB,EAAerI,eAEzCqI,EAAepI,UACboI,EAAerI,cAAcG,GAAGsD,EAAMjI,YACjCiI,EAAMjI,WAAW+H,IAAI8E,EAAerI,eAGxCyD,EAAMjI,WAERiI,EAAMjI,WAsCc8M,CADAzH,cAAWC,QAAQtF,EAAYyM,EAAcrc,QAAQ4P,YACPiI,GACrEa,EAAc8D,GAEhB,IAAKH,EAAcrc,QAAQsc,QAAQ/B,GAAG1C,EAAMyE,SAAU,CACpD,IACMK,EAxCuB,SAACF,EAA4B5E,GAC9D,OAAI4E,EAAerI,cACbqI,EAAetI,SACV0D,EAAMyE,QAAQpkB,IAAIukB,EAAerI,eAEtCqI,EAAepI,UACboI,EAAerI,cAAcG,GAAGsD,EAAMyE,SACjCzE,EAAMyE,QAAQ3E,IAAI8E,EAAerI,eAGrCyD,EAAMyE,QAERzE,EAAMyE,QA4BWM,CADG3H,cAAWC,QAAQoH,EAASD,EAAcrc,QAAQsc,SACVzE,GAC/D0E,EAAWI,GAEbN,EAAcrc,QAAU6X,IACvB,CAACA,EAAOjI,EAAY0M,IAEvB,IAAMJ,EAAsB1a,uBAAY,WACtCmY,EAAc,iCACb,CAACA,IAEEwC,EAAQ3a,uBAAY,WACxBkX,EAAcb,EAAMjI,YACpB2M,EAAW1E,EAAMyE,WAChB,CAACzE,EAAMjI,WAAYiI,EAAMyE,UAEtBR,GAAWlM,EAAW2K,GAAG1C,EAAMjI,cAAgB0M,EAAQ/B,GAAG1C,EAAMyE,SAChEO,EAAiBP,EAAQtI,GAAG6D,EAAMyE,SAClCQ,EAAqBD,EAAiBP,EAAQ3E,IAAIE,EAAMyE,SAAWhR,WAAQ2N,KAE3EtE,EAAMkI,EApFE,SAACpI,EAAiBC,EAAenG,GAC/C,IAAMsF,EAASY,EAASoC,YAAYnC,EAAQnG,GAE5C,OAAIsF,GAA0B,oBAAhBA,EAAOxW,MAA8BwW,EAAO9H,OAAOsK,WACxDxC,EAAO9H,OAAOsK,WAAW3G,IAAInB,GAE7BjD,WAAQ2N,KA+EbD,CAAQnB,EAAO,IAAIC,SAAMD,EAAMjI,WAAYiI,EAAM3I,KAAKhX,IAAI4kB,IAAsBvO,GAChFjD,WAAQ2N,KACN4C,EAAYS,EAAQpkB,IAAIid,6BAA0Bjd,IAAIyc,GACtDW,EAAmB/G,EAAcrW,IAAI,MACrC6kB,EAAejB,EAAU,IAAIhE,SAAMlI,EAAYiM,GAAahE,EAC5DhD,EAAS,IAAIzF,WAAQb,GACrByO,EAAe7P,EAAe6G,GAAGyH,IACnCtO,EAAewK,IAAI8D,IACnBnQ,WAAQ2N,KACN8C,EAAgBlE,EAAMjI,WAAW1X,IAAI8kB,GACrChB,EAAqBpM,EAAW2K,GAAGwB,GACnCxM,EACHK,EAAW+I,QAAW2D,EAAQ3D,YAA+CjkB,EAAtCqoB,EAAaxN,gBAAgBnB,GACjE4G,EAAwBC,cAAWC,QAAQ3F,EAAiBsI,EAAMtI,gBAAgBnB,IA1DjD,EA4DJqI,GACjCoB,EACAkF,EACAxO,EACA4K,GAhEqC,mBA4DhCsB,EA5DgC,KA4DnBf,EA5DmB,KAmEjCgB,EAAoBF,GAAqBC,GAnER,EAoEa1kB,mBAA6B,CAAEsH,KAAM,SApElD,mBAoEhCyd,EApEgC,KAoEZC,EApEY,KAsEjCkB,EACsB,uBAA1Bjb,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KAEnB,MAAqB,SAAjBwa,EAAM7iB,OACD,KAIP,eAAC,IAAD,WACE,eAAC,IAAD,mBAEG8mB,IAAYG,GACX,cAAC,IAAD,CAAQtgB,QAAQ,YAAYd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WAAcqB,QAASugB,EAApF,SACE,cAAC,EAAD,CAAMtlB,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,aACNoJ,QAAQ,mBACRE,OAAQvC,EAAWjC,SAAS,GAC5BqF,UAAW+I,EAAcpM,WACzBsD,SAAU+I,EACVnJ,aAAcA,EACd/J,KAAK,MACLgK,aAAclD,EAAWD,SAAS,GAClCoD,gBAAiB,SAACZ,GAAD,OAAoBuG,EAAcpN,WAAQC,KAAK4G,OAGlE,cAAC,GAAD,CACEtJ,MAAM,WACNoJ,QAAQ,wBACRE,OAAQmK,EAAQ3O,WAChB7E,KAAM+D,GACNgG,aAAcA,EACdC,aAAcwJ,EAAQ3M,SAAS,GAC/BoD,gBAAiB,SAACZ,GAAD,OAAoBoK,EAAWjR,WAAQC,KAAK4G,OAG/D,cAAC,GAAD,CACEtJ,MAAM,sBACNoJ,QAAQ,4BACRE,OAAM,UAAKgD,6BACXrM,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAUR,cAAC,GAAD,CACEwM,MAAM,gBACNoJ,QAAQ,sBACRE,OAAQwC,EAAIhH,SAAS,GACrByE,cAAeyC,EAAOlF,SAAS,GAC/B7G,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAAC,GAAD,CACEwM,MAAM,aACNoJ,QAAQ,mBACRE,OAAQ0J,EAAUlO,SAAS,GAC3B7E,KAAM+D,GACN+E,SACE,cAAC,GAAD,CACEjQ,QACE,eAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,2DACiD,IAC9Cyf,GACC,+DAC0BD,EAAUlE,IAAIxC,6BAA0BxH,SAAS,GAAI,IAD/E,oCAEoCwH,4BAAyBxF,WAF7D,iDAYZ,cAAC,GAAD,CAAiB/X,MAAO2X,EAAiBsE,OAAQmB,IAlFnD,OAoFG0E,QApFH,IAoFGA,IACC,cAAC,GAAD,4EAKF,cAAC,GAAD,CACEe,YAAaC,EACbpF,iBAAkBA,EAClBC,kCAAmC,GACnCuF,mBAAoBA,EACpBC,sBAAuBA,IAGzB,eAAC,IAAD,CAAMpf,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsgB,EAAlC,oBAICxB,EACC,cAAC,GAAD,CACErF,cAAemG,GACf3H,OAAQ6G,EACRpF,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQhT,UAAQ,EAAhB,2BAIL0Z,GAAwB,cAAC,GAAD,QCtRzB/O,GAAS,SAAC,GAAD,MAAsD,CACnE+P,yBADa,EAAGA,2BAILC,GAAoC,WAAO,IAC9CD,EAA6B1P,8BAAmBL,IAAhD+P,yBAEW3lB,EACfO,IADFP,QAAWgK,KAGP6b,EAAkB,qBAClBrD,EAAqB5Y,GAAsBic,GAEzCxD,EAAkB9D,KAAlB8D,cAQR,OANApjB,qBAAU,WACwB,qBAA5BujB,EAAmBzc,MACrBsc,EAAc,sCAEf,CAACG,EAAmBzc,KAAMsc,IAEM,uBAA5BG,EAAmBzc,KACxB,cAAC,IAAD,CAAM1B,QAAQ,iBAAd,SACE,eAAC,IAAD,CAAQ4G,UAAQ,EAAC1H,GAAI,CAAE2O,GAAI,GAA3B,UACE,cAAC,IAAD,CAAS3O,GAAI,CAAEsB,GAAI,EAAG5B,MAAO,SAAWsB,KAAK,SAD/C,iCAK4B,2BAA5Bie,EAAmBzc,MACO,cAA5Byc,EAAmBzc,KACnB,cAAC,IAAD,CAAM1B,QAAQ,iBAAd,SACE,cAAC+F,GAAD,CACEN,GAAI+b,EACJ7b,KAAMhK,EAAQ8lB,uBAAuB3H,KAAKne,OAAS5C,GAFrD,SAIE,eAAC,IAAD,CAAQmG,GAAI,CAAE2O,GAAI,GAAlB,mBAA8ByT,EAAyBtP,WAAvD,cAGF,MCzCAT,GAAS,SAAC,GAAD,MAAsD,CACnEmQ,sBADa,EAAGJ,yBACgCtE,SAGrC2E,GAA0B,WAAO,IACpCD,EAAyB9P,8BAAmBL,IAA5CmQ,qBACA1D,EAAkB9D,KAAlB8D,cAEFS,EAAkB5Y,uBAAY,WAClCmY,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9e,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,gCAAnB,SACG2iB,EACG,uEACA,4CAGN,eAAC,IAAD,CAAM1hB,QAAQ,iBAAd,UACG0hB,GAAwB,cAAC,GAAD,KACvBA,GAAwB,cAAC,IAAD,CAAQzhB,QAASwe,EAAjB,kCCxB9BlN,GAAS,SAAC,GAAD,MAAsD,CACnEmQ,sBADa,EAAGJ,yBACgCtE,SAGrC4E,GAA4B,WAAO,IACtCF,EAAyB9P,8BAAmBL,IAA5CmQ,qBACA1D,EAAkB9D,KAAlB8D,cAEFS,EAAkB5Y,uBAAY,WAClCmY,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9e,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,kCAAnB,SACG2iB,EACG,uEACA,4CAGN,eAAC,IAAD,CAAM1hB,QAAQ,iBAAd,UACG0hB,GAAwB,cAAC,GAAD,KACvBA,GAAwB,cAAC,IAAD,CAAQzhB,QAASwe,EAAjB,kCCrBvBtC,GAAkB,SAAAnH,GAG7B,OAFiBkF,KAAT2H,MAIN,IAAK,SACH,OAAO,cAAC,GAAD,eAAmB7M,IAE5B,IAAK,YACH,OAAO,cAAC,GAAD,eAAeA,IAExB,IAAK,UACH,OAAO,cAAC,GAAD,2BAAkBA,GAAlB,IAAyBf,WAAYtE,WAAQ2N,KAAM/J,KAAM5D,WAAQ2N,QAE1E,IAAK,UACH,OAAO,cAAC,GAAD,eAAatI,IAEtB,IAAK,aACH,OAAO,cAAC,GAAD,eAAqBA,IAE9B,IAAK,WACH,OAAO,cAAC,GAAD,eAAmBA,IAE5B,IAAK,OACH,OAAO,cAAC,GAAD,eAAaA,MCfpBzD,GAAS,SAAC,GAAD,MAA8D,CAC3EE,YADa,EAAGA,YAEhBkB,oBAFa,EAAgBA,sBAYlBmP,GAAgE,SAAC,GAMvE,IALLC,EAKI,EALJA,gBACAC,EAII,EAJJA,WACA/I,EAGI,EAHJA,cACAtW,EAEI,EAFJA,SACAhJ,EACI,EADJA,SACI,EACyCiY,8BAAmBL,IAAxDE,EADJ,EACIA,YAAakB,EADjB,EACiBA,oBACfuE,EAAe9c,qBAEf2e,GAAUiJ,EAAWpD,GAAGmD,EAAgBE,aAExC5K,EAAY0K,EAAgBE,YAAY1lB,IAAIkV,GAC5C6F,EAAW0K,EAAWpD,GAAGvH,GAEzB6K,EAAiCvP,EACpCqJ,IAAI+F,EAAgBE,aACpB1lB,IAAIylB,GAEDG,EAAoBJ,EAAgBE,YAAYG,OAAO,IAAKzP,GAC5D0P,EAAeL,EAAWI,OAAO,IAAKF,GACtCI,EACJP,EAAgBE,YAAYzO,SAC5B8F,cAAWC,QAAQ8I,EAAcF,GAAmB3O,QAEtD,OACE,eAAC,IAAD,WACE,eAAC,IAAD,4BAEGuF,IAAWE,GACV,cAAC,IAAD,CACEjZ,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAM0C,EAAS,CAAEjB,KAAM,YAHlC,SAKE,cAAC,EAAD,CAAMxG,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,UACNoJ,QAAQ,eACRE,OAAQwL,EAAWhQ,WACnBqF,UAAWA,EAAUrD,WACrBsD,SAAUA,EACVnK,KAAM+D,GACAgG,eACNC,aAAc6K,EAAWhO,SAAS,GAClCoD,gBAAiB,SAAAyF,GAAQ,OAAIla,EAAS,CAAEjB,KAAM,aAAcmb,gBAG7DwF,EAAaE,SACZ,cAAC,GAAD,CAAWrV,MAAM,aAAaoJ,QAAQ,gBAAgBE,OAAO,QAE7D,cAAC,GAAD,CACEtJ,MAAM,aACNoJ,QAAQ,gBACRE,OAAQ6L,EAAarQ,SAAS,GAC9ByE,cAAa,OAAE6L,QAAF,IAAEA,OAAF,EAAEA,EAAiBtQ,SAAS,GAAGwQ,OAAO,KACnD9L,cAA6B,OAAf4L,QAAe,IAAfA,OAAA,EAAAA,EAAiB9J,UAAW,UAAY,SACtDrL,KAAK,OAIP4U,EAAgB3I,SAChB,qCACE,cAAC,GAAD,CACElM,MAAM,mBACNoJ,QAAQ,eACRE,OAAQuL,EAAgBU,eAAezQ,SAAS,GAChDpT,MAAOmjB,EAAgBU,eAAejP,SAAW,UACjDrG,KAAK,QAGP,cAAC,GAAD,CACED,MAAM,SACNoJ,QAAQ,iBACRE,OAAQuL,EAAgBW,WAAW1Q,WACnCpT,MAAOmjB,EAAgBW,WAAWlP,SAAW,UAC7CrG,KAAMgE,GACN8E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,mPAWX/G,KAGFsf,GAAiB,cAAC,GAAD,QCvHlB0J,GAA2B,SAAC,GAAD,MACX,eADW,EAAG5P,SACzB1Z,QAEEupB,GAAgE,SAAC,GAIvE,IAHLjpB,EAGI,EAHJA,SACA+f,EAEI,EAFJA,cACAxB,EACI,EADJA,OACI,EACwBhc,IAApB5D,EADJ,EACIA,OAAQqD,EADZ,EACYA,QAGV5D,EAFqB6Z,8BAAmB+Q,IAELrqB,EAAOP,iBAAcgB,EAJ1D,EAMsB2M,GACxBgU,EACAxB,EAAO2K,YACHlnB,EAAQgK,KAAKmd,2BAA2BhJ,KAAKne,EAAQgK,KAAMuS,EAAO2K,YAAa9qB,GAC/E4D,EAAQgK,KAAKod,8BAA8BjJ,KAAKne,EAAQgK,KAAMuS,EAAO8K,eAJpE5c,EANH,oBAaJ,OAAO,cAAC,IAAD,CAAQnG,QAASmG,EAAjB,SAAmCzM,KCxB/BspB,GAAuBzpB,wBAA+C,MAEtE0pB,GAAmB,WAC9B,IAAM/I,EAA2C/d,qBAAW6mB,IAE5D,GAAgB,OAAZ9I,EACF,MAAM,IAAI/gB,MAAM,8DAGlB,OAAO+gB,GCLIgJ,GAAwE,SAAC,GAG/E,IAAD,IAFJpB,EAEI,EAFJA,gBACA7J,EACI,EADJA,OAEMuK,EAAc,UAAGV,EAAgBU,eAAejP,eAAlC,aAAG,EAAwCxB,SAAS,GAAGwQ,OAAO,QAC5EE,EAAU,UAAGX,EAAgBW,WAAWlP,eAA9B,aAAG,EAAoCxB,WAAWwQ,OAAO,IAAKrR,IAE9E,OACE,eAAC,GAAD,WACG+G,EAAO2K,YACN,0DACqB,IACnB,eAAC,GAAD,WACG3K,EAAO2K,YAAY7Q,WADtB,IACmCd,MACzB,IAJZ,2BAQA,2DACsB,IACpB,eAAC,GAAD,WACGgH,EAAO8K,aAAahR,WADvB,IACoCd,MAC1B,IAJZ,qBAQAuR,GAAkBC,IAClB,qCACG,IADH,wBAEwB,IACrBD,GAAkBC,EACjB,qCACE,cAAC,GAAD,UAASD,IADX,QACwC,cAAC,GAAD,UAASC,OAGjD,cAAC,GAAD,iBAASD,QAAT,IAASA,IAAkBC,OA3BnC,QCRSU,GAA4C,SAAC,GAAD,IACvDlH,EADuD,EACvDA,MACAzK,EAFuD,EAEvDA,YACA4R,EAHuD,EAGvDA,YACAC,EAJuD,EAIvDA,8BAJuD,MAK/B,CACxBpH,QACAzK,cACA8R,gBAAwC,eAAvBF,EAAYhqB,OAC7BiqB,kCCFIrH,GAAO,SAAC,GAAD,IAAGuH,EAAH,EAAGA,iBAAH,MAA8C,CACzDzB,gBAAiByB,EACjBxB,WAAYwB,EAAiBvB,YAC7BhJ,eAAe,IASXqD,GAAa,SAAC7a,GAAD,OAA2C,SAC5DD,GAD4D,OAE3B+a,GAAO/a,EAAOC,KAE3Cib,GAAeJ,GAAW,CAAE5a,KAAM,iBAClCib,GAASL,GAAW,CAAE5a,KAAM,WAE5B6a,GAAS,SACb/a,EACAC,GACiC,IAIzBsgB,EAA+CvgB,EAA/CugB,gBAAiBC,EAA8BxgB,EAA9BwgB,WAAY/I,EAAkBzX,EAAlByX,cAErC,OAAQxX,EAAOC,MACb,IAAK,cAEH,OADAjJ,QAAQE,IAAI,iBACL,2BAAK6I,GAAZ,IAAmByX,eAAe,IAGpC,IAAK,eACH,OAAO,2BAAKzX,GAAZ,IAAmByX,eAAe,IAEpC,IAAK,aACH,OAAO,2BAAKzX,GAAZ,IAAmBwgB,WAAYrS,WAAQC,KAAKnO,EAAOob,YAErD,IAAK,SACH,OAAO,2BAAKrb,GAAZ,IAAmBwgB,WAAYD,EAAgBE,cAEjD,IAAK,cAAgB,IAEgBwB,EAC/BhiB,EADF0b,YAAeqG,iBAGjB,IAAKC,EACH,OAAOjiB,EAGT,IAAMsb,EAAQ,2BAAQtb,GAAR,IAAeugB,gBAAiB0B,IAExCvG,GACHuG,EAAeC,YAAY9E,GAAGmD,EAAgB2B,cAC/CD,EAAexB,YAAY5J,GAAG0J,EAAgBE,cAC9CwB,EAAehB,eAAe7J,GAAGmJ,EAAgBU,iBACjDgB,EAAef,WAAW9J,GAAGmJ,EAAgBW,YAE/C,OAAIzJ,GAAiBiE,EACZR,GAAaC,GAAOG,IAGtB,2BACFA,GADL,IAEEkF,WAAYyB,EAAerI,MAAM2G,EAAgB7G,YAAY8G,QAM/DtI,GAAgB,oBAETiK,GAAoC,WAAO,IAAD,EACc9F,6BAAkBtB,GAAQN,IADxC,0BAC5C8F,EAD4C,EAC5CA,gBAAiBC,EAD2B,EAC3BA,WAAY/I,EADe,EACfA,cAAiBtW,EADF,KAE/C6a,EAAoB5L,8BAAmBwR,IACrCpF,EAAkBkF,KAAlBlF,cAEFC,EAAepY,uBAAY,WAC/BmY,EAAc,oBACb,CAACA,IAPiD,EDjET,SAC5C+D,EACAC,EAF4C,GAWxC,IAAD,EAPDvQ,EAOC,EAPDA,YACA8R,EAMC,EANDA,gBACAD,EAKC,EALDA,8BAMIpL,EAAS6J,EAAgB7G,YAAY8G,GAE3C,OAAIuB,EACK,MACLxqB,EACA,cAAC,GAAD,+FAMCmf,GAIL,UAAIA,EAAO2K,mBAAX,aAAI,EAAoBxK,GAAG5G,IAClB,MACL1Y,EACA,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WACGmf,EAAO2K,YAAY7G,IAAIvK,GAAaO,WADvC,IACoDd,MAHtD,QAUAgH,EAAO8K,cAAgBM,EAClB,MACLvqB,EACA,cAAC,GAAD,4KAOG,CAACmf,EAAQ,cAAC,GAAD,CAA4B6J,gBAAiBA,EAAiB7J,OAAQA,KA1B7E,MAACnf,OAAWA,GCkDc6qB,CACjC7B,EACAC,EACAxE,GAZmD,mBAS9CM,EAT8C,KASjCC,EATiC,KAe/C8F,EAAmB9B,EAAgB3I,QAEnC+E,EAAqB5Y,GAAsBmU,IAejD,OAbA9e,qBAAU,WAEsB,uBAA5BujB,EAAmBzc,MACS,2BAA5Byc,EAAmBzc,KAEnBiB,EAAS,CAAEjB,KAAM,gBACoB,WAA5Byc,EAAmBzc,MAAiD,cAA5Byc,EAAmBzc,KACpEiB,EAAS,CAAEjB,KAAM,iBACoB,qBAA5Byc,EAAmBzc,MAC5Bsc,EAAc,uBAEf,CAACG,EAAmBzc,KAAMiB,EAAUqb,IAGrC,eAAC,GAAD,CACE+D,gBAAiBA,EACjBC,WAAYA,EACZ/I,cAAeA,EACftW,SAAUA,EAJZ,iBAMGob,QANH,IAMGA,IACE8F,EACC,eAAC,GAAD,kCAAwC3S,GAAxC,6BAEA,eAAC,GAAD,yBAA+BA,GAA/B,qCAGJ,eAAC,IAAD,CAAMlR,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASge,EAAlC,oBAICH,EACC,cAAC,GAAD,CAAwBpE,cAAeA,GAAexB,OAAQ4F,EAA9D,qBAIA,cAAC,IAAD,CAAQlX,UAAQ,EAAhB,4BC5IGkd,GAA4C,SAAC,GAA4B,IAA1Bld,EAAyB,EAAzBA,SAAUjN,EAAe,EAAfA,SAC5DgC,EAAYO,IAAZP,QAD2E,EAGzD+J,GACxB,oBACA/J,EAAQgK,KAAKoe,8BAA8BjK,KAAKne,EAAQgK,OAFnDS,EAH4E,oBAQnF,OACE,cAAC,IAAD,CACEpG,QAAQ,UACRd,GAAI,CAAEwL,GAAI,EAAGhK,MAAO,QACpBT,QAASmG,EACTQ,SAAUA,EAJZ,SAMGjN,KCdMqqB,GAA4C,SAAC,GAA4B,IAA1Bpd,EAAyB,EAAzBA,SAAUjN,EAAe,EAAfA,SAC5DgC,EAAYO,IAAZP,QAD2E,EAGzD+J,GACxB,oBACA/J,EAAQgK,KAAKse,+BAA+BnK,KAAKne,EAAQgK,OAFpDS,EAH4E,oBAQnF,OACE,cAAC,IAAD,CAAQnG,QAASmG,EAAiBQ,SAAUA,EAA5C,SACGjN,KCdDgmB,GAAW,SAAC,GAAD,MAA8D,CAC7EuE,iCADe,EAAGA,mCAIPC,GAA0B,WAAO,IACpCD,EAAqCtS,8BAAmB+N,IAAxDuE,iCAER,OACE,eAAC,IAAD,CAAMhlB,GAAI,CAAEsB,GAAI,EAAGV,SAAU,EAAGgB,WAAY,UAA5C,UACGojB,EAAiClS,SAAS,GAD7C,sBCXSoS,GAAkB,SAAC,GAAkB,IAAhBzqB,EAAe,EAAfA,SAChC,OAAO,cAAC,IAAD,CAAMqG,QAAQ,eAAd,SAA8BrG,K,UCIjC0qB,GAAU,SAAsBnsB,EAAMiH,GAA5B,OAAqEA,KAAKjH,GAEpFosB,GAAuC,SAC3CC,EACAC,EACA/Y,GAEA,GAAoB,kBAATA,GAA8B,OAATA,EAC9B,MAAM,IAAIrS,MAAJ,sCAF+B,qBAKlBmrB,GALkB,IAKvC,2BAAsC,CAAC,IAA5BE,EAA2B,QACpC,IAAKJ,GAAQ5Y,EAAMgZ,GACjB,MAAM,IAAIrrB,MAAJ,gBAAmBqrB,EAAnB,sCAGR,IALoC,EAK9BC,EAAajZ,EAAKgZ,GALY,eAObD,GAPa,IAOpC,2BAA2C,CAAC,IAAjC1S,EAAgC,QACzC,IAAKuS,GAAQK,EAAY5S,GACvB,MAAM,IAAI1Y,MAAJ,oBAAuB0Y,EAAvB,sCAGR,GAAoC,kBAAzB4S,EAAW5S,GACpB,MAAM,IAAI1Y,MAAJ,yBAA4BqrB,EAA5B,0BAAoD3S,EAApD,uBAb0B,gCALC,8BAuBvC,OAAOrG,GAGHkZ,GAAyB,uCAAG,WAChCC,EACAC,GAFgC,iBAAAjtB,EAAA,6DAI1BktB,EACJ,iDACA,IAAIC,gBAAgB,CAClBC,IAAKJ,EAAQlZ,KAAK,KAClBuZ,cAAeJ,EAAanZ,KAAK,OARL,SAWTnQ,OAAOtC,MAAM6rB,EAAgB,CAClDlU,QAAS,CACPsU,OAAQ,sBAboB,WAW1BhsB,EAX0B,QAiBlBC,GAjBkB,sBAkBxB,IAAIC,MAAJ,0DAA6DF,EAASG,SAlB9C,mBAqBzBirB,GArByB,KAqBYM,EArBZ,KAqBqBC,EArBrB,UAqByC3rB,EAASb,OArBlD,mHAAH,wDA4BlB8sB,GAAc,uCAAG,4BAAAvtB,EAAA,sEACL+sB,GAA0B,CAAC,WAAqB,CAAC,QAD5C,cACtBzrB,EADsB,yBAGrB,CACLksB,aAAczV,WAAQC,KAAK1W,EAASyC,QAAQ0pB,OAJlB,2CAAH,qDC5DrB1F,GAAW,SAAC,GAAD,MAAmF,CAClGhN,oBADe,EAAGA,oBAElBuR,iCAFe,EAAwBA,mCAMnCoB,GAAwB3V,WAAQC,KAAK,WADZ,GAC2C,EAAI,MACxE2V,GAA0BD,GAAsBvR,IAAI,KAE7CyR,GAAkB,WAAO,IAAD,EAC+B5T,8BAAmB+N,IAA7EhN,EAD2B,EAC3BA,oBAAqBuR,EADM,EACNA,iCADM,EAGD9pB,wBAA8BrB,GAH7B,mBAG5B0sB,EAH4B,KAGjBC,EAHiB,KAI7BC,EAAezB,EAAiClH,QAAUrK,EAAoBqK,OAapF,GAXApiB,qBAAU,WACR,sBAAC,8BAAAhD,EAAA,+EAEkCutB,KAFlC,gBAEWC,EAFX,EAEWA,aACRM,EAAaN,GAHhB,gDAKG3sB,QAAQC,MAAR,MALH,wDAAD,KAQC,IAECitB,QAA8B5sB,IAAd0sB,EAAyB,OAAO,KAEpD,IAEMG,EAFqB1B,EAAiCnQ,IAAIuR,IACbvR,IAAI0R,GACTrD,OAAO,MAAWzP,GAC1DkT,EAAqB3B,EAAiCnQ,IAAI0R,GAEhE,OAAIG,EAAc5I,OAAe,KAG/B,eAAC,GAAD,WACE,eAAC,IAAD,uBAAgB4I,EAAc5R,SAAS,GAAvC,OACA,cAAC,GAAD,CACEhO,QACE,eAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,CAAC,QAAS,UAA/C,UACE,eAAC,IAAD,iBACK,cAAC,IAAD,CAAMxB,GAAI,CAAE4B,WAAY,QAAxB,sBADL,yIAKA,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQuM,WAAY,YAAa3B,GAAI,GAAhE,6EACmE,IACjE,cAAC,IAAD,CAAMxL,GAAI,CAAE4B,WAAY,QAAxB,qBAEF,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQuM,WAAY,aAA/C,eAEGwZ,EAAmB3R,UAFtB,MAEoCqR,GAAwBvR,SAAS,GAFrE,QAGGrB,EAAoBuB,UAHvB,kBAIE,eAAC,IAAD,CAAMhV,GAAI,CAAE4B,WAAY,QAAxB,cAAoC8kB,EAAc5R,SAAS,GAA3D,mBC5CR2L,GAAW,SAAC,GAAD,MAA0E,CACzF6D,iBADe,EAAGA,iBAElBtH,MAFe,EAAqBA,MAGpCvJ,oBAHe,EAA4BA,sBAMhCmT,GAA0B,WAAO,IACpC9H,EAAkBkF,KAAlBlF,cADmC,EAEcpM,8BAAmB+N,IAApE6D,EAFmC,EAEnCA,iBAAkBtH,EAFiB,EAEjBA,MAAOvJ,EAFU,EAEVA,oBAE3BoT,EAAYvC,EAAiBvB,YAAYG,OAAO,IAAKzP,GAErDqT,EAAsBngB,uBAAY,WACtCmY,EAAc,4BACb,CAACA,IAEEiI,GAAazC,EAAiBd,WAAW1F,OACzCkJ,GAAW1C,EAAiBf,eAAezF,OAC3CmJ,GAAYjK,EAAM9C,QAGlB/T,EAAmBE,GADH,qBAEhB6gB,EACsB,uBAA1B/gB,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KAQnB,OANA9G,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,qBAEf,CAAC3Y,EAAiB3D,KAAMsc,IAGzB,eAAC,IAAD,WACE,eAAC,IAAD,6BAEIoI,GACA,cAAC,IAAD,CAAMlnB,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAIN,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CACE+N,MAAM,UACNoJ,QAAQ,eACRE,OAAQgN,EAAiBvB,YAAYjQ,WACrC7E,KAAM+D,KAGR,cAAC,GAAD,CACEhE,MAAM,aACNoJ,QAAQ,gBACRE,OAAQuP,EAAU/T,SAAS,GAC3B7E,KAAK,MAGP,cAAC,GAAD,CACED,MAAM,mBACNoJ,QAAQ,eACRE,OAAQgN,EAAiBf,eAAezQ,SAAS,GACjDpT,MAAO4kB,EAAiBf,eAAejP,SAAW,UAClDrG,KAAK,QAGP,eAAC,IAAD,CAAMjO,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,GAAD,CACE0N,MAAM,SACNoJ,QAAQ,iBACRE,OAAQgN,EAAiBd,WAAW1Q,WACpCpT,MAAO4kB,EAAiBd,WAAWlP,SAAW,UAC9CrG,KAAMgE,GACN8E,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,gPASR,cAAC,IAAD,CAAMxB,GAAI,CAAEK,eAAgB,WAAY8N,KAAM,GAA9C,SACE,cAAC,GAAD,YAKN,eAAC,IAAD,CAAMrN,QAAQ,iBAAd,UACE,eAAC,IAAD,CAAQA,QAAQ,UAAUC,QAAS+lB,EAAnC,UACE,cAAC,EAAD,CAAM9qB,KAAK,MAAMgF,KAAK,OADxB,gBAKA,cAAC,GAAD,CAAc0G,UAAWsf,IAAYD,EAArC,mCAGDE,GACC,cAAC,GAAD,CAAcvf,UAAWsf,EAAzB,iDAIHE,GAA2B,cAAC,GAAD,QCpHrBC,GAAsB,SAAArR,GAAU,IACnCgJ,EAAkBkF,KAAlBlF,cAEFS,EAAkB5Y,uBAAY,WAClCmY,EAAc,qBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,eAAC,IAAD,4BAEE,cAAC,IAAD,CAAM9e,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAGJ,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,0CAAnB,mEAIA,eAAC,IAAD,CAAMiB,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAMd,GAAI,CAAEK,eAAgB,aAAc8N,KAAM,EAAG7N,WAAY,UAA/D,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAQS,QAASwe,EAAjB,+BCzBG6H,GAAsB,SAAAtR,GAGjC,OAFiBkO,KAATrB,MAGN,IAAK,OACH,OAAO,cAAC,GAAD,eAAe7M,IAExB,IAAK,aAGL,IAAK,YACH,OAAO,cAAC,GAAD,eAA6BA,IAEtC,IAAK,SACH,OAAO,cAAC,GAAD,eAAmBA,MCT1BuR,GAAc,SAAC,GAAD,SAAG9T,OAEV+T,GAAyB,WAAO,IAAD,EAMtCtqB,IAJFP,QACQA,EAHgC,EAGtCgK,KACmC8gB,EAJG,EAItCnsB,WAAcosB,oBAIZjU,EAAQb,8BAAmB2U,IARS,EASJnsB,mBAASqY,EAAMuB,SAAS,IATpB,mBASnC2S,EATmC,KAStBC,EATsB,KAe1C,OAJAhsB,qBAAU,WACRgsB,EAAenU,EAAMuB,SAAS,MAC7B,CAACvB,IAGF,eAAC,IAAD,WACE,cAAC,IAAD,yBAEA,cAAC,IAAD,CAAKvT,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CAAMD,GAAI,CAAEM,WAAY,WAAxB,UACE,cAAC,IAAD,kBAEA,cAAC,IAAD,CAAOQ,QAAQ,OAAf,eAEA,cAAC,IAAD,CACE0B,KAAM+kB,EAAc,SAAW,OAC/B9O,KAAK,MACL1b,MAAO0qB,EACP9O,SAAU,SAAAlD,GAAC,OAAIiS,EAAejS,EAAEzR,OAAOjH,QACvC2K,UAAW6f,IAGZA,GACC,cAAC,IAAD,CAAMvnB,GAAI,CAAE6D,GAAI,EAAGvD,WAAY,UAA/B,SACE,cAACuG,GAAD,CACEN,GAAG,YACHO,QAAQ,MACRC,iBAAiB,SACjBN,KAAM,SAAAhO,GACJ,IAAKgvB,EACH,MAAM,IAAIvtB,MAAM,iBAElB,OAAOuC,EAAQkrB,SAASlX,WAAQC,KAAK+W,GAAchvB,IARvD,SAWE,cAAC,IAAD,CAAQqI,QAAQ,OAAhB,SACE,cAAC,EAAD,CAAM9E,KAAK,aAAagF,KAAK,sBC3ClC4mB,GAAqBttB,wBAA6C,MAElEutB,GAAiB,WAC5B,IAAM5M,EAAU/d,qBAAW0qB,IAE3B,GAAgB,OAAZ3M,EACF,MAAM,IAAI/gB,MAAM,0DAGlB,OAAO+gB,GClBH6M,GAAkB,SAAC,GAAD,SAAGC,WAEdC,GAA+B,WAAO,IACzCvrB,EAAYO,IAAZP,QADwC,EAEXiW,8BAAmBoV,IAAhDvE,EAFwC,EAExCA,eAAgB0E,EAFwB,EAExBA,SAFwB,EAItBzhB,GACxB,QACA/J,EAAQgK,KAAKyhB,yBAAyBtN,KAAKne,EAAQgK,OAF9CS,EAJyC,oBAShD,OACE,cAAC,IAAD,CAAQnG,QAASmG,EAAiBQ,SAAU6b,EAAezF,QAAUmK,EAASnK,OAA9E,0BCNEzL,GAAS,SAAC,GAAD,MAAwD,CACrE0V,UADa,EAAGA,UAEhBnU,gBAFa,EAAcA,kBAKhBuU,GAA0B,WAAO,IAAD,EACPN,KAA5B9N,EADmC,EACnCA,cAAetW,EADoB,EACpBA,SADoB,EAEJiP,8BAAmBL,IAAlD0V,EAFmC,EAEnCA,UAAWnU,EAFwB,EAExBA,gBAEbiT,EAAYkB,EAAUK,WAAWlF,OAAO,IAAKtP,GAEnD,OACE,eAAC,IAAD,WACE,cAAC,IAAD,sBAEA,eAAC,IAAD,CAAK5T,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,QACNoJ,QAAQ,aACRE,OAAQyQ,EAAUK,WAAWtV,WAC7B7E,KAAMgE,KAGR,cAAC,GAAD,CACEjE,MAAM,aACNoJ,QAAQ,cACRE,OAAQuP,EAAU/T,SAAS,GAC3B7E,KAAK,MAGP,cAAC,GAAD,CACED,MAAM,kBACNoJ,QAAQ,iBACRE,OAAQyQ,EAAUxE,eAAezQ,SAAS,GAC1CpT,MAAOqoB,EAAUxE,eAAejP,SAAW,UAC3CrG,KAAK,QAGP,cAAC,GAAD,CACED,MAAM,gBACNoJ,QAAQ,kBACRE,OAAQyQ,EAAUE,SAASnV,WAC3BpT,MAAOqoB,EAAUE,SAAS3T,SAAW,UACrCrG,KAAM+D,KAGR,eAAC,IAAD,CAAMlR,QAAQ,iBAAd,UACE,eAAC,IAAD,CAAQA,QAAQ,UAAUC,QAAS,kBAAM0C,EAAS,CAAEjB,KAAM,oBAA1D,UACE,cAAC,EAAD,CAAMxG,KAAK,MAAMgF,KAAK,OADxB,gBAKA,cAAC,GAAD,UAIH+Y,GAAiB,cAAC,GAAD,QCxDlB1H,GAAS,SAAC,GAAD,MAA0D,CACvEG,YADa,EAAGA,YAEhBoB,gBAFa,EAAgBA,kBAYlByU,GAA8C,SAAC,GAMrD,IALL5tB,EAKI,EALJA,SACAoF,EAII,EAJJA,MACAyoB,EAGI,EAHJA,cACAC,EAEI,EAFJA,WACA9kB,EACI,EADJA,SACI,EACqCiP,8BAAmBL,IAApDG,EADJ,EACIA,YAAaoB,EADjB,EACiBA,gBACbmG,EAAkB8N,KAAlB9N,cACF/B,EAAe9c,qBAEf2e,GAAU0O,EAAW7I,GAAG4I,EAAcF,YAEtCjQ,EAAYmQ,EAAcF,WAAW/qB,IAAImV,GACzC4F,EAAWmQ,EAAW7I,GAAGvH,GAEzBqQ,EAA6B5U,EAAgBkJ,IAAIwL,EAAcF,YAAY/qB,IAAIkrB,GAE/EtF,EAAoBqF,EAAcF,WAAWlF,OAAO,IAAKtP,GACzDuP,EAAeoF,EAAWrF,OAAO,IAAKsF,GACtCpF,EACJkF,EAAcF,WAAW9T,SAAW8F,cAAWC,QAAQ8I,EAAcF,GAAmB3O,QAE1F,OACE,eAAC,IAAD,WACE,eAAC,IAAD,WACGzU,EACAga,IAAWE,GACV,cAAC,IAAD,CACEjZ,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAM0C,EAAS,CAAEjB,KAAM,YAHlC,SAKE,cAAC,EAAD,CAAMxG,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,QACNoJ,QAAQ,aACRE,OAAQiR,EAAWzV,WACnBqF,UAAWA,EAAUrD,WACrBsD,SAAUA,EACVnK,KAAMgE,GACA+F,eACNC,aAAcsQ,EAAWzT,SAAS,GAClCoD,gBAAiB,SAAAyF,GAAQ,OAAIla,EAAS,CAAEjB,KAAM,WAAYmb,gBAG3DwF,EAAaE,SACZ,cAAC,GAAD,CAAWrV,MAAM,aAAaoJ,QAAQ,cAAcE,OAAO,QAE3D,cAAC,GAAD,CACEtJ,MAAM,aACNoJ,QAAQ,cACRE,OAAQ6L,EAAarQ,SAAS,GAC9ByE,cAAa,OAAE6L,QAAF,IAAEA,OAAF,EAAEA,EAAiBtQ,SAAS,GAAGwQ,OAAO,KACnD9L,cAA6B,OAAf4L,QAAe,IAAfA,OAAA,EAAAA,EAAiB9J,UAAW,UAAY,SACtDrL,KAAK,OAIPqa,EAAcpO,SACd,qCACE,cAAC,GAAD,CACElM,MAAM,kBACNoJ,QAAQ,iBACRE,OAAQgR,EAAc/E,eAAezQ,SAAS,GAC9CpT,MAAO4oB,EAAc/E,eAAejP,SAAW,UAC/CrG,KAAK,QAGP,cAAC,GAAD,CACED,MAAM,gBACNoJ,QAAQ,kBACRE,OAAQgR,EAAcL,SAASnV,WAC/BpT,MAAO4oB,EAAcL,SAAS3T,SAAW,UACzCrG,KAAM+D,QAKXvX,KAGFsf,GAAiB,cAAC,GAAD,QCtGX0O,GAAqD,SAAC,GAA0B,IAAxBzP,EAAuB,EAAvBA,OAAQve,EAAe,EAAfA,SACnEgC,EAAYO,IAAZP,QADkF,EAGhE+J,GACxB,QACAwS,EAAO0P,UACHjsB,EAAQgK,KAAKiiB,UAAU9N,KAAKne,EAAQgK,KAAMuS,EAAO0P,WACjDjsB,EAAQgK,KAAKkiB,YAAY/N,KAAKne,EAAQgK,KAAMuS,EAAO2P,cAJlDzhB,EAHmF,oBAU1F,OAAO,cAAC,IAAD,CAAQnG,QAASmG,EAAjB,SAAmCzM,KCAtCsiB,GAAO,SAAC,GAAD,IAAGgL,EAAH,EAAGA,UAAH,MAAuC,CAClDO,cAAeP,EACfQ,WAAYR,EAAUK,aASlB/K,GAAS,SAAC/a,EAA0BC,GAAkD,IAIlF+lB,EAA8BhmB,EAA9BgmB,cAAeC,EAAejmB,EAAfimB,WAEvB,OAAQhmB,EAAOC,MACb,IAAK,WACH,OAAO,2BAAKF,GAAZ,IAAmBimB,WAAY9X,WAAQC,KAAKnO,EAAOob,YAErD,IAAK,SACH,OAAO,2BAAKrb,GAAZ,IAAmBimB,WAAYD,EAAcF,aAE/C,IAAK,cAAgB,IAESQ,EACxBrmB,EADF0b,YAAe8J,UAGjB,GAAIa,EACF,MAAO,CACLN,cAAeM,EACfL,WAAYK,EAAa1M,MAAMoM,EAActM,YAAYuM,KAMjE,OAAOjmB,GAGHumB,GAAoB,SAAC,GAAD,SAAGrW,aAOvBsW,GAAkF,SAAC,GAGlF,IAAD,QAFJR,EAEI,EAFJA,cACAtP,EACI,EADJA,OAEM0P,EAAS,UAAG1P,EAAO0P,iBAAV,aAAG,EAAkB5V,WAAWwQ,OAAO,IAAKrR,IACrD0W,EAAW,UAAG3P,EAAO2P,mBAAV,aAAG,EAAoB7V,WAAWwQ,OAAO,IAAKrR,IACzDsR,EAAc,UAAG+E,EAAc/E,eAAejP,eAAhC,aAAG,EAAsCxB,SAAS,GAAGwQ,OAAO,QAC1E2E,EAAQ,UAAGK,EAAcL,SAAS3T,eAA1B,aAAG,EAAgCxB,WAAWwQ,OAAO,IAAKtR,IAExE,OAAIsW,EAAcpO,SAAWwO,EAEzB,eAAC,GAAD,8BACkB,cAAC,GAAD,UAASA,IAD3B,OAOF,eAAC,GAAD,WACGA,GACC,uDACiB,cAAC,GAAD,UAASA,IAD1B,oBAIDC,GACC,4DACsB,cAAC,GAAD,UAASA,IAD/B,sBAIApF,GAAkB0E,IAClB,qCACG,IADH,eAEe,IACZ1E,GAAkB0E,EACjB,qCACE,cAAC,GAAD,UAAS1E,IADX,QACwC,cAAC,GAAD,UAAS0E,OAGjD,mCACE,cAAC,GAAD,iBAAS1E,QAAT,IAASA,IAAkB0E,SArBrC,QA+BSc,GAA2B,WAAO,IAAD,EAC1BC,EAA8BnB,KAAxCpkB,SADoC,EAEMkb,6BAAkBtB,GAAQN,IAFhC,0BAEnCuL,EAFmC,EAEnCA,cAAeC,EAFoB,EAEpBA,WAAc9kB,EAFM,KAGtC+O,EAAcE,8BAAmBmW,IAEjC7P,EAASsP,EAActM,YAAYuM,GALG,EAMRvP,GAEhC,UAAAA,EAAO0P,iBAAP,eAAkBvP,GAAG3G,IACrB,MACE3Y,EACA,eAAC,GAAD,uEAC4D,IAC1D,eAAC,GAAD,WACGmf,EAAO0P,UAAU5L,IAAItK,GAAaM,WADrC,IACkDb,MAHpD,QAQF,CAAC+G,EAAQ,cAAC,GAAD,CAAiCsP,cAAeA,EAAetP,OAAQA,KAZhF,MAACnf,OAAWA,GAP4B,mBAMrC+kB,EANqC,KAMxBC,EANwB,KAqBtCoK,EAAiBX,EAAcpO,QAErC,OACE,eAAC,GAAD,CAAera,MAAO,UAAiByoB,gBAAeC,aAAY9kB,WAAlE,iBACGob,QADH,IACGA,IACEoK,EACC,eAAC,GAAD,kCAAwChX,GAAxC,2BAEA,eAAC,GAAD,yBAA+BA,GAA/B,mCAGJ,eAAC,IAAD,CAAMnR,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEA,QAAQ,SACRC,QAAS,kBAAMioB,EAA0B,CAAExmB,KAAM,qBAFnD,oBAOCoc,EACC,cAAC,GAAD,CAAsB5F,OAAQ4F,EAA9B,qBAEA,cAAC,IAAD,CAAQlX,UAAQ,EAAhB,4BC1JGwhB,GAAoB,WAAO,IAC9BzlB,EAAaokB,KAAbpkB,SAER,OACE,eAAC,IAAD,WACE,cAAC,IAAD,sBACA,eAAC,IAAD,CAAKzD,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,GAAD,CAAaJ,MAAK,6BAAwBoS,GAAxB,SAAlB,mBACSA,GADT,wDAIA,cAAC,IAAD,CAAMnR,QAAQ,iBAAd,SACE,cAAC,IAAD,CAAQC,QAAS,kBAAM0C,EAAS,CAAEjB,KAAM,oBAAxC,oCCdG2mB,GAAoB,WAG/B,OAFiBtB,KAATlF,MAGN,IAAK,SACH,OAAO,cAAC,GAAD,IAET,IAAK,YACH,OAAO,cAAC,GAAD,IAET,IAAK,OACH,OAAO,cAAC,GAAD,MCRAyG,GAAsB,kBACjC,eAAC,IAAD,CAAWtoB,QAAQ,UAAnB,UACE,eAAC,IAAD,CAAWA,QAAQ,OAAnB,UACE,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,OAGF,eAAC,IAAD,CAAWA,QAAQ,QAAnB,UACE,cAAC,GAAD,IACA,cAAC,GAAD,WCZOuoB,GAAiC,WAAO,IAEvCxwB,EACRmE,IADF5D,OAAUP,YAGZ,OACE,eAAC,IAAD,CACEmH,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhB+O,EAAG,EACHnP,EAAG,EACHyO,SAAU,QAEV5D,OAAQ,EACR5K,aAAc,MACdM,YAAa,UACbiL,UAAW,GAbf,UAgBE,eAAC,IAAD,CAAMzL,GAAI,CAAEM,WAAY,SAAUqO,GAAI,EAAGpN,GAAI,GAA7C,UACE,cAAC,EAAD,CAAMvF,KAAK,uBAAuBgF,KAAK,OACvC,cAAC,IAAD,CAAShB,GAAI,CAAE6D,GAAI,EAAGjD,SAAU,QAAhC,4CAGF,eAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,GAA3B,oEACyD,4BAAIuR,GAAetZ,KAAkB,IAD9F,0DCnBAywB,GAAwE,SAAC,GAAsB,IAApBxV,EAAmB,EAAnBA,aAE5DrX,EACfO,IADFP,QAAWgK,KAGP6b,EAAkB,oBAClBrD,EAAqB5Y,GAAsBic,GAEjD,MAAmC,uBAA5BrD,EAAmBzc,KACxB,eAAC,IAAD,CAAQkF,UAAQ,EAAhB,UACE,cAAC,IAAD,CAAS1H,GAAI,CAAEsB,GAAI,EAAG5B,MAAO,SAAWsB,KAAK,SAD/C,+BAI8B,2BAA5Bie,EAAmBzc,MACO,cAA5Byc,EAAmBzc,KACnB,cAACqE,GAAD,CAAaN,GAAI+b,EAAiB7b,KAAMhK,EAAQ8sB,iBAAiB3O,KAAKne,EAASqX,GAA/E,SACE,cAAC,IAAD,yBAEA,MAGO0V,GAAiC,WAAO,IAC3CxuB,EAAYgC,IAAZhC,QAD0C,EAGVE,mBAASuV,WAAQC,KAAK,KAHZ,mBAG3CoD,EAH2C,KAG7B2V,EAH6B,OAI5BvuB,mBAASuV,WAAQC,KAAK,KAJM,mBAI3CgZ,EAJ2C,KAItCC,EAJsC,OAKEzuB,mBAAS,MALX,mBAK3C0uB,EAL2C,KAKvBC,EALuB,KAOlD,OACE,qCACE,eAAC,IAAD,WACE,cAAC,IAAD,qCAEA,cAAC,IAAD,CAAK7pB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,4BACA,cAAC,IAAD,CAAOa,QAAQ,OAAf,eAEA,cAAC,IAAD,CACEd,GAAI,CAAE0O,SAAU,SAChBlM,KAAK,SACLiW,KAAK,MACL1b,MAAO6sB,EACPjR,SAAU,SAAAlD,GACRoU,EAAsBpU,EAAEzR,OAAOjH,OAC/B,IACE,IAAM+sB,EAAkBrZ,WAAQC,KAAK+E,EAAEzR,OAAOjH,OAAS,GAAGyX,IAAI,KACxDuV,EAAStZ,WAAQuZ,IAAIlN,IAAIgN,GAE/BL,EAAgBK,GAChBH,EAAOI,GACP,YAEJnR,OAAQ,WACNiR,EAAsB/V,EAAae,IAAI,KAAKC,uBAOtD,eAAC,IAAD,CACE9U,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhB+O,EAAG,EACH5D,GAAI,CAAC,EAAG,KAAM,GACdjK,GAAI,EACJtB,EAAG,EACHyO,SAAU,QAEV5D,OAAQ,EACR5K,aAAc,MACdM,YAAa,SACbiL,UAAW,GAff,UAkBE,eAAC,IAAD,CAAMzL,GAAI,CAAEM,WAAY,SAAUqO,GAAI,EAAG/N,SAAU,GAAnD,UACE,cAAC,EAAD,CAAM5E,KAAK,eACX,cAAC,IAAD,CAASgE,GAAI,CAAE6D,GAAI,EAAGjD,SAAU,QAAhC,mCAGF,eAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,EAAG4K,GAAI,GAAlC,uCAC4B,4BAAI2G,GAAenX,KAD/C,cACwE,IACtE,8BAAI0uB,EAAI7U,IAAI,KAAKC,WAAjB,OAFF,wDAKA,cAAC,IAAD,CAAW9U,GAAI,CAAEY,SAAU,EAAG4K,GAAI,EAAG5J,WAAY,QAAjD,sFAIA,cAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,EAAG4K,GAAI,GAAlC,kJAMF,cAAC,GAAD,CAAkCsI,qBCzG3BmW,GAA0E,SAAC,GAAD,IACrFC,EADqF,EACrFA,UADqF,OAGrF,qCACE,eAAC,IAAD,CACElqB,GAAI,CACF0K,QAAS,OACTrJ,cAAe,SACfhB,eAAgB,eAEhB+O,EAAG,EACH5D,GAAI,EACJjK,GAAI,EACJtB,EAAG,EACHyO,SAAU,QAEVtO,GAAI,2BACJV,MAAO,UAEPoL,OAAQ,EACR5K,aAAc,MACdM,YAAa,UACbiL,UAAW,GAlBf,UAqBE,eAAC,IAAD,CAAMzL,GAAI,CAAEM,WAAY,SAAUqO,GAAI,EAAGpN,GAAI,EAAGX,SAAU,GAA1D,UACE,cAAC,EAAD,CAAM5E,KAAK,UACX,cAAC,IAAD,CAASgE,GAAI,CAAE6D,GAAI,EAAGjD,SAAU,GAAhC,yBAGF,cAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,GAA3B,oEAGF,cAAC,IAAD,CAAQG,QAASmpB,EAAjB,iCC5BEC,GAAiB,SAAC,GAAD,SAAGtW,UAEbuW,GAAyB,WAAO,IAAD,EAItCptB,IAFFhC,EAFwC,EAExCA,QACUnC,EAH8B,EAGxCO,OAAUP,YAGNgb,EAAWnB,8BAAmByX,IAC9BE,EAAexxB,IAAgBC,KAAmC,iBAApB+a,EAAS1Z,OAPnB,EASJe,oBAAS,GATL,mBASnCovB,EATmC,KAStBC,EATsB,KAiB1C,OANA7uB,qBAAU,WACJ2uB,GACFE,GAAe,KAEhB,CAACF,IAEAC,GAAeD,EACO,eAApBxW,EAAS1Z,OACJ,cAAC,GAAD,CAA6B+vB,UAAW,kBAAMK,GAAe,MAC3DvvB,IAAYnC,EACd,cAAC,GAAD,IAEA,cAAC,GAAD,IAGF,cAAC,GAAD,KCjCE2xB,GAAkBlwB,wBAA0C,MAE5DmwB,GAAc,WACzB,IAAMxP,EAAsC/d,qBAAWstB,IAEvD,GAAgB,OAAZvP,EACF,MAAM,IAAI/gB,MAAM,yDAGlB,OAAO+gB,GCXHwF,GAAW,SAAC,GAAD,MAAgE,CAC/EiK,mCADe,EAAGA,qCAIPzF,GAA0B,WAAO,IACpCyF,EAAuChY,8BAAmB+N,IAA1DiK,mCAER,OACE,eAAC,IAAD,CAAM1qB,GAAI,CAAEsB,GAAI,EAAGV,SAAU,EAAGgB,WAAY,UAA5C,UACG8oB,EAAmC5X,SAAS,GAD/C,sBCIE6X,GAAe,SAACC,EAA0BC,GAA3B,gCACND,EAAiBha,cADX,0FAOPia,EAAgBja,cAPT,kDAad,SAAeka,GAAtB,qC,8CAAO,WAA2BF,EAA0BC,GAArD,mCAAAnyB,EAAA,sEACkB2D,OAAOtC,MAAM,6DAA8D,CAChGkX,OAAQ,OACRS,QAAS,CACP,eAAgB,oBAElBnF,KAAMoF,KAAKC,UAAU,CACnBmZ,MAAOJ,GAAaC,EAAkBC,GACtCG,UAAW,SARV,WACChxB,EADD,QAYSC,GAZT,yCAaImX,QAAQ6Z,OAAO,iDAbnB,uBAgB2CjxB,EAASb,OAhBpD,mBAgBG+xB,EAhBH,EAgBGA,OAAMC,EAhBT,EAgBSA,QAhBT,0CAmBI/Z,QAAQ6Z,OAAOE,IAnBnB,WAuBgC,kBAAnC,OAAOD,QAAP,IAAOA,GAAP,UAAOA,EAAME,aAAb,aAAO,EAAaC,aACc,kBAAlC,OAAOH,QAAP,IAAOA,GAAP,UAAOA,EAAMI,YAAb,aAAO,EAAYC,aACgB,kBAAnC,OAAOL,QAAP,IAAOA,GAAP,UAAOA,EAAMI,YAAb,aAAO,EAAYE,cACe,kBAAlC,OAAON,QAAP,IAAOA,GAAP,UAAOA,EAAMO,cAAb,aAAO,EAAcC,UA1BlB,wBA4BGC,EAAclb,WAAQC,KAAKwa,EAAKO,OAAOC,UACvCxF,EAAezV,WAAQC,KAAKwa,EAAKE,MAAMC,YAAYxW,IAAI8W,GACvDC,EAAgBnb,WAAQC,KAAKwa,EAAKI,KAAKC,YAAY/W,IACvD/D,WAAQC,KAAKwa,EAAKI,KAAKE,cA/BtB,kBAkCI,CAAEtF,eAAc0F,kBAlCpB,iCAqCExa,QAAQ6Z,OAAO,8DArCjB,6C,sBCtBP,IAAMxK,GAAW,SAAC,GAAD,MAGS,CACxBiK,mCAJe,EACfA,mCAIAmB,qBALe,EAEfA,uBAMWvF,GAAkB,WAAO,IAAD,EAK/BtpB,IAHFP,QACErB,WAAc0wB,EAHiB,EAGjBA,UAAWC,EAHM,EAGNA,8BAHM,EAOkCrZ,8BAAmB+N,IAAhFiK,EAP2B,EAO3BA,mCAAoCmB,EAPT,EAOSA,qBAPT,EAQD3wB,wBAA8BrB,GAR7B,mBAQ5B0sB,EAR4B,KAQjBC,EARiB,OASCtrB,wBAA8BrB,GAT/B,mBAS5BmyB,EAT4B,KAShBC,EATgB,KAU7BxF,EAAeiE,EAAmC5M,QAAU+N,EAAqB/N,OACjF8M,EAAmBkB,EAAS,UAC5BjB,EAAkBiB,EAAS,SAE3BI,EADmBxB,EAAmClW,IAAIuX,GACzBvX,IAAI,OAc3C,GAZA9Y,qBAAU,WACR,sBAAC,gCAAAhD,EAAA,+EAEiDoyB,GAAYF,EAAkBC,GAF/E,gBAEW3E,EAFX,EAEWA,aAAc0F,EAFzB,EAEyBA,cACtBpF,EAAaN,GACb+F,EAAcL,GAJjB,kDAMGryB,QAAQC,MAAR,MANH,yDAAD,KASC,CAACoxB,EAAkBC,IAElBpE,QAA8B5sB,IAAd0sB,QAA0C1sB,IAAfmyB,EAA0B,OAAO,KAEhF,IAAMrF,EAAqB+D,EAAmC7V,IAAI0R,GAC5D4F,EAAwBN,EAAqBhX,IAAImX,GACjDI,EAAkBzF,EAAmBnS,IAAI2X,GAAuBtX,IAAI,KAE1E,OAAIuX,EAAgBtO,OAAe,KAGjC,eAAC,GAAD,WACE,eAAC,IAAD,kBACGoO,QADH,IACGA,OADH,EACGA,EAAepZ,SAAS,GAD3B,cAC0CsZ,EAAgBtX,SAAS,GADnE,OAGA,cAAC,GAAD,CACEhO,QACE,eAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEqP,SAAU,CAAC,OAAQ,UAAjD,UACE,eAAC,IAAD,iBACK,cAAC,IAAD,CAAMrP,GAAI,CAAE4B,WAAY,QAAxB,sBADL,+HAIA,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQuM,WAAY,YAAa3B,GAAI,GAAhE,qDAC2C,IACzC,cAAC,IAAD,CAAMxL,GAAI,CAAE4B,WAAY,QAAxB,uBAEF,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQuM,WAAY,aAA/C,eAEGwZ,EAAmB3R,UAFtB,OAEqCmX,EAAsBnX,UAF3D,YAGE,eAAC,IAAD,CAAMhV,GAAI,CAAE4B,WAAY,QAAxB,cAAoCwqB,EAAgBtX,SAAS,GAA7D,mBC7DDuX,GAAqB,WAAO,IAFxBC,EAGPxN,EAAkB2L,KAAlB3L,cAIUgN,EAEd9uB,IAHFP,QACErB,WAAc0wB,UAIZS,EAAqB5lB,uBAAY,WACrCmY,EAAc,mBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,eAAC,IAAD,oCAEE,cAAC,IAAD,CAAM9e,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAGJ,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,GAAD,CAAaJ,MAAM,2BAAnB,UACE,cAAC,IAAD,4EAEA,eAAC,IAAD,CAAWG,GAAI,CAAEwL,GAAI,GAArB,gEACsD,IACpD,eAAC,IAAD,CAAMzH,MA7BDuoB,EA6BeR,EAAS,UA7BzB,4CAA8DQ,IA6BrBtoB,OAAO,SAApD,uCAC4B,cAAC,EAAD,CAAMhI,KAAK,oBAAoBgF,KAAK,gBAKpE,eAAC,IAAD,CAAMF,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAMd,GAAI,CAAEK,eAAgB,aAAcC,WAAY,SAAU6N,KAAM,GAAtE,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAQpN,QAASwrB,EAAjB,6BC7CJ9L,GAAW,SAAC,GAAD,MAIS,CACxB+L,gBALe,EACfA,gBAKAC,kBANe,EAEfA,kBAKAC,qBAPe,EAGfA,uBAiBWC,GAAqB,SAACrV,GAA0C,IAAD,EACL5E,8BAAmB+N,IAAhF+L,EADkE,EAClEA,gBAAiBC,EADiD,EACjDA,kBAAmBC,EAD8B,EAC9BA,qBACtCE,EAAgBF,EAAqBvT,GAAG7B,GACxCuV,EAAgBD,EAClBF,EAAqB5P,IAAIxF,GACzB7G,WAAQC,KAAK4G,GAAQwF,IAAI4P,GACvBI,EAAeJ,EAAqBrvB,IAAImvB,GACxCO,EAAqBzV,EAAOoI,GAAGoN,GAErC,GAAIF,EACF,MAAO,CACLI,SAAS,EACTC,aAAa,EACbC,mBAAmB,EACnBN,gBACAC,gBACAC,eACAC,sBAIJ,IAAME,GAAeR,EAAkB3O,QAAU2O,EAAkBU,IAAIN,GACjEK,GAAqBV,EAAgB1O,QAAU0O,EAAgBW,IAAIN,GAEzE,MAAO,CACLG,QAASC,GAAeC,EACxBD,cACAC,oBACAN,gBACAC,gBACAC,eACAC,uBC1CEvS,GAAgB,eAET4S,GAAkC,SAAC,GAAgB,IAAd9V,EAAa,EAAbA,OACxCwH,EAAkB2L,KAAlB3L,cAEWriB,EACfO,IADFP,QAAWgK,KAGPN,EAAmBE,GAAsBmU,IANc,EAOXmS,GAAmBrV,GAA7D0V,EAPqD,EAOrDA,QAASJ,EAP4C,EAO5CA,cAAeC,EAP6B,EAO7BA,cAE1BQ,EAAoBT,EACtBnwB,EAAQ6wB,iBAAiB1S,KAAKne,EAASowB,GACvCpwB,EAAQ8wB,eAAe3S,KAAKne,EAASowB,GAEnCW,EAAgBX,EAAc/O,SAAWkP,EAQ/C,OANAtxB,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,qBAEf,CAAC3Y,EAAiB3D,KAAMsc,IAGzB,cAACjY,GAAD,CACEN,GAAIiU,GACJ/T,KAAM4mB,EACNrmB,YAAY,YACZD,iBAAiB,SAJnB,SAME,cAAC,IAAD,CAAQW,SAAU8lB,EAAlB,wBC7BAhT,GAAgB,aAETiT,GAA0C,SAAC,GAAgB,IAAdnW,EAAa,EAAbA,OAErC7a,EACfO,IADFP,QAAWgK,KAFwD,EAINkmB,GAAmBrV,GAA1E0V,EAJ6D,EAI7DA,QAASC,EAJoD,EAIpDA,YAAaL,EAJuC,EAIvCA,cAAeC,EAJwB,EAIxBA,cAE7C,OAAKI,GAQAD,GAAWH,EAAc/O,OACrB,KAIP,eAAC,GAAD,WACG8O,GACC,cAAC/lB,GAAD,CAAaN,GAAIiU,GAAe/T,KAAMhK,EAAQ6wB,iBAAiB1S,KAAKne,EAASowB,GAA7E,SACE,eAAC,IAAD,gCACqBA,EAAc/Z,SAAS,GAD5C,IACiDZ,SAInD0a,GACA,cAAC/lB,GAAD,CAAaN,GAAIiU,GAAe/T,KAAMhK,EAAQ8wB,eAAe3S,KAAKne,EAASowB,GAA3E,SACE,eAAC,IAAD,8BACmBA,EAAc/Z,SAAS,GAD1C,IAC+CZ,WAtBnD,cAAC,GAAD,UACE,eAAC,IAAD,4BAAqBA,GAArB,gECZFsI,GAAgB,eAETkT,GAAkC,SAAC,GAAgB,IAAdpW,EAAa,EAAbA,OACxCwH,EAAkB2L,KAAlB3L,cAEWriB,EACfO,IADFP,QAAWgK,KAGLwmB,EAAgBN,GAAmBrV,GAAnC2V,YACF9mB,EAAmBE,GAAsBmU,IAQ/C,OANA9e,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,oBAEf,CAAC3Y,EAAiB3D,KAAMsc,IAEvBmO,EACK,KAIP,cAACpmB,GAAD,CACEN,GAAIiU,GACJ/T,KAAMhK,EAAQkxB,iBAAiB/S,KAAKne,OAAS5C,GAC7CmN,YAAY,YACZD,iBAAiB,SAJnB,SAME,cAAC,IAAD,CAAQ/G,GAAI,CAAEwB,MAAO,OAArB,+BC9BOosB,GAAwC,SAAC,GAAgB,IAAdtW,EAAa,EAAbA,OAAa,EACfqV,GAAmBrV,GAA/D0V,EAD2D,EAC3DA,QAASC,EADkD,EAClDA,YAAaC,EADqC,EACrCA,kBAE9B,OAAIF,EACK,KAGJC,EAIAC,EAIE,KAHE,eAAC,GAAD,oCAAyChb,MAJzC,eAAC,GAAD,0CAA+CA,OCFpDsI,GAAgB,QAChBiG,GAAW,SAAC,GAAD,MAAkD,CAAEoL,qBAApD,EAAGA,uBAEP1C,GAAoB,WAAO,IAC9BrK,EAAkB2L,KAAlB3L,cACA+M,EAAyBnZ,8BAAmB+N,IAA5CoL,qBAF6B,EAIT3wB,mBAAkBuV,WAAQC,KAAK,IAJtB,mBAI9B4G,EAJ8B,KAItBuW,EAJsB,KAK/B7V,EAAe9c,qBACf+lB,GAAW3J,EAAOwG,OANa,EAQQ6O,GAAmBrV,GAAxDwV,EAR6B,EAQ7BA,aAAcC,EARe,EAQfA,mBAEhB5mB,EAAmBE,GAAsBmU,IACzC4G,EACsB,uBAA1Bjb,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KAEb6e,EAAsB1a,uBAAY,WACtCmY,EAAc,oBACb,CAACA,IAEEgP,EAA2BjC,EAAqBxuB,IAAIia,GAEpDuP,EAAYvP,EAAO4L,OAAO,IAAK4K,GAErC,OACE,eAAC,IAAD,WACE,eAAC,IAAD,oCAEG7M,IAAYG,GACX,cAAC,IAAD,CACEtgB,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAM8sB,EAAUpd,WAAQC,KAAK,KAHxC,SAKE,cAAC,EAAD,CAAM1U,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,QACNoJ,QAAQ,YACRE,OAAQA,EAAOxE,SAAS,GACxB7E,KAAMiE,GACN8F,aAAcA,EACdC,aAAcX,EAAOxC,SAAS,GAC9BoD,gBAAiB,SAAAZ,GAAM,OAAIuW,EAAUpd,WAAQC,KAAK4G,KAClDa,UAAW2U,EAAahY,WACxBsD,SAAU2U,IAGXlG,EAAUxD,SACT,cAAC,GAAD,CAAWrV,MAAM,aAAaoJ,QAAQ,aAAaE,OAAO,QAE1D,cAAC,GAAD,CACEtJ,MAAM,aACNoJ,QAAQ,aACRE,OAAQuP,EAAU/T,SAAS,GAC3B7E,KAAK,MAIRgT,GAAW,cAAC,GAAD,CAAY3J,OAAQA,IAChC,cAAC,GAAD,CAAaA,OAAQA,IAErB,eAAC,IAAD,CAAMxW,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsgB,EAAlC,oBAGA,cAAC,GAAD,CAAS/J,OAAQA,IACjB,cAAC,GAAD,CAASA,OAAQA,UAGpB8J,GAAwB,cAAC,GAAD,QC5EzBX,GAAW,SAAC,GAAD,MAKS,CACxBiM,qBANe,EACfA,qBAMAqB,0BAPe,EAEfA,0BAMAvB,gBARe,EAGfA,gBAMAX,qBATe,EAIfA,uBAQIrR,GAAgB,QAET+G,GAAsB,WAAO,IAChCzC,EAAkB2L,KAAlB3L,cAD+B,EAOnCpM,8BAAmB+N,IAJrBiM,EAHqC,EAGrCA,qBACAqB,EAJqC,EAIrCA,0BACAvB,EALqC,EAKrCA,gBACAX,EANqC,EAMrCA,qBANqC,EAQX3wB,mBAAkBwxB,GARP,mBAQhCpV,EARgC,KAQxBuW,EARwB,KASjC7V,EAAe9c,qBAEfiL,EAAmBE,GAAsBmU,IACzC4G,EACsB,uBAA1Bjb,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KACbye,GAAW3J,EAAOoI,GAAGgN,GACrBsB,EAAgBtB,EAAqBrvB,IAAImvB,GACzCyB,EAAsB3W,EAAOoI,GAAGsO,GAEhC3M,EAAsB1a,uBAAY,WACtCmY,EAAc,oBACb,CAACA,IAEEgP,EAA2B7M,EAC7B4K,EAAqB/O,IAAI4P,GAAsBrvB,IAAIia,GACnDuU,EAEE5I,EAAoByJ,EAAqBxJ,OAAO,IAAK2I,GACrDhF,EAAYvP,EAAO4L,OAAO,IAAK4K,GAE/B1K,EACJsJ,EAAqBpY,SAAW8F,cAAWC,QAAQwM,EAAW5D,GAAmB3O,QAEnF,OACE,eAAC,IAAD,WACE,eAAC,IAAD,oCAEG2M,IAAYG,GACX,cAAC,IAAD,CACEtgB,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAM8sB,EAAUnB,IAH3B,SAKE,cAAC,EAAD,CAAM1wB,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,QACNoJ,QAAQ,oBACRE,OAAQ2J,EAAU3J,EAAOxE,SAAS,GAAK4Z,EAAqB5Z,SAAS,GACrE7E,KAAMiE,GACN8F,aAAcA,EACdC,aAAcX,EAAOxC,SAAS,GAC9BoD,gBAAiB,SAAAZ,GAAM,OAAIuW,EAAUpd,WAAQC,KAAK4G,KAClDa,UAAW6V,EAAclZ,WACzBsD,SAAU6V,IAGXpH,EAAUxD,SACT,cAAC,GAAD,CAAWrV,MAAM,aAAaoJ,QAAQ,aAAaE,OAAO,QAE1D,cAAC,GAAD,CACEtJ,MAAM,aACNoJ,QAAQ,aACRE,OAAQuP,EAAU/T,SAAS,GAC3B7E,KAAK,IACLsJ,cAAa,OAAE6L,QAAF,IAAEA,OAAF,EAAEA,EAAiBtQ,SAAS,GAAGwQ,OAAO,KACnD9L,cAA6B,OAAf4L,QAAe,IAAfA,OAAA,EAAAA,EAAiB9J,UAAW,UAAY,WAI1D,cAAC,GAAD,CACEtL,MAAM,SACNoJ,QAAQ,qBACRE,OAAQyW,EAA0Bjb,SAAS,GAC3CpT,MAAOquB,EAA0BzZ,SAAW,UAC5CrG,KAAMgE,KAGPgP,GAAW,cAAC,GAAD,CAAY3J,OAAQA,IAC/B2J,GAAW,cAAC,GAAD,CAAa3J,OAAQA,IAEjC,eAAC,IAAD,CAAMxW,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsgB,EAAlC,oBAGA,cAAC,GAAD,CAAS/J,OAAQA,IACjB,cAAC,GAAD,CAASA,OAAQA,UAGpB8J,GAAwB,cAAC,GAAD,QCrHzB5G,GAAgB,oBAET0T,GAAwB,WAAO,IAClCpP,EAAkB2L,KAAlB3L,cAGWriB,EACfO,IADFP,QAAWgK,KAGPN,EAAmBE,GAAsBmU,IAQ/C,OANA9e,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,4BAEf,CAAC3Y,EAAiB3D,KAAMsc,IAGzB,cAACjY,GAAD,CACEN,GAAIiU,GACJ/T,KAAMhK,EAAQ0xB,sCAAsCvT,KAAKne,GACzDuK,YAAY,YACZD,iBAAiB,SAJnB,SAME,cAAC,IAAD,8BCxBAyT,GAAgB,yBAET4T,GAA4B,WAAO,IACtCtP,EAAkB2L,KAAlB3L,cAGWriB,EACfO,IADFP,QAAWgK,KAGPN,EAAmBE,GAAsBmU,IAQ/C,OANA9e,qBAAU,WACsB,qBAA1ByK,EAAiB3D,MACnBsc,EAAc,iCAEf,CAAC3Y,EAAiB3D,KAAMsc,IAGzB,cAACjY,GAAD,CACEN,GAAIiU,GACJ/T,KAAMhK,EAAQ4xB,oBAAoBzT,KAAKne,GACvCuK,YAAY,YACZD,iBAAiB,SAJnB,SAME,cAAC,IAAD,CAAQjG,QAAQ,UAAUd,GAAI,CAAEwL,GAAI,EAAGhK,MAAO,QAA9C,yCCfAif,GAAW,SAAC,GAAD,MAIS,CACxBiM,qBALe,EACfA,qBAKAqB,0BANe,EAEfA,0BAKAlC,qBAPe,EAGfA,uBAMIrR,GAAgB,SAET8T,GAAmB,WAAO,IAC7BxP,EAAkB2L,KAAlB3L,cAD4B,EAMhCpM,8BAAmB+N,IAHrBiM,EAHkC,EAGlCA,qBACAqB,EAJkC,EAIlCA,0BACAlC,EALkC,EAKlCA,qBAGI0C,EAAsB5nB,uBAAY,WACtCmY,EAAc,oBACb,CAACA,IAEE3Y,EAAmBE,GAAsBmU,IACzC4G,EACsB,uBAA1Bjb,EAAiB3D,MACS,2BAA1B2D,EAAiB3D,KAEbqkB,EAAY6F,EAAqBxJ,OAAO,IAAK2I,GAC7C2C,GAAsB9B,EAAqB5O,SAAWiQ,EAA0BjQ,OAEtF,OACE,eAAC,IAAD,WACE,eAAC,IAAD,qCAEIsD,GACA,cAAC,IAAD,CAAMphB,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAIN,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CACE+N,MAAM,QACNoJ,QAAQ,aACRE,OAAQoV,EAAqB5Z,SAAS,GACtC7E,KAAMiE,KAEP2U,EAAUxD,SACT,cAAC,GAAD,CAAWrV,MAAM,aAAaoJ,QAAQ,aAAaE,OAAO,QAE1D,cAAC,GAAD,CACEtJ,MAAM,aACNoJ,QAAQ,aACRE,OAAQuP,EAAU/T,SAAS,GAC3B7E,KAAM,MAGV,eAAC,IAAD,CAAMjO,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,GAAD,CACE0N,MAAM,SACNoJ,QAAQ,cACRE,OAAQyW,EAA0Bjb,SAAS,GAC3CpT,MAAOquB,EAA0BzZ,SAAW,UAC5CrG,KAAMgE,KAER,cAAC,IAAD,CAAMjS,GAAI,CAAEK,eAAgB,WAAY8N,KAAM,GAA9C,SACE,cAAC,GAAD,YAKN,eAAC,IAAD,CAAMrN,QAAQ,iBAAd,UACE,eAAC,IAAD,CACEA,QAAUitB,EAA0BjQ,OAAqB,UAAZ,UAC7C/c,QAASwtB,EAFX,UAIE,cAAC,EAAD,CAAMvyB,KAAK,MAAMgF,KAAK,OAJxB,iBAOE+sB,EAA0BjQ,QAAU,cAAC,GAAD,OAExC,cAAC,IAAD,UAAO0Q,GAAsB,cAAC,GAAD,SAE9BpN,GAAwB,cAAC,GAAD,QC1FzBX,GAAW,SAAC,GAAD,MAA6E,CAC5FiM,qBADe,EAAGA,qBAElBqB,0BAFe,EAAyBA,4BAK7BU,GAAqB,WAAO,IAAD,EACsB/b,8BAAmB+N,IAAvEiM,EAD8B,EAC9BA,qBAAsBqB,EADQ,EACRA,0BACxBW,GAAYhC,EAAqB5O,OAEvC,OACE,eAAC,IAAD,WACE,eAAC,IAAD,oCAEE,cAAC,IAAD,CAAM9d,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAGJ,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,wCAAnB,SACE,cAAC,IAAD,4DAED6uB,GACC,qCACE,eAAC,IAAD,CAAK1uB,GAAI,CAAE8K,OAAQ,EAAG0K,GAAI,EAAGtV,aAAc,GAA3C,UACE,cAAC,GAAD,CACE8N,MAAM,QACNoJ,QAAQ,eACRE,OAAQoV,EAAqB5Z,SAAS,GACtC7E,KAAMiE,KAER,cAAC,GAAD,CACElE,MAAM,SACNoJ,QAAQ,cACRE,OAAQyW,EAA0Bjb,SAAS,GAC3CpT,MAAOquB,EAA0BzZ,SAAW,UAC5CrG,KAAMgE,QAGV,cAAC,GAAD,cCxCC0c,GAAiB,SAAA7Y,GAG5B,OAFiB2U,KAAT9H,MAGN,IAAK,WACH,OAAO,cAAC,GAAD,eAAc7M,IAEvB,IAAK,UACH,OAAO,cAAC,GAAD,eAAaA,IAEtB,IAAK,YACH,OAAO,cAAC,GAAD,eAAeA,IAExB,IAAK,SACH,OAAO,cAAC,GAAD,eAAYA,IAErB,IAAK,WACH,OAAO,cAAC,GAAD,eAAcA,MCrBd6Y,GAAiB,kBAC5B,eAAC,IAAD,CAAW7tB,QAAQ,UAAUd,GAAI,CAAEK,eAAgB,cAAnD,UACE,cAAC,IAAD,CAAWS,QAAQ,OAAnB,SACE,cAAC,GAAD,MAGF,cAAC,IAAD,CAAWA,QAAQ,QAAnB,SACE,cAAC,GAAD,UCHO8tB,GAA+B,WAAO,IAE9BnyB,EACfO,IADFP,QAAWgK,KAFmC,EAIkBvL,mBAAS,MAJ3B,mBAIzC2zB,EAJyC,KAIdC,EAJc,KAMhD,OACE,eAAC,IAAD,WACE,cAAC,IAAD,wBAEA,cAAC,IAAD,CAAK9uB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CAAMD,GAAI,CAAEM,WAAY,WAAxB,UACE,cAAC,IAAD,oBAEA,cAAC,IAAD,CACEkC,KAAK,SACLusB,IAAI,IACJtW,KAAK,IACL1b,MAAO8xB,EACPlW,SAAU,SAAAlD,GAAC,OAAIqZ,EAA6BrZ,EAAEzR,OAAOjH,UAGvD,cAAC,IAAD,qBAEA,cAAC,IAAD,CAAMiD,GAAI,CAAE6D,GAAI,EAAGvD,WAAY,UAA/B,SACE,cAACuG,GAAD,CACEN,GAAG,kBACHO,QAAQ,YACRC,iBAAiB,SACjBN,KAAM,SAAAhO,GACJ,IAAKo2B,EACH,MAAM,IAAI30B,MAAM,kBAElB,OAAOuC,EAAQuyB,cAAcC,SAASJ,EAA2B,IAAKp2B,IAR1E,SAWE,cAAC,IAAD,CAAQqI,QAAQ,aAAhB,SACE,cAAC,EAAD,CAAM9E,KAAK,QAAQgF,KAAK,sB,qBCtC3BkuB,GAA4C,SAAC,GAAD,IAAGz0B,EAAH,EAAGA,SAAU00B,EAAb,EAAaA,MAAUxZ,EAAvB,2CACvD,eAAC,IAAD,yBAAKjV,GAAG,QAAWiV,GAAnB,cACE,cAAC,IAAD,CAAKjV,GAAG,OAAOV,GAAI,CAAE0K,QAAS,CAAC,OAAQ,UAAvC,SACGjQ,IAGH,cAAC,IAAD,CAAKiG,GAAG,OAAOV,GAAI,CAAE0K,QAAS,CAAC,QAAS,SAAxC,SACGykB,SCUDC,GAAY,OAEZC,GAA2B,SAACrS,EAAkBzJ,GAAnB,MAC/B,CAACyJ,EAAMH,8BAA8BtJ,GAAQ,oCAEzC+b,GAA6B,SACjCtS,EACAzJ,EACAgc,EACA9b,GAEA,IAAMiB,EAAkBsI,EAAMtI,gBAAgBnB,GAE9C,OAAImB,EAAgByY,IAAI/R,8BAA6B1G,EAAgBgF,GAAG6V,GAC/D,CACLvS,EAAM3I,KAAKgF,IAAI5F,GACf,mEAGK4b,GAAyBrS,EAAOzJ,IAQrClB,GAAS,SAAC,GAAD,IACbiB,EADa,EACbA,eACAC,EAFa,EAEbA,MACAC,EAHa,EAGbA,MACAC,EAJa,EAIbA,oBACA+b,EALa,EAKbA,SALa,MAMsB,CACnClc,iBACAC,QACA4I,aAAc3I,EAAMyB,+BAA+B1B,GACnDgc,qBAAsB/b,EAAMkB,gBAAgBnB,GAC5CE,sBACA+b,aAGWC,GAA0C,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAAe,EAQnEhd,8BAAmBL,IANrBmd,EAFqE,EAErEA,SACAlc,EAHqE,EAGrEA,eACA6I,EAJqE,EAIrEA,aACAoT,EALqE,EAKrEA,qBACA9b,EANqE,EAMrEA,oBACAF,EAPqE,EAOrEA,MAEM9W,EAAYO,IAAZP,QAT+D,EAWzCvB,oBAAS,GAXgC,mBAWhEy0B,EAXgE,KAWvDC,EAXuD,OAY3C10B,qBAZ2C,mBAYhE20B,EAZgE,KAYxDC,EAZwD,OAc3C50B,mBAAS,IAdkC,mBAchE60B,EAdgE,KAcxDC,EAdwD,KAejEC,EAActpB,uBAAY,kBAAMqpB,EAAU,MAAK,IAfkB,EAiB/C90B,mBAAS,GAjBsC,mBAiBhEg1B,EAjBgE,KAiB1DC,EAjB0D,KAkBjEC,EAAgBC,KAAKC,KAAKhd,EAAiBoc,IAAa,EACxDa,EAAcF,KAAKtB,IAAImB,EAAME,EAAgB,GAcnD10B,qBAAU,WACJw0B,IAASK,GACXJ,EAAQI,KAET,CAACL,EAAMK,IAEV70B,qBAAU,WACR,IAAI80B,GAAU,EAoBd,OAlBAZ,GAAW,GAEXnzB,EACGg0B,UACC,CACEC,MAAOhB,EACPiB,SAAU,2BACVC,WAAYL,EAAcb,GAE5B,CAAEF,aAEH7zB,MAAK,SAAAk0B,GACAW,IACFV,EAAUD,GACVD,GAAW,OAIV,WACLY,GAAU,KAIX,CAAC/zB,EAAS8zB,EAAab,EAAUK,IAEpCr0B,qBAAU,WACRu0B,MACC,CAACA,EAAa3c,IArEsD,MAuE3CpY,qBAvE2C,mBAuEhE21B,EAvEgE,KAuExDC,EAvEwD,KAyFvE,OAhBAp1B,qBAAU,WACR,QAAe7B,IAAXg3B,EAAsB,CACxB,IAAIloB,GAAY,EAQhB,OANAtD,YAAW,WACJsD,GACHmoB,OAAUj3B,KAEX,KAEI,WACL8O,GAAY,MAGf,CAACkoB,IAGF,eAAC,IAAD,CAAM7wB,GAAI,CAAEwB,MAAO,QAAnB,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CAAc2tB,MAAM,SAApB,0BAEA,eAAC,IAAD,CAAMnvB,GAAI,CAAEM,WAAY,UAAxB,UACsB,IAAnBgT,GACC,qCACE,eAAC,GAAD,CACE6b,MAAK,eAAUoB,EAAc,EAAxB,cAA+BH,GACpCpwB,GAAI,CAAEsB,GAAI,CAAC,EAAG,GAAIM,WAAY,OAAQhB,SAAU,CAAC,EAAG,GAAIkP,cAAe,EAAE,EAAG,IAF9E,UAIGygB,EAAcb,EAAW,EAJ5B,IAIgCW,KAAKtB,KAAKwB,EAAc,GAAKb,EAAUpc,GAAiB,IAJxF,MAKMA,KAGN,cAAC,IAAD,CAAQxS,QAAQ,YAAYC,QA9EnB,WACfwvB,EAAc,GAChBJ,EAAQI,EAAc,IA4EqC7oB,SAAU6oB,GAAe,EAA5E,SACE,cAAC,EAAD,CAAMv0B,KAAK,eAAegF,KAAK,SAGjC,cAAC,IAAD,CACEF,QAAQ,YACRC,QA1FG,WACXwvB,EAAcH,EAAgB,GAChCD,EAAQI,EAAc,IAyFZ7oB,SAAU6oB,GAAeH,EAAgB,EAH3C,SAKE,cAAC,EAAD,CAAMp0B,KAAK,gBAAgBgF,KAAK,YAKtC,cAAC,IAAD,CACEF,QAAQ,YACRd,GAAI,CAAE+K,QAAS4kB,EAAU,EAAI,EAAG9rB,GAAI,CAAC,EAAG,IACxC9C,QAASkvB,EAHX,SAKE,cAAC,EAAD,CAAMj0B,KAAK,OAAOgF,KAAK,eAK3B6uB,GAA4B,IAAlBA,EAAOpoB,OAOjB,cAAC,IAAD,CAAKzH,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CACES,GAAG,QACHV,GAAI,CACFwL,GAAI,EACJjC,GAAI,CAAC,EAAG,GACR/H,MAAO,OAEPb,UAAW,SACXmD,WAAY,MARhB,UAWE,qCACE,qBAAKzE,MAAO,CAAEmC,MAAO,UACrB,wBACA,wBACA,wBACA,qBAAKnC,MAAO,CAAEmC,MAAO4tB,SAGvB,gCACE,+BACE,uCACA,+BACE,cAAC,GAAD,CAAcD,MAAM,QAApB,wBACA,cAAC,IAAD,CAAKnvB,GAAI,CAAEY,SAAU,CAAC,EAAG,GAAIgB,WAAY,OAAQmJ,QAAS,IAA1D,oBAEF,sCAEE,cAAC,IAAD,CAAK/K,GAAI,CAAEY,SAAU,CAAC,EAAG,GAAIgB,WAAY,OAAQmJ,QAAS,IAA1D,SAAkEiH,QAEpE,uCAEE,uBAFF,WAKA,4BAIJ,gCACG6d,EAAOvoB,KACN,SAAA0V,GAAK,OACFA,EAAM9C,SAEL,+BACE,qBACE7a,MAAO,CACLqL,QAAS,OACTpK,WAAY,SACZH,OAAQivB,IAJZ,UAOE,cAACnrB,EAAD,CAASvB,QAASsa,EAAM+T,aAAc7sB,UAAU,MAAhD,SACE,eAAC,IAAD,CACEpD,QAAQ,UACRd,GAAI,CACFwB,MAAO,CAAC,OAAQ,SAChBkI,SAAU,SACVF,SAAU,YALd,UAQG2I,GAAe6K,EAAM+T,cACtB,cAAC,IAAD,CACE/wB,GAAI,CACF0K,QAAS,CAAC,QAAS,QACnBlB,SAAU,WACVyC,IAAK,EACL2B,MAAO,EACPpM,MAAO,OACPrB,OAAQ,OACRoK,WACE,mFAMV,cAAC,KAAD,CACED,KAAM0S,EAAM+T,aACZC,OAAQ,kBAAMF,EAAU9T,EAAM+T,eAFhC,SAIE,cAAC,IAAD,CAAQjwB,QAAQ,OAAOd,GAAI,CAAEwB,MAAO,OAAQrB,OAAQ,QAApD,SACE,cAAC,EAAD,CACEnE,KAAM60B,IAAW7T,EAAM+T,aAAe,kBAAoB,YAC1D/vB,KAAK,cAKb,6BACE,cAAC,GAAD,CAAcmuB,MAAOnS,EAAMjI,WAAWC,UAAtC,SACGgI,EAAMjI,WAAWjC,SAAS,OAG/B,6BACE,cAAC,GAAD,CAAcqc,MAAOnS,EAAM3I,KAAKW,UAAhC,SACGgI,EAAM3I,KAAKvB,eAGhB,8BACI4B,EAYCsI,EAAMtI,gBAAgBnB,GAXvB,cAAC,IAAD,CACE7T,MACEgV,EAAgByE,GAAGC,8BACf,UACA1E,EAAgByE,GAAG,KACnB,UACA,SANR,SASG,IAAI5E,WAAQG,GAAiB5B,gBAIpC,6BACE,cAACjM,GAAD,CACEN,GAAE,oBAAeyW,EAAM+T,cACvBjqB,QAAQ,YACRG,SAAU,CACRkV,EACImT,GACEtS,EACAzJ,EACAgc,EACA9b,GAEF4b,GAAyBrS,EAAOzJ,IAEtC9M,KAAMhK,EAAQgK,KAAKwqB,UAAUrW,KAAKne,EAAQgK,KAAMuW,EAAM+T,cAbxD,SAeE,cAAC,IAAD,CAAQjwB,QAAQ,aAAhB,SACE,cAAC,EAAD,CAAM9E,KAAK,kBAvFVghB,EAAM+T,cAwDT,IAAArc,YA3GlB,cAAC,IAAD,CAAK1U,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,cAAC,IAAD,CAAKD,GAAI,CAAEC,EAAG,EAAGW,SAAU,EAAGD,UAAW,UAAzC,SACIkvB,EAAwB,0BAAf,iBAoJhBF,GAAW,cAAC,GAAD,QCnVLuB,GAA4B,kBACvC,eAAC,IAAD,CAAWpwB,QAAQ,UAAnB,UACE,eAAC,IAAD,CAAWA,QAAQ,OAAnB,UACE,cAAC,IAAD,UACE,cAAC,IAAD,CAAKd,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,GAAD,CAAaJ,MAAM,oBAAnB,UACE,cAAC,IAAD,iEACA,cAAC,IAAD,oIAON,cAAC,GAAD,OAGF,cAAC,IAAD,CAAWiB,QAAQ,QAAnB,SACE,cAAC,GAAD,MAEF,cAAC,GAAD,CAAa4uB,SAAU,SCjBdyB,GAAwD,SAAC,GAAD,IACnEC,EADmE,EACnEA,aACAC,EAFmE,EAEnEA,WAFmE,OAInE,eAAC,IAAD,WACE,cAAC,IAAD,qBAEA,cAAC,IAAD,CAAKrxB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,GAAD,CACEJ,MAAM,iCACNN,KACE,cAAC,IAAD,CAAKS,GAAI,CAAEN,MAAO,WAAlB,SACE,cAAC,EAAD,CAAM1D,KAAK,2BAJjB,UAQE,eAAC,IAAD,wDAC6Co1B,EAD7C,yBAIA,eAAC,IAAD,CAAWpxB,GAAI,CAAEwL,GAAI,GAArB,mCACyB,IACvB,cAAC,IAAD,CAAMxL,GAAI,CAAE4B,WAAY,UAAxB,SAAqCyvB,EAAWnc,mBAFlD,gBChBKoc,GAAoD,SAAC,GAK3D,IAJL9W,EAII,EAJJA,cACA9S,EAGI,EAHJA,SACA6pB,EAEI,EAFJA,WACAC,EACI,EADJA,kBAGmB/0B,EACfO,IADFP,QAAWgK,KAFT,EAKsBD,GACxBgU,EACA/d,EAAQg1B,WAAW7W,KAAKne,EAAS80B,EAAYC,IAFxCtqB,EALH,oBAUJ,OACE,cAAC,IAAD,CAAQQ,SAAUA,EAAU3G,QAASmG,EAArC,sBCZEiU,GAAa,IAAI5G,WAAQ6G,6BAA0BtG,SAAS,GAE5DzC,GAAS,SAAC,GAAD,MAA6D,CAC1EkB,MADa,EAAGA,MAEhB8K,KAFa,EAAUA,KAGvB7K,MAHa,EAAgBA,MAI7BjB,YAJa,EAAuBA,cAOhCiI,GAAgB,aAETkX,GAA8B,WAAO,IAAD,EACHhf,8BAAmBL,IAAvDkB,EADuC,EACvCA,MAAO8K,EADgC,EAChCA,KAAM7K,EAD0B,EAC1BA,MAAOjB,EADmB,EACnBA,YADmB,EAEXrX,mBAASuV,WAAQ2N,MAFN,mBAExCmT,EAFwC,KAE5BI,EAF4B,OAGLz2B,oBAAS,GAHJ,mBAGxC6e,EAHwC,KAGzB6X,EAHyB,KAIzC5Z,EAAe9c,qBAEf22B,GAASN,EAAWzT,OACpB5N,EAAYqhB,EAAW/c,IAAIjB,GAC3BI,EAAiB0K,EAAK1K,eAAe4d,EAAW/c,IAAIhB,EAAMa,OAC1D2F,EAAS,IAAIzF,WAAQZ,GACrBme,EAAS5hB,EAAU2E,IAAIlB,GACvB6d,EAAoB7d,EAAetW,IAAI,MAEvC4hB,EAAqB5Y,GAAsBmU,IAEjD9e,qBAAU,WAEsB,uBAA5BujB,EAAmBzc,MACS,2BAA5Byc,EAAmBzc,KAEnBovB,GAAiB,GACoB,WAA5B3S,EAAmBzc,MAAiD,cAA5Byc,EAAmBzc,KACpEovB,GAAiB,GACoB,cAA5B3S,EAAmBzc,OAC5BmvB,EAAclhB,WAAQ2N,MACtBwT,GAAiB,MAElB,CAAC3S,EAAmBzc,KAAMovB,EAAkBD,IA3BA,MA6Bdne,EAAMqJ,8BAA8BtJ,GACjE,EACE,EACA,eAAC,GAAD,gFACqE,IACnE,cAAC,GAAD,UAAS4H,KAFX,gCAKFoW,EAAWpY,GAAG5G,GACd,EACE,EACA,eAAC,GAAD,wEAC6D,IAC3D,eAAC,GAAD,WACGgf,EAAWzU,IAAIvK,GAAaO,WAD/B,IAC4Cd,MAH9C,QAQF,EACE,EACA,eAAC,GAAD,+BACmB,eAAC,GAAD,WAAS9B,EAAU4M,IAAIgV,GAAQhf,SAAS,GAAxC,UADnB,mBAC4F,IAC1F,eAAC,GAAD,WACGye,EAAWze,WADd,IAC2Bd,MAH7B,QAlDyC,mBA6BxC+f,EA7BwC,KA6B7BlT,EA7B6B,KA2D/C,OACE,eAAC,IAAD,WACE,eAAC,IAAD,oBAEGgT,IAAU9X,GACT,cAAC,IAAD,CACEjZ,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAM4wB,EAAclhB,WAAQ2N,OAHvC,SAKE,cAAC,EAAD,CAAMpiB,KAAK,UAAUgF,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CACE+N,MAAM,SACNoJ,QAAQ,cACRE,OAAQia,EAAWze,WACnBqF,UAAW5F,EAAYuC,WACvBsD,SAAUmZ,EAAW7R,GAAGnN,GACxBtE,KAAM+D,GACAgG,eACNC,aAAcsZ,EAAWzc,SAAS,GAClCoD,gBAAiB,SAAAZ,GAAM,OAAIqa,EAAclhB,WAAQC,KAAK4G,OAGxD,cAAC,GAAD,CACEtJ,MAAM,iBACNoJ,QAAQ,aACRE,OAAQwa,EAAOhd,SAAS,GACxByC,cAAeyC,EAAOlF,SAAS,GAC/B7G,KAAK,MACL8I,SACE,cAAC,GAAD,CACEjQ,QACE,cAAC,IAAD,CAAMhG,QAAQ,UAAUd,GAAI,CAAEqP,SAAU,SAAxC,qKASLwiB,IAAUE,IAAclT,GACzB,eAAC,GAAD,kCAAwC7M,GAAxC,4BAGF,cAAC,IAAD,CAAMlR,QAAQ,iBAAd,SACE,cAAC,GAAD,CACE0Z,cAAeA,GACf9S,UAAWmqB,IAAUE,EACrBR,WAAYA,EACZC,kBAAmBA,SAKxBzX,GAAiB,cAAC,GAAD,QC3IlBiY,GAAuB,SAAC,GAAD,SAAGC,gBAEnBC,GAAuB,WAAO,IAAD,EAKpCl1B,IAHFP,QACErB,WAAc+Y,EAHsB,EAGtBA,eAAgBge,EAHM,EAGNA,gBAI5BF,EAAiBvf,8BAAmBsf,IAEpCI,EAAsB/B,KAAKgC,MAAMF,EAbd,OAenBG,EADiBne,EAAeoe,UAAY,IACRJ,EACpCK,EAAmB,IAAIC,KAAwB,IAAnBH,GAGlC,OAF2BL,EAAiBK,EAGnC,cAAC,GAAD,CAAoBlB,aAAcgB,EAAqBf,WAAYmB,IAGrE,cAAC,GAAD,KCnBIE,GAA2B,WAAO,IAH9BpG,EAMGR,EAEd9uB,IAHFP,QACErB,WAAc0wB,UAIlB,OACE,eAAC,IAAD,CAAWhrB,QAAQ,UAAnB,UACE,eAAC,IAAD,CAAWA,QAAQ,OAAnB,UACE,cAAC,IAAD,UACE,cAAC,IAAD,CAAKd,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,GAAD,CAAaJ,MAAM,oBAAnB,UACE,cAAC,IAAD,sGAIA,eAAC,IAAD,CAAWG,GAAI,CAAEwL,GAAI,GAArB,sFAC4E,IAC1E,eAAC,IAAD,CAAMzH,MAtBLuoB,EAsBmBR,EAAS,UAtB7B,uDACkCQ,EADlC,wBAsB6CtoB,OAAO,SAApD,qBACU,cAAC,EAAD,CAAMhI,KAAK,oBAAoBgF,KAAK,UACtC,IAJV,yBAOA,eAAC,IAAD,CAAWhB,GAAI,CAAEwL,GAAI,GAArB,UACE,0CADF,4FAE2B,cAAC,IAAD,CAAMzH,KAAK,KAAX,uBAF3B,cAON,cAAC,GAAD,OAGF,cAAC,IAAD,CAAWjD,QAAQ,QAAnB,SACE,cAAC,GAAD,UCtCF6xB,GAAqC,CACzCC,KAAM,CACJC,mBAAoB,UACpBC,aAAc,UAEhBC,WAAY,CACVF,mBAAoB,UACpBG,iCAAkC,OAClCF,aAAc,UAEhBG,SAAU,CACRJ,mBAAoB,UACpBG,iCAAkC,OAClCF,aAAc,UAEhBI,QAAS,CACPC,4BAA6B,OAC7BL,aAAc,UAEhBM,UAAW,CACTD,4BAA6B,SAC7BE,eAAgB,SAChBC,aAAc,OACdC,iBAAkB,aAClBC,eAAgB,YAElBC,QAAS,CACPN,4BAA6B,SAC7BG,aAAc,OACdD,eAAgB,SAChBE,iBAAkB,aAClBC,eAAgB,YAElBE,OAAQ,CACNC,qBAAsB,YACtBC,oBAAqB,UACrBN,aAAc,OACdC,iBAAkB,aAClBC,eAAgB,aAMdK,GAAsC,CAC1CC,KAAM,eACNC,cAAe,eACfC,oBAAqB,mBACrBC,mBAAoB,kBAqBhB5hB,GAAS,SAAC,GAAD,SAAG2K,MAAS7iB,QAEd+5B,GAA8B,SAAApe,GAAU,IAC3Crb,EAAaqb,EAAbrb,SACF05B,EAAczhB,8BAAmBL,IAFW,EAI1BnX,mBAnBH,SAACi5B,GACtB,MAAoB,wBAAhBA,EACK,aAEW,uBAAhBA,EACK,WAEW,SAAhBA,EACK,SAEF,OASqCC,CAAeD,IAJT,mBAI3CxR,EAJ2C,KAIrC0R,EAJqC,KAK5CC,EAAUlwB,iBAAkBue,GAE5B7D,EAAgBnY,uBAAY,SAACxC,GACjC,IAAMowB,EA5BS,SAAC5R,EAAiBxe,GAAkC,IAAD,EAEpE,OADc,UAAGwuB,GAAYhQ,GAAMxe,UAArB,QAA+Bwe,EA2B1B6R,CAAWF,EAAQnvB,QAAShB,GAE7C5K,QAAQE,IACN,mDACA66B,EAAQnvB,QACRhB,EACAowB,GAEFF,EAAQE,KACP,IAEH74B,qBAAU,WACR44B,EAAQnvB,QAAUwd,IACjB,CAACA,IAEJjnB,qBAAU,WAAO,IAAD,EACRyI,EAAK,UAAG0vB,GAAkBM,UAArB,QAAqC,KAClC,OAAVhwB,GACF2a,EAAc3a,KAEf,CAACgwB,EAAarV,IAEjB,IAAMhkB,EAAW,CACf6nB,OACA7D,iBAEF,OAAO,cAAC/D,GAAiBje,SAAlB,CAA2BC,MAAOjC,EAAlC,SAA6CL,KCtGhDk4B,GAAyC,CAC7CC,KAAM,CACJ6B,gBAAiB,cAEnBC,WAAY,CACVC,eAAgB,OAChBC,kBAAmB,UAErBlB,OAAQ,CACNmB,gBAAiB,SACjBC,uBAAwB,YACxBC,gBAAiB,QAEnB3B,UAAW,CACTuB,eAAgB,SAChBC,kBAAmB,SACnBG,gBAAiB,SAaf1iB,GAAS,SAAC,GAAD,SAAGiS,kBAEL0Q,GAAkC,SAAAlf,GAAU,IAC/Crb,EAAaqb,EAAbrb,SACF6pB,EAAmB5R,8BAAmBL,IAFU,EAI9BnX,mBAVH,SAACopB,GACtB,OAAOA,EAAiBpK,QAAU,OAAS,SASKka,CAAe9P,IAJT,mBAI/C3B,EAJ+C,KAIzC0R,EAJyC,KAKhDC,EAAUlwB,iBAAsBue,GAEhC7D,EAAgBnY,uBAAY,SAACxC,GACjC,IAAMowB,EAnBS,SAAC5R,EAAqBxe,GAA0C,IAAD,EAEhF,OADc,UAAGwuB,GAAYhQ,GAAMxe,UAArB,QAA+Bwe,EAkB1B6R,CAAWF,EAAQnvB,QAAShB,GAE7C5K,QAAQE,IACN,mDACA66B,EAAQnvB,QACRhB,EACAowB,GAEFF,EAAQE,KACP,IAEH74B,qBAAU,WACR44B,EAAQnvB,QAAUwd,IACjB,CAACA,IAEJjnB,qBAAU,WACJ4oB,EAAiBpK,SACnB4E,EAAc,qBAEf,CAACwF,EAAiBpK,QAAS4E,IAE9B,IAAMhkB,EAAW,CACf6nB,OACA7D,iBAGF,OAAO,cAACiF,GAAqBjnB,SAAtB,CAA+BC,MAAOjC,EAAtC,SAAiDL,KCxDpDsiB,GAAO,SAAC,GAAD,MAAiE,CAC5EgL,UADW,EAAGA,UAEdhO,eAAe,EACfkb,WAAW,IAGP5X,GAAS,SACb/a,EACAC,GAKA,OAAQA,EAAOC,MACb,IAAK,iBACH,OAAO,2BAAKF,GAAZ,IAAmB2yB,WAAW,IAEhC,IAAK,kBACH,OAAO,2BAAK3yB,GAAZ,IAAmB2yB,WAAW,IAEhC,IAAK,cACH,OAAO,2BAAK3yB,GAAZ,IAAmByX,eAAe,IAEpC,IAAK,cACH,OAAO,2BAAKzX,GAAZ,IAAmByX,eAAe,IAEpC,IAAK,cAAgB,IAEMmb,EAErB3yB,EAFF4yB,SAAYpN,UACca,EACxBrmB,EADF0b,YAAe8J,UAGjB,GAAIa,EAAc,CAChB,IAAM5K,GACH4K,EAAaR,WAAW1I,GAAGwV,EAAS9M,aACrCQ,EAAarF,eAAe7J,GAAGwb,EAAS3R,iBACxCqF,EAAaX,SAASvO,GAAGwb,EAASjN,UAEpC,OAAO,2BACF3lB,GADL,IAEEylB,UAAWa,EACXqM,WAAW,EACXlb,eAAeiE,GAA0B1b,EAAMyX,iBAMvD,OAAOzX,GAGI8yB,GAAgC,SAAC,GAAkB,IAAhB36B,EAAe,EAAfA,SACxC46B,EAA0BhvB,GAAsB,SADO,EAEDsY,6BAAkBtB,GAAQN,IAFzB,0BAEpDkY,EAFoD,EAEpDA,UAAWlb,EAFyC,EAEzCA,cAAegO,EAF0B,EAE1BA,UAAatkB,EAFa,KAkB7D,OAdA/H,qBAAU,WAE2B,uBAAjC25B,EAAwB7yB,MACS,2BAAjC6yB,EAAwB7yB,KAExBiB,EAAS,CAAEjB,KAAM,gBAEgB,WAAjC6yB,EAAwB7yB,MACS,cAAjC6yB,EAAwB7yB,MAExBiB,EAAS,CAAEjB,KAAM,kBAElB,CAAC6yB,EAAwB7yB,KAAMiB,IAGhC,cAACmkB,GAAmB9qB,SAApB,CACEC,MAAO,CACL4lB,KAAMsS,EAAY,YAAclN,EAAU7N,QAAU,OAAS,SAC7DH,gBACAtW,YAJJ,SAOGhJ,KCpEMk4B,GAAoC,CAC/C2C,SAAU,CACRC,cAAe,WAEjBC,QAAS,CACPb,eAAgB,WAChBc,gBAAiB,SACjBC,eAAgB,WAElBhC,OAAQ,CACNiC,eAAgB,YAChBC,uBAAwB,SACxBC,4BAA6B,YAE/BzC,UAAW,CACTuB,eAAgB,SAChBc,gBAAiB,SACjBC,eAAgB,YAChBI,kBAAmB,UAErBC,SAAU,CACRH,uBAAwB,WACxBC,4BAA6B,aC7B3BpV,GAAW,SAAC,GAAD,MAIS,CACxBiM,qBALe,EACfA,qBAKAhC,mCANe,EAEfA,mCAKAqD,0BAPe,EAGfA,4BAOWiI,GAA6B,SAAAlgB,GAAU,IAC1Crb,EAAaqb,EAAbrb,SADyC,EAM7CiY,8BAAmB+N,IAHrBiM,EAH+C,EAG/CA,qBACAhC,EAJ+C,EAI/CA,mCACAqD,EAL+C,EAK/CA,0BAL+C,EAQzB7yB,mBA5BH,SACrBwxB,EACAhC,EACAqD,GAEA,OAAIrD,EAAmC5M,OAAe,WAClD4O,EAAqB5O,QAAUiQ,EAA0BjQ,OAAe,WACrE,SAsBLsW,CACE1H,EACAhC,EACAqD,IAZ6C,mBAQ1CpL,EAR0C,KAQpC0R,EARoC,KAe3CC,EAAUlwB,iBAAiBue,GAE3B7D,EAAgBnY,uBAAY,SAACxC,GACjC,IAAMowB,EA3CS,SAAC5R,EAAgBxe,GAAgC,IAAD,EAEjE,OADc,UAAGwuB,GAAYhQ,GAAMxe,UAArB,QAA+Bwe,EA0C1B6R,CAAWF,EAAQnvB,QAAShB,GAE7C5K,QAAQE,IACN,mDACA66B,EAAQnvB,QACRhB,EACAowB,GAEFF,EAAQE,KACP,IAEH74B,qBAAU,WACR44B,EAAQnvB,QAAUwd,IACjB,CAACA,IAEJjnB,qBAAU,WACJgxB,EAAqB5O,QAAUiQ,EAA0BjQ,OAC3DgB,EAAc,+BACL4N,EAAqB5O,SAAWiQ,EAA0BjQ,QACnEgB,EAAc,uBAEf,CAAC4N,EAAqB5O,OAAQiQ,EAA0BjQ,OAAQgB,IAEnE,IAAMhkB,EAAW,CACf6nB,OACA7D,iBAGF,OAAO,cAAC0L,GAAgB1tB,SAAjB,CAA0BC,MAAOjC,EAAjC,SAA4CL,KCnDxCw7B,GAAkD,SAAC,GAAgB,IAAdv7B,EAAa,EAAbA,OAAa,EACtCsC,IAA/BhC,EADqE,EACrEA,QAASF,EAD4D,EAC5DA,SAAU2B,EADkD,EAClDA,QAa3B,OAVAqV,OAAOC,OAAO1V,OAAQ,CACpBrB,UACAF,WACA2B,UACAwgB,eACAxM,mBACA2J,yBACA7J,cAIA,eAAC,wBAAD,CAA4B7V,SAAUkC,MAAOH,EAAQG,MAArD,UACE,cAAC,KAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,eAAC,IAAD,CAAMoD,GAAI,CAAEqB,cAAe,SAAUmN,UAAW,QAAhD,UACE,eAAC,GAAD,WACE,cAAC,GAAD,IACA,cAAC,GAAD,OAGF,cAAC,IAAD,CACE1N,QAAQ,OACRd,GAAI,CACF0K,QAAS,OACTiN,SAAU,EACVtW,cAAe,SACff,WAAY,UANhB,SASE,eAAC,KAAD,WACE,cAAC,KAAD,CAAO41B,KAAK,IAAIngB,OAAK,EAArB,SACE,cAAC,GAAD,MAEF,cAAC,KAAD,CAAOmgB,KAAK,QAAZ,SACE,cAAC,GAAD,MAEF,cAAC,KAAD,CAAOA,KAAK,gBAAZ,SACE,cAAC,GAAD,MAEF,cAAC,KAAD,CAAOA,KAAK,cAAZ,SACE,cAAC,GAAD,wBAUlB,cAAC,GAAD,QChEN,GALI75B,OAAOsH,UAETmO,OAAOC,OAAO1V,OAAOsH,SAAU,CAAEwyB,4BAA4B,IAGvB,SAApChhB,iMAAYihB,oBAAgC,CAC9C,IAAMzyB,GAAW,IAAIoM,GAAJ,iBACL1T,OAAOC,SAASC,SADX,SAEf,sEAGFuV,OAAOC,OAAO1V,OAAQ,CAAEsH,cAI1BvJ,IAAYuB,MAAK,SAAAvC,GAGf0Y,OAAOC,OAAO1V,OAAQ,CAAEjD,cAG1B,IAAMi9B,GAAoC,SAAC,GAAkB,IAAhB57B,EAAe,EAAfA,SAC3C,OACE,cAAC,IAAD,CAAmB67B,WAAY,SAAAx7B,GAAQ,OAAI,IAAIy7B,wCAAsCz7B,IAArF,SACGL,KAKD+7B,GAAuC,kBAC3C,eAAC,IAAD,CACEx2B,GAAI,CACFqB,cAAe,SACff,WAAY,SACZD,eAAgB,SAChBF,OAAQ,QACRQ,UAAW,UANf,UASE,eAAC,IAAD,CAASX,GAAI,CAAEuB,GAAI,GAAnB,UACE,cAAC,EAAD,CAAMvF,KAAK,yBADb,iCAIA,cAAC,IAAD,CAAWgE,GAAI,CAAEuB,GAAI,GAArB,wGAIA,eAAC,IAAD,qFAEE,eAAC,IAAD,CAAMwC,KAAK,gFAAX,kBACO,cAAC,EAAD,CAAM/H,KAAK,oBAAoBgF,KAAK,UAH7C,WA8DWy1B,GApDH,WACV,IAAM/7B,EACJ,eAAC,IAAD,CAAMsF,GAAI,CAAEM,WAAY,SAAUD,eAAgB,SAAUF,OAAQ,SAApE,UACE,cAAC,IAAD,CAASH,GAAI,CAAEoP,EAAG,EAAG1P,MAAO,QAAUsB,KAAK,SAC3C,cAAC,IAAD,4BA6BJ,OACE,cAAC,GAAD,UACE,cAAC,IAAD,CAAemL,MAAOA,GAAtB,SACE,cAAC,EAAD,CAAiBzR,OAAQA,EAAzB,SACE,cAAC,EAAD,CACEA,OAAQA,EACRC,2BA/ByB,SAACM,GAAD,OACjC,eAAC,IAAD,CACE+E,GAAI,CACFqB,cAAe,SACff,WAAY,SACZD,eAAgB,SAChBF,OAAQ,QACRQ,UAAW,UANf,UASE,eAAC,IAAD,CAASX,GAAI,CAAEuB,GAAI,GAAnB,UACE,cAAC,EAAD,CAAMvF,KAAK,yBADb,kCACsE,IACvD,IAAZf,EAAgB,UAAY,eAF/B,OATF,gFAcE,eAAC,IAAD,0FAEE,eAAC,IAAD,CAAM8I,KAAK,gFAAX,0BACgB,cAAC,EAAD,CAAM/H,KAAK,oBAAoBgF,KAAK,UAHtD,WAiBMpG,2BAA4B,cAAC,GAAD,IAH9B,SAKE,cAAC,GAAD,UACE,cAAC,GAAD,CAAiBF,OAAQA,eC7GvCg8B,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEFC,SAASC,eAAe,W","file":"static/js/main.24a33c72.chunk.js","sourcesContent":["\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.UnsupportedNetworkError = exports._connectByChainId = void 0;\r\nvar EthersLiquityConnection_1 = require(\"./src/EthersLiquityConnection\");\r\nObject.defineProperty(exports, \"_connectByChainId\", { enumerable: true, get: function () { return EthersLiquityConnection_1._connectByChainId; } });\r\nObject.defineProperty(exports, \"UnsupportedNetworkError\", { enumerable: true, get: function () { return EthersLiquityConnection_1.UnsupportedNetworkError; } });\r\n__exportStar(require(\"./src/types\"), exports);\r\n__exportStar(require(\"./src/ReadableEthersLiquity\"), exports);\r\n__exportStar(require(\"./src/ObservableEthersLiquity\"), exports);\r\n__exportStar(require(\"./src/BlockPolledLiquityStore\"), exports);\r\n__exportStar(require(\"./src/PopulatableEthersLiquity\"), exports);\r\n__exportStar(require(\"./src/SendableEthersLiquity\"), exports);\r\n__exportStar(require(\"./src/EthersLiquity\"), exports);\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connect = exports._connectByChainId = exports._connectToDeployment = exports.UnsupportedNetworkError = exports._usingStore = exports._requireFrontendAddress = exports._requireAddress = exports._getProvider = exports._requireSigner = exports._getBlockTimestamp = exports._getContracts = void 0;\r\nconst abstract_signer_1 = require(\"@ethersproject/abstract-signer\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst dev_json_1 = __importDefault(require(\"../deployments/dev.json\"));\r\nconst goerli_json_1 = __importDefault(require(\"../deployments/goerli.json\"));\r\nconst kovan_json_1 = __importDefault(require(\"../deployments/kovan.json\"));\r\nconst rinkeby_json_1 = __importDefault(require(\"../deployments/rinkeby.json\"));\r\nconst ropsten_json_1 = __importDefault(require(\"../deployments/ropsten.json\"));\r\nconst mainnet_json_1 = __importDefault(require(\"../deployments/mainnet.json\"));\r\nconst kiln_json_1 = __importDefault(require(\"../deployments/kiln.json\"));\r\nconst _utils_1 = require(\"./_utils\");\r\nconst contracts_1 = require(\"./contracts\");\r\nconst _Multicall_1 = require(\"./_Multicall\");\r\nconst dev = dev_json_1.default;\r\nconst deployments = {\r\n    [mainnet_json_1.default.chainId]: mainnet_json_1.default,\r\n    [ropsten_json_1.default.chainId]: ropsten_json_1.default,\r\n    [rinkeby_json_1.default.chainId]: rinkeby_json_1.default,\r\n    [goerli_json_1.default.chainId]: goerli_json_1.default,\r\n    [kovan_json_1.default.chainId]: kovan_json_1.default,\r\n    [kiln_json_1.default.chainId]: kiln_json_1.default,\r\n    ...(dev !== null ? { [dev.chainId]: dev } : {})\r\n};\r\nconst branded = (t) => t;\r\nconst connectionFrom = (provider, signer, _contracts, _multicall, { deploymentDate, totalStabilityPoolLQTYReward, liquidityMiningLQTYRewardRate, ...deployment }, optionalParams) => {\r\n    if (optionalParams &&\r\n        optionalParams.useStore !== undefined &&\r\n        !validStoreOptions.includes(optionalParams.useStore)) {\r\n        throw new Error(`Invalid useStore value ${optionalParams.useStore}`);\r\n    }\r\n    return branded({\r\n        provider,\r\n        signer,\r\n        _contracts,\r\n        _multicall,\r\n        deploymentDate: new Date(deploymentDate),\r\n        totalStabilityPoolLQTYReward: lib_base_1.Decimal.from(totalStabilityPoolLQTYReward),\r\n        liquidityMiningLQTYRewardRate: lib_base_1.Decimal.from(liquidityMiningLQTYRewardRate),\r\n        ...deployment,\r\n        ...optionalParams\r\n    });\r\n};\r\n/** @internal */\r\nconst _getContracts = (connection) => connection._contracts;\r\nexports._getContracts = _getContracts;\r\nconst getMulticall = (connection) => connection._multicall;\r\nconst getTimestampFromBlock = ({ timestamp }) => timestamp;\r\n/** @internal */\r\nconst _getBlockTimestamp = (connection, blockTag = \"latest\") => { var _a, _b; return (_b = (_a = \r\n// Get the timestamp via a contract call whenever possible, to make it batchable with other calls\r\ngetMulticall(connection)) === null || _a === void 0 ? void 0 : _a.getCurrentBlockTimestamp({ blockTag }).then(_utils_1.numberify)) !== null && _b !== void 0 ? _b : exports._getProvider(connection).getBlock(blockTag).then(getTimestampFromBlock); };\r\nexports._getBlockTimestamp = _getBlockTimestamp;\r\n/** @internal */\r\nconst _requireSigner = (connection) => { var _a; return (_a = connection.signer) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"Must be connected through a Signer\")); };\r\nexports._requireSigner = _requireSigner;\r\n/** @internal */\r\nconst _getProvider = (connection) => connection.provider;\r\nexports._getProvider = _getProvider;\r\n// TODO parameterize error message?\r\n/** @internal */\r\nconst _requireAddress = (connection, overrides) => { var _a, _b; return (_b = (_a = overrides === null || overrides === void 0 ? void 0 : overrides.from) !== null && _a !== void 0 ? _a : connection.userAddress) !== null && _b !== void 0 ? _b : _utils_1.panic(new Error(\"A user address is required\")); };\r\nexports._requireAddress = _requireAddress;\r\n/** @internal */\r\nconst _requireFrontendAddress = (connection) => { var _a; return (_a = connection.frontendTag) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"A frontend address is required\")); };\r\nexports._requireFrontendAddress = _requireFrontendAddress;\r\n/** @internal */\r\nconst _usingStore = (connection) => connection.useStore !== undefined;\r\nexports._usingStore = _usingStore;\r\n/**\r\n * Thrown when trying to connect to a network where Liquity is not deployed.\r\n *\r\n * @remarks\r\n * Thrown by {@link ReadableEthersLiquity.(connect:2)} and {@link EthersLiquity.(connect:2)}.\r\n *\r\n * @public\r\n */\r\nclass UnsupportedNetworkError extends Error {\r\n    /** @internal */\r\n    constructor(chainId) {\r\n        super(`Unsupported network (chainId = ${chainId})`);\r\n        this.name = \"UnsupportedNetworkError\";\r\n        this.chainId = chainId;\r\n    }\r\n}\r\nexports.UnsupportedNetworkError = UnsupportedNetworkError;\r\nconst getProviderAndSigner = (signerOrProvider) => {\r\n    var _a;\r\n    const provider = abstract_signer_1.Signer.isSigner(signerOrProvider)\r\n        ? (_a = signerOrProvider.provider) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"Signer must have a Provider\")) : signerOrProvider;\r\n    const signer = abstract_signer_1.Signer.isSigner(signerOrProvider) ? signerOrProvider : undefined;\r\n    return [provider, signer];\r\n};\r\n/** @internal */\r\nconst _connectToDeployment = (deployment, signerOrProvider, optionalParams) => connectionFrom(...getProviderAndSigner(signerOrProvider), contracts_1._connectToContracts(signerOrProvider, deployment), undefined, deployment, optionalParams);\r\nexports._connectToDeployment = _connectToDeployment;\r\nconst validStoreOptions = [\"blockPolled\"];\r\n/** @internal */\r\nfunction _connectByChainId(provider, signer, chainId, optionalParams) {\r\n    var _a;\r\n    const deployment = (_a = deployments[chainId]) !== null && _a !== void 0 ? _a : _utils_1.panic(new UnsupportedNetworkError(chainId));\r\n    return connectionFrom(provider, signer, contracts_1._connectToContracts(signer !== null && signer !== void 0 ? signer : provider, deployment), _Multicall_1._connectToMulticall(signer !== null && signer !== void 0 ? signer : provider, chainId), deployment, optionalParams);\r\n}\r\nexports._connectByChainId = _connectByChainId;\r\n/** @internal */\r\nconst _connect = async (signerOrProvider, optionalParams) => {\r\n    const [provider, signer] = getProviderAndSigner(signerOrProvider);\r\n    if (signer) {\r\n        if ((optionalParams === null || optionalParams === void 0 ? void 0 : optionalParams.userAddress) !== undefined) {\r\n            throw new Error(\"Can't override userAddress when connecting through Signer\");\r\n        }\r\n        optionalParams = {\r\n            ...optionalParams,\r\n            userAddress: await signer.getAddress()\r\n        };\r\n    }\r\n    return _connectByChainId(provider, signer, (await provider.getNetwork()).chainId, optionalParams);\r\n};\r\nexports._connect = _connect;\r\n//# sourceMappingURL=EthersLiquityConnection.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Percent = exports.Difference = exports.Decimal = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst bignumber_1 = require(\"@ethersproject/bignumber\");\r\nconst getDigits = (numDigits) => TEN.pow(numDigits);\r\nconst MAX_UINT_256 = \"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\";\r\nconst PRECISION = 18;\r\nconst ONE = bignumber_1.BigNumber.from(1);\r\nconst TEN = bignumber_1.BigNumber.from(10);\r\nconst DIGITS = getDigits(PRECISION);\r\nconst stringRepresentationFormat = /^[0-9]*(\\.[0-9]*)?(e[-+]?[0-9]+)?$/;\r\nconst trailingZeros = /0*$/;\r\nconst magnitudes = [\"\", \"K\", \"M\", \"B\", \"T\"];\r\nconst roundedMul = (x, y) => x.mul(y).add(Decimal.HALF.hex).div(DIGITS);\r\n/**\r\n * Fixed-point decimal bignumber with 18 digits of precision.\r\n *\r\n * @remarks\r\n * Used by Liquity libraries to precisely represent native currency (e.g. Ether), LUSD and LQTY\r\n * amounts, as well as derived metrics like collateral ratios.\r\n *\r\n * @public\r\n */\r\nclass Decimal {\r\n    constructor(bigNumber) {\r\n        if (bigNumber.isNegative()) {\r\n            throw new Error(\"negatives not supported by Decimal\");\r\n        }\r\n        this._bigNumber = bigNumber;\r\n    }\r\n    /** @internal */\r\n    get hex() {\r\n        return this._bigNumber.toHexString();\r\n    }\r\n    /** @internal */\r\n    get bigNumber() {\r\n        return this._bigNumber.toString();\r\n    }\r\n    static fromBigNumberString(bigNumberString) {\r\n        return new Decimal(bignumber_1.BigNumber.from(bigNumberString));\r\n    }\r\n    static _fromString(representation) {\r\n        if (!representation || !representation.match(stringRepresentationFormat)) {\r\n            throw new Error(`bad decimal format: \"${representation}\"`);\r\n        }\r\n        if (representation.includes(\"e\")) {\r\n            // eslint-disable-next-line prefer-const\r\n            let [coefficient, exponent] = representation.split(\"e\");\r\n            if (exponent.startsWith(\"-\")) {\r\n                return new Decimal(Decimal._fromString(coefficient)._bigNumber.div(TEN.pow(bignumber_1.BigNumber.from(exponent.substr(1)))));\r\n            }\r\n            if (exponent.startsWith(\"+\")) {\r\n                exponent = exponent.substr(1);\r\n            }\r\n            return new Decimal(Decimal._fromString(coefficient)._bigNumber.mul(TEN.pow(bignumber_1.BigNumber.from(exponent))));\r\n        }\r\n        if (!representation.includes(\".\")) {\r\n            return new Decimal(bignumber_1.BigNumber.from(representation).mul(DIGITS));\r\n        }\r\n        // eslint-disable-next-line prefer-const\r\n        let [characteristic, mantissa] = representation.split(\".\");\r\n        if (mantissa.length < PRECISION) {\r\n            mantissa += \"0\".repeat(PRECISION - mantissa.length);\r\n        }\r\n        else {\r\n            mantissa = mantissa.substr(0, PRECISION);\r\n        }\r\n        return new Decimal(bignumber_1.BigNumber.from(characteristic || 0)\r\n            .mul(DIGITS)\r\n            .add(mantissa));\r\n    }\r\n    static from(decimalish) {\r\n        switch (typeof decimalish) {\r\n            case \"object\":\r\n                if (decimalish instanceof Decimal) {\r\n                    return decimalish;\r\n                }\r\n                else {\r\n                    throw new Error(\"invalid Decimalish value\");\r\n                }\r\n            case \"string\":\r\n                return Decimal._fromString(decimalish);\r\n            case \"number\":\r\n                return Decimal._fromString(decimalish.toString());\r\n            default:\r\n                throw new Error(\"invalid Decimalish value\");\r\n        }\r\n    }\r\n    _toStringWithAutomaticPrecision() {\r\n        const characteristic = this._bigNumber.div(DIGITS);\r\n        const mantissa = this._bigNumber.mod(DIGITS);\r\n        if (mantissa.isZero()) {\r\n            return characteristic.toString();\r\n        }\r\n        else {\r\n            const paddedMantissa = mantissa.toString().padStart(PRECISION, \"0\");\r\n            const trimmedMantissa = paddedMantissa.replace(trailingZeros, \"\");\r\n            return characteristic.toString() + \".\" + trimmedMantissa;\r\n        }\r\n    }\r\n    _roundUp(precision) {\r\n        const halfDigit = getDigits(PRECISION - 1 - precision).mul(5);\r\n        return this._bigNumber.add(halfDigit);\r\n    }\r\n    _toStringWithPrecision(precision) {\r\n        if (precision < 0) {\r\n            throw new Error(\"precision must not be negative\");\r\n        }\r\n        const value = precision < PRECISION ? this._roundUp(precision) : this._bigNumber;\r\n        const characteristic = value.div(DIGITS);\r\n        const mantissa = value.mod(DIGITS);\r\n        if (precision === 0) {\r\n            return characteristic.toString();\r\n        }\r\n        else {\r\n            const paddedMantissa = mantissa.toString().padStart(PRECISION, \"0\");\r\n            const trimmedMantissa = paddedMantissa.substr(0, precision);\r\n            return characteristic.toString() + \".\" + trimmedMantissa;\r\n        }\r\n    }\r\n    toString(precision) {\r\n        if (this.infinite) {\r\n            return \"\";\r\n        }\r\n        else if (precision !== undefined) {\r\n            return this._toStringWithPrecision(precision);\r\n        }\r\n        else {\r\n            return this._toStringWithAutomaticPrecision();\r\n        }\r\n    }\r\n    prettify(precision = 2) {\r\n        const [characteristic, mantissa] = this.toString(precision).split(\".\");\r\n        const prettyCharacteristic = characteristic.replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1,\");\r\n        return mantissa !== undefined ? prettyCharacteristic + \".\" + mantissa : prettyCharacteristic;\r\n    }\r\n    shorten() {\r\n        const characteristicLength = this.toString(0).length;\r\n        const magnitude = Math.min(Math.floor((characteristicLength - 1) / 3), magnitudes.length - 1);\r\n        const precision = Math.max(3 * (magnitude + 1) - characteristicLength, 0);\r\n        const normalized = this.div(new Decimal(getDigits(PRECISION + 3 * magnitude)));\r\n        return normalized.prettify(precision) + magnitudes[magnitude];\r\n    }\r\n    add(addend) {\r\n        return new Decimal(this._bigNumber.add(Decimal.from(addend)._bigNumber));\r\n    }\r\n    sub(subtrahend) {\r\n        return new Decimal(this._bigNumber.sub(Decimal.from(subtrahend)._bigNumber));\r\n    }\r\n    mul(multiplier) {\r\n        return new Decimal(this._bigNumber.mul(Decimal.from(multiplier)._bigNumber).div(DIGITS));\r\n    }\r\n    div(divider) {\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(DIGITS).div(divider._bigNumber));\r\n    }\r\n    /** @internal */\r\n    _divCeil(divider) {\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(DIGITS).add(divider._bigNumber.sub(ONE)).div(divider._bigNumber));\r\n    }\r\n    mulDiv(multiplier, divider) {\r\n        multiplier = Decimal.from(multiplier);\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(multiplier._bigNumber).div(divider._bigNumber));\r\n    }\r\n    pow(exponent) {\r\n        assert_1.default(Number.isInteger(exponent));\r\n        assert_1.default(0 <= exponent && exponent <= 0xffffffff); // Ensure we're safe to use bitwise ops\r\n        if (exponent === 0) {\r\n            return Decimal.ONE;\r\n        }\r\n        if (exponent === 1) {\r\n            return this;\r\n        }\r\n        let x = this._bigNumber;\r\n        let y = DIGITS;\r\n        for (; exponent > 1; exponent >>>= 1) {\r\n            if (exponent & 1) {\r\n                y = roundedMul(x, y);\r\n            }\r\n            x = roundedMul(x, x);\r\n        }\r\n        return new Decimal(roundedMul(x, y));\r\n    }\r\n    get isZero() {\r\n        return this._bigNumber.isZero();\r\n    }\r\n    get zero() {\r\n        if (this.isZero) {\r\n            return this;\r\n        }\r\n    }\r\n    get nonZero() {\r\n        if (!this.isZero) {\r\n            return this;\r\n        }\r\n    }\r\n    get infinite() {\r\n        if (this.eq(Decimal.INFINITY)) {\r\n            return this;\r\n        }\r\n    }\r\n    get finite() {\r\n        if (!this.eq(Decimal.INFINITY)) {\r\n            return this;\r\n        }\r\n    }\r\n    /** @internal */\r\n    get absoluteValue() {\r\n        return this;\r\n    }\r\n    lt(that) {\r\n        return this._bigNumber.lt(Decimal.from(that)._bigNumber);\r\n    }\r\n    eq(that) {\r\n        return this._bigNumber.eq(Decimal.from(that)._bigNumber);\r\n    }\r\n    gt(that) {\r\n        return this._bigNumber.gt(Decimal.from(that)._bigNumber);\r\n    }\r\n    gte(that) {\r\n        return this._bigNumber.gte(Decimal.from(that)._bigNumber);\r\n    }\r\n    lte(that) {\r\n        return this._bigNumber.lte(Decimal.from(that)._bigNumber);\r\n    }\r\n    static min(a, b) {\r\n        a = Decimal.from(a);\r\n        b = Decimal.from(b);\r\n        return a.lt(b) ? a : b;\r\n    }\r\n    static max(a, b) {\r\n        a = Decimal.from(a);\r\n        b = Decimal.from(b);\r\n        return a.gt(b) ? a : b;\r\n    }\r\n}\r\nexports.Decimal = Decimal;\r\nDecimal.INFINITY = Decimal.fromBigNumberString(MAX_UINT_256);\r\nDecimal.ZERO = Decimal.from(0);\r\nDecimal.HALF = Decimal.from(0.5);\r\nDecimal.ONE = Decimal.from(1);\r\n/** @alpha */\r\nclass Difference {\r\n    constructor(number) {\r\n        this._number = number;\r\n    }\r\n    static between(d1, d2) {\r\n        if (d1 === undefined || d2 === undefined) {\r\n            return new Difference(undefined);\r\n        }\r\n        d1 = Decimal.from(d1);\r\n        d2 = Decimal.from(d2);\r\n        if (d1.infinite && d2.infinite) {\r\n            return new Difference(undefined);\r\n        }\r\n        else if (d1.infinite) {\r\n            return new Difference({ sign: \"+\", absoluteValue: d1 });\r\n        }\r\n        else if (d2.infinite) {\r\n            return new Difference({ sign: \"-\", absoluteValue: d2 });\r\n        }\r\n        else if (d1.gt(d2)) {\r\n            return new Difference({ sign: \"+\", absoluteValue: Decimal.from(d1).sub(d2) });\r\n        }\r\n        else if (d2.gt(d1)) {\r\n            return new Difference({ sign: \"-\", absoluteValue: Decimal.from(d2).sub(d1) });\r\n        }\r\n        else {\r\n            return new Difference({ sign: \"\", absoluteValue: Decimal.ZERO });\r\n        }\r\n    }\r\n    toString(precision) {\r\n        if (!this._number) {\r\n            return \"N/A\";\r\n        }\r\n        return this._number.sign + this._number.absoluteValue.toString(precision);\r\n    }\r\n    prettify(precision) {\r\n        if (!this._number) {\r\n            return this.toString();\r\n        }\r\n        return this._number.sign + this._number.absoluteValue.prettify(precision);\r\n    }\r\n    mul(multiplier) {\r\n        return new Difference(this._number && {\r\n            sign: this._number.sign,\r\n            absoluteValue: this._number.absoluteValue.mul(multiplier)\r\n        });\r\n    }\r\n    get nonZero() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.nonZero) && this;\r\n    }\r\n    get positive() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.sign) === \"+\" ? this : undefined;\r\n    }\r\n    get negative() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.sign) === \"-\" ? this : undefined;\r\n    }\r\n    get absoluteValue() {\r\n        var _a;\r\n        return (_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue;\r\n    }\r\n    get infinite() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.infinite) && this;\r\n    }\r\n    get finite() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.finite) && this;\r\n    }\r\n}\r\nexports.Difference = Difference;\r\n/** @alpha */\r\nclass Percent {\r\n    constructor(ratio) {\r\n        this._percent = ratio.infinite || (ratio.mul && ratio.mul(100)) || ratio;\r\n    }\r\n    nonZeroish(precision) {\r\n        var _a;\r\n        const zeroish = `0.${\"0\".repeat(precision)}5`;\r\n        if ((_a = this._percent.absoluteValue) === null || _a === void 0 ? void 0 : _a.gte(zeroish)) {\r\n            return this;\r\n        }\r\n    }\r\n    toString(precision) {\r\n        return (this._percent.toString(precision) +\r\n            (this._percent.absoluteValue && !this._percent.infinite ? \"%\" : \"\"));\r\n    }\r\n    prettify() {\r\n        var _a, _b;\r\n        if ((_a = this._percent.absoluteValue) === null || _a === void 0 ? void 0 : _a.gte(\"1000\")) {\r\n            return this.toString(0);\r\n        }\r\n        else if ((_b = this._percent.absoluteValue) === null || _b === void 0 ? void 0 : _b.gte(\"10\")) {\r\n            return this.toString(1);\r\n        }\r\n        else {\r\n            return this.toString(2);\r\n        }\r\n    }\r\n}\r\nexports.Percent = Percent;\r\n//# sourceMappingURL=Decimal.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.promiseAllValues = exports.panic = exports.decimalify = exports.numberify = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst numberify = (bigNumber) => bigNumber.toNumber();\r\nexports.numberify = numberify;\r\nconst decimalify = (bigNumber) => lib_base_1.Decimal.fromBigNumberString(bigNumber.toHexString());\r\nexports.decimalify = decimalify;\r\nconst panic = (e) => {\r\n    throw e;\r\n};\r\nexports.panic = panic;\r\nconst promiseAllValues = (object) => {\r\n    const keys = Object.keys(object);\r\n    return Promise.all(Object.values(object)).then(values => Object.fromEntries(values.map((value, i) => [keys[i], value])));\r\n};\r\nexports.promiseAllValues = promiseAllValues;\r\n//# sourceMappingURL=_utils.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.MINIMUM_REDEMPTION_RATE = exports.MAXIMUM_BORROWING_RATE = exports.MINIMUM_BORROWING_RATE = exports.LUSD_MINIMUM_DEBT = exports.LUSD_MINIMUM_NET_DEBT = exports.LUSD_LIQUIDATION_RESERVE = exports.MINIMUM_COLLATERAL_RATIO = exports.CRITICAL_COLLATERAL_RATIO = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * Total collateral ratio below which recovery mode is triggered.\r\n *\r\n * @public\r\n */\r\nexports.CRITICAL_COLLATERAL_RATIO = Decimal_1.Decimal.from(1.5);\r\n/**\r\n * Collateral ratio below which a Trove can be liquidated in normal mode.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_COLLATERAL_RATIO = Decimal_1.Decimal.from(1.1);\r\n/**\r\n * Amount of LUSD that's reserved for compensating the liquidator of a Trove.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_LIQUIDATION_RESERVE = Decimal_1.Decimal.from(200);\r\n/**\r\n * A Trove must always have at least this much debt on top of the\r\n * {@link LUSD_LIQUIDATION_RESERVE | liquidation reserve}.\r\n *\r\n * @remarks\r\n * Any transaction that would result in a Trove with less net debt than this will be reverted.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_MINIMUM_NET_DEBT = Decimal_1.Decimal.from(1800);\r\n/**\r\n * A Trove must always have at least this much debt.\r\n *\r\n * @remarks\r\n * Any transaction that would result in a Trove with less debt than this will be reverted.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_MINIMUM_DEBT = exports.LUSD_LIQUIDATION_RESERVE.add(exports.LUSD_MINIMUM_NET_DEBT);\r\n/**\r\n * Value that the {@link Fees.borrowingRate | borrowing rate} will never decay below.\r\n *\r\n * @remarks\r\n * Note that the borrowing rate can still be lower than this during recovery mode, when it's\r\n * overridden by zero.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_BORROWING_RATE = Decimal_1.Decimal.from(0.005);\r\n/**\r\n * Value that the {@link Fees.borrowingRate | borrowing rate} will never exceed.\r\n *\r\n * @public\r\n */\r\nexports.MAXIMUM_BORROWING_RATE = Decimal_1.Decimal.from(0.05);\r\n/**\r\n * Value that the {@link Fees.redemptionRate | redemption rate} will never decay below.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_REDEMPTION_RATE = Decimal_1.Decimal.from(0.005);\r\n//# sourceMappingURL=constants.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquityStore = void 0;\r\nconst react_1 = require(\"react\");\r\nconst LiquityStoreProvider_1 = require(\"../components/LiquityStoreProvider\");\r\nconst useLiquityStore = () => {\r\n    const store = react_1.useContext(LiquityStoreProvider_1.LiquityStoreContext);\r\n    if (!store) {\r\n        throw new Error(\"You must provide a LiquityStore via LiquityStoreProvider\");\r\n    }\r\n    return store;\r\n};\r\nexports.useLiquityStore = useLiquityStore;\r\n//# sourceMappingURL=useLiquityStore.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.WebSocketAugmentedWeb3Provider = exports.WebSocketAugmented = exports.isWebSocketAugmentedProvider = void 0;\r\nconst providers_1 = require(\"@ethersproject/providers\");\r\nconst bytes_1 = require(\"@ethersproject/bytes\");\r\nconst WebSocketProvider_1 = require(\"./WebSocketProvider\");\r\nconst webSocketAugmentedProviders = [];\r\nconst isWebSocketAugmentedProvider = (provider) => webSocketAugmentedProviders.some(webSocketAugmentedProvider => provider instanceof webSocketAugmentedProvider);\r\nexports.isWebSocketAugmentedProvider = isWebSocketAugmentedProvider;\r\nconst isHeaderNotFoundError = (error) => typeof error === \"object\" &&\r\n    typeof error.message === \"string\" &&\r\n    (error.message.includes(\r\n    // geth\r\n    \"header not found\") ||\r\n        error.message.includes(\r\n        // openethereum\r\n        \"request is not supported because your node is running with state pruning\"));\r\nconst isTransactionHash = (eventName) => typeof eventName === \"string\" && bytes_1.hexDataLength(eventName) === 32;\r\nconst loadBalancingGlitchRetryIntervalMs = 200;\r\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));\r\nconst waitFor = (f) => (g) => (t, { isActive }) => {\r\n    f(t).then(u => {\r\n        if (u !== null && isActive()) {\r\n            g(u);\r\n        }\r\n    });\r\n};\r\nconst pass = (f) => (t, _) => {\r\n    f(t);\r\n};\r\nconst passOnce = (f) => (t, { removeMe }) => {\r\n    f(t);\r\n    removeMe();\r\n};\r\nconst sequence = (f, g) => (h) => (t, context) => {\r\n    f(u => g(h)(u, context))(t, context);\r\n};\r\nconst defer = (f) => (t) => {\r\n    setTimeout(() => {\r\n        f(t);\r\n    }, 0);\r\n};\r\nconst WebSocketAugmented = (Base) => {\r\n    let webSocketAugmentedProvider = class extends Base {\r\n        constructor() {\r\n            super(...arguments);\r\n            this._seenBlock = 0;\r\n            this._blockListenerScheduled = false;\r\n            this._blockListeners = new Map();\r\n            this._blockListener = this._onBlock.bind(this);\r\n        }\r\n        openWebSocket(url, network) {\r\n            this._wsProvider = new WebSocketProvider_1.WebSocketProvider(url, network);\r\n            this._wsProvider.onClose = this._onWebSocketClose.bind(this);\r\n            this._wsParams = [url, network];\r\n            this._switchover();\r\n        }\r\n        _onWebSocketClose() {\r\n            this.closeWebSocket();\r\n            console.warn(\"WebSocketProvider disconnected. Retrying in 10 seconds.\");\r\n            this._reconnectTimerId = setTimeout(() => this.openWebSocket(...this._wsParams), 10000);\r\n        }\r\n        closeWebSocket() {\r\n            if (this._wsProvider) {\r\n                this._wsProvider.onClose = null;\r\n                this._wsProvider.close(1000); // normal closure\r\n                this._wsProvider = undefined;\r\n                this._switchover();\r\n                if (this._reconnectTimerId !== undefined) {\r\n                    clearTimeout(this._reconnectTimerId);\r\n                    this._reconnectTimerId = undefined;\r\n                }\r\n            }\r\n        }\r\n        _switchover() {\r\n            if (this._blockListeners.size > 0) {\r\n                if (this._wsProvider) {\r\n                    super.off(\"block\", this._blockListener);\r\n                }\r\n                this._startBlockEvents();\r\n            }\r\n        }\r\n        _onBlock(blockNumber) {\r\n            this._seenBlock = blockNumber;\r\n            if (!this._blockListenerScheduled) {\r\n                this._blockListenerScheduled = true;\r\n                setTimeout(() => {\r\n                    this._blockListenerScheduled = false;\r\n                    [...this._blockListeners].forEach(([, listener]) => listener(this._seenBlock));\r\n                }, 50);\r\n            }\r\n        }\r\n        async _retrySeenBlock(perform, startingBlock) {\r\n            for (let retries = 0;; ++retries) {\r\n                try {\r\n                    const ret = await perform();\r\n                    if (retries) {\r\n                        // console.log(`Glitch resolved after ${retries} ${retries === 1 ? \"retry\" : \"retries\"}.`);\r\n                    }\r\n                    return ret;\r\n                }\r\n                catch (error) {\r\n                    if (this._seenBlock !== startingBlock || !isHeaderNotFoundError(error)) {\r\n                        throw error;\r\n                    }\r\n                }\r\n                // console.warn(\"Load balancing glitch. Retrying...\");\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n        }\r\n        async call(transaction, blockTag) {\r\n            const resolvedBlockTag = await blockTag;\r\n            const perform = () => {\r\n                var _a;\r\n                return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.call(transaction, resolvedBlockTag)\r\n                    : super.call(transaction, resolvedBlockTag);\r\n            };\r\n            return resolvedBlockTag === this._seenBlock\r\n                ? this._retrySeenBlock(perform, this._seenBlock)\r\n                : perform();\r\n        }\r\n        async getBalance(addressOrName, blockTag) {\r\n            const resolvedBlockTag = await blockTag;\r\n            const perform = () => {\r\n                var _a;\r\n                return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBalance(addressOrName, resolvedBlockTag)\r\n                    : super.getBalance(addressOrName, resolvedBlockTag);\r\n            };\r\n            return resolvedBlockTag === this._seenBlock\r\n                ? this._retrySeenBlock(perform, this._seenBlock)\r\n                : perform();\r\n        }\r\n        _startBlockEvents() {\r\n            if (this._wsProvider) {\r\n                console.log(\"Listening for new blocks on WebSocketProvider\");\r\n                this._wsProvider.on(\"block\", this._blockListener);\r\n            }\r\n            else {\r\n                console.log(\"Listening for new blocks on basic Provider\");\r\n                super.on(\"block\", this._blockListener);\r\n            }\r\n        }\r\n        _stopBlockEvents() {\r\n            if (this._wsProvider) {\r\n                this._wsProvider.off(\"block\", this._blockListener);\r\n            }\r\n            else {\r\n                super.off(\"block\", this._blockListener);\r\n            }\r\n        }\r\n        _wrap(f, g) {\r\n            return [\r\n                f,\r\n                (u) => g(defer(f))(u, {\r\n                    isActive: () => this._blockListeners.has(f),\r\n                    removeMe: () => this._blockListeners.delete(f)\r\n                })\r\n            ];\r\n        }\r\n        on(eventName, listener) {\r\n            if (isTransactionHash(eventName)) {\r\n                const fetchReceipt = this._getTransactionReceiptFromLatest.bind(this, eventName);\r\n                const [, passReceipt] = this._wrap(listener, waitFor(fetchReceipt));\r\n                passReceipt(undefined);\r\n                return this._addBlockListener(listener, passReceipt);\r\n            }\r\n            else if (eventName === \"block\") {\r\n                return this._addBlockListener(...this._wrap(listener, pass));\r\n            }\r\n            else {\r\n                return super.on(eventName, listener);\r\n            }\r\n        }\r\n        _addBlockListener(key, blockListener) {\r\n            if (!this._blockListeners.has(key)) {\r\n                this._blockListeners.set(key, blockListener);\r\n                if (this._blockListeners.size === 1) {\r\n                    this._startBlockEvents();\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        once(eventName, listener) {\r\n            if (isTransactionHash(eventName)) {\r\n                const fetchReceipt = this._getTransactionReceiptFromLatest.bind(this, eventName);\r\n                const [, passReceiptOnce] = this._wrap(listener, sequence(waitFor(fetchReceipt), passOnce));\r\n                passReceiptOnce(undefined);\r\n                return this._addBlockListener(listener, passReceiptOnce);\r\n            }\r\n            else if (eventName === \"block\") {\r\n                return this._addBlockListener(...this._wrap(listener, passOnce));\r\n            }\r\n            else {\r\n                return super.once(eventName, listener);\r\n            }\r\n        }\r\n        off(eventName, listener) {\r\n            if (isTransactionHash(eventName) || eventName === \"block\") {\r\n                return this._removeBlockListener(listener);\r\n            }\r\n            else {\r\n                return super.off(eventName, listener);\r\n            }\r\n        }\r\n        _removeBlockListener(key) {\r\n            if (this._blockListeners.has(key)) {\r\n                this._blockListeners.delete(key);\r\n                if (this._blockListeners.size === 0) {\r\n                    this._stopBlockEvents();\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        async getTransaction(transactionHash) {\r\n            var _a, _b;\r\n            const txPromises = [\r\n                super.getTransaction(transactionHash),\r\n                ...(((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? [this._wsProvider.getTransaction(transactionHash)] : [])\r\n            ];\r\n            const first = await Promise.race(txPromises);\r\n            const tx = (_b = first !== null && first !== void 0 ? first : (await Promise.all(txPromises)).find(tx => tx !== null)) !== null && _b !== void 0 ? _b : null;\r\n            return tx;\r\n        }\r\n        getTransactionReceipt(transactionHash) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getTransactionReceipt(transactionHash)\r\n                : super.getTransactionReceipt(transactionHash);\r\n        }\r\n        getTransactionCount(addressOrName, blockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getTransactionCount(addressOrName, blockTag)\r\n                : super.getTransactionCount(addressOrName, blockTag);\r\n        }\r\n        getBlock(blockHashOrBlockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBlock(blockHashOrBlockTag)\r\n                : super.getBlock(blockHashOrBlockTag);\r\n        }\r\n        getBlockWithTransactions(blockHashOrBlockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBlockWithTransactions(blockHashOrBlockTag)\r\n                : super.getBlockWithTransactions(blockHashOrBlockTag);\r\n        }\r\n        async _blockContainsTx(blockNumber, txHash) {\r\n            let block;\r\n            for (block = null; !block; block = await this.getBlock(blockNumber)) {\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n            return block.transactions.some(txHashInBlock => txHashInBlock === txHash);\r\n        }\r\n        async _getTransactionReceiptFromLatest(txHash, latestBlock) {\r\n            txHash = await txHash;\r\n            for (let retries = 0;; ++retries) {\r\n                const receipt = (await this.getTransactionReceipt(txHash));\r\n                if (latestBlock === undefined ||\r\n                    (receipt === null && !(await this._blockContainsTx(latestBlock, txHash))) ||\r\n                    (receipt !== null && receipt.blockNumber + receipt.confirmations - 1 >= latestBlock)) {\r\n                    if (retries) {\r\n                        // console.log(`Glitch resolved after ${retries} ${retries === 1 ? \"retry\" : \"retries\"}.`);\r\n                    }\r\n                    return receipt;\r\n                }\r\n                // console.warn(\"Load balancing glitch. Retrying...\");\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n        }\r\n        async waitForTransaction(txHash, confirmations, timeout) {\r\n            if (timeout !== undefined) {\r\n                // We don't use timeout, don't implement it\r\n                return super.waitForTransaction(txHash, confirmations, timeout);\r\n            }\r\n            let latestBlock = undefined;\r\n            for (;;) {\r\n                const receipt = await this._getTransactionReceiptFromLatest(txHash, latestBlock);\r\n                if (receipt !== null &&\r\n                    (confirmations === undefined || receipt.confirmations >= confirmations)) {\r\n                    return receipt;\r\n                }\r\n                latestBlock = await new Promise(resolve => this.once(\"block\", resolve));\r\n            }\r\n        }\r\n    };\r\n    webSocketAugmentedProviders.push(webSocketAugmentedProvider);\r\n    return webSocketAugmentedProvider;\r\n};\r\nexports.WebSocketAugmented = WebSocketAugmented;\r\nexports.WebSocketAugmentedWeb3Provider = exports.WebSocketAugmented(providers_1.Web3Provider);\r\n//# sourceMappingURL=WebSocketAugmentedProvider.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.WebSocketProvider = void 0;\r\nconst providers_1 = require(\"@ethersproject/providers\");\r\nclass WebSocketProvider extends providers_1.WebSocketProvider {\r\n    get isReady() {\r\n        return this._websocket.readyState === WebSocket.OPEN;\r\n    }\r\n    set onClose(closeListener) {\r\n        this._websocket.onclose = closeListener;\r\n    }\r\n    close(code) {\r\n        this._websocket.close(code);\r\n    }\r\n    async detectNetwork() {\r\n        return this.network;\r\n    }\r\n}\r\nexports.WebSocketProvider = WebSocketProvider;\r\n//# sourceMappingURL=WebSocketProvider.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connectToContracts = exports._uniTokenIsMock = exports._priceFeedIsTestnet = exports._LiquityContract = void 0;\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst ActivePool_json_1 = __importDefault(require(\"../abi/ActivePool.json\"));\r\nconst BorrowerOperations_json_1 = __importDefault(require(\"../abi/BorrowerOperations.json\"));\r\nconst TroveManager_json_1 = __importDefault(require(\"../abi/TroveManager.json\"));\r\nconst LUSDToken_json_1 = __importDefault(require(\"../abi/LUSDToken.json\"));\r\nconst CollSurplusPool_json_1 = __importDefault(require(\"../abi/CollSurplusPool.json\"));\r\nconst CommunityIssuance_json_1 = __importDefault(require(\"../abi/CommunityIssuance.json\"));\r\nconst DefaultPool_json_1 = __importDefault(require(\"../abi/DefaultPool.json\"));\r\nconst LQTYToken_json_1 = __importDefault(require(\"../abi/LQTYToken.json\"));\r\nconst HintHelpers_json_1 = __importDefault(require(\"../abi/HintHelpers.json\"));\r\nconst LockupContractFactory_json_1 = __importDefault(require(\"../abi/LockupContractFactory.json\"));\r\nconst LQTYStaking_json_1 = __importDefault(require(\"../abi/LQTYStaking.json\"));\r\nconst MultiTroveGetter_json_1 = __importDefault(require(\"../abi/MultiTroveGetter.json\"));\r\nconst PriceFeed_json_1 = __importDefault(require(\"../abi/PriceFeed.json\"));\r\nconst PriceFeedTestnet_json_1 = __importDefault(require(\"../abi/PriceFeedTestnet.json\"));\r\nconst SortedTroves_json_1 = __importDefault(require(\"../abi/SortedTroves.json\"));\r\nconst StabilityPool_json_1 = __importDefault(require(\"../abi/StabilityPool.json\"));\r\nconst GasPool_json_1 = __importDefault(require(\"../abi/GasPool.json\"));\r\nconst Unipool_json_1 = __importDefault(require(\"../abi/Unipool.json\"));\r\nconst IERC20_json_1 = __importDefault(require(\"../abi/IERC20.json\"));\r\nconst ERC20Mock_json_1 = __importDefault(require(\"../abi/ERC20Mock.json\"));\r\nconst buildEstimatedFunctions = (estimateFunctions, functions) => Object.fromEntries(Object.keys(estimateFunctions).map(functionName => [\r\n    functionName,\r\n    async (overrides, adjustEstimate, ...args) => {\r\n        if (overrides.gasLimit === undefined) {\r\n            const estimatedGas = await estimateFunctions[functionName](...args, overrides);\r\n            overrides = {\r\n                ...overrides,\r\n                gasLimit: adjustEstimate(estimatedGas)\r\n            };\r\n        }\r\n        return functions[functionName](...args, overrides);\r\n    }\r\n]));\r\nclass _LiquityContract extends contracts_1.Contract {\r\n    constructor(addressOrName, contractInterface, signerOrProvider) {\r\n        super(addressOrName, contractInterface, signerOrProvider);\r\n        // this.estimateAndCall = buildEstimatedFunctions(this.estimateGas, this);\r\n        this.estimateAndPopulate = buildEstimatedFunctions(this.estimateGas, this.populateTransaction);\r\n    }\r\n    extractEvents(logs, name) {\r\n        return logs\r\n            .filter(log => log.address === this.address)\r\n            .map(log => this.interface.parseLog(log))\r\n            .filter(e => e.name === name);\r\n    }\r\n}\r\nexports._LiquityContract = _LiquityContract;\r\n/** @internal */\r\nconst _priceFeedIsTestnet = (priceFeed) => \"setPrice\" in priceFeed;\r\nexports._priceFeedIsTestnet = _priceFeedIsTestnet;\r\n/** @internal */\r\nconst _uniTokenIsMock = (uniToken) => \"mint\" in uniToken;\r\nexports._uniTokenIsMock = _uniTokenIsMock;\r\nconst getAbi = (priceFeedIsTestnet, uniTokenIsMock) => ({\r\n    activePool: ActivePool_json_1.default,\r\n    borrowerOperations: BorrowerOperations_json_1.default,\r\n    troveManager: TroveManager_json_1.default,\r\n    lusdToken: LUSDToken_json_1.default,\r\n    communityIssuance: CommunityIssuance_json_1.default,\r\n    defaultPool: DefaultPool_json_1.default,\r\n    lqtyToken: LQTYToken_json_1.default,\r\n    hintHelpers: HintHelpers_json_1.default,\r\n    lockupContractFactory: LockupContractFactory_json_1.default,\r\n    lqtyStaking: LQTYStaking_json_1.default,\r\n    multiTroveGetter: MultiTroveGetter_json_1.default,\r\n    priceFeed: priceFeedIsTestnet ? PriceFeedTestnet_json_1.default : PriceFeed_json_1.default,\r\n    sortedTroves: SortedTroves_json_1.default,\r\n    stabilityPool: StabilityPool_json_1.default,\r\n    gasPool: GasPool_json_1.default,\r\n    collSurplusPool: CollSurplusPool_json_1.default,\r\n    unipool: Unipool_json_1.default,\r\n    uniToken: uniTokenIsMock ? ERC20Mock_json_1.default : IERC20_json_1.default\r\n});\r\nconst mapLiquityContracts = (contracts, f) => Object.fromEntries(Object.entries(contracts).map(([key, t]) => [key, f(t, key)]));\r\n/** @internal */\r\nconst _connectToContracts = (signerOrProvider, { addresses, _priceFeedIsTestnet, _uniTokenIsMock }) => {\r\n    const abi = getAbi(_priceFeedIsTestnet, _uniTokenIsMock);\r\n    return mapLiquityContracts(addresses, (address, key) => new _LiquityContract(address, abi[key], signerOrProvider));\r\n};\r\nexports._connectToContracts = _connectToContracts;\r\n//# sourceMappingURL=contracts.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ReadableEthersLiquity = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst BlockPolledLiquityStore_1 = require(\"./BlockPolledLiquityStore\");\r\n// TODO: these are constant in the contracts, so it doesn't make sense to make a call for them,\r\n// but to avoid having to update them here when we change them in the contracts, we could read\r\n// them once after deployment and save them to LiquityDeployment.\r\nconst MINUTE_DECAY_FACTOR = lib_base_1.Decimal.from(\"0.999037758833783000\");\r\nconst BETA = lib_base_1.Decimal.from(2);\r\nvar BackendTroveStatus;\r\n(function (BackendTroveStatus) {\r\n    BackendTroveStatus[BackendTroveStatus[\"nonExistent\"] = 0] = \"nonExistent\";\r\n    BackendTroveStatus[BackendTroveStatus[\"active\"] = 1] = \"active\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByOwner\"] = 2] = \"closedByOwner\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByLiquidation\"] = 3] = \"closedByLiquidation\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByRedemption\"] = 4] = \"closedByRedemption\";\r\n})(BackendTroveStatus || (BackendTroveStatus = {}));\r\nconst userTroveStatusFrom = (backendStatus) => backendStatus === BackendTroveStatus.nonExistent\r\n    ? \"nonExistent\"\r\n    : backendStatus === BackendTroveStatus.active\r\n        ? \"open\"\r\n        : backendStatus === BackendTroveStatus.closedByOwner\r\n            ? \"closedByOwner\"\r\n            : backendStatus === BackendTroveStatus.closedByLiquidation\r\n                ? \"closedByLiquidation\"\r\n                : backendStatus === BackendTroveStatus.closedByRedemption\r\n                    ? \"closedByRedemption\"\r\n                    : _utils_1.panic(new Error(`invalid backendStatus ${backendStatus}`));\r\nconst convertToDate = (timestamp) => new Date(timestamp * 1000);\r\nconst validSortingOptions = [\"ascendingCollateralRatio\", \"descendingCollateralRatio\"];\r\nconst expectPositiveInt = (obj, key) => {\r\n    if (obj[key] !== undefined) {\r\n        if (!Number.isInteger(obj[key])) {\r\n            throw new Error(`${key} must be an integer`);\r\n        }\r\n        if (obj[key] < 0) {\r\n            throw new Error(`${key} must not be negative`);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#ReadableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass ReadableEthersLiquity {\r\n    /** @internal */\r\n    constructor(connection) {\r\n        this.connection = connection;\r\n    }\r\n    /** @internal */\r\n    static _from(connection) {\r\n        const readable = new ReadableEthersLiquity(connection);\r\n        return connection.useStore === \"blockPolled\"\r\n            ? new _BlockPolledReadableEthersLiquity(readable)\r\n            : readable;\r\n    }\r\n    /**\r\n     * Connect to the Liquity protocol and create a `ReadableEthersLiquity` object.\r\n     *\r\n     * @param signerOrProvider - Ethers `Signer` or `Provider` to use for connecting to the Ethereum\r\n     *                           network.\r\n     * @param optionalParams - Optional parameters that can be used to customize the connection.\r\n     */\r\n    static async connect(signerOrProvider, optionalParams) {\r\n        return ReadableEthersLiquity._from(await EthersLiquityConnection_1._connect(signerOrProvider, optionalParams));\r\n    }\r\n    hasStore() {\r\n        return false;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalRedistributed} */\r\n    async getTotalRedistributed(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [collateral, debt] = await Promise.all([\r\n            troveManager.L_ETH({ ...overrides }).then(_utils_1.decimalify),\r\n            troveManager.L_LUSDDebt({ ...overrides }).then(_utils_1.decimalify)\r\n        ]);\r\n        return new lib_base_1.Trove(collateral, debt);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTroveBeforeRedistribution} */\r\n    async getTroveBeforeRedistribution(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [trove, snapshot] = await Promise.all([\r\n            troveManager.Troves(address, { ...overrides }),\r\n            troveManager.rewardSnapshots(address, { ...overrides })\r\n        ]);\r\n        if (trove.status === BackendTroveStatus.active) {\r\n            return new lib_base_1.TroveWithPendingRedistribution(address, userTroveStatusFrom(trove.status), _utils_1.decimalify(trove.coll), _utils_1.decimalify(trove.debt), _utils_1.decimalify(trove.stake), new lib_base_1.Trove(_utils_1.decimalify(snapshot.ETH), _utils_1.decimalify(snapshot.LUSDDebt)));\r\n        }\r\n        else {\r\n            return new lib_base_1.TroveWithPendingRedistribution(address, userTroveStatusFrom(trove.status));\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTrove} */\r\n    async getTrove(address, overrides) {\r\n        const [trove, totalRedistributed] = await Promise.all([\r\n            this.getTroveBeforeRedistribution(address, overrides),\r\n            this.getTotalRedistributed(overrides)\r\n        ]);\r\n        return trove.applyRedistribution(totalRedistributed);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getNumberOfTroves} */\r\n    async getNumberOfTroves(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return (await troveManager.getTroveOwnersCount({ ...overrides })).toNumber();\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getPrice} */\r\n    getPrice(overrides) {\r\n        const { priceFeed } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return priceFeed.callStatic.fetchPrice({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** @internal */\r\n    async _getActivePool(overrides) {\r\n        const { activePool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [activeCollateral, activeDebt] = await Promise.all([\r\n            activePool.getETH({ ...overrides }),\r\n            activePool.getLUSDDebt({ ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.Trove(activeCollateral, activeDebt);\r\n    }\r\n    /** @internal */\r\n    async _getDefaultPool(overrides) {\r\n        const { defaultPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [liquidatedCollateral, closedDebt] = await Promise.all([\r\n            defaultPool.getETH({ ...overrides }),\r\n            defaultPool.getLUSDDebt({ ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.Trove(liquidatedCollateral, closedDebt);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotal} */\r\n    async getTotal(overrides) {\r\n        const [activePool, defaultPool] = await Promise.all([\r\n            this._getActivePool(overrides),\r\n            this._getDefaultPool(overrides)\r\n        ]);\r\n        return activePool.add(defaultPool);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getStabilityDeposit} */\r\n    async getStabilityDeposit(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [{ frontEndTag, initialValue }, currentLUSD, collateralGain, lqtyReward] = await Promise.all([\r\n            stabilityPool.deposits(address, { ...overrides }),\r\n            stabilityPool.getCompoundedLUSDDeposit(address, { ...overrides }),\r\n            stabilityPool.getDepositorETHGain(address, { ...overrides }),\r\n            stabilityPool.getDepositorLQTYGain(address, { ...overrides })\r\n        ]);\r\n        return new lib_base_1.StabilityDeposit(_utils_1.decimalify(initialValue), _utils_1.decimalify(currentLUSD), _utils_1.decimalify(collateralGain), _utils_1.decimalify(lqtyReward), frontEndTag);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingStabilityPoolLQTYReward} */\r\n    async getRemainingStabilityPoolLQTYReward(overrides) {\r\n        const { communityIssuance } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const issuanceCap = this.connection.totalStabilityPoolLQTYReward;\r\n        const totalLQTYIssued = _utils_1.decimalify(await communityIssuance.totalLQTYIssued({ ...overrides }));\r\n        // totalLQTYIssued approaches but never reaches issuanceCap\r\n        return issuanceCap.sub(totalLQTYIssued);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDInStabilityPool} */\r\n    getLUSDInStabilityPool(overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return stabilityPool.getTotalLUSDDeposits({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDBalance} */\r\n    getLUSDBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lusdToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYBalance} */\r\n    getLQTYBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lqtyToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lqtyToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenBalance} */\r\n    getUniTokenBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { uniToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return uniToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenAllowance} */\r\n    getUniTokenAllowance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { uniToken, unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return uniToken.allowance(address, unipool.address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** @internal */\r\n    async _getRemainingLiquidityMiningLQTYRewardCalculator(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [totalSupply, rewardRate, periodFinish, lastUpdateTime] = await Promise.all([\r\n            unipool.totalSupply({ ...overrides }),\r\n            unipool.rewardRate({ ...overrides }).then(_utils_1.decimalify),\r\n            unipool.periodFinish({ ...overrides }).then(_utils_1.numberify),\r\n            unipool.lastUpdateTime({ ...overrides }).then(_utils_1.numberify)\r\n        ]);\r\n        return (blockTimestamp) => rewardRate.mul(Math.max(0, periodFinish - (totalSupply.isZero() ? lastUpdateTime : blockTimestamp)));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingLiquidityMiningLQTYReward} */\r\n    async getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        const [calculateRemainingLQTY, blockTimestamp] = await Promise.all([\r\n            this._getRemainingLiquidityMiningLQTYRewardCalculator(overrides),\r\n            this._getBlockTimestamp(overrides === null || overrides === void 0 ? void 0 : overrides.blockTag)\r\n        ]);\r\n        return calculateRemainingLQTY(blockTimestamp);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningStake} */\r\n    getLiquidityMiningStake(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedUniTokens} */\r\n    getTotalStakedUniTokens(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.totalSupply({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningLQTYReward} */\r\n    getLiquidityMiningLQTYReward(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.earned(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getCollateralSurplusBalance} */\r\n    getCollateralSurplusBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { collSurplusPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return collSurplusPool.getCollateral(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    async getTroves(params, overrides) {\r\n        var _a, _b;\r\n        const { multiTroveGetter } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        expectPositiveInt(params, \"first\");\r\n        expectPositiveInt(params, \"startingAt\");\r\n        if (!validSortingOptions.includes(params.sortedBy)) {\r\n            throw new Error(`sortedBy must be one of: ${validSortingOptions.map(x => `\"${x}\"`).join(\", \")}`);\r\n        }\r\n        const [totalRedistributed, backendTroves] = await Promise.all([\r\n            params.beforeRedistribution ? undefined : this.getTotalRedistributed({ ...overrides }),\r\n            multiTroveGetter.getMultipleSortedTroves(params.sortedBy === \"descendingCollateralRatio\"\r\n                ? (_a = params.startingAt) !== null && _a !== void 0 ? _a : 0 : -(((_b = params.startingAt) !== null && _b !== void 0 ? _b : 0) + 1), params.first, { ...overrides })\r\n        ]);\r\n        const troves = mapBackendTroves(backendTroves);\r\n        if (totalRedistributed) {\r\n            return troves.map(trove => trove.applyRedistribution(totalRedistributed));\r\n        }\r\n        else {\r\n            return troves;\r\n        }\r\n    }\r\n    /** @internal */\r\n    _getBlockTimestamp(blockTag) {\r\n        return EthersLiquityConnection_1._getBlockTimestamp(this.connection, blockTag);\r\n    }\r\n    /** @internal */\r\n    async _getFeesFactory(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [lastFeeOperationTime, baseRateWithoutDecay] = await Promise.all([\r\n            troveManager.lastFeeOperationTime({ ...overrides }),\r\n            troveManager.baseRate({ ...overrides }).then(_utils_1.decimalify)\r\n        ]);\r\n        return (blockTimestamp, recoveryMode) => new lib_base_1.Fees(baseRateWithoutDecay, MINUTE_DECAY_FACTOR, BETA, convertToDate(lastFeeOperationTime.toNumber()), convertToDate(blockTimestamp), recoveryMode);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFees} */\r\n    async getFees(overrides) {\r\n        const [createFees, total, price, blockTimestamp] = await Promise.all([\r\n            this._getFeesFactory(overrides),\r\n            this.getTotal(overrides),\r\n            this.getPrice(overrides),\r\n            this._getBlockTimestamp(overrides === null || overrides === void 0 ? void 0 : overrides.blockTag)\r\n        ]);\r\n        return createFees(blockTimestamp, total.collateralRatioIsBelowCritical(price));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYStake} */\r\n    async getLQTYStake(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [stakedLQTY, collateralGain, lusdGain] = await Promise.all([\r\n            lqtyStaking.stakes(address, { ...overrides }),\r\n            lqtyStaking.getPendingETHGain(address, { ...overrides }),\r\n            lqtyStaking.getPendingLUSDGain(address, { ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.LQTYStake(stakedLQTY, collateralGain, lusdGain);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedLQTY} */\r\n    async getTotalStakedLQTY(overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lqtyStaking.totalLQTYStaked({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFrontendStatus} */\r\n    async getFrontendStatus(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireFrontendAddress(this.connection));\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const { registered, kickbackRate } = await stabilityPool.frontEnds(address, { ...overrides });\r\n        return registered\r\n            ? { status: \"registered\", kickbackRate: _utils_1.decimalify(kickbackRate) }\r\n            : { status: \"unregistered\" };\r\n    }\r\n}\r\nexports.ReadableEthersLiquity = ReadableEthersLiquity;\r\nconst mapBackendTroves = (troves) => troves.map(trove => new lib_base_1.TroveWithPendingRedistribution(trove.owner, \"open\", // These Troves are coming from the SortedTroves list, so they must be open\r\n_utils_1.decimalify(trove.coll), _utils_1.decimalify(trove.debt), _utils_1.decimalify(trove.stake), new lib_base_1.Trove(_utils_1.decimalify(trove.snapshotETH), _utils_1.decimalify(trove.snapshotLUSDDebt))));\r\nclass _BlockPolledReadableEthersLiquity {\r\n    constructor(readable) {\r\n        const store = new BlockPolledLiquityStore_1.BlockPolledLiquityStore(readable);\r\n        this.store = store;\r\n        this.connection = readable.connection;\r\n        this._readable = readable;\r\n    }\r\n    _blockHit(overrides) {\r\n        return (!overrides ||\r\n            overrides.blockTag === undefined ||\r\n            overrides.blockTag === this.store.state.blockTag);\r\n    }\r\n    _userHit(address, overrides) {\r\n        return (this._blockHit(overrides) &&\r\n            (address === undefined || address === this.store.connection.userAddress));\r\n    }\r\n    _frontendHit(address, overrides) {\r\n        return (this._blockHit(overrides) &&\r\n            (address === undefined || address === this.store.connection.frontendTag));\r\n    }\r\n    hasStore(store) {\r\n        return store === undefined || store === \"blockPolled\";\r\n    }\r\n    async getTotalRedistributed(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalRedistributed\r\n            : this._readable.getTotalRedistributed(overrides);\r\n    }\r\n    async getTroveBeforeRedistribution(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.troveBeforeRedistribution\r\n            : this._readable.getTroveBeforeRedistribution(address, overrides);\r\n    }\r\n    async getTrove(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.trove\r\n            : this._readable.getTrove(address, overrides);\r\n    }\r\n    async getNumberOfTroves(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.numberOfTroves\r\n            : this._readable.getNumberOfTroves(overrides);\r\n    }\r\n    async getPrice(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.price : this._readable.getPrice(overrides);\r\n    }\r\n    async getTotal(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.total : this._readable.getTotal(overrides);\r\n    }\r\n    async getStabilityDeposit(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.stabilityDeposit\r\n            : this._readable.getStabilityDeposit(address, overrides);\r\n    }\r\n    async getRemainingStabilityPoolLQTYReward(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.remainingStabilityPoolLQTYReward\r\n            : this._readable.getRemainingStabilityPoolLQTYReward(overrides);\r\n    }\r\n    async getLUSDInStabilityPool(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.lusdInStabilityPool\r\n            : this._readable.getLUSDInStabilityPool(overrides);\r\n    }\r\n    async getLUSDBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lusdBalance\r\n            : this._readable.getLUSDBalance(address, overrides);\r\n    }\r\n    async getLQTYBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lqtyBalance\r\n            : this._readable.getLQTYBalance(address, overrides);\r\n    }\r\n    async getUniTokenBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.uniTokenBalance\r\n            : this._readable.getUniTokenBalance(address, overrides);\r\n    }\r\n    async getUniTokenAllowance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.uniTokenAllowance\r\n            : this._readable.getUniTokenAllowance(address, overrides);\r\n    }\r\n    async getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.remainingLiquidityMiningLQTYReward\r\n            : this._readable.getRemainingLiquidityMiningLQTYReward(overrides);\r\n    }\r\n    async getLiquidityMiningStake(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.liquidityMiningStake\r\n            : this._readable.getLiquidityMiningStake(address, overrides);\r\n    }\r\n    async getTotalStakedUniTokens(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalStakedUniTokens\r\n            : this._readable.getTotalStakedUniTokens(overrides);\r\n    }\r\n    async getLiquidityMiningLQTYReward(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.liquidityMiningLQTYReward\r\n            : this._readable.getLiquidityMiningLQTYReward(address, overrides);\r\n    }\r\n    async getCollateralSurplusBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.collateralSurplusBalance\r\n            : this._readable.getCollateralSurplusBalance(address, overrides);\r\n    }\r\n    async _getBlockTimestamp(blockTag) {\r\n        return this._blockHit({ blockTag })\r\n            ? this.store.state.blockTimestamp\r\n            : this._readable._getBlockTimestamp(blockTag);\r\n    }\r\n    async _getFeesFactory(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state._feesFactory\r\n            : this._readable._getFeesFactory(overrides);\r\n    }\r\n    async getFees(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.fees : this._readable.getFees(overrides);\r\n    }\r\n    async getLQTYStake(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lqtyStake\r\n            : this._readable.getLQTYStake(address, overrides);\r\n    }\r\n    async getTotalStakedLQTY(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalStakedLQTY\r\n            : this._readable.getTotalStakedLQTY(overrides);\r\n    }\r\n    async getFrontendStatus(address, overrides) {\r\n        return this._frontendHit(address, overrides)\r\n            ? this.store.state.frontend\r\n            : this._readable.getFrontendStatus(address, overrides);\r\n    }\r\n    getTroves(params, overrides) {\r\n        return this._readable.getTroves(params, overrides);\r\n    }\r\n    _getActivePool() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    _getDefaultPool() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    _getRemainingLiquidityMiningLQTYRewardCalculator() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n}\r\n//# sourceMappingURL=ReadableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BlockPolledLiquityStore = void 0;\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\n/**\r\n * Ethers-based {@link @liquity/lib-base#LiquityStore} that updates state whenever there's a new\r\n * block.\r\n *\r\n * @public\r\n */\r\nclass BlockPolledLiquityStore extends lib_base_1.LiquityStore {\r\n    constructor(readable) {\r\n        super();\r\n        this.connection = readable.connection;\r\n        this._readable = readable;\r\n        this._provider = EthersLiquityConnection_1._getProvider(readable.connection);\r\n    }\r\n    async _getRiskiestTroveBeforeRedistribution(overrides) {\r\n        const riskiestTroves = await this._readable.getTroves({ first: 1, sortedBy: \"ascendingCollateralRatio\", beforeRedistribution: true }, overrides);\r\n        if (riskiestTroves.length === 0) {\r\n            return new lib_base_1.TroveWithPendingRedistribution(constants_1.AddressZero, \"nonExistent\");\r\n        }\r\n        return riskiestTroves[0];\r\n    }\r\n    async _get(blockTag) {\r\n        const { userAddress, frontendTag } = this.connection;\r\n        const { blockTimestamp, _feesFactory, calculateRemainingLQTY, ...baseState } = await _utils_1.promiseAllValues({\r\n            blockTimestamp: this._readable._getBlockTimestamp(blockTag),\r\n            _feesFactory: this._readable._getFeesFactory({ blockTag }),\r\n            calculateRemainingLQTY: this._readable._getRemainingLiquidityMiningLQTYRewardCalculator({\r\n                blockTag\r\n            }),\r\n            price: this._readable.getPrice({ blockTag }),\r\n            numberOfTroves: this._readable.getNumberOfTroves({ blockTag }),\r\n            totalRedistributed: this._readable.getTotalRedistributed({ blockTag }),\r\n            total: this._readable.getTotal({ blockTag }),\r\n            lusdInStabilityPool: this._readable.getLUSDInStabilityPool({ blockTag }),\r\n            totalStakedLQTY: this._readable.getTotalStakedLQTY({ blockTag }),\r\n            _riskiestTroveBeforeRedistribution: this._getRiskiestTroveBeforeRedistribution({ blockTag }),\r\n            totalStakedUniTokens: this._readable.getTotalStakedUniTokens({ blockTag }),\r\n            remainingStabilityPoolLQTYReward: this._readable.getRemainingStabilityPoolLQTYReward({\r\n                blockTag\r\n            }),\r\n            frontend: frontendTag\r\n                ? this._readable.getFrontendStatus(frontendTag, { blockTag })\r\n                : { status: \"unregistered\" },\r\n            ...(userAddress\r\n                ? {\r\n                    accountBalance: this._provider.getBalance(userAddress, blockTag).then(_utils_1.decimalify),\r\n                    lusdBalance: this._readable.getLUSDBalance(userAddress, { blockTag }),\r\n                    lqtyBalance: this._readable.getLQTYBalance(userAddress, { blockTag }),\r\n                    uniTokenBalance: this._readable.getUniTokenBalance(userAddress, { blockTag }),\r\n                    uniTokenAllowance: this._readable.getUniTokenAllowance(userAddress, { blockTag }),\r\n                    liquidityMiningStake: this._readable.getLiquidityMiningStake(userAddress, { blockTag }),\r\n                    liquidityMiningLQTYReward: this._readable.getLiquidityMiningLQTYReward(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    collateralSurplusBalance: this._readable.getCollateralSurplusBalance(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    troveBeforeRedistribution: this._readable.getTroveBeforeRedistribution(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    stabilityDeposit: this._readable.getStabilityDeposit(userAddress, { blockTag }),\r\n                    lqtyStake: this._readable.getLQTYStake(userAddress, { blockTag }),\r\n                    ownFrontend: this._readable.getFrontendStatus(userAddress, { blockTag })\r\n                }\r\n                : {\r\n                    accountBalance: lib_base_1.Decimal.ZERO,\r\n                    lusdBalance: lib_base_1.Decimal.ZERO,\r\n                    lqtyBalance: lib_base_1.Decimal.ZERO,\r\n                    uniTokenBalance: lib_base_1.Decimal.ZERO,\r\n                    uniTokenAllowance: lib_base_1.Decimal.ZERO,\r\n                    liquidityMiningStake: lib_base_1.Decimal.ZERO,\r\n                    liquidityMiningLQTYReward: lib_base_1.Decimal.ZERO,\r\n                    collateralSurplusBalance: lib_base_1.Decimal.ZERO,\r\n                    troveBeforeRedistribution: new lib_base_1.TroveWithPendingRedistribution(constants_1.AddressZero, \"nonExistent\"),\r\n                    stabilityDeposit: new lib_base_1.StabilityDeposit(lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, constants_1.AddressZero),\r\n                    lqtyStake: new lib_base_1.LQTYStake(),\r\n                    ownFrontend: { status: \"unregistered\" }\r\n                })\r\n        });\r\n        return [\r\n            {\r\n                ...baseState,\r\n                _feesInNormalMode: _feesFactory(blockTimestamp, false),\r\n                remainingLiquidityMiningLQTYReward: calculateRemainingLQTY(blockTimestamp)\r\n            },\r\n            {\r\n                blockTag,\r\n                blockTimestamp,\r\n                _feesFactory\r\n            }\r\n        ];\r\n    }\r\n    /** @internal @override */\r\n    _doStart() {\r\n        this._get().then(state => {\r\n            if (!this._loaded) {\r\n                this._load(...state);\r\n            }\r\n        });\r\n        const blockListener = async (blockTag) => {\r\n            const state = await this._get(blockTag);\r\n            if (this._loaded) {\r\n                this._update(...state);\r\n            }\r\n            else {\r\n                this._load(...state);\r\n            }\r\n        };\r\n        this._provider.on(\"block\", blockListener);\r\n        return () => {\r\n            this._provider.off(\"block\", blockListener);\r\n        };\r\n    }\r\n    /** @internal @override */\r\n    _reduceExtra(oldState, stateUpdate) {\r\n        var _a, _b, _c;\r\n        return {\r\n            blockTag: (_a = stateUpdate.blockTag) !== null && _a !== void 0 ? _a : oldState.blockTag,\r\n            blockTimestamp: (_b = stateUpdate.blockTimestamp) !== null && _b !== void 0 ? _b : oldState.blockTimestamp,\r\n            _feesFactory: (_c = stateUpdate._feesFactory) !== null && _c !== void 0 ? _c : oldState._feesFactory\r\n        };\r\n    }\r\n}\r\nexports.BlockPolledLiquityStore = BlockPolledLiquityStore;\r\n//# sourceMappingURL=BlockPolledLiquityStore.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.PopulatableEthersLiquity = exports.PopulatedEthersRedemption = exports.PopulatedEthersLiquityTransaction = exports.SentEthersLiquityTransaction = exports.EthersTransactionCancelledError = exports._RawErrorReason = exports._redeemMaxIterations = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst logger_1 = require(\"@ethersproject/logger\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst contracts_1 = require(\"./contracts\");\r\nconst parseLogs_1 = require(\"./parseLogs\");\r\nconst bigNumberMax = (a, b) => ((b === null || b === void 0 ? void 0 : b.gt(a)) ? b : a);\r\n// With 70 iterations redemption costs about ~10M gas, and each iteration accounts for ~138k more\r\n/** @internal */\r\nexports._redeemMaxIterations = 70;\r\nconst defaultBorrowingRateSlippageTolerance = lib_base_1.Decimal.from(0.005); // 0.5%\r\nconst defaultRedemptionRateSlippageTolerance = lib_base_1.Decimal.from(0.001); // 0.1%\r\nconst defaultBorrowingFeeDecayToleranceMinutes = 10;\r\nconst noDetails = () => undefined;\r\nconst compose = (f, g) => (_) => f(g(_));\r\nconst id = (t) => t;\r\n// Takes ~6-7K (use 10K to be safe) to update lastFeeOperationTime, but the cost of calculating the\r\n// decayed baseRate increases logarithmically with time elapsed since the last update.\r\nconst addGasForBaseRateUpdate = (maxMinutesSinceLastUpdate = 10) => (gas) => gas.add(10000 + 1414 * Math.ceil(Math.log2(maxMinutesSinceLastUpdate + 1)));\r\n// First traversal in ascending direction takes ~50K, then ~13.5K per extra step.\r\n// 80K should be enough for 3 steps, plus some extra to be safe.\r\nconst addGasForPotentialListTraversal = (gas) => gas.add(80000);\r\nconst addGasForLQTYIssuance = (gas) => gas.add(50000);\r\nconst addGasForUnipoolRewardUpdate = (gas) => gas.add(20000);\r\n// To get the best entropy available, we'd do something like:\r\n//\r\n// const bigRandomNumber = () =>\r\n//   BigNumber.from(\r\n//     `0x${Array.from(crypto.getRandomValues(new Uint32Array(8)))\r\n//       .map(u32 => u32.toString(16).padStart(8, \"0\"))\r\n//       .join(\"\")}`\r\n//   );\r\n//\r\n// However, Window.crypto is browser-specific. Since we only use this for randomly picking Troves\r\n// during the search for hints, Math.random() will do fine, too.\r\n//\r\n// This returns a random integer between 0 and Number.MAX_SAFE_INTEGER\r\nconst randomInteger = () => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\r\n// Maximum number of trials to perform in a single getApproxHint() call. If the number of trials\r\n// required to get a statistically \"good\" hint is larger than this, the search for the hint will\r\n// be broken up into multiple getApproxHint() calls.\r\n//\r\n// This should be low enough to work with popular public Ethereum providers like Infura without\r\n// triggering any fair use limits.\r\nconst maxNumberOfTrialsAtOnce = 2500;\r\nfunction* generateTrials(totalNumberOfTrials) {\r\n    assert_1.default(Number.isInteger(totalNumberOfTrials) && totalNumberOfTrials > 0);\r\n    while (totalNumberOfTrials) {\r\n        const numberOfTrials = Math.min(totalNumberOfTrials, maxNumberOfTrialsAtOnce);\r\n        yield numberOfTrials;\r\n        totalNumberOfTrials -= numberOfTrials;\r\n    }\r\n}\r\n/** @internal */\r\nvar _RawErrorReason;\r\n(function (_RawErrorReason) {\r\n    _RawErrorReason[\"TRANSACTION_FAILED\"] = \"transaction failed\";\r\n    _RawErrorReason[\"TRANSACTION_CANCELLED\"] = \"cancelled\";\r\n    _RawErrorReason[\"TRANSACTION_REPLACED\"] = \"replaced\";\r\n    _RawErrorReason[\"TRANSACTION_REPRICED\"] = \"repriced\";\r\n})(_RawErrorReason = exports._RawErrorReason || (exports._RawErrorReason = {}));\r\nconst transactionReplacementReasons = [\r\n    _RawErrorReason.TRANSACTION_CANCELLED,\r\n    _RawErrorReason.TRANSACTION_REPLACED,\r\n    _RawErrorReason.TRANSACTION_REPRICED\r\n];\r\nconst hasProp = (o, p) => p in o;\r\nconst isTransactionFailedError = (error) => hasProp(error, \"code\") &&\r\n    error.code === logger_1.ErrorCode.CALL_EXCEPTION &&\r\n    hasProp(error, \"reason\") &&\r\n    error.reason === _RawErrorReason.TRANSACTION_FAILED;\r\nconst isTransactionReplacedError = (error) => hasProp(error, \"code\") &&\r\n    error.code === logger_1.ErrorCode.TRANSACTION_REPLACED &&\r\n    hasProp(error, \"reason\") &&\r\n    transactionReplacementReasons.includes(error.reason);\r\n/**\r\n * Thrown when a transaction is cancelled or replaced by a different transaction.\r\n *\r\n * @public\r\n */\r\nclass EthersTransactionCancelledError extends Error {\r\n    /** @internal */\r\n    constructor(rawError) {\r\n        assert_1.default(rawError.reason !== _RawErrorReason.TRANSACTION_REPRICED);\r\n        super(`Transaction ${rawError.reason}`);\r\n        this.name = \"TransactionCancelledError\";\r\n        this.rawReplacementReceipt = rawError.receipt;\r\n        this.rawError = rawError;\r\n    }\r\n}\r\nexports.EthersTransactionCancelledError = EthersTransactionCancelledError;\r\n/**\r\n * A transaction that has already been sent.\r\n *\r\n * @remarks\r\n * Returned by {@link SendableEthersLiquity} functions.\r\n *\r\n * @public\r\n */\r\nclass SentEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawSentTransaction, connection, parse) {\r\n        this.rawSentTransaction = rawSentTransaction;\r\n        this._connection = connection;\r\n        this._parse = parse;\r\n    }\r\n    _receiptFrom(rawReceipt) {\r\n        return rawReceipt\r\n            ? rawReceipt.status\r\n                ? lib_base_1._successfulReceipt(rawReceipt, this._parse(rawReceipt), () => parseLogs_1.logsToString(rawReceipt, EthersLiquityConnection_1._getContracts(this._connection)))\r\n                : lib_base_1._failedReceipt(rawReceipt)\r\n            : lib_base_1._pendingReceipt;\r\n    }\r\n    async _waitForRawReceipt(confirmations) {\r\n        try {\r\n            return await this.rawSentTransaction.wait(confirmations);\r\n        }\r\n        catch (error) {\r\n            if (error instanceof Error) {\r\n                if (isTransactionFailedError(error)) {\r\n                    return error.receipt;\r\n                }\r\n                if (isTransactionReplacedError(error)) {\r\n                    if (error.cancelled) {\r\n                        throw new EthersTransactionCancelledError(error);\r\n                    }\r\n                    else {\r\n                        return error.receipt;\r\n                    }\r\n                }\r\n            }\r\n            throw error;\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SentLiquityTransaction.getReceipt} */\r\n    async getReceipt() {\r\n        return this._receiptFrom(await this._waitForRawReceipt(0));\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#SentLiquityTransaction.waitForReceipt}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    async waitForReceipt() {\r\n        const receipt = this._receiptFrom(await this._waitForRawReceipt());\r\n        assert_1.default(receipt.status !== \"pending\");\r\n        return receipt;\r\n    }\r\n}\r\nexports.SentEthersLiquityTransaction = SentEthersLiquityTransaction;\r\nconst normalizeBorrowingOperationOptionalParams = (maxBorrowingRateOrOptionalParams, currentBorrowingRate) => {\r\n    var _a, _b;\r\n    if (maxBorrowingRateOrOptionalParams === undefined) {\r\n        return {\r\n            maxBorrowingRate: (_a = currentBorrowingRate === null || currentBorrowingRate === void 0 ? void 0 : currentBorrowingRate.add(defaultBorrowingRateSlippageTolerance)) !== null && _a !== void 0 ? _a : lib_base_1.Decimal.ZERO,\r\n            borrowingFeeDecayToleranceMinutes: defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n    else if (typeof maxBorrowingRateOrOptionalParams === \"number\" ||\r\n        typeof maxBorrowingRateOrOptionalParams === \"string\" ||\r\n        maxBorrowingRateOrOptionalParams instanceof lib_base_1.Decimal) {\r\n        return {\r\n            maxBorrowingRate: lib_base_1.Decimal.from(maxBorrowingRateOrOptionalParams),\r\n            borrowingFeeDecayToleranceMinutes: defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n    else {\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = maxBorrowingRateOrOptionalParams;\r\n        return {\r\n            maxBorrowingRate: maxBorrowingRate !== undefined\r\n                ? lib_base_1.Decimal.from(maxBorrowingRate)\r\n                : (_b = currentBorrowingRate === null || currentBorrowingRate === void 0 ? void 0 : currentBorrowingRate.add(defaultBorrowingRateSlippageTolerance)) !== null && _b !== void 0 ? _b : lib_base_1.Decimal.ZERO,\r\n            borrowingFeeDecayToleranceMinutes: borrowingFeeDecayToleranceMinutes !== null && borrowingFeeDecayToleranceMinutes !== void 0 ? borrowingFeeDecayToleranceMinutes : defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n};\r\n/**\r\n * A transaction that has been prepared for sending.\r\n *\r\n * @remarks\r\n * Returned by {@link PopulatableEthersLiquity} functions.\r\n *\r\n * @public\r\n */\r\nclass PopulatedEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawPopulatedTransaction, connection, parse, gasHeadroom) {\r\n        this.rawPopulatedTransaction = rawPopulatedTransaction;\r\n        this._connection = connection;\r\n        this._parse = parse;\r\n        if (gasHeadroom !== undefined) {\r\n            this.gasHeadroom = gasHeadroom;\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatedLiquityTransaction.send} */\r\n    async send() {\r\n        return new SentEthersLiquityTransaction(await EthersLiquityConnection_1._requireSigner(this._connection).sendTransaction(this.rawPopulatedTransaction), this._connection, this._parse);\r\n    }\r\n}\r\nexports.PopulatedEthersLiquityTransaction = PopulatedEthersLiquityTransaction;\r\n/**\r\n * {@inheritDoc @liquity/lib-base#PopulatedRedemption}\r\n *\r\n * @public\r\n */\r\nclass PopulatedEthersRedemption extends PopulatedEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawPopulatedTransaction, connection, attemptedLUSDAmount, redeemableLUSDAmount, increaseAmountByMinimumNetDebt) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(connection);\r\n        super(rawPopulatedTransaction, connection, ({ logs }) => troveManager\r\n            .extractEvents(logs, \"Redemption\")\r\n            .map(({ args: { _ETHSent, _ETHFee, _actualLUSDAmount, _attemptedLUSDAmount } }) => ({\r\n            attemptedLUSDAmount: _utils_1.decimalify(_attemptedLUSDAmount),\r\n            actualLUSDAmount: _utils_1.decimalify(_actualLUSDAmount),\r\n            collateralTaken: _utils_1.decimalify(_ETHSent),\r\n            fee: _utils_1.decimalify(_ETHFee)\r\n        }))[0]);\r\n        this.attemptedLUSDAmount = attemptedLUSDAmount;\r\n        this.redeemableLUSDAmount = redeemableLUSDAmount;\r\n        this.isTruncated = redeemableLUSDAmount.lt(attemptedLUSDAmount);\r\n        this._increaseAmountByMinimumNetDebt = increaseAmountByMinimumNetDebt;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatedRedemption.increaseAmountByMinimumNetDebt} */\r\n    increaseAmountByMinimumNetDebt(maxRedemptionRate) {\r\n        if (!this._increaseAmountByMinimumNetDebt) {\r\n            throw new Error(\"PopulatedEthersRedemption: increaseAmountByMinimumNetDebt() can \" +\r\n                \"only be called when amount is truncated\");\r\n        }\r\n        return this._increaseAmountByMinimumNetDebt(maxRedemptionRate);\r\n    }\r\n}\r\nexports.PopulatedEthersRedemption = PopulatedEthersRedemption;\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#PopulatableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass PopulatableEthersLiquity {\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n    }\r\n    _wrapSimpleTransaction(rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, noDetails);\r\n    }\r\n    _wrapTroveChangeWithFees(params, rawPopulatedTransaction, gasHeadroom) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const [newTrove] = borrowerOperations\r\n                .extractEvents(logs, \"TroveUpdated\")\r\n                .map(({ args: { _coll, _debt } }) => new lib_base_1.Trove(_utils_1.decimalify(_coll), _utils_1.decimalify(_debt)));\r\n            const [fee] = borrowerOperations\r\n                .extractEvents(logs, \"LUSDBorrowingFeePaid\")\r\n                .map(({ args: { _LUSDFee } }) => _utils_1.decimalify(_LUSDFee));\r\n            return {\r\n                params,\r\n                newTrove,\r\n                fee\r\n            };\r\n        }, gasHeadroom);\r\n    }\r\n    async _wrapTroveClosure(rawPopulatedTransaction) {\r\n        const { activePool, lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs, from: userAddress }) => {\r\n            const [repayLUSD] = lusdToken\r\n                .extractEvents(logs, \"Transfer\")\r\n                .filter(({ args: { from, to } }) => from === userAddress && to === constants_1.AddressZero)\r\n                .map(({ args: { value } }) => _utils_1.decimalify(value));\r\n            const [withdrawCollateral] = activePool\r\n                .extractEvents(logs, \"EtherSent\")\r\n                .filter(({ args: { _to } }) => _to === userAddress)\r\n                .map(({ args: { _amount } }) => _utils_1.decimalify(_amount));\r\n            return {\r\n                params: repayLUSD.nonZero ? { withdrawCollateral, repayLUSD } : { withdrawCollateral }\r\n            };\r\n        });\r\n    }\r\n    _wrapLiquidation(rawPopulatedTransaction) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const liquidatedAddresses = troveManager\r\n                .extractEvents(logs, \"TroveLiquidated\")\r\n                .map(({ args: { _borrower } }) => _borrower);\r\n            const [totals] = troveManager\r\n                .extractEvents(logs, \"Liquidation\")\r\n                .map(({ args: { _LUSDGasCompensation, _collGasCompensation, _liquidatedColl, _liquidatedDebt } }) => ({\r\n                collateralGasCompensation: _utils_1.decimalify(_collGasCompensation),\r\n                lusdGasCompensation: _utils_1.decimalify(_LUSDGasCompensation),\r\n                totalLiquidated: new lib_base_1.Trove(_utils_1.decimalify(_liquidatedColl), _utils_1.decimalify(_liquidatedDebt))\r\n            }));\r\n            return {\r\n                liquidatedAddresses,\r\n                ...totals\r\n            };\r\n        });\r\n    }\r\n    _extractStabilityPoolGainsWithdrawalDetails(logs) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const [newLUSDDeposit] = stabilityPool\r\n            .extractEvents(logs, \"UserDepositChanged\")\r\n            .map(({ args: { _newDeposit } }) => _utils_1.decimalify(_newDeposit));\r\n        const [[collateralGain, lusdLoss]] = stabilityPool\r\n            .extractEvents(logs, \"ETHGainWithdrawn\")\r\n            .map(({ args: { _ETH, _LUSDLoss } }) => [_utils_1.decimalify(_ETH), _utils_1.decimalify(_LUSDLoss)]);\r\n        const [lqtyReward] = stabilityPool\r\n            .extractEvents(logs, \"LQTYPaidToDepositor\")\r\n            .map(({ args: { _LQTY } }) => _utils_1.decimalify(_LQTY));\r\n        return {\r\n            lusdLoss,\r\n            newLUSDDeposit,\r\n            collateralGain,\r\n            lqtyReward\r\n        };\r\n    }\r\n    _wrapStabilityPoolGainsWithdrawal(rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => this._extractStabilityPoolGainsWithdrawalDetails(logs));\r\n    }\r\n    _wrapStabilityDepositTopup(change, rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => ({\r\n            ...this._extractStabilityPoolGainsWithdrawalDetails(logs),\r\n            change\r\n        }));\r\n    }\r\n    async _wrapStabilityDepositWithdrawal(rawPopulatedTransaction) {\r\n        const { stabilityPool, lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs, from: userAddress }) => {\r\n            const gainsWithdrawalDetails = this._extractStabilityPoolGainsWithdrawalDetails(logs);\r\n            const [withdrawLUSD] = lusdToken\r\n                .extractEvents(logs, \"Transfer\")\r\n                .filter(({ args: { from, to } }) => from === stabilityPool.address && to === userAddress)\r\n                .map(({ args: { value } }) => _utils_1.decimalify(value));\r\n            return {\r\n                ...gainsWithdrawalDetails,\r\n                change: { withdrawLUSD, withdrawAllLUSD: gainsWithdrawalDetails.newLUSDDeposit.isZero }\r\n            };\r\n        });\r\n    }\r\n    _wrapCollateralGainTransfer(rawPopulatedTransaction) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const [newTrove] = borrowerOperations\r\n                .extractEvents(logs, \"TroveUpdated\")\r\n                .map(({ args: { _coll, _debt } }) => new lib_base_1.Trove(_utils_1.decimalify(_coll), _utils_1.decimalify(_debt)));\r\n            return {\r\n                ...this._extractStabilityPoolGainsWithdrawalDetails(logs),\r\n                newTrove\r\n            };\r\n        });\r\n    }\r\n    async _findHintsForNominalCollateralRatio(nominalCollateralRatio, ownAddress) {\r\n        const { sortedTroves, hintHelpers } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const numberOfTroves = await this._readable.getNumberOfTroves();\r\n        if (!numberOfTroves) {\r\n            return [constants_1.AddressZero, constants_1.AddressZero];\r\n        }\r\n        if (nominalCollateralRatio.infinite) {\r\n            return [constants_1.AddressZero, await sortedTroves.getFirst()];\r\n        }\r\n        const totalNumberOfTrials = Math.ceil(10 * Math.sqrt(numberOfTroves));\r\n        const [firstTrials, ...restOfTrials] = generateTrials(totalNumberOfTrials);\r\n        const collectApproxHint = ({ latestRandomSeed, results }, numberOfTrials) => hintHelpers\r\n            .getApproxHint(nominalCollateralRatio.hex, numberOfTrials, latestRandomSeed)\r\n            .then(({ latestRandomSeed, ...result }) => ({\r\n            latestRandomSeed,\r\n            results: [...results, result]\r\n        }));\r\n        const { results } = await restOfTrials.reduce((p, numberOfTrials) => p.then(state => collectApproxHint(state, numberOfTrials)), collectApproxHint({ latestRandomSeed: randomInteger(), results: [] }, firstTrials));\r\n        const { hintAddress } = results.reduce((a, b) => (a.diff.lt(b.diff) ? a : b));\r\n        let [prev, next] = await sortedTroves.findInsertPosition(nominalCollateralRatio.hex, hintAddress, hintAddress);\r\n        if (ownAddress) {\r\n            // In the case of reinsertion, the address of the Trove being reinserted is not a usable hint,\r\n            // because it is deleted from the list before the reinsertion.\r\n            // \"Jump over\" the Trove to get the proper hint.\r\n            if (prev === ownAddress) {\r\n                prev = await sortedTroves.getPrev(prev);\r\n            }\r\n            else if (next === ownAddress) {\r\n                next = await sortedTroves.getNext(next);\r\n            }\r\n        }\r\n        // Don't use `address(0)` as hint as it can result in huge gas cost.\r\n        // (See https://github.com/liquity/dev/issues/600).\r\n        if (prev === constants_1.AddressZero) {\r\n            prev = next;\r\n        }\r\n        else if (next === constants_1.AddressZero) {\r\n            next = prev;\r\n        }\r\n        return [prev, next];\r\n    }\r\n    async _findHints(trove, ownAddress) {\r\n        if (trove instanceof lib_base_1.TroveWithPendingRedistribution) {\r\n            throw new Error(\"Rewards must be applied to this Trove\");\r\n        }\r\n        return this._findHintsForNominalCollateralRatio(trove._nominalCollateralRatio, ownAddress);\r\n    }\r\n    async _findRedemptionHints(amount) {\r\n        const { hintHelpers } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const price = await this._readable.getPrice();\r\n        const { firstRedemptionHint, partialRedemptionHintNICR, truncatedLUSDamount } = await hintHelpers.getRedemptionHints(amount.hex, price.hex, exports._redeemMaxIterations);\r\n        const [partialRedemptionUpperHint, partialRedemptionLowerHint] = partialRedemptionHintNICR.isZero()\r\n            ? [constants_1.AddressZero, constants_1.AddressZero]\r\n            : await this._findHintsForNominalCollateralRatio(_utils_1.decimalify(partialRedemptionHintNICR)\r\n            // XXX: if we knew the partially redeemed Trove's address, we'd pass it here\r\n            );\r\n        return [\r\n            _utils_1.decimalify(truncatedLUSDamount),\r\n            firstRedemptionHint,\r\n            partialRedemptionUpperHint,\r\n            partialRedemptionLowerHint,\r\n            partialRedemptionHintNICR\r\n        ];\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.openTrove} */\r\n    async openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const normalizedParams = lib_base_1._normalizeTroveCreation(params);\r\n        const { depositCollateral, borrowLUSD } = normalizedParams;\r\n        const [fees, blockTimestamp, total, price] = await Promise.all([\r\n            this._readable._getFeesFactory(),\r\n            this._readable._getBlockTimestamp(),\r\n            this._readable.getTotal(),\r\n            this._readable.getPrice()\r\n        ]);\r\n        const recoveryMode = total.collateralRatioIsBelowCritical(price);\r\n        const decayBorrowingRate = (seconds) => fees(blockTimestamp + seconds, recoveryMode).borrowingRate();\r\n        const currentBorrowingRate = decayBorrowingRate(0);\r\n        const newTrove = lib_base_1.Trove.create(normalizedParams, currentBorrowingRate);\r\n        const hints = await this._findHints(newTrove);\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = normalizeBorrowingOperationOptionalParams(maxBorrowingRateOrOptionalParams, currentBorrowingRate);\r\n        const txParams = (borrowLUSD) => [\r\n            maxBorrowingRate.hex,\r\n            borrowLUSD.hex,\r\n            ...hints,\r\n            { value: depositCollateral.hex, ...overrides }\r\n        ];\r\n        let gasHeadroom;\r\n        if ((overrides === null || overrides === void 0 ? void 0 : overrides.gasLimit) === undefined) {\r\n            const decayedBorrowingRate = decayBorrowingRate(60 * borrowingFeeDecayToleranceMinutes);\r\n            const decayedTrove = lib_base_1.Trove.create(normalizedParams, decayedBorrowingRate);\r\n            const { borrowLUSD: borrowLUSDSimulatingDecay } = lib_base_1.Trove.recreate(decayedTrove, currentBorrowingRate);\r\n            if (decayedTrove.debt.lt(lib_base_1.LUSD_MINIMUM_DEBT)) {\r\n                throw new Error(`Trove's debt might fall below ${lib_base_1.LUSD_MINIMUM_DEBT} ` +\r\n                    `within ${borrowingFeeDecayToleranceMinutes} minutes`);\r\n            }\r\n            const [gasNow, gasLater] = await Promise.all([\r\n                borrowerOperations.estimateGas.openTrove(...txParams(borrowLUSD)),\r\n                borrowerOperations.estimateGas.openTrove(...txParams(borrowLUSDSimulatingDecay))\r\n            ]);\r\n            const gasLimit = addGasForBaseRateUpdate(borrowingFeeDecayToleranceMinutes)(bigNumberMax(addGasForPotentialListTraversal(gasNow), gasLater));\r\n            gasHeadroom = gasLimit.sub(gasNow).toNumber();\r\n            overrides = { ...overrides, gasLimit };\r\n        }\r\n        return this._wrapTroveChangeWithFees(normalizedParams, await borrowerOperations.populateTransaction.openTrove(...txParams(borrowLUSD)), gasHeadroom);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.closeTrove} */\r\n    async closeTrove(overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapTroveClosure(await borrowerOperations.estimateAndPopulate.closeTrove({ ...overrides }, id));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.depositCollateral} */\r\n    depositCollateral(amount, overrides) {\r\n        return this.adjustTrove({ depositCollateral: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawCollateral} */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this.adjustTrove({ withdrawCollateral: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.borrowLUSD} */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this.adjustTrove({ borrowLUSD: amount }, maxBorrowingRate, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.repayLUSD} */\r\n    repayLUSD(amount, overrides) {\r\n        return this.adjustTrove({ repayLUSD: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.adjustTrove} */\r\n    async adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        const address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides);\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const normalizedParams = lib_base_1._normalizeTroveAdjustment(params);\r\n        const { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD } = normalizedParams;\r\n        const [trove, feeVars] = await Promise.all([\r\n            this._readable.getTrove(address),\r\n            borrowLUSD &&\r\n                _utils_1.promiseAllValues({\r\n                    fees: this._readable._getFeesFactory(),\r\n                    blockTimestamp: this._readable._getBlockTimestamp(),\r\n                    total: this._readable.getTotal(),\r\n                    price: this._readable.getPrice()\r\n                })\r\n        ]);\r\n        const decayBorrowingRate = (seconds) => feeVars === null || feeVars === void 0 ? void 0 : feeVars.fees(feeVars.blockTimestamp + seconds, feeVars.total.collateralRatioIsBelowCritical(feeVars.price)).borrowingRate();\r\n        const currentBorrowingRate = decayBorrowingRate(0);\r\n        const adjustedTrove = trove.adjust(normalizedParams, currentBorrowingRate);\r\n        const hints = await this._findHints(adjustedTrove, address);\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = normalizeBorrowingOperationOptionalParams(maxBorrowingRateOrOptionalParams, currentBorrowingRate);\r\n        const txParams = (borrowLUSD) => {\r\n            var _a;\r\n            return [\r\n                maxBorrowingRate.hex,\r\n                (withdrawCollateral !== null && withdrawCollateral !== void 0 ? withdrawCollateral : lib_base_1.Decimal.ZERO).hex,\r\n                ((_a = borrowLUSD !== null && borrowLUSD !== void 0 ? borrowLUSD : repayLUSD) !== null && _a !== void 0 ? _a : lib_base_1.Decimal.ZERO).hex,\r\n                !!borrowLUSD,\r\n                ...hints,\r\n                { value: depositCollateral === null || depositCollateral === void 0 ? void 0 : depositCollateral.hex, ...overrides }\r\n            ];\r\n        };\r\n        let gasHeadroom;\r\n        if ((overrides === null || overrides === void 0 ? void 0 : overrides.gasLimit) === undefined) {\r\n            const decayedBorrowingRate = decayBorrowingRate(60 * borrowingFeeDecayToleranceMinutes);\r\n            const decayedTrove = trove.adjust(normalizedParams, decayedBorrowingRate);\r\n            const { borrowLUSD: borrowLUSDSimulatingDecay } = trove.adjustTo(decayedTrove, currentBorrowingRate);\r\n            if (decayedTrove.debt.lt(lib_base_1.LUSD_MINIMUM_DEBT)) {\r\n                throw new Error(`Trove's debt might fall below ${lib_base_1.LUSD_MINIMUM_DEBT} ` +\r\n                    `within ${borrowingFeeDecayToleranceMinutes} minutes`);\r\n            }\r\n            const [gasNow, gasLater] = await Promise.all([\r\n                borrowerOperations.estimateGas.adjustTrove(...txParams(borrowLUSD)),\r\n                borrowLUSD &&\r\n                    borrowerOperations.estimateGas.adjustTrove(...txParams(borrowLUSDSimulatingDecay))\r\n            ]);\r\n            let gasLimit = bigNumberMax(addGasForPotentialListTraversal(gasNow), gasLater);\r\n            if (borrowLUSD) {\r\n                gasLimit = addGasForBaseRateUpdate(borrowingFeeDecayToleranceMinutes)(gasLimit);\r\n            }\r\n            gasHeadroom = gasLimit.sub(gasNow).toNumber();\r\n            overrides = { ...overrides, gasLimit };\r\n        }\r\n        return this._wrapTroveChangeWithFees(normalizedParams, await borrowerOperations.populateTransaction.adjustTrove(...txParams(borrowLUSD)), gasHeadroom);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.claimCollateralSurplus} */\r\n    async claimCollateralSurplus(overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await borrowerOperations.estimateAndPopulate.claimCollateral({ ...overrides }, id));\r\n    }\r\n    /** @internal */\r\n    async setPrice(price, overrides) {\r\n        const { priceFeed } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (!contracts_1._priceFeedIsTestnet(priceFeed)) {\r\n            throw new Error(\"setPrice() unavailable on this deployment of Liquity\");\r\n        }\r\n        return this._wrapSimpleTransaction(await priceFeed.estimateAndPopulate.setPrice({ ...overrides }, id, lib_base_1.Decimal.from(price).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.liquidate} */\r\n    async liquidate(address, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (Array.isArray(address)) {\r\n            return this._wrapLiquidation(await troveManager.estimateAndPopulate.batchLiquidateTroves({ ...overrides }, addGasForLQTYIssuance, address));\r\n        }\r\n        else {\r\n            return this._wrapLiquidation(await troveManager.estimateAndPopulate.liquidate({ ...overrides }, addGasForLQTYIssuance, address));\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.liquidateUpTo} */\r\n    async liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapLiquidation(await troveManager.estimateAndPopulate.liquidateTroves({ ...overrides }, addGasForLQTYIssuance, maximumNumberOfTrovesToLiquidate));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.depositLUSDInStabilityPool} */\r\n    async depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        var _a;\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const depositLUSD = lib_base_1.Decimal.from(amount);\r\n        return this._wrapStabilityDepositTopup({ depositLUSD }, await stabilityPool.estimateAndPopulate.provideToSP({ ...overrides }, addGasForLQTYIssuance, depositLUSD.hex, (_a = frontendTag !== null && frontendTag !== void 0 ? frontendTag : this._readable.connection.frontendTag) !== null && _a !== void 0 ? _a : constants_1.AddressZero));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawLUSDFromStabilityPool} */\r\n    async withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapStabilityDepositWithdrawal(await stabilityPool.estimateAndPopulate.withdrawFromSP({ ...overrides }, addGasForLQTYIssuance, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawGainsFromStabilityPool} */\r\n    async withdrawGainsFromStabilityPool(overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapStabilityPoolGainsWithdrawal(await stabilityPool.estimateAndPopulate.withdrawFromSP({ ...overrides }, addGasForLQTYIssuance, lib_base_1.Decimal.ZERO.hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.transferCollateralGainToTrove} */\r\n    async transferCollateralGainToTrove(overrides) {\r\n        const address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides);\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const [initialTrove, stabilityDeposit] = await Promise.all([\r\n            this._readable.getTrove(address),\r\n            this._readable.getStabilityDeposit(address)\r\n        ]);\r\n        const finalTrove = initialTrove.addCollateral(stabilityDeposit.collateralGain);\r\n        return this._wrapCollateralGainTransfer(await stabilityPool.estimateAndPopulate.withdrawETHGainToTrove({ ...overrides }, compose(addGasForPotentialListTraversal, addGasForLQTYIssuance), ...(await this._findHints(finalTrove, address))));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.sendLUSD} */\r\n    async sendLUSD(toAddress, amount, overrides) {\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lusdToken.estimateAndPopulate.transfer({ ...overrides }, id, toAddress, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.sendLQTY} */\r\n    async sendLQTY(toAddress, amount, overrides) {\r\n        const { lqtyToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyToken.estimateAndPopulate.transfer({ ...overrides }, id, toAddress, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.redeemLUSD} */\r\n    async redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const attemptedLUSDAmount = lib_base_1.Decimal.from(amount);\r\n        const [fees, total, [truncatedAmount, firstRedemptionHint, ...partialHints]] = await Promise.all([\r\n            this._readable.getFees(),\r\n            this._readable.getTotal(),\r\n            this._findRedemptionHints(attemptedLUSDAmount)\r\n        ]);\r\n        if (truncatedAmount.isZero) {\r\n            throw new Error(`redeemLUSD: amount too low to redeem (try at least ${lib_base_1.LUSD_MINIMUM_NET_DEBT})`);\r\n        }\r\n        const defaultMaxRedemptionRate = (amount) => lib_base_1.Decimal.min(fees.redemptionRate(amount.div(total.debt)).add(defaultRedemptionRateSlippageTolerance), lib_base_1.Decimal.ONE);\r\n        const populateRedemption = async (attemptedLUSDAmount, maxRedemptionRate, truncatedAmount = attemptedLUSDAmount, partialHints = [constants_1.AddressZero, constants_1.AddressZero, 0]) => {\r\n            const maxRedemptionRateOrDefault = maxRedemptionRate !== undefined\r\n                ? lib_base_1.Decimal.from(maxRedemptionRate)\r\n                : defaultMaxRedemptionRate(truncatedAmount);\r\n            return new PopulatedEthersRedemption(await troveManager.estimateAndPopulate.redeemCollateral({ ...overrides }, addGasForBaseRateUpdate(), truncatedAmount.hex, firstRedemptionHint, ...partialHints, exports._redeemMaxIterations, maxRedemptionRateOrDefault.hex), this._readable.connection, attemptedLUSDAmount, truncatedAmount, truncatedAmount.lt(attemptedLUSDAmount)\r\n                ? newMaxRedemptionRate => populateRedemption(truncatedAmount.add(lib_base_1.LUSD_MINIMUM_NET_DEBT), newMaxRedemptionRate !== null && newMaxRedemptionRate !== void 0 ? newMaxRedemptionRate : maxRedemptionRate)\r\n                : undefined);\r\n        };\r\n        return populateRedemption(attemptedLUSDAmount, maxRedemptionRate, truncatedAmount, partialHints);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.stakeLQTY} */\r\n    async stakeLQTY(amount, overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyStaking.estimateAndPopulate.stake({ ...overrides }, id, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.unstakeLQTY} */\r\n    async unstakeLQTY(amount, overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyStaking.estimateAndPopulate.unstake({ ...overrides }, id, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawGainsFromStaking} */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this.unstakeLQTY(lib_base_1.Decimal.ZERO, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.registerFrontend} */\r\n    async registerFrontend(kickbackRate, overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await stabilityPool.estimateAndPopulate.registerFrontEnd({ ...overrides }, id, lib_base_1.Decimal.from(kickbackRate).hex));\r\n    }\r\n    /** @internal */\r\n    async _mintUniToken(amount, address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides));\r\n        const { uniToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (!contracts_1._uniTokenIsMock(uniToken)) {\r\n            throw new Error(\"_mintUniToken() unavailable on this deployment of Liquity\");\r\n        }\r\n        return this._wrapSimpleTransaction(await uniToken.estimateAndPopulate.mint({ ...overrides }, id, address, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.approveUniTokens} */\r\n    async approveUniTokens(allowance, overrides) {\r\n        const { uniToken, unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await uniToken.estimateAndPopulate.approve({ ...overrides }, id, unipool.address, lib_base_1.Decimal.from(allowance !== null && allowance !== void 0 ? allowance : lib_base_1.Decimal.INFINITY).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.stakeUniTokens} */\r\n    async stakeUniTokens(amount, overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.stake({ ...overrides }, addGasForUnipoolRewardUpdate, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.unstakeUniTokens} */\r\n    async unstakeUniTokens(amount, overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.withdraw({ ...overrides }, addGasForUnipoolRewardUpdate, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawLQTYRewardFromLiquidityMining} */\r\n    async withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.claimReward({ ...overrides }, addGasForUnipoolRewardUpdate));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.exitLiquidityMining} */\r\n    async exitLiquidityMining(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.withdrawAndClaim({ ...overrides }, addGasForUnipoolRewardUpdate));\r\n    }\r\n}\r\nexports.PopulatableEthersLiquity = PopulatableEthersLiquity;\r\n//# sourceMappingURL=PopulatableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.SendableEthersLiquity = void 0;\r\nconst sendTransaction = (tx) => tx.send();\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#SendableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass SendableEthersLiquity {\r\n    constructor(populatable) {\r\n        this._populate = populatable;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.openTrove} */\r\n    async openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this._populate\r\n            .openTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.closeTrove} */\r\n    closeTrove(overrides) {\r\n        return this._populate.closeTrove(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.adjustTrove} */\r\n    adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this._populate\r\n            .adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.depositCollateral} */\r\n    depositCollateral(amount, overrides) {\r\n        return this._populate.depositCollateral(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawCollateral} */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this._populate.withdrawCollateral(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.borrowLUSD} */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this._populate.borrowLUSD(amount, maxBorrowingRate, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.repayLUSD} */\r\n    repayLUSD(amount, overrides) {\r\n        return this._populate.repayLUSD(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** @internal */\r\n    setPrice(price, overrides) {\r\n        return this._populate.setPrice(price, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.liquidate} */\r\n    liquidate(address, overrides) {\r\n        return this._populate.liquidate(address, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.liquidateUpTo} */\r\n    liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        return this._populate\r\n            .liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.depositLUSDInStabilityPool} */\r\n    depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        return this._populate\r\n            .depositLUSDInStabilityPool(amount, frontendTag, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawLUSDFromStabilityPool} */\r\n    withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        return this._populate.withdrawLUSDFromStabilityPool(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawGainsFromStabilityPool} */\r\n    withdrawGainsFromStabilityPool(overrides) {\r\n        return this._populate.withdrawGainsFromStabilityPool(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.transferCollateralGainToTrove} */\r\n    transferCollateralGainToTrove(overrides) {\r\n        return this._populate.transferCollateralGainToTrove(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.sendLUSD} */\r\n    sendLUSD(toAddress, amount, overrides) {\r\n        return this._populate.sendLUSD(toAddress, amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.sendLQTY} */\r\n    sendLQTY(toAddress, amount, overrides) {\r\n        return this._populate.sendLQTY(toAddress, amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.redeemLUSD} */\r\n    redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        return this._populate.redeemLUSD(amount, maxRedemptionRate, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.claimCollateralSurplus} */\r\n    claimCollateralSurplus(overrides) {\r\n        return this._populate.claimCollateralSurplus(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.stakeLQTY} */\r\n    stakeLQTY(amount, overrides) {\r\n        return this._populate.stakeLQTY(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.unstakeLQTY} */\r\n    unstakeLQTY(amount, overrides) {\r\n        return this._populate.unstakeLQTY(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawGainsFromStaking} */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this._populate.withdrawGainsFromStaking(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.registerFrontend} */\r\n    registerFrontend(kickbackRate, overrides) {\r\n        return this._populate.registerFrontend(kickbackRate, overrides).then(sendTransaction);\r\n    }\r\n    /** @internal */\r\n    _mintUniToken(amount, address, overrides) {\r\n        return this._populate._mintUniToken(amount, address, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.approveUniTokens} */\r\n    approveUniTokens(allowance, overrides) {\r\n        return this._populate.approveUniTokens(allowance, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.stakeUniTokens} */\r\n    stakeUniTokens(amount, overrides) {\r\n        return this._populate.stakeUniTokens(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.unstakeUniTokens} */\r\n    unstakeUniTokens(amount, overrides) {\r\n        return this._populate.unstakeUniTokens(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawLQTYRewardFromLiquidityMining} */\r\n    withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        return this._populate.withdrawLQTYRewardFromLiquidityMining(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.exitLiquidityMining} */\r\n    exitLiquidityMining(overrides) {\r\n        return this._populate.exitLiquidityMining(overrides).then(sendTransaction);\r\n    }\r\n}\r\nexports.SendableEthersLiquity = SendableEthersLiquity;\r\n//# sourceMappingURL=SendableEthersLiquity.js.map","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LiquityStoreProvider = exports.LiquityStoreContext = void 0;\r\nconst react_1 = __importStar(require(\"react\"));\r\nexports.LiquityStoreContext = react_1.createContext(undefined);\r\nconst LiquityStoreProvider = ({ store, loader, children }) => {\r\n    const [loadedStore, setLoadedStore] = react_1.useState();\r\n    react_1.useEffect(() => {\r\n        store.onLoaded = () => setLoadedStore(store);\r\n        const stop = store.start();\r\n        return () => {\r\n            store.onLoaded = undefined;\r\n            setLoadedStore(undefined);\r\n            stop();\r\n        };\r\n    }, [store]);\r\n    if (!loadedStore) {\r\n        return react_1.default.createElement(react_1.default.Fragment, null, loader);\r\n    }\r\n    return react_1.default.createElement(exports.LiquityStoreContext.Provider, { value: loadedStore }, children);\r\n};\r\nexports.LiquityStoreProvider = LiquityStoreProvider;\r\n//# sourceMappingURL=LiquityStoreProvider.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.equals = void 0;\r\nconst hasOwnProperty = (o, key) => Object.prototype.hasOwnProperty.call(o, key);\r\nconst shallowEquals = (a, b) => {\r\n    const keysA = Object.keys(a);\r\n    const keysB = Object.keys(b);\r\n    return (keysA.length === keysB.length &&\r\n        keysA.every(key => hasOwnProperty(b, key) && Object.is(a[key], b[key])));\r\n};\r\nconst isObject = (a) => a !== null && typeof a === \"object\";\r\nconst equals = (a, b) => isObject(a) && isObject(b) ? shallowEquals(a, b) : Object.is(a, b);\r\nexports.equals = equals;\r\n//# sourceMappingURL=equals.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BatchedWebSocketAugmentedWeb3Provider = exports.Batched = exports.isBatchedProvider = void 0;\r\nconst address_1 = require(\"@ethersproject/address\");\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst properties_1 = require(\"@ethersproject/properties\");\r\nconst WebSocketAugmentedProvider_1 = require(\"./WebSocketAugmentedProvider\");\r\nconst multicallAddress = {\r\n    1: \"0xeefBa1e63905eF1D7ACbA5a8513c70307C1cE441\",\r\n    3: \"0x53C43764255c17BD724F74c4eF150724AC50a3ed\",\r\n    4: \"0x42Ad527de7d4e9d9d011aC45B31D8551f8Fe9821\",\r\n    5: \"0x77dCa2C955b15e9dE4dbBCf1246B4B85b651e50e\",\r\n    42: \"0x2cc8688C5f75E365aaEEb4ea8D6a480405A48D2A\"\r\n};\r\nconst hasMulticall = (chainId) => chainId in multicallAddress;\r\nconst multicallAbi = [\r\n    {\r\n        type: \"function\",\r\n        name: \"aggregate\",\r\n        stateMutability: \"nonpayable\",\r\n        constant: false,\r\n        payable: false,\r\n        inputs: [\r\n            {\r\n                components: [\r\n                    {\r\n                        name: \"target\",\r\n                        type: \"address\"\r\n                    },\r\n                    {\r\n                        name: \"callData\",\r\n                        type: \"bytes\"\r\n                    }\r\n                ],\r\n                name: \"calls\",\r\n                type: \"tuple[]\"\r\n            }\r\n        ],\r\n        outputs: [\r\n            {\r\n                name: \"blockNumber\",\r\n                type: \"uint256\"\r\n            },\r\n            {\r\n                name: \"returnData\",\r\n                type: \"bytes[]\"\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        type: \"function\",\r\n        name: \"getEthBalance\",\r\n        stateMutability: \"view\",\r\n        constant: true,\r\n        payable: false,\r\n        inputs: [\r\n            {\r\n                name: \"addr\",\r\n                type: \"address\"\r\n            }\r\n        ],\r\n        outputs: [\r\n            {\r\n                name: \"balance\",\r\n                type: \"uint256\"\r\n            }\r\n        ]\r\n    }\r\n];\r\nconst emptyBatch = () => ({ calls: [], callbacks: [] });\r\n// TODO\r\n//\r\n// Technically, requests that have a `from` address shouldn't be batched, because `msg.sender` will\r\n// be replaced with the Multicall contract's address when the batched calls are being executed.\r\n//\r\n// Currently, `@liquity/lib-ethers` makes many of its read calls through Signers, which populates\r\n// `from`. Instead these calls should be made through a Provider, and `from` should be omitted\r\n// (since none of the read calls in Liquity care about `msg.sender`).\r\n//\r\n// Then we'll be able to properly exclude calls that have `from` addresses from batching.\r\nconst batchableCall = (request) => request.gasLimit === undefined && request.gasPrice === undefined && request.value === undefined;\r\nconst batchedCall = (request, multicallAddress) => request.to === multicallAddress &&\r\n    typeof request.data === \"string\" &&\r\n    request.data.startsWith(\"0x252dba42\"); // signature of `aggregate((address,bytes)[])`\r\nconst batchedProviders = [];\r\nconst isBatchedProvider = (provider) => batchedProviders.some(batchedProvider => provider instanceof batchedProvider);\r\nexports.isBatchedProvider = isBatchedProvider;\r\nconst Batched = (Base) => {\r\n    const batchedProvider = class extends Base {\r\n        constructor() {\r\n            super(...arguments);\r\n            this.batchingDelayMs = 10;\r\n            this._chainId = 0;\r\n            this._batched = emptyBatch();\r\n            this._numberOfBatchedCalls = 0;\r\n            this._numberOfActualCalls = 0;\r\n        }\r\n        get chainId() {\r\n            return this._chainId;\r\n        }\r\n        set chainId(chainId) {\r\n            if (this._multicall) {\r\n                throw new Error(\"can only set chainId once\");\r\n            }\r\n            if (hasMulticall(chainId)) {\r\n                this._multicall = new contracts_1.Contract(multicallAddress[chainId], multicallAbi, this);\r\n            }\r\n            this._chainId = chainId;\r\n        }\r\n        async _dispatchCalls() {\r\n            const { calls, callbacks, blockTag } = this._batched;\r\n            this._batched = emptyBatch();\r\n            try {\r\n                const results = calls.length > 1\r\n                    ? await this._multicall.callStatic.aggregate(calls, { blockTag }).then(x => x.returnData)\r\n                    : [await super.call({ to: calls[0].target, data: calls[0].callData }, blockTag)];\r\n                callbacks.forEach(([resolve], i) => resolve(results[i]));\r\n            }\r\n            catch (error) {\r\n                callbacks.forEach(([, reject]) => reject(error));\r\n            }\r\n        }\r\n        _enqueueCall(call) {\r\n            if (this._timeoutId !== undefined) {\r\n                clearTimeout(this._timeoutId);\r\n            }\r\n            this._batched.calls.push(call);\r\n            this._timeoutId = setTimeout(() => this._dispatchCalls(), this.batchingDelayMs);\r\n            return new Promise((resolve, reject) => this._batched.callbacks.push([resolve, reject]));\r\n        }\r\n        _alreadyBatchedCallsConflictWith(blockTag) {\r\n            var _a;\r\n            return (this._batched.calls.length !== 0 &&\r\n                (blockTag !== null && blockTag !== void 0 ? blockTag : \"latest\") !== ((_a = this._batched.blockTag) !== null && _a !== void 0 ? _a : \"latest\"));\r\n        }\r\n        async call(request, blockTag) {\r\n            if (!this._multicall) {\r\n                return super.call(request, blockTag);\r\n            }\r\n            else {\r\n                const now = new Date().getTime();\r\n                if (this._timeOfLastRatioCheck === undefined) {\r\n                    this._timeOfLastRatioCheck = now;\r\n                }\r\n                else {\r\n                    const timeSinceLastRatioCheck = now - this._timeOfLastRatioCheck;\r\n                    if (timeSinceLastRatioCheck >= 10000 && this._numberOfActualCalls) {\r\n                        // console.log(\r\n                        //   `Call batching ratio: ${\r\n                        //     Math.round((10 * this._numberOfBatchedCalls) / this._numberOfActualCalls) / 10\r\n                        //   }X`\r\n                        // );\r\n                        this._numberOfBatchedCalls = 0;\r\n                        this._numberOfActualCalls = 0;\r\n                        this._timeOfLastRatioCheck = now;\r\n                    }\r\n                }\r\n            }\r\n            const [resolvedRequest, resolvedBlockTag] = await Promise.all([\r\n                properties_1.resolveProperties(request),\r\n                blockTag\r\n            ]);\r\n            if (batchedCall(resolvedRequest, this._multicall.address) ||\r\n                !batchableCall(resolvedRequest) ||\r\n                this._alreadyBatchedCallsConflictWith(resolvedBlockTag)) {\r\n                this._numberOfActualCalls++;\r\n                return super.call(resolvedRequest, resolvedBlockTag);\r\n            }\r\n            else {\r\n                this._numberOfBatchedCalls++;\r\n                if (this._batched.calls.length === 0) {\r\n                    this._batched.blockTag = resolvedBlockTag;\r\n                }\r\n                return this._enqueueCall({ target: resolvedRequest.to, callData: resolvedRequest.data });\r\n            }\r\n        }\r\n        async getBalance(addressOrName, blockTag) {\r\n            const [resolvedAddressOrName, resolvedBlockTag] = await Promise.all([addressOrName, blockTag]);\r\n            if (!address_1.isAddress(resolvedAddressOrName) || !this._multicall) {\r\n                return super.getBalance(resolvedAddressOrName, blockTag);\r\n            }\r\n            const [balance] = await this._multicall.functions.getEthBalance(resolvedAddressOrName, {\r\n                blockTag: resolvedBlockTag\r\n            });\r\n            return balance;\r\n        }\r\n    };\r\n    batchedProviders.push(batchedProvider);\r\n    return batchedProvider;\r\n};\r\nexports.Batched = Batched;\r\nexports.BatchedWebSocketAugmentedWeb3Provider = exports.Batched(WebSocketAugmentedProvider_1.WebSocketAugmentedWeb3Provider);\r\n//# sourceMappingURL=BatchedProvider.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.TroveWithPendingRedistribution = exports.UserTrove = exports._emptyTrove = exports.Trove = exports._normalizeTroveAdjustment = exports._normalizeTroveCreation = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst Decimal_1 = require(\"./Decimal\");\r\nconst constants_1 = require(\"./constants\");\r\nconst invalidTroveCreation = (invalidTrove, error) => ({\r\n    type: \"invalidCreation\",\r\n    invalidTrove,\r\n    error\r\n});\r\nconst troveCreation = (params) => ({\r\n    type: \"creation\",\r\n    params\r\n});\r\nconst troveClosure = (params) => ({\r\n    type: \"closure\",\r\n    params\r\n});\r\nconst troveAdjustment = (params, setToZero) => ({\r\n    type: \"adjustment\",\r\n    params,\r\n    setToZero\r\n});\r\nconst valueIsDefined = (entry) => entry[1] !== undefined;\r\nconst allowedTroveCreationKeys = [\r\n    \"depositCollateral\",\r\n    \"borrowLUSD\"\r\n];\r\nfunction checkAllowedTroveCreationKeys(entries) {\r\n    const badKeys = entries\r\n        .filter(([k]) => !allowedTroveCreationKeys.includes(k))\r\n        .map(([k]) => `'${k}'`);\r\n    if (badKeys.length > 0) {\r\n        throw new Error(`TroveCreationParams: property ${badKeys.join(\", \")} not allowed`);\r\n    }\r\n}\r\nconst troveCreationParamsFromEntries = (entries) => {\r\n    const params = Object.fromEntries(entries);\r\n    const missingKeys = allowedTroveCreationKeys.filter(k => !(k in params)).map(k => `'${k}'`);\r\n    if (missingKeys.length > 0) {\r\n        throw new Error(`TroveCreationParams: property ${missingKeys.join(\", \")} missing`);\r\n    }\r\n    return params;\r\n};\r\nconst decimalize = ([k, v]) => [k, Decimal_1.Decimal.from(v)];\r\nconst nonZero = ([, v]) => !v.isZero;\r\n/** @internal */\r\nconst _normalizeTroveCreation = (params) => {\r\n    const definedEntries = Object.entries(params).filter(valueIsDefined);\r\n    checkAllowedTroveCreationKeys(definedEntries);\r\n    const nonZeroEntries = definedEntries.map(decimalize);\r\n    return troveCreationParamsFromEntries(nonZeroEntries);\r\n};\r\nexports._normalizeTroveCreation = _normalizeTroveCreation;\r\nconst allowedTroveAdjustmentKeys = [\r\n    \"depositCollateral\",\r\n    \"withdrawCollateral\",\r\n    \"borrowLUSD\",\r\n    \"repayLUSD\"\r\n];\r\nfunction checkAllowedTroveAdjustmentKeys(entries) {\r\n    const badKeys = entries\r\n        .filter(([k]) => !allowedTroveAdjustmentKeys.includes(k))\r\n        .map(([k]) => `'${k}'`);\r\n    if (badKeys.length > 0) {\r\n        throw new Error(`TroveAdjustmentParams: property ${badKeys.join(\", \")} not allowed`);\r\n    }\r\n}\r\nconst collateralChangeFrom = ({ depositCollateral, withdrawCollateral }) => {\r\n    if (depositCollateral !== undefined && withdrawCollateral !== undefined) {\r\n        throw new Error(\"TroveAdjustmentParams: 'depositCollateral' and 'withdrawCollateral' \" +\r\n            \"can't be present at the same time\");\r\n    }\r\n    if (depositCollateral !== undefined) {\r\n        return { depositCollateral };\r\n    }\r\n    if (withdrawCollateral !== undefined) {\r\n        return { withdrawCollateral };\r\n    }\r\n};\r\nconst debtChangeFrom = ({ borrowLUSD, repayLUSD }) => {\r\n    if (borrowLUSD !== undefined && repayLUSD !== undefined) {\r\n        throw new Error(\"TroveAdjustmentParams: 'borrowLUSD' and 'repayLUSD' can't be present at the same time\");\r\n    }\r\n    if (borrowLUSD !== undefined) {\r\n        return { borrowLUSD };\r\n    }\r\n    if (repayLUSD !== undefined) {\r\n        return { repayLUSD };\r\n    }\r\n};\r\nconst troveAdjustmentParamsFromEntries = (entries) => {\r\n    const params = Object.fromEntries(entries);\r\n    const collateralChange = collateralChangeFrom(params);\r\n    const debtChange = debtChangeFrom(params);\r\n    if (collateralChange !== undefined && debtChange !== undefined) {\r\n        return { ...collateralChange, ...debtChange };\r\n    }\r\n    if (collateralChange !== undefined) {\r\n        return collateralChange;\r\n    }\r\n    if (debtChange !== undefined) {\r\n        return debtChange;\r\n    }\r\n    throw new Error(\"TroveAdjustmentParams: must include at least one non-zero parameter\");\r\n};\r\n/** @internal */\r\nconst _normalizeTroveAdjustment = (params) => {\r\n    const definedEntries = Object.entries(params).filter(valueIsDefined);\r\n    checkAllowedTroveAdjustmentKeys(definedEntries);\r\n    const nonZeroEntries = definedEntries.map(decimalize).filter(nonZero);\r\n    return troveAdjustmentParamsFromEntries(nonZeroEntries);\r\n};\r\nexports._normalizeTroveAdjustment = _normalizeTroveAdjustment;\r\nconst applyFee = (borrowingRate, debtIncrease) => debtIncrease.mul(Decimal_1.Decimal.ONE.add(borrowingRate));\r\nconst unapplyFee = (borrowingRate, debtIncrease) => debtIncrease._divCeil(Decimal_1.Decimal.ONE.add(borrowingRate));\r\nconst NOMINAL_COLLATERAL_RATIO_PRECISION = Decimal_1.Decimal.from(100);\r\n/**\r\n * A combination of collateral and debt.\r\n *\r\n * @public\r\n */\r\nclass Trove {\r\n    /** @internal */\r\n    constructor(collateral = Decimal_1.Decimal.ZERO, debt = Decimal_1.Decimal.ZERO) {\r\n        this.collateral = collateral;\r\n        this.debt = debt;\r\n    }\r\n    get isEmpty() {\r\n        return this.collateral.isZero && this.debt.isZero;\r\n    }\r\n    /**\r\n     * Amount of LUSD that must be repaid to close this Trove.\r\n     *\r\n     * @remarks\r\n     * This doesn't include the liquidation reserve, which is refunded in case of normal closure.\r\n     */\r\n    get netDebt() {\r\n        if (this.debt.lt(constants_1.LUSD_LIQUIDATION_RESERVE)) {\r\n            throw new Error(`netDebt should not be used when debt < ${constants_1.LUSD_LIQUIDATION_RESERVE}`);\r\n        }\r\n        return this.debt.sub(constants_1.LUSD_LIQUIDATION_RESERVE);\r\n    }\r\n    /** @internal */\r\n    get _nominalCollateralRatio() {\r\n        return this.collateral.mulDiv(NOMINAL_COLLATERAL_RATIO_PRECISION, this.debt);\r\n    }\r\n    /** Calculate the Trove's collateralization ratio at a given price. */\r\n    collateralRatio(price) {\r\n        return this.collateral.mulDiv(price, this.debt);\r\n    }\r\n    /**\r\n     * Whether the Trove is undercollateralized at a given price.\r\n     *\r\n     * @returns\r\n     * `true` if the Trove's collateralization ratio is less than the\r\n     * {@link MINIMUM_COLLATERAL_RATIO}.\r\n     */\r\n    collateralRatioIsBelowMinimum(price) {\r\n        return this.collateralRatio(price).lt(constants_1.MINIMUM_COLLATERAL_RATIO);\r\n    }\r\n    /**\r\n     * Whether the collateralization ratio is less than the {@link CRITICAL_COLLATERAL_RATIO} at a\r\n     * given price.\r\n     *\r\n     * @example\r\n     * Can be used to check whether the Liquity protocol is in recovery mode by using it on the return\r\n     * value of {@link ReadableLiquity.getTotal | getTotal()}. For example:\r\n     *\r\n     * ```typescript\r\n     * const total = await liquity.getTotal();\r\n     * const price = await liquity.getPrice();\r\n     *\r\n     * if (total.collateralRatioIsBelowCritical(price)) {\r\n     *   // Recovery mode is active\r\n     * }\r\n     * ```\r\n     */\r\n    collateralRatioIsBelowCritical(price) {\r\n        return this.collateralRatio(price).lt(constants_1.CRITICAL_COLLATERAL_RATIO);\r\n    }\r\n    /** Whether the Trove is sufficiently collateralized to be opened during recovery mode. */\r\n    isOpenableInRecoveryMode(price) {\r\n        return this.collateralRatio(price).gte(constants_1.CRITICAL_COLLATERAL_RATIO);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return `{ collateral: ${this.collateral}, debt: ${this.debt} }`;\r\n    }\r\n    equals(that) {\r\n        return this.collateral.eq(that.collateral) && this.debt.eq(that.debt);\r\n    }\r\n    add(that) {\r\n        return new Trove(this.collateral.add(that.collateral), this.debt.add(that.debt));\r\n    }\r\n    addCollateral(collateral) {\r\n        return new Trove(this.collateral.add(collateral), this.debt);\r\n    }\r\n    addDebt(debt) {\r\n        return new Trove(this.collateral, this.debt.add(debt));\r\n    }\r\n    subtract(that) {\r\n        const { collateral, debt } = that;\r\n        return new Trove(this.collateral.gt(collateral) ? this.collateral.sub(collateral) : Decimal_1.Decimal.ZERO, this.debt.gt(debt) ? this.debt.sub(debt) : Decimal_1.Decimal.ZERO);\r\n    }\r\n    subtractCollateral(collateral) {\r\n        return new Trove(this.collateral.gt(collateral) ? this.collateral.sub(collateral) : Decimal_1.Decimal.ZERO, this.debt);\r\n    }\r\n    subtractDebt(debt) {\r\n        return new Trove(this.collateral, this.debt.gt(debt) ? this.debt.sub(debt) : Decimal_1.Decimal.ZERO);\r\n    }\r\n    multiply(multiplier) {\r\n        return new Trove(this.collateral.mul(multiplier), this.debt.mul(multiplier));\r\n    }\r\n    setCollateral(collateral) {\r\n        return new Trove(Decimal_1.Decimal.from(collateral), this.debt);\r\n    }\r\n    setDebt(debt) {\r\n        return new Trove(this.collateral, Decimal_1.Decimal.from(debt));\r\n    }\r\n    _debtChange({ debt }, borrowingRate) {\r\n        return debt.gt(this.debt)\r\n            ? { borrowLUSD: unapplyFee(borrowingRate, debt.sub(this.debt)) }\r\n            : { repayLUSD: this.debt.sub(debt) };\r\n    }\r\n    _collateralChange({ collateral }) {\r\n        return collateral.gt(this.collateral)\r\n            ? { depositCollateral: collateral.sub(this.collateral) }\r\n            : { withdrawCollateral: this.collateral.sub(collateral) };\r\n    }\r\n    /**\r\n     * Calculate the difference between this Trove and another.\r\n     *\r\n     * @param that - The other Trove.\r\n     * @param borrowingRate - Borrowing rate to use when calculating a borrowed amount.\r\n     *\r\n     * @returns\r\n     * An object representing the change, or `undefined` if the Troves are equal.\r\n     */\r\n    whatChanged(that, borrowingRate = constants_1.MINIMUM_BORROWING_RATE) {\r\n        var _a;\r\n        if (this.collateral.eq(that.collateral) && this.debt.eq(that.debt)) {\r\n            return undefined;\r\n        }\r\n        if (this.isEmpty) {\r\n            if (that.debt.lt(constants_1.LUSD_LIQUIDATION_RESERVE)) {\r\n                return invalidTroveCreation(that, \"missingLiquidationReserve\");\r\n            }\r\n            return troveCreation({\r\n                depositCollateral: that.collateral,\r\n                borrowLUSD: unapplyFee(borrowingRate, that.netDebt)\r\n            });\r\n        }\r\n        if (that.isEmpty) {\r\n            return troveClosure(this.netDebt.nonZero\r\n                ? { withdrawCollateral: this.collateral, repayLUSD: this.netDebt }\r\n                : { withdrawCollateral: this.collateral });\r\n        }\r\n        return this.collateral.eq(that.collateral)\r\n            ? troveAdjustment(this._debtChange(that, borrowingRate), that.debt.zero && \"debt\")\r\n            : this.debt.eq(that.debt)\r\n                ? troveAdjustment(this._collateralChange(that), that.collateral.zero && \"collateral\")\r\n                : troveAdjustment({\r\n                    ...this._debtChange(that, borrowingRate),\r\n                    ...this._collateralChange(that)\r\n                }, (_a = (that.debt.zero && \"debt\")) !== null && _a !== void 0 ? _a : (that.collateral.zero && \"collateral\"));\r\n    }\r\n    /**\r\n     * Make a new Trove by applying a {@link TroveChange} to this Trove.\r\n     *\r\n     * @param change - The change to apply.\r\n     * @param borrowingRate - Borrowing rate to use when adding a borrowed amount to the Trove's debt.\r\n     */\r\n    apply(change, borrowingRate = constants_1.MINIMUM_BORROWING_RATE) {\r\n        if (!change) {\r\n            return this;\r\n        }\r\n        switch (change.type) {\r\n            case \"invalidCreation\":\r\n                if (!this.isEmpty) {\r\n                    throw new Error(\"Can't create onto existing Trove\");\r\n                }\r\n                return change.invalidTrove;\r\n            case \"creation\": {\r\n                if (!this.isEmpty) {\r\n                    throw new Error(\"Can't create onto existing Trove\");\r\n                }\r\n                const { depositCollateral, borrowLUSD } = change.params;\r\n                return new Trove(depositCollateral, constants_1.LUSD_LIQUIDATION_RESERVE.add(applyFee(borrowingRate, borrowLUSD)));\r\n            }\r\n            case \"closure\":\r\n                if (this.isEmpty) {\r\n                    throw new Error(\"Can't close empty Trove\");\r\n                }\r\n                return exports._emptyTrove;\r\n            case \"adjustment\": {\r\n                const { setToZero, params: { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD } } = change;\r\n                const collateralDecrease = withdrawCollateral !== null && withdrawCollateral !== void 0 ? withdrawCollateral : Decimal_1.Decimal.ZERO;\r\n                const collateralIncrease = depositCollateral !== null && depositCollateral !== void 0 ? depositCollateral : Decimal_1.Decimal.ZERO;\r\n                const debtDecrease = repayLUSD !== null && repayLUSD !== void 0 ? repayLUSD : Decimal_1.Decimal.ZERO;\r\n                const debtIncrease = borrowLUSD ? applyFee(borrowingRate, borrowLUSD) : Decimal_1.Decimal.ZERO;\r\n                return setToZero === \"collateral\"\r\n                    ? this.setCollateral(Decimal_1.Decimal.ZERO).addDebt(debtIncrease).subtractDebt(debtDecrease)\r\n                    : setToZero === \"debt\"\r\n                        ? this.setDebt(Decimal_1.Decimal.ZERO)\r\n                            .addCollateral(collateralIncrease)\r\n                            .subtractCollateral(collateralDecrease)\r\n                        : this.add(new Trove(collateralIncrease, debtIncrease)).subtract(new Trove(collateralDecrease, debtDecrease));\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Calculate the result of an {@link TransactableLiquity.openTrove | openTrove()} transaction.\r\n     *\r\n     * @param params - Parameters of the transaction.\r\n     * @param borrowingRate - Borrowing rate to use when calculating the Trove's debt.\r\n     */\r\n    static create(params, borrowingRate) {\r\n        return exports._emptyTrove.apply(troveCreation(exports._normalizeTroveCreation(params)), borrowingRate);\r\n    }\r\n    /**\r\n     * Calculate the parameters of an {@link TransactableLiquity.openTrove | openTrove()} transaction\r\n     * that will result in the given Trove.\r\n     *\r\n     * @param that - The Trove to recreate.\r\n     * @param borrowingRate - Current borrowing rate.\r\n     */\r\n    static recreate(that, borrowingRate) {\r\n        const change = exports._emptyTrove.whatChanged(that, borrowingRate);\r\n        assert_1.default((change === null || change === void 0 ? void 0 : change.type) === \"creation\");\r\n        return change.params;\r\n    }\r\n    /**\r\n     * Calculate the result of an {@link TransactableLiquity.adjustTrove | adjustTrove()} transaction\r\n     * on this Trove.\r\n     *\r\n     * @param params - Parameters of the transaction.\r\n     * @param borrowingRate - Borrowing rate to use when adding to the Trove's debt.\r\n     */\r\n    adjust(params, borrowingRate) {\r\n        return this.apply(troveAdjustment(exports._normalizeTroveAdjustment(params)), borrowingRate);\r\n    }\r\n    /**\r\n     * Calculate the parameters of an {@link TransactableLiquity.adjustTrove | adjustTrove()}\r\n     * transaction that will change this Trove into the given Trove.\r\n     *\r\n     * @param that - The desired result of the transaction.\r\n     * @param borrowingRate - Current borrowing rate.\r\n     */\r\n    adjustTo(that, borrowingRate) {\r\n        const change = this.whatChanged(that, borrowingRate);\r\n        assert_1.default((change === null || change === void 0 ? void 0 : change.type) === \"adjustment\");\r\n        return change.params;\r\n    }\r\n}\r\nexports.Trove = Trove;\r\n/** @internal */\r\nexports._emptyTrove = new Trove();\r\n/**\r\n * A Trove that is associated with a single owner.\r\n *\r\n * @remarks\r\n * The SDK uses the base {@link Trove} class as a generic container of collateral and debt, for\r\n * example to represent the {@link ReadableLiquity.getTotal | total collateral and debt} locked up\r\n * in the protocol.\r\n *\r\n * The `UserTrove` class extends `Trove` with extra information that's only available for Troves\r\n * that are associated with a single owner (such as the owner's address, or the Trove's status).\r\n *\r\n * @public\r\n */\r\nclass UserTrove extends Trove {\r\n    /** @internal */\r\n    constructor(ownerAddress, status, collateral, debt) {\r\n        super(collateral, debt);\r\n        this.ownerAddress = ownerAddress;\r\n        this.status = status;\r\n    }\r\n    equals(that) {\r\n        return (super.equals(that) && this.ownerAddress === that.ownerAddress && this.status === that.status);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ ownerAddress: \"${this.ownerAddress}\"` +\r\n            `, collateral: ${this.collateral}` +\r\n            `, debt: ${this.debt}` +\r\n            `, status: \"${this.status}\" }`);\r\n    }\r\n}\r\nexports.UserTrove = UserTrove;\r\n/**\r\n * A Trove in its state after the last direct modification.\r\n *\r\n * @remarks\r\n * The Trove may have received collateral and debt shares from liquidations since then.\r\n * Use {@link TroveWithPendingRedistribution.applyRedistribution | applyRedistribution()} to\r\n * calculate the Trove's most up-to-date state.\r\n *\r\n * @public\r\n */\r\nclass TroveWithPendingRedistribution extends UserTrove {\r\n    /** @internal */\r\n    constructor(ownerAddress, status, collateral, debt, stake = Decimal_1.Decimal.ZERO, snapshotOfTotalRedistributed = exports._emptyTrove) {\r\n        super(ownerAddress, status, collateral, debt);\r\n        this.stake = stake;\r\n        this.snapshotOfTotalRedistributed = snapshotOfTotalRedistributed;\r\n    }\r\n    applyRedistribution(totalRedistributed) {\r\n        const afterRedistribution = this.add(totalRedistributed.subtract(this.snapshotOfTotalRedistributed).multiply(this.stake));\r\n        return new UserTrove(this.ownerAddress, this.status, afterRedistribution.collateral, afterRedistribution.debt);\r\n    }\r\n    equals(that) {\r\n        return (super.equals(that) &&\r\n            this.stake.eq(that.stake) &&\r\n            this.snapshotOfTotalRedistributed.equals(that.snapshotOfTotalRedistributed));\r\n    }\r\n}\r\nexports.TroveWithPendingRedistribution = TroveWithPendingRedistribution;\r\n//# sourceMappingURL=Trove.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.StabilityDeposit = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * A Stability Deposit and its accrued gains.\r\n *\r\n * @public\r\n */\r\nclass StabilityDeposit {\r\n    /** @internal */\r\n    constructor(initialLUSD, currentLUSD, collateralGain, lqtyReward, frontendTag) {\r\n        this.initialLUSD = initialLUSD;\r\n        this.currentLUSD = currentLUSD;\r\n        this.collateralGain = collateralGain;\r\n        this.lqtyReward = lqtyReward;\r\n        this.frontendTag = frontendTag;\r\n        if (this.currentLUSD.gt(this.initialLUSD)) {\r\n            throw new Error(\"currentLUSD can't be greater than initialLUSD\");\r\n        }\r\n    }\r\n    get isEmpty() {\r\n        return (this.initialLUSD.isZero &&\r\n            this.currentLUSD.isZero &&\r\n            this.collateralGain.isZero &&\r\n            this.lqtyReward.isZero);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ initialLUSD: ${this.initialLUSD}` +\r\n            `, currentLUSD: ${this.currentLUSD}` +\r\n            `, collateralGain: ${this.collateralGain}` +\r\n            `, lqtyReward: ${this.lqtyReward}` +\r\n            `, frontendTag: \"${this.frontendTag}\" }`);\r\n    }\r\n    /**\r\n     * Compare to another instance of `StabilityDeposit`.\r\n     */\r\n    equals(that) {\r\n        return (this.initialLUSD.eq(that.initialLUSD) &&\r\n            this.currentLUSD.eq(that.currentLUSD) &&\r\n            this.collateralGain.eq(that.collateralGain) &&\r\n            this.lqtyReward.eq(that.lqtyReward) &&\r\n            this.frontendTag === that.frontendTag);\r\n    }\r\n    /**\r\n     * Calculate the difference between the `currentLUSD` in this Stability Deposit and `thatLUSD`.\r\n     *\r\n     * @returns An object representing the change, or `undefined` if the deposited amounts are equal.\r\n     */\r\n    whatChanged(thatLUSD) {\r\n        thatLUSD = Decimal_1.Decimal.from(thatLUSD);\r\n        if (thatLUSD.lt(this.currentLUSD)) {\r\n            return { withdrawLUSD: this.currentLUSD.sub(thatLUSD), withdrawAllLUSD: thatLUSD.isZero };\r\n        }\r\n        if (thatLUSD.gt(this.currentLUSD)) {\r\n            return { depositLUSD: thatLUSD.sub(this.currentLUSD) };\r\n        }\r\n    }\r\n    /**\r\n     * Apply a {@link StabilityDepositChange} to this Stability Deposit.\r\n     *\r\n     * @returns The new deposited LUSD amount.\r\n     */\r\n    apply(change) {\r\n        if (!change) {\r\n            return this.currentLUSD;\r\n        }\r\n        if (change.withdrawLUSD !== undefined) {\r\n            return change.withdrawAllLUSD || this.currentLUSD.lte(change.withdrawLUSD)\r\n                ? Decimal_1.Decimal.ZERO\r\n                : this.currentLUSD.sub(change.withdrawLUSD);\r\n        }\r\n        else {\r\n            return this.currentLUSD.add(change.depositLUSD);\r\n        }\r\n    }\r\n}\r\nexports.StabilityDeposit = StabilityDeposit;\r\n//# sourceMappingURL=StabilityDeposit.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LQTYStake = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * Represents a user's LQTY stake and accrued gains.\r\n *\r\n * @remarks\r\n * Returned by the {@link ReadableLiquity.getLQTYStake | getLQTYStake()} function.\r\n\r\n * @public\r\n */\r\nclass LQTYStake {\r\n    /** @internal */\r\n    constructor(stakedLQTY = Decimal_1.Decimal.ZERO, collateralGain = Decimal_1.Decimal.ZERO, lusdGain = Decimal_1.Decimal.ZERO) {\r\n        this.stakedLQTY = stakedLQTY;\r\n        this.collateralGain = collateralGain;\r\n        this.lusdGain = lusdGain;\r\n    }\r\n    get isEmpty() {\r\n        return this.stakedLQTY.isZero && this.collateralGain.isZero && this.lusdGain.isZero;\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ stakedLQTY: ${this.stakedLQTY}` +\r\n            `, collateralGain: ${this.collateralGain}` +\r\n            `, lusdGain: ${this.lusdGain} }`);\r\n    }\r\n    /**\r\n     * Compare to another instance of `LQTYStake`.\r\n     */\r\n    equals(that) {\r\n        return (this.stakedLQTY.eq(that.stakedLQTY) &&\r\n            this.collateralGain.eq(that.collateralGain) &&\r\n            this.lusdGain.eq(that.lusdGain));\r\n    }\r\n    /**\r\n     * Calculate the difference between this `LQTYStake` and `thatStakedLQTY`.\r\n     *\r\n     * @returns An object representing the change, or `undefined` if the staked amounts are equal.\r\n     */\r\n    whatChanged(thatStakedLQTY) {\r\n        thatStakedLQTY = Decimal_1.Decimal.from(thatStakedLQTY);\r\n        if (thatStakedLQTY.lt(this.stakedLQTY)) {\r\n            return {\r\n                unstakeLQTY: this.stakedLQTY.sub(thatStakedLQTY),\r\n                unstakeAllLQTY: thatStakedLQTY.isZero\r\n            };\r\n        }\r\n        if (thatStakedLQTY.gt(this.stakedLQTY)) {\r\n            return { stakeLQTY: thatStakedLQTY.sub(this.stakedLQTY) };\r\n        }\r\n    }\r\n    /**\r\n     * Apply a {@link LQTYStakeChange} to this `LQTYStake`.\r\n     *\r\n     * @returns The new staked LQTY amount.\r\n     */\r\n    apply(change) {\r\n        if (!change) {\r\n            return this.stakedLQTY;\r\n        }\r\n        if (change.unstakeLQTY !== undefined) {\r\n            return change.unstakeAllLQTY || this.stakedLQTY.lte(change.unstakeLQTY)\r\n                ? Decimal_1.Decimal.ZERO\r\n                : this.stakedLQTY.sub(change.unstakeLQTY);\r\n        }\r\n        else {\r\n            return this.stakedLQTY.add(change.stakeLQTY);\r\n        }\r\n    }\r\n}\r\nexports.LQTYStake = LQTYStake;\r\n//# sourceMappingURL=LQTYStake.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Fees = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst Decimal_1 = require(\"./Decimal\");\r\nconst constants_1 = require(\"./constants\");\r\n/**\r\n * Calculator for fees.\r\n *\r\n * @remarks\r\n * Returned by the {@link ReadableLiquity.getFees | getFees()} function.\r\n *\r\n * @public\r\n */\r\nclass Fees {\r\n    /** @internal */\r\n    constructor(baseRateWithoutDecay, minuteDecayFactor, beta, lastFeeOperation, timeOfLatestBlock, recoveryMode) {\r\n        this._baseRateWithoutDecay = Decimal_1.Decimal.from(baseRateWithoutDecay);\r\n        this._minuteDecayFactor = Decimal_1.Decimal.from(minuteDecayFactor);\r\n        this._beta = Decimal_1.Decimal.from(beta);\r\n        this._lastFeeOperation = lastFeeOperation;\r\n        this._timeOfLatestBlock = timeOfLatestBlock;\r\n        this._recoveryMode = recoveryMode;\r\n        assert_1.default(this._minuteDecayFactor.lt(1));\r\n    }\r\n    /** @internal */\r\n    _setRecoveryMode(recoveryMode) {\r\n        return new Fees(this._baseRateWithoutDecay, this._minuteDecayFactor, this._beta, this._lastFeeOperation, this._timeOfLatestBlock, recoveryMode);\r\n    }\r\n    /**\r\n     * Compare to another instance of `Fees`.\r\n     */\r\n    equals(that) {\r\n        return (this._baseRateWithoutDecay.eq(that._baseRateWithoutDecay) &&\r\n            this._minuteDecayFactor.eq(that._minuteDecayFactor) &&\r\n            this._beta.eq(that._beta) &&\r\n            this._lastFeeOperation.getTime() === that._lastFeeOperation.getTime() &&\r\n            this._timeOfLatestBlock.getTime() === that._timeOfLatestBlock.getTime() &&\r\n            this._recoveryMode === that._recoveryMode);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ baseRateWithoutDecay: ${this._baseRateWithoutDecay}` +\r\n            `, lastFeeOperation: \"${this._lastFeeOperation.toLocaleString()}\"` +\r\n            `, recoveryMode: ${this._recoveryMode} } `);\r\n    }\r\n    /** @internal */\r\n    baseRate(when = this._timeOfLatestBlock) {\r\n        const millisecondsSinceLastFeeOperation = Math.max(when.getTime() - this._lastFeeOperation.getTime(), 0 // Clamp negative elapsed time to 0, in case the client's time is in the past.\r\n        // We will calculate slightly higher than actual fees, which is fine.\r\n        );\r\n        const minutesSinceLastFeeOperation = Math.floor(millisecondsSinceLastFeeOperation / 60000);\r\n        return this._minuteDecayFactor.pow(minutesSinceLastFeeOperation).mul(this._baseRateWithoutDecay);\r\n    }\r\n    /**\r\n     * Calculate the current borrowing rate.\r\n     *\r\n     * @param when - Optional timestamp that can be used to calculate what the borrowing rate would\r\n     *               decay to at a point of time in the future.\r\n     *\r\n     * @remarks\r\n     * By default, the fee is calculated at the time of the latest block. This can be overridden using\r\n     * the `when` parameter.\r\n     *\r\n     * To calculate the borrowing fee in LUSD, multiply the borrowed LUSD amount by the borrowing rate.\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const fees = await liquity.getFees();\r\n     *\r\n     * const borrowedLUSDAmount = 100;\r\n     * const borrowingRate = fees.borrowingRate();\r\n     * const borrowingFeeLUSD = borrowingRate.mul(borrowedLUSDAmount);\r\n     * ```\r\n     */\r\n    borrowingRate(when) {\r\n        return this._recoveryMode\r\n            ? Decimal_1.Decimal.ZERO\r\n            : Decimal_1.Decimal.min(constants_1.MINIMUM_BORROWING_RATE.add(this.baseRate(when)), constants_1.MAXIMUM_BORROWING_RATE);\r\n    }\r\n    /**\r\n     * Calculate the current redemption rate.\r\n     *\r\n     * @param redeemedFractionOfSupply - The amount of LUSD being redeemed divided by the total supply.\r\n     * @param when - Optional timestamp that can be used to calculate what the redemption rate would\r\n     *               decay to at a point of time in the future.\r\n     *\r\n     * @remarks\r\n     * By default, the fee is calculated at the time of the latest block. This can be overridden using\r\n     * the `when` parameter.\r\n  \r\n     * Unlike the borrowing rate, the redemption rate depends on the amount being redeemed. To be more\r\n     * precise, it depends on the fraction of the redeemed amount compared to the total LUSD supply,\r\n     * which must be passed as a parameter.\r\n     *\r\n     * To calculate the redemption fee in LUSD, multiply the redeemed LUSD amount with the redemption\r\n     * rate.\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const fees = await liquity.getFees();\r\n     * const total = await liquity.getTotal();\r\n     *\r\n     * const redeemedLUSDAmount = Decimal.from(100);\r\n     * const redeemedFractionOfSupply = redeemedLUSDAmount.div(total.debt);\r\n     * const redemptionRate = fees.redemptionRate(redeemedFractionOfSupply);\r\n     * const redemptionFeeLUSD = redemptionRate.mul(redeemedLUSDAmount);\r\n     * ```\r\n     */\r\n    redemptionRate(redeemedFractionOfSupply = Decimal_1.Decimal.ZERO, when) {\r\n        redeemedFractionOfSupply = Decimal_1.Decimal.from(redeemedFractionOfSupply);\r\n        let baseRate = this.baseRate(when);\r\n        if (redeemedFractionOfSupply.nonZero) {\r\n            baseRate = redeemedFractionOfSupply.div(this._beta).add(baseRate);\r\n        }\r\n        return Decimal_1.Decimal.min(constants_1.MINIMUM_REDEMPTION_RATE.add(baseRate), Decimal_1.Decimal.ONE);\r\n    }\r\n}\r\nexports.Fees = Fees;\r\n//# sourceMappingURL=Fees.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.TransactionFailedError = void 0;\r\n/**\r\n * Thrown by {@link TransactableLiquity} functions in case of transaction failure.\r\n *\r\n * @public\r\n */\r\nclass TransactionFailedError extends Error {\r\n    /** @internal */\r\n    constructor(name, message, failedReceipt) {\r\n        super(message);\r\n        this.name = name;\r\n        this.failedReceipt = failedReceipt;\r\n    }\r\n}\r\nexports.TransactionFailedError = TransactionFailedError;\r\n//# sourceMappingURL=TransactableLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._successfulReceipt = exports._failedReceipt = exports._pendingReceipt = void 0;\r\n/** @internal */\r\nexports._pendingReceipt = { status: \"pending\" };\r\n/** @internal */\r\nconst _failedReceipt = (rawReceipt) => ({\r\n    status: \"failed\",\r\n    rawReceipt\r\n});\r\nexports._failedReceipt = _failedReceipt;\r\n/** @internal */\r\nconst _successfulReceipt = (rawReceipt, details, toString) => ({\r\n    status: \"succeeded\",\r\n    rawReceipt,\r\n    details,\r\n    ...(toString ? { toString } : {})\r\n});\r\nexports._successfulReceipt = _successfulReceipt;\r\n//# sourceMappingURL=SendableLiquity.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LiquityStore = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst strictEquals = (a, b) => a === b;\r\nconst eq = (a, b) => a.eq(b);\r\nconst equals = (a, b) => a.equals(b);\r\nconst frontendStatusEquals = (a, b) => a.status === \"unregistered\"\r\n    ? b.status === \"unregistered\"\r\n    : b.status === \"registered\" && a.kickbackRate.eq(b.kickbackRate);\r\nconst showFrontendStatus = (x) => x.status === \"unregistered\"\r\n    ? '{ status: \"unregistered\" }'\r\n    : `{ status: \"registered\", kickbackRate: ${x.kickbackRate} }`;\r\nconst wrap = (f) => (...args) => f(...args);\r\nconst difference = (a, b) => Object.fromEntries(Object.entries(a).filter(([key, value]) => value !== b[key]));\r\n/**\r\n * Abstract base class of Liquity data store implementations.\r\n *\r\n * @remarks\r\n * The type parameter `T` may be used to type extra state added to {@link LiquityStoreState} by the\r\n * subclass.\r\n *\r\n * Implemented by {@link @liquity/lib-ethers#BlockPolledLiquityStore}.\r\n *\r\n * @public\r\n */\r\nclass LiquityStore {\r\n    constructor() {\r\n        /** Turn console logging on/off. */\r\n        this.logging = false;\r\n        /** @internal */\r\n        this._loaded = false;\r\n        this._listeners = new Set();\r\n    }\r\n    /**\r\n     * The current store state.\r\n     *\r\n     * @remarks\r\n     * Should not be accessed before the store is loaded. Assign a function to\r\n     * {@link LiquityStore.onLoaded | onLoaded} to get a callback when this happens.\r\n     *\r\n     * See {@link LiquityStoreState} for the list of properties returned.\r\n     */\r\n    get state() {\r\n        return Object.assign({}, this._baseState, this._derivedState, this._extraState);\r\n    }\r\n    /**\r\n     * Start monitoring the blockchain for Liquity state changes.\r\n     *\r\n     * @remarks\r\n     * The {@link LiquityStore.onLoaded | onLoaded} callback will be called after the state is fetched\r\n     * for the first time.\r\n     *\r\n     * Use the {@link LiquityStore.subscribe | subscribe()} function to register listeners.\r\n     *\r\n     * @returns Function to stop the monitoring.\r\n     */\r\n    start() {\r\n        const doStop = this._doStart();\r\n        return () => {\r\n            doStop();\r\n            this._cancelUpdateIfScheduled();\r\n        };\r\n    }\r\n    _cancelUpdateIfScheduled() {\r\n        if (this._updateTimeoutId !== undefined) {\r\n            clearTimeout(this._updateTimeoutId);\r\n        }\r\n    }\r\n    _scheduleUpdate() {\r\n        this._cancelUpdateIfScheduled();\r\n        this._updateTimeoutId = setTimeout(() => {\r\n            this._updateTimeoutId = undefined;\r\n            this._update();\r\n        }, 30000);\r\n    }\r\n    _logUpdate(name, next, show) {\r\n        if (this.logging) {\r\n            console.log(`${name} updated to ${show ? show(next) : next}`);\r\n        }\r\n        return next;\r\n    }\r\n    _updateIfChanged(equals, name, prev, next, show) {\r\n        return next !== undefined && !equals(prev, next) ? this._logUpdate(name, next, show) : prev;\r\n    }\r\n    _silentlyUpdateIfChanged(equals, prev, next) {\r\n        return next !== undefined && !equals(prev, next) ? next : prev;\r\n    }\r\n    _updateFees(name, prev, next) {\r\n        if (next && !next.equals(prev)) {\r\n            // Filter out fee update spam that happens on every new block by only logging when string\r\n            // representation changes.\r\n            if (`${next}` !== `${prev}`) {\r\n                this._logUpdate(name, next);\r\n            }\r\n            return next;\r\n        }\r\n        else {\r\n            return prev;\r\n        }\r\n    }\r\n    _reduce(baseState, baseStateUpdate) {\r\n        return {\r\n            frontend: this._updateIfChanged(frontendStatusEquals, \"frontend\", baseState.frontend, baseStateUpdate.frontend, showFrontendStatus),\r\n            ownFrontend: this._updateIfChanged(frontendStatusEquals, \"ownFrontend\", baseState.ownFrontend, baseStateUpdate.ownFrontend, showFrontendStatus),\r\n            numberOfTroves: this._updateIfChanged(strictEquals, \"numberOfTroves\", baseState.numberOfTroves, baseStateUpdate.numberOfTroves),\r\n            accountBalance: this._updateIfChanged(eq, \"accountBalance\", baseState.accountBalance, baseStateUpdate.accountBalance),\r\n            lusdBalance: this._updateIfChanged(eq, \"lusdBalance\", baseState.lusdBalance, baseStateUpdate.lusdBalance),\r\n            lqtyBalance: this._updateIfChanged(eq, \"lqtyBalance\", baseState.lqtyBalance, baseStateUpdate.lqtyBalance),\r\n            uniTokenBalance: this._updateIfChanged(eq, \"uniTokenBalance\", baseState.uniTokenBalance, baseStateUpdate.uniTokenBalance),\r\n            uniTokenAllowance: this._updateIfChanged(eq, \"uniTokenAllowance\", baseState.uniTokenAllowance, baseStateUpdate.uniTokenAllowance),\r\n            remainingLiquidityMiningLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.remainingLiquidityMiningLQTYReward, baseStateUpdate.remainingLiquidityMiningLQTYReward),\r\n            liquidityMiningStake: this._updateIfChanged(eq, \"liquidityMiningStake\", baseState.liquidityMiningStake, baseStateUpdate.liquidityMiningStake),\r\n            totalStakedUniTokens: this._updateIfChanged(eq, \"totalStakedUniTokens\", baseState.totalStakedUniTokens, baseStateUpdate.totalStakedUniTokens),\r\n            liquidityMiningLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.liquidityMiningLQTYReward, baseStateUpdate.liquidityMiningLQTYReward),\r\n            collateralSurplusBalance: this._updateIfChanged(eq, \"collateralSurplusBalance\", baseState.collateralSurplusBalance, baseStateUpdate.collateralSurplusBalance),\r\n            price: this._updateIfChanged(eq, \"price\", baseState.price, baseStateUpdate.price),\r\n            lusdInStabilityPool: this._updateIfChanged(eq, \"lusdInStabilityPool\", baseState.lusdInStabilityPool, baseStateUpdate.lusdInStabilityPool),\r\n            total: this._updateIfChanged(equals, \"total\", baseState.total, baseStateUpdate.total),\r\n            totalRedistributed: this._updateIfChanged(equals, \"totalRedistributed\", baseState.totalRedistributed, baseStateUpdate.totalRedistributed),\r\n            troveBeforeRedistribution: this._updateIfChanged(equals, \"troveBeforeRedistribution\", baseState.troveBeforeRedistribution, baseStateUpdate.troveBeforeRedistribution),\r\n            stabilityDeposit: this._updateIfChanged(equals, \"stabilityDeposit\", baseState.stabilityDeposit, baseStateUpdate.stabilityDeposit),\r\n            remainingStabilityPoolLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.remainingStabilityPoolLQTYReward, baseStateUpdate.remainingStabilityPoolLQTYReward),\r\n            _feesInNormalMode: this._silentlyUpdateIfChanged(equals, baseState._feesInNormalMode, baseStateUpdate._feesInNormalMode),\r\n            lqtyStake: this._updateIfChanged(equals, \"lqtyStake\", baseState.lqtyStake, baseStateUpdate.lqtyStake),\r\n            totalStakedLQTY: this._updateIfChanged(eq, \"totalStakedLQTY\", baseState.totalStakedLQTY, baseStateUpdate.totalStakedLQTY),\r\n            _riskiestTroveBeforeRedistribution: this._silentlyUpdateIfChanged(equals, baseState._riskiestTroveBeforeRedistribution, baseStateUpdate._riskiestTroveBeforeRedistribution)\r\n        };\r\n    }\r\n    _derive({ troveBeforeRedistribution, totalRedistributed, _feesInNormalMode, total, price, _riskiestTroveBeforeRedistribution }) {\r\n        const fees = _feesInNormalMode._setRecoveryMode(total.collateralRatioIsBelowCritical(price));\r\n        return {\r\n            trove: troveBeforeRedistribution.applyRedistribution(totalRedistributed),\r\n            fees,\r\n            borrowingRate: fees.borrowingRate(),\r\n            redemptionRate: fees.redemptionRate(),\r\n            haveUndercollateralizedTroves: _riskiestTroveBeforeRedistribution\r\n                .applyRedistribution(totalRedistributed)\r\n                .collateralRatioIsBelowMinimum(price)\r\n        };\r\n    }\r\n    _reduceDerived(derivedState, derivedStateUpdate) {\r\n        return {\r\n            fees: this._updateFees(\"fees\", derivedState.fees, derivedStateUpdate.fees),\r\n            trove: this._updateIfChanged(equals, \"trove\", derivedState.trove, derivedStateUpdate.trove),\r\n            borrowingRate: this._silentlyUpdateIfChanged(eq, derivedState.borrowingRate, derivedStateUpdate.borrowingRate),\r\n            redemptionRate: this._silentlyUpdateIfChanged(eq, derivedState.redemptionRate, derivedStateUpdate.redemptionRate),\r\n            haveUndercollateralizedTroves: this._updateIfChanged(strictEquals, \"haveUndercollateralizedTroves\", derivedState.haveUndercollateralizedTroves, derivedStateUpdate.haveUndercollateralizedTroves)\r\n        };\r\n    }\r\n    _notify(params) {\r\n        // Iterate on a copy of `_listeners`, to avoid notifying any new listeners subscribed by\r\n        // existing listeners, as that could result in infinite loops.\r\n        //\r\n        // Before calling a listener from our copy of `_listeners`, check if it has been removed from\r\n        // the original set. This way we avoid calling listeners that have already been unsubscribed\r\n        // by an earlier listener callback.\r\n        [...this._listeners].forEach(listener => {\r\n            if (this._listeners.has(listener)) {\r\n                listener(params);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Register a state change listener.\r\n     *\r\n     * @param listener - Function that will be called whenever state changes.\r\n     * @returns Function to unregister this listener.\r\n     */\r\n    subscribe(listener) {\r\n        const uniqueListener = wrap(listener);\r\n        this._listeners.add(uniqueListener);\r\n        return () => {\r\n            this._listeners.delete(uniqueListener);\r\n        };\r\n    }\r\n    /** @internal */\r\n    _load(baseState, extraState) {\r\n        assert_1.default(!this._loaded);\r\n        this._baseState = baseState;\r\n        this._derivedState = this._derive(baseState);\r\n        this._extraState = extraState;\r\n        this._loaded = true;\r\n        this._scheduleUpdate();\r\n        if (this.onLoaded) {\r\n            this.onLoaded();\r\n        }\r\n    }\r\n    /** @internal */\r\n    _update(baseStateUpdate, extraStateUpdate) {\r\n        assert_1.default(this._baseState && this._derivedState);\r\n        const oldState = this.state;\r\n        if (baseStateUpdate) {\r\n            this._baseState = this._reduce(this._baseState, baseStateUpdate);\r\n        }\r\n        // Always running this lets us derive state based on passage of time, like baseRate decay\r\n        this._derivedState = this._reduceDerived(this._derivedState, this._derive(this._baseState));\r\n        if (extraStateUpdate) {\r\n            assert_1.default(this._extraState);\r\n            this._extraState = this._reduceExtra(this._extraState, extraStateUpdate);\r\n        }\r\n        this._scheduleUpdate();\r\n        this._notify({\r\n            newState: this.state,\r\n            oldState,\r\n            stateChange: difference(this.state, oldState)\r\n        });\r\n    }\r\n}\r\nexports.LiquityStore = LiquityStore;\r\n//# sourceMappingURL=LiquityStore.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._CachedReadableLiquity = void 0;\r\n/** @internal */\r\nclass _CachedReadableLiquity {\r\n    constructor(readable, cache) {\r\n        this._readable = readable;\r\n        this._cache = cache;\r\n    }\r\n    async getTotalRedistributed(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalRedistributed(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalRedistributed(...extraParams));\r\n    }\r\n    async getTroveBeforeRedistribution(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTroveBeforeRedistribution(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTroveBeforeRedistribution(address, ...extraParams));\r\n    }\r\n    async getTrove(address, ...extraParams) {\r\n        const [troveBeforeRedistribution, totalRedistributed] = await Promise.all([\r\n            this.getTroveBeforeRedistribution(address, ...extraParams),\r\n            this.getTotalRedistributed(...extraParams)\r\n        ]);\r\n        return troveBeforeRedistribution.applyRedistribution(totalRedistributed);\r\n    }\r\n    async getNumberOfTroves(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getNumberOfTroves(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getNumberOfTroves(...extraParams));\r\n    }\r\n    async getPrice(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getPrice(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getPrice(...extraParams);\r\n    }\r\n    async getTotal(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getTotal(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotal(...extraParams);\r\n    }\r\n    async getStabilityDeposit(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getStabilityDeposit(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getStabilityDeposit(address, ...extraParams));\r\n    }\r\n    async getRemainingStabilityPoolLQTYReward(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getRemainingStabilityPoolLQTYReward(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getRemainingStabilityPoolLQTYReward(...extraParams));\r\n    }\r\n    async getLUSDInStabilityPool(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLUSDInStabilityPool(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLUSDInStabilityPool(...extraParams));\r\n    }\r\n    async getLUSDBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLUSDBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLUSDBalance(address, ...extraParams));\r\n    }\r\n    async getLQTYBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLQTYBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLQTYBalance(address, ...extraParams));\r\n    }\r\n    async getUniTokenBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getUniTokenBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getUniTokenBalance(address, ...extraParams));\r\n    }\r\n    async getUniTokenAllowance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getUniTokenAllowance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getUniTokenAllowance(address, ...extraParams));\r\n    }\r\n    async getRemainingLiquidityMiningLQTYReward(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getRemainingLiquidityMiningLQTYReward(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getRemainingLiquidityMiningLQTYReward(...extraParams));\r\n    }\r\n    async getLiquidityMiningStake(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLiquidityMiningStake(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLiquidityMiningStake(address, ...extraParams));\r\n    }\r\n    async getTotalStakedUniTokens(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalStakedUniTokens(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalStakedUniTokens(...extraParams));\r\n    }\r\n    async getLiquidityMiningLQTYReward(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLiquidityMiningLQTYReward(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLiquidityMiningLQTYReward(address, ...extraParams));\r\n    }\r\n    async getCollateralSurplusBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getCollateralSurplusBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getCollateralSurplusBalance(address, ...extraParams));\r\n    }\r\n    async getTroves(params, ...extraParams) {\r\n        var _a;\r\n        const { beforeRedistribution, ...restOfParams } = params;\r\n        const [totalRedistributed, troves] = await Promise.all([\r\n            beforeRedistribution ? undefined : this.getTotalRedistributed(...extraParams),\r\n            (_a = this._cache.getTroves({ beforeRedistribution: true, ...restOfParams }, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTroves({ beforeRedistribution: true, ...restOfParams }, ...extraParams)\r\n        ]);\r\n        if (totalRedistributed) {\r\n            return troves.map(trove => trove.applyRedistribution(totalRedistributed));\r\n        }\r\n        else {\r\n            return troves;\r\n        }\r\n    }\r\n    async getFees(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getFees(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getFees(...extraParams);\r\n    }\r\n    async getLQTYStake(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLQTYStake(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLQTYStake(address, ...extraParams));\r\n    }\r\n    async getTotalStakedLQTY(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalStakedLQTY(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalStakedLQTY(...extraParams));\r\n    }\r\n    async getFrontendStatus(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getFrontendStatus(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getFrontendStatus(address, ...extraParams));\r\n    }\r\n}\r\nexports._CachedReadableLiquity = _CachedReadableLiquity;\r\n//# sourceMappingURL=_CachedReadableLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connectToMulticall = void 0;\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst multicallAbi = [\r\n    {\r\n        constant: true,\r\n        inputs: [],\r\n        name: \"getCurrentBlockTimestamp\",\r\n        outputs: [\r\n            {\r\n                name: \"timestamp\",\r\n                type: \"uint256\"\r\n            }\r\n        ],\r\n        payable: false,\r\n        stateMutability: \"view\",\r\n        type: \"function\"\r\n    }\r\n];\r\nconst multicallAddress = {\r\n    1: \"0xeefba1e63905ef1d7acba5a8513c70307c1ce441\",\r\n    3: \"0x53c43764255c17bd724f74c4ef150724ac50a3ed\",\r\n    4: \"0x42ad527de7d4e9d9d011ac45b31d8551f8fe9821\",\r\n    5: \"0x77dca2c955b15e9de4dbbcf1246b4b85b651e50e\",\r\n    42: \"0x2cc8688c5f75e365aaeeb4ea8d6a480405a48d2a\"\r\n};\r\nconst hasMulticall = (chainId) => chainId in multicallAddress;\r\nconst _connectToMulticall = (signerOrProvider, chainId) => hasMulticall(chainId)\r\n    ? new contracts_1.Contract(multicallAddress[chainId], multicallAbi, signerOrProvider)\r\n    : undefined;\r\nexports._connectToMulticall = _connectToMulticall;\r\n//# sourceMappingURL=_Multicall.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ObservableEthersLiquity = void 0;\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst debouncingDelayMs = 50;\r\nconst debounce = (listener) => {\r\n    let timeoutId = undefined;\r\n    let latestBlock = 0;\r\n    return (...args) => {\r\n        const event = args[args.length - 1];\r\n        if (event.blockNumber !== undefined && event.blockNumber > latestBlock) {\r\n            latestBlock = event.blockNumber;\r\n        }\r\n        if (timeoutId !== undefined) {\r\n            clearTimeout(timeoutId);\r\n        }\r\n        timeoutId = setTimeout(() => {\r\n            listener(latestBlock);\r\n            timeoutId = undefined;\r\n        }, debouncingDelayMs);\r\n    };\r\n};\r\n/** @alpha */\r\nclass ObservableEthersLiquity {\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n    }\r\n    watchTotalRedistributed(onTotalRedistributedChanged) {\r\n        const { activePool, defaultPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const etherSent = activePool.filters.EtherSent();\r\n        const redistributionListener = debounce((blockTag) => {\r\n            this._readable.getTotalRedistributed({ blockTag }).then(onTotalRedistributedChanged);\r\n        });\r\n        const etherSentListener = (toAddress, _amount, event) => {\r\n            if (toAddress === defaultPool.address) {\r\n                redistributionListener(event);\r\n            }\r\n        };\r\n        activePool.on(etherSent, etherSentListener);\r\n        return () => {\r\n            activePool.removeListener(etherSent, etherSentListener);\r\n        };\r\n    }\r\n    watchTroveWithoutRewards(onTroveChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { troveManager, borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const troveUpdatedByTroveManager = troveManager.filters.TroveUpdated(address);\r\n        const troveUpdatedByBorrowerOperations = borrowerOperations.filters.TroveUpdated(address);\r\n        const troveListener = debounce((blockTag) => {\r\n            this._readable.getTroveBeforeRedistribution(address, { blockTag }).then(onTroveChanged);\r\n        });\r\n        troveManager.on(troveUpdatedByTroveManager, troveListener);\r\n        borrowerOperations.on(troveUpdatedByBorrowerOperations, troveListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdatedByTroveManager, troveListener);\r\n            borrowerOperations.removeListener(troveUpdatedByBorrowerOperations, troveListener);\r\n        };\r\n    }\r\n    watchNumberOfTroves(onNumberOfTrovesChanged) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { TroveUpdated } = troveManager.filters;\r\n        const troveUpdated = TroveUpdated();\r\n        const troveUpdatedListener = debounce((blockTag) => {\r\n            this._readable.getNumberOfTroves({ blockTag }).then(onNumberOfTrovesChanged);\r\n        });\r\n        troveManager.on(troveUpdated, troveUpdatedListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdated, troveUpdatedListener);\r\n        };\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    watchPrice(onPriceChanged) {\r\n        // TODO revisit\r\n        // We no longer have our own PriceUpdated events. If we want to implement this in an event-based\r\n        // manner, we'll need to listen to aggregator events directly. Or we could do polling.\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    watchTotal(onTotalChanged) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { TroveUpdated } = troveManager.filters;\r\n        const troveUpdated = TroveUpdated();\r\n        const totalListener = debounce((blockTag) => {\r\n            this._readable.getTotal({ blockTag }).then(onTotalChanged);\r\n        });\r\n        troveManager.on(troveUpdated, totalListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdated, totalListener);\r\n        };\r\n    }\r\n    watchStabilityDeposit(onStabilityDepositChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { activePool, stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { UserDepositChanged } = stabilityPool.filters;\r\n        const { EtherSent } = activePool.filters;\r\n        const userDepositChanged = UserDepositChanged(address);\r\n        const etherSent = EtherSent();\r\n        const depositListener = debounce((blockTag) => {\r\n            this._readable.getStabilityDeposit(address, { blockTag }).then(onStabilityDepositChanged);\r\n        });\r\n        const etherSentListener = (toAddress, _amount, event) => {\r\n            if (toAddress === stabilityPool.address) {\r\n                // Liquidation while Stability Pool has some deposits\r\n                // There may be new gains\r\n                depositListener(event);\r\n            }\r\n        };\r\n        stabilityPool.on(userDepositChanged, depositListener);\r\n        activePool.on(etherSent, etherSentListener);\r\n        return () => {\r\n            stabilityPool.removeListener(userDepositChanged, depositListener);\r\n            activePool.removeListener(etherSent, etherSentListener);\r\n        };\r\n    }\r\n    watchLUSDInStabilityPool(onLUSDInStabilityPoolChanged) {\r\n        const { lusdToken, stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { Transfer } = lusdToken.filters;\r\n        const transferLUSDFromStabilityPool = Transfer(stabilityPool.address);\r\n        const transferLUSDToStabilityPool = Transfer(null, stabilityPool.address);\r\n        const stabilityPoolLUSDFilters = [transferLUSDFromStabilityPool, transferLUSDToStabilityPool];\r\n        const stabilityPoolLUSDListener = debounce((blockTag) => {\r\n            this._readable.getLUSDInStabilityPool({ blockTag }).then(onLUSDInStabilityPoolChanged);\r\n        });\r\n        stabilityPoolLUSDFilters.forEach(filter => lusdToken.on(filter, stabilityPoolLUSDListener));\r\n        return () => stabilityPoolLUSDFilters.forEach(filter => lusdToken.removeListener(filter, stabilityPoolLUSDListener));\r\n    }\r\n    watchLUSDBalance(onLUSDBalanceChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { Transfer } = lusdToken.filters;\r\n        const transferLUSDFromUser = Transfer(address);\r\n        const transferLUSDToUser = Transfer(null, address);\r\n        const lusdTransferFilters = [transferLUSDFromUser, transferLUSDToUser];\r\n        const lusdTransferListener = debounce((blockTag) => {\r\n            this._readable.getLUSDBalance(address, { blockTag }).then(onLUSDBalanceChanged);\r\n        });\r\n        lusdTransferFilters.forEach(filter => lusdToken.on(filter, lusdTransferListener));\r\n        return () => lusdTransferFilters.forEach(filter => lusdToken.removeListener(filter, lusdTransferListener));\r\n    }\r\n}\r\nexports.ObservableEthersLiquity = ObservableEthersLiquity;\r\n//# sourceMappingURL=ObservableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.logsToString = void 0;\r\nconst bignumber_1 = require(\"@ethersproject/bignumber\");\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst interfaceLookupFrom = (contractLookup) => {\r\n    return Object.fromEntries(Object.entries(contractLookup).map(([, contract]) => [contract.address, contract.interface]));\r\n};\r\nconst nameLookupFrom = (contractLookup) => {\r\n    return Object.fromEntries(Object.entries(contractLookup).map(([name, contract]) => [contract.address, name]));\r\n};\r\nconst tryToParseLog = (log, interfaceLookup) => {\r\n    const { address } = log;\r\n    if (address in interfaceLookup) {\r\n        try {\r\n            return { address, logDescription: interfaceLookup[address].parseLog(log) };\r\n        }\r\n        catch (err) {\r\n            console.warn(\"Failed to parse log:\");\r\n            console.warn(log);\r\n            console.warn(\"Caught:\");\r\n            console.warn(err);\r\n        }\r\n    }\r\n};\r\nconst parseLogs = (logs, interfaceLookup) => {\r\n    const parsedLogs = [];\r\n    const unparsedLogs = [];\r\n    logs.forEach(log => {\r\n        const parsedLog = tryToParseLog(log, interfaceLookup);\r\n        if (parsedLog) {\r\n            parsedLogs.push(parsedLog);\r\n        }\r\n        else {\r\n            unparsedLogs.push(log);\r\n        }\r\n    });\r\n    return [parsedLogs, unparsedLogs];\r\n};\r\nconst VERY_BIG = bignumber_1.BigNumber.from(10).pow(9);\r\nconst prettify = (arg, nameLookup) => {\r\n    if (bignumber_1.BigNumber.isBigNumber(arg)) {\r\n        if (arg.gte(VERY_BIG)) {\r\n            return `${lib_base_1.Decimal.fromBigNumberString(arg.toHexString())}e18`;\r\n        }\r\n        else {\r\n            return arg.toString();\r\n        }\r\n    }\r\n    else if (typeof arg === \"string\") {\r\n        return arg === constants_1.AddressZero\r\n            ? \"address(0)\"\r\n            : nameLookup && arg in nameLookup\r\n                ? nameLookup[arg]\r\n                : arg;\r\n    }\r\n    else {\r\n        return String(arg);\r\n    }\r\n};\r\nconst logDescriptionToString = (logDescription, nameLookup) => {\r\n    const prettyEntries = Object.entries(logDescription.args)\r\n        .filter(([key]) => !key.match(/^[0-9]/))\r\n        .map(([key, value]) => `${key}: ${prettify(value, nameLookup)}`);\r\n    return `${logDescription.name}({ ${prettyEntries.join(\", \")} })`;\r\n};\r\nconst logsToString = (receipt, contracts) => {\r\n    const contractLookup = contracts;\r\n    const interfaceLookup = interfaceLookupFrom(contractLookup);\r\n    const contractNameLookup = nameLookupFrom(contractLookup);\r\n    const nameLookup = {\r\n        [receipt.from]: \"user\",\r\n        ...contractNameLookup\r\n    };\r\n    const [parsedLogs, unparsedLogs] = parseLogs(receipt.logs, interfaceLookup);\r\n    if (unparsedLogs.length > 0) {\r\n        console.warn(\"Warning: not all logs were parsed. Unparsed logs:\");\r\n        console.warn(unparsedLogs);\r\n    }\r\n    if (parsedLogs.length > 0) {\r\n        return (`Logs of tx ${receipt.transactionHash}:\\n` +\r\n            parsedLogs\r\n                .map(({ address, logDescription }) => `  ${contractNameLookup[address]}.${logDescriptionToString(logDescription, nameLookup)}`)\r\n                .join(\"\\n\"));\r\n    }\r\n    else {\r\n        return `No logs were parsed in tx ${receipt.transactionHash}`;\r\n    }\r\n};\r\nexports.logsToString = logsToString;\r\n//# sourceMappingURL=parseLogs.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.EthersLiquity = exports.EthersTransactionFailedError = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst PopulatableEthersLiquity_1 = require(\"./PopulatableEthersLiquity\");\r\nconst ReadableEthersLiquity_1 = require(\"./ReadableEthersLiquity\");\r\nconst SendableEthersLiquity_1 = require(\"./SendableEthersLiquity\");\r\n/**\r\n * Thrown by {@link EthersLiquity} in case of transaction failure.\r\n *\r\n * @public\r\n */\r\nclass EthersTransactionFailedError extends lib_base_1.TransactionFailedError {\r\n    constructor(message, failedReceipt) {\r\n        super(\"EthersTransactionFailedError\", message, failedReceipt);\r\n    }\r\n}\r\nexports.EthersTransactionFailedError = EthersTransactionFailedError;\r\nconst waitForSuccess = async (tx) => {\r\n    const receipt = await tx.waitForReceipt();\r\n    if (receipt.status !== \"succeeded\") {\r\n        throw new EthersTransactionFailedError(\"Transaction failed\", receipt);\r\n    }\r\n    return receipt.details;\r\n};\r\n/**\r\n * Convenience class that combines multiple interfaces of the library in one object.\r\n *\r\n * @public\r\n */\r\nclass EthersLiquity {\r\n    /** @internal */\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n        this.connection = readable.connection;\r\n        this.populate = new PopulatableEthersLiquity_1.PopulatableEthersLiquity(readable);\r\n        this.send = new SendableEthersLiquity_1.SendableEthersLiquity(this.populate);\r\n    }\r\n    /** @internal */\r\n    static _from(connection) {\r\n        if (EthersLiquityConnection_1._usingStore(connection)) {\r\n            return new _EthersLiquityWithStore(ReadableEthersLiquity_1.ReadableEthersLiquity._from(connection));\r\n        }\r\n        else {\r\n            return new EthersLiquity(ReadableEthersLiquity_1.ReadableEthersLiquity._from(connection));\r\n        }\r\n    }\r\n    static async connect(signerOrProvider, optionalParams) {\r\n        return EthersLiquity._from(await EthersLiquityConnection_1._connect(signerOrProvider, optionalParams));\r\n    }\r\n    hasStore() {\r\n        return false;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalRedistributed} */\r\n    getTotalRedistributed(overrides) {\r\n        return this._readable.getTotalRedistributed(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTroveBeforeRedistribution} */\r\n    getTroveBeforeRedistribution(address, overrides) {\r\n        return this._readable.getTroveBeforeRedistribution(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTrove} */\r\n    getTrove(address, overrides) {\r\n        return this._readable.getTrove(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getNumberOfTroves} */\r\n    getNumberOfTroves(overrides) {\r\n        return this._readable.getNumberOfTroves(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getPrice} */\r\n    getPrice(overrides) {\r\n        return this._readable.getPrice(overrides);\r\n    }\r\n    /** @internal */\r\n    _getActivePool(overrides) {\r\n        return this._readable._getActivePool(overrides);\r\n    }\r\n    /** @internal */\r\n    _getDefaultPool(overrides) {\r\n        return this._readable._getDefaultPool(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotal} */\r\n    getTotal(overrides) {\r\n        return this._readable.getTotal(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getStabilityDeposit} */\r\n    getStabilityDeposit(address, overrides) {\r\n        return this._readable.getStabilityDeposit(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingStabilityPoolLQTYReward} */\r\n    getRemainingStabilityPoolLQTYReward(overrides) {\r\n        return this._readable.getRemainingStabilityPoolLQTYReward(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDInStabilityPool} */\r\n    getLUSDInStabilityPool(overrides) {\r\n        return this._readable.getLUSDInStabilityPool(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDBalance} */\r\n    getLUSDBalance(address, overrides) {\r\n        return this._readable.getLUSDBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYBalance} */\r\n    getLQTYBalance(address, overrides) {\r\n        return this._readable.getLQTYBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenBalance} */\r\n    getUniTokenBalance(address, overrides) {\r\n        return this._readable.getUniTokenBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenAllowance} */\r\n    getUniTokenAllowance(address, overrides) {\r\n        return this._readable.getUniTokenAllowance(address, overrides);\r\n    }\r\n    /** @internal */\r\n    _getRemainingLiquidityMiningLQTYRewardCalculator(overrides) {\r\n        return this._readable._getRemainingLiquidityMiningLQTYRewardCalculator(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingLiquidityMiningLQTYReward} */\r\n    getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        return this._readable.getRemainingLiquidityMiningLQTYReward(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningStake} */\r\n    getLiquidityMiningStake(address, overrides) {\r\n        return this._readable.getLiquidityMiningStake(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedUniTokens} */\r\n    getTotalStakedUniTokens(overrides) {\r\n        return this._readable.getTotalStakedUniTokens(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningLQTYReward} */\r\n    getLiquidityMiningLQTYReward(address, overrides) {\r\n        return this._readable.getLiquidityMiningLQTYReward(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getCollateralSurplusBalance} */\r\n    getCollateralSurplusBalance(address, overrides) {\r\n        return this._readable.getCollateralSurplusBalance(address, overrides);\r\n    }\r\n    getTroves(params, overrides) {\r\n        return this._readable.getTroves(params, overrides);\r\n    }\r\n    /** @internal */\r\n    _getBlockTimestamp(blockTag) {\r\n        return this._readable._getBlockTimestamp(blockTag);\r\n    }\r\n    /** @internal */\r\n    _getFeesFactory(overrides) {\r\n        return this._readable._getFeesFactory(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFees} */\r\n    getFees(overrides) {\r\n        return this._readable.getFees(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYStake} */\r\n    getLQTYStake(address, overrides) {\r\n        return this._readable.getLQTYStake(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedLQTY} */\r\n    getTotalStakedLQTY(overrides) {\r\n        return this._readable.getTotalStakedLQTY(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFrontendStatus} */\r\n    getFrontendStatus(address, overrides) {\r\n        return this._readable.getFrontendStatus(address, overrides);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.openTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this.send\r\n            .openTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.closeTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    closeTrove(overrides) {\r\n        return this.send.closeTrove(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.adjustTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this.send\r\n            .adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.depositCollateral}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    depositCollateral(amount, overrides) {\r\n        return this.send.depositCollateral(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawCollateral}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this.send.withdrawCollateral(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.borrowLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this.send.borrowLUSD(amount, maxBorrowingRate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.repayLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    repayLUSD(amount, overrides) {\r\n        return this.send.repayLUSD(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /** @internal */\r\n    setPrice(price, overrides) {\r\n        return this.send.setPrice(price, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.liquidate}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    liquidate(address, overrides) {\r\n        return this.send.liquidate(address, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.liquidateUpTo}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        return this.send.liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.depositLUSDInStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        return this.send.depositLUSDInStabilityPool(amount, frontendTag, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawLUSDFromStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        return this.send.withdrawLUSDFromStabilityPool(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawGainsFromStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawGainsFromStabilityPool(overrides) {\r\n        return this.send.withdrawGainsFromStabilityPool(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.transferCollateralGainToTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    transferCollateralGainToTrove(overrides) {\r\n        return this.send.transferCollateralGainToTrove(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.sendLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    sendLUSD(toAddress, amount, overrides) {\r\n        return this.send.sendLUSD(toAddress, amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.sendLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    sendLQTY(toAddress, amount, overrides) {\r\n        return this.send.sendLQTY(toAddress, amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.redeemLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        return this.send.redeemLUSD(amount, maxRedemptionRate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.claimCollateralSurplus}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    claimCollateralSurplus(overrides) {\r\n        return this.send.claimCollateralSurplus(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.stakeLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    stakeLQTY(amount, overrides) {\r\n        return this.send.stakeLQTY(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.unstakeLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    unstakeLQTY(amount, overrides) {\r\n        return this.send.unstakeLQTY(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawGainsFromStaking}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this.send.withdrawGainsFromStaking(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.registerFrontend}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    registerFrontend(kickbackRate, overrides) {\r\n        return this.send.registerFrontend(kickbackRate, overrides).then(waitForSuccess);\r\n    }\r\n    /** @internal */\r\n    _mintUniToken(amount, address, overrides) {\r\n        return this.send._mintUniToken(amount, address, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.approveUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    approveUniTokens(allowance, overrides) {\r\n        return this.send.approveUniTokens(allowance, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.stakeUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    stakeUniTokens(amount, overrides) {\r\n        return this.send.stakeUniTokens(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.unstakeUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    unstakeUniTokens(amount, overrides) {\r\n        return this.send.unstakeUniTokens(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawLQTYRewardFromLiquidityMining}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        return this.send.withdrawLQTYRewardFromLiquidityMining(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.exitLiquidityMining}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    exitLiquidityMining(overrides) {\r\n        return this.send.exitLiquidityMining(overrides).then(waitForSuccess);\r\n    }\r\n}\r\nexports.EthersLiquity = EthersLiquity;\r\nclass _EthersLiquityWithStore extends EthersLiquity {\r\n    constructor(readable) {\r\n        super(readable);\r\n        this.store = readable.store;\r\n    }\r\n    hasStore(store) {\r\n        return store === undefined || store === this.connection.useStore;\r\n    }\r\n}\r\n//# sourceMappingURL=EthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquityReducer = void 0;\r\nconst react_1 = require(\"react\");\r\nconst equals_1 = require(\"../utils/equals\");\r\nconst useLiquityStore_1 = require(\"./useLiquityStore\");\r\nconst useLiquityReducer = (reduce, init) => {\r\n    const store = useLiquityStore_1.useLiquityStore();\r\n    const oldStore = react_1.useRef(store);\r\n    const state = react_1.useRef(init(store.state));\r\n    const [, rerender] = react_1.useReducer(() => ({}), {});\r\n    const dispatch = react_1.useCallback((action) => {\r\n        const newState = reduce(state.current, action);\r\n        if (!equals_1.equals(newState, state.current)) {\r\n            state.current = newState;\r\n            rerender();\r\n        }\r\n    }, [reduce]);\r\n    react_1.useEffect(() => store.subscribe(params => dispatch({ type: \"updateStore\", ...params })), [\r\n        store,\r\n        dispatch\r\n    ]);\r\n    if (oldStore.current !== store) {\r\n        state.current = init(store.state);\r\n        oldStore.current = store;\r\n    }\r\n    return [state.current, dispatch];\r\n};\r\nexports.useLiquityReducer = useLiquityReducer;\r\n//# sourceMappingURL=useLiquityReducer.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquitySelector = void 0;\r\nconst react_1 = require(\"react\");\r\nconst equals_1 = require(\"../utils/equals\");\r\nconst useLiquityStore_1 = require(\"./useLiquityStore\");\r\nconst useLiquitySelector = (select) => {\r\n    const store = useLiquityStore_1.useLiquityStore();\r\n    const [, rerender] = react_1.useReducer(() => ({}), {});\r\n    react_1.useEffect(() => store.subscribe(({ newState, oldState }) => {\r\n        if (!equals_1.equals(select(newState), select(oldState))) {\r\n            rerender();\r\n        }\r\n    }), [store, select]);\r\n    return select(store.state);\r\n};\r\nexports.useLiquitySelector = useLiquitySelector;\r\n//# sourceMappingURL=useLiquitySelector.js.map","import { AddressZero } from \"@ethersproject/constants\";\r\nimport { isAddress, getAddress } from \"@ethersproject/address\";\r\n\r\nexport type LiquityFrontendConfig = {\r\n  frontendTag: string;\r\n  infuraApiKey?: string;\r\n  testnetOnly?: boolean;\r\n};\r\n\r\nconst defaultConfig: LiquityFrontendConfig = {\r\n  frontendTag: AddressZero\r\n};\r\n\r\nfunction hasKey<K extends string>(o: object, k: K): o is Record<K, unknown> {\r\n  return k in o;\r\n}\r\n\r\nconst parseConfig = (json: unknown): LiquityFrontendConfig => {\r\n  const config = { ...defaultConfig };\r\n\r\n  if (typeof json === \"object\" && json !== null) {\r\n    if (hasKey(json, \"frontendTag\") && json.frontendTag !== \"\") {\r\n      const { frontendTag } = json;\r\n\r\n      if (typeof frontendTag === \"string\" && isAddress(frontendTag)) {\r\n        config.frontendTag = getAddress(frontendTag);\r\n      } else {\r\n        console.error(\"Malformed frontendTag:\");\r\n        console.log(frontendTag);\r\n      }\r\n    }\r\n\r\n    if (hasKey(json, \"infuraApiKey\") && json.infuraApiKey !== \"\") {\r\n      const { infuraApiKey } = json;\r\n\r\n      if (typeof infuraApiKey === \"string\") {\r\n        config.infuraApiKey = infuraApiKey;\r\n      } else {\r\n        console.error(\"Malformed infuraApiKey:\");\r\n        console.log(infuraApiKey);\r\n      }\r\n    }\r\n\r\n    if (hasKey(json, \"testnetOnly\")) {\r\n      const { testnetOnly } = json;\r\n\r\n      if (typeof testnetOnly === \"boolean\") {\r\n        config.testnetOnly = testnetOnly;\r\n      } else {\r\n        console.error(\"Malformed testnetOnly:\");\r\n        console.log(testnetOnly);\r\n      }\r\n    }\r\n  } else {\r\n    console.error(\"Malformed config:\");\r\n    console.log(json);\r\n  }\r\n\r\n  return config;\r\n};\r\n\r\nlet configPromise: Promise<LiquityFrontendConfig> | undefined = undefined;\r\n\r\nconst fetchConfig = async () => {\r\n  try {\r\n    const response = await fetch(\"config.json\");\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch config.json (status ${response.status})`);\r\n    }\r\n\r\n    return parseConfig(await response.json());\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { ...defaultConfig };\r\n  }\r\n};\r\n\r\nexport const getConfig = (): Promise<LiquityFrontendConfig> => {\r\n  if (!configPromise) {\r\n    configPromise = fetchConfig();\r\n  }\r\n\r\n  return configPromise;\r\n};\r\n","import React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { Provider } from \"@ethersproject/abstract-provider\";\r\nimport { getNetwork } from \"@ethersproject/networks\";\r\nimport { Web3Provider } from \"@ethersproject/providers\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\n\r\nimport { isBatchedProvider, isWebSocketAugmentedProvider } from \"@liquity/providers\";\r\nimport {\r\n  BlockPolledLiquityStore,\r\n  EthersLiquity,\r\n  EthersLiquityWithStore,\r\n  _connectByChainId\r\n} from \"@liquity/lib-ethers\";\r\n\r\nimport { LiquityFrontendConfig, getConfig } from \"../config\";\r\n\r\ntype LiquityContextValue = {\r\n  config: LiquityFrontendConfig;\r\n  account: string;\r\n  provider: Provider;\r\n  liquity: EthersLiquityWithStore<BlockPolledLiquityStore>;\r\n};\r\n\r\nconst LiquityContext = createContext<LiquityContextValue | undefined>(undefined);\r\n\r\ntype LiquityProviderProps = {\r\n  loader?: React.ReactNode;\r\n  unsupportedNetworkFallback?: (chainId: number) => React.ReactNode;\r\n  unsupportedMainnetFallback?: React.ReactNode;\r\n};\r\n\r\nconst wsParams = (network: string, infuraApiKey: string): [string, string] => [\r\n  `wss://${network === \"homestead\" ? \"mainnet\" : network}.infura.io/ws/v3/${infuraApiKey}`,\r\n  network\r\n];\r\n\r\nconst webSocketSupportedNetworks = [\"homestead\", \"kovan\", \"rinkeby\", \"ropsten\", \"goerli\"];\r\n\r\nexport const LiquityProvider: React.FC<LiquityProviderProps> = ({\r\n  children,\r\n  loader,\r\n  unsupportedNetworkFallback,\r\n  unsupportedMainnetFallback\r\n}) => {\r\n  const { library: provider, account, chainId } = useWeb3React<Web3Provider>();\r\n  const [config, setConfig] = useState<LiquityFrontendConfig>();\r\n\r\n  const connection = useMemo(() => {\r\n    if (config && provider && account && chainId) {\r\n      try {\r\n        return _connectByChainId(provider, provider.getSigner(account), chainId, {\r\n          userAddress: account,\r\n          frontendTag: config.frontendTag,\r\n          useStore: \"blockPolled\"\r\n        });\r\n      } catch {}\r\n    }\r\n  }, [config, provider, account, chainId]);\r\n\r\n  useEffect(() => {\r\n    getConfig().then(setConfig);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (config && connection) {\r\n      const { provider, chainId } = connection;\r\n\r\n      if (isBatchedProvider(provider) && provider.chainId !== chainId) {\r\n        provider.chainId = chainId;\r\n      }\r\n\r\n      if (isWebSocketAugmentedProvider(provider)) {\r\n        const network = getNetwork(chainId);\r\n\r\n        if (\r\n          network.name &&\r\n          webSocketSupportedNetworks.includes(network.name) &&\r\n          config.infuraApiKey\r\n        ) {\r\n          provider.openWebSocket(...wsParams(network.name, config.infuraApiKey));\r\n        } else if (connection._isDev) {\r\n          provider.openWebSocket(`ws://${window.location.hostname}:8546`, chainId);\r\n        }\r\n\r\n        return () => {\r\n          provider.closeWebSocket();\r\n        };\r\n      }\r\n    }\r\n  }, [config, connection]);\r\n\r\n  if (!config || !provider || !account || !chainId) {\r\n    return <>{loader}</>;\r\n  }\r\n\r\n  if (config.testnetOnly && chainId === 1) {\r\n    return <>{unsupportedMainnetFallback}</>;\r\n  }\r\n\r\n  if (!connection) {\r\n    return unsupportedNetworkFallback ? <>{unsupportedNetworkFallback(chainId)}</> : null;\r\n  }\r\n\r\n  const liquity = EthersLiquity._from(connection);\r\n  liquity.store.logging = true;\r\n\r\n  return (\r\n    <LiquityContext.Provider value={{ config, account, provider, liquity }}>\r\n      {children}\r\n    </LiquityContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useLiquity = () => {\r\n  const liquityContext = useContext(LiquityContext);\r\n\r\n  if (!liquityContext) {\r\n    throw new Error(\"You must provide a LiquityContext via LiquityProvider\");\r\n  }\r\n\r\n  return liquityContext;\r\n};\r\n","import { InjectedConnector } from \"@web3-react/injected-connector\";\r\n\r\nexport const injectedConnector = new InjectedConnector({});\r\n","import React from \"react\";\r\nimport { library, IconName, IconProp } from \"@fortawesome/fontawesome-svg-core\";\r\nimport {\r\n  faCircleNotch,\r\n  faCheckCircle,\r\n  faExclamationTriangle,\r\n  faInfoCircle,\r\n  faTimes,\r\n  faTrash,\r\n  faChartLine,\r\n  faRedo,\r\n  faHistory,\r\n  faChevronLeft,\r\n  faChevronRight,\r\n  faUserCircle,\r\n  faWallet,\r\n  faExternalLinkAlt,\r\n  faClipboardCheck,\r\n  faCog,\r\n  faCheck,\r\n  faPlug,\r\n  faExclamationCircle,\r\n  faAngleUp,\r\n  faAngleDoubleUp,\r\n  faAngleDown,\r\n  faAngleDoubleDown,\r\n  faPen,\r\n  faHandPaper,\r\n  faHeartbeat,\r\n  faBars\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\nimport { faClipboard, faQuestionCircle } from \"@fortawesome/free-regular-svg-icons\";\r\nimport { FontAwesomeIcon, FontAwesomeIconProps } from \"@fortawesome/react-fontawesome\";\r\n\r\nlibrary.add(\r\n  faCircleNotch,\r\n  faCheck,\r\n  faCheckCircle,\r\n  faExclamationTriangle,\r\n  faInfoCircle,\r\n  faTimes,\r\n  faTrash,\r\n  faChartLine,\r\n  faRedo,\r\n  faHistory,\r\n  faChevronLeft,\r\n  faChevronRight,\r\n  faClipboard,\r\n  faClipboardCheck,\r\n  faUserCircle,\r\n  faWallet,\r\n  faExternalLinkAlt,\r\n  faCog,\r\n  faPlug,\r\n  faExclamationCircle,\r\n  faAngleUp,\r\n  faAngleDoubleUp,\r\n  faAngleDown,\r\n  faAngleDoubleDown,\r\n  faPen,\r\n  faHandPaper,\r\n  faHeartbeat,\r\n  faBars,\r\n  faQuestionCircle\r\n);\r\n\r\nconst getIcon = (name: IconName): IconProp => {\r\n  switch (name) {\r\n    case \"clipboard\":\r\n      return [\"far\", \"clipboard\"];\r\n    case \"question-circle\":\r\n      return [\"far\", \"question-circle\"];\r\n    default:\r\n      return name;\r\n  }\r\n};\r\n\r\nexport type IconProps = Pick<FontAwesomeIconProps, \"style\" | \"size\" | \"color\" | \"spin\"> & {\r\n  name: IconName;\r\n};\r\n\r\nexport const Icon: React.FC<IconProps> = ({ name, style, ...rest }) => (\r\n  <FontAwesomeIcon style={style} icon={getIcon(name)} {...rest} />\r\n);\r\n","import React from \"react\";\r\nimport { Heading, Flex, Card, Button, Box } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\ntype DialogIntent = \"success\" | \"warning\" | \"danger\" | \"info\";\r\n\r\ntype DialogProps = {\r\n  intent?: DialogIntent;\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  cancelLabel?: string;\r\n  onCancel: () => void;\r\n};\r\n\r\nconst iconFromIntent = (intent: DialogIntent | undefined) => {\r\n  switch (intent) {\r\n    case \"success\":\r\n      return <Icon name=\"check-circle\" color=\"success\" aria-label=\"Success\" />;\r\n    case \"warning\":\r\n      return <Icon name=\"exclamation-triangle\" color=\"warning\" aria-label=\"Warning\" />;\r\n    case \"danger\":\r\n      return <Icon name=\"exclamation-triangle\" color=\"danger\" aria-label=\"Danger\" />;\r\n    case \"info\":\r\n      return <Icon name=\"info-circle\" color=\"info\" aria-label=\"Info\" />;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const Dialog: React.FC<DialogProps> = ({\r\n  intent,\r\n  title,\r\n  icon,\r\n  cancelLabel,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <Card sx={{ p: 0, borderRadius: \"4px\" }}>\r\n    {intent ? <Box sx={{ height: \"4px\", bg: intent, borderRadius: \"3px 3px 0 0\" }} /> : null}\r\n    <Flex\r\n      sx={{\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n        borderBottom: 1,\r\n        borderColor: \"muted\",\r\n        p: [3, 4],\r\n        pb: 3\r\n      }}\r\n    >\r\n      {icon || iconFromIntent(intent)}\r\n      <Heading as=\"h1\" sx={{ textAlign: \"center\", fontSize: [2, 3], px: [3, 0] }}>\r\n        {title}\r\n      </Heading>\r\n      <Button variant=\"icon\" onClick={onCancel}>\r\n        <Icon name=\"times\" size=\"lg\" aria-label={cancelLabel || \"Cancel\"} />\r\n      </Button>\r\n    </Flex>\r\n    {children}\r\n  </Card>\r\n);\r\n","import React from \"react\";\r\nimport { Box, Button, Flex } from \"theme-ui\";\r\n\r\nimport { Dialog } from \"./Dialog\";\r\n\r\ntype RetryDialogProps = {\r\n  title: string;\r\n  cancelLabel?: string;\r\n  retryLabel?: string;\r\n  onCancel: () => void;\r\n  onRetry: () => void;\r\n};\r\n\r\nexport const RetryDialog: React.FC<RetryDialogProps> = ({\r\n  title,\r\n  cancelLabel,\r\n  onCancel,\r\n  retryLabel,\r\n  onRetry,\r\n  children\r\n}) => (\r\n  <Dialog intent=\"danger\" title={title} cancelLabel={cancelLabel} onCancel={onCancel}>\r\n    <Box sx={{ p: [3, 4] }}>{children}</Box>\r\n    <Flex\r\n      sx={{\r\n        p: [3, 4],\r\n        borderTop: 1,\r\n        borderColor: \"muted\",\r\n        justifyContent: \"flex-end\",\r\n        flexDirection: [\"column\", \"row\"],\r\n        alignItems: \"center\"\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"danger\"\r\n        sx={{\r\n          mr: [0, 3],\r\n          mb: [2, 0],\r\n          width: [\"100%\", \"auto\"]\r\n        }}\r\n        onClick={onCancel}\r\n      >\r\n        {cancelLabel || \"Cancel\"}\r\n      </Button>\r\n      <Button sx={{ width: [\"100%\", \"auto\"] }} onClick={onRetry}>\r\n        {retryLabel || \"Retry\"}\r\n      </Button>\r\n    </Flex>\r\n  </Dialog>\r\n);\r\n","import React from \"react\";\r\nimport { Box, Flex, Spinner } from \"theme-ui\";\r\n\r\nimport { Dialog } from \"./Dialog\";\r\n\r\ntype WaitingDialogProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  waitReason: React.ReactNode;\r\n  cancelLabel?: string;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport const WaitingDialog: React.FC<WaitingDialogProps> = ({\r\n  title,\r\n  icon,\r\n  waitReason,\r\n  cancelLabel,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <Dialog title={title} icon={icon} cancelLabel={cancelLabel} onCancel={onCancel}>\r\n    {children}\r\n    <Box sx={{ px: [3, 4], pb: [3, 4] }}>\r\n      <Flex\r\n        sx={{\r\n          flexDirection: [\"column\", \"row\"],\r\n          bg: \"muted\",\r\n          p: [3, 4],\r\n          alignItems: [\"center\", \"auto\"]\r\n        }}\r\n      >\r\n        <Spinner size=\"3em\" sx={{ mr: [0, 3], mb: [2, 0] }} />\r\n        <Flex sx={{ flexDirection: \"column\", alignItems: [\"center\", \"flex-start\"] }}>\r\n          {waitReason}\r\n        </Flex>\r\n      </Flex>\r\n    </Box>\r\n  </Dialog>\r\n);\r\n","import React from \"react\";\r\nimport { Text, Box } from \"theme-ui\";\r\n\r\nimport { WaitingDialog } from \"./WaitingDialog\";\r\n\r\ntype ConnectionConfirmationDialogProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport const ConnectionConfirmationDialog: React.FC<ConnectionConfirmationDialogProps> = ({\r\n  title,\r\n  icon,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <WaitingDialog\r\n    title={title}\r\n    icon={icon}\r\n    waitReason={\r\n      <>\r\n        <Text sx={{ fontWeight: \"bold\" }}>Waiting for connection confirmation...</Text>\r\n        <Text>This wont cost you any Ether</Text>\r\n      </>\r\n    }\r\n    cancelLabel=\"Cancel connection\"\r\n    onCancel={onCancel}\r\n  >\r\n    <Box sx={{ p: [3, 4] }}>{children}</Box>\r\n  </WaitingDialog>\r\n);\r\n","import React from \"react\";\r\n\r\nexport const MetaMaskIcon: React.FC = () => (\r\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <title>MetaMask extension icon</title>\r\n    <path\r\n      d=\"M8.49025 3.49976L1.49216 0.499756L0.492432 3.49976L2.49189 11.9998L21.4867 11.4998L23.4861 3.49976L21.9866 0.499756L15.4883 3.49976H8.49025Z\"\r\n      fill=\"#763D16\"\r\n    />\r\n    <path d=\"M6.99048 11.9998H17.9875V18.9998H6.99048V11.9998Z\" fill=\"#333333\" />\r\n    <rect x=\"7.99023\" y=\"16.9998\" width=\"5.99836\" height=\"3\" fill=\"#333333\" />\r\n    <path\r\n      d=\"M1.58124 10.6642C1.72755 10.8311 1.76935 11.0607 1.70665 11.2485L0.222731 15.8398C0.18093 15.9651 0.18093 16.0903 0.222731 16.1946L1.51854 20.6398C1.62304 20.9738 1.95745 21.1616 2.27095 21.0572L6.7227 19.8259C6.9108 19.7633 7.1198 19.8259 7.287 19.9511L8.06031 20.5772C8.08121 20.5981 8.08121 20.5981 8.10211 20.5981L10.0249 21.9338C10.1294 21.9964 10.2548 22.0381 10.3802 22.0381H13.5989C13.7243 22.0381 13.8497 21.9964 13.9542 21.9338L15.877 20.5981C15.8979 20.5981 15.8979 20.5772 15.9188 20.5772L16.6921 19.9511C16.8384 19.8259 17.0474 19.7842 17.2564 19.8259L21.7081 21.0572C22.0426 21.1407 22.377 20.9529 22.4606 20.6398L23.7564 16.1946C23.7982 16.0694 23.7982 15.9442 23.7564 15.8398L22.2725 11.2485C22.2098 11.0398 22.2516 10.8311 22.3979 10.6642L23.9863 3.54766C24.0072 3.44331 24.0072 3.33897 23.9654 3.23462L23.0249 0.417226C22.9204 0.0833133 22.5442 -0.0836433 22.2098 0.0415742L15.2709 2.6294C15.2082 2.65027 15.1246 2.67114 15.0619 2.67114H8.91722C8.83362 2.67114 8.77092 2.65027 8.70822 2.6294L1.76935 0.0415742C1.43494 -0.0836433 1.05874 0.0833133 0.954238 0.417226L0.0346286 3.23462C-0.00717182 3.3181 -0.00717182 3.44331 0.0137284 3.54766L1.58124 10.6642ZM13.996 14.2537L14.5185 13.1685C14.5812 13.0433 14.7484 12.9807 14.8738 13.0433L16.1278 13.6068C16.3577 13.7111 16.3368 14.0451 16.086 14.1285L14.3304 14.6503C14.1005 14.7129 13.8915 14.4833 13.996 14.2537ZM13.8915 6.71984C13.7661 6.61549 13.7661 6.40679 13.9124 6.32331L21.8126 0.918096C21.9381 0.834618 22.1262 0.876357 22.1889 1.04331L23.1712 3.73549C23.1921 3.77723 23.1921 3.81897 23.1712 3.88157L21.5618 10.0798C21.52 10.2051 21.3946 10.2677 21.2692 10.2259L16.922 9.05723C16.8802 9.05723 16.8593 9.03636 16.8384 9.01549L13.8915 6.71984ZM10.0667 19.5338L10.213 18.3233C10.213 18.2607 10.2548 18.1981 10.3175 18.1564L10.6101 17.9477C10.6519 17.9268 10.6937 17.9059 10.7355 17.9059H13.2018C13.2436 17.9059 13.3063 17.9268 13.3272 17.9477L13.6198 18.1564C13.6825 18.1981 13.7034 18.2607 13.7243 18.3233L13.8497 19.5338C13.8706 19.6798 13.7452 19.8051 13.6198 19.8051H10.2757C10.1712 19.8051 10.0667 19.6798 10.0667 19.5338ZM7.85131 13.6068L9.10532 13.0433C9.25162 12.9807 9.39792 13.0433 9.46062 13.1685L9.98313 14.2537C10.0876 14.4624 9.87863 14.692 9.64873 14.6294L7.87221 14.1077C7.64231 14.0451 7.62141 13.7111 7.85131 13.6068ZM0.807936 3.86071C0.787036 3.81897 0.807936 3.75636 0.807936 3.71462L1.79025 1.04331C1.85295 0.897226 2.04105 0.834618 2.16645 0.918096L10.0667 6.32331C10.213 6.42766 10.213 6.61549 10.0876 6.71984L7.1407 9.01549C7.1198 9.03636 7.078 9.05723 7.0571 9.05723L2.70986 10.2259C2.58445 10.2677 2.45905 10.2051 2.41725 10.0798L0.807936 3.86071Z\"\r\n      fill=\"#F36D34\"\r\n    />\r\n  </svg>\r\n);\r\n","import React from \"react\";\r\nimport { Container } from \"theme-ui\";\r\n\r\nexport const Modal: React.FC = ({ children }) => (\r\n  <Container variant=\"modalOverlay\">\r\n    <Container variant=\"modal\">{children}</Container>\r\n  </Container>\r\n);\r\n","import React, { useEffect, useReducer } from \"react\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\nimport { AbstractConnector } from \"@web3-react/abstract-connector\";\r\nimport { Button, Text, Flex, Link, Box } from \"theme-ui\";\r\n\r\nimport { injectedConnector } from \"../connectors/injectedConnector\";\r\nimport { useAuthorizedConnection } from \"../hooks/useAuthorizedConnection\";\r\n\r\nimport { RetryDialog } from \"./RetryDialog\";\r\nimport { ConnectionConfirmationDialog } from \"./ConnectionConfirmationDialog\";\r\nimport { MetaMaskIcon } from \"./MetaMaskIcon\";\r\nimport { Icon } from \"./Icon\";\r\nimport { Modal } from \"./Modal\";\r\n\r\ninterface MaybeHasMetaMask {\r\n  ethereum?: {\r\n    isMetaMask?: boolean;\r\n  };\r\n}\r\n\r\ntype ConnectionState =\r\n  | { type: \"inactive\" }\r\n  | {\r\n      type: \"activating\" | \"active\" | \"rejectedByUser\" | \"alreadyPending\" | \"failed\";\r\n      connector: AbstractConnector;\r\n    };\r\n\r\ntype ConnectionAction =\r\n  | { type: \"startActivating\"; connector: AbstractConnector }\r\n  | { type: \"fail\"; error: Error }\r\n  | { type: \"finishActivating\" | \"retry\" | \"cancel\" | \"deactivate\" };\r\n\r\nconst connectionReducer: React.Reducer<ConnectionState, ConnectionAction> = (state, action) => {\r\n  switch (action.type) {\r\n    case \"startActivating\":\r\n      return {\r\n        type: \"activating\",\r\n        connector: action.connector\r\n      };\r\n    case \"finishActivating\":\r\n      return {\r\n        type: \"active\",\r\n        connector: state.type === \"inactive\" ? injectedConnector : state.connector\r\n      };\r\n    case \"fail\":\r\n      if (state.type !== \"inactive\") {\r\n        return {\r\n          type: action.error.message.match(/user rejected/i)\r\n            ? \"rejectedByUser\"\r\n            : action.error.message.match(/already pending/i)\r\n            ? \"alreadyPending\"\r\n            : \"failed\",\r\n          connector: state.connector\r\n        };\r\n      }\r\n      break;\r\n    case \"retry\":\r\n      if (state.type !== \"inactive\") {\r\n        return {\r\n          type: \"activating\",\r\n          connector: state.connector\r\n        };\r\n      }\r\n      break;\r\n    case \"cancel\":\r\n      return {\r\n        type: \"inactive\"\r\n      };\r\n    case \"deactivate\":\r\n      return {\r\n        type: \"inactive\"\r\n      };\r\n  }\r\n\r\n  console.warn(\"Ignoring connectionReducer action:\");\r\n  console.log(action);\r\n  console.log(\"  in state:\");\r\n  console.log(state);\r\n\r\n  return state;\r\n};\r\n\r\nconst detectMetaMask = () => (window as MaybeHasMetaMask).ethereum?.isMetaMask ?? false;\r\n\r\ntype WalletConnectorProps = {\r\n  loader?: React.ReactNode;\r\n};\r\n\r\nexport const WalletConnector: React.FC<WalletConnectorProps> = ({ children, loader }) => {\r\n  const { activate, deactivate, active, error } = useWeb3React<unknown>();\r\n  const triedAuthorizedConnection = useAuthorizedConnection();\r\n  const [connectionState, dispatch] = useReducer(connectionReducer, { type: \"inactive\" });\r\n  const isMetaMask = detectMetaMask();\r\n\r\n  useEffect(() => {\r\n    if (error) {\r\n      dispatch({ type: \"fail\", error });\r\n      deactivate();\r\n    }\r\n  }, [error, deactivate]);\r\n\r\n  useEffect(() => {\r\n    if (active) {\r\n      dispatch({ type: \"finishActivating\" });\r\n    } else {\r\n      dispatch({ type: \"deactivate\" });\r\n    }\r\n  }, [active]);\r\n\r\n  if (!triedAuthorizedConnection) {\r\n    return <>{loader}</>;\r\n  }\r\n\r\n  if (connectionState.type === \"active\") {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Flex sx={{ height: \"100vh\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n        <Button\r\n          onClick={() => {\r\n            dispatch({ type: \"startActivating\", connector: injectedConnector });\r\n            activate(injectedConnector);\r\n          }}\r\n        >\r\n          {isMetaMask ? (\r\n            <>\r\n              <MetaMaskIcon />\r\n              <Box sx={{ ml: 2 }}>Connect to MetaMask</Box>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Icon name=\"plug\" size=\"lg\" />\r\n              <Box sx={{ ml: 2 }}>Connect wallet</Box>\r\n            </>\r\n          )}\r\n        </Button>\r\n      </Flex>\r\n\r\n      {connectionState.type === \"failed\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title={isMetaMask ? \"Failed to connect to MetaMask\" : \"Failed to connect wallet\"}\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Box sx={{ textAlign: \"center\" }}>\r\n              You might need to install MetaMask or use a different browser.\r\n            </Box>\r\n            <Link sx={{ lineHeight: 3 }} href=\"https://metamask.io/download.html\" target=\"_blank\">\r\n              Learn more <Icon size=\"xs\" name=\"external-link-alt\" />\r\n            </Link>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"activating\" && (\r\n        <Modal>\r\n          <ConnectionConfirmationDialog\r\n            title={\r\n              isMetaMask ? \"Confirm connection in MetaMask\" : \"Confirm connection in your wallet\"\r\n            }\r\n            icon={isMetaMask ? <MetaMaskIcon /> : <Icon name=\"wallet\" size=\"lg\" />}\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n          >\r\n            <Text sx={{ textAlign: \"center\" }}>\r\n              Confirm the request that&apos;s just appeared.\r\n              {isMetaMask ? (\r\n                <> If you can&apos;t see a request, open your MetaMask extension via your browser.</>\r\n              ) : (\r\n                <> If you can&apos;t see a request, you might have to open your wallet.</>\r\n              )}\r\n            </Text>\r\n          </ConnectionConfirmationDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"rejectedByUser\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title=\"Cancel connection?\"\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Text>To use Liquity, you need to connect your Ethereum account.</Text>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"alreadyPending\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title=\"Connection already requested\"\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Text>Please check your wallet and accept the connection request before retrying.</Text>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import { useState, useEffect } from \"react\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\n\r\nimport { injectedConnector } from \"../connectors/injectedConnector\";\r\n\r\n/**\r\n * React hook that tries to activate the InjectedConnector if the app's already authorized in the\r\n * browser's wallet (in the case of dApp-enabled browsers) or its wallet extension (e.g. MetaMask).\r\n *\r\n * Example: user has a browser with the MetaMask extension. MetaMask injects an Ethereum provider\r\n * into the window object. We check via InjectedConnector if our app is already authorized to use\r\n * the wallet through this provider, and in that case we try to activate the connector.\r\n *\r\n * @returns true when finished trying to activate the InjectedConnector, false otherwise\r\n */\r\n\r\nexport function useAuthorizedConnection(): boolean {\r\n  const { activate, active } = useWeb3React<unknown>();\r\n  const [tried, setTried] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const tryToActivateIfAuthorized = async () => {\r\n      try {\r\n        if (await injectedConnector.isAuthorized()) {\r\n          await activate(injectedConnector, undefined, true);\r\n        } else {\r\n          throw new Error(\"Unauthorized\");\r\n        }\r\n      } catch {\r\n        setTried(true);\r\n      }\r\n    };\r\n    tryToActivateIfAuthorized();\r\n  }, [activate]);\r\n\r\n  useEffect(() => {\r\n    if (active) {\r\n      setTried(true);\r\n    }\r\n  }, [active]);\r\n\r\n  return tried;\r\n}\r\n","import React, { useState, useRef } from \"react\";\r\nimport { VirtualElement } from \"@popperjs/core\";\r\nimport { usePopper } from \"react-popper\";\r\nimport { Card } from \"theme-ui\";\r\n\r\nexport type Hoverable = {\r\n  onMouseOver: () => void;\r\n  onMouseOut: () => void;\r\n  ref: (instance: Element | VirtualElement | null) => void;\r\n};\r\n\r\nexport type TooltipProps<C> = {\r\n  children: C;\r\n  message: string;\r\n  placement?: \"top\" | \"bottom\" | \"left\" | \"right\";\r\n};\r\n\r\nexport function Tooltip<C extends React.ReactElement<Hoverable>>({\r\n  children,\r\n  message,\r\n  placement = \"top\"\r\n}: TooltipProps<C>) {\r\n  const event = useRef<\"over\" | \"out\">();\r\n  const [show, setShow] = useState(false);\r\n  const [referenceElement, setReferenceElement] = useState<Element | VirtualElement | null>();\r\n  const [popperElement, setPopperElement] = useState<HTMLElement | null>();\r\n\r\n  const { styles, attributes } = usePopper(referenceElement, popperElement, { placement });\r\n\r\n  return (\r\n    <>\r\n      {React.cloneElement(React.Children.only<C>(children), {\r\n        // Use a debounced onMouseOver/onMouseOut instead of onMouseEnter/onMouseLeave to\r\n        // work around https://github.com/facebook/react/issues/10109\r\n\r\n        onMouseOver: () => {\r\n          event.current = \"over\";\r\n\r\n          if (!show) {\r\n            setShow(true);\r\n          }\r\n        },\r\n\r\n        onMouseOut: () => {\r\n          event.current = \"out\";\r\n\r\n          setTimeout(() => {\r\n            if (event.current === \"out\") {\r\n              setShow(false);\r\n            }\r\n          }, 0);\r\n        },\r\n\r\n        ref: setReferenceElement\r\n      })}\r\n\r\n      {show && (\r\n        <Card variant=\"tooltip\" ref={setPopperElement} style={styles.popper} {...attributes.popper}>\r\n          {message}\r\n        </Card>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import React, { useState, useContext, useEffect, useCallback } from \"react\";\r\nimport { Flex, Text, Box } from \"theme-ui\";\r\nimport { Provider, TransactionResponse, TransactionReceipt } from \"@ethersproject/abstract-provider\";\r\nimport { hexDataSlice, hexDataLength } from \"@ethersproject/bytes\";\r\nimport { defaultAbiCoder } from \"@ethersproject/abi\";\r\n\r\nimport { buildStyles, CircularProgressbarWithChildren } from \"react-circular-progressbar\";\r\nimport \"react-circular-progressbar/dist/styles.css\";\r\n\r\nimport { EthersTransactionOverrides, EthersTransactionCancelledError } from \"@liquity/lib-ethers\";\r\nimport { SentLiquityTransaction, LiquityReceipt } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { Tooltip, TooltipProps, Hoverable } from \"./Tooltip\";\r\n\r\nconst strokeWidth = 10;\r\n\r\nconst circularProgressbarStyle = {\r\n  strokeLinecap: \"butt\",\r\n  pathColor: \"white\",\r\n  trailColor: \"rgba(255, 255, 255, 0.33)\"\r\n};\r\n\r\nconst slowProgress = {\r\n  strokeWidth,\r\n  styles: buildStyles({\r\n    ...circularProgressbarStyle,\r\n    pathTransitionDuration: 30\r\n  })\r\n};\r\n\r\nconst fastProgress = {\r\n  strokeWidth,\r\n  styles: buildStyles({\r\n    ...circularProgressbarStyle,\r\n    pathTransitionDuration: 0.75\r\n  })\r\n};\r\n\r\ntype TransactionIdle = {\r\n  type: \"idle\";\r\n};\r\n\r\ntype TransactionFailed = {\r\n  type: \"failed\";\r\n  id: string;\r\n  error: Error;\r\n};\r\n\r\ntype TransactionWaitingForApproval = {\r\n  type: \"waitingForApproval\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionCancelled = {\r\n  type: \"cancelled\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionWaitingForConfirmations = {\r\n  type: \"waitingForConfirmation\";\r\n  id: string;\r\n  tx: SentTransaction;\r\n};\r\n\r\ntype TransactionConfirmed = {\r\n  type: \"confirmed\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionConfirmedOneShot = {\r\n  type: \"confirmedOneShot\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionState =\r\n  | TransactionIdle\r\n  | TransactionFailed\r\n  | TransactionWaitingForApproval\r\n  | TransactionCancelled\r\n  | TransactionWaitingForConfirmations\r\n  | TransactionConfirmed\r\n  | TransactionConfirmedOneShot;\r\n\r\nconst TransactionContext = React.createContext<\r\n  [TransactionState, (state: TransactionState) => void] | undefined\r\n>(undefined);\r\n\r\nexport const TransactionProvider: React.FC = ({ children }) => {\r\n  const transactionState = useState<TransactionState>({ type: \"idle\" });\r\n  return (\r\n    <TransactionContext.Provider value={transactionState}>{children}</TransactionContext.Provider>\r\n  );\r\n};\r\n\r\nconst useTransactionState = () => {\r\n  const transactionState = useContext(TransactionContext);\r\n\r\n  if (!transactionState) {\r\n    throw new Error(\"You must provide a TransactionContext via TransactionProvider\");\r\n  }\r\n\r\n  return transactionState;\r\n};\r\n\r\nexport const useMyTransactionState = (myId: string | RegExp): TransactionState => {\r\n  const [transactionState] = useTransactionState();\r\n\r\n  return transactionState.type !== \"idle\" &&\r\n    (typeof myId === \"string\" ? transactionState.id === myId : transactionState.id.match(myId))\r\n    ? transactionState\r\n    : { type: \"idle\" };\r\n};\r\n\r\nconst hasMessage = (error: unknown): error is { message: string } =>\r\n  typeof error === \"object\" &&\r\n  error !== null &&\r\n  \"message\" in error &&\r\n  typeof (error as { message: unknown }).message === \"string\";\r\n\r\ntype ButtonlikeProps = {\r\n  disabled?: boolean;\r\n  variant?: string;\r\n  onClick?: () => void;\r\n};\r\n\r\ntype SentTransaction = SentLiquityTransaction<\r\n  TransactionResponse,\r\n  LiquityReceipt<TransactionReceipt>\r\n>;\r\n\r\nexport type TransactionFunction = (\r\n  overrides?: EthersTransactionOverrides\r\n) => Promise<SentTransaction>;\r\n\r\ntype TransactionProps<C> = {\r\n  id: string;\r\n  tooltip?: string;\r\n  tooltipPlacement?: TooltipProps<C>[\"placement\"];\r\n  showFailure?: \"asTooltip\" | \"asChildText\";\r\n  requires?: readonly (readonly [boolean, string])[];\r\n  send: TransactionFunction;\r\n  children: C;\r\n};\r\n\r\nexport const useTransactionFunction = (\r\n  id: string,\r\n  send: TransactionFunction\r\n): [sendTransaction: () => Promise<void>, transactionState: TransactionState] => {\r\n  const [transactionState, setTransactionState] = useTransactionState();\r\n\r\n  const sendTransaction = useCallback(async () => {\r\n    setTransactionState({ type: \"waitingForApproval\", id });\r\n\r\n    try {\r\n      const tx = await send();\r\n\r\n      setTransactionState({\r\n        type: \"waitingForConfirmation\",\r\n        id,\r\n        tx\r\n      });\r\n    } catch (error) {\r\n      if (hasMessage(error) && error.message.includes(\"User denied transaction signature\")) {\r\n        setTransactionState({ type: \"cancelled\", id });\r\n      } else {\r\n        console.error(error);\r\n\r\n        setTransactionState({\r\n          type: \"failed\",\r\n          id,\r\n          error: new Error(\"Failed to send transaction (try again)\")\r\n        });\r\n      }\r\n    }\r\n  }, [send, id, setTransactionState]);\r\n\r\n  return [sendTransaction, transactionState];\r\n};\r\n\r\nexport function Transaction<C extends React.ReactElement<ButtonlikeProps & Hoverable>>({\r\n  id,\r\n  tooltip,\r\n  tooltipPlacement,\r\n  showFailure,\r\n  requires,\r\n  send,\r\n  children\r\n}: TransactionProps<C>) {\r\n  const [sendTransaction, transactionState] = useTransactionFunction(id, send);\r\n  const trigger = React.Children.only<C>(children);\r\n\r\n  const failureReasons = (requires || [])\r\n    .filter(([requirement]) => !requirement)\r\n    .map(([, reason]) => reason);\r\n\r\n  if (\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\"\r\n  ) {\r\n    failureReasons.push(\"You must wait for confirmation\");\r\n  }\r\n\r\n  showFailure =\r\n    failureReasons.length > 0 ? showFailure ?? (tooltip ? \"asTooltip\" : \"asChildText\") : undefined;\r\n\r\n  const clonedTrigger =\r\n    showFailure === \"asChildText\"\r\n      ? React.cloneElement(\r\n          trigger,\r\n          {\r\n            disabled: true,\r\n            variant: \"danger\"\r\n          },\r\n          failureReasons[0]\r\n        )\r\n      : showFailure === \"asTooltip\"\r\n      ? React.cloneElement(trigger, { disabled: true })\r\n      : React.cloneElement(trigger, { onClick: sendTransaction });\r\n\r\n  if (showFailure === \"asTooltip\") {\r\n    tooltip = failureReasons[0];\r\n  }\r\n\r\n  return tooltip ? (\r\n    <>\r\n      <Tooltip message={tooltip} placement={tooltipPlacement || \"right\"}>\r\n        {clonedTrigger}\r\n      </Tooltip>\r\n    </>\r\n  ) : (\r\n    clonedTrigger\r\n  );\r\n}\r\n\r\n// Doesn't work on Kovan:\r\n// https://github.com/MetaMask/metamask-extension/issues/5579\r\nconst tryToGetRevertReason = async (provider: Provider, tx: TransactionReceipt) => {\r\n  try {\r\n    const result = await provider.call(tx, tx.blockNumber);\r\n\r\n    if (hexDataLength(result) % 32 === 4 && hexDataSlice(result, 0, 4) === \"0x08c379a0\") {\r\n      return (defaultAbiCoder.decode([\"string\"], hexDataSlice(result, 4)) as [string])[0];\r\n    }\r\n  } catch {\r\n    return undefined;\r\n  }\r\n};\r\n\r\nconst Donut = React.memo(\r\n  CircularProgressbarWithChildren,\r\n  ({ value: prev }, { value: next }) => prev === next\r\n);\r\n\r\ntype TransactionProgressDonutProps = {\r\n  state: TransactionState[\"type\"];\r\n};\r\n\r\nconst TransactionProgressDonut: React.FC<TransactionProgressDonutProps> = ({ state }) => {\r\n  const [value, setValue] = useState(0);\r\n  const maxValue = 1;\r\n\r\n  useEffect(() => {\r\n    if (state === \"confirmed\") {\r\n      setTimeout(() => setValue(maxValue), 40);\r\n    } else {\r\n      setTimeout(() => setValue(maxValue * 0.67), 20);\r\n    }\r\n  }, [state]);\r\n\r\n  return state === \"confirmed\" ? (\r\n    <Donut {...{ value, maxValue, ...fastProgress }}>\r\n      <Icon name=\"check\" color=\"white\" size=\"lg\" />\r\n    </Donut>\r\n  ) : state === \"failed\" || state === \"cancelled\" ? (\r\n    <Donut value={0} {...{ maxValue, ...fastProgress }}>\r\n      <Icon name=\"times\" color=\"white\" size=\"lg\" />\r\n    </Donut>\r\n  ) : (\r\n    <Donut {...{ value, maxValue, ...slowProgress }}>\r\n      <Icon name=\"cog\" color=\"white\" size=\"lg\" spin />\r\n    </Donut>\r\n  );\r\n};\r\n\r\nexport const TransactionMonitor: React.FC = () => {\r\n  const { provider } = useLiquity();\r\n  const [transactionState, setTransactionState] = useTransactionState();\r\n\r\n  const id = transactionState.type !== \"idle\" ? transactionState.id : undefined;\r\n  const tx = transactionState.type === \"waitingForConfirmation\" ? transactionState.tx : undefined;\r\n\r\n  useEffect(() => {\r\n    if (id && tx) {\r\n      let cancelled = false;\r\n      let finished = false;\r\n\r\n      const txHash = tx.rawSentTransaction.hash;\r\n\r\n      const waitForConfirmation = async () => {\r\n        try {\r\n          const receipt = await tx.waitForReceipt();\r\n\r\n          if (cancelled) {\r\n            return;\r\n          }\r\n\r\n          const { confirmations } = receipt.rawReceipt;\r\n          const blockNumber = receipt.rawReceipt.blockNumber + confirmations - 1;\r\n          console.log(`Block #${blockNumber} ${confirmations}-confirms tx ${txHash}`);\r\n          console.log(`Finish monitoring tx ${txHash}`);\r\n          finished = true;\r\n\r\n          if (receipt.status === \"succeeded\") {\r\n            console.log(`${receipt}`);\r\n\r\n            setTransactionState({\r\n              type: \"confirmedOneShot\",\r\n              id\r\n            });\r\n          } else {\r\n            const reason = await tryToGetRevertReason(provider, receipt.rawReceipt);\r\n\r\n            if (cancelled) {\r\n              return;\r\n            }\r\n\r\n            console.error(`Tx ${txHash} failed`);\r\n            if (reason) {\r\n              console.error(`Revert reason: ${reason}`);\r\n            }\r\n\r\n            setTransactionState({\r\n              type: \"failed\",\r\n              id,\r\n              error: new Error(reason ? `Reverted: ${reason}` : \"Failed\")\r\n            });\r\n          }\r\n        } catch (rawError) {\r\n          if (cancelled) {\r\n            return;\r\n          }\r\n\r\n          finished = true;\r\n\r\n          if (rawError instanceof EthersTransactionCancelledError) {\r\n            console.log(`Cancelled tx ${txHash}`);\r\n            setTransactionState({ type: \"cancelled\", id });\r\n          } else {\r\n            console.error(`Failed to get receipt for tx ${txHash}`);\r\n            console.error(rawError);\r\n\r\n            setTransactionState({\r\n              type: \"failed\",\r\n              id,\r\n              error: new Error(\"Failed\")\r\n            });\r\n          }\r\n        }\r\n      };\r\n\r\n      console.log(`Start monitoring tx ${txHash}`);\r\n      waitForConfirmation();\r\n\r\n      return () => {\r\n        if (!finished) {\r\n          setTransactionState({ type: \"idle\" });\r\n          console.log(`Cancel monitoring tx ${txHash}`);\r\n          cancelled = true;\r\n        }\r\n      };\r\n    }\r\n  }, [provider, id, tx, setTransactionState]);\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\" && id) {\r\n      // hack: the txn confirmed state lasts 5 seconds which blocks other states, review with Dani\r\n      setTransactionState({ type: \"confirmed\", id });\r\n    } else if (\r\n      transactionState.type === \"confirmed\" ||\r\n      transactionState.type === \"failed\" ||\r\n      transactionState.type === \"cancelled\"\r\n    ) {\r\n      let cancelled = false;\r\n\r\n      setTimeout(() => {\r\n        if (!cancelled) {\r\n          setTransactionState({ type: \"idle\" });\r\n        }\r\n      }, 5000);\r\n\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n  }, [transactionState.type, setTransactionState, id]);\r\n\r\n  if (transactionState.type === \"idle\" || transactionState.type === \"waitingForApproval\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        alignItems: \"center\",\r\n        bg:\r\n          transactionState.type === \"confirmed\"\r\n            ? \"success\"\r\n            : transactionState.type === \"cancelled\"\r\n            ? \"warning\"\r\n            : transactionState.type === \"failed\"\r\n            ? \"danger\"\r\n            : \"primary\",\r\n        p: 3,\r\n        pl: 4,\r\n        position: \"fixed\",\r\n        width: \"100vw\",\r\n        bottom: 0,\r\n        overflow: \"hidden\"\r\n      }}\r\n    >\r\n      <Box sx={{ mr: 3, width: \"40px\", height: \"40px\" }}>\r\n        <TransactionProgressDonut state={transactionState.type} />\r\n      </Box>\r\n\r\n      <Text sx={{ fontSize: 3, color: \"white\" }}>\r\n        {transactionState.type === \"waitingForConfirmation\"\r\n          ? \"Waiting for confirmation\"\r\n          : transactionState.type === \"cancelled\"\r\n          ? \"Cancelled\"\r\n          : transactionState.type === \"failed\"\r\n          ? transactionState.error.message\r\n          : \"Confirmed\"}\r\n      </Text>\r\n    </Flex>\r\n  );\r\n};\r\n","import { Theme, ThemeUIStyleObject } from \"theme-ui\";\r\n\r\nconst baseColors = {\r\n  blue: \"#1542cd\",\r\n  purple: \"#745ddf\",\r\n  cyan: \"#2eb6ea\",\r\n  green: \"#28c081\",\r\n  yellow: \"#fd9d28\",\r\n  red: \"#dc2c10\",\r\n  lightRed: \"#ff755f\"\r\n};\r\n\r\nconst colors = {\r\n  primary: baseColors.blue,\r\n  secondary: baseColors.purple,\r\n  accent: baseColors.cyan,\r\n\r\n  success: baseColors.green,\r\n  warning: baseColors.yellow,\r\n  danger: baseColors.red,\r\n  dangerHover: baseColors.lightRed,\r\n  info: baseColors.blue,\r\n  invalid: \"pink\",\r\n\r\n  text: \"#293147\",\r\n  background: \"white\",\r\n  muted: \"#eaebed\"\r\n};\r\n\r\nconst buttonBase: ThemeUIStyleObject = {\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"center\",\r\n\r\n  \":enabled\": { cursor: \"pointer\" }\r\n};\r\n\r\nconst button: ThemeUIStyleObject = {\r\n  ...buttonBase,\r\n\r\n  px: \"32px\",\r\n  py: \"12px\",\r\n\r\n  color: \"white\",\r\n  border: 1,\r\n\r\n  fontWeight: \"bold\",\r\n\r\n  \":disabled\": {\r\n    opacity: 0.5\r\n  }\r\n};\r\n\r\nconst buttonOutline = (color: string, hoverColor: string): ThemeUIStyleObject => ({\r\n  color,\r\n  borderColor: color,\r\n  background: \"none\",\r\n\r\n  \":enabled:hover\": {\r\n    color: \"background\",\r\n    bg: hoverColor,\r\n    borderColor: hoverColor\r\n  }\r\n});\r\n\r\nconst iconButton: ThemeUIStyleObject = {\r\n  ...buttonBase,\r\n\r\n  padding: 0,\r\n  width: \"40px\",\r\n  height: \"40px\",\r\n\r\n  background: \"none\",\r\n\r\n  \":disabled\": {\r\n    color: \"text\",\r\n    opacity: 0.25\r\n  }\r\n};\r\n\r\nconst cardHeadingFontSize = 18.7167;\r\n\r\nconst cardGapX = [0, 3, 4];\r\nconst cardGapY = [3, 3, 4];\r\n\r\nconst card: ThemeUIStyleObject = {\r\n  position: \"relative\",\r\n  mt: cardGapY,\r\n  border: 1,\r\n  boxShadow: [1, null, 2]\r\n};\r\n\r\nconst infoCard: ThemeUIStyleObject = {\r\n  ...card,\r\n\r\n  padding: 3,\r\n\r\n  borderColor: \"rgba(122,199,240,0.4)\",\r\n  background: \"linear-gradient(200deg, #d4d9fc, #cae9f9)\",\r\n\r\n  h2: {\r\n    mb: 2,\r\n    fontSize: cardHeadingFontSize\r\n  }\r\n};\r\n\r\nconst formBase: ThemeUIStyleObject = {\r\n  display: \"block\",\r\n  width: \"auto\",\r\n  flexShrink: 0,\r\n  padding: 2,\r\n  fontSize: 3\r\n};\r\n\r\nconst formCell: ThemeUIStyleObject = {\r\n  ...formBase,\r\n\r\n  bg: \"background\",\r\n  border: 1,\r\n  borderColor: \"muted\",\r\n  borderRadius: 0,\r\n  boxShadow: [1, 2]\r\n};\r\n\r\nconst overlay: ThemeUIStyleObject = {\r\n  position: \"absolute\",\r\n\r\n  left: 0,\r\n  top: 0,\r\n  width: \"100%\",\r\n  height: \"100%\"\r\n};\r\n\r\nconst modalOverlay: ThemeUIStyleObject = {\r\n  position: \"fixed\",\r\n\r\n  left: 0,\r\n  top: 0,\r\n  width: \"100vw\",\r\n  height: \"100vh\"\r\n};\r\n\r\nconst headerGradient: ThemeUIStyleObject = {\r\n  background: `linear-gradient(90deg, ${colors.background}, ${colors.muted})`\r\n};\r\n\r\nconst theme: Theme = {\r\n  breakpoints: [\"48em\", \"52em\", \"64em\"],\r\n\r\n  space: [0, 4, 8, 16, 32, 64, 128, 256, 512],\r\n\r\n  fonts: {\r\n    body: [\r\n      \"system-ui\",\r\n      \"-apple-system\",\r\n      \"BlinkMacSystemFont\",\r\n      '\"Segoe UI\"',\r\n      \"Roboto\",\r\n      '\"Helvetica Neue\"',\r\n      \"sans-serif\"\r\n    ].join(\", \"),\r\n    heading: \"inherit\",\r\n    monospace: \"Menlo, monospace\"\r\n  },\r\n\r\n  fontSizes: [12, 14, 16, 20, 24, 32, 48, 64, 96],\r\n\r\n  fontWeights: {\r\n    body: 400,\r\n    heading: 600,\r\n\r\n    light: 200,\r\n    medium: 500,\r\n    bold: 600\r\n  },\r\n\r\n  lineHeights: {\r\n    body: 1.5,\r\n    heading: 1.25\r\n  },\r\n\r\n  colors,\r\n\r\n  borders: [0, \"1px solid\", \"2px solid\"],\r\n\r\n  shadows: [\"0\", \"0px 4px 8px rgba(41, 49, 71, 0.1)\", \"0px 8px 16px rgba(41, 49, 71, 0.1)\"],\r\n\r\n  text: {\r\n    address: {\r\n      fontFamily: \"monospace\",\r\n      fontSize: 1\r\n    }\r\n  },\r\n\r\n  buttons: {\r\n    primary: {\r\n      ...button,\r\n\r\n      bg: \"primary\",\r\n      borderColor: \"primary\",\r\n\r\n      \":enabled:hover\": {\r\n        bg: \"secondary\",\r\n        borderColor: \"secondary\"\r\n      }\r\n    },\r\n\r\n    outline: {\r\n      ...button,\r\n      ...buttonOutline(\"primary\", \"secondary\")\r\n    },\r\n\r\n    cancel: {\r\n      ...button,\r\n      ...buttonOutline(\"text\", \"text\"),\r\n\r\n      opacity: 0.8\r\n    },\r\n\r\n    danger: {\r\n      ...button,\r\n\r\n      bg: \"danger\",\r\n      borderColor: \"danger\",\r\n\r\n      \":enabled:hover\": {\r\n        bg: \"dangerHover\",\r\n        borderColor: \"dangerHover\"\r\n      }\r\n    },\r\n\r\n    icon: {\r\n      ...iconButton,\r\n      color: \"primary\",\r\n      \":enabled:hover\": { color: \"accent\" }\r\n    },\r\n\r\n    dangerIcon: {\r\n      ...iconButton,\r\n      color: \"danger\",\r\n      \":enabled:hover\": { color: \"dangerHover\" }\r\n    },\r\n\r\n    titleIcon: {\r\n      ...iconButton,\r\n      color: \"text\",\r\n      \":enabled:hover\": { color: \"success\" }\r\n    }\r\n  },\r\n\r\n  cards: {\r\n    primary: {\r\n      ...card,\r\n\r\n      padding: 0,\r\n\r\n      borderColor: \"muted\",\r\n      bg: \"background\",\r\n\r\n      \"> h2\": {\r\n        display: \"flex\",\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n\r\n        height: \"56px\",\r\n\r\n        pl: 3,\r\n        py: 2,\r\n        pr: 2,\r\n\r\n        bg: \"muted\",\r\n\r\n        fontSize: cardHeadingFontSize\r\n      }\r\n    },\r\n\r\n    info: {\r\n      ...infoCard,\r\n\r\n      display: [\"none\", \"block\"]\r\n    },\r\n\r\n    infoPopup: {\r\n      ...infoCard,\r\n\r\n      position: \"fixed\",\r\n      top: 0,\r\n      right: 3,\r\n      left: 3,\r\n      mt: \"72px\",\r\n      height: \"80%\",\r\n      overflowY: \"scroll\"\r\n    },\r\n\r\n    tooltip: {\r\n      padding: 2,\r\n\r\n      border: 1,\r\n      borderColor: \"muted\",\r\n      borderRadius: \"4px\",\r\n      bg: \"background\",\r\n      boxShadow: 2,\r\n\r\n      fontSize: 1,\r\n      color: \"text\",\r\n      fontWeight: \"body\",\r\n      zIndex: 1\r\n    }\r\n  },\r\n\r\n  forms: {\r\n    label: {\r\n      ...formBase\r\n    },\r\n\r\n    unit: {\r\n      ...formCell,\r\n\r\n      textAlign: \"center\",\r\n      bg: \"muted\"\r\n    },\r\n\r\n    input: {\r\n      ...formCell,\r\n\r\n      flex: 1\r\n    },\r\n\r\n    editor: {}\r\n  },\r\n\r\n  layout: {\r\n    header: {\r\n      display: \"flex\",\r\n      justifyContent: \"space-between\",\r\n      alignItems: \"stretch\",\r\n\r\n      position: [\"fixed\", \"relative\"],\r\n      width: \"100vw\",\r\n      top: 0,\r\n      zIndex: 1,\r\n\r\n      px: [2, \"12px\", \"12px\", 5],\r\n      py: [2, \"12px\", \"12px\"],\r\n\r\n      ...headerGradient,\r\n      boxShadow: [1, \"none\"]\r\n    },\r\n\r\n    footer: {\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n\r\n      mt: cardGapY,\r\n      px: 3,\r\n      minHeight: \"72px\",\r\n\r\n      bg: \"muted\"\r\n    },\r\n\r\n    main: {\r\n      width: \"100%\",\r\n      maxWidth: \"912px\",\r\n      mx: \"auto\",\r\n      mt: [\"40px\", 0],\r\n      mb: [\"40px\", \"40px\"],\r\n      px: cardGapX\r\n    },\r\n\r\n    columns: {\r\n      display: \"flex\",\r\n      flexWrap: \"wrap\",\r\n      justifyItems: \"center\"\r\n    },\r\n\r\n    left: {\r\n      pr: cardGapX,\r\n      width: [\"100%\", \"58%\"]\r\n    },\r\n\r\n    right: {\r\n      width: [\"100%\", \"42%\"]\r\n    },\r\n\r\n    actions: {\r\n      justifyContent: \"flex-end\",\r\n      mt: 2,\r\n\r\n      button: {\r\n        ml: 2\r\n      }\r\n    },\r\n\r\n    disabledOverlay: {\r\n      ...overlay,\r\n\r\n      bg: \"rgba(255, 255, 255, 0.5)\"\r\n    },\r\n\r\n    modalOverlay: {\r\n      ...modalOverlay,\r\n\r\n      bg: \"rgba(0, 0, 0, 0.8)\",\r\n\r\n      display: \"flex\",\r\n      justifyContent: \"center\",\r\n      alignItems: \"center\"\r\n    },\r\n\r\n    modal: {\r\n      padding: 3,\r\n      width: [\"100%\", \"40em\"]\r\n    },\r\n\r\n    infoOverlay: {\r\n      ...modalOverlay,\r\n\r\n      display: [\"block\", \"none\"],\r\n\r\n      bg: \"rgba(255, 255, 255, 0.8)\"\r\n    },\r\n\r\n    infoMessage: {\r\n      display: \"flex\",\r\n      justifyContent: \"center\",\r\n      m: 3,\r\n      alignItems: \"center\",\r\n      minWidth: \"128px\"\r\n    },\r\n\r\n    sidenav: {\r\n      display: [\"flex\", \"none\"],\r\n      flexDirection: \"column\",\r\n      p: 0,\r\n      m: 0,\r\n      borderColor: \"muted\",\r\n      mr: \"25vw\",\r\n      height: \"100%\",\r\n      ...headerGradient\r\n    },\r\n\r\n    badge: {\r\n      border: 0,\r\n      borderRadius: 3,\r\n      p: 1,\r\n      px: 2,\r\n      backgroundColor: \"muted\",\r\n      color: \"slate\",\r\n      fontSize: 1,\r\n      fontWeight: \"body\"\r\n    }\r\n  },\r\n\r\n  styles: {\r\n    root: {\r\n      fontFamily: \"body\",\r\n      lineHeight: \"body\",\r\n      fontWeight: \"body\",\r\n\r\n      height: \"100%\",\r\n\r\n      \"#root\": {\r\n        height: \"100%\"\r\n      }\r\n    },\r\n\r\n    a: {\r\n      color: \"primary\",\r\n      \":hover\": { color: \"accent\" },\r\n      textDecoration: \"none\",\r\n      fontWeight: \"bold\"\r\n    }\r\n  },\r\n\r\n  links: {\r\n    nav: {\r\n      px: 2,\r\n      py: 1,\r\n      fontWeight: \"medium\",\r\n      fontSize: 2,\r\n      textTransform: \"uppercase\",\r\n      letterSpacing: \"2px\",\r\n      width: [\"100%\", \"auto\"],\r\n      mt: [3, \"auto\"]\r\n    }\r\n  }\r\n};\r\n\r\nexport default theme;\r\n","import { hexlify } from \"@ethersproject/bytes\";\r\nimport { Wallet } from \"@ethersproject/wallet\";\r\n\r\nimport { Decimal, Decimalish } from \"@liquity/lib-base\";\r\n\r\nexport class DisposableWalletProvider {\r\n  private readonly url: string;\r\n  private id: number = 0;\r\n\r\n  private readonly wallet: Wallet;\r\n  private readonly funderWallet: Wallet;\r\n\r\n  private readonly ethAmount: Decimal;\r\n  private haveFunded = false;\r\n\r\n  constructor(url: string, funderPrivateKey: string, ethAmount: Decimalish = 100) {\r\n    this.url = url;\r\n    this.wallet = Wallet.createRandom();\r\n    this.funderWallet = new Wallet(funderPrivateKey);\r\n    this.ethAmount = Decimal.from(ethAmount);\r\n  }\r\n\r\n  private findWallet(address: string) {\r\n    const wallet = [this.wallet, this.funderWallet].find(\r\n      wallet => wallet.address.toLowerCase() === address.toLowerCase()\r\n    );\r\n\r\n    if (!wallet) {\r\n      throw new Error(`Unknow account ${address}`);\r\n    }\r\n\r\n    return wallet;\r\n  }\r\n\r\n  private async fund() {\r\n    return this.send(\"eth_sendTransaction\", [\r\n      {\r\n        from: this.funderWallet.address,\r\n        to: this.wallet.address,\r\n        value: this.ethAmount.hex,\r\n        gas: hexlify(21000)\r\n      }\r\n    ]);\r\n\r\n    // TODO maybe wait for tx to be mined (not a problem on devchains though)\r\n  }\r\n\r\n  async send(method: string, params: any[]): Promise<any> {\r\n    if (!this.haveFunded) {\r\n      this.haveFunded = true;\r\n      await this.fund();\r\n    }\r\n\r\n    switch (method) {\r\n      case \"eth_accounts\":\r\n      case \"eth_requestAccounts\":\r\n        return [this.wallet.address];\r\n\r\n      case \"eth_sendTransaction\":\r\n        return this.send(\r\n          \"eth_sendRawTransaction\",\r\n          await Promise.all(\r\n            params.map(async ({ from, nonce, gas, ...rest }) => {\r\n              if (nonce === undefined) {\r\n                nonce = await this.send(\"eth_getTransactionCount\", [from]);\r\n              }\r\n\r\n              return this.findWallet(from).signTransaction({\r\n                from,\r\n                nonce,\r\n                ...(gas !== undefined ? { gasLimit: gas } : {}),\r\n                ...rest\r\n              });\r\n            })\r\n          )\r\n        );\r\n    }\r\n\r\n    //console.log({ method, params });\r\n\r\n    const response = await fetch(this.url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        method: method,\r\n        params: params,\r\n        id: this.id++,\r\n        jsonrpc: \"2.0\"\r\n      })\r\n    });\r\n\r\n    const json = await response.json();\r\n\r\n    //console.log(json);\r\n\r\n    if (json.error) {\r\n      const { message, ...rest } = json.error;\r\n      const error = new Error(`${message} ${JSON.stringify(rest)}`);\r\n      throw Object.assign(error, rest);\r\n    }\r\n\r\n    return json.result;\r\n  }\r\n\r\n  request({ method, params }: { method: string; params: any[] }) {\r\n    return this.send(method, params);\r\n  }\r\n}\r\n","export const COIN = \"LUSD\";\r\nexport const GT = \"LQTY\";\r\nexport const LP = \"UNI LP\";\r\n// export const LP = \"ETH/LUSD LP\";\r\n","export const shortenAddress = (address: string) => address.substr(0, 6) + \"...\" + address.substr(-4);\r\n","import React from \"react\";\r\nimport { Text, Flex, Box, Heading } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../strings\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nconst select = ({ accountBalance, lusdBalance, lqtyBalance }: LiquityStoreState) => ({\r\n  accountBalance,\r\n  lusdBalance,\r\n  lqtyBalance\r\n});\r\n\r\nexport const UserAccount: React.FC = () => {\r\n  const { account } = useLiquity();\r\n  const { accountBalance, lusdBalance, lqtyBalance } = useLiquitySelector(select);\r\n\r\n  return (\r\n    <Box sx={{ display: [\"none\", \"flex\"] }}>\r\n      <Flex sx={{ alignItems: \"center\" }}>\r\n        <Icon name=\"user-circle\" size=\"lg\" />\r\n        <Flex sx={{ ml: 3, mr: 4, flexDirection: \"column\" }}>\r\n          <Heading sx={{ fontSize: 1 }}>Connected as</Heading>\r\n          <Text as=\"span\" sx={{ fontSize: 1 }}>\r\n            {shortenAddress(account)}\r\n          </Text>\r\n        </Flex>\r\n      </Flex>\r\n\r\n      <Flex sx={{ alignItems: \"center\" }}>\r\n        <Icon name=\"wallet\" size=\"lg\" />\r\n\r\n        {([\r\n          [\"ETH\", accountBalance],\r\n          [COIN, lusdBalance],\r\n          [GT, lqtyBalance]\r\n        ] as const).map(([currency, balance], i) => (\r\n          <Flex key={i} sx={{ ml: 3, flexDirection: \"column\" }}>\r\n            <Heading sx={{ fontSize: 1 }}>{currency}</Heading>\r\n            <Text sx={{ fontSize: 1 }}>{balance.prettify()}</Text>\r\n          </Flex>\r\n        ))}\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport Tippy, { TippyProps } from \"@tippyjs/react\";\r\nimport { Icon } from \"./Icon\";\r\nimport { FontAwesomeIconProps } from \"@fortawesome/react-fontawesome\";\r\n\r\nexport type InfoIconProps = Pick<TippyProps, \"placement\"> &\r\n  Pick<FontAwesomeIconProps, \"size\"> & {\r\n    tooltip: React.ReactNode;\r\n  };\r\n\r\nexport const InfoIcon: React.FC<InfoIconProps> = ({ placement = \"right\", tooltip, size = \"1x\" }) => {\r\n  return (\r\n    <Tippy interactive={true} placement={placement} content={tooltip} maxWidth=\"268px\">\r\n      <span>\r\n        &nbsp;\r\n        <Icon name=\"question-circle\" size={size} />\r\n      </span>\r\n    </Tippy>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Card } from \"theme-ui\";\r\nimport { InfoIcon } from \"./InfoIcon\";\r\n\r\ntype StatisticProps = {\r\n  name: React.ReactNode;\r\n  tooltip?: React.ReactNode;\r\n};\r\n\r\nexport const Statistic: React.FC<StatisticProps> = ({ name, tooltip, children }) => {\r\n  return (\r\n    <Flex sx={{ borderBottom: 1, borderColor: \"rgba(0, 0, 0, 0.1)\" }}>\r\n      <Flex sx={{ alignItems: \"center\", justifyContent: \"flex-start\", flex: 1.2, fontWeight: 200 }}>\r\n        <Flex>{name}</Flex>\r\n        {tooltip && <InfoIcon size=\"xs\" tooltip={<Card variant=\"tooltip\">{tooltip}</Card>} />}\r\n      </Flex>\r\n      <Flex sx={{ justifyContent: \"flex-start\", flex: 0.8, alignItems: \"center\" }}>{children}</Flex>\r\n    </Flex>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Card, Heading, Link, Box, Text } from \"theme-ui\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\nimport { Decimal, Percent, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { COIN, GT } from \"../strings\";\r\nimport { Statistic } from \"./Statistic\";\r\n\r\nconst selectBalances = ({ accountBalance, lusdBalance, lqtyBalance }: LiquityStoreState) => ({\r\n  accountBalance,\r\n  lusdBalance,\r\n  lqtyBalance\r\n});\r\n\r\nconst Balances: React.FC = () => {\r\n  const { accountBalance, lusdBalance, lqtyBalance } = useLiquitySelector(selectBalances);\r\n\r\n  return (\r\n    <Box sx={{ mb: 3 }}>\r\n      <Heading>My Account Balances</Heading>\r\n      <Statistic name=\"ETH\"> {accountBalance.prettify(4)}</Statistic>\r\n      <Statistic name={COIN}> {lusdBalance.prettify()}</Statistic>\r\n      <Statistic name={GT}>{lqtyBalance.prettify()}</Statistic>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst GitHubCommit: React.FC<{ children?: string }> = ({ children }) =>\r\n  children?.match(/[0-9a-f]{40}/) ? (\r\n    <Link href={`https://github.com/liquity/dev/commit/${children}`}>{children.substr(0, 7)}</Link>\r\n  ) : (\r\n    <>unknown</>\r\n  );\r\n\r\ntype SystemStatsProps = {\r\n  variant?: string;\r\n  showBalances?: boolean;\r\n};\r\n\r\nconst select = ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  borrowingRate,\r\n  redemptionRate,\r\n  totalStakedLQTY,\r\n  frontend\r\n}: LiquityStoreState) => ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  borrowingRate,\r\n  redemptionRate,\r\n  totalStakedLQTY,\r\n  kickbackRate: frontend.status === \"registered\" ? frontend.kickbackRate : null\r\n});\r\n\r\nexport const SystemStats: React.FC<SystemStatsProps> = ({ variant = \"info\", showBalances }) => {\r\n  const {\r\n    liquity: {\r\n      connection: { version: contractsVersion, deploymentDate, frontendTag }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const {\r\n    numberOfTroves,\r\n    price,\r\n    lusdInStabilityPool,\r\n    total,\r\n    borrowingRate,\r\n    totalStakedLQTY,\r\n    kickbackRate\r\n  } = useLiquitySelector(select);\r\n\r\n  const lusdInStabilityPoolPct =\r\n    total.debt.nonZero && new Percent(lusdInStabilityPool.div(total.debt));\r\n  const totalCollateralRatioPct = new Percent(total.collateralRatio(price));\r\n  const borrowingFeePct = new Percent(borrowingRate);\r\n  const kickbackRatePct = frontendTag === AddressZero ? \"100\" : kickbackRate?.mul(100).prettify();\r\n\r\n  return (\r\n    <Card {...{ variant }}>\r\n      {showBalances && <Balances />}\r\n\r\n      <Heading>Liquity statistics</Heading>\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Protocol\r\n      </Heading>\r\n\r\n      <Statistic\r\n        name=\"Borrowing Fee\"\r\n        tooltip=\"The Borrowing Fee is a one-off fee charged as a percentage of the borrowed amount (in LUSD) and is part of a Trove's debt. The fee varies between 0.5% and 5% depending on LUSD redemption volumes.\"\r\n      >\r\n        {borrowingFeePct.toString(2)}\r\n      </Statistic>\r\n\r\n      <Statistic\r\n        name=\"TVL\"\r\n        tooltip=\"The Total Value Locked (TVL) is the total value of Ether locked as collateral in the system, given in ETH and USD.\"\r\n      >\r\n        {total.collateral.shorten()} <Text sx={{ fontSize: 1 }}>&nbsp;ETH</Text>\r\n        <Text sx={{ fontSize: 1 }}>\r\n          &nbsp;(${Decimal.from(total.collateral.mul(price)).shorten()})\r\n        </Text>\r\n      </Statistic>\r\n      <Statistic name=\"Troves\" tooltip=\"The total number of active Troves in the system.\">\r\n        {Decimal.from(numberOfTroves).prettify(0)}\r\n      </Statistic>\r\n      <Statistic name=\"LUSD supply\" tooltip=\"The total LUSD minted by the Liquity Protocol.\">\r\n        {total.debt.shorten()}\r\n      </Statistic>\r\n      {lusdInStabilityPoolPct && (\r\n        <Statistic\r\n          name=\"LUSD in Stability Pool\"\r\n          tooltip=\"The total LUSD currently held in the Stability Pool, expressed as an amount and a fraction of the LUSD supply.\r\n        \"\r\n        >\r\n          {lusdInStabilityPool.shorten()}\r\n          <Text sx={{ fontSize: 1 }}>&nbsp;({lusdInStabilityPoolPct.toString(1)})</Text>\r\n        </Statistic>\r\n      )}\r\n      <Statistic\r\n        name=\"Staked LQTY\"\r\n        tooltip=\"The total amount of LQTY that is staked for earning fee revenue.\"\r\n      >\r\n        {totalStakedLQTY.shorten()}\r\n      </Statistic>\r\n      <Statistic\r\n        name=\"Total Collateral Ratio\"\r\n        tooltip=\"The ratio of the Dollar value of the entire system collateral at the current ETH:USD price, to the entire system debt.\"\r\n      >\r\n        {totalCollateralRatioPct.prettify()}\r\n      </Statistic>\r\n      <Statistic\r\n        name=\"Recovery Mode\"\r\n        tooltip=\"Recovery Mode is activated when the Total Collateral Ratio (TCR) falls below 150%. When active, your Trove can be liquidated if its collateral ratio is below the TCR. The maximum collateral you can lose from liquidation is capped at 110% of your Trove's debt. Operations are also restricted that would negatively impact the TCR.\"\r\n      >\r\n        {total.collateralRatioIsBelowCritical(price) ? <Box color=\"danger\">Yes</Box> : \"No\"}\r\n      </Statistic>\r\n      {}\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Frontend\r\n      </Heading>\r\n      {kickbackRatePct && (\r\n        <Statistic\r\n          name=\"Kickback Rate\"\r\n          tooltip=\"A rate between 0 and 100% set by the Frontend Operator that determines the fraction of LQTY that will be paid out as a kickback to the Stability Providers using the frontend.\"\r\n        >\r\n          {kickbackRatePct}%\r\n        </Statistic>\r\n      )}\r\n\r\n      <Box sx={{ mt: 3, opacity: 0.66 }}>\r\n        <Box sx={{ fontSize: 0 }}>\r\n          Contracts version: <GitHubCommit>{contractsVersion}</GitHubCommit>\r\n        </Box>\r\n        <Box sx={{ fontSize: 0 }}>Deployed: {deploymentDate.toLocaleString()}</Box>\r\n        <Box sx={{ fontSize: 0 }}>\r\n          Frontend version:{\" \"}\r\n          {process.env.NODE_ENV === \"development\" ? (\r\n            \"development\"\r\n          ) : (\r\n            <GitHubCommit>{process.env.REACT_APP_VERSION}</GitHubCommit>\r\n          )}\r\n        </Box>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useState, useRef } from \"react\";\r\nimport { Container, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { SystemStats } from \"./SystemStats\";\r\n\r\nconst select = ({ total, price }: LiquityStoreState) => ({ total, price });\r\n\r\nexport const SystemStatsPopup: React.FC = () => {\r\n  const { price, total } = useLiquitySelector(select);\r\n\r\n  const [systemStatsOpen, setSystemStatsOpen] = useState(false);\r\n  const systemStatsOverlayRef = useRef<HTMLDivElement>(null);\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        onClick={() => setSystemStatsOpen(!systemStatsOpen)}\r\n        variant=\"icon\"\r\n        sx={{\r\n          position: \"relative\",\r\n          display: [\"block\", \"none\"]\r\n        }}\r\n      >\r\n        <Icon name=\"info-circle\" size=\"2x\" />\r\n\r\n        {total.collateralRatioIsBelowCritical(price) && (\r\n          <Flex\r\n            sx={{\r\n              position: \"absolute\",\r\n              right: 0,\r\n              top: 0,\r\n              width: \"100%\",\r\n              height: \"100%\",\r\n\r\n              alignItems: \"flex-start\",\r\n              justifyContent: \"flex-end\",\r\n              pt: \"2px\",\r\n\r\n              color: \"danger\"\r\n            }}\r\n          >\r\n            <Icon name=\"exclamation-circle\" size=\"xs\" />\r\n          </Flex>\r\n        )}\r\n      </Button>\r\n\r\n      {systemStatsOpen && (\r\n        <Container\r\n          variant=\"infoOverlay\"\r\n          ref={systemStatsOverlayRef}\r\n          onClick={e => {\r\n            if (e.target === systemStatsOverlayRef.current) {\r\n              setSystemStatsOpen(false);\r\n            }\r\n          }}\r\n        >\r\n          <SystemStats variant=\"infoPopup\" showBalances />\r\n        </Container>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Box, Image } from \"theme-ui\";\r\n\r\ntype LiquityLogoProps = React.ComponentProps<typeof Box> & {\r\n  height?: number | string;\r\n};\r\n\r\nexport const LiquityLogo: React.FC<LiquityLogoProps> = ({ height, ...boxProps }) => (\r\n  <Box sx={{ lineHeight: 0 }} {...boxProps}>\r\n    <Image src=\"./lusd-icon.png\" sx={{ height }} />\r\n  </Box>\r\n);\r\n","import { NavLink as RouterLink, NavLinkProps as RouterLinkProps } from \"react-router-dom\";\r\nimport { NavLink as ThemeUINavLink, NavLinkProps as ThemeUILinkProps } from \"theme-ui\";\r\n\r\ntype CombinedProps = ThemeUILinkProps & RouterLinkProps<{}>;\r\n\r\nconst ExactLink: React.FC<CombinedProps> = props => {\r\n  return <RouterLink exact {...props} />;\r\n};\r\n\r\nexport const Link: React.FC<CombinedProps> = props => {\r\n  return <ThemeUINavLink {...props} as={ExactLink} />;\r\n};\r\n","import { Flex, Box } from \"theme-ui\";\r\nimport { Link } from \"./Link\";\r\n\r\nexport const Nav: React.FC = () => {\r\n  return (\r\n    <Box as=\"nav\" sx={{ display: [\"none\", \"flex\"], alignItems: \"center\", flex: 1 }}>\r\n      <Flex>\r\n        <Link to=\"/\">Dashboard</Link>\r\n        <Link to=\"/farm\">Farm</Link>\r\n      </Flex>\r\n      <Flex sx={{ justifyContent: \"flex-end\", mr: 3, flex: 1 }}>\r\n        <Link sx={{ fontSize: 1 }} to=\"/risky-troves\">\r\n          Risky Troves\r\n        </Link>\r\n        <Link sx={{ fontSize: 1 }} to=\"/redemption\">\r\n          Redemption\r\n        </Link>\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n","import React, { useState, useRef } from \"react\";\r\nimport { Box, Button, Container, Flex } from \"theme-ui\";\r\nimport { Icon } from \"./Icon\";\r\nimport { LiquityLogo } from \"./LiquityLogo\";\r\nimport { Link } from \"./Link\";\r\n\r\nconst logoHeight = \"32px\";\r\n\r\nexport const SideNav: React.FC = () => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const overlay = useRef<HTMLDivElement>(null);\r\n\r\n  if (!isVisible) {\r\n    return (\r\n      <Button sx={{ display: [\"flex\", \"none\"] }} variant=\"icon\" onClick={() => setIsVisible(true)}>\r\n        <Icon name=\"bars\" size=\"lg\" />\r\n      </Button>\r\n    );\r\n  }\r\n  return (\r\n    <Container\r\n      variant=\"infoOverlay\"\r\n      ref={overlay}\r\n      onClick={e => {\r\n        if (e.target === overlay.current) {\r\n          setIsVisible(false);\r\n        }\r\n      }}\r\n    >\r\n      <Flex variant=\"layout.sidenav\">\r\n        <Button\r\n          sx={{ position: \"fixed\", right: \"25vw\", m: 2 }}\r\n          variant=\"icon\"\r\n          onClick={() => setIsVisible(false)}\r\n        >\r\n          <Icon name=\"times\" size=\"2x\" />\r\n        </Button>\r\n        <LiquityLogo height={logoHeight} p={2} />\r\n        <Box as=\"nav\" sx={{ m: 3, mt: 1, p: 0 }} onClick={() => setIsVisible(false)}>\r\n          <Link to=\"/\">Dashboard</Link>\r\n          <Link to=\"/farm\">Farm</Link>\r\n          <Link to=\"/risky-troves\">Risky Troves</Link>\r\n          <Link to=\"/redemption\">Redemption</Link>\r\n        </Box>\r\n      </Flex>\r\n    </Container>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { Container, Flex, Box } from \"theme-ui\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { LiquityLogo } from \"./LiquityLogo\";\r\nimport { Nav } from \"./Nav\";\r\nimport { SideNav } from \"./SideNav\";\r\n\r\nconst logoHeight = \"32px\";\r\n\r\nconst select = ({ frontend }: LiquityStoreState) => ({\r\n  frontend\r\n});\r\n\r\nexport const Header: React.FC = ({ children }) => {\r\n  const {\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n  const { frontend } = useLiquitySelector(select);\r\n  const isFrontendRegistered = frontendTag === AddressZero || frontend.status === \"registered\";\r\n\r\n  return (\r\n    <Container variant=\"header\">\r\n      <Flex sx={{ alignItems: \"center\", flex: 1 }}>\r\n        <LiquityLogo height={logoHeight} />\r\n\r\n        <Box\r\n          sx={{\r\n            mx: [2, 3],\r\n            width: \"0px\",\r\n            height: \"100%\",\r\n            borderLeft: [\"none\", \"1px solid lightgrey\"]\r\n          }}\r\n        />\r\n        {isFrontendRegistered && (\r\n          <>\r\n            <SideNav />\r\n            <Nav />\r\n          </>\r\n        )}\r\n      </Flex>\r\n\r\n      {children}\r\n    </Container>\r\n  );\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const ActionDescription: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"accent\",\r\n      boxShadow: 2,\r\n      bg: \"rgba(46, 182, 234, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"info-circle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n\r\nexport const Amount: React.FC = ({ children }) => (\r\n  <Text sx={{ fontWeight: \"bold\", whiteSpace: \"nowrap\" }}>{children}</Text>\r\n);\r\n","import React, { useState } from \"react\";\r\nimport { Text, Flex, Label, Input, SxProp, Button, ThemeUICSSProperties } from \"theme-ui\";\r\n\r\nimport { Icon } from \"../Icon\";\r\n\r\ntype RowProps = SxProp & {\r\n  label: string;\r\n  labelId?: string;\r\n  labelFor?: string;\r\n  infoIcon?: React.ReactNode;\r\n};\r\n\r\nexport const Row: React.FC<RowProps> = ({ sx, label, labelId, labelFor, children, infoIcon }) => {\r\n  return (\r\n    <Flex sx={{ alignItems: \"stretch\", ...sx }}>\r\n      <Label\r\n        id={labelId}\r\n        htmlFor={labelFor}\r\n        sx={{\r\n          p: 0,\r\n          pl: 3,\r\n          pt: \"12px\",\r\n          position: \"absolute\",\r\n\r\n          fontSize: 1,\r\n          border: 1,\r\n          borderColor: \"transparent\"\r\n        }}\r\n      >\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          {label}\r\n          {infoIcon && infoIcon}\r\n        </Flex>\r\n      </Label>\r\n      {children}\r\n    </Flex>\r\n  );\r\n};\r\n\r\ntype PendingAmountProps = {\r\n  value: string;\r\n};\r\n\r\nconst PendingAmount: React.FC<PendingAmountProps & SxProp> = ({ sx, value }) => (\r\n  <Text {...{ sx }}>\r\n    (\r\n    {value === \"++\" ? (\r\n      <Icon name=\"angle-double-up\" />\r\n    ) : value === \"--\" ? (\r\n      <Icon name=\"angle-double-down\" />\r\n    ) : value?.startsWith(\"+\") ? (\r\n      <>\r\n        <Icon name=\"angle-up\" /> {value.substr(1)}\r\n      </>\r\n    ) : value?.startsWith(\"-\") ? (\r\n      <>\r\n        <Icon name=\"angle-down\" /> {value.substr(1)}\r\n      </>\r\n    ) : (\r\n      value\r\n    )}\r\n    )\r\n  </Text>\r\n);\r\n\r\ntype StaticAmountsProps = {\r\n  inputId: string;\r\n  labelledBy?: string;\r\n  amount: string;\r\n  unit?: string;\r\n  color?: string;\r\n  pendingAmount?: string;\r\n  pendingColor?: string;\r\n  onClick?: () => void;\r\n};\r\n\r\nexport const StaticAmounts: React.FC<StaticAmountsProps & SxProp> = ({\r\n  sx,\r\n  inputId,\r\n  labelledBy,\r\n  amount,\r\n  unit,\r\n  color,\r\n  pendingAmount,\r\n  pendingColor,\r\n  onClick,\r\n  children\r\n}) => {\r\n  return (\r\n    <Flex\r\n      id={inputId}\r\n      aria-labelledby={labelledBy}\r\n      {...{ onClick }}\r\n      sx={{\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n\r\n        ...(onClick ? { cursor: \"text\" } : {}),\r\n\r\n        ...staticStyle,\r\n        ...sx\r\n      }}\r\n    >\r\n      <Flex sx={{ alignItems: \"center\" }}>\r\n        <Text sx={{ color, fontWeight: \"medium\" }}>{amount}</Text>\r\n\r\n        {unit && (\r\n          <>\r\n            &nbsp;\r\n            <Text sx={{ fontWeight: \"light\", opacity: 0.8 }}>{unit}</Text>\r\n          </>\r\n        )}\r\n\r\n        {pendingAmount && (\r\n          <>\r\n            &nbsp;\r\n            <PendingAmount\r\n              sx={{ color: pendingColor, opacity: 0.8, fontSize: \"0.666em\" }}\r\n              value={pendingAmount}\r\n            />\r\n          </>\r\n        )}\r\n      </Flex>\r\n\r\n      {children}\r\n    </Flex>\r\n  );\r\n};\r\n\r\nconst staticStyle: ThemeUICSSProperties = {\r\n  flexGrow: 1,\r\n\r\n  mb: 0,\r\n  pl: 3,\r\n  pr: \"11px\",\r\n  pb: 0,\r\n  pt: \"28px\",\r\n\r\n  fontSize: 3,\r\n\r\n  border: 1,\r\n  borderColor: \"transparent\"\r\n};\r\n\r\nconst editableStyle: ThemeUICSSProperties = {\r\n  flexGrow: 1,\r\n\r\n  mb: [2, 3],\r\n  pl: 3,\r\n  pr: \"11px\",\r\n  pb: 2,\r\n  pt: \"28px\",\r\n\r\n  fontSize: 4,\r\n\r\n  boxShadow: [1, 2],\r\n  border: 1,\r\n  borderColor: \"muted\"\r\n};\r\n\r\ntype StaticRowProps = RowProps & StaticAmountsProps;\r\n\r\nexport const StaticRow: React.FC<StaticRowProps> = ({\r\n  label,\r\n  labelId,\r\n  labelFor,\r\n  infoIcon,\r\n  ...props\r\n}) => (\r\n  <Row {...{ label, labelId, labelFor, infoIcon }} sx={{ mt: [-2, -3], pb: [2, 3] }}>\r\n    <StaticAmounts {...props} />\r\n  </Row>\r\n);\r\n\r\ntype DisabledEditableRowProps = Omit<StaticAmountsProps, \"labelledBy\" | \"onClick\"> & {\r\n  label: string;\r\n};\r\n\r\nexport const DisabledEditableRow: React.FC<DisabledEditableRowProps> = ({\r\n  inputId,\r\n  label,\r\n  unit,\r\n  amount,\r\n  color,\r\n  pendingAmount,\r\n  pendingColor\r\n}) => (\r\n  <Row labelId={`${inputId}-label`} {...{ label, unit }}>\r\n    <StaticAmounts\r\n      sx={{ ...editableStyle, boxShadow: 0 }}\r\n      labelledBy={`${inputId}-label`}\r\n      {...{ inputId, amount, unit, color, pendingAmount, pendingColor }}\r\n    />\r\n  </Row>\r\n);\r\n\r\ntype EditableRowProps = DisabledEditableRowProps & {\r\n  editingState: [string | undefined, (editing: string | undefined) => void];\r\n  editedAmount: string;\r\n  setEditedAmount: (editedAmount: string) => void;\r\n  maxAmount?: string;\r\n  maxedOut?: boolean;\r\n};\r\n\r\nexport const EditableRow: React.FC<EditableRowProps> = ({\r\n  label,\r\n  inputId,\r\n  unit,\r\n  amount,\r\n  color,\r\n  pendingAmount,\r\n  pendingColor,\r\n  editingState,\r\n  editedAmount,\r\n  setEditedAmount,\r\n  maxAmount,\r\n  maxedOut\r\n}) => {\r\n  const [editing, setEditing] = editingState;\r\n  const [invalid, setInvalid] = useState(false);\r\n\r\n  return editing === inputId ? (\r\n    <Row {...{ label, labelFor: inputId, unit }}>\r\n      <Input\r\n        autoFocus\r\n        id={inputId}\r\n        type=\"number\"\r\n        step=\"any\"\r\n        defaultValue={editedAmount}\r\n        {...{ invalid }}\r\n        onChange={e => {\r\n          try {\r\n            setEditedAmount(e.target.value);\r\n            setInvalid(false);\r\n          } catch {\r\n            setInvalid(true);\r\n          }\r\n        }}\r\n        onBlur={() => {\r\n          setEditing(undefined);\r\n          setInvalid(false);\r\n        }}\r\n        variant=\"editor\"\r\n        sx={{\r\n          ...editableStyle,\r\n          fontWeight: \"medium\",\r\n          bg: invalid ? \"invalid\" : \"background\"\r\n        }}\r\n      />\r\n    </Row>\r\n  ) : (\r\n    <Row labelId={`${inputId}-label`} {...{ label, unit }}>\r\n      <StaticAmounts\r\n        sx={{\r\n          ...editableStyle,\r\n          bg: invalid ? \"invalid\" : \"background\"\r\n        }}\r\n        labelledBy={`${inputId}-label`}\r\n        onClick={() => setEditing(inputId)}\r\n        {...{ inputId, amount, unit, color, pendingAmount, pendingColor, invalid }}\r\n      >\r\n        {maxAmount && (\r\n          <Button\r\n            sx={{ fontSize: 1, p: 1, px: 3 }}\r\n            onClick={event => {\r\n              setEditedAmount(maxAmount);\r\n              event.stopPropagation();\r\n            }}\r\n            disabled={maxedOut}\r\n          >\r\n            max\r\n          </Button>\r\n        )}\r\n      </StaticAmounts>\r\n    </Row>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Container, Spinner } from \"theme-ui\";\r\n\r\nexport const LoadingOverlay: React.FC = () => (\r\n  <Container\r\n    variant=\"disabledOverlay\"\r\n    sx={{ p: \"14px\", display: \"flex\", justifyContent: \"flex-end\" }}\r\n  >\r\n    <Spinner size=\"28px\" sx={{ color: \"text\" }} />\r\n  </Container>\r\n);\r\n","import React from \"react\";\r\nimport { Flex, Box, Card } from \"theme-ui\";\r\n\r\nimport { CRITICAL_COLLATERAL_RATIO, Decimal, Difference, Percent } from \"@liquity/lib-base\";\r\n\r\nimport { Icon } from \"../Icon\";\r\n\r\nimport { StaticRow } from \"./Editor\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\n\r\ntype CollateralRatioProps = {\r\n  value?: Decimal;\r\n  change?: Difference;\r\n};\r\n\r\nexport const CollateralRatio: React.FC<CollateralRatioProps> = ({ value, change }) => {\r\n  const collateralRatioPct = new Percent(value ?? { toString: () => \"N/A\" });\r\n  const changePct = change && new Percent(change);\r\n  return (\r\n    <>\r\n      <Flex>\r\n        <Box sx={{ mt: [2, 0], ml: 3, mr: -2, fontSize: \"24px\" }}>\r\n          <Icon name=\"heartbeat\" />\r\n        </Box>\r\n\r\n        <StaticRow\r\n          label=\"Collateral ratio\"\r\n          inputId=\"trove-collateral-ratio\"\r\n          amount={collateralRatioPct.prettify()}\r\n          color={\r\n            value?.gt(CRITICAL_COLLATERAL_RATIO)\r\n              ? \"success\"\r\n              : value?.gt(1.2)\r\n              ? \"warning\"\r\n              : value?.lte(1.2)\r\n              ? \"danger\"\r\n              : \"muted\"\r\n          }\r\n          pendingAmount={\r\n            change?.positive?.absoluteValue?.gt(10)\r\n              ? \"++\"\r\n              : change?.negative?.absoluteValue?.gt(10)\r\n              ? \"--\"\r\n              : changePct?.nonZeroish(2)?.prettify()\r\n          }\r\n          pendingColor={change?.positive ? \"success\" : \"danger\"}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"220px\" }}>\r\n                  The ratio between the dollar value of the collateral and the debt (in LUSD) you are\r\n                  depositing. While the Minimum Collateral Ratio is 110% during normal operation, it\r\n                  is recommended to keep the Collateral Ratio always above 150% to avoid liquidation\r\n                  under Recovery Mode. A Collateral Ratio above 200% or 250% is recommended for\r\n                  additional safety.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n      </Flex>\r\n      {value?.lt(1.5) && (\r\n        <ActionDescription>\r\n          Keeping your CR above 150% can help avoid liquidation under Recovery Mode.\r\n        </ActionDescription>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Heading, Box, Card } from \"theme-ui\";\r\n\r\nimport {\r\n  Percent,\r\n  Difference,\r\n  Decimalish,\r\n  Decimal,\r\n  Trove,\r\n  LiquityStoreState,\r\n  LUSD_LIQUIDATION_RESERVE\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN } from \"../../strings\";\r\n\r\nimport { StaticRow } from \"./Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\ntype TroveEditorProps = {\r\n  original: Trove;\r\n  edited: Trove;\r\n  fee: Decimal;\r\n  borrowingRate: Decimal;\r\n  changePending: boolean;\r\n  dispatch: (\r\n    action: { type: \"setCollateral\" | \"setDebt\"; newValue: Decimalish } | { type: \"revert\" }\r\n  ) => void;\r\n};\r\n\r\nconst select = ({ price }: LiquityStoreState) => ({ price });\r\n\r\nexport const TroveEditor: React.FC<TroveEditorProps> = ({\r\n  children,\r\n  original,\r\n  edited,\r\n  fee,\r\n  borrowingRate,\r\n  changePending\r\n}) => {\r\n  const { price } = useLiquitySelector(select);\r\n\r\n  const feePct = new Percent(borrowingRate);\r\n\r\n  const originalCollateralRatio = !original.isEmpty ? original.collateralRatio(price) : undefined;\r\n  const collateralRatio = !edited.isEmpty ? edited.collateralRatio(price) : undefined;\r\n  const collateralRatioChange = Difference.between(collateralRatio, originalCollateralRatio);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <StaticRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={edited.collateral.prettify(4)}\r\n          unit=\"ETH\"\r\n        />\r\n\r\n        <StaticRow label=\"Debt\" inputId=\"trove-debt\" amount={edited.debt.prettify()} unit={COIN} />\r\n\r\n        {original.isEmpty && (\r\n          <StaticRow\r\n            label=\"Liquidation Reserve\"\r\n            inputId=\"trove-liquidation-reserve\"\r\n            amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n            unit={COIN}\r\n            infoIcon={\r\n              <InfoIcon\r\n                tooltip={\r\n                  <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                    An amount set aside to cover the liquidators gas costs if your Trove needs to be\r\n                    liquidated. The amount increases your debt and is refunded if you close your\r\n                    Trove by fully paying off its net debt.\r\n                  </Card>\r\n                }\r\n              />\r\n            }\r\n          />\r\n        )}\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.toString(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} change={collateralRatioChange} />\r\n\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype TroveActionProps = {\r\n  transactionId: string;\r\n  change: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n  maxBorrowingRate: Decimal;\r\n  borrowingFeeDecayToleranceMinutes: number;\r\n};\r\n\r\nexport const TroveAction: React.FC<TroveActionProps> = ({\r\n  children,\r\n  transactionId,\r\n  change,\r\n  maxBorrowingRate,\r\n  borrowingFeeDecayToleranceMinutes\r\n}) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    transactionId,\r\n    change.type === \"creation\"\r\n      ? liquity.send.openTrove.bind(liquity.send, change.params, {\r\n          maxBorrowingRate,\r\n          borrowingFeeDecayToleranceMinutes\r\n        })\r\n      : change.type === \"closure\"\r\n      ? liquity.send.closeTrove.bind(liquity.send)\r\n      : liquity.send.adjustTrove.bind(liquity.send, change.params, {\r\n          maxBorrowingRate,\r\n          borrowingFeeDecayToleranceMinutes\r\n        })\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type { TroveView, TroveEvent } from \"./types\";\r\n\r\ntype TroveViewContextType = {\r\n  view: TroveView;\r\n  dispatchEvent: (event: TroveEvent) => void;\r\n};\r\n\r\nexport const TroveViewContext = createContext<TroveViewContextType | null>(null);\r\n\r\nexport const useTroveView = (): TroveViewContextType => {\r\n  const context: TroveViewContextType | null = useContext(TroveViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <TroveViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const ErrorDescription: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"danger\",\r\n      boxShadow: 2,\r\n      bg: \"rgba(220, 44, 16, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"exclamation-triangle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n","import {\r\n  Decimal,\r\n  LUSD_MINIMUM_DEBT,\r\n  LUSD_MINIMUM_NET_DEBT,\r\n  Trove,\r\n  TroveAdjustmentParams,\r\n  TroveChange,\r\n  Percent,\r\n  MINIMUM_COLLATERAL_RATIO,\r\n  CRITICAL_COLLATERAL_RATIO,\r\n  LiquityStoreState,\r\n  TroveClosureParams,\r\n  TroveCreationParams\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { COIN } from \"../../../strings\";\r\n\r\nimport { ActionDescription, Amount } from \"../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../ErrorDescription\";\r\n\r\nconst mcrPercent = new Percent(MINIMUM_COLLATERAL_RATIO).toString(0);\r\nconst ccrPercent = new Percent(CRITICAL_COLLATERAL_RATIO).toString(0);\r\n\r\ntype TroveAdjustmentDescriptionParams = {\r\n  params: TroveAdjustmentParams<Decimal>;\r\n};\r\n\r\nconst TroveChangeDescription: React.FC<TroveAdjustmentDescriptionParams> = ({ params }) => (\r\n  <ActionDescription>\r\n    {params.depositCollateral && params.borrowLUSD ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount> and receive{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.repayLUSD && params.withdrawCollateral ? (\r\n      <>\r\n        You will pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>{\" \"}\r\n        and receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.depositCollateral && params.repayLUSD ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount> and pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.borrowLUSD && params.withdrawCollateral ? (\r\n      <>\r\n        You will receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount> and{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.depositCollateral ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.withdrawCollateral ? (\r\n      <>\r\n        You will receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.borrowLUSD ? (\r\n      <>\r\n        You will receive{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : (\r\n      <>\r\n        You will pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    )}\r\n    .\r\n  </ActionDescription>\r\n);\r\n\r\nexport const selectForTroveChangeValidation = ({\r\n  price,\r\n  total,\r\n  accountBalance,\r\n  lusdBalance,\r\n  numberOfTroves\r\n}: LiquityStoreState) => ({ price, total, accountBalance, lusdBalance, numberOfTroves });\r\n\r\ntype TroveChangeValidationSelectedState = ReturnType<typeof selectForTroveChangeValidation>;\r\n\r\ninterface TroveChangeValidationContext extends TroveChangeValidationSelectedState {\r\n  originalTrove: Trove;\r\n  resultingTrove: Trove;\r\n  recoveryMode: boolean;\r\n  wouldTriggerRecoveryMode: boolean;\r\n}\r\n\r\nexport const validateTroveChange = (\r\n  originalTrove: Trove,\r\n  adjustedTrove: Trove,\r\n  borrowingRate: Decimal,\r\n  selectedState: TroveChangeValidationSelectedState\r\n): [\r\n  validChange: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }> | undefined,\r\n  description: JSX.Element | undefined\r\n] => {\r\n  const { total, price } = selectedState;\r\n  const change = originalTrove.whatChanged(adjustedTrove, borrowingRate);\r\n\r\n  if (!change) {\r\n    return [undefined, undefined];\r\n  }\r\n\r\n  // Reapply change to get the exact state the Trove will end up in (which could be slightly\r\n  // different from `edited` due to imprecision).\r\n  const resultingTrove = originalTrove.apply(change, borrowingRate);\r\n  const recoveryMode = total.collateralRatioIsBelowCritical(price);\r\n  const wouldTriggerRecoveryMode = total\r\n    .subtract(originalTrove)\r\n    .add(resultingTrove)\r\n    .collateralRatioIsBelowCritical(price);\r\n\r\n  const context: TroveChangeValidationContext = {\r\n    ...selectedState,\r\n    originalTrove,\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode\r\n  };\r\n\r\n  if (change.type === \"invalidCreation\") {\r\n    // Trying to create a Trove with negative net debt\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        Total debt must be at least{\" \"}\r\n        <Amount>\r\n          {LUSD_MINIMUM_DEBT.toString()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  const errorDescription =\r\n    change.type === \"creation\"\r\n      ? validateTroveCreation(change.params, context)\r\n      : change.type === \"closure\"\r\n      ? validateTroveClosure(change.params, context)\r\n      : validateTroveAdjustment(change.params, context);\r\n\r\n  if (errorDescription) {\r\n    return [undefined, errorDescription];\r\n  }\r\n\r\n  return [change, <TroveChangeDescription params={change.params} />];\r\n};\r\n\r\nconst validateTroveCreation = (\r\n  { depositCollateral, borrowLUSD }: TroveCreationParams<Decimal>,\r\n  {\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    accountBalance,\r\n    price\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (borrowLUSD.lt(LUSD_MINIMUM_NET_DEBT)) {\r\n    return (\r\n      <ErrorDescription>\r\n        You must borrow at least{\" \"}\r\n        <Amount>\r\n          {LUSD_MINIMUM_NET_DEBT.toString()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (recoveryMode) {\r\n    if (!resultingTrove.isOpenableInRecoveryMode(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to open a Trove with less than <Amount>{ccrPercent}</Amount> Collateral\r\n          Ratio during recovery mode. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  } else {\r\n    if (resultingTrove.collateralRatioIsBelowMinimum(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Collateral ratio must be at least <Amount>{mcrPercent}</Amount>.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (wouldTriggerRecoveryMode) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to open a Trove that would cause the Total Collateral Ratio to fall\r\n          below <Amount>{ccrPercent}</Amount>. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (depositCollateral.gt(accountBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>{depositCollateral.sub(accountBalance).prettify()} ETH</Amount>.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst validateTroveAdjustment = (\r\n  { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD }: TroveAdjustmentParams<Decimal>,\r\n  {\r\n    originalTrove,\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    price,\r\n    accountBalance,\r\n    lusdBalance\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (recoveryMode) {\r\n    if (withdrawCollateral) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to withdraw collateral during recovery mode.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (borrowLUSD) {\r\n      if (resultingTrove.collateralRatioIsBelowCritical(price)) {\r\n        return (\r\n          <ErrorDescription>\r\n            Your collateral ratio must be at least <Amount>{ccrPercent}</Amount> to borrow during\r\n            recovery mode. Please improve your collateral ratio.\r\n          </ErrorDescription>\r\n        );\r\n      }\r\n\r\n      if (resultingTrove.collateralRatio(price).lt(originalTrove.collateralRatio(price))) {\r\n        return (\r\n          <ErrorDescription>\r\n            You're not allowed to decrease your collateral ratio during recovery mode.\r\n          </ErrorDescription>\r\n        );\r\n      }\r\n    }\r\n  } else {\r\n    if (resultingTrove.collateralRatioIsBelowMinimum(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Collateral ratio must be at least <Amount>{mcrPercent}</Amount>.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (wouldTriggerRecoveryMode) {\r\n      return (\r\n        <ErrorDescription>\r\n          The adjustment you're trying to make would cause the Total Collateral Ratio to fall below{\" \"}\r\n          <Amount>{ccrPercent}</Amount>. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (repayLUSD) {\r\n    if (resultingTrove.debt.lt(LUSD_MINIMUM_DEBT)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Total debt must be at least{\" \"}\r\n          <Amount>\r\n            {LUSD_MINIMUM_DEBT.toString()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (repayLUSD.gt(lusdBalance)) {\r\n      return (\r\n        <ErrorDescription>\r\n          The amount you're trying to repay exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {repayLUSD.sub(lusdBalance).prettify()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (depositCollateral?.gt(accountBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>{depositCollateral.sub(accountBalance).prettify()} ETH</Amount>.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst validateTroveClosure = (\r\n  { repayLUSD }: TroveClosureParams<Decimal>,\r\n  {\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    numberOfTroves,\r\n    lusdBalance\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (numberOfTroves === 1) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close your Trove when there are no other Troves in the system.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (recoveryMode) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close your Trove during recovery mode.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (repayLUSD?.gt(lusdBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        You need{\" \"}\r\n        <Amount>\r\n          {repayLUSD.sub(lusdBalance).prettify()} {COIN}\r\n        </Amount>{\" \"}\r\n        more to close your Trove.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (wouldTriggerRecoveryMode) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close a Trove if it would cause the Total Collateralization Ratio to\r\n        fall below <Amount>{ccrPercent}</Amount>. Please wait until the Total Collateral Ratio\r\n        increases.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n","import { useCallback, useEffect } from \"react\";\r\nimport { Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState, Decimal, Trove, Decimalish, LUSD_MINIMUM_DEBT } from \"@liquity/lib-base\";\r\n\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\n\r\nimport { TroveEditor } from \"./TroveEditor\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\n\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst init = ({ trove }: LiquityStoreState) => ({\r\n  original: trove,\r\n  edited: new Trove(trove.collateral, trove.debt),\r\n  changePending: false,\r\n  debtDirty: false,\r\n  addedMinimumDebt: false\r\n});\r\n\r\ntype TroveManagerState = ReturnType<typeof init>;\r\ntype TroveManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"startChange\" | \"finishChange\" | \"revert\" | \"addMinimumDebt\" | \"removeMinimumDebt\" }\r\n  | { type: \"setCollateral\" | \"setDebt\"; newValue: Decimalish };\r\n\r\nconst reduceWith = (action: TroveManagerAction) => (state: TroveManagerState): TroveManagerState =>\r\n  reduce(state, action);\r\n\r\nconst addMinimumDebt = reduceWith({ type: \"addMinimumDebt\" });\r\nconst removeMinimumDebt = reduceWith({ type: \"removeMinimumDebt\" });\r\nconst finishChange = reduceWith({ type: \"finishChange\" });\r\nconst revert = reduceWith({ type: \"revert\" });\r\n\r\nconst reduce = (state: TroveManagerState, action: TroveManagerAction): TroveManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { original, edited, changePending, debtDirty, addedMinimumDebt } = state;\r\n\r\n  switch (action.type) {\r\n    case \"startChange\": {\r\n      console.log(\"starting change\");\r\n      return { ...state, changePending: true };\r\n    }\r\n\r\n    case \"finishChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"setCollateral\": {\r\n      const newCollateral = Decimal.from(action.newValue);\r\n\r\n      const newState = {\r\n        ...state,\r\n        edited: edited.setCollateral(newCollateral)\r\n      };\r\n\r\n      if (!debtDirty) {\r\n        if (edited.isEmpty && newCollateral.nonZero) {\r\n          return addMinimumDebt(newState);\r\n        }\r\n        if (addedMinimumDebt && newCollateral.isZero) {\r\n          return removeMinimumDebt(newState);\r\n        }\r\n      }\r\n\r\n      return newState;\r\n    }\r\n\r\n    case \"setDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(action.newValue),\r\n        debtDirty: true\r\n      };\r\n\r\n    case \"addMinimumDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(LUSD_MINIMUM_DEBT),\r\n        addedMinimumDebt: true\r\n      };\r\n\r\n    case \"removeMinimumDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(0),\r\n        addedMinimumDebt: false\r\n      };\r\n\r\n    case \"revert\":\r\n      return {\r\n        ...state,\r\n        edited: new Trove(original.collateral, original.debt),\r\n        debtDirty: false,\r\n        addedMinimumDebt: false\r\n      };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        newState: { trove },\r\n        stateChange: { troveBeforeRedistribution: changeCommitted }\r\n      } = action;\r\n\r\n      const newState = {\r\n        ...state,\r\n        original: trove\r\n      };\r\n\r\n      if (changePending && changeCommitted) {\r\n        return finishChange(revert(newState));\r\n      }\r\n\r\n      const change = original.whatChanged(edited, 0);\r\n\r\n      if (\r\n        (change?.type === \"creation\" && !trove.isEmpty) ||\r\n        (change?.type === \"closure\" && trove.isEmpty)\r\n      ) {\r\n        return revert(newState);\r\n      }\r\n\r\n      return { ...newState, edited: trove.apply(change, 0) };\r\n    }\r\n  }\r\n};\r\n\r\nconst feeFrom = (original: Trove, edited: Trove, borrowingRate: Decimal): Decimal => {\r\n  const change = original.whatChanged(edited, borrowingRate);\r\n\r\n  if (change && change.type !== \"invalidCreation\" && change.params.borrowLUSD) {\r\n    return change.params.borrowLUSD.mul(borrowingRate);\r\n  } else {\r\n    return Decimal.ZERO;\r\n  }\r\n};\r\n\r\nconst select = (state: LiquityStoreState) => ({\r\n  fees: state.fees,\r\n  validationContext: selectForTroveChangeValidation(state)\r\n});\r\n\r\nconst transactionIdPrefix = \"trove-\";\r\nconst transactionIdMatcher = new RegExp(`^${transactionIdPrefix}`);\r\n\r\ntype TroveManagerProps = {\r\n  collateral?: Decimalish;\r\n  debt?: Decimalish;\r\n};\r\n\r\nexport const TroveManager: React.FC<TroveManagerProps> = ({ collateral, debt }) => {\r\n  const [{ original, edited, changePending }, dispatch] = useLiquityReducer(reduce, init);\r\n  const { fees, validationContext } = useLiquitySelector(select);\r\n\r\n  useEffect(() => {\r\n    if (collateral !== undefined) {\r\n      dispatch({ type: \"setCollateral\", newValue: collateral });\r\n    }\r\n    if (debt !== undefined) {\r\n      dispatch({ type: \"setDebt\", newValue: debt });\r\n    }\r\n  }, [collateral, debt, dispatch]);\r\n\r\n  const borrowingRate = fees.borrowingRate();\r\n  const maxBorrowingRate = borrowingRate.add(0.005); // TODO slippage tolerance\r\n\r\n  const [validChange, description] = validateTroveChange(\r\n    original,\r\n    edited,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleCancel = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const openingNewTrove = original.isEmpty;\r\n\r\n  const myTransactionState = useMyTransactionState(transactionIdMatcher);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      myTransactionState.type === \"waitingForApproval\" ||\r\n      myTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (myTransactionState.type === \"failed\" || myTransactionState.type === \"cancelled\") {\r\n      dispatch({ type: \"finishChange\" });\r\n    } else if (myTransactionState.type === \"confirmedOneShot\") {\r\n      if (myTransactionState.id === `${transactionIdPrefix}closure`) {\r\n        dispatchEvent(\"TROVE_CLOSED\");\r\n      } else {\r\n        dispatchEvent(\"TROVE_ADJUSTED\");\r\n      }\r\n    }\r\n  }, [myTransactionState, dispatch, dispatchEvent]);\r\n\r\n  return (\r\n    <TroveEditor\r\n      original={original}\r\n      edited={edited}\r\n      fee={feeFrom(original, edited, borrowingRate)}\r\n      borrowingRate={borrowingRate}\r\n      changePending={changePending}\r\n      dispatch={dispatch}\r\n    >\r\n      {description ??\r\n        (openingNewTrove ? (\r\n          <ActionDescription>\r\n            Start by entering the amount of ETH you'd like to deposit as collateral.\r\n          </ActionDescription>\r\n        ) : (\r\n          <ActionDescription>\r\n            Adjust your Trove by modifying its collateral, debt, or both.\r\n          </ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleCancel}>\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <TroveAction\r\n            transactionId={`${transactionIdPrefix}${validChange.type}`}\r\n            change={validChange}\r\n            maxBorrowingRate={maxBorrowingRate}\r\n            borrowingFeeDecayToleranceMinutes={60}\r\n          >\r\n            Confirm\r\n          </TroveAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </TroveEditor>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { DisabledEditableRow } from \"./Editor\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { Icon } from \"../Icon\";\r\nimport { COIN } from \"../../strings\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\n\r\nconst select = ({ trove, price }: LiquityStoreState) => ({ trove, price });\r\n\r\nexport const ReadOnlyTrove: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const handleAdjustTrove = useCallback(() => {\r\n    dispatchEvent(\"ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n  const handleCloseTrove = useCallback(() => {\r\n    dispatchEvent(\"CLOSE_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const { trove, price } = useLiquitySelector(select);\r\n\r\n  // console.log(\"READONLY TROVE\", trove.collateral.prettify(4));\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Box>\r\n          <DisabledEditableRow\r\n            label=\"Collateral\"\r\n            inputId=\"trove-collateral\"\r\n            amount={trove.collateral.prettify(4)}\r\n            unit=\"ETH\"\r\n          />\r\n\r\n          <DisabledEditableRow\r\n            label=\"Debt\"\r\n            inputId=\"trove-debt\"\r\n            amount={trove.debt.prettify()}\r\n            unit={COIN}\r\n          />\r\n\r\n          <CollateralRatio value={trove.collateralRatio(price)} />\r\n        </Box>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={handleCloseTrove}>\r\n            Close Trove\r\n          </Button>\r\n          <Button onClick={handleAdjustTrove}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { Box, Flex, Heading, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\ntype InfoMessageProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n};\r\n\r\nexport const InfoMessage: React.FC<InfoMessageProps> = ({ title, children, icon }) => (\r\n  <Box sx={{ mx: 1, mb: 3 }}>\r\n    <Flex sx={{ alignItems: \"center\", mb: \"10px\" }}>\r\n      <Box sx={{ mr: \"12px\", fontSize: \"20px\" }}>{icon || <Icon name=\"info-circle\" />}</Box>\r\n\r\n      <Heading as=\"h3\">{title}</Heading>\r\n    </Flex>\r\n\r\n    <Text sx={{ fontSize: 2 }}>{children}</Text>\r\n  </Box>\r\n);\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\n\r\nexport const NoTrove: React.FC = props => {\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"You haven't borrowed any LUSD yet.\">\r\n          You can borrow LUSD by opening a Trove.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button onClick={handleOpenTrove}>Open Trove</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { useEffect, useState } from \"react\";\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\n\r\ntype ValidTroveChange = Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n\r\nconst paramsEq = (a?: Decimal, b?: Decimal) => (a && b ? a.eq(b) : !a && !b);\r\n\r\nconst equals = (a: ValidTroveChange, b: ValidTroveChange): boolean => {\r\n  return (\r\n    a.type === b.type &&\r\n    paramsEq(a.params.borrowLUSD, b.params.borrowLUSD) &&\r\n    paramsEq(a.params.repayLUSD, b.params.repayLUSD) &&\r\n    paramsEq(a.params.depositCollateral, b.params.depositCollateral) &&\r\n    paramsEq(a.params.withdrawCollateral, b.params.withdrawCollateral)\r\n  );\r\n};\r\n\r\nexport const useStableTroveChange = (\r\n  troveChange: ValidTroveChange | undefined\r\n): ValidTroveChange | undefined => {\r\n  const [stableTroveChange, setStableTroveChange] = useState(troveChange);\r\n\r\n  useEffect(() => {\r\n    if (!!stableTroveChange !== !!troveChange) {\r\n      setStableTroveChange(troveChange);\r\n    } else if (stableTroveChange && troveChange && !equals(stableTroveChange, troveChange)) {\r\n      setStableTroveChange(troveChange);\r\n    }\r\n  }, [stableTroveChange, troveChange]);\r\n\r\n  return stableTroveChange;\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const Warning: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"warning\",\r\n      boxShadow: 2\r\n      // bg: \"rgba(46, 182, 234, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"exclamation-triangle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n","import React, { useEffect } from \"react\";\r\n\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\nimport { PopulatedEthersLiquityTransaction } from \"@liquity/lib-ethers\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { Warning } from \"../Warning\";\r\n\r\nexport type GasEstimationState =\r\n  | { type: \"idle\" | \"inProgress\" }\r\n  | { type: \"complete\"; populatedTx: PopulatedEthersLiquityTransaction };\r\n\r\ntype ExpensiveTroveChangeWarningParams = {\r\n  troveChange?: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n  maxBorrowingRate: Decimal;\r\n  borrowingFeeDecayToleranceMinutes: number;\r\n  gasEstimationState: GasEstimationState;\r\n  setGasEstimationState: (newState: GasEstimationState) => void;\r\n};\r\n\r\nexport const ExpensiveTroveChangeWarning: React.FC<ExpensiveTroveChangeWarningParams> = ({\r\n  troveChange,\r\n  maxBorrowingRate,\r\n  borrowingFeeDecayToleranceMinutes,\r\n  gasEstimationState,\r\n  setGasEstimationState\r\n}) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  useEffect(() => {\r\n    if (troveChange && troveChange.type !== \"closure\") {\r\n      setGasEstimationState({ type: \"inProgress\" });\r\n\r\n      let cancelled = false;\r\n\r\n      const timeoutId = setTimeout(async () => {\r\n        const populatedTx = await (troveChange.type === \"creation\"\r\n          ? liquity.populate.openTrove(troveChange.params, {\r\n              maxBorrowingRate,\r\n              borrowingFeeDecayToleranceMinutes\r\n            })\r\n          : liquity.populate.adjustTrove(troveChange.params, {\r\n              maxBorrowingRate,\r\n              borrowingFeeDecayToleranceMinutes\r\n            }));\r\n\r\n        if (!cancelled) {\r\n          setGasEstimationState({ type: \"complete\", populatedTx });\r\n          console.log(\r\n            \"Estimated TX cost: \" +\r\n              Decimal.from(`${populatedTx.rawPopulatedTransaction.gasLimit}`).prettify(0)\r\n          );\r\n        }\r\n      }, 333);\r\n\r\n      return () => {\r\n        clearTimeout(timeoutId);\r\n        cancelled = true;\r\n      };\r\n    } else {\r\n      setGasEstimationState({ type: \"idle\" });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [troveChange]);\r\n\r\n  if (\r\n    troveChange &&\r\n    gasEstimationState.type === \"complete\" &&\r\n    gasEstimationState.populatedTx.gasHeadroom !== undefined &&\r\n    gasEstimationState.populatedTx.gasHeadroom >= 200000\r\n  ) {\r\n    return troveChange.type === \"creation\" ? (\r\n      <Warning>\r\n        The cost of opening a Trove in this collateral ratio range is rather high. To lower it,\r\n        choose a slightly different collateral ratio.\r\n      </Warning>\r\n    ) : (\r\n      <Warning>\r\n        The cost of adjusting a Trove into this collateral ratio range is rather high. To lower it,\r\n        choose a slightly different collateral ratio.\r\n      </Warning>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n","import React, { useCallback, useEffect, useState } from \"react\";\r\nimport { Flex, Button, Box, Card, Heading, Spinner } from \"theme-ui\";\r\nimport {\r\n  LiquityStoreState,\r\n  Decimal,\r\n  Trove,\r\n  LUSD_LIQUIDATION_RESERVE,\r\n  LUSD_MINIMUM_NET_DEBT,\r\n  Percent\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useStableTroveChange } from \"../../hooks/useStableTroveChange\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { COIN } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { EditableRow, StaticRow } from \"./Editor\";\r\nimport { ExpensiveTroveChangeWarning, GasEstimationState } from \"./ExpensiveTroveChangeWarning\";\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst selector = (state: LiquityStoreState) => {\r\n  const { fees, price, accountBalance } = state;\r\n  return {\r\n    fees,\r\n    price,\r\n    accountBalance,\r\n    validationContext: selectForTroveChangeValidation(state)\r\n  };\r\n};\r\n\r\nconst EMPTY_TROVE = new Trove(Decimal.ZERO, Decimal.ZERO);\r\nconst TRANSACTION_ID = \"trove-creation\";\r\nconst GAS_ROOM_ETH = Decimal.from(0.1);\r\n\r\nexport const Opening: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const { fees, price, accountBalance, validationContext } = useLiquitySelector(selector);\r\n  const borrowingRate = fees.borrowingRate();\r\n  const editingState = useState<string>();\r\n\r\n  const [collateral, setCollateral] = useState<Decimal>(Decimal.ZERO);\r\n  const [borrowAmount, setBorrowAmount] = useState<Decimal>(Decimal.ZERO);\r\n\r\n  const maxBorrowingRate = borrowingRate.add(0.005);\r\n\r\n  const fee = borrowAmount.mul(borrowingRate);\r\n  const feePct = new Percent(borrowingRate);\r\n  const totalDebt = borrowAmount.add(LUSD_LIQUIDATION_RESERVE).add(fee);\r\n  const isDirty = !collateral.isZero || !borrowAmount.isZero;\r\n  const trove = isDirty ? new Trove(collateral, totalDebt) : EMPTY_TROVE;\r\n  const maxCollateral = accountBalance.gt(GAS_ROOM_ETH)\r\n    ? accountBalance.sub(GAS_ROOM_ETH)\r\n    : Decimal.ZERO;\r\n  const collateralMaxedOut = collateral.eq(maxCollateral);\r\n  const collateralRatio =\r\n    !collateral.isZero && !borrowAmount.isZero ? trove.collateralRatio(price) : undefined;\r\n\r\n  const [troveChange, description] = validateTroveChange(\r\n    EMPTY_TROVE,\r\n    trove,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const stableTroveChange = useStableTroveChange(troveChange);\r\n  const [gasEstimationState, setGasEstimationState] = useState<GasEstimationState>({ type: \"idle\" });\r\n\r\n  const transactionState = useMyTransactionState(TRANSACTION_ID);\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const reset = useCallback(() => {\r\n    setCollateral(Decimal.ZERO);\r\n    setBorrowAmount(Decimal.ZERO);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!collateral.isZero && borrowAmount.isZero) {\r\n      setBorrowAmount(LUSD_MINIMUM_NET_DEBT);\r\n    }\r\n  }, [collateral, borrowAmount]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Trove\r\n        {isDirty && !isTransactionPending && (\r\n          <Button variant=\"titleIcon\" sx={{ \":enabled:hover\": { color: \"danger\" } }} onClick={reset}>\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={collateral.prettify(4)}\r\n          maxAmount={maxCollateral.toString()}\r\n          maxedOut={collateralMaxedOut}\r\n          editingState={editingState}\r\n          unit=\"ETH\"\r\n          editedAmount={collateral.toString(4)}\r\n          setEditedAmount={(amount: string) => setCollateral(Decimal.from(amount))}\r\n        />\r\n\r\n        <EditableRow\r\n          label=\"Borrow\"\r\n          inputId=\"trove-borrow-amount\"\r\n          amount={borrowAmount.prettify()}\r\n          unit={COIN}\r\n          editingState={editingState}\r\n          editedAmount={borrowAmount.toString(2)}\r\n          setEditedAmount={(amount: string) => setBorrowAmount(Decimal.from(amount))}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Liquidation Reserve\"\r\n          inputId=\"trove-liquidation-reserve\"\r\n          amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                  An amount set aside to cover the liquidators gas costs if your Trove needs to be\r\n                  liquidated. The amount increases your debt and is refunded if you close your Trove\r\n                  by fully paying off its net debt.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.prettify(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Total debt\"\r\n          inputId=\"trove-total-debt\"\r\n          amount={totalDebt.prettify(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  The total amount of LUSD your Trove will hold.{\" \"}\r\n                  {isDirty && (\r\n                    <>\r\n                      You will need to repay {totalDebt.sub(LUSD_LIQUIDATION_RESERVE).prettify(2)}{\" \"}\r\n                      LUSD to reclaim your collateral ({LUSD_LIQUIDATION_RESERVE.toString()} LUSD\r\n                      Liquidation Reserve excluded).\r\n                    </>\r\n                  )}\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} />\r\n\r\n        {description ?? (\r\n          <ActionDescription>\r\n            Start by entering the amount of ETH you'd like to deposit as collateral.\r\n          </ActionDescription>\r\n        )}\r\n\r\n        <ExpensiveTroveChangeWarning\r\n          troveChange={stableTroveChange}\r\n          maxBorrowingRate={maxBorrowingRate}\r\n          borrowingFeeDecayToleranceMinutes={60}\r\n          gasEstimationState={gasEstimationState}\r\n          setGasEstimationState={setGasEstimationState}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n\r\n          {gasEstimationState.type === \"inProgress\" ? (\r\n            <Button disabled>\r\n              <Spinner size=\"24px\" sx={{ color: \"background\" }} />\r\n            </Button>\r\n          ) : stableTroveChange ? (\r\n            <TroveAction\r\n              transactionId={TRANSACTION_ID}\r\n              change={stableTroveChange}\r\n              maxBorrowingRate={maxBorrowingRate}\r\n              borrowingFeeDecayToleranceMinutes={60}\r\n            >\r\n              Confirm\r\n            </TroveAction>\r\n          ) : (\r\n            <Button disabled>Confirm</Button>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback, useEffect, useState, useRef } from \"react\";\r\nimport { Flex, Button, Box, Card, Heading } from \"theme-ui\";\r\nimport {\r\n  LiquityStoreState,\r\n  Decimal,\r\n  Trove,\r\n  LUSD_LIQUIDATION_RESERVE,\r\n  Percent,\r\n  Difference\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useStableTroveChange } from \"../../hooks/useStableTroveChange\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { COIN } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { EditableRow, StaticRow } from \"./Editor\";\r\nimport { ExpensiveTroveChangeWarning, GasEstimationState } from \"./ExpensiveTroveChangeWarning\";\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst selector = (state: LiquityStoreState) => {\r\n  const { trove, fees, price, accountBalance } = state;\r\n  return {\r\n    trove,\r\n    fees,\r\n    price,\r\n    accountBalance,\r\n    validationContext: selectForTroveChangeValidation(state)\r\n  };\r\n};\r\n\r\nconst TRANSACTION_ID = \"trove-adjustment\";\r\nconst GAS_ROOM_ETH = Decimal.from(0.1);\r\n\r\nconst feeFrom = (original: Trove, edited: Trove, borrowingRate: Decimal): Decimal => {\r\n  const change = original.whatChanged(edited, borrowingRate);\r\n\r\n  if (change && change.type !== \"invalidCreation\" && change.params.borrowLUSD) {\r\n    return change.params.borrowLUSD.mul(borrowingRate);\r\n  } else {\r\n    return Decimal.ZERO;\r\n  }\r\n};\r\n\r\nconst applyUnsavedCollateralChanges = (unsavedChanges: Difference, trove: Trove) => {\r\n  if (unsavedChanges.absoluteValue) {\r\n    if (unsavedChanges.positive) {\r\n      return trove.collateral.add(unsavedChanges.absoluteValue);\r\n    }\r\n    if (unsavedChanges.negative) {\r\n      if (unsavedChanges.absoluteValue.lt(trove.collateral)) {\r\n        return trove.collateral.sub(unsavedChanges.absoluteValue);\r\n      }\r\n    }\r\n    return trove.collateral;\r\n  }\r\n  return trove.collateral;\r\n};\r\n\r\nconst applyUnsavedNetDebtChanges = (unsavedChanges: Difference, trove: Trove) => {\r\n  if (unsavedChanges.absoluteValue) {\r\n    if (unsavedChanges.positive) {\r\n      return trove.netDebt.add(unsavedChanges.absoluteValue);\r\n    }\r\n    if (unsavedChanges.negative) {\r\n      if (unsavedChanges.absoluteValue.lt(trove.netDebt)) {\r\n        return trove.netDebt.sub(unsavedChanges.absoluteValue);\r\n      }\r\n    }\r\n    return trove.netDebt;\r\n  }\r\n  return trove.netDebt;\r\n};\r\n\r\nexport const Adjusting: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const { trove, fees, price, accountBalance, validationContext } = useLiquitySelector(selector);\r\n  const editingState = useState<string>();\r\n  const previousTrove = useRef<Trove>(trove);\r\n  const [collateral, setCollateral] = useState<Decimal>(trove.collateral);\r\n  const [netDebt, setNetDebt] = useState<Decimal>(trove.netDebt);\r\n\r\n  const transactionState = useMyTransactionState(TRANSACTION_ID);\r\n  const borrowingRate = fees.borrowingRate();\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"TROVE_ADJUSTED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  useEffect(() => {\r\n    if (!previousTrove.current.collateral.eq(trove.collateral)) {\r\n      const unsavedChanges = Difference.between(collateral, previousTrove.current.collateral);\r\n      const nextCollateral = applyUnsavedCollateralChanges(unsavedChanges, trove);\r\n      setCollateral(nextCollateral);\r\n    }\r\n    if (!previousTrove.current.netDebt.eq(trove.netDebt)) {\r\n      const unsavedChanges = Difference.between(netDebt, previousTrove.current.netDebt);\r\n      const nextNetDebt = applyUnsavedNetDebtChanges(unsavedChanges, trove);\r\n      setNetDebt(nextNetDebt);\r\n    }\r\n    previousTrove.current = trove;\r\n  }, [trove, collateral, netDebt]);\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const reset = useCallback(() => {\r\n    setCollateral(trove.collateral);\r\n    setNetDebt(trove.netDebt);\r\n  }, [trove.collateral, trove.netDebt]);\r\n\r\n  const isDirty = !collateral.eq(trove.collateral) || !netDebt.eq(trove.netDebt);\r\n  const isDebtIncrease = netDebt.gt(trove.netDebt);\r\n  const debtIncreaseAmount = isDebtIncrease ? netDebt.sub(trove.netDebt) : Decimal.ZERO;\r\n\r\n  const fee = isDebtIncrease\r\n    ? feeFrom(trove, new Trove(trove.collateral, trove.debt.add(debtIncreaseAmount)), borrowingRate)\r\n    : Decimal.ZERO;\r\n  const totalDebt = netDebt.add(LUSD_LIQUIDATION_RESERVE).add(fee);\r\n  const maxBorrowingRate = borrowingRate.add(0.005);\r\n  const updatedTrove = isDirty ? new Trove(collateral, totalDebt) : trove;\r\n  const feePct = new Percent(borrowingRate);\r\n  const availableEth = accountBalance.gt(GAS_ROOM_ETH)\r\n    ? accountBalance.sub(GAS_ROOM_ETH)\r\n    : Decimal.ZERO;\r\n  const maxCollateral = trove.collateral.add(availableEth);\r\n  const collateralMaxedOut = collateral.eq(maxCollateral);\r\n  const collateralRatio =\r\n    !collateral.isZero && !netDebt.isZero ? updatedTrove.collateralRatio(price) : undefined;\r\n  const collateralRatioChange = Difference.between(collateralRatio, trove.collateralRatio(price));\r\n\r\n  const [troveChange, description] = validateTroveChange(\r\n    trove,\r\n    updatedTrove,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const stableTroveChange = useStableTroveChange(troveChange);\r\n  const [gasEstimationState, setGasEstimationState] = useState<GasEstimationState>({ type: \"idle\" });\r\n\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  if (trove.status !== \"open\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Trove\r\n        {isDirty && !isTransactionPending && (\r\n          <Button variant=\"titleIcon\" sx={{ \":enabled:hover\": { color: \"danger\" } }} onClick={reset}>\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={collateral.prettify(4)}\r\n          maxAmount={maxCollateral.toString()}\r\n          maxedOut={collateralMaxedOut}\r\n          editingState={editingState}\r\n          unit=\"ETH\"\r\n          editedAmount={collateral.toString(4)}\r\n          setEditedAmount={(amount: string) => setCollateral(Decimal.from(amount))}\r\n        />\r\n\r\n        <EditableRow\r\n          label=\"Net debt\"\r\n          inputId=\"trove-net-debt-amount\"\r\n          amount={netDebt.prettify()}\r\n          unit={COIN}\r\n          editingState={editingState}\r\n          editedAmount={netDebt.toString(2)}\r\n          setEditedAmount={(amount: string) => setNetDebt(Decimal.from(amount))}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Liquidation Reserve\"\r\n          inputId=\"trove-liquidation-reserve\"\r\n          amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                  An amount set aside to cover the liquidators gas costs if your Trove needs to be\r\n                  liquidated. The amount increases your debt and is refunded if you close your Trove\r\n                  by fully paying off its net debt.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.prettify(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Total debt\"\r\n          inputId=\"trove-total-debt\"\r\n          amount={totalDebt.prettify(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  The total amount of LUSD your Trove will hold.{\" \"}\r\n                  {isDirty && (\r\n                    <>\r\n                      You will need to repay {totalDebt.sub(LUSD_LIQUIDATION_RESERVE).prettify(2)}{\" \"}\r\n                      LUSD to reclaim your collateral ({LUSD_LIQUIDATION_RESERVE.toString()} LUSD\r\n                      Liquidation Reserve excluded).\r\n                    </>\r\n                  )}\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} change={collateralRatioChange} />\r\n\r\n        {description ?? (\r\n          <ActionDescription>\r\n            Adjust your Trove by modifying its collateral, debt, or both.\r\n          </ActionDescription>\r\n        )}\r\n\r\n        <ExpensiveTroveChangeWarning\r\n          troveChange={stableTroveChange}\r\n          maxBorrowingRate={maxBorrowingRate}\r\n          borrowingFeeDecayToleranceMinutes={60}\r\n          gasEstimationState={gasEstimationState}\r\n          setGasEstimationState={setGasEstimationState}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n\r\n          {stableTroveChange ? (\r\n            <TroveAction\r\n              transactionId={TRANSACTION_ID}\r\n              change={stableTroveChange}\r\n              maxBorrowingRate={maxBorrowingRate}\r\n              borrowingFeeDecayToleranceMinutes={60}\r\n            >\r\n              Confirm\r\n            </TroveAction>\r\n          ) : (\r\n            <Button disabled>Confirm</Button>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button, Flex, Spinner } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Transaction, useMyTransactionState } from \"./Transaction\";\r\nimport { useTroveView } from \"./Trove/context/TroveViewContext\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  collateralSurplusBalance\r\n});\r\n\r\nexport const CollateralSurplusAction: React.FC = () => {\r\n  const { collateralSurplusBalance } = useLiquitySelector(select);\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const myTransactionId = \"claim-coll-surplus\";\r\n  const myTransactionState = useMyTransactionState(myTransactionId);\r\n\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  useEffect(() => {\r\n    if (myTransactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"TROVE_SURPLUS_COLLATERAL_CLAIMED\");\r\n    }\r\n  }, [myTransactionState.type, dispatchEvent]);\r\n\r\n  return myTransactionState.type === \"waitingForApproval\" ? (\r\n    <Flex variant=\"layout.actions\">\r\n      <Button disabled sx={{ mx: 2 }}>\r\n        <Spinner sx={{ mr: 2, color: \"white\" }} size=\"20px\" />\r\n        Waiting for your approval\r\n      </Button>\r\n    </Flex>\r\n  ) : myTransactionState.type !== \"waitingForConfirmation\" &&\r\n    myTransactionState.type !== \"confirmed\" ? (\r\n    <Flex variant=\"layout.actions\">\r\n      <Transaction\r\n        id={myTransactionId}\r\n        send={liquity.claimCollateralSurplus.bind(liquity, undefined)}\r\n      >\r\n        <Button sx={{ mx: 2 }}>Claim {collateralSurplusBalance.prettify()} ETH</Button>\r\n      </Transaction>\r\n    </Flex>\r\n  ) : null;\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Button, Flex } from \"theme-ui\";\r\nimport { CollateralSurplusAction } from \"../CollateralSurplusAction\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  hasSurplusCollateral: !collateralSurplusBalance.isZero\r\n});\r\n\r\nexport const RedeemedTrove: React.FC = () => {\r\n  const { hasSurplusCollateral } = useLiquitySelector(select);\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"Your Trove has been redeemed.\">\r\n          {hasSurplusCollateral\r\n            ? \"Please reclaim your remaining collateral before opening a new Trove.\"\r\n            : \"You can borrow LUSD by opening a Trove.\"}\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          {hasSurplusCollateral && <CollateralSurplusAction />}\r\n          {!hasSurplusCollateral && <Button onClick={handleOpenTrove}>Open Trove</Button>}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Button, Flex } from \"theme-ui\";\r\nimport { CollateralSurplusAction } from \"../CollateralSurplusAction\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  hasSurplusCollateral: !collateralSurplusBalance.isZero\r\n});\r\n\r\nexport const LiquidatedTrove: React.FC = () => {\r\n  const { hasSurplusCollateral } = useLiquitySelector(select);\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"Your Trove has been liquidated.\">\r\n          {hasSurplusCollateral\r\n            ? \"Please reclaim your remaining collateral before opening a new Trove.\"\r\n            : \"You can borrow LUSD by opening a Trove.\"}\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          {hasSurplusCollateral && <CollateralSurplusAction />}\r\n          {!hasSurplusCollateral && <Button onClick={handleOpenTrove}>Open Trove</Button>}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { TroveManager } from \"./TroveManager\";\r\nimport { ReadOnlyTrove } from \"./ReadOnlyTrove\";\r\nimport { NoTrove } from \"./NoTrove\";\r\nimport { Opening } from \"./Opening\";\r\nimport { Adjusting } from \"./Adjusting\";\r\nimport { RedeemedTrove } from \"./RedeemedTrove\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { LiquidatedTrove } from \"./LiquidatedTrove\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nexport const Trove: React.FC = props => {\r\n  const { view } = useTroveView();\r\n\r\n  switch (view) {\r\n    // loading state not needed, as main app has a loading spinner that blocks render until the liquity backend data is available\r\n    case \"ACTIVE\": {\r\n      return <ReadOnlyTrove {...props} />;\r\n    }\r\n    case \"ADJUSTING\": {\r\n      return <Adjusting {...props} />;\r\n    }\r\n    case \"CLOSING\": {\r\n      return <TroveManager {...props} collateral={Decimal.ZERO} debt={Decimal.ZERO} />;\r\n    }\r\n    case \"OPENING\": {\r\n      return <Opening {...props} />;\r\n    }\r\n    case \"LIQUIDATED\": {\r\n      return <LiquidatedTrove {...props} />;\r\n    }\r\n    case \"REDEEMED\": {\r\n      return <RedeemedTrove {...props} />;\r\n    }\r\n    case \"NONE\": {\r\n      return <NoTrove {...props} />;\r\n    }\r\n  }\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Heading, Box, Card, Button } from \"theme-ui\";\r\n\r\nimport {\r\n  Decimal,\r\n  Decimalish,\r\n  StabilityDeposit,\r\n  LiquityStoreState,\r\n  Difference\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { Icon } from \"../Icon\";\r\nimport { EditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\nconst select = ({ lusdBalance, lusdInStabilityPool }: LiquityStoreState) => ({\r\n  lusdBalance,\r\n  lusdInStabilityPool\r\n});\r\n\r\ntype StabilityDepositEditorProps = {\r\n  originalDeposit: StabilityDeposit;\r\n  editedLUSD: Decimal;\r\n  changePending: boolean;\r\n  dispatch: (action: { type: \"setDeposit\"; newValue: Decimalish } | { type: \"revert\" }) => void;\r\n};\r\n\r\nexport const StabilityDepositEditor: React.FC<StabilityDepositEditorProps> = ({\r\n  originalDeposit,\r\n  editedLUSD,\r\n  changePending,\r\n  dispatch,\r\n  children\r\n}) => {\r\n  const { lusdBalance, lusdInStabilityPool } = useLiquitySelector(select);\r\n  const editingState = useState<string>();\r\n\r\n  const edited = !editedLUSD.eq(originalDeposit.currentLUSD);\r\n\r\n  const maxAmount = originalDeposit.currentLUSD.add(lusdBalance);\r\n  const maxedOut = editedLUSD.eq(maxAmount);\r\n\r\n  const lusdInStabilityPoolAfterChange = lusdInStabilityPool\r\n    .sub(originalDeposit.currentLUSD)\r\n    .add(editedLUSD);\r\n\r\n  const originalPoolShare = originalDeposit.currentLUSD.mulDiv(100, lusdInStabilityPool);\r\n  const newPoolShare = editedLUSD.mulDiv(100, lusdInStabilityPoolAfterChange);\r\n  const poolShareChange =\r\n    originalDeposit.currentLUSD.nonZero &&\r\n    Difference.between(newPoolShare, originalPoolShare).nonZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        {edited && !changePending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => dispatch({ type: \"revert\" })}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Deposit\"\r\n          inputId=\"deposit-lqty\"\r\n          amount={editedLUSD.prettify()}\r\n          maxAmount={maxAmount.toString()}\r\n          maxedOut={maxedOut}\r\n          unit={COIN}\r\n          {...{ editingState }}\r\n          editedAmount={editedLUSD.toString(2)}\r\n          setEditedAmount={newValue => dispatch({ type: \"setDeposit\", newValue })}\r\n        />\r\n\r\n        {newPoolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"deposit-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"deposit-share\"\r\n            amount={newPoolShare.prettify(4)}\r\n            pendingAmount={poolShareChange?.prettify(4).concat(\"%\")}\r\n            pendingColor={poolShareChange?.positive ? \"success\" : \"danger\"}\r\n            unit=\"%\"\r\n          />\r\n        )}\r\n\r\n        {!originalDeposit.isEmpty && (\r\n          <>\r\n            <StaticRow\r\n              label=\"Liquidation gain\"\r\n              inputId=\"deposit-gain\"\r\n              amount={originalDeposit.collateralGain.prettify(4)}\r\n              color={originalDeposit.collateralGain.nonZero && \"success\"}\r\n              unit=\"ETH\"\r\n            />\r\n\r\n            <StaticRow\r\n              label=\"Reward\"\r\n              inputId=\"deposit-reward\"\r\n              amount={originalDeposit.lqtyReward.prettify()}\r\n              color={originalDeposit.lqtyReward.nonZero && \"success\"}\r\n              unit={GT}\r\n              infoIcon={\r\n                <InfoIcon\r\n                  tooltip={\r\n                    <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                      Although the LQTY rewards accrue every minute, the value on the UI only updates\r\n                      when a user transacts with the Stability Pool. Therefore you may receive more\r\n                      rewards than is displayed when you claim or adjust your deposit.\r\n                    </Card>\r\n                  }\r\n                />\r\n              }\r\n            />\r\n          </>\r\n        )}\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState, StabilityDepositChange } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype StabilityDepositActionProps = {\r\n  transactionId: string;\r\n  change: StabilityDepositChange<Decimal>;\r\n};\r\n\r\nconst selectFrontendRegistered = ({ frontend }: LiquityStoreState) =>\r\n  frontend.status === \"registered\";\r\n\r\nexport const StabilityDepositAction: React.FC<StabilityDepositActionProps> = ({\r\n  children,\r\n  transactionId,\r\n  change\r\n}) => {\r\n  const { config, liquity } = useLiquity();\r\n  const frontendRegistered = useLiquitySelector(selectFrontendRegistered);\r\n\r\n  const frontendTag = frontendRegistered ? config.frontendTag : undefined;\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    transactionId,\r\n    change.depositLUSD\r\n      ? liquity.send.depositLUSDInStabilityPool.bind(liquity.send, change.depositLUSD, frontendTag)\r\n      : liquity.send.withdrawLUSDFromStabilityPool.bind(liquity.send, change.withdrawLUSD)\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type { StabilityView, StabilityEvent } from \"./types\";\r\n\r\ntype StabilityViewContextType = {\r\n  view: StabilityView;\r\n  dispatchEvent: (event: StabilityEvent) => void;\r\n};\r\n\r\nexport const StabilityViewContext = createContext<StabilityViewContextType | null>(null);\r\n\r\nexport const useStabilityView = (): StabilityViewContextType => {\r\n  const context: StabilityViewContextType | null = useContext(StabilityViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <StabilityViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import React from \"react\";\r\n\r\nimport { Decimal, StabilityDeposit, StabilityDepositChange } from \"@liquity/lib-base\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\nimport { ActionDescription, Amount } from \"../ActionDescription\";\r\n\r\ntype StabilityActionDescriptionProps = {\r\n  originalDeposit: StabilityDeposit;\r\n  change: StabilityDepositChange<Decimal>;\r\n};\r\n\r\nexport const StabilityActionDescription: React.FC<StabilityActionDescriptionProps> = ({\r\n  originalDeposit,\r\n  change\r\n}) => {\r\n  const collateralGain = originalDeposit.collateralGain.nonZero?.prettify(4).concat(\" ETH\");\r\n  const lqtyReward = originalDeposit.lqtyReward.nonZero?.prettify().concat(\" \", GT);\r\n\r\n  return (\r\n    <ActionDescription>\r\n      {change.depositLUSD ? (\r\n        <>\r\n          You are depositing{\" \"}\r\n          <Amount>\r\n            {change.depositLUSD.prettify()} {COIN}\r\n          </Amount>{\" \"}\r\n          in the Stability Pool\r\n        </>\r\n      ) : (\r\n        <>\r\n          You are withdrawing{\" \"}\r\n          <Amount>\r\n            {change.withdrawLUSD.prettify()} {COIN}\r\n          </Amount>{\" \"}\r\n          to your wallet\r\n        </>\r\n      )}\r\n      {(collateralGain || lqtyReward) && (\r\n        <>\r\n          {\" \"}\r\n          and claiming at least{\" \"}\r\n          {collateralGain && lqtyReward ? (\r\n            <>\r\n              <Amount>{collateralGain}</Amount> and <Amount>{lqtyReward}</Amount>\r\n            </>\r\n          ) : (\r\n            <Amount>{collateralGain ?? lqtyReward}</Amount>\r\n          )}\r\n        </>\r\n      )}\r\n      .\r\n    </ActionDescription>\r\n  );\r\n};\r\n","import {\r\n  Decimal,\r\n  LiquityStoreState,\r\n  StabilityDeposit,\r\n  StabilityDepositChange\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { COIN } from \"../../../strings\";\r\nimport { Amount } from \"../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../ErrorDescription\";\r\nimport { StabilityActionDescription } from \"../StabilityActionDescription\";\r\n\r\nexport const selectForStabilityDepositChangeValidation = ({\r\n  trove,\r\n  lusdBalance,\r\n  ownFrontend,\r\n  haveUndercollateralizedTroves\r\n}: LiquityStoreState) => ({\r\n  trove,\r\n  lusdBalance,\r\n  haveOwnFrontend: ownFrontend.status === \"registered\",\r\n  haveUndercollateralizedTroves\r\n});\r\n\r\ntype StabilityDepositChangeValidationContext = ReturnType<\r\n  typeof selectForStabilityDepositChangeValidation\r\n>;\r\n\r\nexport const validateStabilityDepositChange = (\r\n  originalDeposit: StabilityDeposit,\r\n  editedLUSD: Decimal,\r\n  {\r\n    lusdBalance,\r\n    haveOwnFrontend,\r\n    haveUndercollateralizedTroves\r\n  }: StabilityDepositChangeValidationContext\r\n): [\r\n  validChange: StabilityDepositChange<Decimal> | undefined,\r\n  description: JSX.Element | undefined\r\n] => {\r\n  const change = originalDeposit.whatChanged(editedLUSD);\r\n\r\n  if (haveOwnFrontend) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        You cant deposit using a wallet address that is registered as a frontend.\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  if (!change) {\r\n    return [undefined, undefined];\r\n  }\r\n\r\n  if (change.depositLUSD?.gt(lusdBalance)) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>\r\n          {change.depositLUSD.sub(lusdBalance).prettify()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  if (change.withdrawLUSD && haveUndercollateralizedTroves) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        You're not allowed to withdraw LUSD from your Stability Deposit when there are\r\n        undercollateralized Troves. Please liquidate those Troves or try again later.\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  return [change, <StabilityActionDescription originalDeposit={originalDeposit} change={change} />];\r\n};\r\n","import React, { useCallback, useEffect } from \"react\";\r\nimport { Button, Flex } from \"theme-ui\";\r\n\r\nimport { Decimal, Decimalish, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN } from \"../../strings\";\r\n\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\n\r\nimport { StabilityDepositEditor } from \"./StabilityDepositEditor\";\r\nimport { StabilityDepositAction } from \"./StabilityDepositAction\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport {\r\n  selectForStabilityDepositChangeValidation,\r\n  validateStabilityDepositChange\r\n} from \"./validation/validateStabilityDepositChange\";\r\n\r\nconst init = ({ stabilityDeposit }: LiquityStoreState) => ({\r\n  originalDeposit: stabilityDeposit,\r\n  editedLUSD: stabilityDeposit.currentLUSD,\r\n  changePending: false\r\n});\r\n\r\ntype StabilityDepositManagerState = ReturnType<typeof init>;\r\ntype StabilityDepositManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"startChange\" | \"finishChange\" | \"revert\" }\r\n  | { type: \"setDeposit\"; newValue: Decimalish };\r\n\r\nconst reduceWith = (action: StabilityDepositManagerAction) => (\r\n  state: StabilityDepositManagerState\r\n): StabilityDepositManagerState => reduce(state, action);\r\n\r\nconst finishChange = reduceWith({ type: \"finishChange\" });\r\nconst revert = reduceWith({ type: \"revert\" });\r\n\r\nconst reduce = (\r\n  state: StabilityDepositManagerState,\r\n  action: StabilityDepositManagerAction\r\n): StabilityDepositManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { originalDeposit, editedLUSD, changePending } = state;\r\n\r\n  switch (action.type) {\r\n    case \"startChange\": {\r\n      console.log(\"changeStarted\");\r\n      return { ...state, changePending: true };\r\n    }\r\n\r\n    case \"finishChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"setDeposit\":\r\n      return { ...state, editedLUSD: Decimal.from(action.newValue) };\r\n\r\n    case \"revert\":\r\n      return { ...state, editedLUSD: originalDeposit.currentLUSD };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        stateChange: { stabilityDeposit: updatedDeposit }\r\n      } = action;\r\n\r\n      if (!updatedDeposit) {\r\n        return state;\r\n      }\r\n\r\n      const newState = { ...state, originalDeposit: updatedDeposit };\r\n\r\n      const changeCommitted =\r\n        !updatedDeposit.initialLUSD.eq(originalDeposit.initialLUSD) ||\r\n        updatedDeposit.currentLUSD.gt(originalDeposit.currentLUSD) ||\r\n        updatedDeposit.collateralGain.lt(originalDeposit.collateralGain) ||\r\n        updatedDeposit.lqtyReward.lt(originalDeposit.lqtyReward);\r\n\r\n      if (changePending && changeCommitted) {\r\n        return finishChange(revert(newState));\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        editedLUSD: updatedDeposit.apply(originalDeposit.whatChanged(editedLUSD))\r\n      };\r\n    }\r\n  }\r\n};\r\n\r\nconst transactionId = \"stability-deposit\";\r\n\r\nexport const StabilityDepositManager: React.FC = () => {\r\n  const [{ originalDeposit, editedLUSD, changePending }, dispatch] = useLiquityReducer(reduce, init);\r\n  const validationContext = useLiquitySelector(selectForStabilityDepositChangeValidation);\r\n  const { dispatchEvent } = useStabilityView();\r\n\r\n  const handleCancel = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const [validChange, description] = validateStabilityDepositChange(\r\n    originalDeposit,\r\n    editedLUSD,\r\n    validationContext\r\n  );\r\n\r\n  const makingNewDeposit = originalDeposit.isEmpty;\r\n\r\n  const myTransactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      myTransactionState.type === \"waitingForApproval\" ||\r\n      myTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (myTransactionState.type === \"failed\" || myTransactionState.type === \"cancelled\") {\r\n      dispatch({ type: \"finishChange\" });\r\n    } else if (myTransactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"DEPOSIT_CONFIRMED\");\r\n    }\r\n  }, [myTransactionState.type, dispatch, dispatchEvent]);\r\n\r\n  return (\r\n    <StabilityDepositEditor\r\n      originalDeposit={originalDeposit}\r\n      editedLUSD={editedLUSD}\r\n      changePending={changePending}\r\n      dispatch={dispatch}\r\n    >\r\n      {description ??\r\n        (makingNewDeposit ? (\r\n          <ActionDescription>Enter the amount of {COIN} you'd like to deposit.</ActionDescription>\r\n        ) : (\r\n          <ActionDescription>Adjust the {COIN} amount to deposit or withdraw.</ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleCancel}>\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <StabilityDepositAction transactionId={transactionId} change={validChange}>\r\n            Confirm\r\n          </StabilityDepositAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </StabilityDepositEditor>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../../Transaction\";\r\n\r\ntype ClaimAndMoveProps = {\r\n  disabled?: boolean;\r\n};\r\n\r\nexport const ClaimAndMove: React.FC<ClaimAndMoveProps> = ({ disabled, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stability-deposit\",\r\n    liquity.send.transferCollateralGainToTrove.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button\r\n      variant=\"outline\"\r\n      sx={{ mt: 3, width: \"100%\" }}\r\n      onClick={sendTransaction}\r\n      disabled={disabled}\r\n    >\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Button } from \"theme-ui\";\r\n\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../../Transaction\";\r\n\r\ntype ClaimRewardsProps = {\r\n  disabled?: boolean;\r\n};\r\n\r\nexport const ClaimRewards: React.FC<ClaimRewardsProps> = ({ disabled, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stability-deposit\",\r\n    liquity.send.withdrawGainsFromStabilityPool.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button onClick={sendTransaction} disabled={disabled}>\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nconst selector = ({ remainingStabilityPoolLQTYReward }: LiquityStoreState) => ({\r\n  remainingStabilityPoolLQTYReward\r\n});\r\n\r\nexport const RemainingLQTY: React.FC = () => {\r\n  const { remainingStabilityPoolLQTYReward } = useLiquitySelector(selector);\r\n\r\n  return (\r\n    <Flex sx={{ mr: 2, fontSize: 2, fontWeight: \"medium\" }}>\r\n      {remainingStabilityPoolLQTYReward.prettify(0)} LQTY remaining\r\n    </Flex>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\n\r\nexport const Badge: React.FC = ({ children }) => {\r\n  return <Flex variant=\"layout.badge\">{children}</Flex>;\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\n\r\ntype CoinGeckoSimplePriceResponse<T extends string, U extends string> = {\r\n  [P in T]: {\r\n    [Q in U]: number;\r\n  };\r\n};\r\n\r\nconst hasProp = <T, P extends string>(o: T, p: P): o is T & { [_ in P]: unknown } => p in o;\r\n\r\nconst validateCoinGeckoSimplePriceResponse = <T extends string, U extends string>(\r\n  expectedCoinIds: readonly T[],\r\n  expectedCurrencies: readonly U[],\r\n  body: unknown\r\n): CoinGeckoSimplePriceResponse<T, U> => {\r\n  if (typeof body !== \"object\" || body === null) {\r\n    throw new Error(`unexpected response from CoinGecko`);\r\n  }\r\n\r\n  for (const coinId of expectedCoinIds) {\r\n    if (!hasProp(body, coinId)) {\r\n      throw new Error(`coin \"${coinId}\" missing from CoinGecko response`);\r\n    }\r\n\r\n    const coinPrices = body[coinId];\r\n\r\n    for (const currency of expectedCurrencies) {\r\n      if (!hasProp(coinPrices, currency)) {\r\n        throw new Error(`currency \"${currency}\" missing from CoinGecko response`);\r\n      }\r\n\r\n      if (typeof coinPrices[currency] !== \"number\") {\r\n        throw new Error(`price of coin \"${coinId}\" in currency \"${currency}\" is not a number`);\r\n      }\r\n    }\r\n  }\r\n\r\n  return body as CoinGeckoSimplePriceResponse<T, U>;\r\n};\r\n\r\nconst fetchCoinGeckoSimplePrice = async <T extends string, U extends string>(\r\n  coinIds: readonly T[],\r\n  vsCurrencies: readonly U[]\r\n): Promise<CoinGeckoSimplePriceResponse<T, U>> => {\r\n  const simplePriceUrl =\r\n    \"https://api.coingecko.com/api/v3/simple/price?\" +\r\n    new URLSearchParams({\r\n      ids: coinIds.join(\",\"),\r\n      vs_currencies: vsCurrencies.join(\",\")\r\n    });\r\n\r\n  const response = await window.fetch(simplePriceUrl, {\r\n    headers: {\r\n      accept: \"application/json\"\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`couldn't fetch price from CoinGecko: got status ${response.status}`);\r\n  }\r\n\r\n  return validateCoinGeckoSimplePriceResponse(coinIds, vsCurrencies, await response.json());\r\n};\r\n\r\nexport interface LqtyPriceResponse {\r\n  lqtyPriceUSD: Decimal;\r\n}\r\n\r\nexport const fetchLqtyPrice = async (): Promise<LqtyPriceResponse> => {\r\n  const response = await fetchCoinGeckoSimplePrice([\"liquity\"] as const, [\"usd\"] as const);\r\n\r\n  return {\r\n    lqtyPriceUSD: Decimal.from(response.liquity.usd)\r\n  };\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Card, Paragraph, Text } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { Badge } from \"../Badge\";\r\nimport { fetchLqtyPrice } from \"./context/fetchLqtyPrice\";\r\n\r\nconst selector = ({ lusdInStabilityPool, remainingStabilityPoolLQTYReward }: LiquityStoreState) => ({\r\n  lusdInStabilityPool,\r\n  remainingStabilityPoolLQTYReward\r\n});\r\n\r\nconst yearlyIssuanceFraction = 0.5;\r\nconst dailyIssuanceFraction = Decimal.from(1 - yearlyIssuanceFraction ** (1 / 365));\r\nconst dailyIssuancePercentage = dailyIssuanceFraction.mul(100);\r\n\r\nexport const Yield: React.FC = () => {\r\n  const { lusdInStabilityPool, remainingStabilityPoolLQTYReward } = useLiquitySelector(selector);\r\n\r\n  const [lqtyPrice, setLqtyPrice] = useState<Decimal | undefined>(undefined);\r\n  const hasZeroValue = remainingStabilityPoolLQTYReward.isZero || lusdInStabilityPool.isZero;\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { lqtyPriceUSD } = await fetchLqtyPrice();\r\n        setLqtyPrice(lqtyPriceUSD);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  if (hasZeroValue || lqtyPrice === undefined) return null;\r\n\r\n  const lqtyIssuanceOneDay = remainingStabilityPoolLQTYReward.mul(dailyIssuanceFraction);\r\n  const lqtyIssuanceOneDayInUSD = lqtyIssuanceOneDay.mul(lqtyPrice);\r\n  const aprPercentage = lqtyIssuanceOneDayInUSD.mulDiv(365 * 100, lusdInStabilityPool);\r\n  const remainingLqtyInUSD = remainingStabilityPoolLQTYReward.mul(lqtyPrice);\r\n\r\n  if (aprPercentage.isZero) return null;\r\n\r\n  return (\r\n    <Badge>\r\n      <Text>LQTY APR {aprPercentage.toString(2)}%</Text>\r\n      <InfoIcon\r\n        tooltip={\r\n          <Card variant=\"tooltip\" sx={{ width: [\"220px\", \"518px\"] }}>\r\n            <Paragraph>\r\n              An <Text sx={{ fontWeight: \"bold\" }}>estimate</Text> of the LQTY return on the LUSD\r\n              deposited to the Stability Pool over the next year, not including your ETH gains from\r\n              liquidations.\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\", mt: 2 }}>\r\n              ($LQTY_REWARDS * DAILY_ISSUANCE% / DEPOSITED_LUSD) * 365 * 100 ={\" \"}\r\n              <Text sx={{ fontWeight: \"bold\" }}> APR</Text>\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\" }}>\r\n              ($\r\n              {remainingLqtyInUSD.shorten()} * {dailyIssuancePercentage.toString(4)}% / $\r\n              {lusdInStabilityPool.shorten()}) * 365 * 100 =\r\n              <Text sx={{ fontWeight: \"bold\" }}> {aprPercentage.toString(2)}%</Text>\r\n            </Paragraph>\r\n          </Card>\r\n        }\r\n      ></InfoIcon>\r\n    </Badge>\r\n  );\r\n};\r\n","import React, { useCallback, useEffect } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { DisabledEditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { ClaimAndMove } from \"./actions/ClaimAndMove\";\r\nimport { ClaimRewards } from \"./actions/ClaimRewards\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport { RemainingLQTY } from \"./RemainingLQTY\";\r\nimport { Yield } from \"./Yield\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\nconst selector = ({ stabilityDeposit, trove, lusdInStabilityPool }: LiquityStoreState) => ({\r\n  stabilityDeposit,\r\n  trove,\r\n  lusdInStabilityPool\r\n});\r\n\r\nexport const ActiveDeposit: React.FC = () => {\r\n  const { dispatchEvent } = useStabilityView();\r\n  const { stabilityDeposit, trove, lusdInStabilityPool } = useLiquitySelector(selector);\r\n\r\n  const poolShare = stabilityDeposit.currentLUSD.mulDiv(100, lusdInStabilityPool);\r\n\r\n  const handleAdjustDeposit = useCallback(() => {\r\n    dispatchEvent(\"ADJUST_DEPOSIT_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const hasReward = !stabilityDeposit.lqtyReward.isZero;\r\n  const hasGain = !stabilityDeposit.collateralGain.isZero;\r\n  const hasTrove = !trove.isEmpty;\r\n\r\n  const transactionId = \"stability-deposit\";\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const isWaitingForTransaction =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"REWARDS_CLAIMED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        {!isWaitingForTransaction && (\r\n          <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n            <RemainingLQTY />\r\n          </Flex>\r\n        )}\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Box>\r\n          <DisabledEditableRow\r\n            label=\"Deposit\"\r\n            inputId=\"deposit-lusd\"\r\n            amount={stabilityDeposit.currentLUSD.prettify()}\r\n            unit={COIN}\r\n          />\r\n\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"deposit-share\"\r\n            amount={poolShare.prettify(4)}\r\n            unit=\"%\"\r\n          />\r\n\r\n          <StaticRow\r\n            label=\"Liquidation gain\"\r\n            inputId=\"deposit-gain\"\r\n            amount={stabilityDeposit.collateralGain.prettify(4)}\r\n            color={stabilityDeposit.collateralGain.nonZero && \"success\"}\r\n            unit=\"ETH\"\r\n          />\r\n\r\n          <Flex sx={{ alignItems: \"center\" }}>\r\n            <StaticRow\r\n              label=\"Reward\"\r\n              inputId=\"deposit-reward\"\r\n              amount={stabilityDeposit.lqtyReward.prettify()}\r\n              color={stabilityDeposit.lqtyReward.nonZero && \"success\"}\r\n              unit={GT}\r\n              infoIcon={\r\n                <InfoIcon\r\n                  tooltip={\r\n                    <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                      Although the LQTY rewards accrue every minute, the value on the UI only updates\r\n                      when a user transacts with the Stability Pool. Therefore you may receive more\r\n                      rewards than is displayed when you claim or adjust your deposit.\r\n                    </Card>\r\n                  }\r\n                />\r\n              }\r\n            />\r\n            <Flex sx={{ justifyContent: \"flex-end\", flex: 1 }}>\r\n              <Yield />\r\n            </Flex>\r\n          </Flex>\r\n        </Box>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={handleAdjustDeposit}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n\r\n          <ClaimRewards disabled={!hasGain && !hasReward}>Claim ETH and LQTY</ClaimRewards>\r\n        </Flex>\r\n\r\n        {hasTrove && (\r\n          <ClaimAndMove disabled={!hasGain}>Claim LQTY and move ETH to Trove</ClaimAndMove>\r\n        )}\r\n      </Box>\r\n\r\n      {isWaitingForTransaction && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport { RemainingLQTY } from \"./RemainingLQTY\";\r\nimport { Yield } from \"./Yield\";\r\n\r\nexport const NoDeposit: React.FC = props => {\r\n  const { dispatchEvent } = useStabilityView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"DEPOSIT_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n          <RemainingLQTY />\r\n        </Flex>\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"You have no LUSD in the Stability Pool.\">\r\n          You can earn ETH and LQTY rewards by depositing LUSD.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Flex sx={{ justifyContent: \"flex-start\", flex: 1, alignItems: \"center\" }}>\r\n            <Yield />\r\n          </Flex>\r\n          <Button onClick={handleOpenTrove}>Deposit</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { StabilityDepositManager } from \"./StabilityDepositManager\";\r\nimport { ActiveDeposit } from \"./ActiveDeposit\";\r\nimport { NoDeposit } from \"./NoDeposit\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\n\r\nexport const Stability: React.FC = props => {\r\n  const { view } = useStabilityView();\r\n\r\n  switch (view) {\r\n    case \"NONE\": {\r\n      return <NoDeposit {...props} />;\r\n    }\r\n    case \"DEPOSITING\": {\r\n      return <StabilityDepositManager {...props} />;\r\n    }\r\n    case \"ADJUSTING\": {\r\n      return <StabilityDepositManager {...props} />;\r\n    }\r\n    case \"ACTIVE\": {\r\n      return <ActiveDeposit {...props} />;\r\n    }\r\n  }\r\n};\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { Card, Box, Heading, Flex, Button, Label, Input } from \"theme-ui\";\r\n\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { Transaction } from \"./Transaction\";\r\n\r\nconst selectPrice = ({ price }: LiquityStoreState) => price;\r\n\r\nexport const PriceManager: React.FC = () => {\r\n  const {\r\n    liquity: {\r\n      send: liquity,\r\n      connection: { _priceFeedIsTestnet: canSetPrice }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const price = useLiquitySelector(selectPrice);\r\n  const [editedPrice, setEditedPrice] = useState(price.toString(2));\r\n\r\n  useEffect(() => {\r\n    setEditedPrice(price.toString(2));\r\n  }, [price]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Price feed</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Flex sx={{ alignItems: \"stretch\" }}>\r\n          <Label>ETH</Label>\r\n\r\n          <Label variant=\"unit\">$</Label>\r\n\r\n          <Input\r\n            type={canSetPrice ? \"number\" : \"text\"}\r\n            step=\"any\"\r\n            value={editedPrice}\r\n            onChange={e => setEditedPrice(e.target.value)}\r\n            disabled={!canSetPrice}\r\n          />\r\n\r\n          {canSetPrice && (\r\n            <Flex sx={{ ml: 2, alignItems: \"center\" }}>\r\n              <Transaction\r\n                id=\"set-price\"\r\n                tooltip=\"Set\"\r\n                tooltipPlacement=\"bottom\"\r\n                send={overrides => {\r\n                  if (!editedPrice) {\r\n                    throw new Error(\"Invalid price\");\r\n                  }\r\n                  return liquity.setPrice(Decimal.from(editedPrice), overrides);\r\n                }}\r\n              >\r\n                <Button variant=\"icon\">\r\n                  <Icon name=\"chart-line\" size=\"lg\" />\r\n                </Button>\r\n              </Transaction>\r\n            </Flex>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { createContext, useContext } from \"react\";\r\n\r\nexport type StakingView = \"ACTIVE\" | \"ADJUSTING\" | \"NONE\";\r\n\r\nexport type StakingViewAction = { type: \"startAdjusting\" | \"cancelAdjusting\" };\r\n\r\nexport type StakingViewContextType = {\r\n  view: StakingView;\r\n\r\n  // Indicates that a staking TX is pending.\r\n  // The panel should be covered with a spinner overlay when this is true.\r\n  changePending: boolean;\r\n\r\n  // Dispatch an action that changes the Staking panel's view.\r\n  dispatch: (action: StakingViewAction) => void;\r\n};\r\n\r\nexport const StakingViewContext = createContext<StakingViewContextType | null>(null);\r\n\r\nexport const useStakingView = (): StakingViewContextType => {\r\n  const context = useContext(StakingViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <TroveViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\nconst selectLQTYStake = ({ lqtyStake }: LiquityStoreState) => lqtyStake;\r\n\r\nexport const StakingGainsAction: React.FC = () => {\r\n  const { liquity } = useLiquity();\r\n  const { collateralGain, lusdGain } = useLiquitySelector(selectLQTYStake);\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stake\",\r\n    liquity.send.withdrawGainsFromStaking.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button onClick={sendTransaction} disabled={collateralGain.isZero && lusdGain.isZero}>\r\n      Claim gains\r\n    </Button>\r\n  );\r\n};\r\n","import { Heading, Box, Card, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { DisabledEditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { Icon } from \"../Icon\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\nimport { StakingGainsAction } from \"./StakingGainsAction\";\r\n\r\nconst select = ({ lqtyStake, totalStakedLQTY }: LiquityStoreState) => ({\r\n  lqtyStake,\r\n  totalStakedLQTY\r\n});\r\n\r\nexport const ReadOnlyStake: React.FC = () => {\r\n  const { changePending, dispatch } = useStakingView();\r\n  const { lqtyStake, totalStakedLQTY } = useLiquitySelector(select);\r\n\r\n  const poolShare = lqtyStake.stakedLQTY.mulDiv(100, totalStakedLQTY);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Staking</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <DisabledEditableRow\r\n          label=\"Stake\"\r\n          inputId=\"stake-lqty\"\r\n          amount={lqtyStake.stakedLQTY.prettify()}\r\n          unit={GT}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Pool share\"\r\n          inputId=\"stake-share\"\r\n          amount={poolShare.prettify(4)}\r\n          unit=\"%\"\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Redemption gain\"\r\n          inputId=\"stake-gain-eth\"\r\n          amount={lqtyStake.collateralGain.prettify(4)}\r\n          color={lqtyStake.collateralGain.nonZero && \"success\"}\r\n          unit=\"ETH\"\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Issuance gain\"\r\n          inputId=\"stake-gain-lusd\"\r\n          amount={lqtyStake.lusdGain.prettify()}\r\n          color={lqtyStake.lusdGain.nonZero && \"success\"}\r\n          unit={COIN}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={() => dispatch({ type: \"startAdjusting\" })}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n\r\n          <StakingGainsAction />\r\n        </Flex>\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Heading, Box, Card, Button } from \"theme-ui\";\r\n\r\nimport { Decimal, Decimalish, Difference, LiquityStoreState, LQTYStake } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { Icon } from \"../Icon\";\r\nimport { EditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\n\r\nconst select = ({ lqtyBalance, totalStakedLQTY }: LiquityStoreState) => ({\r\n  lqtyBalance,\r\n  totalStakedLQTY\r\n});\r\n\r\ntype StakingEditorProps = {\r\n  title: string;\r\n  originalStake: LQTYStake;\r\n  editedLQTY: Decimal;\r\n  dispatch: (action: { type: \"setStake\"; newValue: Decimalish } | { type: \"revert\" }) => void;\r\n};\r\n\r\nexport const StakingEditor: React.FC<StakingEditorProps> = ({\r\n  children,\r\n  title,\r\n  originalStake,\r\n  editedLQTY,\r\n  dispatch\r\n}) => {\r\n  const { lqtyBalance, totalStakedLQTY } = useLiquitySelector(select);\r\n  const { changePending } = useStakingView();\r\n  const editingState = useState<string>();\r\n\r\n  const edited = !editedLQTY.eq(originalStake.stakedLQTY);\r\n\r\n  const maxAmount = originalStake.stakedLQTY.add(lqtyBalance);\r\n  const maxedOut = editedLQTY.eq(maxAmount);\r\n\r\n  const totalStakedLQTYAfterChange = totalStakedLQTY.sub(originalStake.stakedLQTY).add(editedLQTY);\r\n\r\n  const originalPoolShare = originalStake.stakedLQTY.mulDiv(100, totalStakedLQTY);\r\n  const newPoolShare = editedLQTY.mulDiv(100, totalStakedLQTYAfterChange);\r\n  const poolShareChange =\r\n    originalStake.stakedLQTY.nonZero && Difference.between(newPoolShare, originalPoolShare).nonZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        {title}\r\n        {edited && !changePending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => dispatch({ type: \"revert\" })}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Stake\"\r\n          inputId=\"stake-lqty\"\r\n          amount={editedLQTY.prettify()}\r\n          maxAmount={maxAmount.toString()}\r\n          maxedOut={maxedOut}\r\n          unit={GT}\r\n          {...{ editingState }}\r\n          editedAmount={editedLQTY.toString(2)}\r\n          setEditedAmount={newValue => dispatch({ type: \"setStake\", newValue })}\r\n        />\r\n\r\n        {newPoolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"stake-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"stake-share\"\r\n            amount={newPoolShare.prettify(4)}\r\n            pendingAmount={poolShareChange?.prettify(4).concat(\"%\")}\r\n            pendingColor={poolShareChange?.positive ? \"success\" : \"danger\"}\r\n            unit=\"%\"\r\n          />\r\n        )}\r\n\r\n        {!originalStake.isEmpty && (\r\n          <>\r\n            <StaticRow\r\n              label=\"Redemption gain\"\r\n              inputId=\"stake-gain-eth\"\r\n              amount={originalStake.collateralGain.prettify(4)}\r\n              color={originalStake.collateralGain.nonZero && \"success\"}\r\n              unit=\"ETH\"\r\n            />\r\n\r\n            <StaticRow\r\n              label=\"Issuance gain\"\r\n              inputId=\"stake-gain-lusd\"\r\n              amount={originalStake.lusdGain.prettify()}\r\n              color={originalStake.lusdGain.nonZero && \"success\"}\r\n              unit={COIN}\r\n            />\r\n          </>\r\n        )}\r\n\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { Decimal, LQTYStakeChange } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype StakingActionProps = {\r\n  change: LQTYStakeChange<Decimal>;\r\n};\r\n\r\nexport const StakingManagerAction: React.FC<StakingActionProps> = ({ change, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stake\",\r\n    change.stakeLQTY\r\n      ? liquity.send.stakeLQTY.bind(liquity.send, change.stakeLQTY)\r\n      : liquity.send.unstakeLQTY.bind(liquity.send, change.unstakeLQTY)\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import React from \"react\";\r\nimport { Button, Flex } from \"theme-ui\";\r\n\r\nimport {\r\n  Decimal,\r\n  Decimalish,\r\n  LiquityStoreState,\r\n  LQTYStake,\r\n  LQTYStakeChange\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { GT, COIN } from \"../../strings\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\nimport { StakingEditor } from \"./StakingEditor\";\r\nimport { StakingManagerAction } from \"./StakingManagerAction\";\r\nimport { ActionDescription, Amount } from \"../ActionDescription\";\r\nimport { ErrorDescription } from \"../ErrorDescription\";\r\n\r\nconst init = ({ lqtyStake }: LiquityStoreState) => ({\r\n  originalStake: lqtyStake,\r\n  editedLQTY: lqtyStake.stakedLQTY\r\n});\r\n\r\ntype StakeManagerState = ReturnType<typeof init>;\r\ntype StakeManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"revert\" }\r\n  | { type: \"setStake\"; newValue: Decimalish };\r\n\r\nconst reduce = (state: StakeManagerState, action: StakeManagerAction): StakeManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { originalStake, editedLQTY } = state;\r\n\r\n  switch (action.type) {\r\n    case \"setStake\":\r\n      return { ...state, editedLQTY: Decimal.from(action.newValue) };\r\n\r\n    case \"revert\":\r\n      return { ...state, editedLQTY: originalStake.stakedLQTY };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        stateChange: { lqtyStake: updatedStake }\r\n      } = action;\r\n\r\n      if (updatedStake) {\r\n        return {\r\n          originalStake: updatedStake,\r\n          editedLQTY: updatedStake.apply(originalStake.whatChanged(editedLQTY))\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nconst selectLQTYBalance = ({ lqtyBalance }: LiquityStoreState) => lqtyBalance;\r\n\r\ntype StakingManagerActionDescriptionProps = {\r\n  originalStake: LQTYStake;\r\n  change: LQTYStakeChange<Decimal>;\r\n};\r\n\r\nconst StakingManagerActionDescription: React.FC<StakingManagerActionDescriptionProps> = ({\r\n  originalStake,\r\n  change\r\n}) => {\r\n  const stakeLQTY = change.stakeLQTY?.prettify().concat(\" \", GT);\r\n  const unstakeLQTY = change.unstakeLQTY?.prettify().concat(\" \", GT);\r\n  const collateralGain = originalStake.collateralGain.nonZero?.prettify(4).concat(\" ETH\");\r\n  const lusdGain = originalStake.lusdGain.nonZero?.prettify().concat(\" \", COIN);\r\n\r\n  if (originalStake.isEmpty && stakeLQTY) {\r\n    return (\r\n      <ActionDescription>\r\n        You are staking <Amount>{stakeLQTY}</Amount>.\r\n      </ActionDescription>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ActionDescription>\r\n      {stakeLQTY && (\r\n        <>\r\n          You are adding <Amount>{stakeLQTY}</Amount> to your stake\r\n        </>\r\n      )}\r\n      {unstakeLQTY && (\r\n        <>\r\n          You are withdrawing <Amount>{unstakeLQTY}</Amount> to your wallet\r\n        </>\r\n      )}\r\n      {(collateralGain || lusdGain) && (\r\n        <>\r\n          {\" \"}\r\n          and claiming{\" \"}\r\n          {collateralGain && lusdGain ? (\r\n            <>\r\n              <Amount>{collateralGain}</Amount> and <Amount>{lusdGain}</Amount>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Amount>{collateralGain ?? lusdGain}</Amount>\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n      .\r\n    </ActionDescription>\r\n  );\r\n};\r\n\r\nexport const StakingManager: React.FC = () => {\r\n  const { dispatch: dispatchStakingViewAction } = useStakingView();\r\n  const [{ originalStake, editedLQTY }, dispatch] = useLiquityReducer(reduce, init);\r\n  const lqtyBalance = useLiquitySelector(selectLQTYBalance);\r\n\r\n  const change = originalStake.whatChanged(editedLQTY);\r\n  const [validChange, description] = !change\r\n    ? [undefined, undefined]\r\n    : change.stakeLQTY?.gt(lqtyBalance)\r\n    ? [\r\n        undefined,\r\n        <ErrorDescription>\r\n          The amount you're trying to stake exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {change.stakeLQTY.sub(lqtyBalance).prettify()} {GT}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      ]\r\n    : [change, <StakingManagerActionDescription originalStake={originalStake} change={change} />];\r\n\r\n  const makingNewStake = originalStake.isEmpty;\r\n\r\n  return (\r\n    <StakingEditor title={\"Staking\"} {...{ originalStake, editedLQTY, dispatch }}>\r\n      {description ??\r\n        (makingNewStake ? (\r\n          <ActionDescription>Enter the amount of {GT} you'd like to stake.</ActionDescription>\r\n        ) : (\r\n          <ActionDescription>Adjust the {GT} amount to stake or withdraw.</ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button\r\n          variant=\"cancel\"\r\n          onClick={() => dispatchStakingViewAction({ type: \"cancelAdjusting\" })}\r\n        >\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <StakingManagerAction change={validChange}>Confirm</StakingManagerAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </StakingEditor>\r\n  );\r\n};\r\n","import { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\n\r\nimport { GT } from \"../../strings\";\r\n\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\n\r\nexport const NoStake: React.FC = () => {\r\n  const { dispatch } = useStakingView();\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Staking</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title={`You haven't staked ${GT} yet.`}>\r\n          Stake {GT} to earn a share of borrowing and redemption fees.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button onClick={() => dispatch({ type: \"startAdjusting\" })}>Start staking</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { useStakingView } from \"./context/StakingViewContext\";\r\nimport { ReadOnlyStake } from \"./ReadOnlyStake\";\r\nimport { StakingManager } from \"./StakingManager\";\r\nimport { NoStake } from \"./NoStake\";\r\n\r\nexport const Staking: React.FC = () => {\r\n  const { view } = useStakingView();\r\n\r\n  switch (view) {\r\n    case \"ACTIVE\":\r\n      return <ReadOnlyStake />;\r\n\r\n    case \"ADJUSTING\":\r\n      return <StakingManager />;\r\n\r\n    case \"NONE\":\r\n      return <NoStake />;\r\n  }\r\n};\r\n","import { Container } from \"theme-ui\";\r\n\r\nimport { Trove } from \"../components/Trove/Trove\";\r\nimport { Stability } from \"../components/Stability/Stability\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { PriceManager } from \"../components/PriceManager\";\r\nimport { Staking } from \"../components/Staking/Staking\";\r\n\r\nexport const Dashboard: React.FC = () => (\r\n  <Container variant=\"columns\">\r\n    <Container variant=\"left\">\r\n      <Trove />\r\n      <Stability />\r\n      <Staking />\r\n    </Container>\r\n\r\n    <Container variant=\"right\">\r\n      <SystemStats />\r\n      <PriceManager />\r\n    </Container>\r\n  </Container>\r\n);\r\n","import { Box, Flex, Heading, Paragraph } from \"theme-ui\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { Icon } from \"../components/Icon\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nexport const UnregisteredFrontend: React.FC = () => {\r\n  const {\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        justifyContent: \"space-around\",\r\n\r\n        m: 3,\r\n        p: 3,\r\n        maxWidth: \"500px\",\r\n\r\n        border: 1,\r\n        borderRadius: \"8px\",\r\n        borderColor: \"warning\",\r\n        boxShadow: 2\r\n      }}\r\n    >\r\n      <Flex sx={{ alignItems: \"center\", mx: 3, mb: 2 }}>\r\n        <Icon name=\"exclamation-triangle\" size=\"2x\" />\r\n        <Heading sx={{ ml: 3, fontSize: \"18px\" }}>Frontend not yet registered</Heading>\r\n      </Flex>\r\n\r\n      <Paragraph sx={{ fontSize: 2 }}>\r\n        If you're the operator of this frontend, please select <b>{shortenAddress(frontendTag)}</b>{\" \"}\r\n        in your wallet to proceed with the registration.\r\n      </Paragraph>\r\n    </Box>\r\n  );\r\n};\r\n","import { useState } from \"react\";\r\nimport { Card, Heading, Box, Flex, Input, Label, Paragraph, Button, Spinner } from \"theme-ui\";\r\n\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../components/Transaction\";\r\nimport { Icon } from \"../components/Icon\";\r\n\r\ntype FrontendRegistrationActionProps = {\r\n  kickbackRate: Decimal;\r\n};\r\n\r\nconst FrontendRegistrationAction: React.FC<FrontendRegistrationActionProps> = ({ kickbackRate }) => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const myTransactionId = \"register-frontend\";\r\n  const myTransactionState = useMyTransactionState(myTransactionId);\r\n\r\n  return myTransactionState.type === \"waitingForApproval\" ? (\r\n    <Button disabled>\r\n      <Spinner sx={{ mr: 2, color: \"white\" }} size=\"20px\" />\r\n      Waiting for your approval\r\n    </Button>\r\n  ) : myTransactionState.type !== \"waitingForConfirmation\" &&\r\n    myTransactionState.type !== \"confirmed\" ? (\r\n    <Transaction id={myTransactionId} send={liquity.registerFrontend.bind(liquity, kickbackRate)}>\r\n      <Button>Register</Button>\r\n    </Transaction>\r\n  ) : null;\r\n};\r\n\r\nexport const FrontendRegistration: React.FC = () => {\r\n  const { account } = useLiquity();\r\n\r\n  const [kickbackRate, setKickbackRate] = useState(Decimal.from(0.8));\r\n  const [cut, setCut] = useState(Decimal.from(0.2));\r\n  const [kickbackRateString, setKickbackRateString] = useState(\"80\");\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <Heading>Choose a kickback rate</Heading>\r\n\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Flex>\r\n            <Label>Kickback rate</Label>\r\n            <Label variant=\"unit\">%</Label>\r\n\r\n            <Input\r\n              sx={{ maxWidth: \"200px\" }}\r\n              type=\"number\"\r\n              step=\"any\"\r\n              value={kickbackRateString}\r\n              onChange={e => {\r\n                setKickbackRateString(e.target.value);\r\n                try {\r\n                  const newKickbackRate = Decimal.from(e.target.value || 0).div(100);\r\n                  const newCut = Decimal.ONE.sub(newKickbackRate);\r\n\r\n                  setKickbackRate(newKickbackRate);\r\n                  setCut(newCut);\r\n                } catch {}\r\n              }}\r\n              onBlur={() => {\r\n                setKickbackRateString(kickbackRate.mul(100).toString());\r\n              }}\r\n            />\r\n          </Flex>\r\n        </Box>\r\n      </Card>\r\n\r\n      <Box\r\n        sx={{\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          justifyContent: \"space-around\",\r\n\r\n          m: 3,\r\n          mt: [3, null, 4],\r\n          mb: 4,\r\n          p: 3,\r\n          maxWidth: \"450px\",\r\n\r\n          border: 1,\r\n          borderRadius: \"8px\",\r\n          borderColor: \"danger\",\r\n          boxShadow: 2\r\n        }}\r\n      >\r\n        <Flex sx={{ alignItems: \"center\", mx: 3, fontSize: 4 }}>\r\n          <Icon name=\"hand-paper\" />\r\n          <Heading sx={{ ml: 3, fontSize: \"18px\" }}>Before you proceed</Heading>\r\n        </Flex>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3 }}>\r\n          You are about to register <b>{shortenAddress(account)}</b> to receive{\" \"}\r\n          <b>{cut.mul(100).toString()}%</b> of the LQTY rewards earned through this frontend.\r\n        </Paragraph>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3, fontWeight: \"bold\" }}>\r\n          You will not be able to change the kickback rate for this address later.\r\n        </Paragraph>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3 }}>\r\n          If you'd like to use a different kickback rate in the future, you will need to repeat this\r\n          registration with a different address.\r\n        </Paragraph>\r\n      </Box>\r\n\r\n      <FrontendRegistrationAction {...{ kickbackRate }} />\r\n    </>\r\n  );\r\n};\r\n","import { Box, Flex, Heading, Paragraph, Button } from \"theme-ui\";\r\n\r\nimport { Icon } from \"../components/Icon\";\r\n\r\ntype FrontendRegistrationSuccessProps = {\r\n  onDismiss: () => void;\r\n};\r\n\r\nexport const FrontendRegistrationSuccess: React.FC<FrontendRegistrationSuccessProps> = ({\r\n  onDismiss\r\n}) => (\r\n  <>\r\n    <Box\r\n      sx={{\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        justifyContent: \"space-around\",\r\n\r\n        m: 3,\r\n        mt: 4,\r\n        mb: 4,\r\n        p: 4,\r\n        maxWidth: \"500px\",\r\n\r\n        bg: \"rgba(40, 192, 129, 0.05)\",\r\n        color: \"success\",\r\n\r\n        border: 1,\r\n        borderRadius: \"8px\",\r\n        borderColor: \"success\",\r\n        boxShadow: 2\r\n      }}\r\n    >\r\n      <Flex sx={{ alignItems: \"center\", mx: 3, mb: 4, fontSize: 5 }}>\r\n        <Icon name=\"check\" />\r\n        <Heading sx={{ ml: 3, fontSize: 4 }}>Success!</Heading>\r\n      </Flex>\r\n\r\n      <Paragraph sx={{ fontSize: 2 }}>Your frontend is now ready to receive LQTY rewards.</Paragraph>\r\n    </Box>\r\n\r\n    <Button onClick={onDismiss}>Go to Dashboard</Button>\r\n  </>\r\n);\r\n","import { useEffect, useState } from \"react\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Dashboard } from \"./Dashboard\";\r\nimport { UnregisteredFrontend } from \"./UnregisteredFrontend\";\r\nimport { FrontendRegistration } from \"./FrontendRegistration\";\r\nimport { FrontendRegistrationSuccess } from \"./FrontendRegistrationSuccess\";\r\n\r\nconst selectFrontend = ({ frontend }: LiquityStoreState) => frontend;\r\n\r\nexport const PageSwitcher: React.FC = () => {\r\n  const {\r\n    account,\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n\r\n  const frontend = useLiquitySelector(selectFrontend);\r\n  const unregistered = frontendTag !== AddressZero && frontend.status === \"unregistered\";\r\n\r\n  const [registering, setRegistering] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (unregistered) {\r\n      setRegistering(true);\r\n    }\r\n  }, [unregistered]);\r\n\r\n  if (registering || unregistered) {\r\n    if (frontend.status === \"registered\") {\r\n      return <FrontendRegistrationSuccess onDismiss={() => setRegistering(false)} />;\r\n    } else if (account === frontendTag) {\r\n      return <FrontendRegistration />;\r\n    } else {\r\n      return <UnregisteredFrontend />;\r\n    }\r\n  } else {\r\n    return <Dashboard />;\r\n  }\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type { FarmView, FarmEvent } from \"./transitions\";\r\n\r\ntype FarmViewContextType = {\r\n  view: FarmView;\r\n  dispatchEvent: (event: FarmEvent) => void;\r\n};\r\n\r\nexport const FarmViewContext = createContext<FarmViewContextType | null>(null);\r\n\r\nexport const useFarmView = (): FarmViewContextType => {\r\n  const context: FarmViewContextType | null = useContext(FarmViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <FarmViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nconst selector = ({ remainingLiquidityMiningLQTYReward }: LiquityStoreState) => ({\r\n  remainingLiquidityMiningLQTYReward\r\n});\r\n\r\nexport const RemainingLQTY: React.FC = () => {\r\n  const { remainingLiquidityMiningLQTYReward } = useLiquitySelector(selector);\r\n\r\n  return (\r\n    <Flex sx={{ mr: 2, fontSize: 2, fontWeight: \"medium\" }}>\r\n      {remainingLiquidityMiningLQTYReward.prettify(0)} LQTY remaining\r\n    </Flex>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\n\r\ntype UniswapResponse = {\r\n  data?: {\r\n    bundle: {\r\n      ethPrice: string;\r\n    } | null;\r\n    token: {\r\n      derivedETH: string;\r\n    } | null;\r\n    pair: {\r\n      reserveUSD: string;\r\n      totalSupply: string;\r\n    } | null;\r\n  };\r\n  errors?: Array<{ message: string }>;\r\n};\r\n\r\nconst uniswapQuery = (lqtyTokenAddress: string, uniTokenAddress: string) => `{\r\n  token(id: \"${lqtyTokenAddress.toLowerCase()}\") {\r\n    derivedETH\r\n  },\r\n  bundle(id: 1) {\r\n    ethPrice\r\n  },\r\n  pair(id: \"${uniTokenAddress.toLowerCase()}\") {\r\n    totalSupply\r\n    reserveUSD\r\n  }\r\n}`;\r\n\r\nexport async function fetchPrices(lqtyTokenAddress: string, uniTokenAddress: string) {\r\n  const response = await window.fetch(\"https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"content-type\": \"application/json\"\r\n    },\r\n    body: JSON.stringify({\r\n      query: uniswapQuery(lqtyTokenAddress, uniTokenAddress),\r\n      variables: null\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    return Promise.reject(\"Network error connecting to Uniswap subgraph\");\r\n  }\r\n\r\n  const { data, errors }: UniswapResponse = await response.json();\r\n\r\n  if (errors) {\r\n    return Promise.reject(errors);\r\n  }\r\n\r\n  if (\r\n    typeof data?.token?.derivedETH === \"string\" &&\r\n    typeof data?.pair?.reserveUSD === \"string\" &&\r\n    typeof data?.pair?.totalSupply === \"string\" &&\r\n    typeof data?.bundle?.ethPrice === \"string\"\r\n  ) {\r\n    const ethPriceUSD = Decimal.from(data.bundle.ethPrice);\r\n    const lqtyPriceUSD = Decimal.from(data.token.derivedETH).mul(ethPriceUSD);\r\n    const uniLpPriceUSD = Decimal.from(data.pair.reserveUSD).div(\r\n      Decimal.from(data.pair.totalSupply)\r\n    );\r\n\r\n    return { lqtyPriceUSD, uniLpPriceUSD };\r\n  }\r\n\r\n  return Promise.reject(\"Uniswap doesn't have the required data to calculate yield\");\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Card, Paragraph, Text } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { InfoIcon } from \"../../InfoIcon\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { Badge } from \"../../Badge\";\r\nimport { fetchPrices } from \"../context/fetchPrices\";\r\n\r\nconst selector = ({\r\n  remainingLiquidityMiningLQTYReward,\r\n  totalStakedUniTokens\r\n}: LiquityStoreState) => ({\r\n  remainingLiquidityMiningLQTYReward,\r\n  totalStakedUniTokens\r\n});\r\n\r\nexport const Yield: React.FC = () => {\r\n  const {\r\n    liquity: {\r\n      connection: { addresses, liquidityMiningLQTYRewardRate }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const { remainingLiquidityMiningLQTYReward, totalStakedUniTokens } = useLiquitySelector(selector);\r\n  const [lqtyPrice, setLqtyPrice] = useState<Decimal | undefined>(undefined);\r\n  const [uniLpPrice, setUniLpPrice] = useState<Decimal | undefined>(undefined);\r\n  const hasZeroValue = remainingLiquidityMiningLQTYReward.isZero || totalStakedUniTokens.isZero;\r\n  const lqtyTokenAddress = addresses[\"lqtyToken\"];\r\n  const uniTokenAddress = addresses[\"uniToken\"];\r\n  const secondsRemaining = remainingLiquidityMiningLQTYReward.div(liquidityMiningLQTYRewardRate);\r\n  const daysRemaining = secondsRemaining.div(60 * 60 * 24);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { lqtyPriceUSD, uniLpPriceUSD } = await fetchPrices(lqtyTokenAddress, uniTokenAddress);\r\n        setLqtyPrice(lqtyPriceUSD);\r\n        setUniLpPrice(uniLpPriceUSD);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    })();\r\n  }, [lqtyTokenAddress, uniTokenAddress]);\r\n\r\n  if (hasZeroValue || lqtyPrice === undefined || uniLpPrice === undefined) return null;\r\n\r\n  const remainingLqtyInUSD = remainingLiquidityMiningLQTYReward.mul(lqtyPrice);\r\n  const totalStakedUniLpInUSD = totalStakedUniTokens.mul(uniLpPrice);\r\n  const yieldPercentage = remainingLqtyInUSD.div(totalStakedUniLpInUSD).mul(100);\r\n\r\n  if (yieldPercentage.isZero) return null;\r\n\r\n  return (\r\n    <Badge>\r\n      <Text>\r\n        {daysRemaining?.prettify(0)} day yield {yieldPercentage.toString(2)}%\r\n      </Text>\r\n      <InfoIcon\r\n        tooltip={\r\n          <Card variant=\"tooltip\" sx={{ minWidth: [\"auto\", \"352px\"] }}>\r\n            <Paragraph>\r\n              An <Text sx={{ fontWeight: \"bold\" }}>estimate</Text> of the LQTY return on staked UNI\r\n              LP tokens. The farm runs for 6-weeks, and the return is relative to the time remaining.\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\", mt: 2 }}>\r\n              ($LQTY_REWARDS / $STAKED_UNI_LP) * 100 ={\" \"}\r\n              <Text sx={{ fontWeight: \"bold\" }}> Yield</Text>\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\" }}>\r\n              ($\r\n              {remainingLqtyInUSD.shorten()} / ${totalStakedUniLpInUSD.shorten()}) * 100 =\r\n              <Text sx={{ fontWeight: \"bold\" }}> {yieldPercentage.toString(2)}%</Text>\r\n            </Paragraph>\r\n          </Card>\r\n        }\r\n      ></InfoIcon>\r\n    </Badge>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button, Link, Paragraph } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../../hooks/LiquityContext\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { InfoMessage } from \"../../../InfoMessage\";\r\nimport { useFarmView } from \"../../context/FarmViewContext\";\r\nimport { RemainingLQTY } from \"../RemainingLQTY\";\r\nimport { Yield } from \"../Yield\";\r\n\r\nconst uniLink = (lusdAddress: string) => `https://app.uniswap.org/#/add/ETH/${lusdAddress}`;\r\n\r\nexport const Inactive: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n\r\n  const {\r\n    liquity: {\r\n      connection: { addresses }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const handleStakePressed = useCallback(() => {\r\n    dispatchEvent(\"STAKE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Uniswap Liquidity Farm\r\n        <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n          <RemainingLQTY />\r\n        </Flex>\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"You aren't farming LQTY.\">\r\n          <Paragraph>You can farm LQTY by staking your Uniswap ETH/LUSD LP tokens.</Paragraph>\r\n\r\n          <Paragraph sx={{ mt: 2 }}>\r\n            You can obtain LP tokens by adding liquidity to the{\" \"}\r\n            <Link href={uniLink(addresses[\"lusdToken\"])} target=\"_blank\">\r\n              ETH/LUSD pool on Uniswap. <Icon name=\"external-link-alt\" size=\"xs\" />\r\n            </Link>\r\n          </Paragraph>\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Flex sx={{ justifyContent: \"flex-start\", alignItems: \"center\", flex: 1 }}>\r\n            <Yield />\r\n          </Flex>\r\n          <Button onClick={handleStakePressed}>Stake</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nconst selector = ({\r\n  uniTokenBalance,\r\n  uniTokenAllowance,\r\n  liquidityMiningStake\r\n}: LiquityStoreState) => ({\r\n  uniTokenBalance,\r\n  uniTokenAllowance,\r\n  liquidityMiningStake\r\n});\r\n\r\ntype FarmStakeValidation = {\r\n  isValid: boolean;\r\n  hasApproved: boolean;\r\n  hasEnoughUniToken: boolean;\r\n  isWithdrawing: boolean;\r\n  amountChanged: Decimal;\r\n  maximumStake: Decimal;\r\n  hasSetMaximumStake: boolean;\r\n};\r\n\r\nexport const useValidationState = (amount: Decimal): FarmStakeValidation => {\r\n  const { uniTokenBalance, uniTokenAllowance, liquidityMiningStake } = useLiquitySelector(selector);\r\n  const isWithdrawing = liquidityMiningStake.gt(amount);\r\n  const amountChanged = isWithdrawing\r\n    ? liquidityMiningStake.sub(amount)\r\n    : Decimal.from(amount).sub(liquidityMiningStake);\r\n  const maximumStake = liquidityMiningStake.add(uniTokenBalance);\r\n  const hasSetMaximumStake = amount.eq(maximumStake);\r\n\r\n  if (isWithdrawing) {\r\n    return {\r\n      isValid: true,\r\n      hasApproved: true,\r\n      hasEnoughUniToken: true,\r\n      isWithdrawing,\r\n      amountChanged,\r\n      maximumStake,\r\n      hasSetMaximumStake\r\n    };\r\n  }\r\n\r\n  const hasApproved = !uniTokenAllowance.isZero && uniTokenAllowance.gte(amountChanged);\r\n  const hasEnoughUniToken = !uniTokenBalance.isZero && uniTokenBalance.gte(amountChanged);\r\n\r\n  return {\r\n    isValid: hasApproved && hasEnoughUniToken,\r\n    hasApproved,\r\n    hasEnoughUniToken,\r\n    isWithdrawing,\r\n    amountChanged,\r\n    maximumStake,\r\n    hasSetMaximumStake\r\n  };\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../../Transaction\";\r\nimport { useValidationState } from \"../context/useValidationState\";\r\nimport { useFarmView } from \"../context/FarmViewContext\";\r\n\r\ntype ConfirmProps = {\r\n  amount: Decimal;\r\n};\r\n\r\nconst transactionId = \"farm-confirm\";\r\n\r\nexport const Confirm: React.FC<ConfirmProps> = ({ amount }) => {\r\n  const { dispatchEvent } = useFarmView();\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const { isValid, isWithdrawing, amountChanged } = useValidationState(amount);\r\n\r\n  const transactionAction = isWithdrawing\r\n    ? liquity.unstakeUniTokens.bind(liquity, amountChanged)\r\n    : liquity.stakeUniTokens.bind(liquity, amountChanged);\r\n\r\n  const shouldDisable = amountChanged.isZero || !isValid;\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"STAKE_CONFIRMED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  return (\r\n    <Transaction\r\n      id={transactionId}\r\n      send={transactionAction}\r\n      showFailure=\"asTooltip\"\r\n      tooltipPlacement=\"bottom\"\r\n    >\r\n      <Button disabled={shouldDisable}>Confirm</Button>\r\n    </Transaction>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Text } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { LP } from \"../../../strings\";\r\nimport { Transaction } from \"../../Transaction\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { ActionDescription } from \"../../ActionDescription\";\r\nimport { useValidationState } from \"../context/useValidationState\";\r\n\r\ntype DescriptionProps = {\r\n  amount: Decimal;\r\n};\r\n\r\nconst transactionId = \"farm-stake\";\r\n\r\nexport const Description: React.FC<DescriptionProps> = ({ amount }) => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n  const { isValid, hasApproved, isWithdrawing, amountChanged } = useValidationState(amount);\r\n\r\n  if (!hasApproved) {\r\n    return (\r\n      <ActionDescription>\r\n        <Text>To stake your {LP} tokens you need to allow Liquity to stake them for you</Text>\r\n      </ActionDescription>\r\n    );\r\n  }\r\n\r\n  if (!isValid || amountChanged.isZero) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <ActionDescription>\r\n      {isWithdrawing && (\r\n        <Transaction id={transactionId} send={liquity.unstakeUniTokens.bind(liquity, amountChanged)}>\r\n          <Text>\r\n            You are unstaking {amountChanged.prettify(4)} {LP}\r\n          </Text>\r\n        </Transaction>\r\n      )}\r\n      {!isWithdrawing && (\r\n        <Transaction id={transactionId} send={liquity.stakeUniTokens.bind(liquity, amountChanged)}>\r\n          <Text>\r\n            You are staking {amountChanged.prettify(4)} {LP}\r\n          </Text>\r\n        </Transaction>\r\n      )}\r\n    </ActionDescription>\r\n  );\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../../Transaction\";\r\nimport { useFarmView } from \"../context/FarmViewContext\";\r\nimport { useValidationState } from \"../context/useValidationState\";\r\n\r\ntype ApproveProps = {\r\n  amount: Decimal;\r\n};\r\n\r\nconst transactionId = \"farm-approve\";\r\n\r\nexport const Approve: React.FC<ApproveProps> = ({ amount }) => {\r\n  const { dispatchEvent } = useFarmView();\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const { hasApproved } = useValidationState(amount);\r\n  const transactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"STAKE_APPROVED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  if (hasApproved) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Transaction\r\n      id={transactionId}\r\n      send={liquity.approveUniTokens.bind(liquity, undefined)}\r\n      showFailure=\"asTooltip\"\r\n      tooltipPlacement=\"bottom\"\r\n    >\r\n      <Button sx={{ width: \"60%\" }}>Approve UNI LP</Button>\r\n    </Transaction>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { LP } from \"../../../strings\";\r\nimport { ErrorDescription } from \"../../ErrorDescription\";\r\nimport { useValidationState } from \"../context/useValidationState\";\r\n\r\ntype ValidationProps = {\r\n  amount: Decimal;\r\n};\r\n\r\nexport const Validation: React.FC<ValidationProps> = ({ amount }) => {\r\n  const { isValid, hasApproved, hasEnoughUniToken } = useValidationState(amount);\r\n\r\n  if (isValid) {\r\n    return null;\r\n  }\r\n\r\n  if (!hasApproved) {\r\n    return <ErrorDescription>You haven't approved enough {LP}</ErrorDescription>;\r\n  }\r\n\r\n  if (!hasEnoughUniToken) {\r\n    return <ErrorDescription>You don't have enough {LP}</ErrorDescription>;\r\n  }\r\n\r\n  return null;\r\n};\r\n","import React, { useCallback, useState } from \"react\";\r\nimport { Heading, Box, Flex, Card, Button } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { LP } from \"../../../../strings\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { EditableRow, StaticRow } from \"../../../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../../../LoadingOverlay\";\r\nimport { useFarmView } from \"../../context/FarmViewContext\";\r\nimport { useMyTransactionState } from \"../../../Transaction\";\r\nimport { Confirm } from \"../Confirm\";\r\nimport { Description } from \"../Description\";\r\nimport { Approve } from \"../Approve\";\r\nimport { Validation } from \"../Validation\";\r\nimport { useValidationState } from \"../../context/useValidationState\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nconst transactionId = /farm-/;\r\nconst selector = ({ totalStakedUniTokens }: LiquityStoreState) => ({ totalStakedUniTokens });\r\n\r\nexport const Staking: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n  const { totalStakedUniTokens } = useLiquitySelector(selector);\r\n\r\n  const [amount, setAmount] = useState<Decimal>(Decimal.from(0));\r\n  const editingState = useState<string>();\r\n  const isDirty = !amount.isZero;\r\n\r\n  const { maximumStake, hasSetMaximumStake } = useValidationState(amount);\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const nextTotalStakedUniTokens = totalStakedUniTokens.add(amount);\r\n\r\n  const poolShare = amount.mulDiv(100, nextTotalStakedUniTokens);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Uniswap Liquidity Farm\r\n        {isDirty && !isTransactionPending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => setAmount(Decimal.from(0))}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Stake\"\r\n          inputId=\"amount-lp\"\r\n          amount={amount.prettify(4)}\r\n          unit={LP}\r\n          editingState={editingState}\r\n          editedAmount={amount.toString(4)}\r\n          setEditedAmount={amount => setAmount(Decimal.from(amount))}\r\n          maxAmount={maximumStake.toString()}\r\n          maxedOut={hasSetMaximumStake}\r\n        ></EditableRow>\r\n\r\n        {poolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"farm-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"farm-share\"\r\n            amount={poolShare.prettify(4)}\r\n            unit=\"%\"\r\n          />\r\n        )}\r\n\r\n        {isDirty && <Validation amount={amount} />}\r\n        <Description amount={amount} />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n          <Approve amount={amount} />\r\n          <Confirm amount={amount} />\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback, useState } from \"react\";\r\nimport { Heading, Box, Flex, Card, Button } from \"theme-ui\";\r\nimport { Decimal, Difference, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { LP, GT } from \"../../../../strings\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { EditableRow, StaticRow } from \"../../../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../../../LoadingOverlay\";\r\nimport { useFarmView } from \"../../context/FarmViewContext\";\r\nimport { useMyTransactionState } from \"../../../Transaction\";\r\nimport { Confirm } from \"../Confirm\";\r\nimport { Description } from \"../Description\";\r\nimport { Approve } from \"../Approve\";\r\nimport { Validation } from \"../Validation\";\r\n\r\nconst selector = ({\r\n  liquidityMiningStake,\r\n  liquidityMiningLQTYReward,\r\n  uniTokenBalance,\r\n  totalStakedUniTokens\r\n}: LiquityStoreState) => ({\r\n  liquidityMiningStake,\r\n  liquidityMiningLQTYReward,\r\n  uniTokenBalance,\r\n  totalStakedUniTokens\r\n});\r\n\r\nconst transactionId = /farm-/;\r\n\r\nexport const Adjusting: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n  const {\r\n    liquidityMiningStake,\r\n    liquidityMiningLQTYReward,\r\n    uniTokenBalance,\r\n    totalStakedUniTokens\r\n  } = useLiquitySelector(selector);\r\n  const [amount, setAmount] = useState<Decimal>(liquidityMiningStake);\r\n  const editingState = useState<string>();\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n  const isDirty = !amount.eq(liquidityMiningStake);\r\n  const maximumAmount = liquidityMiningStake.add(uniTokenBalance);\r\n  const hasSetMaximumAmount = amount.eq(maximumAmount);\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const nextTotalStakedUniTokens = isDirty\r\n    ? totalStakedUniTokens.sub(liquidityMiningStake).add(amount)\r\n    : totalStakedUniTokens;\r\n\r\n  const originalPoolShare = liquidityMiningStake.mulDiv(100, totalStakedUniTokens);\r\n  const poolShare = amount.mulDiv(100, nextTotalStakedUniTokens);\r\n\r\n  const poolShareChange =\r\n    liquidityMiningStake.nonZero && Difference.between(poolShare, originalPoolShare).nonZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Uniswap Liquidity Farm\r\n        {isDirty && !isTransactionPending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => setAmount(liquidityMiningStake)}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Stake\"\r\n          inputId=\"farm-stake-amount\"\r\n          amount={isDirty ? amount.prettify(4) : liquidityMiningStake.prettify(4)}\r\n          unit={LP}\r\n          editingState={editingState}\r\n          editedAmount={amount.toString(4)}\r\n          setEditedAmount={amount => setAmount(Decimal.from(amount))}\r\n          maxAmount={maximumAmount.toString()}\r\n          maxedOut={hasSetMaximumAmount}\r\n        ></EditableRow>\r\n\r\n        {poolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"farm-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"farm-share\"\r\n            amount={poolShare.prettify(4)}\r\n            unit=\"%\"\r\n            pendingAmount={poolShareChange?.prettify(4).concat(\"%\")}\r\n            pendingColor={poolShareChange?.positive ? \"success\" : \"danger\"}\r\n          />\r\n        )}\r\n\r\n        <StaticRow\r\n          label=\"Reward\"\r\n          inputId=\"farm-reward-amount\"\r\n          amount={liquidityMiningLQTYReward.prettify(4)}\r\n          color={liquidityMiningLQTYReward.nonZero && \"success\"}\r\n          unit={GT}\r\n        />\r\n\r\n        {isDirty && <Validation amount={amount} />}\r\n        {isDirty && <Description amount={amount} />}\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n          <Approve amount={amount} />\r\n          <Confirm amount={amount} />\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../../../Transaction\";\r\nimport { useFarmView } from \"../../context/FarmViewContext\";\r\n\r\nconst transactionId = \"farm-claim-reward\";\r\n\r\nexport const ClaimReward: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"CLAIM_REWARD_CONFIRMED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  return (\r\n    <Transaction\r\n      id={transactionId}\r\n      send={liquity.withdrawLQTYRewardFromLiquidityMining.bind(liquity)}\r\n      showFailure=\"asTooltip\"\r\n      tooltipPlacement=\"bottom\"\r\n    >\r\n      <Button>Claim reward</Button>\r\n    </Transaction>\r\n  );\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../../Transaction\";\r\nimport { useFarmView } from \"../context/FarmViewContext\";\r\n\r\nconst transactionId = \"farm-unstake-and-claim\";\r\n\r\nexport const UnstakeAndClaim: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"UNSTAKE_AND_CLAIM_CONFIRMED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  return (\r\n    <Transaction\r\n      id={transactionId}\r\n      send={liquity.exitLiquidityMining.bind(liquity)}\r\n      showFailure=\"asTooltip\"\r\n      tooltipPlacement=\"bottom\"\r\n    >\r\n      <Button variant=\"outline\" sx={{ mt: 3, width: \"100%\" }}>\r\n        Unstake and claim reward\r\n      </Button>\r\n    </Transaction>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { LP, GT } from \"../../../../strings\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { LoadingOverlay } from \"../../../LoadingOverlay\";\r\nimport { useMyTransactionState } from \"../../../Transaction\";\r\nimport { DisabledEditableRow, StaticRow } from \"../../../Trove/Editor\";\r\nimport { useFarmView } from \"../../context/FarmViewContext\";\r\nimport { RemainingLQTY } from \"../RemainingLQTY\";\r\nimport { ClaimReward } from \"./ClaimReward\";\r\nimport { UnstakeAndClaim } from \"../UnstakeAndClaim\";\r\nimport { Yield } from \"../Yield\";\r\n\r\nconst selector = ({\r\n  liquidityMiningStake,\r\n  liquidityMiningLQTYReward,\r\n  totalStakedUniTokens\r\n}: LiquityStoreState) => ({\r\n  liquidityMiningStake,\r\n  liquidityMiningLQTYReward,\r\n  totalStakedUniTokens\r\n});\r\nconst transactionId = /farm-/i;\r\n\r\nexport const Active: React.FC = () => {\r\n  const { dispatchEvent } = useFarmView();\r\n  const {\r\n    liquidityMiningStake,\r\n    liquidityMiningLQTYReward,\r\n    totalStakedUniTokens\r\n  } = useLiquitySelector(selector);\r\n\r\n  const handleAdjustPressed = useCallback(() => {\r\n    dispatchEvent(\"ADJUST_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  const poolShare = liquidityMiningStake.mulDiv(100, totalStakedUniTokens);\r\n  const hasStakeAndRewards = !liquidityMiningStake.isZero && !liquidityMiningLQTYReward.isZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Uniswap Liquidity Farm\r\n        {!isTransactionPending && (\r\n          <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n            <RemainingLQTY />\r\n          </Flex>\r\n        )}\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Box>\r\n          <DisabledEditableRow\r\n            label=\"Stake\"\r\n            inputId=\"farm-stake\"\r\n            amount={liquidityMiningStake.prettify(4)}\r\n            unit={LP}\r\n          />\r\n          {poolShare.infinite ? (\r\n            <StaticRow label=\"Pool share\" inputId=\"farm-share\" amount=\"N/A\" />\r\n          ) : (\r\n            <StaticRow\r\n              label=\"Pool share\"\r\n              inputId=\"farm-share\"\r\n              amount={poolShare.prettify(4)}\r\n              unit={\"%\"}\r\n            />\r\n          )}\r\n          <Flex sx={{ alignItems: \"center\" }}>\r\n            <StaticRow\r\n              label=\"Reward\"\r\n              inputId=\"farm-reward\"\r\n              amount={liquidityMiningLQTYReward.prettify(4)}\r\n              color={liquidityMiningLQTYReward.nonZero && \"success\"}\r\n              unit={GT}\r\n            />\r\n            <Flex sx={{ justifyContent: \"flex-end\", flex: 1 }}>\r\n              <Yield />\r\n            </Flex>\r\n          </Flex>\r\n        </Box>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button\r\n            variant={!liquidityMiningLQTYReward.isZero ? \"outline\" : \"primary\"}\r\n            onClick={handleAdjustPressed}\r\n          >\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n          {!liquidityMiningLQTYReward.isZero && <ClaimReward />}\r\n        </Flex>\r\n        <Flex>{hasStakeAndRewards && <UnstakeAndClaim />}</Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Card, Heading, Box, Flex } from \"theme-ui\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { InfoMessage } from \"../../../InfoMessage\";\r\nimport { UnstakeAndClaim } from \"../UnstakeAndClaim\";\r\nimport { RemainingLQTY } from \"../RemainingLQTY\";\r\nimport { StaticRow } from \"../../../Trove/Editor\";\r\nimport { GT, LP } from \"../../../../strings\";\r\n\r\nconst selector = ({ liquidityMiningStake, liquidityMiningLQTYReward }: LiquityStoreState) => ({\r\n  liquidityMiningStake,\r\n  liquidityMiningLQTYReward\r\n});\r\n\r\nexport const Disabled: React.FC = () => {\r\n  const { liquidityMiningStake, liquidityMiningLQTYReward } = useLiquitySelector(selector);\r\n  const hasStake = !liquidityMiningStake.isZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Uniswap Liquidity Farm\r\n        <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n          <RemainingLQTY />\r\n        </Flex>\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"Liquidity farming period has finished\">\r\n          <Flex>There are no more LQTY rewards left to farm</Flex>\r\n        </InfoMessage>\r\n        {hasStake && (\r\n          <>\r\n            <Box sx={{ border: 1, pt: 3, borderRadius: 3 }}>\r\n              <StaticRow\r\n                label=\"Stake\"\r\n                inputId=\"farm-deposit\"\r\n                amount={liquidityMiningStake.prettify(4)}\r\n                unit={LP}\r\n              />\r\n              <StaticRow\r\n                label=\"Reward\"\r\n                inputId=\"farm-reward\"\r\n                amount={liquidityMiningLQTYReward.prettify(4)}\r\n                color={liquidityMiningLQTYReward.nonZero && \"success\"}\r\n                unit={GT}\r\n              />\r\n            </Box>\r\n            <UnstakeAndClaim />\r\n          </>\r\n        )}\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Inactive } from \"./views/Inactive/Inactive\";\r\nimport { Staking } from \"./views/Staking/Staking\";\r\nimport { Adjusting } from \"./views/Adjusting/Adjusting\";\r\nimport { Active } from \"./views/Active/Active\";\r\nimport { Disabled } from \"./views/Disabled/Disabled\";\r\nimport { useFarmView } from \"./context/FarmViewContext\";\r\n\r\nexport const Farm: React.FC = props => {\r\n  const { view } = useFarmView();\r\n\r\n  switch (view) {\r\n    case \"INACTIVE\": {\r\n      return <Inactive {...props} />;\r\n    }\r\n    case \"STAKING\": {\r\n      return <Staking {...props} />;\r\n    }\r\n    case \"ADJUSTING\": {\r\n      return <Adjusting {...props} />;\r\n    }\r\n    case \"ACTIVE\": {\r\n      return <Active {...props} />;\r\n    }\r\n    case \"DISABLED\": {\r\n      return <Disabled {...props} />;\r\n    }\r\n  }\r\n};\r\n","import { Container } from \"theme-ui\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { Farm as FarmPanel } from \"../components/Farm/Farm\";\r\n\r\nexport const Farm: React.FC = () => (\r\n  <Container variant=\"columns\" sx={{ justifyContent: \"flex-start\" }}>\r\n    <Container variant=\"left\">\r\n      <FarmPanel />\r\n    </Container>\r\n\r\n    <Container variant=\"right\">\r\n      <SystemStats />\r\n    </Container>\r\n  </Container>\r\n);\r\n","import React, { useState } from \"react\";\r\nimport { Card, Box, Heading, Flex, Button, Label, Input } from \"theme-ui\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { Transaction } from \"./Transaction\";\r\n\r\nexport const LiquidationManager: React.FC = () => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n  const [numberOfTrovesToLiquidate, setNumberOfTrovesToLiquidate] = useState(\"90\");\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Liquidate</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Flex sx={{ alignItems: \"stretch\" }}>\r\n          <Label>Up to</Label>\r\n\r\n          <Input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            step=\"1\"\r\n            value={numberOfTrovesToLiquidate}\r\n            onChange={e => setNumberOfTrovesToLiquidate(e.target.value)}\r\n          />\r\n\r\n          <Label>Troves</Label>\r\n\r\n          <Flex sx={{ ml: 2, alignItems: \"center\" }}>\r\n            <Transaction\r\n              id=\"batch-liquidate\"\r\n              tooltip=\"Liquidate\"\r\n              tooltipPlacement=\"bottom\"\r\n              send={overrides => {\r\n                if (!numberOfTrovesToLiquidate) {\r\n                  throw new Error(\"Invalid number\");\r\n                }\r\n                return liquity.liquidateUpTo(parseInt(numberOfTrovesToLiquidate, 10), overrides);\r\n              }}\r\n            >\r\n              <Button variant=\"dangerIcon\">\r\n                <Icon name=\"trash\" size=\"lg\" />\r\n              </Button>\r\n            </Transaction>\r\n          </Flex>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Box, BoxProps } from \"theme-ui\";\r\n\r\ntype AbbreviationProps = BoxProps & {\r\n  short: React.ReactNode;\r\n};\r\n\r\nexport const Abbreviation: React.FC<AbbreviationProps> = ({ children, short, ...boxProps }) => (\r\n  <Box as=\"span\" {...boxProps}>\r\n    <Box as=\"span\" sx={{ display: [\"none\", \"unset\"] }}>\r\n      {children}\r\n    </Box>\r\n\r\n    <Box as=\"span\" sx={{ display: [\"unset\", \"none\"] }}>\r\n      {short}\r\n    </Box>\r\n  </Box>\r\n);\r\n","import React, { useState, useEffect, useCallback } from \"react\";\r\nimport CopyToClipboard from \"react-copy-to-clipboard\";\r\nimport { Card, Button, Text, Box, Heading, Flex } from \"theme-ui\";\r\n\r\nimport {\r\n  Percent,\r\n  MINIMUM_COLLATERAL_RATIO,\r\n  CRITICAL_COLLATERAL_RATIO,\r\n  UserTrove,\r\n  Decimal\r\n} from \"@liquity/lib-base\";\r\nimport { BlockPolledLiquityStoreState } from \"@liquity/lib-ethers\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { COIN } from \"../strings\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { LoadingOverlay } from \"./LoadingOverlay\";\r\nimport { Transaction } from \"./Transaction\";\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport { Abbreviation } from \"./Abbreviation\";\r\n\r\nconst rowHeight = \"40px\";\r\n\r\nconst liquidatableInNormalMode = (trove: UserTrove, price: Decimal) =>\r\n  [trove.collateralRatioIsBelowMinimum(price), \"Collateral ratio not low enough\"] as const;\r\n\r\nconst liquidatableInRecoveryMode = (\r\n  trove: UserTrove,\r\n  price: Decimal,\r\n  totalCollateralRatio: Decimal,\r\n  lusdInStabilityPool: Decimal\r\n) => {\r\n  const collateralRatio = trove.collateralRatio(price);\r\n\r\n  if (collateralRatio.gte(MINIMUM_COLLATERAL_RATIO) && collateralRatio.lt(totalCollateralRatio)) {\r\n    return [\r\n      trove.debt.lte(lusdInStabilityPool),\r\n      \"There's not enough LUSD in the Stability pool to cover the debt\"\r\n    ] as const;\r\n  } else {\r\n    return liquidatableInNormalMode(trove, price);\r\n  }\r\n};\r\n\r\ntype RiskyTrovesProps = {\r\n  pageSize: number;\r\n};\r\n\r\nconst select = ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  blockTag\r\n}: BlockPolledLiquityStoreState) => ({\r\n  numberOfTroves,\r\n  price,\r\n  recoveryMode: total.collateralRatioIsBelowCritical(price),\r\n  totalCollateralRatio: total.collateralRatio(price),\r\n  lusdInStabilityPool,\r\n  blockTag\r\n});\r\n\r\nexport const RiskyTroves: React.FC<RiskyTrovesProps> = ({ pageSize }) => {\r\n  const {\r\n    blockTag,\r\n    numberOfTroves,\r\n    recoveryMode,\r\n    totalCollateralRatio,\r\n    lusdInStabilityPool,\r\n    price\r\n  } = useLiquitySelector(select);\r\n  const { liquity } = useLiquity();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [troves, setTroves] = useState<UserTrove[]>();\r\n\r\n  const [reload, setReload] = useState({});\r\n  const forceReload = useCallback(() => setReload({}), []);\r\n\r\n  const [page, setPage] = useState(0);\r\n  const numberOfPages = Math.ceil(numberOfTroves / pageSize) || 1;\r\n  const clampedPage = Math.min(page, numberOfPages - 1);\r\n\r\n  const nextPage = () => {\r\n    if (clampedPage < numberOfPages - 1) {\r\n      setPage(clampedPage + 1);\r\n    }\r\n  };\r\n\r\n  const previousPage = () => {\r\n    if (clampedPage > 0) {\r\n      setPage(clampedPage - 1);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (page !== clampedPage) {\r\n      setPage(clampedPage);\r\n    }\r\n  }, [page, clampedPage]);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    setLoading(true);\r\n\r\n    liquity\r\n      .getTroves(\r\n        {\r\n          first: pageSize,\r\n          sortedBy: \"ascendingCollateralRatio\",\r\n          startingAt: clampedPage * pageSize\r\n        },\r\n        { blockTag }\r\n      )\r\n      .then(troves => {\r\n        if (mounted) {\r\n          setTroves(troves);\r\n          setLoading(false);\r\n        }\r\n      });\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n    // Omit blockTag from deps on purpose\r\n    // eslint-disable-next-line\r\n  }, [liquity, clampedPage, pageSize, reload]);\r\n\r\n  useEffect(() => {\r\n    forceReload();\r\n  }, [forceReload, numberOfTroves]);\r\n\r\n  const [copied, setCopied] = useState<string>();\r\n\r\n  useEffect(() => {\r\n    if (copied !== undefined) {\r\n      let cancelled = false;\r\n\r\n      setTimeout(() => {\r\n        if (!cancelled) {\r\n          setCopied(undefined);\r\n        }\r\n      }, 2000);\r\n\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n  }, [copied]);\r\n\r\n  return (\r\n    <Card sx={{ width: \"100%\" }}>\r\n      <Heading>\r\n        <Abbreviation short=\"Troves\">Risky Troves</Abbreviation>\r\n\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          {numberOfTroves !== 0 && (\r\n            <>\r\n              <Abbreviation\r\n                short={`page ${clampedPage + 1} / ${numberOfPages}`}\r\n                sx={{ mr: [0, 3], fontWeight: \"body\", fontSize: [1, 2], letterSpacing: [-1, 0] }}\r\n              >\r\n                {clampedPage * pageSize + 1}-{Math.min((clampedPage + 1) * pageSize, numberOfTroves)}{\" \"}\r\n                of {numberOfTroves}\r\n              </Abbreviation>\r\n\r\n              <Button variant=\"titleIcon\" onClick={previousPage} disabled={clampedPage <= 0}>\r\n                <Icon name=\"chevron-left\" size=\"lg\" />\r\n              </Button>\r\n\r\n              <Button\r\n                variant=\"titleIcon\"\r\n                onClick={nextPage}\r\n                disabled={clampedPage >= numberOfPages - 1}\r\n              >\r\n                <Icon name=\"chevron-right\" size=\"lg\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ opacity: loading ? 0 : 1, ml: [0, 3] }}\r\n            onClick={forceReload}\r\n          >\r\n            <Icon name=\"redo\" size=\"lg\" />\r\n          </Button>\r\n        </Flex>\r\n      </Heading>\r\n\r\n      {!troves || troves.length === 0 ? (\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Box sx={{ p: 4, fontSize: 3, textAlign: \"center\" }}>\r\n            {!troves ? \"Loading...\" : \"There are no Troves yet\"}\r\n          </Box>\r\n        </Box>\r\n      ) : (\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Box\r\n            as=\"table\"\r\n            sx={{\r\n              mt: 2,\r\n              pl: [1, 4],\r\n              width: \"100%\",\r\n\r\n              textAlign: \"center\",\r\n              lineHeight: 1.15\r\n            }}\r\n          >\r\n            <colgroup>\r\n              <col style={{ width: \"50px\" }} />\r\n              <col />\r\n              <col />\r\n              <col />\r\n              <col style={{ width: rowHeight }} />\r\n            </colgroup>\r\n\r\n            <thead>\r\n              <tr>\r\n                <th>Owner</th>\r\n                <th>\r\n                  <Abbreviation short=\"Coll.\">Collateral</Abbreviation>\r\n                  <Box sx={{ fontSize: [0, 1], fontWeight: \"body\", opacity: 0.5 }}>ETH</Box>\r\n                </th>\r\n                <th>\r\n                  Debt\r\n                  <Box sx={{ fontSize: [0, 1], fontWeight: \"body\", opacity: 0.5 }}>{COIN}</Box>\r\n                </th>\r\n                <th>\r\n                  Coll.\r\n                  <br />\r\n                  Ratio\r\n                </th>\r\n                <th></th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              {troves.map(\r\n                trove =>\r\n                  !trove.isEmpty && ( // making sure the Trove hasn't been liquidated\r\n                    // (TODO: remove check after we can fetch multiple Troves in one call)\r\n                    <tr key={trove.ownerAddress}>\r\n                      <td\r\n                        style={{\r\n                          display: \"flex\",\r\n                          alignItems: \"center\",\r\n                          height: rowHeight\r\n                        }}\r\n                      >\r\n                        <Tooltip message={trove.ownerAddress} placement=\"top\">\r\n                          <Text\r\n                            variant=\"address\"\r\n                            sx={{\r\n                              width: [\"73px\", \"unset\"],\r\n                              overflow: \"hidden\",\r\n                              position: \"relative\"\r\n                            }}\r\n                          >\r\n                            {shortenAddress(trove.ownerAddress)}\r\n                            <Box\r\n                              sx={{\r\n                                display: [\"block\", \"none\"],\r\n                                position: \"absolute\",\r\n                                top: 0,\r\n                                right: 0,\r\n                                width: \"50px\",\r\n                                height: \"100%\",\r\n                                background:\r\n                                  \"linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%)\"\r\n                              }}\r\n                            />\r\n                          </Text>\r\n                        </Tooltip>\r\n\r\n                        <CopyToClipboard\r\n                          text={trove.ownerAddress}\r\n                          onCopy={() => setCopied(trove.ownerAddress)}\r\n                        >\r\n                          <Button variant=\"icon\" sx={{ width: \"24px\", height: \"24px\" }}>\r\n                            <Icon\r\n                              name={copied === trove.ownerAddress ? \"clipboard-check\" : \"clipboard\"}\r\n                              size=\"sm\"\r\n                            />\r\n                          </Button>\r\n                        </CopyToClipboard>\r\n                      </td>\r\n                      <td>\r\n                        <Abbreviation short={trove.collateral.shorten()}>\r\n                          {trove.collateral.prettify(4)}\r\n                        </Abbreviation>\r\n                      </td>\r\n                      <td>\r\n                        <Abbreviation short={trove.debt.shorten()}>\r\n                          {trove.debt.prettify()}\r\n                        </Abbreviation>\r\n                      </td>\r\n                      <td>\r\n                        {(collateralRatio => (\r\n                          <Text\r\n                            color={\r\n                              collateralRatio.gt(CRITICAL_COLLATERAL_RATIO)\r\n                                ? \"success\"\r\n                                : collateralRatio.gt(1.2)\r\n                                ? \"warning\"\r\n                                : \"danger\"\r\n                            }\r\n                          >\r\n                            {new Percent(collateralRatio).prettify()}\r\n                          </Text>\r\n                        ))(trove.collateralRatio(price))}\r\n                      </td>\r\n                      <td>\r\n                        <Transaction\r\n                          id={`liquidate-${trove.ownerAddress}`}\r\n                          tooltip=\"Liquidate\"\r\n                          requires={[\r\n                            recoveryMode\r\n                              ? liquidatableInRecoveryMode(\r\n                                  trove,\r\n                                  price,\r\n                                  totalCollateralRatio,\r\n                                  lusdInStabilityPool\r\n                                )\r\n                              : liquidatableInNormalMode(trove, price)\r\n                          ]}\r\n                          send={liquity.send.liquidate.bind(liquity.send, trove.ownerAddress)}\r\n                        >\r\n                          <Button variant=\"dangerIcon\">\r\n                            <Icon name=\"trash\" />\r\n                          </Button>\r\n                        </Transaction>\r\n                      </td>\r\n                    </tr>\r\n                  )\r\n              )}\r\n            </tbody>\r\n          </Box>\r\n        </Box>\r\n      )}\r\n\r\n      {loading && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Container, Card, Box, Paragraph } from \"theme-ui\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { LiquidationManager } from \"../components/LiquidationManager\";\r\nimport { RiskyTroves } from \"../components/RiskyTroves\";\r\nimport { InfoMessage } from \"../components/InfoMessage\";\r\n\r\nexport const RiskyTrovesPage: React.FC = () => (\r\n  <Container variant=\"columns\">\r\n    <Container variant=\"left\">\r\n      <Card>\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <InfoMessage title=\"Bot functionality\">\r\n            <Paragraph>Liquidation is expected to be carried out by bots.</Paragraph>\r\n            <Paragraph>\r\n              Early on you may be able to manually liquidate Troves, but as the system matures this\r\n              will become less likely.\r\n            </Paragraph>\r\n          </InfoMessage>\r\n        </Box>\r\n      </Card>\r\n      <LiquidationManager />\r\n    </Container>\r\n\r\n    <Container variant=\"right\">\r\n      <SystemStats />\r\n    </Container>\r\n    <RiskyTroves pageSize={10} />\r\n  </Container>\r\n);\r\n","import { Box, Card, Heading, Paragraph, Text } from \"theme-ui\";\r\n\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { Icon } from \"../Icon\";\r\n\r\ntype DisabledRedemptionProps = {\r\n  disabledDays: number;\r\n  unlockDate: Date;\r\n};\r\n\r\nexport const DisabledRedemption: React.FC<DisabledRedemptionProps> = ({\r\n  disabledDays,\r\n  unlockDate\r\n}) => (\r\n  <Card>\r\n    <Heading>Redeem</Heading>\r\n\r\n    <Box sx={{ p: [2, 3] }}>\r\n      <InfoMessage\r\n        title=\"Redemption is not enabled yet.\"\r\n        icon={\r\n          <Box sx={{ color: \"warning\" }}>\r\n            <Icon name=\"exclamation-triangle\" />\r\n          </Box>\r\n        }\r\n      >\r\n        <Paragraph>\r\n          LUSD redemption is disabled for the first {disabledDays} days after launch.\r\n        </Paragraph>\r\n\r\n        <Paragraph sx={{ mt: 3 }}>\r\n          It will be unlocked at{\" \"}\r\n          <Text sx={{ fontWeight: \"medium\" }}>{unlockDate.toLocaleString()}</Text>.\r\n        </Paragraph>\r\n      </InfoMessage>\r\n    </Box>\r\n  </Card>\r\n);\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype RedemptionActionProps = {\r\n  transactionId: string;\r\n  disabled?: boolean;\r\n  lusdAmount: Decimal;\r\n  maxRedemptionRate: Decimal;\r\n};\r\n\r\nexport const RedemptionAction: React.FC<RedemptionActionProps> = ({\r\n  transactionId,\r\n  disabled,\r\n  lusdAmount,\r\n  maxRedemptionRate\r\n}) => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    transactionId,\r\n    liquity.redeemLUSD.bind(liquity, lusdAmount, maxRedemptionRate)\r\n  );\r\n\r\n  return (\r\n    <Button disabled={disabled} onClick={sendTransaction}>\r\n      Confirm\r\n    </Button>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Button, Box, Flex, Card, Heading } from \"theme-ui\";\r\n\r\nimport { Decimal, Percent, LiquityStoreState, MINIMUM_COLLATERAL_RATIO } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN } from \"../../strings\";\r\n\r\nimport { Icon } from \"../Icon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { EditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { ActionDescription, Amount } from \"../ActionDescription\";\r\nimport { ErrorDescription } from \"../ErrorDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\n\r\nimport { RedemptionAction } from \"./RedemptionAction\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\nconst mcrPercent = new Percent(MINIMUM_COLLATERAL_RATIO).toString(0);\r\n\r\nconst select = ({ price, fees, total, lusdBalance }: LiquityStoreState) => ({\r\n  price,\r\n  fees,\r\n  total,\r\n  lusdBalance\r\n});\r\n\r\nconst transactionId = \"redemption\";\r\n\r\nexport const RedemptionManager: React.FC = () => {\r\n  const { price, fees, total, lusdBalance } = useLiquitySelector(select);\r\n  const [lusdAmount, setLUSDAmount] = useState(Decimal.ZERO);\r\n  const [changePending, setChangePending] = useState(false);\r\n  const editingState = useState<string>();\r\n\r\n  const dirty = !lusdAmount.isZero;\r\n  const ethAmount = lusdAmount.div(price);\r\n  const redemptionRate = fees.redemptionRate(lusdAmount.div(total.debt));\r\n  const feePct = new Percent(redemptionRate);\r\n  const ethFee = ethAmount.mul(redemptionRate);\r\n  const maxRedemptionRate = redemptionRate.add(0.001); // TODO slippage tolerance\r\n\r\n  const myTransactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      myTransactionState.type === \"waitingForApproval\" ||\r\n      myTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      setChangePending(true);\r\n    } else if (myTransactionState.type === \"failed\" || myTransactionState.type === \"cancelled\") {\r\n      setChangePending(false);\r\n    } else if (myTransactionState.type === \"confirmed\") {\r\n      setLUSDAmount(Decimal.ZERO);\r\n      setChangePending(false);\r\n    }\r\n  }, [myTransactionState.type, setChangePending, setLUSDAmount]);\r\n\r\n  const [canRedeem, description] = total.collateralRatioIsBelowMinimum(price)\r\n    ? [\r\n        false,\r\n        <ErrorDescription>\r\n          You can't redeem LUSD when the total collateral ratio is less than{\" \"}\r\n          <Amount>{mcrPercent}</Amount>. Please try again later.\r\n        </ErrorDescription>\r\n      ]\r\n    : lusdAmount.gt(lusdBalance)\r\n    ? [\r\n        false,\r\n        <ErrorDescription>\r\n          The amount you're trying to redeem exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {lusdAmount.sub(lusdBalance).prettify()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      ]\r\n    : [\r\n        true,\r\n        <ActionDescription>\r\n          You will receive <Amount>{ethAmount.sub(ethFee).prettify(4)} ETH</Amount> in exchange for{\" \"}\r\n          <Amount>\r\n            {lusdAmount.prettify()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ActionDescription>\r\n      ];\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Redeem\r\n        {dirty && !changePending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => setLUSDAmount(Decimal.ZERO)}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Redeem\"\r\n          inputId=\"redeem-lusd\"\r\n          amount={lusdAmount.prettify()}\r\n          maxAmount={lusdBalance.toString()}\r\n          maxedOut={lusdAmount.eq(lusdBalance)}\r\n          unit={COIN}\r\n          {...{ editingState }}\r\n          editedAmount={lusdAmount.toString(2)}\r\n          setEditedAmount={amount => setLUSDAmount(Decimal.from(amount))}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Redemption Fee\"\r\n          inputId=\"redeem-fee\"\r\n          amount={ethFee.toString(4)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit=\"ETH\"\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ minWidth: \"240px\" }}>\r\n                  The Redemption Fee is charged as a percentage of the redeemed Ether. The Redemption\r\n                  Fee depends on LUSD redemption volumes and is 0.5% at minimum.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        {((dirty || !canRedeem) && description) || (\r\n          <ActionDescription>Enter the amount of {COIN} you'd like to redeem.</ActionDescription>\r\n        )}\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <RedemptionAction\r\n            transactionId={transactionId}\r\n            disabled={!dirty || !canRedeem}\r\n            lusdAmount={lusdAmount}\r\n            maxRedemptionRate={maxRedemptionRate}\r\n          />\r\n        </Flex>\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { BlockPolledLiquityStoreState } from \"@liquity/lib-ethers\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { DisabledRedemption } from \"./DisabledRedemption\";\r\nimport { RedemptionManager } from \"./RedemptionManager\";\r\n\r\nconst SECONDS_IN_ONE_DAY = 24 * 60 * 60;\r\n\r\nconst selectBlockTimestamp = ({ blockTimestamp }: BlockPolledLiquityStoreState) => blockTimestamp;\r\n\r\nexport const Redemption: React.FC = () => {\r\n  const {\r\n    liquity: {\r\n      connection: { deploymentDate, bootstrapPeriod }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const blockTimestamp = useLiquitySelector(selectBlockTimestamp);\r\n\r\n  const bootstrapPeriodDays = Math.round(bootstrapPeriod / SECONDS_IN_ONE_DAY);\r\n  const deploymentTime = deploymentDate.getTime() / 1000;\r\n  const bootstrapEndTime = deploymentTime + bootstrapPeriod;\r\n  const bootstrapEndDate = new Date(bootstrapEndTime * 1000);\r\n  const redemptionDisabled = blockTimestamp < bootstrapEndTime;\r\n\r\n  if (redemptionDisabled) {\r\n    return <DisabledRedemption disabledDays={bootstrapPeriodDays} unlockDate={bootstrapEndDate} />;\r\n  }\r\n\r\n  return <RedemptionManager />;\r\n};\r\n","import React from \"react\";\r\nimport { Box, Card, Container, Link, Paragraph } from \"theme-ui\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { Redemption } from \"../components/Redemption/Redemption\";\r\nimport { InfoMessage } from \"../components/InfoMessage\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { Icon } from \"../components/Icon\";\r\n\r\nconst uniLink = (lusdAddress: string) =>\r\n  `https://app.uniswap.org/#/swap?inputCurrency=${lusdAddress}&outputCurrency=ETH`;\r\n\r\nexport const RedemptionPage: React.FC = () => {\r\n  const {\r\n    liquity: {\r\n      connection: { addresses }\r\n    }\r\n  } = useLiquity();\r\n\r\n  return (\r\n    <Container variant=\"columns\">\r\n      <Container variant=\"left\">\r\n        <Card>\r\n          <Box sx={{ p: [2, 3] }}>\r\n            <InfoMessage title=\"Bot functionality\">\r\n              <Paragraph>\r\n                Redemptions are expected to be carried out by bots when arbitrage opportunities\r\n                emerge.\r\n              </Paragraph>\r\n              <Paragraph sx={{ mt: 2 }}>\r\n                Most of the time you will get a better rate for converting LUSD to ETH on{\" \"}\r\n                <Link href={uniLink(addresses[\"lusdToken\"])} target=\"_blank\">\r\n                  Uniswap <Icon name=\"external-link-alt\" size=\"xs\" />\r\n                </Link>{\" \"}\r\n                or other exchanges.\r\n              </Paragraph>\r\n              <Paragraph sx={{ mt: 2 }}>\r\n                <strong>Note</strong>: Redemption is not for repaying your loan. To repay your loan,\r\n                adjust your Trove on the <Link href=\"#/\">Dashboard</Link>.\r\n              </Paragraph>\r\n            </InfoMessage>\r\n          </Box>\r\n        </Card>\r\n        <Redemption />\r\n      </Container>\r\n\r\n      <Container variant=\"right\">\r\n        <SystemStats />\r\n      </Container>\r\n    </Container>\r\n  );\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState, UserTroveStatus } from \"@liquity/lib-base\";\r\nimport { TroveViewContext } from \"./TroveViewContext\";\r\nimport type { TroveView, TroveEvent } from \"./types\";\r\n\r\ntype TroveEventTransitions = Record<TroveView, Partial<Record<TroveEvent, TroveView>>>;\r\n\r\nconst transitions: TroveEventTransitions = {\r\n  NONE: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  LIQUIDATED: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_SURPLUS_COLLATERAL_CLAIMED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  REDEEMED: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_SURPLUS_COLLATERAL_CLAIMED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  OPENING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  ADJUSTING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"ACTIVE\",\r\n    TROVE_ADJUSTED: \"ACTIVE\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  },\r\n  CLOSING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"ACTIVE\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_ADJUSTED: \"ACTIVE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  },\r\n  ACTIVE: {\r\n    ADJUST_TROVE_PRESSED: \"ADJUSTING\",\r\n    CLOSE_TROVE_PRESSED: \"CLOSING\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  }\r\n};\r\n\r\ntype TroveStateEvents = Partial<Record<UserTroveStatus, TroveEvent>>;\r\n\r\nconst troveStatusEvents: TroveStateEvents = {\r\n  open: \"TROVE_OPENED\",\r\n  closedByOwner: \"TROVE_CLOSED\",\r\n  closedByLiquidation: \"TROVE_LIQUIDATED\",\r\n  closedByRedemption: \"TROVE_REDEEMED\"\r\n};\r\n\r\nconst transition = (view: TroveView, event: TroveEvent): TroveView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nconst getInitialView = (troveStatus: UserTroveStatus): TroveView => {\r\n  if (troveStatus === \"closedByLiquidation\") {\r\n    return \"LIQUIDATED\";\r\n  }\r\n  if (troveStatus === \"closedByRedemption\") {\r\n    return \"REDEEMED\";\r\n  }\r\n  if (troveStatus === \"open\") {\r\n    return \"ACTIVE\";\r\n  }\r\n  return \"NONE\";\r\n};\r\n\r\nconst select = ({ trove: { status } }: LiquityStoreState) => status;\r\n\r\nexport const TroveViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const troveStatus = useLiquitySelector(select);\r\n\r\n  const [view, setView] = useState<TroveView>(getInitialView(troveStatus));\r\n  const viewRef = useRef<TroveView>(view);\r\n\r\n  const dispatchEvent = useCallback((event: TroveEvent) => {\r\n    const nextView = transition(viewRef.current, event);\r\n\r\n    console.log(\r\n      \"dispatchEvent() [current-view, event, next-view]\",\r\n      viewRef.current,\r\n      event,\r\n      nextView\r\n    );\r\n    setView(nextView);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    const event = troveStatusEvents[troveStatus] ?? null;\r\n    if (event !== null) {\r\n      dispatchEvent(event);\r\n    }\r\n  }, [troveStatus, dispatchEvent]);\r\n\r\n  const provider = {\r\n    view,\r\n    dispatchEvent\r\n  };\r\n  return <TroveViewContext.Provider value={provider}>{children}</TroveViewContext.Provider>;\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState, StabilityDeposit } from \"@liquity/lib-base\";\r\nimport { StabilityViewContext } from \"./StabilityViewContext\";\r\nimport type { StabilityView, StabilityEvent } from \"./types\";\r\n\r\ntype StabilityEventTransitions = Record<\r\n  StabilityView,\r\n  Partial<Record<StabilityEvent, StabilityView>>\r\n>;\r\n\r\nconst transitions: StabilityEventTransitions = {\r\n  NONE: {\r\n    DEPOSIT_PRESSED: \"DEPOSITING\"\r\n  },\r\n  DEPOSITING: {\r\n    CANCEL_PRESSED: \"NONE\",\r\n    DEPOSIT_CONFIRMED: \"ACTIVE\"\r\n  },\r\n  ACTIVE: {\r\n    REWARDS_CLAIMED: \"ACTIVE\",\r\n    ADJUST_DEPOSIT_PRESSED: \"ADJUSTING\",\r\n    DEPOSIT_EMPTIED: \"NONE\"\r\n  },\r\n  ADJUSTING: {\r\n    CANCEL_PRESSED: \"ACTIVE\",\r\n    DEPOSIT_CONFIRMED: \"ACTIVE\",\r\n    DEPOSIT_EMPTIED: \"NONE\"\r\n  }\r\n};\r\n\r\nconst transition = (view: StabilityView, event: StabilityEvent): StabilityView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nconst getInitialView = (stabilityDeposit: StabilityDeposit): StabilityView => {\r\n  return stabilityDeposit.isEmpty ? \"NONE\" : \"ACTIVE\";\r\n};\r\n\r\nconst select = ({ stabilityDeposit }: LiquityStoreState): StabilityDeposit => stabilityDeposit;\r\n\r\nexport const StabilityViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const stabilityDeposit = useLiquitySelector(select);\r\n\r\n  const [view, setView] = useState<StabilityView>(getInitialView(stabilityDeposit));\r\n  const viewRef = useRef<StabilityView>(view);\r\n\r\n  const dispatchEvent = useCallback((event: StabilityEvent) => {\r\n    const nextView = transition(viewRef.current, event);\r\n\r\n    console.log(\r\n      \"dispatchEvent() [current-view, event, next-view]\",\r\n      viewRef.current,\r\n      event,\r\n      nextView\r\n    );\r\n    setView(nextView);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    if (stabilityDeposit.isEmpty) {\r\n      dispatchEvent(\"DEPOSIT_EMPTIED\");\r\n    }\r\n  }, [stabilityDeposit.isEmpty, dispatchEvent]);\r\n\r\n  const provider = {\r\n    view,\r\n    dispatchEvent\r\n  };\r\n\r\n  return <StabilityViewContext.Provider value={provider}>{children}</StabilityViewContext.Provider>;\r\n};\r\n","import { useEffect } from \"react\";\r\n\r\nimport { LiquityStoreState, LQTYStake } from \"@liquity/lib-base\";\r\nimport { LiquityStoreUpdate, useLiquityReducer } from \"@liquity/lib-react\";\r\n\r\nimport { useMyTransactionState } from \"../../Transaction\";\r\n\r\nimport { StakingViewAction, StakingViewContext } from \"./StakingViewContext\";\r\n\r\ntype StakingViewProviderAction =\r\n  | LiquityStoreUpdate\r\n  | StakingViewAction\r\n  | { type: \"startChange\" | \"abortChange\" };\r\n\r\ntype StakingViewProviderState = {\r\n  lqtyStake: LQTYStake;\r\n  changePending: boolean;\r\n  adjusting: boolean;\r\n};\r\n\r\nconst init = ({ lqtyStake }: LiquityStoreState): StakingViewProviderState => ({\r\n  lqtyStake,\r\n  changePending: false,\r\n  adjusting: false\r\n});\r\n\r\nconst reduce = (\r\n  state: StakingViewProviderState,\r\n  action: StakingViewProviderAction\r\n): StakingViewProviderState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  switch (action.type) {\r\n    case \"startAdjusting\":\r\n      return { ...state, adjusting: true };\r\n\r\n    case \"cancelAdjusting\":\r\n      return { ...state, adjusting: false };\r\n\r\n    case \"startChange\":\r\n      return { ...state, changePending: true };\r\n\r\n    case \"abortChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        oldState: { lqtyStake: oldStake },\r\n        stateChange: { lqtyStake: updatedStake }\r\n      } = action;\r\n\r\n      if (updatedStake) {\r\n        const changeCommitted =\r\n          !updatedStake.stakedLQTY.eq(oldStake.stakedLQTY) ||\r\n          updatedStake.collateralGain.lt(oldStake.collateralGain) ||\r\n          updatedStake.lusdGain.lt(oldStake.lusdGain);\r\n\r\n        return {\r\n          ...state,\r\n          lqtyStake: updatedStake,\r\n          adjusting: false,\r\n          changePending: changeCommitted ? false : state.changePending\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const StakingViewProvider: React.FC = ({ children }) => {\r\n  const stakingTransactionState = useMyTransactionState(\"stake\");\r\n  const [{ adjusting, changePending, lqtyStake }, dispatch] = useLiquityReducer(reduce, init);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      stakingTransactionState.type === \"waitingForApproval\" ||\r\n      stakingTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (\r\n      stakingTransactionState.type === \"failed\" ||\r\n      stakingTransactionState.type === \"cancelled\"\r\n    ) {\r\n      dispatch({ type: \"abortChange\" });\r\n    }\r\n  }, [stakingTransactionState.type, dispatch]);\r\n\r\n  return (\r\n    <StakingViewContext.Provider\r\n      value={{\r\n        view: adjusting ? \"ADJUSTING\" : lqtyStake.isEmpty ? \"NONE\" : \"ACTIVE\",\r\n        changePending,\r\n        dispatch\r\n      }}\r\n    >\r\n      {children}\r\n    </StakingViewContext.Provider>\r\n  );\r\n};\r\n","type InactiveView = \"INACTIVE\";\r\ntype StakingView = \"STAKING\";\r\ntype ActiveView = \"ACTIVE\";\r\ntype AdjustingView = \"ADJUSTING\";\r\ntype DisabledView = \"DISABLED\";\r\n\r\nexport type FarmView = InactiveView | StakingView | ActiveView | AdjustingView | DisabledView;\r\n\r\ntype StakePressedEvent = \"STAKE_PRESSED\";\r\ntype AdjustPressedEvent = \"ADJUST_PRESSED\";\r\ntype CancelPressedEvent = \"CANCEL_PRESSED\";\r\ntype StakeApprovedEvent = \"STAKE_APPROVED\";\r\ntype StakeConfirmedEvent = \"STAKE_CONFIRMED\";\r\ntype ClaimRewardConfirmedEvent = \"CLAIM_REWARD_CONFIRMED\";\r\ntype UnstakeConfirmedEvent = \"UNSTAKE_CONFIRMED\";\r\ntype UnstakeAndClaimConfirmedEvent = \"UNSTAKE_AND_CLAIM_CONFIRMED\";\r\n\r\nexport type FarmEvent =\r\n  | StakePressedEvent\r\n  | AdjustPressedEvent\r\n  | CancelPressedEvent\r\n  | StakeApprovedEvent\r\n  | StakeConfirmedEvent\r\n  | ClaimRewardConfirmedEvent\r\n  | UnstakeConfirmedEvent\r\n  | UnstakeAndClaimConfirmedEvent;\r\n\r\ntype FarmEventTransitions = Record<FarmView, Partial<Record<FarmEvent, FarmView>>>;\r\n\r\nexport const transitions: FarmEventTransitions = {\r\n  INACTIVE: {\r\n    STAKE_PRESSED: \"STAKING\"\r\n  },\r\n  STAKING: {\r\n    CANCEL_PRESSED: \"INACTIVE\",\r\n    STAKE_CONFIRMED: \"ACTIVE\",\r\n    STAKE_APPROVED: \"STAKING\"\r\n  },\r\n  ACTIVE: {\r\n    ADJUST_PRESSED: \"ADJUSTING\",\r\n    CLAIM_REWARD_CONFIRMED: \"ACTIVE\",\r\n    UNSTAKE_AND_CLAIM_CONFIRMED: \"INACTIVE\"\r\n  },\r\n  ADJUSTING: {\r\n    CANCEL_PRESSED: \"ACTIVE\",\r\n    STAKE_CONFIRMED: \"ACTIVE\",\r\n    STAKE_APPROVED: \"ADJUSTING\",\r\n    UNSTAKE_CONFIRMED: \"ACTIVE\"\r\n  },\r\n  DISABLED: {\r\n    CLAIM_REWARD_CONFIRMED: \"DISABLED\",\r\n    UNSTAKE_AND_CLAIM_CONFIRMED: \"DISABLED\"\r\n  }\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { LiquityStoreState, Decimal } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { FarmViewContext } from \"./FarmViewContext\";\r\nimport { transitions } from \"./transitions\";\r\nimport type { FarmView, FarmEvent } from \"./transitions\";\r\n\r\nconst transition = (view: FarmView, event: FarmEvent): FarmView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nconst getInitialView = (\r\n  liquidityMiningStake: Decimal,\r\n  remainingLiquidityMiningLQTYReward: Decimal,\r\n  liquidityMiningLQTYReward: Decimal\r\n): FarmView => {\r\n  if (remainingLiquidityMiningLQTYReward.isZero) return \"DISABLED\";\r\n  if (liquidityMiningStake.isZero && liquidityMiningLQTYReward.isZero) return \"INACTIVE\";\r\n  return \"ACTIVE\";\r\n};\r\n\r\nconst selector = ({\r\n  liquidityMiningStake,\r\n  remainingLiquidityMiningLQTYReward,\r\n  liquidityMiningLQTYReward\r\n}: LiquityStoreState) => ({\r\n  liquidityMiningStake,\r\n  remainingLiquidityMiningLQTYReward,\r\n  liquidityMiningLQTYReward\r\n});\r\n\r\nexport const FarmViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const {\r\n    liquidityMiningStake,\r\n    remainingLiquidityMiningLQTYReward,\r\n    liquidityMiningLQTYReward\r\n  } = useLiquitySelector(selector);\r\n\r\n  const [view, setView] = useState<FarmView>(\r\n    getInitialView(\r\n      liquidityMiningStake,\r\n      remainingLiquidityMiningLQTYReward,\r\n      liquidityMiningLQTYReward\r\n    )\r\n  );\r\n  const viewRef = useRef<FarmView>(view);\r\n\r\n  const dispatchEvent = useCallback((event: FarmEvent) => {\r\n    const nextView = transition(viewRef.current, event);\r\n\r\n    console.log(\r\n      \"dispatchEvent() [current-view, event, next-view]\",\r\n      viewRef.current,\r\n      event,\r\n      nextView\r\n    );\r\n    setView(nextView);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    if (liquidityMiningStake.isZero && liquidityMiningLQTYReward.isZero) {\r\n      dispatchEvent(\"UNSTAKE_AND_CLAIM_CONFIRMED\");\r\n    } else if (liquidityMiningStake.isZero && !liquidityMiningLQTYReward.isZero) {\r\n      dispatchEvent(\"UNSTAKE_CONFIRMED\");\r\n    }\r\n  }, [liquidityMiningStake.isZero, liquidityMiningLQTYReward.isZero, dispatchEvent]);\r\n\r\n  const provider = {\r\n    view,\r\n    dispatchEvent\r\n  };\r\n\r\n  return <FarmViewContext.Provider value={provider}>{children}</FarmViewContext.Provider>;\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Container } from \"theme-ui\";\r\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport { Wallet } from \"@ethersproject/wallet\";\r\n\r\nimport { Decimal, Difference, Trove } from \"@liquity/lib-base\";\r\nimport { LiquityStoreProvider } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"./hooks/LiquityContext\";\r\nimport { TransactionMonitor } from \"./components/Transaction\";\r\nimport { UserAccount } from \"./components/UserAccount\";\r\nimport { SystemStatsPopup } from \"./components/SystemStatsPopup\";\r\nimport { Header } from \"./components/Header\";\r\n\r\nimport { PageSwitcher } from \"./pages/PageSwitcher\";\r\nimport { Farm } from \"./pages/Farm\";\r\nimport { RiskyTrovesPage } from \"./pages/RiskyTrovesPage\";\r\nimport { RedemptionPage } from \"./pages/RedemptionPage\";\r\n\r\nimport { TroveViewProvider } from \"./components/Trove/context/TroveViewProvider\";\r\nimport { StabilityViewProvider } from \"./components/Stability/context/StabilityViewProvider\";\r\nimport { StakingViewProvider } from \"./components/Staking/context/StakingViewProvider\";\r\nimport { FarmViewProvider } from \"./components/Farm/context/FarmViewProvider\";\r\n\r\ntype LiquityFrontendProps = {\r\n  loader?: React.ReactNode;\r\n};\r\nexport const LiquityFrontend: React.FC<LiquityFrontendProps> = ({ loader }) => {\r\n  const { account, provider, liquity } = useLiquity();\r\n\r\n  // For console tinkering ;-)\r\n  Object.assign(window, {\r\n    account,\r\n    provider,\r\n    liquity,\r\n    Trove,\r\n    Decimal,\r\n    Difference,\r\n    Wallet\r\n  });\r\n\r\n  return (\r\n    <LiquityStoreProvider {...{ loader }} store={liquity.store}>\r\n      <Router>\r\n        <TroveViewProvider>\r\n          <StabilityViewProvider>\r\n            <StakingViewProvider>\r\n              <FarmViewProvider>\r\n                <Flex sx={{ flexDirection: \"column\", minHeight: \"100%\" }}>\r\n                  <Header>\r\n                    <UserAccount />\r\n                    <SystemStatsPopup />\r\n                  </Header>\r\n\r\n                  <Container\r\n                    variant=\"main\"\r\n                    sx={{\r\n                      display: \"flex\",\r\n                      flexGrow: 1,\r\n                      flexDirection: \"column\",\r\n                      alignItems: \"center\"\r\n                    }}\r\n                  >\r\n                    <Switch>\r\n                      <Route path=\"/\" exact>\r\n                        <PageSwitcher />\r\n                      </Route>\r\n                      <Route path=\"/farm\">\r\n                        <Farm />\r\n                      </Route>\r\n                      <Route path=\"/risky-troves\">\r\n                        <RiskyTrovesPage />\r\n                      </Route>\r\n                      <Route path=\"/redemption\">\r\n                        <RedemptionPage />\r\n                      </Route>\r\n                    </Switch>\r\n                  </Container>\r\n                </Flex>\r\n              </FarmViewProvider>\r\n            </StakingViewProvider>\r\n          </StabilityViewProvider>\r\n        </TroveViewProvider>\r\n      </Router>\r\n      <TransactionMonitor />\r\n    </LiquityStoreProvider>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Web3ReactProvider } from \"@web3-react/core\";\r\nimport { Flex, Spinner, Heading, ThemeProvider, Paragraph, Link } from \"theme-ui\";\r\n\r\nimport { BatchedWebSocketAugmentedWeb3Provider } from \"@liquity/providers\";\r\nimport { LiquityProvider } from \"./hooks/LiquityContext\";\r\nimport { WalletConnector } from \"./components/WalletConnector\";\r\nimport { TransactionProvider } from \"./components/Transaction\";\r\nimport { Icon } from \"./components/Icon\";\r\nimport { getConfig } from \"./config\";\r\nimport theme from \"./theme\";\r\n\r\nimport { DisposableWalletProvider } from \"./testUtils/DisposableWalletProvider\";\r\nimport { LiquityFrontend } from \"./LiquityFrontend\";\r\n\r\nif (window.ethereum) {\r\n  // Silence MetaMask warning in console\r\n  Object.assign(window.ethereum, { autoRefreshOnNetworkChange: false });\r\n}\r\n\r\nif (process.env.REACT_APP_DEMO_MODE === \"true\") {\r\n  const ethereum = new DisposableWalletProvider(\r\n    `http://${window.location.hostname}:8545`,\r\n    \"0x4d5db4107d237df6a3d58ee5f70ae63d73d7658d4026f2eefd2f204c81682cb7\"\r\n  );\r\n\r\n  Object.assign(window, { ethereum });\r\n}\r\n\r\n// Start pre-fetching the config\r\ngetConfig().then(config => {\r\n  // console.log(\"Frontend config:\");\r\n  // console.log(config);\r\n  Object.assign(window, { config });\r\n});\r\n\r\nconst EthersWeb3ReactProvider: React.FC = ({ children }) => {\r\n  return (\r\n    <Web3ReactProvider getLibrary={provider => new BatchedWebSocketAugmentedWeb3Provider(provider)}>\r\n      {children}\r\n    </Web3ReactProvider>\r\n  );\r\n};\r\n\r\nconst UnsupportedMainnetFallback: React.FC = () => (\r\n  <Flex\r\n    sx={{\r\n      flexDirection: \"column\",\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      height: \"100vh\",\r\n      textAlign: \"center\"\r\n    }}\r\n  >\r\n    <Heading sx={{ mb: 3 }}>\r\n      <Icon name=\"exclamation-triangle\" /> Your network is incorrect.\r\n    </Heading>\r\n\r\n    <Paragraph sx={{ mb: 3 }}>\r\n      Please change your network to Mainnet Ethereum, Ropsten, Rinkeby, Kovan, Grli or Kiln.\r\n    </Paragraph>\r\n\r\n    <Paragraph>\r\n      For instructions on changing your network with Metamask, follow article\r\n      <Link href=\"https://metaschool.so/articles/how-to-change-add-new-network-metamask-wallet/\">\r\n        here <Icon name=\"external-link-alt\" size=\"xs\" />\r\n      </Link>\r\n      .\r\n    </Paragraph>\r\n  </Flex>\r\n);\r\n\r\nconst App = () => {\r\n  const loader = (\r\n    <Flex sx={{ alignItems: \"center\", justifyContent: \"center\", height: \"100vh\" }}>\r\n      <Spinner sx={{ m: 2, color: \"text\" }} size=\"32px\" />\r\n      <Heading>Loading...</Heading>\r\n    </Flex>\r\n  );\r\n\r\n  const unsupportedNetworkFallback = (chainId: number) => (\r\n    <Flex\r\n      sx={{\r\n        flexDirection: \"column\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        height: \"100vh\",\r\n        textAlign: \"center\"\r\n      }}\r\n    >\r\n      <Heading sx={{ mb: 3 }}>\r\n        <Icon name=\"exclamation-triangle\" /> Liquity is not yet deployed to{\" \"}\r\n        {chainId === 1 ? \"mainnet\" : \"this network\"}.\r\n      </Heading>\r\n      Please switch to Mainnet Ethereum, Ropsten, Rinkeby, Kovan, Grli or Kiln.\r\n      <Paragraph>\r\n        For instructions on changing your network with Metamask, you can follow &nbsp;\r\n        <Link href=\"https://metaschool.so/articles/how-to-change-add-new-network-metamask-wallet/\">\r\n           this article <Icon name=\"external-link-alt\" size=\"xs\" />\r\n        </Link>\r\n        .\r\n      </Paragraph>\r\n    </Flex>\r\n  );\r\n\r\n  return (\r\n    <EthersWeb3ReactProvider>\r\n      <ThemeProvider theme={theme}>\r\n        <WalletConnector loader={loader}>\r\n          <LiquityProvider\r\n            loader={loader}\r\n            unsupportedNetworkFallback={unsupportedNetworkFallback}\r\n            unsupportedMainnetFallback={<UnsupportedMainnetFallback />}\r\n          >\r\n            <TransactionProvider>\r\n              <LiquityFrontend loader={loader} />\r\n            </TransactionProvider>\r\n          </LiquityProvider>\r\n        </WalletConnector>\r\n      </ThemeProvider>\r\n    </EthersWeb3ReactProvider>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}