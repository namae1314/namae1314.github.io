{"version":3,"sources":["../../../src/EthersLiquityConnection.ts","../../../src/Decimal.ts","../../index.ts","../../../src/_utils.ts","../../../src/constants.ts","../../../../src/hooks/useLiquityStore.ts","../../../src/WebSocketAugmentedProvider.ts","../../../src/WebSocketProvider.ts","../../../src/contracts.ts","../../../src/ReadableEthersLiquity.ts","../../../src/BlockPolledLiquityStore.ts","../../../src/PopulatableEthersLiquity.ts","../../../src/SendableEthersLiquity.ts","../../../../src/components/LiquityStoreProvider.tsx","../../../../src/utils/equals.ts","testUtils/DisposableWalletProvider.ts","../../../src/BatchedProvider.ts","../../../src/Trove.ts","../../../src/StabilityDeposit.ts","../../../src/LQTYStake.ts","../../../src/Fees.ts","../../../src/TransactableLiquity.ts","../../../src/SendableLiquity.ts","../../../src/LiquityStore.ts","../../../src/_CachedReadableLiquity.ts","../../../src/_Multicall.ts","../../../src/ObservableEthersLiquity.ts","../../../src/parseLogs.ts","../../../src/EthersLiquity.ts","../../../../src/hooks/useLiquityReducer.ts","../../../../src/hooks/useLiquitySelector.ts","config/index.ts","hooks/LiquityContext.tsx","connectors/injectedConnector.ts","components/Icon.tsx","components/Dialog.tsx","components/RetryDialog.tsx","components/WaitingDialog.tsx","components/ConnectionConfirmationDialog.tsx","components/MetaMaskIcon.tsx","components/Modal.tsx","components/WalletConnector.tsx","hooks/useAuthorizedConnection.ts","components/Tooltip.tsx","components/TransactionStatus.tsx","components/Transaction.tsx","theme.ts","strings.ts","utils/shortenAddress.ts","components/Bonds/lexicon.ts","components/Bonds/context/BondViewContext.tsx","components/Bonds/context/BondAddressesContext.tsx","components/UserAccount.tsx","components/InfoIcon.tsx","components/Statistic.tsx","lexicon.ts","components/SystemStats.tsx","components/SystemStatsPopup.tsx","components/LiquityLogo.tsx","components/Link.tsx","components/Nav.tsx","components/SideNav.tsx","components/Header.tsx","components/ActionDescription.tsx","components/Trove/Editor.tsx","components/LoadingOverlay.tsx","components/Trove/CollateralRatio.tsx","components/Trove/TroveEditor.tsx","components/Trove/TroveAction.tsx","components/Trove/context/TroveViewContext.tsx","components/ErrorDescription.tsx","components/Trove/validation/validateTroveChange.tsx","components/Trove/TroveManager.tsx","components/Trove/ReadOnlyTrove.tsx","components/InfoMessage.tsx","components/Trove/NoTrove.tsx","hooks/useStableTroveChange.ts","components/Warning.tsx","components/Trove/ExpensiveTroveChangeWarning.tsx","components/Trove/Opening.tsx","components/Trove/Adjusting.tsx","components/CollateralSurplusAction.tsx","components/Trove/RedeemedTrove.tsx","components/Trove/LiquidatedTrove.tsx","components/Trove/Trove.tsx","components/Stability/StabilityDepositEditor.tsx","components/Stability/StabilityDepositAction.tsx","components/Stability/context/StabilityViewContext.tsx","components/Stability/StabilityActionDescription.tsx","components/Stability/validation/validateStabilityDepositChange.tsx","components/Stability/StabilityDepositManager.tsx","components/Stability/actions/ClaimAndMove.tsx","components/Stability/actions/ClaimRewards.tsx","components/Stability/RemainingLQTY.tsx","components/Badge.tsx","components/Stability/context/fetchLqtyPrice.ts","components/Stability/Yield.tsx","components/Stability/ActiveDeposit.tsx","components/Stability/NoDeposit.tsx","components/Stability/Stability.tsx","components/PriceManager.tsx","components/Staking/context/StakingViewContext.tsx","components/Staking/StakingGainsAction.tsx","components/Staking/ReadOnlyStake.tsx","components/Staking/StakingEditor.tsx","components/Staking/StakingManagerAction.tsx","components/Staking/StakingManager.tsx","components/Staking/NoStake.tsx","components/Staking/Staking.tsx","components/Bonds/views/idle/Empty.tsx","components/Bonds/views/InfiniteEstimation.tsx","components/Bonds/BondsTable.tsx","pages/Dashboard.tsx","pages/UnregisteredFrontend.tsx","pages/FrontendRegistration.tsx","pages/FrontendRegistrationSuccess.tsx","pages/PageSwitcher.tsx","components/LiquidationManager.tsx","components/Abbreviation.tsx","components/RiskyTroves.tsx","pages/RiskyTrovesPage.tsx","components/TreasuryChart.tsx","components/BondStats.tsx","components/Placeholder.tsx","components/HorizontalTimeline.tsx","components/Bonds/Record.tsx","components/Bonds/views/idle/actions/Actions.tsx","components/Bonds/context/transitions.ts","components/Bonds/views/idle/Bond.tsx","components/Bonds/views/idle/OptimisticBond.tsx","components/Bonds/views/idle/FilteredBondList.tsx","components/Bonds/views/idle/BondList.tsx","components/Bonds/views/idle/Idle.tsx","components/Bonds/views/actioning/actions/cancel/Cancel.tsx","components/Bonds/views/actioning/actions/claim/Claim.tsx","components/ReactModal.tsx","components/Bonds/utils.ts","components/Bonds/views/actioning/Actioning.tsx","components/Wizard/Context.tsx","components/Wizard/Wizard.tsx","components/ModalWizard.tsx","components/Bonds/context/api.ts","hooks/useTransaction.ts","hooks/useContract.ts","components/Bonds/context/useBondContracts.tsx","components/Bonds/context/BondViewProvider.tsx","components/HorizontalSlider.tsx","components/Bonds/views/creating/Details.tsx","components/Bonds/views/creating/Information.tsx","components/Bonds/views/creating/Creating.tsx","components/Bonds/views/swapping/SwapPane.tsx","components/Bonds/views/swapping/Swapping.tsx","components/Bonds/views/managing/PoolBalance.tsx","components/Bonds/views/managing/PoolDetails.tsx","components/Bonds/views/managing/DepositPane.tsx","components/Bonds/views/managing/WithdrawPane.tsx","components/Bonds/views/managing/StakePane.tsx","components/Bonds/views/managing/PendingRewards.tsx","components/Bonds/views/managing/UnstakePane.tsx","components/Bonds/views/managing/RewardsPane.tsx","components/Bonds/views/managing/ManagingLiquidity.tsx","components/Bonds/Bonds.tsx","pages/Bonds.tsx","components/Trove/context/TroveViewProvider.tsx","components/Stability/context/StabilityViewProvider.tsx","components/Staking/context/StakingViewProvider.tsx","components/Bonds/context/BondsProvider.tsx","LiquityFrontend.tsx","components/AppLoader.tsx","App.tsx","index.tsx"],"names":["__exportStar","exports","WebSocketProvider","address","overrides","DisposableWalletProvider","constructor","url","funderPrivateKey","ethAmount","id","wallet","funderWallet","haveFunded","this","Wallet","createRandom","Decimal","from","findWallet","find","toLowerCase","Error","send","to","value","hex","gas","hexlify","method","params","fund","privateKeyWithout0xPrefix","privateKey","slice","Buffer","signTypedData","data","JSON","parse","version","SignTypedDataVersion","V4","Promise","all","map","async","nonce","rest","undefined","signTransaction","gasLimit","response","fetch","headers","body","stringify","jsonrpc","json","error","message","Object","assign","result","request","a","readable","defaultConfig","frontendTag","AddressZero","hasKey","o","k","parseConfig","config","isAddress","getAddress","console","log","infuraApiKey","testnetOnly","configPromise","fetchConfig","ok","status","getConfig","LiquityContext","createContext","webSocketSupportedNetworks","LiquityProvider","children","loader","unsupportedNetworkFallback","unsupportedMainnetFallback","useWeb3React","provider","library","account","chainId","useState","setConfig","connection","useMemo","_connectByChainId","getSigner","userAddress","useStore","useEffect","then","isBatchedProvider","isWebSocketAugmentedProvider","network","getNetwork","name","includes","openWebSocket","wsParams","_isDev","window","location","hostname","closeWebSocket","liquity","EthersLiquity","_from","store","logging","Provider","useLiquity","liquityContext","useContext","injectedConnector","InjectedConnector","add","faCircleNotch","faCheck","faCheckCircle","faExclamationTriangle","faInfoCircle","faTimes","faTrash","faChartLine","faRedo","faHistory","faChevronLeft","faChevronRight","faClipboard","faClipboardCheck","faUserCircle","faWallet","faExternalLinkAlt","faCog","faPlug","faExclamationCircle","faAngleUp","faAngleDoubleUp","faAngleDown","faAngleDoubleDown","faPen","faHandPaper","faHeartbeat","faBars","faQuestionCircle","faArrowDown","getIcon","Icon","style","icon","iconFromIntent","intent","color","aria-label","Dialog","title","cancelLabel","onCancel","sx","p","borderRadius","height","bg","justifyContent","alignItems","borderBottom","borderColor","pb","as","textAlign","fontSize","px","variant","onClick","size","RetryDialog","retryLabel","onRetry","borderTop","flexDirection","mr","mb","width","WaitingDialog","waitReason","ConnectionConfirmationDialog","fontWeight","MetaMaskIcon","viewBox","fill","xmlns","d","x","y","Modal","connectionReducer","state","action","type","connector","match","warn","WalletConnector","activate","deactivate","active","triedAuthorizedConnection","tried","setTried","isAuthorized","tryToActivateIfAuthorized","useAuthorizedConnection","useReducer","connectionState","dispatch","isMetaMask","ethereum","detectMetaMask","ml","lineHeight","href","target","LearnMoreLink","link","Tooltip","placement","interactive","content","mt","circularProgressbarStyle","strokeLinecap","pathColor","trailColor","slowProgress","strokeWidth","styles","buildStyles","pathTransitionDuration","fastProgress","Donut","memo","CircularProgressbarWithChildren","TransactionProgressDonut","setValue","setTimeout","maxValue","spin","TransactionStatus","pl","position","bottom","overflow","TransactionContext","React","TransactionProvider","transactionState","useTransactionState","useMyTransactionState","myId","useTransactionFunction","setTransactionState","useCallback","tx","hasMessage","Transaction","tooltip","tooltipPlacement","showFailure","requires","sendTransaction","trigger","Children","only","failureReasons","filter","requirement","reason","push","clonedTrigger","length","cloneElement","disabled","TransactionMonitor","cancelled","finished","txHash","rawSentTransaction","hash","waitForConfirmation","receipt","waitForReceipt","confirmations","rawReceipt","blockNumber","call","hexDataLength","hexDataSlice","defaultAbiCoder","decode","tryToGetRevertReason","rawError","EthersTransactionCancelledError","baseColors","colors","primary","secondary","accent","success","warning","danger","dangerHover","info","invalid","text","background","muted","highlight","buttonBase","display","cursor","button","py","border","opacity","buttonOutline","hoverColor","iconButton","padding","cardHeadingFontSize","cardGapX","cardGapY","card","boxShadow","infoCard","h2","formBase","flexShrink","formCell","modalOverlay","left","top","headerGradient","theme","breakpoints","space","fonts","join","heading","monospace","fontSizes","fontWeights","light","medium","bold","lineHeights","borders","shadows","fontFamily","buttons","outline","cancel","dangerIcon","titleIcon","close","cards","pr","infoPopup","right","overflowY","marginY","forms","label","radioLabel","svg","unit","input","flex","editor","layout","header","zIndex","footer","minHeight","main","maxWidth","mx","columns","flexWrap","justifyItems","actions","disabledOverlay","modal","infoOverlay","infoMessage","m","minWidth","sidenav","badge","backgroundColor","root","textDecoration","progress","links","nav","textTransform","letterSpacing","COIN","GT","shortenAddress","substr","PENDING_BONDS","term","description","BONDS","NOT_BONDED_YET","BONDS_NAVIGATION","BOND_CREATED","AVAILABLE_BONDS","BOND_ASSET","BOND_NFT","BREAK_EVEN_TIME","OPTIMUM_REBOND_TIME","REBOND_RETURN","REBOND_TIME_ROI","OPTIMUM_APY","OPTIMUM_ACCRUAL","BOND_DEPOSIT","ACCRUED_AMOUNT","MARKET_VALUE","BOND_AGE","BOND_RETURN","BOND_STATUS","PENDING_STATUS","CANCELLED_STATUS","CLAIMED_STATUS","CANCEL_BOND","CLAIM_BOND","BLUSD_MARKET_PRICE","BLUSD_FAIR_PRICE","TOTAL_BONDS_STATISTIC","PENDING_BONDS_STATISTIC","CANCELLED_BONDS_STATISTIC","CLAIMED_BONDS_STATISTIC","BLUSD_SUPPLY","BLUSD_FLOOR_PRICE","BLUSD_WIND_DOWN_PRICE","BLUSD_APR","BLUSD_LP_APR","BLUSD_YIELD_AMPLIFICATION","TREASURY_TOTAL","TREASURY_PENDING","TREASURY_ACQUIRED","TREASURY_PERMANENT","ESTIMATES_ONLY_NOTICE","INFINITE_ESTIMATION","BondViewContext","useBondView","context","statuses","PENDING","CANCELLED","CLAIMED","NON_EXISTENT","nullAddresses","BLUSD_AMM_ADDRESS","BLUSD_AMM_STAKING_ADDRESS","BLUSD_TOKEN_ADDRESS","BOND_NFT_ADDRESS","CHICKEN_BOND_MANAGER_ADDRESS","LUSD_OVERRIDE_ADDRESS","BLUSD_LP_ZAP_ADDRESS","chainIdAddressesMap","1","mainnet","5","goerli","BondAddressesContext","useBondAddresses","BondAddressesProvider","addresses","select","accountBalance","lusdBalance","lqtyBalance","UserAccount","useLiquitySelector","realLusdBalance","bLusdBalance","customLusdBalance","i","currency","balance","prettify","InfoIcon","Statistic","lexicon","BORROW_FEE","TVL","STAKED_LQTY","TCR","RECOVERY_MODE","STABILITY_POOL_LUSD","KICKBACK_RATE","ETH","LUSD","LQTY","TROVES","LUSD_SUPPLY","selectBalances","Balances","l","GitHubCommit","numberOfTroves","price","total","lusdInStabilityPool","borrowingRate","redemptionRate","totalStakedLQTY","frontend","kickbackRate","SystemStats","showBalances","contractsVersion","deploymentDate","lusdInStabilityPoolPct","debt","nonZero","Percent","div","totalCollateralRatioPct","collateralRatio","borrowingFeePct","kickbackRatePct","mul","toString","collateral","shorten","collateralRatioIsBelowCritical","toLocaleString","process","SystemStatsPopup","systemStatsOpen","setSystemStatsOpen","systemStatsOverlayRef","useRef","pt","ref","e","current","LiquityLogo","boxProps","src","ExactLink","props","exact","Link","TemporaryNewBadge","Date","Nav","SideNav","isVisible","setIsVisible","overlay","Header","isFrontendRegistered","borderLeft","ActionDescription","Amount","whiteSpace","Row","labelId","labelFor","infoIcon","htmlFor","PendingAmount","startsWith","StaticAmounts","inputId","labelledBy","amount","pendingAmount","pendingColor","aria-labelledby","staticStyle","flexGrow","editableStyle","StaticRow","DisabledEditableAmounts","DisabledEditableRow","EditableRow","editingState","editedAmount","setEditedAmount","maxAmount","maxedOut","editing","setEditing","setInvalid","autoFocus","step","defaultValue","onChange","onBlur","event","stopPropagation","LoadingOverlay","CollateralRatio","change","collateralRatioPct","changePct","gt","CRITICAL_COLLATERAL_RATIO","lte","positive","absoluteValue","negative","nonZeroish","lt","TroveEditor","original","edited","fee","changePending","feePct","originalCollateralRatio","isEmpty","collateralRatioChange","Difference","between","LUSD_LIQUIDATION_RESERVE","TroveAction","transactionId","maxBorrowingRate","borrowingFeeDecayToleranceMinutes","openTrove","bind","closeTrove","adjustTrove","TroveViewContext","useTroveView","ErrorDescription","mcrPercent","MINIMUM_COLLATERAL_RATIO","ccrPercent","TroveChangeDescription","depositCollateral","borrowLUSD","repayLUSD","withdrawCollateral","selectForTroveChangeValidation","validateTroveChange","originalTrove","adjustedTrove","selectedState","whatChanged","resultingTrove","apply","recoveryMode","wouldTriggerRecoveryMode","subtract","LUSD_MINIMUM_DEBT","errorDescription","validateTroveCreation","validateTroveClosure","validateTroveAdjustment","LUSD_MINIMUM_NET_DEBT","isOpenableInRecoveryMode","collateralRatioIsBelowMinimum","sub","init","trove","Trove","debtDirty","addedMinimumDebt","reduceWith","reduce","addMinimumDebt","removeMinimumDebt","finishChange","revert","newCollateral","newValue","newState","setCollateral","isZero","setDebt","changeCommitted","stateChange","troveBeforeRedistribution","feeFrom","ZERO","fees","validationContext","transactionIdPrefix","transactionIdMatcher","RegExp","TroveManager","useLiquityReducer","validChange","dispatchEvent","handleCancel","openingNewTrove","myTransactionState","ReadOnlyTrove","handleAdjustTrove","handleCloseTrove","InfoMessage","NoTrove","handleOpenTrove","paramsEq","b","eq","useStableTroveChange","troveChange","stableTroveChange","setStableTroveChange","Warning","ExpensiveTroveChangeWarning","gasEstimationState","setGasEstimationState","timeoutId","populate","populatedTx","rawPopulatedTransaction","clearTimeout","gasHeadroom","selector","EMPTY_TROVE","TRANSACTION_ID","GAS_ROOM_ETH","Opening","borrowAmount","setBorrowAmount","totalDebt","isDirty","maxCollateral","collateralMaxedOut","isTransactionPending","handleCancelPressed","reset","Adjusting","previousTrove","netDebt","setNetDebt","nextCollateral","unsavedChanges","applyUnsavedCollateralChanges","nextNetDebt","applyUnsavedNetDebtChanges","isDebtIncrease","debtIncreaseAmount","updatedTrove","availableEth","collateralSurplusBalance","CollateralSurplusAction","myTransactionId","claimCollateralSurplus","hasSurplusCollateral","RedeemedTrove","LiquidatedTrove","view","StabilityDepositEditor","originalDeposit","editedLUSD","currentLUSD","lusdInStabilityPoolAfterChange","originalPoolShare","mulDiv","newPoolShare","poolShareChange","infinite","concat","collateralGain","lqtyReward","selectFrontendRegistered","StabilityDepositAction","depositLUSD","depositLUSDInStabilityPool","withdrawLUSDFromStabilityPool","withdrawLUSD","StabilityViewContext","useStabilityView","StabilityActionDescription","selectForStabilityDepositChangeValidation","ownFrontend","haveUndercollateralizedTroves","haveOwnFrontend","stabilityDeposit","updatedDeposit","initialLUSD","StabilityDepositManager","validateStabilityDepositChange","makingNewDeposit","ClaimAndMove","transferCollateralGainToTrove","ClaimRewards","withdrawGainsFromStabilityPool","remainingStabilityPoolLQTYReward","RemainingLQTY","Badge","hasProp","validateCoinGeckoSimplePriceResponse","expectedCoinIds","expectedCurrencies","coinId","coinPrices","fetchCoinGeckoSimplePrice","coinIds","vsCurrencies","simplePriceUrl","URLSearchParams","ids","vs_currencies","accept","fetchLqtyPrice","lqtyPriceUSD","usd","dailyIssuanceFraction","dailyIssuancePercentage","Yield","lqtyPrice","setLqtyPrice","hasZeroValue","aprPercentage","remainingLqtyInUSD","ActiveDeposit","poolShare","handleAdjustDeposit","hasReward","hasGain","hasTrove","isWaitingForTransaction","NoDeposit","Stability","selectPrice","PriceManager","canSetPrice","_priceFeedIsTestnet","editedPrice","setEditedPrice","setPrice","StakingViewContext","useStakingView","selectLQTYStake","lqtyStake","StakingGainsAction","lusdGain","withdrawGainsFromStaking","ReadOnlyStake","stakedLQTY","StakingEditor","originalStake","editedLQTY","totalStakedLQTYAfterChange","StakingManagerAction","stakeLQTY","unstakeLQTY","updatedStake","selectLQTYBalance","StakingManagerActionDescription","StakingManager","dispatchStakingViewAction","makingNewStake","NoStake","Staking","Empty","InfiniteEstimate","estimate","INFINITY","BOND_AMOUNT","LineSegment","formatDays","days","parseFloat","toFixed","Line","Array","_","idx","BondsTable","bonds","hasLoaded","pendingBonds","bond","hasBonds","gap","alignContent","breakEvenDays","breakEvenTime","getTime","now","rebondDays","rebondTime","Fragment","deposit","accrued","marketValue","Dashboard","UnregisteredFrontend","FrontendRegistrationAction","registerFrontend","FrontendRegistration","setKickbackRate","cut","setCut","kickbackRateString","setKickbackRateString","newKickbackRate","newCut","ONE","FrontendRegistrationSuccess","onDismiss","selectFrontend","PageSwitcher","unregistered","registering","setRegistering","LiquidationManager","numberOfTrovesToLiquidate","setNumberOfTrovesToLiquidate","min","liquidateUpTo","parseInt","Abbreviation","short","rowHeight","liquidatableInNormalMode","liquidatableInRecoveryMode","totalCollateralRatio","gte","blockTag","RiskyTroves","pageSize","loading","setLoading","troves","setTroves","reload","setReload","forceReload","page","setPage","numberOfPages","Math","ceil","clampedPage","mounted","getTroves","first","sortedBy","startingAt","copied","setCopied","ownerAddress","onCopy","liquidate","RiskyTrovesPage","labels","RADIAN","PI","TreasuryChart","protocolInfo","treasuryChartData","buckets","treasury","pending","reserve","permanent","ResponsiveContainer","PieChart","isAnimationActive","Pie","dataKey","nameKey","cx","cy","outerRadius","midAngle","innerRadius","index","radius","cos","sin","textAnchor","dominantBaseline","strokeOpacity","Cell","percent","r","labelLine","Metric","BondStats","stats","fontweight","marketPrice","fairPrice","lower","upper","floorPriceWithoutPendingHarvests","windDownPrice","bLusdApr","bLusdSupply","bLusdLpApr","yieldAmplification","cancelledBonds","claimedBonds","totalBonds","keyframes","Placeholder","backgroundImage","animation","mutedGray","defaultCircleStyle","solidCircleStyle","transparentCircleStyle","defaultLineStyle","margin","solidLineStyle","fadeLineStyle","leftColor","rightColor","Circle","UNKNOWN_DATE","SubLabel","alignSelf","Label","LoadingEvent","my","Event","isFirst","isLast","isPast","date","isEndOfLife","isMilestone","isLoading","isToday","toLocaleDateString","isUnknownDate","toDateString","circleStyle","leftLineStyle","rightLineStyle","dateText","month","day","year","HorizontalTimeline","events","orderedEvents","sort","Number","endOfLifeIdx","findIndex","Record","Actions","bondId","isBootstrapPeriodActive","transitions","IDLE","CREATE_BOND_PRESSED","CANCEL_BOND_PRESSED","CLAIM_BOND_PRESSED","SWAP_PRESSED","MANAGE_LIQUIDITY_PRESSED","CREATING","ABORT_PRESSED","CREATE_BOND_CONFIRMED","BACK_PRESSED","CONFIRM_PRESSED","CLAIMING","CLAIM_BOND_CONFIRMED","CANCELLING","CANCEL_BOND_CONFIRMED","SWAPPING","APPROVE_PRESSED","SWAP_CONFIRMED","MANAGING_LIQUIDITY","MANAGE_LIQUIDITY_CONFIRMED","BLusdAmmTokenIndex","Bond","startTime","endTime","claimedAmount","breakEvenAccrual","rebondAccrual","getBondEvents","tokenUri","alt","open","inputToken","BLUSD","OptimisticBond","bondFilterToBondStatusMap","claimed","FilteredBondList","optimisticBond","bondFilter","useParams","showOptimisticBond","filteredBonds","getFilteredBonds","BondList","path","useRouteMatch","Idle","getLusdFromFaucet","chain","setChain","signer","getChainId","showLusdFaucet","Cancel","selectedBond","isProcessingTransaction","CANCEL","Claim","CLAIM","modalStyle","marginRight","transform","maxHeight","ReactModal","isOpen","onRequestClose","milliseconds","seconds","toFloat","decimal","numberify","bigNumber","toNumber","decimalify","fromBigNumberString","toHexString","percentify","fraction","secondsToDays","getReturn","accruedLusdValue","getBreakEvenPeriodInDays","alphaAccrualFactor","marketPricePremium","claimBondFee","effectivePremium","getFutureBLusdAccrualFactor","floorPrice","daysInFuture","bondAgeInDays","duration","getRebondPeriodInDays","sqrt","dividend","divisor","getRemainingRebondOrBreakEvenDays","bondAgeInSeconds","targetBondAgeInSeconds","averageBondAgeInSeconds","rebondOrBreakEvenPeriodInDays","daysUntilControllerStartsAdjusting","secondsUntil","daysUntil","getDaysUntilControllerStartsAdjusting","rebondOrBreakEvenDaysRemaining","lambertDividend","lambertDivisor","lambertW0","getRebondOrBreakEvenTimeWithControllerAdjustment","daysUntilBondReachesRebondOrBreakEven","round","daysToMilliseconds","Actioning","handleDismiss","claimNowReturn","rebondReturn","rebondRoi","rebondApr","WizardContext","useWizard","next","back","go","WizardProvider","onFinish","setStep","history","setHistory","nextStep","prev","component","child","Wizard","ModalWizard","LUSD_3CRV_POOL_ADDRESS","LUSD_TOKEN_ADDRESS","CURVE_REGISTRY_SWAPS_ADDRESS","TOKEN_ADDRESS_NAME_MAP","LQTY_ISSUANCE_GAS_HEADROOM","BigNumber","bLusdToLusdRoute","lusdToBLusdRoute","reverse","getRoute","constants","cachedApys","lusd3Crv","stabilityPool","bLusdLusd3Crv","cacheCurveLpApy","curvePoolDataResponse","curvePoolDetailsResponse","poolData","pool","rewardsApr","gaugeRewards","apy","baseApr","poolDetails","poolAddress","apr","cacheYearnVaultApys","yearnResponse","lusd3CrvVault","vault","token","stabilityPoolVault","net_apy","_getProtocolInfo","hasMarketPremium","breakEvenPeriodInDays","rebondPeriodInDays","breakEvenAccrualFactor","rebondAccrualFactor","marginalInputAmount","getBlusdAmmPrice","getExpectedSwapOutput","bLusdAmm","price_oracle","getBlusdAmmPriceMainnet","getExpectedSwapOutputMainnet","lusd3CrvPool","Contract","oraclePrice","marginalOutputAmount","calc_withdraw_one_coin","erc20From","tokenAddress","signerOrProvider","getOtherToken","thisToken","inputAmount","get_dy","bLusdAmmBalance","balances","reciprocal","swaps","CurveRegistrySwaps__factory","connect","api","getAccountBonds","bondNft","chickenBondManager","controllerTargetAge","averageBondAge","balanceOf","bondIdRequests","tokenOfOwnerByIndex","bondIds","bondRequests","deposits","getBondAmount","accrueds","calcAccruedBLUSD","startTimes","getBondStartTime","endTimes","getBondEndTime","getBondStatus","tokenUris","tokenURI","claimedAmounts","getBondClaimedBLUSD","bondDeposits","bondAccrueds","bondStartTimes","bondEndTimes","bondStatuses","bondTokenUris","bondClaimedAmounts","accumulator","encodedTokenUri","dataStartIndex","indexOf","hack","atob","replace","image","getTokenUri","getBondAgeInDays","remainingRebondDays","remainingBreakEvenDays","depositMinusClaimBondFee","getStats","getOpenBondCount","countChickenOut","countChickenIn","getLpToken","getTokenBalance","getTokenTotalSupply","totalSupply","getProtocolInfo","bLusdToken","isMainnet","bammLusdDebtRequest","getBAMMLUSDDebt","_treasury","protocolOwnedLusdInStabilityPool","protocolLusdInCurve","_floorPrice","totalWeightedStartTimes","getTreasury","bucket","getOwnedLUSDInSP","getTotalLUSDInCurve","calcSystemBackingRatio","CHICKEN_IN_AMM_FEE","calcUpdatedAccrualParameter","targetAverageAgeSeconds","t","bammLusdDebt","cachedApysRequests","protocolLusdInStabilityPool","totalLusdInCurve","pendingLusd","permanentLusd","getFloorPrice","pendingBucketLusd","averageStartTimeMs","getAverageBondAgeInSeconds","simulatedMarketPrice","protocolStabilityPoolYield","protocolCurveYield","createBond","lusdAmount","owner","lusdAddress","lusdToken","spender","deadline","nonces","domain","verifyingContract","signature","_signTypedData","Permit","v","s","splitSignature","gasEstimate","estimateGas","createBondWithPermit","wait","c","createdEvent","args","cancelBond","minimumLusd","chickenOut","cancelledEvent","claimBond","chickenIn","bondClaimedEvent","isTokenApprovedWithBLusdAmm","bLusdAmmAddress","allowance","MaxInt256","isTokenApprovedWithBLusdAmmMainnet","approveTokenWithBLusdAmm","approve","MaxUint256","approveTokenWithBLusdAmmMainnet","isTokenApprovedWithAmmZapper","ammZapperAddress","approveToken","spenderAddress","swapTokens","minOutputAmount","exchangeEvent","swapTokensMainnet","route","getCoinBalances","getExpectedLpTokens","bLusdAmount","bLusdZapper","expectedLpTokenAmount","getMinLPTokens","getExpectedLpTokensAmountViaZapper","addLiquidity","minLpTokens","shouldStakeInGauge","zapperFunction","getExpectedWithdrawal","burnLp","output","getMinWithdrawBalanced","Map","withdrawEstimatorFunction","getMinWithdrawLUSD","removeLiquidity","burnLpTokens","minBLusdAmount","minLusdAmount","removeLiquidityBalanced","removeLiquidityOneCoin","minAmount","removeLiquidityLUSD","removeLiquidityFunction","removeLiquidityBLUSD","stakeLiquidity","stakeAmount","bLusdGauge","depositEvent","unstakeLiquidity","unstakeAmount","withdrawEvent","getLpRewards","rewards","totalRewardTokens","reward_count","tokenIndex","reward_tokens","tokenRewards","claimable_reward","tokenName","claimLpRewards","useTransaction","transactionFunction","dependencies","setStatus","timeout","useContract","abi","contract","setContract","instance","getCode","connectedContract","ethers","BondViewProvider","setView","viewRef","selectedBondId","setSelectedBondId","setOptimisticBond","shouldSynchronize","setShouldSynchronize","setBonds","setStats","setProtocolInfo","simulatedProtocolInfo","setSimulatedProtocolInfo","lpRewards","setLpRewards","isLusdApprovedWithBlusdAmm","setIsLusdApprovedWithBlusdAmm","isBLusdApprovedWithBlusdAmm","setIsBLusdApprovedWithBlusdAmm","isLusdApprovedWithAmmZapper","setIsLusdApprovedWithAmmZapper","isBLusdApprovedWithAmmZapper","setIsBLusdApprovedWithAmmZapper","isBLusdLpApprovedWithAmmZapper","setIsBLusdLpApprovedWithAmmZapper","isBLusdLpApprovedWithGauge","setIsBLusdLpApprovedWithGauge","isSynchronizing","setIsSynchronizing","setInputToken","setStatuses","CREATE","APPROVE_AMM","APPROVE_SPENDER","SWAP","MANAGE_LIQUIDITY","setBLusdBalance","setLusdBalance","lpTokenBalance","setLpTokenBalance","stakedLpTokenBalance","setStakedLpTokenBalance","lpTokenSupply","setLpTokenSupply","bLusdAmmBLusdBalance","setBLusdAmmBLusdBalance","bLusdAmmLusdBalance","setBLusdAmmLusdBalance","setIsBootstrapPeriodActive","contracts","lusdTokenDefault","lusdTokenDefaultStatus","LUSDTokenAbi","lusdTokenOverride","lusdTokenOverrideStatus","ERC20Faucet__factory","lusdTokenStatus","bLusdTokenStatus","BLUSDToken__factory","bondNftStatus","BondNFT__factory","chickenBondManagerStatus","ChickenBondManager__factory","bLusdAmmStatus","CurveCryptoSwap2ETH__factory","bLusdAmmZapper","bLusAmmZapperStatus","BLUSDLPZap__factory","bLusdGaugeStatus","CurveLiquidityGaugeV5__factory","hasFoundContracts","getLatestData","protocolInfoPromise","bondsPromise","lpToken","lpStakingContract","bLusdAmmCoinBalances","useBondContracts","setSimulatedMarketPrice","resetSimulatedMarketPrice","removeBondFromList","nextBonds","changeBondStatusToClaimed","updatedBond","tap","isApproved","isLusdApproved","isLpApproved","isBLusdApproved","timer","latest","approveAmm","approveAmmStatus","tokensNeedingApproval","approveTokens","approveTokensStatus","BLUSD_LUSD_LP","createStatus","cancelStatus","claimStatus","swapStatus","manageLiquidity","manageLiquidityStatus","payload","isValidEvent","nextView","transition","isCurrentViewEvent","_view","_event","bootstrapPeriodMs","BOOTSTRAP_PERIOD_CHICKEN_IN","anyBondOlderThanBootstrapPeriod","isInputTokenApprovedWithBLusdAmm","__LIQUITY_BONDS__","HorizontalSlider","descriptionLink","max","onSliderChange","onReset","Details","onBack","setDeposit","depositEditingState","isConfirming","handleBack","isDepositEnough","setIsDepositEnough","doesDepositExceedBalance","setDoesDepositExceedBalance","marketPriceMin","marketPriceMax","controllerAdjustedRebondDays","timestamp","subLabel","handleDepositAmountChanged","fontStyle","InformationContainer","Information","hideMessageRef","checked","localStorage","setItem","Creating","getItem","tokenSymbol","outputToken","marginalAmount","SwapPane","inputTokenBalance","setInputAmount","outputAmount","setOutputAmount","exchangeRate","setExchangeRate","priceImpact","setPriceImpact","slippageToleranceChoice","setSlippageToleranceChoice","customSlippageTolerance","setCustomSlippageTolerance","customSlippageToleranceFocus","setCustomSlippageToleranceFocus","customSlippageToleranceRef","priceImpactPct","isApprovePending","isSwapPending","isBalanceInsufficient","isSlippageToleranceInvalid","isSlippageToleranceHigh","poolState","handleSlippageToleranceChange","checkSlippageTolerance","marginalOutput","marginalExchangeRate","placeholder","onFocus","onKeyDown","key","blur","slippageTolerance","minOutputFactor","Swapping","PoolBalance","symbol","PoolDetails","poolBalanceRatio","DepositPane","setBLusdAmount","setLusdAmount","lpTokens","setLpTokens","setShouldStakeInGauge","shouldDepositBalanced","setShouldDepositBalanced","coalescedBLusdBalance","coalescedLusdBalance","isManageLiquidityPending","isBLusdBalanceInsufficient","isLusdBalanceInsufficient","isAnyBalanceInsufficient","isDepositingLusd","isDepositingBLusd","zapperNeedsLusdApproval","zapperNeedsBLusdApproval","isApprovalNeeded","handleSetAmount","expectedLpTokens","toggle","set","WithdrawnAmount","zeros","WithdrawPane","setBurnLp","setOutput","withdrawal","setWithdrawal","coalescedLpTokenBalance","needsApproval","handleOutputChange","checkOutput","expectedWithdrawal","entries","get","StakePane","setStakeAmount","PendingRewards","reward","UnstakePane","setUnstakeAmount","coalescedStakedLpTokenBalance","RewardsPane","hasRewards","ManagingLiquidity","selectedPane","setSelectedPane","Bonds","View","statusMap","FAILED","CONFIRMED","transaction","keys","NONE","OPEN_TROVE_PRESSED","TROVE_OPENED","LIQUIDATED","TROVE_SURPLUS_COLLATERAL_CLAIMED","REDEEMED","OPENING","CANCEL_ADJUST_TROVE_PRESSED","ADJUSTING","TROVE_ADJUSTED","TROVE_CLOSED","TROVE_LIQUIDATED","TROVE_REDEEMED","CLOSING","ACTIVE","ADJUST_TROVE_PRESSED","CLOSE_TROVE_PRESSED","troveStatusEvents","closedByOwner","closedByLiquidation","closedByRedemption","TroveViewProvider","troveStatus","getInitialView","DEPOSIT_PRESSED","DEPOSITING","CANCEL_PRESSED","DEPOSIT_CONFIRMED","REWARDS_CLAIMED","ADJUST_DEPOSIT_PRESSED","DEPOSIT_EMPTIED","StabilityViewProvider","adjusting","oldStake","oldState","StakingViewProvider","stakingTransactionState","BondsProvider","LiquityFrontend","AppLoader","autoRefreshOnNetworkChange","REACT_APP_DEMO_MODE","REACT_APP_RPC_URL","EthersWeb3ReactProvider","getLibrary","BatchedWebSocketAugmentedWeb3Provider","UnsupportedMainnetFallback","App","setAppElement","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"8jBACA,IAAI,EAAJ,MAEA,OAEA,YACA,YACA,YACA,YACA,YACA,YACA,YAEA,SAGA,SAOA,SAEM,EAAM,UAEN,EAAW,UAGd,UAAQ,QAAU,WAHJ,IAId,UAAQ,QAAU,WAJJ,IAKd,UAAQ,QAAU,WALJ,IAMd,UAAO,QAAU,WANH,IAOd,UAAM,QAAU,WAPF,IAQd,UAAK,QAAU,WARD,GAUH,OAAR,OAAkB,EAAI,QAAU,GAAQ,IAiExC,EAAiB,SACrB,EACA,EACA,EACA,EAJqB,EAWrB,GACoC,IANlC,EAMkC,EANlC,eACA,EAKkC,EALlC,6BACA,EAIkC,EAJlC,8BACG,EAG+B,uFAClC,GACA,QAC4B,IAA5B,EAAe,WACd,EAAkB,SAAS,EAAe,UAE3C,MAAM,IAAI,MAAJ,iCAAoC,EAAe,WAG3D,OAAc,KACZ,WACA,SACA,aACA,aACA,eAAgB,IAAI,KAAK,GACzB,6BAA8B,UAAQ,KAAK,GAC3C,8BAA+B,UAAQ,KAAK,IACzC,GACA,IAKM,gBAAgB,SAAC,GAAD,OAC1B,EAAgD,YAEnD,IAAM,EAAe,SAAC,GAAD,OAClB,EAAgD,YAE7C,EAAwB,qBAAG,WAGpB,qBAAqB,SAChC,GAEmB,QADnB,EACmB,uDADE,SACF,OAE4D,QAF5D,EAEK,QAFL,EAEnB,EAAa,UAAW,eAAE,yBAAyB,CAAE,aAAY,KAAK,oBAAS,QAC/E,eAAa,GAAY,SAAS,GAAU,KAAK,IAGtC,iBAAiB,SAAC,GAAqD,aACjE,QADiE,EAClF,EAAW,cAAM,QAAI,QAAM,IAAI,MAAM,wCAG1B,eAAe,SAAC,GAAD,OAC1B,EAAW,UAIA,kBAAkB,SAC7B,EACA,GACU,eAC+B,QAD/B,EACK,QADL,EACD,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YAAI,QAAI,EAAW,mBAAW,QAAI,QAAM,IAAI,MAAM,gCAGlD,0BAA0B,SAAC,GAA+C,aAC/D,QAD+D,EACrF,EAAW,mBAAW,QAAI,QAAM,IAAI,MAAM,oCAG/B,cAAc,SACzB,GADyB,YAGD,IAAxB,EAAW,U,IAUA,E,8BAKX,WAAY,GAAe,wBACzB,uDAAwC,EAAxC,OACK,KAAO,0BACZ,EAAK,QAAU,EAHU,E,YALgB,QAA7C,4BAYA,IAAM,EAAuB,SAC3B,G,MAQA,MAAO,CAN0B,SAAO,SAAS,GACpB,QAA1B,EAAC,EAAiB,gBAAQ,QAAI,QAAM,IAAI,MAAM,gCAC7C,EAEW,SAAO,SAAS,GAAoB,OAAmB,IAM3D,uBAAuB,SAClC,EACA,EACA,GAHkC,OAKlC,EAAc,WAAd,IACK,EAAqB,IAD1B,QAEE,sBAAoB,EAAkB,QACtC,EACA,EACA,MAgBJ,IAAM,EAAoB,CAAC,eAiE3B,SAAgB,EACd,EACA,EACA,EACA,G,MAEM,EACgB,QADN,EACd,EAAY,UAAQ,QAAI,QAAM,IAAI,EAAwB,IAE5D,OAAO,EACL,EACA,EACA,sBAA0B,OAAN,QAAM,IAAN,IAAU,EAAU,GACxC,sBAA0B,OAAN,QAAM,IAAN,IAAU,EAAU,GACxC,EACA,GAfJ,sBAoBO,IAAM,EAAQ,2BAAG,WACtB,EACA,GAFsB,gFAIK,EAAqB,GAJ1B,SAIf,EAJe,OAIL,EAJK,+BAOgB,KAAlB,OAAd,QAAc,IAAd,OAAc,EAAd,EAAgB,aAPA,sBAQZ,IAAI,MAAM,6DARE,+BAYf,GAZe,iBAaC,EAAO,aAbR,yBAalB,YAbkB,MAWpB,GAXoB,4CAiBf,EAjBe,KAiBG,EAjBH,KAiBa,EAjBb,UAiB4B,EAAS,aAjBrC,2BAiBmD,QAjBnD,KAiB4D,EAjB5D,6FAAH,wDAAR,WAAQ,G,sOCpUrB,gBAEA,QAEM,EAAY,SAAC,GAAD,OAAuB,EAAI,IAAI,IAG3C,EAAY,GACZ,EAAM,YAAU,KAAK,GACrB,EAAM,YAAU,KAAK,IACrB,EAAS,EAAU,GAEnB,EAA6B,qCAC7B,EAAgB,MAChB,EAAa,CAAC,GAAI,IAAK,IAAK,IAAK,KAEjC,EAAa,SAAC,EAAc,GAAf,OAAgC,EAAE,IAAI,GAAG,IAAI,EAAQ,KAAK,KAAK,IAAI,IAkBzE,E,WAkBT,SAAF,EAAoB,GACd,GADkC,UAClC,EAAU,aACN,UAAI,MAAM,sCAGd,KAAC,WAAa,E,2BAdpB,WACE,OAAO,KAAK,WAAW,gB,qBAIzB,WACE,OAAO,KAAK,WAAW,a,6CA8EjB,WACN,IAAM,EAAiB,KAAK,WAAW,IAAI,GACrC,EAAW,KAAK,WAAW,IAAI,GAErC,GAAI,EAAS,SACX,OAAO,EAAe,WAEtB,IACM,EADiB,EAAS,WAAW,SAAS,EAAW,KACxB,QAAQ,EAAe,IAC9D,OAAO,EAAe,WAAa,IAAM,I,sBAIrC,SAAS,GACf,IAAM,EAAY,EAAU,GAAgB,GAAW,IAAI,GAC3D,OAAO,KAAK,WAAW,IAAI,K,oCAGrB,SAAuB,GAC7B,GAAI,EAAY,EACd,MAAM,IAAI,MAAM,kCAGlB,IAAM,EAAQ,EAAY,EAAY,KAAK,SAAS,GAAa,KAAK,WAChE,EAAiB,EAAM,IAAI,GAC3B,EAAW,EAAM,IAAI,GAE3B,GAAkB,IAAd,EACF,OAAO,EAAe,WAEtB,IACM,EADiB,EAAS,WAAW,SAAS,EAAW,KACxB,OAAO,EAAG,GACjD,OAAO,EAAe,WAAa,IAAM,I,sBAI7C,SAAS,GACP,OAAI,KAAK,SACA,cACgB,IAAd,EACF,KAAK,uBAAuB,GAE5B,KAAK,oC,sBAIhB,WAAsB,IAAb,EAAa,uDAAD,EAAC,EACe,KAAK,SAAS,GAAW,MAAM,KAD9C,SACb,EADa,KACG,EADH,KAEd,EAAuB,EAAe,QAAQ,0BAA2B,OAE/E,YAAoB,IAAb,EAAyB,EAAuB,IAAM,EAAW,I,qBAG1E,WACE,IAAM,EAAuB,KAAK,SAAS,GAAG,OACxC,EAAY,KAAK,IAAI,KAAK,OAAO,EAAuB,GAAK,GAAI,EAAW,OAAS,GAErF,EAAY,KAAK,IAAI,GAAK,EAAY,GAAK,EAAsB,GAGvE,OAFmB,KAAK,IAAI,IAAI,EAAQ,EAAU,EAAY,EAAI,KAEhD,SAAS,GAAa,EAAW,K,iBAGrD,SAAI,GACI,OAAC,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAQ,e,iBAG9D,SAAI,GACF,OAAO,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAY,e,iBAGlE,SAAI,GACF,OAAO,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAY,YAAY,IAAI,M,iBAGlF,SAAI,GAGF,OAFM,EAAI,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EAAQ,KAAK,WAAW,IAAI,GAAQ,IAAI,EAAQ,e,sBAI7D,SAAS,GAGP,OAFA,EAAU,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EACT,KAAK,WAAW,IAAI,GAAQ,IAAI,EAAQ,WAAW,IAAI,IAAM,IAAI,EAAQ,e,oBAI7E,SAAO,EAAwB,GAI7B,OAHA,EAAa,EAAQ,KAAK,IAC1B,EAAU,EAAQ,KAAK,IAEX,OACH,EAAQ,SAGV,IAAI,EAAQ,KAAK,WAAW,IAAI,EAAW,YAAY,IAAI,EAAQ,e,iBAG5E,SAAI,GAIF,GAHA,UAAO,OAAO,UAAU,IACxB,UAAO,GAAK,GAAY,GAAY,YAEnB,IAAb,EACF,OAAO,EAAQ,IAGjB,GAAiB,IAAb,EACF,OAAO,KAMT,IAHA,IAAI,EAAI,KAAK,WACT,EAAI,EAED,EAAW,EAAG,KAAc,EAClB,EAAX,IACF,EAAI,EAAW,EAAG,IAGpB,EAAI,EAAW,EAAG,GAGpB,OAAO,IAAI,EAAQ,EAAW,EAAG,M,kBAGnC,WACQ,OAAC,KAAK,WAAW,W,gBAGzB,WACE,GAAI,KAAK,OACP,OAAO,O,mBAIX,WACE,IAAK,KAAK,OACR,OAAO,O,oBAIX,WACE,GAAI,KAAK,GAAG,EAAQ,UAClB,OAAO,O,kBAIX,WACE,IAAK,KAAK,GAAG,EAAQ,UACnB,OAAO,O,yBAKX,WACE,OAAO,O,gBAGT,SAAG,GACD,OAAO,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,gBAG/C,SAAG,GACK,OAAC,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,gBAG/C,SAAG,GACD,OAAO,KAAK,WAAW,GAAG,EAAQ,KAAK,GAAM,c,iBAG/C,SAAI,GACF,OAAO,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAM,c,iBAGhD,SAAI,GACF,OAAO,KAAK,WAAW,IAAI,EAAQ,KAAK,GAAM,e,kCA5PhD,SAA2B,GACnB,OAAC,IAAI,EAAQ,YAAU,KAAK,M,yBAG5B,SAAmB,GACzB,IAAK,IAAmB,EAAe,MAAM,GAC3C,MAAM,IAAI,MAAJ,+BAAkC,EAAlC,MAGF,GAAF,EAAe,SAAS,KAAM,OAEF,EAAe,MAAM,KAFnB,SAE3B,EAF2B,KAEd,EAFc,KAIhC,OAAI,EAAS,WAAW,KACf,IAAI,EACT,EAAQ,YAAY,GAAa,WAAW,IAC1C,EAAI,IAAI,YAAU,KAAK,EAAS,OAAO,QAKzC,EAAS,WAAW,OACZ,EAAC,EAAS,OAAO,IAGtB,IAAI,EACT,EAAQ,YAAY,GAAa,WAAW,IAAI,EAAI,IAAI,YAAU,KAAK,OAI3E,IAAK,EAAe,SAAS,KAC3B,OAAO,IAAI,EAAQ,YAAU,KAAK,GAAgB,IAAI,IA3BT,MA+Bd,EAAe,MAAM,KA/BP,SA+B1C,EA/B0C,KA+B1B,EA/B0B,KAuC/C,OANI,EAAS,OAAS,EACpB,GAAY,IAAI,OAAO,EAAY,EAAS,QAE5C,EAAW,EAAS,OAAO,EAAG,GAGzB,IAAI,EACT,YAAU,KAAK,GAAkB,GAC9B,IAAI,GACJ,IAAI,M,kBAIX,SAAY,GACV,cAAe,GACb,IAAK,SACH,GAAI,aAAsB,EACxB,OAAO,EAEP,MAAM,IAAI,MAAM,4BAEpB,IAAK,SACH,OAAO,EAAQ,YAAY,GAC7B,IAAK,SACH,OAAO,EAAQ,YAAY,EAAW,YACxC,QACE,MAAM,IAAI,MAAM,+B,iBAgMtB,SAAW,EAAe,GAIxB,OAHA,EAAI,EAAQ,KAAK,GACjB,EAAI,EAAQ,KAAK,GAEV,EAAE,GAAG,GAAK,EAAI,I,iBAGvB,SAAW,EAAe,GAIxB,OAHA,EAAI,EAAQ,KAAK,GACjB,EAAI,EAAQ,KAAK,GAEV,EAAE,GAAG,GAAK,EAAI,M,KApSzB,YACkB,WAAW,EAAQ,oBA7BhB,sEA8BH,OAAO,EAAQ,KAAK,GACpB,OAAO,EAAQ,KAAK,IACpB,MAAM,EAAQ,KAAK,G,IAuSxB,E,WAGT,SAAF,EAAoB,GAAiC,UAC/C,KAAC,QAAU,E,kCA0BjB,SAAS,GACP,OAAK,KAAK,QAIH,KAAK,QAAQ,KAAO,KAAK,QAAQ,cAAc,SAAS,GAHtD,Q,sBAMX,SAAS,GACP,OAAK,KAAK,QAIH,KAAK,QAAQ,KAAO,KAAK,QAAQ,cAAc,SAAS,GAHtD,KAAK,a,iBAMhB,SAAI,GACF,OAAO,IAAI,EACT,KAAK,SAAW,CACd,KAAM,KAAK,QAAQ,KACnB,cAAe,KAAK,QAAQ,cAAc,IAAI,O,mBAKpD,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,UAAW,O,oBAGhD,W,MACE,MAA8B,OAAX,QAAZ,OAAK,eAAO,eAAE,MAAe,UAAO,I,oBAG7C,W,MACE,MAA8B,OAAX,QAAZ,OAAK,eAAO,eAAE,MAAe,UAAO,I,yBAG7C,W,MACE,OAAmB,QAAnB,EAAO,KAAK,eAAO,eAAE,gB,oBAGvB,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,WAAY,O,kBAGjD,W,MACE,OAAmB,QAAZ,OAAK,eAAO,eAAE,cAAc,SAAU,Q,sBArE/C,SAAe,EAA4B,GACzC,YAAW,IAAP,QAA2B,IAAP,EACf,IAAI,OAAW,IAGxB,EAAK,EAAQ,KAAK,GAClB,EAAK,EAAQ,KAAK,GAEd,EAAG,UAAY,EAAG,SACb,IAAI,OAAW,GACb,EAAG,SACL,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,IACzC,EAAG,SACL,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,IACzC,EAAG,GAAG,GACR,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,EAAQ,KAAK,GAAI,IAAI,KAC9D,EAAG,GAAG,GACR,IAAI,EAAW,CAAE,KAAM,IAAK,cAAe,EAAQ,KAAK,GAAI,IAAI,KAEhE,IAAI,EAAW,CAAE,KAAM,GAAI,cAAe,EAAQ,Y,KA1B/D,e,IAiFa,E,WAaX,WAAmB,GAAQ,UACzB,KAAK,SAAW,EAAM,UAAa,EAAM,KAAO,EAAM,IAAI,MAAS,E,oCAGrE,SAAW,G,MACH,EAAO,YAAQ,IAAI,OAAO,GAAnB,KAEb,GAA+B,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,GACnC,OAAO,O,sBAIX,SAAS,GACP,OACE,KAAK,SAAS,SAAS,IACtB,KAAK,SAAS,gBAAkB,KAAK,SAAS,SAAW,IAAM,M,sBAIpE,W,QACE,OAA+B,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,SAC5B,KAAK,SAAS,IACe,QAA/B,EAAI,KAAK,SAAS,qBAAa,eAAE,IAAI,OACnC,KAAK,SAAS,GAEd,KAAK,SAAS,O,KAtC3B,a,2ZC9ZA,YACA,YACA,a,gdAFA,aACE,wGAIA,mDAAE,YAAF,EAAE,IAAF,+CAGF,YACA,YACA,YACA,YACAA,EAAa,EAAb,QACAA,EAAa,EAAb,QACAA,EAAa,EAAb,S,6ICZA,WAEa,YAAY,SAAC,GAAD,OAAkC,EAAU,YAExD,aAAa,SAAC,GAAD,OACxB,UAAQ,oBAAoB,EAAU,gBAE3B,QAAQ,SAAI,GACvB,MAAM,GAMK,mBAAmB,SAAI,GAClC,IAAM,EAAO,OAAO,KAAK,GAEzB,OAAO,QAAQ,IAAI,OAAO,OAAO,IAAS,MAAK,YAAM,OACnD,OAAO,YAAY,EAAO,KAAI,SAAC,EAAO,GAAR,MAAc,CAAC,EAAK,GAAI,Y,0ZDpB1D,YAEA,YACA,YACA,a,mSEJA,aAOa,4BAA4B,UAAQ,KAAK,KAOzC,2BAA2B,UAAQ,KAAK,KAOxC,2BAA2B,UAAQ,KAAK,KAWxC,wBAAwB,UAAQ,KAAK,MAUrC,oBAAoB,2BAAyB,IAAI,yBAWjD,yBAAyB,UAAQ,KAAK,MAOtC,yBAAyB,UAAQ,KAAK,KAOtC,0BAA0B,UAAQ,KAAK,O,2GCnEpD,WAIA,SAEa,kBAAkB,WAC3B,IAAI,EAAQ,aAAW,uBAEvB,IAAG,EACH,MAAM,IAAI,MAAM,4DAGlB,OAAO,I,6QCHT,aAGA,OAEA,SAOM,EAAqC,GAE9B,+BAA+B,SAC1C,GAD0C,OAG1C,EAA4B,MAC1B,YAA0B,OAAI,aAAoB,MAGtD,IAYM,EAAoB,SAAC,GAAD,MACH,kBAAd,GAAuD,KAA7B,gBAAc,IAG3C,EAAQ,SAAC,GAAD,OAAgB,IAAI,SAAQ,YAAO,OAAI,WAAW,EAAS,OAOnE,EAAU,SAAO,GAAP,OAA0C,SAAC,GAAD,OAAuB,SAC/E,EAD+E,GAG7E,IADA,EACA,EADA,SAEI,EAAJ,GAAG,MAAK,YACE,OAAN,GAAc,KAChB,EAAE,SAKF,EAAO,SAAI,GAAF,OAAwB,SAAC,EAAM,GACxC,EAAF,KAGE,EAAW,SAAI,GAAF,OAAwB,SAAC,EAAD,GAA6C,IAApC,EAAoC,EAApC,SAC9C,EAAF,GACE,MAgBO,qBAAqB,SAAiD,GAC/E,IAAE,EAA0B,8BAAG,qC,2BAK/B,WAAa,EACP,EAAN,yBAA0B,EAEX,EAAN,gBAAkB,IAAI,IAChB,EAAN,eAAiB,EAAK,SAAS,KAAd,MATK,EAAH,uCAW5B,SAAc,EAAa,GACjB,KAAH,YAAc,IAAI,oBAAkB,EAAK,GACtC,KAAH,YAAY,QAAU,KAAK,kBAAkB,KAAK,MAC/C,KAAH,UAAY,CAAC,EAAK,GACf,KAAH,gBAfqB,+BAkB5B,WAAiB,WACP,KAAH,iBACL,QAAQ,KAAK,2DACb,KAAK,kBAAoB,YAAW,kBAAM,EAAK,cAAL,QAAI,EAAkB,EAAK,cAAa,OArBxD,4BAwB5B,WACM,KAAK,cACP,KAAK,YAAY,QAAU,KACjB,KAAL,YAAY,MAAM,KACvB,KAAK,iBAAc,EACnB,KAAK,mBAE0B,IAA3B,KAAK,oBACP,aAAa,KAAK,mBAClB,KAAK,uBAAoB,MAjCH,yBAsC5B,WACM,KAAK,gBAAgB,KAAO,IAC1B,KAAK,aACP,uCAAU,QAAS,KAAK,gBAE1B,KAAK,uBA3CmB,sBA+C5B,SAAS,GAAmB,WAC1B,KAAK,WAAa,EAEb,KAAK,0BACR,KAAK,yBAA0B,EAE/B,YAAW,WACT,EAAK,yBAA0B,EAC/B,EAAI,EAAK,iBAAiB,SAAQ,mBAAkB,EAAlB,WAA2B,EAAK,iBACjE,OAxDqB,wDA4D5B,WAAyB,EAA2B,GAApD,qEACqB,EADrB,gCAGwB,IAHxB,cAGY,EAHZ,yBAOa,GAPb,mCASU,KAAK,aAAe,IA7Hf,kBADY,EA8H0C,OA5H9C,kBAAlB,EAAM,UACZ,EAAM,QAAQ,SAEb,qBAEA,EAAM,QAAQ,SAEZ,8EA4GF,qDAeU,EArH6B,KAsGvC,yDArH0B,IAAC,IAqH3B,oBA5D4B,sGA+E5B,WACE,EACA,GAFQ,IAAV,WAAU,OAAV,oBAAY,OAAZ,6CAIiC,EAJjC,cAIQ,EAJR,OAMQ,EAAU,W,MACd,OAAgB,QAAhB,IAAK,mBAAW,eAAE,SACd,EAAK,YAAY,KAAK,EAAa,GADvC,kCAEe,EAAa,IAThC,kBAWS,IAAqB,KAAK,WAC7B,KAAK,gBAAgB,EAAS,KAAK,YACnC,KAbN,gDA/E4B,4GA+F5B,WACE,EACA,GAFF,8FAIiC,EAJjC,cAIQ,EAJR,OAMQ,EAAU,W,MACd,OAAgB,QAAhB,IAAK,mBAAW,eAAE,SACd,EAAK,YAAY,WAAW,EAAe,GAD/C,wCAEqB,EAAe,IATxC,kBAWS,IAAqB,KAAK,WAC7B,KAAK,gBAAgB,EAAS,KAAK,YACnC,KAbN,gDA/F4B,wFA+G5B,WACM,KAAK,aACP,QAAQ,IAAI,iDACZ,KAAK,YAAY,GAAG,QAAS,KAAK,kBAElC,QAAQ,IAAI,8CACZ,sCAAS,QAAS,KAAK,mBArHC,8BAyH5B,WACM,KAAK,YACP,KAAK,YAAY,IAAI,QAAS,KAAK,gBAEnC,uCAAU,QAAS,KAAK,kBA7HA,mBAiI5B,SACE,EACA,GAA4E,WAE5E,MAAO,CACL,EACA,SAAC,GAAD,OACE,EA/II,SAAI,GAAJ,OAA0B,SAAC,GACnC,YAAO,WACH,EAAJ,KACD,IA4IO,CAAM,GAAR,CAAY,EAAG,CACb,SAAU,kBAAM,EAAK,gBAAgB,IAAI,IACzC,SAAU,kBAAM,EAAK,gBAAgB,OAAO,UA1IxB,gBA+I5B,SAAG,EAAsB,GACvB,GAAI,EAAkB,GAAY,CAChC,IAAM,EAAe,KAAK,iCAAiC,KAAK,KAAM,GADtC,EAER,KAAK,MAAM,EAAU,EAAQ,IAA5C,EAFuB,UAMhC,OAFA,OAAY,GAEL,KAAK,kBAAkB,EAAU,GACnC,MAAkB,UAAd,EACF,KAAK,kBAAL,aAA0B,KAAK,MAAM,EAAU,KAEtD,sCAAgB,EAAW,KA1JH,+BA8J5B,SAAkB,EAAyB,GAQjC,OAPH,KAAK,gBAAgB,IAAI,KAC5B,KAAK,gBAAgB,IAAI,EAAK,GAEI,IAA9B,KAAK,gBAAgB,MACvB,KAAK,qBAGF,OAtKmB,kBAyK5B,SAAK,EAAsB,GACjB,GAAJ,EAAkB,GAAY,CACtB,IAAJ,EAAe,KAAK,iCAAiC,KAAK,KAAM,GADtC,EAEJ,KAAK,MAAM,GAzL7C,EAyLgE,EAAQ,GAxLxE,EAwLuF,EAvLpF,SAAC,GAAG,OAAmB,SAAC,EAAM,GAC3B,GAAJ,YAAS,OAAJ,EAAE,EAAF,CAAK,EAAG,KAAT,CAAmB,EAAG,OAsLb,EAFuB,UAMhC,OAFA,OAAgB,GAET,KAAK,kBAAkB,EAAU,GACnC,MAAkB,UAAd,EACF,KAAK,kBAAL,aAA0B,KAAK,MAAM,EAAU,KAEtD,wCAAkB,EAAW,GAlMpB,IACf,EACA,IAY8B,iBAwL5B,SAAI,EAAsB,GAChB,OAAJ,EAAkB,IAA4B,UAAd,EAC3B,KAAK,qBAAqB,GAEjC,uCAAiB,EAAW,KA5LJ,kCAgM5B,SAAqB,GAOnB,OANI,KAAK,gBAAgB,IAAI,KAC3B,KAAK,gBAAgB,OAAO,GACM,IAA9B,KAAK,gBAAgB,MACvB,KAAK,oBAGF,OAvMmB,uDA0M5B,WAAqB,GAArB,oFACQ,EADR,mDAEyB,IAFzB,UAGwB,QAAhB,OAAK,mBAAW,eAAE,SAAU,CAAC,KAAK,YAAY,eAAe,IAAoB,KAHzF,SAMsB,QAAQ,KAAK,GANnC,UAOkB,QADV,EANR,cAOkB,IAAL,EAPb,qBAOa,EAPb,wCAO6B,QAAQ,IAAI,GAPzC,oBAOsD,MAAK,YAAE,OAAW,OAAP,KAPjE,gBAOU,EAPV,UAO6E,OAP7E,sCAO6E,MAP7E,uCAO6E,EAP7E,6BAOiF,KAPjF,eAOQ,EAPR,uBASS,GATT,iDA1M4B,0FAsN5B,SAAsB,G,MACpB,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,sBAAsB,GADpC,yDAEyB,KAzNN,iCA4N5B,SACE,EACA,G,MAEA,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,oBAAoB,EAAe,GADjD,uDAEuB,EAAe,KAlOnB,sBAqO5B,SAAS,G,MACP,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,SAAS,GADvB,4CAEY,KAxOO,sCA2O5B,SAAyB,G,MACvB,OAAuB,QAAhB,OAAK,mBAAW,eAAE,SACrB,KAAK,YAAY,yBAAyB,GADvC,4DAE4B,KA9OT,yDAiP5B,WAAuB,EAAqB,GAA5C,qEAGO,EAAQ,KAHf,UAGsB,EAHtB,gCAIU,EA/R6B,KA2RvC,uBAG2C,KAAK,SAAS,GAHzD,OAG6B,EAH7B,sDAOS,EAAM,aAAa,MAAK,YAAa,OAAI,IAAkB,MAPpE,iDAjP4B,kIA2P5B,WAAuC,EAAkC,GAAzE,qFACiB,EADjB,OACE,EADF,OAGqB,EAHrB,uBAI2B,KAAK,sBAAsB,GAJtD,UAIU,EAJV,iBAOsB,IAAhB,EAPN,8BAQmB,OAAZ,GARP,uCAQmC,KAAK,iBAAiB,EAAa,GARtE,uFASmB,OAAZ,GAAoB,EAAQ,YAAc,EAAQ,cAAgB,GAAK,EAT9E,2DAca,GAdb,yBAkBU,EAvT6B,KAqSvC,wEA3P4B,oHAiR5B,WAAyB,EAAgB,EAAwB,GAAjE,sFACkB,IAAZ,EADN,+FAGoC,EAAQ,EAAe,IAH3D,OAMM,OAAkC,EANxC,uBAQ0B,KAAK,iCAAiC,EAAQ,GARxE,UAWkB,QAHR,EARV,gBAYyB,IAAlB,GAA+B,EAAQ,eAAiB,GAZ/D,yCAca,GAdb,wBAiBwB,IAAI,SAAgB,YAAO,OAAI,EAAK,KAAK,QAAS,MAjB1E,QAiBI,EAjBJ,+EAjR4B,gEAAiB,GAyS/C,OAFA,EAA4B,KAAK,GAE1B,GAGI,iCAAiC,qBAAmB,iB,gKCpYjE,IAEa,E,mHACX,WACE,OAAQ,KAAK,WAAyB,aAAe,UAAU,O,mBAGjE,SAAY,GACT,KAAK,WAAyB,QAAU,I,mBAG3C,SAAM,GACH,KAAK,WAAyB,MAAM,K,sDAGvC,qGACS,KAAK,SADd,gD,2DAfF,OAEuC,mBAAvCC,EAAQC,kBAAoB,G,6TCE5B,YAUA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YA2Ga,E,8BAGX,WACE,EACA,EACA,GAAgD,MA3BlD,EACA,EA0BkD,kBAEhD,cAAM,EAAe,EAAmB,IAGnC,qBAhCP,EAgCqD,EAAK,YA/B1D,EA+BuE,EAAK,oBA7B5E,OAAO,YACL,OAAO,KAAK,GAAmB,KAAI,YAAY,MAAI,CACjD,EADiD,2BAEjD,WAAO,EAAW,GAAlB,sGAAqC,EAArC,iCAAqC,EAArC,kBAC6B,IAAvB,EAAU,SADhB,gCAE+B,EAAkB,GAAlB,QAAmC,EAAlB,QAAwB,KAFxE,OAEU,EAFV,OAII,EAAS,OACJ,GADI,IAEP,SAAU,EAAe,KAN/B,gCAUS,EAAU,GAAV,QAA2B,EAAlB,QAAwB,MAV1C,2CAFiD,8DAuBH,E,uCAQlD,SAAc,EAAa,GAAY,WACrC,OAAO,EACJ,QAAO,YAAG,OAAI,EAAI,UAAY,EAAK,WACnC,KAAI,YAAG,OAAI,EAAK,UAAU,SAAS,MACnC,QAAO,YAAC,OAAI,EAAE,OAAS,S,GAlBQ,YAAtC,qBAgDa,sBAAsB,SACjC,GADiC,MAEC,aAAc,GAGrC,kBAAkB,SAAC,GAAD,MAC7B,SAAU,GAsDC,sBAAsB,SACjC,EADiC,GAGZ,IAhDP,EAA6B,EAsB3C,EACA,EAwBE,EACmB,EADnB,UAAW,EACQ,EADR,oBAAqB,EACb,EADa,gBAE5B,GAjDQ,EAiDK,EAjDwB,EAiDH,EAjDqD,CAC7F,WAAY,UACZ,mBAAoB,UACpB,aAAc,UACd,UAAW,UACX,kBAAmB,UACnB,YAAa,UACb,UAAW,UACX,YAAa,UACb,sBAAuB,UACvB,YAAa,UACb,iBAAkB,UAClB,UAAW,EAAqB,UAAsB,UACtD,aAAc,UACd,cAAe,UACf,QAAS,UACT,gBAAiB,UACjB,QAAS,UACT,SAAU,EAAiB,UAAe,YAiC1C,OA7BA,EA8BE,EA7BF,EA8BE,SAAC,EAAS,GAAV,OACE,IAAI,EAAiB,EAAS,EAAI,GAAM,IA7B5C,OAAO,YACL,OAAO,QAAQ,GAAW,KAAI,yBAAE,EAAF,KAAO,EAAP,WAAc,CAAC,EAAK,EAAE,EAAG,U,oKCnO3D,IAuCK,EAvCL,OAiBA,SAGA,SAWA,SAKM,EAAsB,UAAQ,KAAK,wBACnC,EAAO,UAAQ,KAAK,IAE1B,SAAK,GACH,iCACA,uBACA,qCACA,iDACA,+CALF,CAAK,MAAkB,KAQvB,IAAM,EAAsB,SAAC,GAAD,OAC1B,IAAkB,EAAmB,YACjC,cACA,IAAkB,EAAmB,OACrC,OACA,IAAkB,EAAmB,cACrC,gBACA,IAAkB,EAAmB,oBACrC,sBACA,IAAkB,EAAmB,mBACrC,qBACA,QAAM,IAAI,MAAJ,gCAAmC,MAEzC,EAAgB,SAAC,GAAD,OAAuB,IAAI,KAAiB,IAAZ,IAEhD,EAAsB,CAAC,2BAA4B,6BAEnD,EAAoB,SAAmB,EAA4B,GACrE,QAAe,IAAb,EAAI,GAAoB,CACtB,IAAC,OAAO,UAAU,EAAI,IACxB,MAAM,IAAI,MAAJ,UAAa,EAAb,wBAGR,GAAI,EAAI,GAAO,EACb,MAAM,IAAI,MAAJ,UAAa,EAAb,4BAUC,E,WAIT,SAAF,EAAY,GAAmC,UACzC,KAAC,WAAa,E,kCAwDpB,WACE,OAAO,I,8DAIT,WAA4B,GAApB,IAAR,YAAQ,OAAR,oBAAU,OAAV,sCAC2B,gBAAc,KAAK,YAApC,EADV,EACU,aADV,SAGmC,QAAQ,IAAI,CAC3C,EAAa,MAAb,KAAwB,IAAa,KAAK,cAC1C,EAAa,WAAb,KAA6B,IAAa,KAAK,gBALnD,gCAGS,EAHT,KAGqB,EAHrB,uBAQS,IAAI,QAAM,EAAY,IAR/B,gD,4HAYA,WACE,EACA,GAFF,sFAIS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aAJnC,EAK2B,gBAAc,KAAK,YAApC,EALV,EAKU,aALV,SAOkC,QAAQ,IAAI,CAC1C,EAAa,OAAO,EAApB,KAAkC,IAClC,EAAa,gBAAgBC,EAA7B,KAA2CC,MAT/C,4BAOS,EAPT,KAOgB,EAPhB,KAYM,EAAM,SAAW,EAAmB,OAZ1C,0CAaW,IAAI,iCACT,EACA,EAAoB,EAAM,QAC1B,aAAW,EAAM,MACjB,aAAW,EAAM,MACjB,aAAW,EAAM,OACjB,IAAI,QAAM,aAAW,EAAS,KAAM,aAAW,EAAS,aAnB9D,iCAsBW,IAAI,iCAA+B,EAAS,EAAoB,EAAM,UAtBjF,iD,0GA2BA,WAAe,EAAkB,GAAjC,2FAC4C,QAAQ,IAAI,CACpD,KAAK,6BAA6B,EAAS,GAC3C,KAAK,sBAAsB,KAH/B,gCACS,EADT,KACgB,EADhB,uBAMS,EAAM,oBAAoB,IANnC,gD,mHAUA,WAAwB,GAAxB,gFAC2B,gBAAc,KAAK,YAApC,EADV,EACU,aADV,SAGgB,EAAa,oBAAb,KAAsC,IAHtD,uCAGoE,YAHpE,gD,6EAOA,SAAS,GAGP,OAFsB,gBAAc,KAAK,YAAjC,UAES,WAAW,WAArB,KAAqC,IAAa,KAAK,gB,uDAIhE,WAAqB,GAArB,wFACyB,gBAAc,KAAK,YAAlC,EADV,EACU,WADV,SAG+C,QAAQ,IACnD,CACE,EAAW,OAAX,KAAuB,IACvB,EAAW,YAAX,KAA4B,KAC5B,KAAI,YAAY,OAAI,EAAa,KAAK,kBAP5C,gCAGS,EAHT,KAG2B,EAH3B,uBAUS,IAAI,QAAM,EAAkB,IAVrC,gD,+GAcA,WAAsB,GAAtB,wFAC0B,gBAAc,KAAK,YAAnC,EADV,EACU,YADV,SAGmD,QAAQ,IACvD,CACE,EAAY,OAAZ,KAAwB,IACxB,EAAY,YAAZ,KAA6B,KAC7B,KAAI,YAAY,OAAI,EAAa,KAAK,kBAP5C,gCAGS,EAHT,KAG+B,EAH/B,uBAUS,IAAI,QAAM,EAAsB,IAVzC,gD,wGAcA,WAAe,GAAf,2FAC0C,QAAQ,IAAI,CAClD,KAAK,eAAe,GACpB,KAAK,gBAAgB,KAHzB,gCACS,EADT,KACqB,EADrB,uBAMS,EAAW,IAAI,IANxB,gD,mHAUA,WACE,EACA,GAFM,IAAR,oBAAQ,OAAR,oBAAU,OAAV,oCAIS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aAJnC,EAK4B,gBAAc,KAAK,YAArC,EALV,EAKU,cALV,SAYY,QAAQ,IAAI,CACpB,EAAc,SAAS,EAAvB,KAAqC,IACrC,EAAc,yBAAyB,EAAvC,KAAqD,IACrD,EAAc,oBAAoB,EAAlC,KAAgD,IAChD,EAAc,qBAAqB,EAAnC,KAAiD,MAhBrD,uCAQM,EARN,EAQM,YAAa,EARnB,EAQmB,aACf,EATJ,KAUI,EAVJ,KAWI,EAXJ,uBAmBS,IAAI,mBACT,aAAW,GACX,aAAW,GACX,aAAW,GACX,aAAW,GACX,IAxBJ,iD,qIA6BA,WAA0C,GAA1C,oFACgC,gBAAc,KAAK,YAAzC,EADV,EACU,kBAEF,EAAc,KAAK,WAAW,6BAHtC,KAI0B,EAJ1B,SAI2C,EAAkB,gBAAlB,KAAuC,IAJlF,0BAIQ,EAJR,KAI0B,WAJ1B,kCAOS,EAAY,IAAI,IAPzB,gD,2FAWA,SAAuB,GAGrB,OAF0B,gBAAc,KAAK,YAArC,cAEa,qBAAd,KAAwC,IAAa,KAAK,gB,4BAInE,SAAe,EAAkB,GAI/B,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACX,gBAAc,KAAK,YAAjC,UAES,UAAU,EAApB,KAAkC,IAAa,KAAK,gB,4BAI7D,SAAe,EAAkB,GAI/B,OAHO,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACX,gBAAc,KAAK,YAAjC,UAES,UAAU,EAApB,KAAkC,IAAa,KAAK,gB,gCAI7D,SAAmB,EAAkB,GAInC,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACZ,gBAAc,KAAK,YAAhC,SAEQ,UAAU,EAAnB,KAAiC,IAAa,KAAK,gB,kCAI5D,SAAqB,EAAkB,GAC9B,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aADmC,MAEtC,gBAAc,KAAK,YAAzC,EAF4D,EAE5D,SAAU,EAFkD,EAElD,QAElB,OAAO,EAAS,UAAU,EAAS,EAAQ,QAApC,KAAkD,IAAa,KAAK,gB,yFAI7E,WACE,GADF,4FAGsB,gBAAc,KAAK,YAA/B,EAHV,EAGU,QAHV,SAKwE,QAAQ,IAAI,CAChF,EAAQ,YAAR,KAAyB,IACzB,EAAQ,WAAR,KAAwB,IAAa,KAAK,cAC1C,EAAQ,aAAR,KAA0B,IAAa,KAAK,aAC5C,EAAQ,eAAR,KAA4B,IAAa,KAAK,eATlD,gCAKS,EALT,KAKsB,EALtB,KAKkC,EALlC,KAKgD,EALhD,wBAYS,SAAC,GAAD,OACL,EAAW,IACT,KAAK,IAAI,EAAG,GAAgB,EAAY,SAAW,EAAiB,QAd1E,iD,qIAmBA,WAA4C,GAA5C,2FACyD,QAAQ,IAAI,CACjE,KAAK,iDAAiD,GACtD,KAAK,mBAA4B,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YAHvC,gCACS,EADT,KACiC,EADjC,uBAMS,EAAuB,IANhC,gD,4FAUA,SAAwB,EAAkB,GAIlC,OAHC,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACb,gBAAc,KAAK,YAA/B,QAEO,UAAU,EAAlB,KAAgC,IAAa,KAAK,gB,qCAI3D,SAAwB,GAGtB,OAFoB,gBAAc,KAAK,YAA/B,QAEO,YAAR,KAAyB,IAAa,KAAK,gB,0CAIpD,SAA6B,EAAkB,GAIvC,OAHC,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aACb,gBAAc,KAAK,YAA/B,QAEO,OAAO,EAAf,KAA6B,IAAa,KAAK,gB,yCAIxD,SAA4B,EAAkB,GAI5C,OAHO,OAAD,QAAC,IAAP,MAAY,kBAAgB,KAAK,aACL,gBAAc,KAAK,YAAvC,gBAEe,cAAc,EAA9B,KAA4C,IAAa,KAAK,gB,kDAYvE,WACE,EACA,GAFM,IAAR,kBAAQ,OAAR,oBAAU,OAAV,kCAI+B,gBAAc,KAAK,YAAxC,EAJV,EAIU,iBAER,EAAkB,EAAQ,SAC1B,EAAkB,EAAQ,cAErB,EAAoB,SAAS,EAAO,UAT3C,sBAUU,IAAI,MAAJ,mCACwB,EAAoB,KAAI,YAAC,iBAAQ,EAAR,QAAc,KAAK,QAX9E,uBAeoD,QAAQ,IAAI,CAC5D,EAAO,0BAAuB,EAAY,KAAK,sBAAL,KAAgC,IAC1E,EAAiB,wBACK,8BAApB,EAAO,SACc,QAAlB,EAAC,EAAO,kBAAU,QAAI,KACD,QAAlB,EAAC,EAAO,kBAAU,QAAI,GAAK,GACjC,EAAO,MAJT,KAKO,MAtBX,4BAeS,EAfT,KAe6B,EAf7B,KA0BQ,EAAS,EAAiB,IAE5B,EA5BN,0CA6BW,EAAO,KAAI,YAAK,OAAI,EAAM,oBAAoB,OA7BzD,iCA+BW,GA/BX,iD,yFAoCA,SAAmB,GACX,OAAC,qBAAmB,KAAK,WAAY,K,wDAI7C,WACE,GADF,wFAG2B,gBAAc,KAAK,YAApC,EAHV,EAGU,aAHV,SAK6D,QAAQ,IAAI,CACrE,EAAa,qBAAb,KAAuC,IACvC,EAAa,SAAb,KAA2B,IAAa,KAAK,gBAPjD,gCAKS,EALT,KAK+B,EAL/B,wBAUS,SAAC,EAAgB,GAAjB,OACL,IAAI,OACF,EACA,EACA,EACA,EAAc,EAAqB,YACnC,EAAc,GACd,MAjBN,gD,uGAsBA,WAAc,GAAd,+FAC2D,QAAQ,IAAI,CACnE,KAAK,gBAAgB,GACrB,KAAK,SAAS,GACd,KAAK,SAAS,GACd,KAAK,mBAA4B,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,YALvC,gCACS,EADT,KACqB,EADrB,KAC4B,EAD5B,KACmC,EADnC,uBAQS,EAAW,EAAgB,EAAM,+BAA+B,KARzE,gD,4GAYA,WAAmB,EAAkB,GAArC,wFACS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,aADnC,EAE0B,gBAAc,KAAK,YAAnC,EAFV,EAEU,YAFV,SAIuD,QAAQ,IAC3D,CACE,EAAY,OAAO,EAAnB,KAAiC,IACjC,EAAY,kBAAkB,EAA9B,KAA4C,IAC5C,EAAY,mBAAmB,EAA/B,KAA6C,KAC7C,KAAI,YAAY,OAAI,EAAa,KAAK,kBAT5C,gCAIS,EAJT,KAIqB,EAJrB,KAIqC,EAJrC,uBAYS,IAAI,YAAU,EAAY,EAAgB,IAZnD,iD,oHAgBA,WAAyB,GAAzB,gFAC0B,gBAAc,KAAK,YAAnC,EADV,EACU,YADV,kBAGS,EAAY,gBAAZ,KAAiC,IAAa,KAAK,eAH5D,gD,iHAOA,WACE,EACA,GAFF,oFAIS,OAAP,QAAO,IAAP,MAAY,0BAAwB,KAAK,aAJ3C,EAK4B,gBAAc,KAAK,YAArC,EALV,EAKU,cALV,SAO6C,EAAc,UAAU,EAAxB,KAAsC,IAPnF,uBAOU,EAPV,EAOU,WAAY,EAPtB,EAOsB,aAPtB,kBASS,EACH,CAAE,OAAQ,aAAc,aAAc,aAAW,IACjD,CAAE,OAAQ,iBAXhB,gD,8EA3YA,SAAa,GACL,MAAW,IAAI,EAAsB,GAE3C,MAA+B,gBAAxB,EAAW,SACd,IAAI,EAAkC,GACtC,I,gDAqBN,WACE,EACA,GAFF,2EAIS,EAJT,SAI2C,WAAS,EAAkB,GAJtE,iDAI+B,MAJ/B,4D,gEA3CF,0BA8aA,IAAM,EAAmB,SAAC,GAAD,OACvB,EAAO,KACL,YAAK,OACH,IAAI,iCACF,EAAM,MACN,OACA,aAAW,EAAM,MACjB,aAAW,EAAM,MACjB,aAAW,EAAM,OACjB,IAAI,QAAM,aAAW,EAAM,aAAc,aAAW,EAAM,wBAe5D,E,WAOJ,WAAY,GAA+B,UACzC,IAAM,EAAQ,IAAI,0BAAwB,GAE1C,KAAK,MAAQ,EACb,KAAK,WAAa,EAAS,WAC3B,KAAK,UAAY,E,mCAGX,SAAU,GAChB,OACG,QACsB,IAAvB,EAAU,UACV,EAAU,WAAa,KAAK,MAAM,MAAM,W,sBAIpC,SAAS,EAAkB,GACjC,OACE,KAAK,UAAU,UACF,IAAZ,GAAyB,IAAY,KAAK,MAAM,WAAW,e,0BAIxD,SAAa,EAAkB,GACrC,OACE,KAAK,UAAU,UACF,IAAZ,GAAyB,IAAY,KAAK,MAAM,WAAW,e,sBAIhE,SAAS,GACP,YAAiB,IAAV,GAAiC,gBAAV,I,8DAGhC,WAA4B,GAA5B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,mBACjB,KAAK,UAAU,sBAAsB,IAH3C,gD,4HAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,0BACjB,KAAK,UAAU,6BAA6B,EAAS,IAN3D,gD,0GASA,WAAe,EAAkB,GAAjC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,MACjB,KAAK,UAAU,SAAS,EAAS,IAHvC,gD,mHAMA,WAAwB,GAAxB,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,eACjB,KAAK,UAAU,kBAAkB,IAHvC,gD,wGAMA,WAAe,GAAf,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,MAAQ,KAAK,UAAU,SAAS,IADtF,gD,wGAIA,WAAe,GAAf,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,MAAQ,KAAK,UAAU,SAAS,IADtF,gD,mHAIA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,iBACjB,KAAK,UAAU,oBAAoB,EAAS,IANlD,gD,qIASA,WAA0C,GAA1C,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,iCACjB,KAAK,UAAU,oCAAoC,IAHzD,gD,sHAMA,WAA6B,GAA7B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,oBACjB,KAAK,UAAU,uBAAuB,IAH5C,gD,8GAMA,WAAqB,EAAkB,GAAvC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,YACjB,KAAK,UAAU,eAAe,EAAS,IAH7C,gD,gHAMA,WAAqB,EAAkB,GAAvC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,YACjB,KAAK,UAAU,eAAe,EAAS,IAH7C,gD,oHAMA,WAAyB,EAAkB,GAA3C,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,gBACjB,KAAK,UAAU,mBAAmB,EAAS,IAHjD,gD,sHAMA,WAA2B,EAAkB,GAA7C,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,kBACjB,KAAK,UAAU,qBAAqB,EAAS,IAHnD,gD,uIAMA,WAA4C,GAA5C,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,mCACjB,KAAK,UAAU,sCAAsC,IAH3D,gD,uHAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,qBACjB,KAAK,UAAU,wBAAwB,EAAS,IANtD,gD,yHASA,WAA8B,GAA9B,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,qBACjB,KAAK,UAAU,wBAAwB,IAH7C,gD,4HAMA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,0BACjB,KAAK,UAAU,6BAA6B,EAAS,IAN3D,gD,6HASA,WACE,EACA,GAFF,wFAIS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,yBACjB,KAAK,UAAU,4BAA4B,EAAS,IAN1D,gD,oHASA,WAAyB,GAAzB,wFACS,KAAK,UAAU,CAAE,aACpB,KAAK,MAAM,MAAM,eACjB,KAAK,UAAU,mBAAmB,IAHxC,gD,+GAMA,WACE,GADF,wFAGS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,aACjB,KAAK,UAAU,gBAAgB,IALrC,gD,uGAQA,WAAc,GAAd,wFACS,KAAK,UAAU,GAAa,KAAK,MAAM,MAAM,KAAO,KAAK,UAAU,QAAQ,IADpF,gD,4GAIA,WAAmB,EAAkB,GAArC,wFACS,KAAK,SAAS,EAAS,GAC1B,KAAK,MAAM,MAAM,UACjB,KAAK,UAAU,aAAa,EAAS,IAH3C,gD,oHAMA,WAAyB,GAAzB,wFACS,KAAK,UAAU,GAClB,KAAK,MAAM,MAAM,gBACjB,KAAK,UAAU,mBAAmB,IAHxC,gD,iHAMA,WACE,EACA,GAFF,wFAIS,KAAK,aAAa,EAAS,GAC9B,KAAK,MAAM,MAAM,SACjB,KAAK,UAAU,kBAAkB,EAAS,IANhD,gD,gFAgBA,SAAU,EAA4B,GACpC,OAAO,KAAK,UAAU,UAAU,EAAQ,K,4BAG1C,WACE,MAAM,IAAI,MAAM,6B,6BAGlB,WACE,MAAM,IAAI,MAAM,6B,8DAGlB,WACE,MAAM,IAAI,MAAM,+B,sMCpvBpB,YAEA,OAWA,SAEA,SAyCa,E,8BAMT,SAAF,EAAY,GAA+B,wBACrC,EAAJ,cAEK,WAAa,EAAS,WACvB,EAAC,UAAY,EACb,EAAC,UAAY,eAAa,EAAS,YALE,E,0FAQnC,WACN,GADM,qFAGuB,KAAK,UAAU,UAC1C,CAAE,MAAO,EAAG,SAAU,2BAA4B,sBAAsB,GACxE,GALI,UAQwB,KALxB,EAHA,QAQa,OARb,yCASG,IAAI,iCAA+B,cAAa,gBATnD,gCAYC,EAAe,IAZhB,gD,oGAeA,WACN,GADM,4FAG+B,KAAK,WAAlC,EAHF,EAGE,YAAa,EAHf,EAGe,YAHf,SAUI,sBACR,eAAgB,KAAK,UAAU,mBAAmB,GAClD,aAAc,KAAK,UAAU,gBAAgB,CAAE,aAC/C,uBAAwB,KAAK,UAAU,iDAAiD,CACtF,aAGF,MAAO,KAAK,UAAU,SAAS,CAAE,aACjC,eAAgB,KAAK,UAAU,kBAAkB,CAAE,aACnD,mBAAoB,KAAK,UAAU,sBAAsB,CAAE,aAC3D,MAAO,KAAK,UAAU,SAAS,CAAE,aACjC,oBAAqB,KAAK,UAAU,uBAAuB,CAAE,aAC7D,gBAAiB,KAAK,UAAU,mBAAmB,CAAE,aACrD,mCAAoC,KAAK,sCAAsC,CAAE,aACjF,qBAAsB,KAAK,UAAU,wBAAwB,CAAE,aAC/D,iCAAkC,KAAK,UAAU,oCAAoC,CACnF,aAGF,SAAU,EACN,KAAK,UAAU,kBAAkB,EAAa,CAAE,aAChD,CAAE,OAAQ,iBAEV,EACA,CACE,eAAgB,KAAK,UAAU,WAAW,EAAa,GAAU,KAAK,cACtE,YAAa,KAAK,UAAU,eAAe,EAAa,CAAE,aAC1D,YAAa,KAAK,UAAU,eAAe,EAAa,CAAE,aAC1D,gBAAiB,KAAK,UAAU,mBAAmB,EAAa,CAAE,aAClE,kBAAmB,KAAK,UAAU,qBAAqB,EAAa,CAAE,aACtE,qBAAsB,KAAK,UAAU,wBAAwB,EAAa,CAAE,aAC5E,0BAA2B,KAAK,UAAU,6BAA6B,EAAa,CAClF,aAEF,yBAA0B,KAAK,UAAU,4BAA4B,EAAa,CAChF,aAEF,0BAA2B,KAAK,UAAU,6BAA6B,EAAa,CAClF,aAEF,iBAAkB,KAAK,UAAU,oBAAoB,EAAa,CAAE,aACpE,UAAW,KAAK,UAAU,aAAa,EAAa,CAAE,aACtD,YAAa,KAAK,UAAU,kBAAkB,EAAa,CAAE,cAE/D,CACE,eAAgB,UAAQ,KACxB,YAAa,UAAQ,KACrB,YAAa,UAAQ,KACrB,gBAAiB,UAAQ,KACzB,kBAAmB,UAAQ,KAC3B,qBAAsB,UAAQ,KAC9B,0BAA2B,UAAQ,KACnC,yBAA0B,UAAQ,KAClC,0BAA2B,IAAI,iCAC7B,cACA,eAEF,iBAAkB,IAAI,mBACpB,UAAQ,KACR,UAAQ,KACR,UAAQ,KACR,UAAQ,KACR,eAEF,UAAW,IAAI,YACf,YAAa,CAAE,OAAQ,mBA3EzB,uBAMJ,EANI,EAMJ,eACA,EAPI,EAOJ,aACA,EARI,EAQJ,uBACG,EATC,kFA+EC,QAEA,GAFA,IAGH,kBAAmB,EAAa,GAAgB,GAChD,mCAAoC,EAAuB,KAE7D,CACE,WACA,iBACA,kBAxFE,gD,6EA8FE,WAAQ,WAChB,KAAK,OAAO,MAAK,YACV,EAAK,SACR,EAAK,MAAL,QAAI,EAAU,OAIlB,IAAM,EAAa,2BAAG,WAAO,GAAP,qFACA,EAAK,KAAK,GADV,OACd,EADc,OAGhB,EAAK,QACP,EAAK,QAAL,QAAI,EAAY,IAEhB,EAAK,MAAL,QAAI,EAAU,IANI,2CAAH,sDAYnB,OAFA,KAAK,UAAU,GAAG,QAAS,GAEpB,WACL,EAAK,UAAU,IAAI,QAAS,M,0BAKtB,SACR,EACA,G,UAEA,MAAO,CACL,SAA8B,QAAtB,EAAE,EAAY,gBAAQ,QAAI,EAAS,SAC3C,eAA0C,QAA5B,EAAE,EAAY,sBAAc,QAAI,EAAS,eACvD,aAAsC,QAA1B,EAAE,EAAY,oBAAY,QAAI,EAAS,kB,GA3JZ,gBAA7C,6B,iJCqDU,G,6UA7GV,gBAGA,QAEA,OAGA,OAqCA,SAOA,SACA,SACA,SAGM,EAAe,SAAC,EAAc,GAAf,OAAmC,OAAD,QAAC,IAAD,OAAC,EAAD,EAAG,GAAG,IAAK,EAAI,GAIzD,uBAAuB,GAEpC,IA0DY,EA1DN,EAAwC,UAAQ,KAAK,MACrD,EAAyC,UAAQ,KAAK,MAGtD,EAAY,aAEZ,EAAU,SAAU,EAAgB,GAA1B,OAA6C,SAAC,GAAD,OAAU,EAAE,EAAE,MAErE,EAAK,SAAI,GAAJ,OAAa,GAIlB,EAA0B,eAAC,EAAD,uDAA6B,GAA7B,OAAoC,SAAC,GAAD,OAClE,EAAI,IAAI,IAAQ,KAAO,KAAK,KAAK,KAAK,KAAK,EAA4B,OAInE,EAAkC,SAAC,GAAD,OAAoB,EAAI,IAAI,MAE9D,EAAwB,SAAC,GAAD,OAAoB,EAAI,IAAI,MAEpD,EAA+B,SAAC,GAAD,OAAoB,EAAI,IAAI,MAyBjE,SAAU,EAAe,GAAvB,IAAF,EAAE,OAAF,oBAAI,OAAJ,6BACE,UAAO,OAAO,UAAU,IAAwB,EAAsB,GADxE,WAGS,EAHT,gBAKI,OADM,EAAiB,KAAK,IAAI,EANJ,MAEhC,SAKU,EALV,OAOI,GAAuB,EAP3B,uDAYA,SAAY,GACR,EAAF,wCACE,EAAF,kCACE,EAAF,gCACE,EAAF,gCAJF,CAAY,wCAAe,KAO3B,IAAM,EAA2C,CAC/C,EAAgB,sBAChB,EAAgB,qBAChB,EAAgB,sBAwBZ,EAAU,SAAsB,EAAM,GAA5B,OAAqE,KAAK,GAQpF,EAA6B,SAAC,GAAD,OACjC,EAAQ,EAAO,SACf,EAAM,OAAS,YAAU,sBACzB,EAAQ,EAAO,WACf,EAA8B,SAAS,EAAM,SAOlC,E,8BAKT,SAAF,EAAY,GAAsC,uBAC5C,EAAJ,QAAO,EAAS,SAAW,EAAgB,uBAEvC,EAAJ,kCAAqB,EAAS,UACzB,KAAO,4BACZ,EAAK,sBAAwB,EAAS,QACtC,EAAK,SAAW,EANgC,E,YALC,QAArD,oC,IAuBa,E,WAUX,WACE,EACA,EACA,GAAkD,UAElD,KAAK,mBAAqB,EAC1B,KAAK,YAAc,EACnB,KAAK,OAAS,E,sCAGR,SAAa,GAA2C,WAC9D,OAAO,EACH,EAAW,OACT,qBAAmB,EAAY,KAAK,OAAO,IAAa,kBACtD,eAAa,EAAY,gBAAc,EAAK,iBAE9C,iBAAe,GACjB,oB,2DAGE,WAAyB,GAAzB,wFAES,KAAK,mBAAmB,KAAK,GAFtC,6EAIA,gBAAiB,OAJjB,oBAtEwB,EA2EE,MA1ElC,EAAQ,EAAO,SACf,EAAM,OAAS,YAAU,iBACzB,EAAQ,EAAO,WACf,EAAM,SAAW,EAAgB,mBAkEzB,0CAMO,KAAM,SANb,YASE,EAA0B,MAT5B,qBAUI,KAAM,UAVV,uBAWQ,IAAI,EAAJ,MAXR,iCAaS,KAAM,SAbf,qDAtEuB,IAAC,IAsExB,oB,0GAuBR,wFACS,KADT,SACiC,KAAK,mBAAmB,GADzD,iDACc,aADd,iE,6GAUA,aAAQ,IAAR,EAAQ,OAAR,oBAAU,OAAE,OAAZ,eAAc,KAAd,cACkB,KADlB,SAC0C,KAAK,qBADjC,KAAd,qBACQ,EADR,KACuB,aADvB,gBAGE,UAA0B,YAAnB,EAAQ,QAHjB,kBAIS,GAJK,KAAd,EAAc,IAAd,qC,6DA/DF,iCAuGA,IAAM,EAA4C,SAChD,EACA,G,QAKE,QAAuC,IAArC,EACE,MAAG,CACL,iBACiE,QADjD,EACM,OAApB,QAAoB,IAApB,OAAoB,EAApB,EAAsB,IAAI,UAAqC,QAAK,UAAQ,KACxE,kCAtPqC,IAwPxC,GACuC,kBAArC,GACqC,kBAArC,GACP,aAA4C,UAExC,MAAG,CACC,iBAAY,UAAQ,KAAK,GAC/B,kCA/P2C,IAiQxC,IACG,EAAwD,EAAxD,iBAAkB,EAAsC,EAAtC,kCAE1B,MAAO,CACL,sBACuB,IAArB,EACI,UAAQ,KAAK,GACkD,QAAhE,EAAqB,OAApB,QAAoB,IAApB,OAAoB,EAApB,EAAsB,IAAI,UAAqC,QAAK,UAAQ,KAElF,kCACmC,OAAjC,QAAiC,IAAjC,IA3QyC,KAwRpC,E,WA0BT,SAAF,EACE,EACA,EACA,EACA,GAAoB,UAEhB,KAAC,wBAA0B,EAC3B,KAAC,YAAc,EACf,KAAC,OAAS,OAEM,IAAhB,IACI,KAAD,YAAc,G,yDAKvB,wFACa,EADb,SAEU,iBAAe,KAAK,aAAa,gBAAgB,KAAK,yBAFhE,+BAGI,KAAK,YAHT,KAII,KAAK,OAJT,4F,6DA1CF,sC,IAwDa,E,8BAsBT,SAAF,EACE,EACA,EACA,EACA,EACA,GAEuC,oBAE/B,EAAiB,gBAAc,GAA/B,aAF+B,OAInC,EAAJ,YACE,EACA,GAEA,gBAAG,EAAH,EAAG,KAAH,OACE,EACG,cAAc,EAAM,cACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,SAAU,EAArB,EAAqB,QAAS,EAA9B,EAA8B,kBAAmB,EAAjD,EAAiD,qBAAjD,MAA+E,CAClF,oBAAqB,aAAW,GAChC,iBAAkB,aAAW,GAC7B,gBAAiB,aAAW,GAC5B,IAAK,aAAW,OACd,OAGL,oBAAsB,EACvB,EAAC,qBAAuB,EACxB,EAAC,YAAc,EAAqB,GAAG,GACvC,EAAC,gCAAkC,EAtBA,E,wDA0BzC,SACE,GAEM,IAAD,KAAK,gCACR,MAAM,IAAI,MACR,2GAKJ,OAAO,KAAK,gCAAgC,O,GAhEtC,GADV,8B,IAiFa,E,WAST,SAAF,EAAY,GAA+B,UACrC,KAAC,UAAY,E,gDAGX,SACN,GAEM,OAAC,IAAI,EACT,EACA,KAAK,UAAU,WACf,K,sCAII,SACN,EACA,EACA,GAAoB,IAEZ,EAAuB,gBAAc,KAAK,UAAU,YAApD,mBAEF,OAAC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KAAU,EACQ,EAChB,cAAc,EAAM,gBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,MAAO,EAAlB,EAAkB,MAAlB,OAAgC,IAAI,QAAM,aAAW,GAAQ,aAAW,OAFxE,EADI,YAKG,EACX,cAAc,EAAM,wBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,SAAX,OAA4B,aAAW,MAFvC,EALI,UASX,MAAO,CACL,SACA,WACU,IAAV,KAIJ,K,0DAII,WACN,GADM,kFAG4B,gBAAc,KAAK,UAAU,YAAvD,EAHF,EAGE,WAAY,EAHd,EAGc,UAHd,kBAKC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAgC,IAA7B,EAA6B,EAA7B,KAAY,EAAiB,EAAvB,KAAuB,EACV,EACjB,cAAc,EAAM,YACpB,QAAO,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,GAAjB,OAA4B,IAAS,GAAe,IAAO,iBAClE,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAHpC,EADuB,YAMD,EAC1B,cAAc,EAAM,aACpB,QAAO,qBAAG,KAAQ,MAAoB,KACtC,KAAI,gBAAW,EAAX,EAAG,KAAQ,QAAX,OAA2B,aAAW,MAHtC,EANuB,UAW9B,MAAO,CACL,OAAQ,EAAU,QAAU,CAAE,qBAAoB,aAAc,CAAE,2BArBlE,gD,qFA2BA,SACN,GAAmD,IAE3C,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAER,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KACK,EAAsB,EACzB,cAAc,EAAM,mBACpB,KAAI,qBAAG,KAAQ,aAHP,EAKM,EACd,cAAc,EAAM,eACpB,KACC,oBACE,KAAQ,EADV,EACU,qBAAsB,EADhC,EACgC,qBAAsB,EADtD,EACsD,gBAAiB,EADvE,EACuE,gBADvE,MAEO,CACL,0BAA2B,aAAW,GACtC,oBAAqB,aAAW,GAChC,gBAAiB,IAAI,QAAM,aAAW,GAAkB,aAAW,QARlE,EALI,UAiBX,UACE,uBACG,Q,yDAMH,SACN,GAAW,IAEH,EAAkB,gBAAc,KAAK,UAAU,YAA/C,cAFG,EAIc,EACtB,cAAc,EAAM,sBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,YAAX,OAA+B,aAAW,MAF1C,EAJI,YAQ0B,EAClC,cAAc,EAAM,oBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,UAAjB,MAAmC,CAAC,aAAW,GAAO,aAAW,OAV7D,qBAQH,EARG,KAQa,EARb,OAYU,EAClB,cAAc,EAAM,uBACpB,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAE3C,MAAO,CACL,WACA,iBACA,iBACA,WApBS,a,+CAwBL,SACN,GAAmD,WAEnD,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YACf,gBAAG,EAAH,EAAG,KAAH,OAAc,EAAK,4CAA4C,Q,wCAI3D,SACN,EACA,GAAmD,WAEnD,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,gBAAG,EAAH,EAAG,KAAH,cACK,EAAK,4CAA4C,IADtD,IAEE,gB,wEAKE,WACN,GADM,yFAG+B,gBAAc,KAAK,UAAU,YAA1D,EAHF,EAGE,cAAe,EAHjB,EAGiB,UAHjB,kBAKC,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAgC,IAA7B,EAA6B,EAA7B,KAAY,EAAiB,EAAvB,KACD,EAAyB,EAAK,4CAA4C,GADlD,EAGP,EACpB,cAAc,EAAM,YACpB,QAAO,oBAAG,KAAQ,EAAX,EAAW,KAAM,EAAjB,EAAiB,GAAjB,OAA4B,IAAS,EAAc,SAAW,IAAO,KAC5E,KAAI,gBAAW,EAAX,EAAG,KAAQ,MAAX,OAAyB,aAAW,MAHpC,EAHuB,UAQ9B,cACK,GADL,IAEE,OAAQ,CAAE,eAAc,gBAAiB,EAAuB,eAAe,cAnB/E,gD,gGAyBA,SACN,GAAmD,WAE3C,EAAuB,gBAAc,KAAK,UAAU,YAApD,mBAER,OAAO,IAAI,EACT,EACA,KAAK,UAAU,YAEf,YAAa,IAAV,EAAU,EAAV,KAAU,EACQ,EAChB,cAAc,EAAM,gBACpB,KAAI,oBAAG,KAAQ,EAAX,EAAW,MAAO,EAAlB,EAAkB,MAAlB,OAAgC,IAAI,QAAM,aAAW,GAAQ,aAAW,OAFxE,EADI,UAKX,cACK,EAAK,4CAA4C,IADtD,IAEE,kB,4EAMA,WACN,EACA,GAFM,gHAIgC,gBAAc,KAAK,UAAU,YAA3D,EAJF,EAIE,aAAc,EAJhB,EAIgB,YAJhB,SAKuB,KAAK,UAAU,oBALtC,UAKA,EALA,gDAQG,CAAC,cAAa,gBARjB,WAWF,EAAuB,SAXrB,6BAYI,cAZJ,UAYuB,EAAa,WAZpC,yEAeA,EAAsB,KAAK,KAAK,GAAK,KAAK,KAAK,IAf/C,EAgBiC,EAAe,GAhBhD,OAgBC,EAhBD,KAgBiB,EAhBjB,WAkBA,EAAoB,WAQxB,GARwB,IAEtB,EAFsB,EAEtB,iBACA,EAHsB,EAGtB,QAHsB,OAUxB,EACG,cAAc,EAAuB,IAAK,EAAgB,GAC1D,MAAK,gBAAG,EAAH,EAAG,iBAAqB,EAAxB,gCAAsC,CAC1C,mBACA,QAAO,YAAM,GAAN,CAAe,SAhCtB,UAmCoB,EAAa,QACrC,SAAC,EAAG,GAAJ,OAAuB,EAAE,MAAK,YAAK,OAAI,EAAkB,EAAO,QAChE,EAAkB,CAAE,iBAxnBE,KAAK,MAAM,KAAK,SAAW,OAAO,kBAwnBD,QAAS,IAAM,IArClE,wBAmCE,EAnCF,EAmCE,QAnCF,EAwCkB,EAAQ,QAAO,SAAC,EAAG,GAAJ,OAAW,EAAE,KAAK,GAAG,EAAE,MAAQ,EAAI,KAAlE,EAxCF,EAwCE,YAxCF,UA0CmB,EAAa,mBACpC,EAAuB,IACvB,EACA,GA7CI,6BA0CD,EA1CC,KA0CK,EA1CL,MAgDF,EAhDE,oBAoDA,IAAS,EApDT,kCAqDW,EAAa,QAAQ,GArDhC,QAqDF,EArDE,kCAsDO,IAAS,EAtDhB,kCAuDW,EAAa,QAAQ,GAvDhC,QAuDF,EAvDE,sBA6DF,IAAS,cACX,EAAO,EACE,IAAS,gBAClB,EAAO,GAhEH,kBAmEC,CAAC,EAAM,IAnER,iD,4GAsEA,WAAiB,EAAc,GAA/B,oEACF,aAAiB,kCADf,sBAEE,IAAI,MAAM,yCAFZ,gCAKC,KAAK,oCAAoC,EAAM,wBAAyB,IALzE,gD,sHAQA,WACN,GADM,kGAWkB,gBAAc,KAAK,UAAU,YAA7C,EAXF,EAWE,YAXF,SAYc,KAAK,UAAU,WAZ7B,cAYA,EAZA,gBAkBI,EAAY,mBAAmB,EAAO,IAAK,EAAM,IAAK,wBAlB1D,mBAeJ,EAfI,EAeJ,oBACA,EAhBI,EAgBJ,0BACA,EAjBI,EAiBJ,qBAME,EAA0B,SAvBxB,sBAwBF,CAAC,cAAa,eAxBZ,yCAyBI,KAAK,oCACT,aAAW,IA1BX,mDAqBJ,EArBI,KAsBJ,EAtBI,uBA8BC,CACL,aAAW,GACX,EACA,EACA,EACA,IAnCI,iD,yGAwCR,WACE,EACA,EACA,GAHF,8IAKiC,gBAAc,KAAK,UAAU,YAApD,EALV,EAKU,mBAEF,EAAmB,0BAAwB,GACzC,EAAkC,EAAlC,kBAAmB,EAAe,EAAf,WAR7B,SAUqD,QAAQ,IAAI,CAC7D,KAAK,UAAU,kBACf,KAAK,UAAU,qBACf,KAAK,UAAU,WACf,KAAK,UAAU,aAdnB,gCAUS,EAVT,KAUe,EAVf,KAU+B,EAV/B,KAUsC,EAVtC,KAiBQ,EAAe,EAAM,+BAA+B,GAKpD,GAHA,EAAqB,SAAC,GAAD,OACzB,EAAK,EAAiB,EAAS,GAAc,kBAEC,GAC1C,EAAW,QAAM,OAAO,EAAkB,GAvBlD,UAwBsB,KAAK,WAAW,GAxBtC,WAwBQ,EAxBR,SA6BM,EACF,EACA,GAJA,EA3BJ,EA2BI,iBACA,EA5BJ,EA4BI,kCAMI,EAAW,SAAC,GAAD,OACf,EAAiB,IACjB,EAAW,KAFI,SAGZ,GAHY,IAIb,MAAO,EAAkB,KAAQ,WAKT,KAAf,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,UA3CjB,oBA4CU,EAAuB,EAAmB,GAAK,GAC/C,EAAe,QAAM,OAAO,EAAkB,GA7CxD,EA8CsD,QAAM,SACtD,EACA,GAFkB,EA9CxB,EA8CY,YAKJ,EAAa,KAAK,GAAG,qBAnD7B,uBAoDY,IAAI,MACR,wCAAiC,oBAAjC,sBACY,EADZ,aArDR,yBA0DqC,QAAQ,IAAI,EAC3C,IAAmB,aAAY,UAA/B,UAA4C,EAAS,MACrD,IAAmB,aAAY,UAA/B,UAA4C,EAAS,OA5D3D,0BA0DW,EA1DX,KA0DmB,EA1DnB,KA+DU,EAAW,EAAwB,EAAxB,CACf,EAAa,EAAgC,GAAS,IAGxD,EAAc,EAAS,IAAI,GAAQ,WACnC,EAAS,OAAQ,GAAR,IAAmB,aApEhC,oBAuES,KAvET,KAwEI,EAxEJ,WAyEU,IAAmB,qBAAoB,UAAvC,UAAoD,EAAS,KAzEvE,gCA0EI,EA1EJ,uBAuEc,yBAvEd,4E,8GA+EA,WACE,GADF,gFAGiC,gBAAc,KAAK,UAAU,YAApD,EAHV,EAGU,mBAHV,KAKS,KALT,SAMU,EAAmB,oBAAoB,WAAvC,KAAuD,GAAa,GAN9E,iDAKc,kBALd,iE,sFAWA,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,kBAAmB,QAAU,EAAW,K,gCAIpE,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,mBAAoB,QAAU,EAAW,K,wBAIrE,SACE,EACA,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,WAAY,GAAU,EAAkB,K,uBAIpE,SACE,EACA,GAEA,OAAO,KAAK,YAAY,CAAE,UAAW,QAAU,EAAW,K,oDAI5D,WACE,EACA,EACA,GAHF,4IAKQ,EAAU,kBAAgB,KAAK,UAAU,WAAY,GAL7D,EAMiC,gBAAc,KAAK,UAAU,YAApD,EANV,EAMU,mBAEF,EAAmB,4BAA0B,GAC3C,EAAiE,EAAjE,kBAAmB,EAA8C,EAA9C,mBAAoB,EAA0B,EAA1B,WAAY,EAAc,EAAd,UAT7D,SAWiC,QAAQ,IAAI,CACzC,KAAK,UAAU,SAAS,GACxB,GACE,mBAAiB,CACf,KAAM,KAAK,UAAU,kBACrB,eAAgB,KAAK,UAAU,qBAC/B,MAAO,KAAK,UAAU,WACtB,MAAO,KAAK,UAAU,eAlB9B,gCAWS,EAXT,KAWgB,EAXhB,KA8BQ,GARA,EAAqB,SAAC,GAAD,OAClB,OAAP,QAAO,IAAP,OAAO,EAAP,EACI,KACA,EAAQ,eAAiB,EACzB,EAAQ,MAAM,+BAA+B,EAAQ,QAEtD,kBAE2C,GAC1C,EAAgB,EAAM,OAAO,EAAkB,GA/BvD,UAgCsB,KAAK,WAAW,EAAe,GAhCrD,WAgCQ,EAhCR,SAqCM,EACF,EACA,GAJA,EAnCJ,EAmCI,iBACA,EApCJ,EAoCI,kCAMI,EAAW,SAAC,G,MAA4E,OAC5F,EAAiB,KACE,OAAlB,QAAkB,IAAlB,IAAsB,UAAQ,MAAM,KACb,QAAxB,EAAW,OAAV,QAAU,IAAV,IAAc,SAAS,QAAI,UAAQ,MAAM,MACxC,GAJ0F,SAKzF,GALyF,IAM1F,MAAwB,OAAjB,QAAiB,IAAjB,OAAiB,EAAjB,EAAmB,KAAQ,WAKV,KAAf,OAAT,QAAS,IAAT,OAAS,EAAT,EAAW,UArDjB,oBAsDU,EAAuB,EAAmB,GAAK,GAC/C,EAAe,EAAM,OAAO,EAAkB,GAvDxD,EAwDsD,EAAM,SACtD,EACA,GAFkB,EAxDxB,EAwDY,YAKJ,EAAa,KAAK,GAAG,qBA7D7B,uBA8DY,IAAI,MACR,wCAAiC,oBAAjC,sBACY,EADZ,aA/DR,yBAoEqC,QAAQ,IAAI,EAC3C,IAAmB,aAAY,YAA/B,UAA8C,EAAS,KACvD,IACE,IAAmB,aAAY,YAA/B,UAA8C,EAAS,OAvE/D,0BAoEW,EApEX,KAoEmB,EApEnB,KA0EQ,EAAW,EAAa,EAAgC,GAAS,GAEjE,IACF,EAAW,EAAwB,EAAxB,CAA2D,IAGxE,EAAc,EAAS,IAAI,GAAQ,WACnC,EAAS,OAAQ,GAAR,IAAmB,aAjFhC,oBAoFS,KApFT,KAqFI,EArFJ,WAsFU,IAAmB,qBAAoB,YAAvC,UAAsD,EAAS,KAtFzE,gCAuFI,EAvFJ,uBAoFc,yBApFd,4E,0HA4FA,WACE,GADF,gFAGiC,gBAAc,KAAK,UAAU,YAApD,EAHV,EAGU,mBAHV,KAKS,KALT,SAMU,EAAmB,oBAAoB,gBAAvC,KAA4D,GAAa,GANnF,iDAKc,uBALd,iE,wGAWA,WACE,EACA,GAFF,4EAIwB,gBAAc,KAAK,UAAU,YAA3C,EAJV,EAIU,UAEH,sBAAoB,GAN3B,sBAOU,IAAI,MAAM,wDAPpB,mBAUS,KAVT,SAWU,EAAU,oBAAoB,SAA9B,KAA4C,GAAa,EAAI,UAAQ,KAAK,GAAO,KAX3F,iDAUc,uBAVd,iE,2GAgBA,WACE,EACA,GAFF,4EAI2B,gBAAc,KAAK,UAAU,YAA9C,EAJV,EAIU,cAEJ,MAAM,QAAQ,GANpB,4BAOW,KAPX,SAQY,EAAa,oBAAoB,qBAAjC,KACC,GACL,EACA,GAXR,iDAOgB,iBAPhB,oCAeW,KAfX,UAgBY,EAAa,oBAAoB,UAAjC,KACC,GACL,EACA,GAnBR,kDAegB,iBAfhB,kE,+GA0BA,WACE,EACA,GAFF,gFAI2B,gBAAc,KAAK,UAAU,YAA9C,EAJV,EAIU,aAJV,KAMS,KANT,SAOU,EAAa,oBAAoB,gBAAjC,KACC,GACL,EACA,GAVN,iDAMc,iBANd,iE,4HAgBA,WACE,EACA,EACA,GAHF,oFAK4B,gBAAc,KAAK,UAAU,YAA/C,EALV,EAKU,cACF,EAAc,UAAQ,KAAK,GANnC,KAQS,KART,KASI,CAAE,eATN,SAUU,EAAc,oBAAoB,YAAlC,KACC,GACL,EACA,EAAY,IACwC,QADrC,EACJ,OAAX,QAAW,IAAX,IAAe,KAAK,UAAU,WAAW,mBAAW,QAAI,eAd9D,iDAQc,2BARd,sE,iIAoBA,WACE,EACA,GAFF,gFAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,KAMS,KANT,SAOU,EAAc,oBAAoB,eAAlC,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,gCANd,iE,gIAgBA,WACE,GADF,gFAG4B,gBAAc,KAAK,UAAU,YAA/C,EAHV,EAGU,cAHV,KAKS,KALT,SAMU,EAAc,oBAAoB,eAAlC,KACC,GACL,EACA,UAAQ,KAAK,KATnB,iDAKc,kCALd,iE,6HAeA,WACE,GADF,4FAGQ,EAAU,kBAAgB,KAAK,UAAU,WAAY,GAH7D,EAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,SAMiD,QAAQ,IAAI,CACzD,KAAK,UAAU,SAAS,GACxB,KAAK,UAAU,oBAAoB,KARvC,gCAMS,EANT,KAMuB,EANvB,KAWQ,EAAa,EAAa,cAAc,EAAiB,gBAXjE,KAaS,KAbT,MAcU,IAAc,qBAAoB,uBAd5C,kBAeW,GACL,EAAQ,EAAiC,IAhB/C,iBAiBgB,KAAK,WAAW,EAAY,GAjB5C,4KAac,4BAbd,kE,wGAuBA,WACE,EACA,EACA,GAHF,gFAKwB,gBAAc,KAAK,UAAU,YAA3C,EALV,EAKU,UALV,KAOS,KAPT,SAQU,EAAU,oBAAoB,SAA9B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAZ3B,iDAOc,uBAPd,iE,4GAkBA,WACE,EACA,EACA,GAHF,gFAKwB,gBAAc,KAAK,UAAU,YAA3C,EALV,EAKU,UALV,KAOS,KAPT,SAQU,EAAU,oBAAoB,SAA9B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAZ3B,iDAOc,uBAPd,iE,8GAkBA,WACE,EACA,EACA,GAHF,6GAK2B,gBAAc,KAAK,UAAU,YAA9C,EALV,EAKU,aACF,EAAsB,UAAQ,KAAK,GAN3C,SAYY,QAAQ,IAAI,CACpB,KAAK,UAAU,UACf,KAAK,UAAU,WACf,KAAK,qBAAqB,KAf9B,4BASI,EATJ,KAUI,EAVJ,eAWK,EAXL,KAWsB,EAXtB,KAW8C,EAX9C,YAkBM,EAAgB,OAlBtB,uBAmBU,IAAI,MAAJ,6DACkD,wBADlD,MAnBV,eAwBQ,EAA2B,SAAC,GAAD,OAC/B,UAAQ,IACN,EAAK,eAAe,EAAO,IAAI,EAAM,OAAO,IAAI,GAChD,UAAQ,MAGN,EA9BR,2BA8B6B,WACzB,EACA,GAFyB,8FAGzB,EAHyB,+BAGE,EAC3B,EAJyB,+BAIsB,CAAC,cAAa,cAAa,GAEpE,OACkB,IAAtB,EACI,UAAQ,KAAK,GACb,EAAyB,GATN,KAWd,EAXc,UAYjB,IAAa,qBAAoB,iBAAjC,cACC,GACL,IACA,EAAgB,IAChB,GAJI,SAKD,GALC,CAMJ,uBACA,EAA2B,OAnBN,+BAsBvB,EAAK,UAAU,WAtBQ,KAuBvB,EAvBuB,KAwBvB,EAxBuB,KA0BvB,EAAgB,GAAG,GACf,YAAoB,OAClB,EACE,EAAgB,IAAI,yBACA,OAApB,QAAoB,IAApB,IAAwB,SAE5B,EAhCmB,kGA9B7B,0EAkES,EAAmB,EAAqB,EAAmB,EAAiB,IAlErF,iD,6GAsEA,WACE,EACA,GAFF,gFAI0B,gBAAc,KAAK,UAAU,YAA7C,EAJV,EAIU,YAJV,KAMS,KANT,SAOU,EAAY,oBAAoB,MAAhC,KAA2C,GAAa,EAAI,UAAQ,KAAK,GAAQ,KAP3F,iDAMc,uBANd,iE,6GAYA,WACE,EACA,GAFF,gFAI0B,gBAAc,KAAK,UAAU,YAA7C,EAJV,EAIU,YAJV,KAMS,KANT,SAOU,EAAY,oBAAoB,QAAhC,KAA6C,GAAa,EAAI,UAAQ,KAAK,GAAQ,KAP7F,iDAMc,uBANd,iE,+FAYA,SACE,GAEA,OAAO,KAAK,YAAY,UAAQ,KAAM,K,yDAIxC,WACE,EACA,GAFF,gFAI4B,gBAAc,KAAK,UAAU,YAA/C,EAJV,EAIU,cAJV,KAMS,KANT,SAOU,EAAc,oBAAoB,iBAAlC,KACC,GACL,EACA,UAAQ,KAAK,GAAc,KAVjC,iDAMc,uBANd,iE,+GAgBA,WACE,EACA,EACA,GAHF,0EAKS,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,WAAY,IALzD,EAMuB,gBAAc,KAAK,UAAU,YAA1C,EANV,EAMU,SAEH,kBAAgB,GARvB,sBASU,IAAI,MAAM,6DATpB,mBAYS,KAZT,SAaU,EAAS,oBAAoB,KAA7B,KACC,GACL,EACA,EACA,UAAQ,KAAK,GAAQ,KAjB3B,iDAYc,uBAZd,iE,oHAuBA,WACE,EACA,GAFF,kFAIgC,gBAAc,KAAK,UAAU,YAAnD,EAJV,EAIU,SAAU,EAJpB,EAIoB,QAJpB,KAMS,KANT,SAOU,EAAS,oBAAoB,QAA7B,KACC,GACL,EACA,EAAQ,QACR,UAAQ,KAAc,OAAT,QAAS,IAAT,IAAa,UAAQ,UAAU,KAXlD,iDAMc,uBANd,iE,gHAiBA,WACE,EACA,GAFF,gFAIsB,gBAAc,KAAK,UAAU,YAAzC,EAJV,EAIU,QAJV,KAMS,KANT,SAOU,EAAQ,oBAAoB,MAA5B,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,uBANd,iE,kHAgBA,WACE,EACA,GAFF,gFAIsB,gBAAc,KAAK,UAAU,YAAzC,EAJV,EAIU,QAJV,KAMS,KANT,SAOU,EAAQ,oBAAoB,SAA5B,KACC,GACL,EACA,UAAQ,KAAK,GAAQ,KAV3B,iDAMc,uBANd,iE,uIAgBA,WACE,GADF,gFAGsB,gBAAc,KAAK,UAAU,YAAzC,EAHV,EAGU,QAHV,KAKS,KALT,SAMU,EAAQ,oBAAoB,YAA5B,KAA6C,GAAa,GANpE,iDAKc,uBALd,iE,mHAWA,WACE,GADF,gFAGsB,gBAAc,KAAK,UAAU,YAAzC,EAHV,EAGU,QAHV,KAKS,KALT,SAMU,EAAQ,oBAAoB,iBAA5B,KACC,GACL,GARN,iDAKc,uBALd,iE,8DA55BF,8B,oJCtcA,IAAM,EAAkB,SAAI,GAAJ,OAAiD,EAAG,QAO/D,E,WAIT,SAAF,EAAY,GAAqC,UAC/C,KAAK,UAAY,E,8DAInB,WACE,EACA,EACA,GAHF,wFAKS,KAAK,UACT,UAAU,EAAQ,EAAkC,GACpD,KAAK,IAPV,gD,mFAWA,SACE,GAEA,OAAO,KAAK,UAAU,WAAW,GAAW,KAAK,K,yBAInD,SACE,EACA,EACA,GAEA,OAAO,KAAK,UACT,YAAY,EAAQ,EAAkC,GACtD,KAAK,K,+BAIV,SACE,EACA,GAEA,OAAO,KAAK,UAAU,kBAAkB,EAAQ,GAAW,KAAK,K,gCAIlE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,mBAAmB,EAAQ,GAAW,KAAK,K,wBAInE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,WAAW,EAAQ,EAAkB,GAAW,KAAK,K,uBAI7E,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAQ,GAAW,KAAK,K,sBAI1D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAO,GAAW,KAAK,K,uBAIxD,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAS,GAAW,KAAK,K,2BAI3D,SACE,EACA,GAEA,OAAO,KAAK,UACT,cAAc,EAAkC,GAChD,KAAK,K,wCAIV,SACE,EACA,EACA,GAEA,OAAO,KAAK,UACT,2BAA2B,EAAQ,EAAa,GAChD,KAAK,K,2CAIV,SACE,EACA,GAEA,OAAO,KAAK,UAAU,8BAA8B,EAAQ,GAAW,KAAK,K,4CAI9E,SACE,GAEA,OAAO,KAAK,UAAU,+BAA+B,GAAW,KAAK,K,2CAIvE,SACE,GAEA,OAAO,KAAK,UAAU,8BAA8B,GAAW,KAAK,K,sBAItE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAW,EAAQ,GAAW,KAAK,K,sBAIpE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,SAAS,EAAW,EAAQ,GAAW,KAAK,K,wBAIpE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,WAAW,EAAQ,EAAmB,GAAW,KAAK,K,oCAI9E,SACE,GAEA,OAAO,KAAK,UAAU,uBAAuB,GAAW,KAAK,K,uBAI/D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,UAAU,EAAQ,GAAW,KAAK,K,yBAI1D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,YAAY,EAAQ,GAAW,KAAK,K,sCAI5D,SACE,GAEA,OAAO,KAAK,UAAU,yBAAyB,GAAW,KAAK,K,8BAIjE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAc,GAAW,KAAK,K,2BAIvE,SACE,EACA,EACA,GAEA,OAAO,KAAK,UAAU,cAAc,EAAQ,EAAS,GAAW,KAAK,K,8BAIvE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAW,GAAW,KAAK,K,4BAIpE,SACE,EACA,GAEA,OAAO,KAAK,UAAU,eAAe,EAAQ,GAAW,KAAK,K,8BAI/D,SACE,EACA,GAEA,OAAO,KAAK,UAAU,iBAAiB,EAAQ,GAAW,KAAK,K,mDAIjE,SACE,GAEA,OAAO,KAAK,UAAU,sCAAsC,GAAW,KAAK,K,iCAI9E,SACE,GAEA,OAAO,KAAK,UAAU,oBAAoB,GAAW,KAAK,O,KA9O9D,2B,2qBClCA,IAAI,EAAJ,QAEa,sBAAsB,qBAAwC,GAO9D,uBAA4D,YAIpE,IAHH,EAGG,EAHH,MACA,EAEG,EAFH,OACA,EACG,EADH,SACG,EACmC,aADnC,SACI,EADJ,KACiB,EADjB,KAcD,OAXA,EAAF,WAAU,WACR,EAAM,SAAW,kBAAM,EAAe,IACtC,IAAM,EAAO,EAAM,QAEnB,OAAO,WACL,EAAM,cAAW,EACjB,OAAe,GACf,OAED,CAAC,IAEC,EAIE,wBAAC,sBAAoB,SAAQ,CAAC,MAAO,GAAc,GAHjD,gDAAG,K,kGC3Bd,IAGM,EAAgB,SAAC,EAAkB,GACrC,IAAI,EAAQ,OAAO,KAAK,GACpB,EAAQ,OAAO,KAAK,GAE1B,OACE,EAAM,SAAW,EAAM,QACvB,EAAM,OAAM,YAAG,OATI,SAAC,EAAkB,GAAnB,OACrB,OAAO,UAAU,eAAe,KAAK,EAAG,GAQnB,CAAe,EAAG,IAAQ,OAAO,GAAG,EAAE,GAAM,EAAE,QAI/D,EAAW,SAAC,GAAD,OAA0C,OAAN,GAA2B,kBAAN,GAE7D,SAAS,SAAC,EAAY,GAAb,OACpB,EAAS,IAAM,EAAS,GAAK,EAAc,EAAG,GAAK,OAAO,GAAG,EAAG,K,kCClBlE,iFAMO,MAAMC,EAUXC,YAAYC,EAAaC,EAA0BC,EAAwB,KAAM,KAThEF,SAS+D,OARxEG,GAAa,EAQ2D,KAN/DC,YAM+D,OAL/DC,kBAK+D,OAH/DH,eAG+D,OAFxEI,YAAa,EAGnBC,KAAKP,IAAMA,EACXO,KAAKH,OAASI,SAAOC,eACrBF,KAAKF,aAAe,IAAIG,SAAOP,GAC/BM,KAAKL,UAAYQ,UAAQC,KAAKT,GAGxBU,WAAWhB,GACjB,MAAMQ,EAAS,CAACG,KAAKH,OAAQG,KAAKF,cAAcQ,MAC9CT,GAAUA,EAAOR,QAAQkB,gBAAkBlB,EAAQkB,gBAKrD,IAAKV,EACH,MAAM,IAAIW,MAAO,kBAAiBnB,KAGpC,OAAOQ,EAGS,aAChB,OAAOG,KAAKS,KAAK,sBAAuB,CACtC,CACEL,KAAMJ,KAAKF,aAAaT,QACxBqB,GAAIV,KAAKH,OAAOR,QAChBsB,MAAOX,KAAKL,UAAUiB,IACtBC,IAAKC,kBAAQ,SAOT,WAACC,EAAgBC,GAMzB,OALKhB,KAAKD,aACRC,KAAKD,YAAa,QACZC,KAAKiB,QAGLF,GACN,IAAK,eACL,IAAK,sBACH,MAAO,CAACf,KAAKH,OAAOR,SACtB,IAAK,uBAAwB,CAC3B,MAAM6B,EAA4BlB,KAAKK,WAAWW,EAAO,IAAIG,WAAWC,MAAM,GACxED,EAAaE,EAAOjB,KAAKc,EAA2B,OAM1D,aALwBI,wBAAc,CACpCH,aACAI,KAAMC,KAAKC,MAAMT,EAAO,IACxBU,QAASC,uBAAqBC,KAKlC,IAAK,sBACH,OAAO5B,KAAKS,KACV,+BACMoB,QAAQC,IACZd,EAAOe,KAAIC,OAAS5B,OAAM6B,QAAOpB,SAAQqB,WACzBC,IAAVF,IACFA,QAAcjC,KAAKS,KAAK,0BAA2B,CAACL,KAG/CJ,KAAKK,WAAWD,GAAMgC,gBAAgB,CAC3ChC,OACA6B,gBACYE,IAARtB,EAAoB,CAAEwB,SAAUxB,GAAQ,MACzCqB,SASf,MAAMI,QAAiBC,MAAMvC,KAAKP,IAAK,CACrCsB,OAAQ,OACRyB,QAAS,CACP,eAAgB,oBAElBC,KAAMjB,KAAKkB,UAAU,CACnB3B,OAAQA,EACRC,OAAQA,EACRpB,GAAII,KAAKJ,KACT+C,QAAS,UAIPC,QAAaN,EAASM,OAI5B,GAAIA,EAAKC,MAAO,CACd,MAAM,QAAEC,KAAYZ,GAASU,EAAKC,MAC5BA,EAAQ,IAAIrC,MAAO,GAAEsC,KAAWtB,KAAKkB,UAAUR,MACrD,MAAMa,OAAOC,OAAOH,EAAOX,GAG7B,OAAOU,EAAKK,OAGdC,SAAQ,OAAEnC,EAAF,OAAUC,IAChB,OAAOhB,KAAKS,KAAKM,EAAQC,O,q0NCxH7B,YAKA,QACA,OAEA,SAEM,EAAmB,CACrB,EAAC,6CACD,EAAC,6CACH,EAAG,6CACH,EAAG,6CACH,GAAI,8CAMA,EAAe,CACnB,CACI,KAAI,WACJ,KAAI,YACJ,gBAAe,aACf,UAAQ,EACR,SAAO,EAEP,OAAM,CACN,CACM,WAAQ,CACV,CACE,KAAM,SACN,KAAM,WAER,CACE,KAAM,WACN,KAAM,UAGN,KAAE,QACF,KAAE,YAIR,QAAO,CACP,CACE,KAAM,cACN,KAAM,WAER,CACE,KAAM,aACN,KAAM,aAKZ,CACI,KAAI,WACJ,KAAI,gBACJ,gBAAe,OACf,UAAQ,EACR,SAAO,EAEP,OAAM,CACN,CACE,KAAM,OACN,KAAM,YAIV,QAAS,CACP,CACE,KAAM,UACN,KAAM,cAsDR,EAAgB,SAAC,GAAD,YACC,IAArB,EAAQ,eAA+C,IAArB,EAAQ,eAA4C,IAAlB,EAAQ,OAExE,EAAc,SAAC,EAAqC,GAAtC,OAClB,EAAQ,KAAO,GACS,kBAAjB,EAAQ,MACf,EAAQ,KAAK,WAAW,eAOpB,EAA0B,GAEnB,oBAAoB,SAAC,GAAD,OAC/B,EAAiB,MAAK,YAAe,OAAI,aAAoB,MAElD,UAAU,SAAiD,GACpE,IAAI,EAAe,8BAAG,qC,2BACtB,gBAAkB,GAEZ,EAAN,SAAW,EAGL,EAAN,SArCoC,CAAE,MAAO,GAAI,UAAW,IAuCtD,EAAN,sBAAwB,EAClB,EAAN,qBAAuB,EATD,EAAH,+BAYnB,WACE,OAAO,KAAK,UAbK,IAgBnB,SAAY,GACF,GAAJ,KAAK,WACP,MAAM,IAAI,MAAM,8BApJH,SAAC,GAAD,OACnB,KAAW,GAsJH,CAAa,KACf,KAAK,WAAa,IAAI,WAAS,EAAiB,GAAU,EAAc,OAGlE,KAAH,SAAW,IAzBC,uDA4BnB,+FACyC,KAAK,SAApC,EADV,EACU,MAAO,EADjB,EACiB,UAAW,EAD5B,EAC4B,SAC1B,KAAK,SA7D6B,CAAE,MAAO,GAAI,UAAW,IA2D5D,WAMM,EAAM,OAAS,GANrB,gCAOgB,KAAK,WAAY,WAAW,UAAU,EAAO,CAAE,aAAY,MAC/D,YAAC,OAAI,EAAE,cARnB,mGAU4B,CAAE,GAAI,EAAM,GAAG,OAAQ,KAAM,EAAM,GAAG,UAAY,GAV9E,wCAKU,EALV,KAYI,EAAU,SAAQ,WAAY,GAAZ,OAAkB,EAAlB,WAA0B,EAAQ,OAZxD,kDAcI,EAAU,SAAQ,mBAAgB,EAAhB,WAAsB,SAd5C,0DA5BmB,gFA8CnB,SAAa,GAAiB,WAQ5B,YAPwB,IAApB,KAAK,YACP,aAAa,KAAK,YAGpB,KAAK,SAAS,MAAM,KAAK,GACzB,KAAK,WAAa,YAAW,kBAAM,EAAK,mBAAkB,KAAK,iBAExD,IAAI,SAAQ,SAAC,EAAS,GAAV,OAAqB,EAAK,SAAS,UAAU,KAAK,CAAC,EAAS,SAtD9D,8CAyDnB,SAAiC,G,MAC/B,OACiC,IAA/B,KAAK,SAAS,MAAM,SACX,OAAR,QAAQ,IAAR,IAAY,aAAqC,QAAvB,EAAC,KAAK,SAAS,gBAAQ,QAAI,YA5DvC,6CAgEnB,WACE,EACA,GAFF,gFAIO,KAAK,WAJZ,iFAKsB,EAAS,IAL/B,OAOU,GAAM,IAAI,MAAO,eAEY,IAA/B,KAAK,sBACP,KAAK,sBAAwB,EAEG,EAAM,KAAK,uBAEZ,KAAS,KAAK,uBAO3C,KAAK,sBAAwB,EAC7B,KAAK,qBAAuB,EAC5B,KAAK,sBAAwB,GAvBrC,uBA4BoD,QAAQ,IAAI,CAC5D,oBAAkB,GAClB,IA9BJ,4BA4BS,EA5BT,KA4B0B,EA5B1B,MAkCI,EAAY,EAAiB,KAAK,WAAW,UAC5C,EAAc,KACf,KAAK,iCAAiC,GApC1C,wBAsCI,KAAK,uBAtCT,0DAwCsB,EAAiB,IAxCvC,eA0CI,KAAK,wBAE8B,IAA/B,KAAK,SAAS,MAAM,SACtB,KAAK,SAAS,SAAW,GA7C/B,kBAgDW,KAAK,aAAa,CAAE,OAAQ,EAAgB,GAAK,SAAU,EAAgB,QAhDtF,iDAhEmB,4GAoHnB,WACE,EACA,GAFF,iGAI0D,QAAQ,IAAI,CAAC,EAAe,IAJtF,4BAIS,EAJT,KAIgC,EAJhC,KAMO,YAAU,IAA2B,KAAK,WANjD,uFAO4B,EAAuB,IAPnD,wBAU0B,KAAK,WAAW,UAAU,cAAc,EAAuB,CACrF,SAAU,IAXd,iCAUS,EAVT,uBAcS,GAdT,iDApHmB,8DAAiB,GAwItC,OAFA,EAAiB,KAAK,GAEf,GAGI,wCAAwC,UAAQ,mC,4XC/R7D,gBAEA,SAEA,SAuNM,EAAuB,SAC3B,EACA,GAF2B,MAGD,CAC1B,KAAM,kBACN,eACI,MAAJ,IAGI,EAAgB,SAAI,GAAJ,MAA0D,CAC9E,KAAM,WACF,OAAJ,IAGI,EAAe,SAAI,GAAJ,MAAwD,CAC3E,KAAM,UACN,WAGI,EAAkB,SACtB,EACA,GAFsB,MAGE,CACxB,KAAM,aACN,SACI,UAAJ,IAGI,EAAiB,SAAI,GAAJ,YACR,IAAb,EAAM,IASF,EAA8D,CAClE,oBACA,cAeF,IAaM,EAAa,yBAAK,EAAL,KAAQ,EAAR,WAA8C,CAAC,EAAG,UAAQ,KAAK,KAC5E,EAAU,6BAAwC,QAG3C,0BAA0B,SACrC,GAEE,IAAI,EAAiB,OAAO,QAAQ,GAAQ,OAAO,GAInD,OApCJ,SACE,GAEE,IAAI,EAAU,EACb,QAAO,YAAI,IAAF,EAAF,UAAI,OAAO,EAAsC,SAAS,MACjE,KAAI,YAAI,IAAF,EAAF,UAAI,MAAJ,WAAa,EAAb,QAEL,GAAE,EAAQ,OAAS,EACnB,MAAM,IAAI,MAAJ,wCAA2C,EAAQ,KAAK,MAAxD,iBAyBN,CAA4B,GArBO,SACrC,GAEE,IAAI,EAAS,OAAO,YAAY,GAC5B,EAAc,EAAyB,QAAO,YAAC,QAAM,KAAK,MAAS,KAAI,YAAC,iBAAQ,EAAR,QAE5E,GAAE,EAAY,OAAS,EACnB,MAAE,IAAI,MAAJ,wCAA2C,EAAY,KAAK,MAA5D,aAGN,OAAK,EAcA,CAFgB,EAAe,IAAI,KAK5C,IAAM,EAAkE,CACtE,oBACA,qBACA,aACA,aAeF,IAuCM,EAAmC,SACvC,GAEA,IAAM,EAAS,OAAO,YAAY,GAI5B,EA9CqB,YAGiE,IAF5F,EAE4F,EAF5F,kBACA,EAC4F,EAD5F,mBAEE,QAAwB,IAAtB,QAA0D,IAAvB,EACrC,MAAM,IAAI,MACR,yGAKF,YAAwB,IAAtB,EACK,CAAE,0BAGgB,IAAvB,EACK,CAAE,2BADT,EA+BuB,CAAqB,GACxC,EA3Be,YAGiE,IAFtF,EAEsF,EAFtF,WACA,EACsF,EADtF,UAEE,QAAiB,IAAf,QAA0C,IAAd,EAC9B,MAAM,IAAI,MACR,yFAIF,YAAiB,IAAf,EACK,CAAE,mBAGO,IAAd,EACK,CAAE,kBADT,EAaiB,CAAe,GAElC,QAAyB,IAArB,QAAiD,IAAf,EACpC,cAAY,GAAqB,GAGnC,QAAyB,IAArB,EACF,OAAO,EAGP,QAAiB,IAAf,EACE,OAAG,EAGP,MAAI,IAAI,MAAM,wEAIL,4BAA4B,SACvC,GAEE,IAAI,EAAiB,OAAO,QAAQ,GAAQ,OAAO,IAhFvD,SACE,GAEE,IAAI,EAAU,EACb,QAAO,gBAAE,EAAF,iBAAW,EAAwC,SAAS,MACnE,KAAI,gBAAE,EAAF,2BAAa,EAAb,QAEL,GAAE,EAAQ,OAAS,EACnB,MAAM,IAAI,MAAJ,0CAA6C,EAAQ,KAAK,MAA1D,iBAyEN,CAA8B,GAC9B,IAAI,EAAiB,EAAe,IAAI,GAAY,OAAO,GAE7D,OAAO,EAAiC,IAG1C,IAAM,EAAW,SAAC,EAA2B,GAA5B,OACf,EAAa,IAAI,UAAQ,IAAI,IAAI,KAE7B,EAAa,SAAC,EAA2B,GAA5B,OACjB,EAAa,SAAS,UAAQ,IAAI,IAAI,KAElC,EAAqC,UAAQ,KAAK,KAO3C,E,WAQT,SAAF,IAA0D,IAA9C,EAA8C,uDAAjC,UAAQ,KAAM,EAAmB,uDAAZ,UAAQ,KAAI,UACpD,KAAC,WAAa,EACd,KAAC,KAAO,E,+BAGd,WACE,OAAO,KAAK,WAAW,QAAU,KAAK,KAAK,S,mBAS7C,WACE,GAAI,KAAK,KAAK,GAAG,4BACf,MAAM,IAAI,MAAJ,iDAAoD,6BAG5D,OAAO,KAAK,KAAK,IAAI,8B,mCAIvB,WACE,OAAO,KAAK,WAAW,OAAO,EAAoC,KAAK,Q,6BAIzE,SAAgB,GACd,OAAO,KAAK,WAAW,OAAO,EAAO,KAAK,Q,2CAU5C,SAA8B,GAC5B,OAAO,KAAK,gBAAgB,GAAO,GAAG,8B,4CAoBxC,SAA+B,GAC7B,OAAO,KAAK,gBAAgB,GAAO,GAAG,+B,sCAIxC,SAAyB,GACvB,OAAO,KAAK,gBAAgB,GAAO,IAAI,+B,sBAIzC,WACE,8BAAwB,KAAK,WAA7B,mBAAkD,KAAK,KAAvD,Q,oBAGF,SAAO,GACL,OAAO,KAAK,WAAW,GAAG,EAAK,aAAe,KAAK,KAAK,GAAG,EAAK,Q,iBAGlE,SAAI,GACF,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,EAAK,YAAa,KAAK,KAAK,IAAI,EAAK,S,2BAG5E,SAAc,GACZ,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,GAAa,KAAK,Q,qBAGzD,SAAQ,GACN,OAAO,IAAI,EAAM,KAAK,WAAY,KAAK,KAAK,IAAI,M,sBAGlD,SAAS,GAAW,IACV,EAAqB,EAArB,WAAY,EAAS,EAAT,KAEpB,OAAO,IAAI,EACT,KAAK,WAAW,GAAG,GAAc,KAAK,WAAW,IAAI,GAAc,UAAQ,KAC3E,KAAK,KAAK,GAAG,GAAQ,KAAK,KAAK,IAAI,GAAQ,UAAQ,Q,gCAIvD,SAAmB,GACjB,OAAO,IAAI,EACT,KAAK,WAAW,GAAG,GAAc,KAAK,WAAW,IAAI,GAAc,UAAQ,KAC3E,KAAK,Q,0BAIT,SAAa,GACX,OAAO,IAAI,EAAM,KAAK,WAAY,KAAK,KAAK,GAAG,GAAQ,KAAK,KAAK,IAAI,GAAQ,UAAQ,Q,sBAGvF,SAAS,GACP,OAAO,IAAI,EAAM,KAAK,WAAW,IAAI,GAAa,KAAK,KAAK,IAAI,M,2BAGlE,SAAc,GACZ,OAAO,IAAI,EAAM,UAAQ,KAAK,GAAa,KAAK,Q,qBAGlD,SAAQ,GACN,OAAO,IAAI,EAAM,KAAK,WAAY,UAAQ,KAAK,M,yBAGzC,WAA6B,GAAyB,IAAxC,EAAwC,EAAxC,KACpB,OAAO,EAAK,GAAG,KAAK,MAChB,CAAE,WAAY,EAAW,EAAe,EAAK,IAAI,KAAK,QACtD,CAAE,UAAW,KAAK,KAAK,IAAI,M,+BAGzB,YAAuC,IAAnB,EAAmB,EAAnB,WAC1B,OAAO,EAAW,GAAG,KAAK,YACtB,CAAE,kBAAmB,EAAW,IAAI,KAAK,aACzC,CAAE,mBAAoB,KAAK,WAAW,IAAI,M,yBAYhD,SACE,GACkD,I,EAAlD,EAAkD,uDAAtB,yBAE5B,IAAI,KAAK,WAAW,GAAG,EAAK,cAAe,KAAK,KAAK,GAAG,EAAK,MAI7D,OAAI,KAAK,QACH,EAAK,KAAK,GAAG,4BACR,EAAqB,EAAM,6BAG7B,EAAc,CACnB,kBAAmB,EAAK,WACxB,WAAY,EAAW,EAAe,EAAK,WAI3C,EAAK,QACA,EACL,KAAK,QAAQ,QACT,CAAE,mBAAoB,KAAK,WAAY,UAAW,KAAK,SACvD,CAAE,mBAAoB,KAAK,aAI5B,KAAK,WAAW,GAAG,EAAK,YAC3B,EAAyB,KAAK,YAAY,EAAM,GAAgB,EAAK,KAAK,MAAQ,QAClF,KAAK,KAAK,GAAG,EAAK,MAClB,EAAyB,KAAK,kBAAkB,GAAO,EAAK,WAAW,MAAQ,cAC/E,EAAe,OAER,KAAK,YAAY,EAAM,IACvB,KAAK,kBAAkB,IAEF,QADzB,EACA,EAAK,KAAK,MAAQ,cAAO,QAAK,EAAK,WAAW,MAAQ,gB,mBAU/D,SACE,GACkD,IAAlD,EAAkD,uDAAtB,yBAE5B,IAAK,EACH,OAAO,KAGT,OAAQ,EAAO,MACb,IAAK,kBACH,IAAK,KAAK,QACR,MAAM,IAAI,MAAM,oCAGlB,OAAO,EAAO,aAEhB,IAAK,WACH,IAAK,KAAK,QACR,MAAM,IAAI,MAAM,oCAFH,MAK2B,EAAO,OAAzC,EALO,EAKP,kBAAmB,EALZ,EAKY,WAE3B,OAAO,IAAI,EACT,EACA,2BAAyB,IAAI,EAAS,EAAe,KAIzD,IAAK,UACH,GAAI,KAAK,QACP,MAAM,IAAI,MAAM,2BAGlB,OAAO,cAET,IAAK,aAAc,IAEf,EAEE,EAFF,UAFe,EAIb,EADF,OAAU,EAHK,EAGL,kBAAmB,EAHd,EAGc,mBAAoB,EAHlC,EAGkC,WAAY,EAH9C,EAG8C,UAGzD,EAAuC,OAAlB,QAAkB,IAAlB,IAAsB,UAAQ,KACnD,EAAsC,OAAjB,QAAiB,IAAjB,IAAqB,UAAQ,KAClD,EAAwB,OAAT,QAAS,IAAT,IAAa,UAAQ,KACpC,EAAe,EAAa,EAAS,EAAe,GAAc,UAAQ,KAEhF,MAAqB,eAAd,EACH,KAAK,cAAc,UAAQ,MAAM,QAAQ,GAAc,aAAa,GACtD,SAAd,EACA,KAAK,QAAQ,UAAQ,MAClB,cAAc,GACd,mBAAmB,GACtB,KAAK,IAAI,IAAI,EAAM,EAAoB,IAAe,SACpD,IAAI,EAAM,EAAoB,O,oBAoC1C,SAAO,EAA2C,GAChD,OAAO,KAAK,MAAM,EAAgB,4BAA0B,IAAU,K,sBAUxE,SAAS,EAAa,GACpB,IAAM,EAAS,KAAK,YAAY,EAAM,GAEtC,OADA,UAAwB,gBAAX,OAAN,QAAM,IAAN,OAAM,EAAN,EAAQ,OACR,EAAO,U,qBAtChB,SAAc,EAAyC,GACrD,OAAO,cAAY,MAAM,EAAc,0BAAwB,IAAU,K,sBAU3E,SAAgB,EAAa,GAC3B,IAAM,EAAS,cAAY,YAAY,EAAM,GAE7C,OADA,UAAwB,cAAX,OAAN,QAAM,IAAN,OAAM,EAAN,EAAQ,OACR,EAAO,W,KAtRlB,UAmTa,cAAc,IAAI,E,IA2BlB,E,8BAQX,WAAY,EAAsB,EAAyB,EAAsB,GAAc,wBAC7F,cAAM,EAAY,IAEb,aAAe,EACpB,EAAK,OAAS,EAJ+E,E,gCAO/F,SAAO,GACL,OACE,0CAAa,IAAS,KAAK,eAAiB,EAAK,cAAgB,KAAK,SAAW,EAAK,S,sBAK1F,WACE,MACE,2BAAoB,KAAK,aAAzB,6BACiB,KAAK,YADtB,kBAEW,KAAK,MAFhB,qBAGc,KAAK,OAHnB,W,GAxByB,GAA/B,c,IA0Ca,E,8BAKX,WACE,EACA,EACA,EACA,GAE0C,MAD1C,EAC0C,uDADlC,UAAQ,KAChB,EAA0C,uDAAX,cAAW,kBAE1C,cAAM,EAAc,EAAQ,EAAY,IAEnC,MAAQ,EACb,EAAK,6BAA+B,EALM,E,6CAQ5C,SAAoB,GAClB,IAAM,EAAsB,KAAK,IAC/B,EAAmB,SAAS,KAAK,8BAA8B,SAAS,KAAK,QAG/E,OAAO,IAAI,EACT,KAAK,aACL,KAAK,OACL,EAAoB,WACpB,EAAoB,Q,oBAIxB,SAAO,GACL,OACE,0CAAa,IACb,KAAK,MAAM,GAAG,EAAK,QACnB,KAAK,6BAA6B,OAAO,EAAK,kC,GApCA,GAApD,oC,gIChxBA,aAgBa,E,WAuBT,SAAF,EACE,EACA,EACA,EACA,EACA,GAQI,GARe,UAEnB,KAAK,YAAc,EACnB,KAAK,YAAc,EACnB,KAAK,eAAiB,EACtB,KAAK,WAAa,EAClB,KAAK,YAAc,EAEf,KAAK,YAAY,GAAG,KAAK,aACrB,UAAI,MAAM,iD,+BAIpB,WACE,OACE,KAAK,YAAY,QACjB,KAAK,YAAY,QACjB,KAAK,eAAe,QACpB,KAAK,WAAW,S,sBAKpB,WACE,MACE,yBAAkB,KAAK,aAAvB,yBACkB,KAAK,aADvB,4BAEqB,KAAK,gBAF1B,wBAGiB,KAAK,YAHtB,0BAImB,KAAK,YAJxB,S,oBAWJ,SAAO,GACL,OACE,KAAK,YAAY,GAAG,EAAK,cACzB,KAAK,YAAY,GAAG,EAAK,cACzB,KAAK,eAAe,GAAG,EAAK,iBAC5B,KAAK,WAAW,GAAG,EAAK,aACxB,KAAK,cAAgB,EAAK,c,yBAS9B,SAAY,GAGV,OAFA,EAAW,UAAQ,KAAK,IAEX,GAAG,KAAK,aACZ,CAAE,aAAc,KAAK,YAAY,IAAI,GAAW,gBAAiB,EAAS,QAG/E,EAAS,GAAG,KAAK,aACZ,CAAE,YAAa,EAAS,IAAI,KAAK,mBAD1C,I,mBAUF,SAAM,GACJ,OAAK,OAIuB,IAAxB,EAAO,aACF,EAAO,iBAAmB,KAAK,YAAY,IAAI,EAAO,cACzD,UAAQ,KACR,KAAK,YAAY,IAAI,EAAO,cAEzB,KAAK,YAAY,IAAI,EAAO,aAR5B,KAAK,gB,KAlGlB,sB,yHChBA,aAmBa,E,WAWT,SAAF,IAA6F,IAAjF,EAAiF,uDAApE,UAAQ,KAAM,EAAsD,uDAArC,UAAQ,KAAM,EAAuB,uDAAZ,UAAQ,KAAI,UAC3F,KAAK,WAAa,EACd,KAAC,eAAiB,EAClB,KAAC,SAAW,E,+BAGlB,WACE,OAAO,KAAK,WAAW,QAAU,KAAK,eAAe,QAAU,KAAK,SAAS,S,sBAI/E,WACE,MACE,wBAAiB,KAAK,YAAtB,4BACqB,KAAK,gBAD1B,sBAEe,KAAK,SAFpB,Q,oBASJ,SAAO,GACL,OACE,KAAK,WAAW,GAAG,EAAK,aACxB,KAAK,eAAe,GAAG,EAAK,iBAC5B,KAAK,SAAS,GAAG,EAAK,Y,yBAS1B,SAAY,GAGJ,OAFN,EAAiB,UAAQ,KAAK,IAEX,GAAG,KAAK,YAClB,CACL,YAAa,KAAK,WAAW,IAAI,GACjC,eAAgB,EAAe,QAI/B,EAAe,GAAG,KAAK,YAClB,CAAE,UAAW,EAAe,IAAI,KAAK,kBAD9C,I,mBAUF,SAAM,GACJ,OAAK,OAIsB,IAAvB,EAAO,YACF,EAAO,gBAAkB,KAAK,WAAW,IAAI,EAAO,aACvD,UAAQ,KACR,KAAK,WAAW,IAAI,EAAO,aAExB,KAAK,WAAW,IAAI,EAAO,WAR3B,KAAK,e,KApElB,e,oMCnBA,gBAEA,SAEA,SAca,E,WAST,SAAF,EACE,EACA,EACA,EACA,EACA,EACA,GAAqB,UAErB,KAAK,sBAAwB,UAAQ,KAAK,GACtC,KAAC,mBAAqB,UAAQ,KAAK,GACnC,KAAC,MAAQ,UAAQ,KAAK,GACtB,KAAC,kBAAoB,EACrB,KAAC,mBAAqB,EACtB,KAAC,cAAgB,EAErB,UAAO,KAAK,mBAAmB,GAAG,I,0CAIpC,SAAiB,GACT,OAAC,IAAI,EACT,KAAK,sBACL,KAAK,mBACL,KAAK,MACL,KAAK,kBACL,KAAK,mBACL,K,oBAOJ,SAAO,GACL,OACE,KAAK,sBAAsB,GAAG,EAAK,wBACnC,KAAK,mBAAmB,GAAG,EAAK,qBAChC,KAAK,MAAM,GAAG,EAAK,QACnB,KAAK,kBAAkB,YAAc,EAAK,kBAAkB,WAC5D,KAAK,mBAAmB,YAAc,EAAK,mBAAmB,WAC9D,KAAK,gBAAkB,EAAK,gB,sBAKhC,WACE,MACE,kCAA2B,KAAK,uBAAhC,+BACwB,KAAK,kBAAkB,iBAD/C,+BAEmB,KAAK,cAFxB,S,sBAOJ,WAAuC,IAA9B,EAA8B,uDAAvB,KAAK,mBACb,EAAoC,KAAK,IAC7C,EAAK,UAAY,KAAK,kBAAkB,UACxC,GAII,EAA+B,KAAK,MAAM,EAAoC,KAEpF,OAAO,KAAK,mBAAmB,IAAI,GAA8B,IAAI,KAAK,yB,2BAwB5E,SAAc,GACZ,OAAO,KAAK,cACR,UAAQ,KACR,UAAQ,IAAI,yBAAuB,IAAI,KAAK,SAAS,IAAQ,4B,4BAgCnE,WAA+E,IAAhE,EAAgE,uDAAzB,UAAQ,KAAM,EAAW,uCAC7E,EAA2B,UAAQ,KAAK,GACxC,IAAI,EAAW,KAAK,SAAS,GAM7B,OAJI,EAAyB,UAC3B,EAAW,EAAyB,IAAI,KAAK,OAAO,IAAI,IAGnD,UAAQ,IAAI,0BAAwB,IAAI,GAAW,UAAQ,S,KA3ItE,U,iUCRa,E,8BAIT,SAAF,EAAY,EAAc,EAAiB,GAAgB,wBACzD,cAAM,IACD,KAAO,EACZ,EAAK,cAAgB,EAHoC,E,YAJwB,QAArF,4B,6JC8Ca,kBAAkC,CAAE,OAAQ,WAgB5C,iBAAiB,SAAI,GAAJ,MAAyC,CACrE,OAAQ,SACR,eAyBW,qBAAqB,SAChC,EACA,EACA,GAHgC,UAKhC,OAAQ,YACR,aACA,WACI,EAAW,CAAE,YAAa,M,gTC3GhC,gBAkLM,EAAe,SAAI,EAAM,GAAV,OAAmB,IAAM,GACxC,EAAK,SAAqC,EAAM,GAA3C,OAAoD,EAAE,GAAG,IAC9D,EAAS,SAAyC,EAAM,GAA/C,OAAwD,EAAE,OAAO,IAE1E,EAAuB,SAAC,EAAmB,GAApB,MACd,iBAAb,EAAE,OACe,iBAAb,EAAE,OACW,eAAb,EAAE,QAA2B,EAAE,aAAa,GAAG,EAAE,eAEjD,EAAqB,SAAC,GAAD,MACZ,iBAAb,EAAE,OACE,6BADJ,gDAE6C,EAAE,aAF/C,OAsBoB,E,WAApB,SAAF,IAAI,EAAJ,QAEE,cAAU,EAWA,cAAU,EAOZ,gBAAa,IAAI,I,6BAWzB,WACE,OAAO,OAAO,OAAO,GAAI,KAAK,WAAY,KAAK,cAAe,KAAK,e,mBAiBrE,WAAK,WACG,EAAS,KAAK,WAEpB,OAAO,WACL,IAEA,EAAK,8B,sCAID,gBACwB,IAA1B,KAAK,kBACP,aAAa,KAAK,oB,6BAId,WAAe,WACrB,KAAK,2BAEL,KAAK,iBAAmB,YAAW,WACjC,EAAK,sBAAmB,EACxB,EAAK,YACJ,O,wBAGG,SAAc,EAAc,EAAS,GAK3C,OAJI,KAAK,SACP,QAAQ,IAAR,UAAe,EAAf,uBAAkC,EAAO,EAAK,GAAQ,IAGjD,I,8BAGD,SACN,EACA,EACA,EACA,EACA,GAEA,YAAgB,IAAT,GAAuB,EAAO,EAAM,GAA4C,EAApC,KAAK,WAAW,EAAM,EAAM,K,sCAGzE,SAA4B,EAAiC,EAAS,GAC5E,YAAgB,IAAT,GAAuB,EAAO,EAAM,GAAe,EAAP,I,yBAG7C,SAAY,EAAc,EAAY,GAC5C,OAAI,IAAS,EAAK,OAAO,IAGnB,UAAG,KAAH,UAAiB,IACnB,KAAK,WAAW,EAAM,GAEjB,GAEA,I,qBAIH,SACN,EACA,GAEA,MAAO,CACL,SAAU,KAAK,iBACb,EACA,WACA,EAAU,SACV,EAAgB,SAChB,GAGF,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,YAChB,GAGF,eAAgB,KAAK,iBACnB,EACA,iBACA,EAAU,eACV,EAAgB,gBAGlB,eAAgB,KAAK,iBACnB,EACA,iBACA,EAAU,eACV,EAAgB,gBAGlB,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,aAGlB,YAAa,KAAK,iBAChB,EACA,cACA,EAAU,YACV,EAAgB,aAGlB,gBAAiB,KAAK,iBACpB,EACA,kBACA,EAAU,gBACV,EAAgB,iBAGlB,kBAAmB,KAAK,iBACtB,EACA,oBACA,EAAU,kBACV,EAAgB,mBAGlB,mCAAoC,KAAK,yBACvC,EACA,EAAU,mCACV,EAAgB,oCAGlB,qBAAsB,KAAK,iBACzB,EACA,uBACA,EAAU,qBACV,EAAgB,sBAGlB,qBAAsB,KAAK,iBACzB,EACA,uBACA,EAAU,qBACV,EAAgB,sBAGlB,0BAA2B,KAAK,yBAC9B,EACA,EAAU,0BACV,EAAgB,2BAGlB,yBAA0B,KAAK,iBAC7B,EACA,2BACA,EAAU,yBACV,EAAgB,0BAGlB,MAAO,KAAK,iBAAiB,EAAI,QAAS,EAAU,MAAO,EAAgB,OAE3E,oBAAqB,KAAK,iBACxB,EACA,sBACA,EAAU,oBACV,EAAgB,qBAGlB,MAAO,KAAK,iBAAiB,EAAQ,QAAS,EAAU,MAAO,EAAgB,OAE/E,mBAAoB,KAAK,iBACvB,EACA,qBACA,EAAU,mBACV,EAAgB,oBAGlB,0BAA2B,KAAK,iBAC9B,EACA,4BACA,EAAU,0BACV,EAAgB,2BAGlB,iBAAkB,KAAK,iBACrB,EACA,mBACA,EAAU,iBACV,EAAgB,kBAGlB,iCAAkC,KAAK,yBACrC,EACA,EAAU,iCACV,EAAgB,kCAGlB,kBAAmB,KAAK,yBACtB,EACA,EAAU,kBACV,EAAgB,mBAGlB,UAAW,KAAK,iBACd,EACA,YACA,EAAU,UACV,EAAgB,WAGlB,gBAAiB,KAAK,iBACpB,EACA,kBACA,EAAU,gBACV,EAAgB,iBAGlB,mCAAoC,KAAK,yBACvC,EACA,EAAU,mCACV,EAAgB,uC,qBAKd,YAOgB,IANtB,EAMsB,EANtB,0BACA,EAKsB,EALtB,mBACA,EAIsB,EAJtB,kBACA,EAGsB,EAHtB,MACA,EAEsB,EAFtB,MACA,EACsB,EADtB,mCAEM,EAAO,EAAkB,iBAAiB,EAAM,+BAA+B,IAErF,MAAO,CACL,MAAO,EAA0B,oBAAoB,GACrD,OACA,cAAe,EAAK,gBACpB,eAAgB,EAAK,iBACrB,8BAA+B,EAC5B,oBAAoB,GACpB,8BAA8B,M,4BAI7B,SACN,EACA,GAEA,MAAO,CACL,KAAM,KAAK,YAAY,OAAQ,EAAa,KAAM,EAAmB,MAErE,MAAO,KAAK,iBAAiB,EAAQ,QAAS,EAAa,MAAO,EAAmB,OAErF,cAAe,KAAK,yBAClB,EACA,EAAa,cACb,EAAmB,eAGrB,eAAgB,KAAK,yBACnB,EACA,EAAa,eACb,EAAmB,gBAGrB,8BAA+B,KAAK,iBAClC,EACA,gCACA,EAAa,8BACb,EAAmB,kC,qBAQjB,SAAQ,GAAqC,WAOnD,EAAI,KAAK,YAAY,SAAQ,YACvB,EAAK,WAAW,IAAI,IACtB,EAAS,Q,uBAWf,SAAU,GAAyD,IA3W/B,EA2W+B,OAC3D,GA5W4B,EA4WN,EA5W+B,kBAAgB,EAAC,WAAD,eAgX3E,OAFA,KAAK,WAAW,IAAI,GAEb,WACL,EAAK,WAAW,OAAO,M,mBAKjB,SAAM,EAAkC,GAChD,WAAQ,KAAK,SAEb,KAAK,WAAa,EAClB,KAAK,cAAgB,KAAK,QAAQ,GAClC,KAAK,YAAc,EACnB,KAAK,SAAU,EAEf,KAAK,kBAED,KAAK,UACP,KAAK,a,qBAKC,SACR,EACA,GAEA,UAAO,KAAK,YAAc,KAAK,eAE/B,IA1YmB,EAAM,EA0YnB,EAAW,KAAK,MAElB,IACF,KAAK,WAAa,KAAK,QAAQ,KAAK,WAAY,IAIlD,KAAK,cAAgB,KAAK,eAAe,KAAK,cAAe,KAAK,QAAQ,KAAK,aAE3E,IACF,UAAO,KAAK,aACZ,KAAK,YAAc,KAAK,aAAa,KAAK,YAAa,IAGzD,KAAK,kBAEL,KAAK,QAAQ,CACX,SAAU,KAAK,MACf,WACA,aA7ZiB,EA6ZO,KAAK,MA7ZN,EA6Za,EA5ZxC,OAAO,YACL,OAAO,QAAQmC,GAAG,QAAO,yBAAE,EAAF,mBAA6B,EAA8B,c,KAcxF,kB,kLCrKa,E,WAKT,SAAF,EAAY,EAA8C,GAA2B,UACnF,KAAK,UAAY,EACjB,KAAK,OAAS,E,0EAGhB,2HAEqD,QAD5C,GACL,OAAK,QAAO,sBAAZ,kBAAiD,SACjD,OAAK,WAAU,sBAAf,YAHJ,gD,2HAOA,WACE,GADF,0GAEK,EAFL,iCAEK,EAFL,mCAKqE,QAD5D,GACL,OAAK,QAAO,6BAAZ,SAAyC,GAAzC,OAAqD,WAAY,SACjE,OAAK,WAAU,6BAAf,SAA4C,GAA5C,OAAwD,KAN5D,gD,wGAUA,WAAe,GAAf,4GAAoC,EAApC,iCAAoC,EAApC,0BACgE,QAAQ,IAAI,CACxE,KAAK,6BAAL,YAAkC,GAAlC,OAA8C,IAC9C,KAAK,sBAAL,WAA8B,KAHlC,gCACS,EADT,KACoC,EADpC,uBAMS,EAA0B,oBAAoB,IANvD,gD,iHASA,2HAEiD,QADxC,GACL,OAAK,QAAO,kBAAZ,kBAA6C,SAC7C,OAAK,WAAU,kBAAf,YAHJ,gD,uGAOA,aAAQ,IAAR,kBAAQ,OAAR,oBAAU,OAAV,sDAC6C,QAA3C,GAAO,OAAK,QAAO,SAAZ,kBAAoC,SAAI,OAAK,WAAU,SAAf,YADjD,gD,uGAIA,aAAQ,IAAR,kBAAQ,OAAR,oBAAU,OAAV,sDAC6C,QAA3C,GAAO,OAAK,QAAO,SAAZ,kBAAoC,SAAI,OAAK,WAAU,SAAf,YADjD,gD,kHAIA,WAA0B,GAA1B,0GAA+C,EAA/C,iCAA+C,EAA/C,mCAE4D,QADnD,GACL,OAAK,QAAO,oBAAZ,SAAgC,GAAhC,OAA4C,WAAY,SACxD,OAAK,WAAU,oBAAf,SAAmC,GAAnC,OAA+C,KAHnD,gD,mIAOA,2HAEmE,QAD1D,GACL,OAAK,QAAO,oCAAZ,kBAA+D,SAC/D,OAAK,WAAU,oCAAf,YAHJ,gD,qHAOA,2HAEsD,QAD7C,GACL,OAAK,QAAO,uBAAZ,kBAAkD,SAClD,OAAK,WAAU,uBAAf,YAHJ,gD,6GAOA,WAAqB,GAArB,0GAA0C,EAA1C,iCAA0C,EAA1C,mCAEuD,QAD9C,GACL,OAAK,QAAO,eAAZ,SAA2B,GAA3B,OAAuC,WAAY,SACnD,OAAK,WAAU,eAAf,SAA8B,GAA9B,OAA0C,KAH9C,gD,8GAOA,WAAqB,GAArB,0GAA0C,EAA1C,iCAA0C,EAA1C,mCAEuD,QAD9C,GACL,OAAK,QAAO,eAAZ,SAA2B,GAA3B,OAAuC,WAAY,SACnD,OAAK,WAAU,eAAf,SAA8B,GAA9B,OAA0C,KAH9C,gD,kHAOA,WAAyB,GAAzB,0GAA8C,EAA9C,iCAA8C,EAA9C,mCAE2D,QADlD,GACL,OAAK,QAAO,mBAAZ,SAA+B,GAA/B,OAA2C,WAAY,SACvD,OAAK,WAAU,mBAAf,SAAkC,GAAlC,OAA8C,KAHlD,gD,oHAOA,WAA2B,GAA3B,0GAAgD,EAAhD,iCAAgD,EAAhD,mCAE6D,QADpD,GACL,OAAK,QAAO,qBAAZ,SAAiC,GAAjC,OAA6C,WAAY,SACzD,OAAK,WAAU,qBAAf,SAAoC,GAApC,OAAgD,KAHpD,gD,qIAOA,2HAEqE,QAD5D,GACL,OAAK,QAAO,sCAAZ,kBAAiE,SACjE,OAAK,WAAU,sCAAf,YAHJ,gD,sHAOA,WAA8B,GAA9B,0GAAmD,EAAnD,iCAAmD,EAAnD,mCAEgE,QADvD,GACL,OAAK,QAAO,wBAAZ,SAAoC,GAApC,OAAgD,WAAY,SAC5D,OAAK,WAAU,wBAAf,SAAuC,GAAvC,OAAmD,KAHvD,gD,uHAOA,2HAEuD,QAD9C,GACL,OAAK,QAAO,wBAAZ,kBAAmD,SACnD,OAAK,WAAU,wBAAf,YAHJ,gD,2HAOA,WAAmC,GAAnC,0GAAwD,EAAxD,iCAAwD,EAAxD,mCAEqE,QAD5D,GACL,OAAK,QAAO,6BAAZ,SAAyC,GAAzC,OAAqD,WAAY,SACjE,OAAK,WAAU,6BAAf,SAA4C,GAA5C,OAAwD,KAH5D,gD,2HAOA,WAAkC,GAAlC,0GAAuD,EAAvD,iCAAuD,EAAvD,mCAEoE,QAD3D,GACL,OAAK,QAAO,4BAAZ,SAAwC,GAAxC,OAAoD,WAAY,SAChE,OAAK,WAAU,4BAAf,SAA2C,GAA3C,OAAuD,KAH3D,gD,yGAcA,WAAgB,GAAhB,2GACU,EAA0C,EAA1C,qBAAyB,EADnC,EACoD,EADpD,qCAA+C,EAA/C,iCAA+C,EAA/C,0BAG6C,QAAQ,IAAI,CACrD,OAAuB,EAAY,KAAK,sBAAL,WAA8B,GACqB,Q,GAAtF,OAAK,QAAO,UAAZ,YAAwB,sBAAsB,GAAS,IAAvD,OAA0E,WAAY,SACpF,OAAK,WAAU,UAAf,YAA2B,sBAAsB,GAAS,IAA1D,OAA6E,MANnF,4BAGS,EAHT,KAG6B,EAH7B,MASM,EATN,0CAUW,EAAO,KAAI,YAAK,OAAI,EAAM,oBAAoB,OAVzD,iCAYW,GAZX,iD,uGAgBA,2HAC4C,QAA1C,GAAO,OAAK,QAAO,QAAZ,kBAAmC,SAAI,OAAK,WAAU,QAAf,YADhD,gD,2GAIA,WAAmB,GAAnB,0GAAwC,EAAxC,iCAAwC,EAAxC,mCAEqD,QAD5C,GACL,OAAK,QAAO,aAAZ,SAAyB,GAAzB,OAAqC,WAAY,SACjD,OAAK,WAAU,aAAf,SAA4B,GAA5B,OAAwC,KAH5C,gD,kHAOA,2HAEkD,QADzC,GACL,OAAK,QAAO,mBAAZ,kBAA8C,SAC9C,OAAK,WAAU,mBAAf,YAHJ,gD,gHAOA,WAAwB,GAAxB,0GAA6C,EAA7C,iCAA6C,EAA7C,mCAE0D,QADjD,GACL,OAAK,QAAO,kBAAZ,SAA8B,GAA9B,OAA0C,WAAY,SACtD,OAAK,WAAU,kBAAf,SAAiC,GAAjC,OAA6C,KAHjD,gD,8DAhLF,4B,wqlHC1CA,YAIM,EAAe,CACnB,CACI,UAAQ,EACR,OAAM,GACN,KAAI,2BACJ,QAAO,CACP,CACE,KAAM,YACN,KAAM,YAGV,SAAS,EACT,gBAAiB,OACjB,KAAM,aAIJ,EAAmB,CACrB,EAAC,6CACH,EAAG,6CACH,EAAG,6CACH,EAAG,6CACD,GAAE,8CAUO,sBAAsB,SACjC,EACA,GAFiC,OAPd,SAAC,GAAD,OACnB,KAAW,EAUX,CAAa,GACP,IAAI,WACJ,EAAiB,GACjB,EACA,QAEF,I,0NCtCN,aAKM,EAAW,SAAC,GACd,IAAE,OAAuD,EACvD,EAAc,EAEhB,OAAK,WAAuB,MACtB,GAAK,EAAQ,UAAK,OAAS,GAAtB,gDAEe,IAAtB,EAAM,aAA6B,EAAM,YAAc,IACzD,EAAc,EAAM,kBAGJ,IAAd,GACF,aAAa,GAGX,EAAQ,YAAW,WACrB,EAAS,GACT,OAAY,IAnBQ,MAyBb,E,WAGT,SAAF,EAAY,GAA+B,UACzC,KAAK,UAAY,E,iDAGnB,SACE,GAAgE,aAE5B,gBAAc,KAAK,UAAU,YAAzD,EAFwD,EAExD,WAAY,EAF4C,EAE5C,YACd,EAAY,EAAW,QAAQ,YAE/B,EAAyB,GAAS,SAAC,GACvC,EAAK,UAAU,sBAAsB,CAAE,aAAY,KAAK,MAGpD,EAAoB,SAAC,EAAmB,EAAoB,GAC5D,IAAc,EAAY,SAC5B,EAAuB,IAM3B,OAFA,EAAW,GAAG,EAAW,GAElB,WACL,EAAW,eAAe,EAAW,M,sCAIzC,SACE,EACA,GAAgB,WAET,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aAF3B,MAI6B,gBAAc,KAAK,UAAU,YAAlE,EAJQ,EAIR,aAAc,EAJN,EAIM,mBAChB,EAA6B,EAAa,QAAQ,aAAa,GAC/D,EAAmC,EAAmB,QAAQ,aAAa,GAE3E,EAAgB,GAAS,SAAC,GAC9B,EAAK,UAAU,6BAA6B,EAAS,CAAE,aAAY,KAAK,MAMpE,OAHN,EAAa,GAAG,EAA4B,GAC5C,EAAmB,GAAG,EAAkC,GAEjD,WACL,EAAa,eAAe,EAA4B,GACxD,EAAmB,eAAe,EAAkC,M,iCAIxE,SAAoB,GAAyD,WACnE,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAEF,GAAe,EADI,EAAa,QAA9B,gBAGF,EAAuB,GAAS,SAAC,GACrC,EAAK,UAAU,kBAAkB,CAAE,aAAY,KAAK,MAKhD,OAFA,EAAO,GAAG,EAAc,GAEvB,WACL,EAAa,eAAe,EAAc,M,wBAK9C,SAAW,GAIT,MAAM,IAAI,MAAM,6B,wBAGlB,SAAW,GAAsC,WACvC,EAAiB,gBAAc,KAAK,UAAU,YAA9C,aAEF,GAAe,EADI,EAAa,QAA9B,gBAGF,EAAgB,GAAS,SAAC,GAC9B,EAAK,UAAU,SAAS,CAAE,aAAY,KAAK,MAK7C,OAFA,EAAa,GAAG,EAAc,GAEvB,WACL,EAAa,eAAe,EAAc,M,mCAI9C,SACE,EACA,GAAgB,WAET,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aAF3B,MAIsB,gBAAc,KAAK,UAAU,YAA3D,EAJQ,EAIR,WAAY,EAJJ,EAII,cACZ,EAAuB,EAAc,QAArC,mBACA,EAAc,EAAW,QAAzB,UAEF,EAAqB,EAAmB,GACxC,EAAY,IAEZ,EAAkB,GAAS,SAAC,GAChC,EAAK,UAAU,oBAAoB,EAAS,CAAE,aAAY,KAAK,MAG3D,EAAoB,SAAC,EAAmB,EAAoB,GAC5D,IAAc,EAAc,SAG9B,EAAgB,IAOpB,OAHA,EAAc,GAAG,EAAoB,GACrC,EAAW,GAAG,EAAW,GAElB,WACL,EAAc,eAAe,EAAoB,GACjD,EAAW,eAAe,EAAW,M,sCAIzC,SACE,GAAoE,aAE/B,gBAAc,KAAK,UAAU,YAA1D,EAF4D,EAE5D,UAAW,EAFiD,EAEjD,cACX,EAAa,EAAU,QAAvB,SAKF,EAA2B,CAHK,EAAS,EAAc,SACzB,EAAS,KAAM,EAAc,UAI3D,EAA4B,GAAS,SAAC,GAC1C,EAAK,UAAU,uBAAuB,CAAE,aAAY,KAAK,MAK3D,OAFA,EAAyB,SAAQ,YAAM,OAAI,EAAU,GAAG,EAAQ,MAEzD,kBACL,EAAyB,SAAQ,YAAM,OACrC,EAAU,eAAe,EAAQ,S,8BAIvC,SAAiB,EAAkD,GAAgB,WAC1E,OAAP,QAAO,IAAP,MAAY,kBAAgB,KAAK,UAAU,aADsC,IAGzE,EAAc,gBAAc,KAAK,UAAU,YAA3C,UACA,EAAa,EAAU,QAAvB,SAIF,EAAsB,CAHC,EAAS,GACX,EAAS,KAAM,IAIpC,EAAuB,GAAS,SAAC,GACrC,EAAK,UAAU,eAAe,EAAS,CAAE,aAAY,KAAK,MAK5D,OAFA,EAAoB,SAAQ,YAAM,OAAI,EAAU,GAAG,EAAQ,MAEpD,kBACL,EAAoB,SAAQ,YAAM,OAAI,EAAU,eAAe,EAAQ,W,KAvK7E,6B,qICvCA,YACA,QAIA,OAgDM,EAAY,SAChB,EACA,GAEE,IAAI,EAA0B,GAC1B,EAAsB,GAY1B,OAVF,EAAK,SAAQ,YACX,IAAM,EAvBY,SAAC,EAAU,GAA2D,IAClF,EAAY,EAAZ,QAER,GAAI,KAAW,EACb,IACE,MAAO,CAAE,UAAS,eAAgB,EAAgB,GAAS,SAAS,IACpE,MAAO,GACP,QAAQ,KAAK,wBACb,QAAQ,KAAK,GACP,QAAE,KAAK,WACb,QAAQ,KAAK,IAaG,CAAc,EAAK,GAEjC,EACF,EAAW,KAAK,GAEhB,EAAa,KAAK,MAIf,CAAC,EAAY,IAGhB,EAAW,YAAU,KAAK,IAAI,IAAI,GAoBlC,EAAyB,SAAC,EAAgC,GAC9D,IAAM,EAAgB,OAAO,QAAQ,EAAe,MACjD,QAAO,6BAAgB,MAAM,aAC7B,KAAI,yBAAE,EAAF,KAAO,EAAP,qBAAqB,EAArB,aArBQ,SAAC,EAAc,GAC5B,OAAE,YAAU,YAAY,GACpB,EAAI,IAAI,GACV,UAAU,UAAQ,oBAAoB,EAAI,eAA1C,OAEO,EAAI,WAEW,kBAAR,EACT,IAAQ,cACX,aACA,GAAc,KAAO,EACrB,EAAW,GACX,EAEG,OAAO,GAOoB,CAAS,EAAO,OAEpD,gBAAU,EAAe,KAAzB,cAAmC,EAAc,KAAK,MAAtD,QAGW,eAAe,SAAC,EAA6B,GACxD,IAAM,EAAkB,EAClB,EAlFoB,SAAC,GACzB,OAAK,OAAO,YACZ,OAAO,QAAQ,GAAgB,KAAI,gBAAI,EAAJ,gBAAkB,CAAC,EAAS,QAAS,EAAS,eAgF3D,CAAoB,GACtC,EA7Ee,SAAC,GACpB,OAAK,OAAO,YACZ,OAAO,QAAQ,GAAgB,KAAI,yBAAE,EAAF,WAAsB,CAAtB,KAAgC,QAAS,OA2EnD,CAAe,GAEpC,EAAU,OACb,EAAQ,KAAO,QACb,GAP2F,EAU7D,EAAU,EAAQ,KAAM,GAVqC,SAUzF,EAVyF,KAU7E,EAV6E,KAiBhG,OALI,EAAa,OAAS,IACxB,QAAQ,KAAK,qDACb,QAAQ,KAAK,IAGX,EAAW,OAAS,EAEpB,qBAAc,EAAQ,gBAAtB,OACA,EACG,KACC,gBAAG,EAAH,EAAG,QAAS,EAAZ,EAAY,eAAZ,kBACO,EAAmB,GAD1B,YACsC,EAAuB,EAAgB,OAE9E,KAAK,MAGV,oCAAoC,EAAQ,mB,2LC/HhD,WA2BA,SAgBA,SAKA,SACA,SAQa,E,8BAGT,SAAF,EAAY,EAAiB,GAAsD,6BAC3E,+BAAgC,EAAS,G,UAJD,0BAAlD,iCAQA,IAAM,EAAc,2BAAG,WAAU,GAAV,qFACC,EAAG,iBADJ,UAGE,eAFjB,EADe,QAGT,OAHS,sBAIb,IAAI,EAA6B,qBAAsB,GAJ1C,gCAOd,EAAQ,SAPM,2CAAH,sDAeP,E,WAaT,SAAF,EAAY,GAA+B,UACrC,KAAC,UAAYC,EACjB,KAAK,WAAa,EAAS,WAC3B,KAAK,SAAW,IAAI,2BAAyB,GAC7C,KAAK,KAAO,IAAI,wBAAsB,KAAK,U,kCAwD7C,WACE,OAAO,I,mCAIT,SAAsB,GACpB,OAAO,KAAK,UAAU,sBAAsB,K,0CAI9C,SACE,EACA,GAEA,OAAO,KAAK,UAAU,6BAA6B,EAAS,K,sBAI9D,SAAS,EAAkB,GACnB,OAAC,KAAK,UAAU,SAAS,EAAS,K,+BAI1C,SAAkB,GAChB,OAAO,KAAK,UAAU,kBAAkB,K,sBAI1C,SAAS,GACP,OAAO,KAAK,UAAU,SAAS,K,4BAIjC,SAAe,GACb,OAAO,KAAK,UAAU,eAAe,K,6BAIvC,SAAgB,GACd,OAAO,KAAK,UAAU,gBAAgB,K,sBAIxC,SAAS,GACP,OAAO,KAAK,UAAU,SAAS,K,iCAIjC,SAAoB,EAAkB,GACpC,OAAO,KAAK,UAAU,oBAAoB,EAAS,K,iDAIrD,SAAoC,GAClC,OAAO,KAAK,UAAU,oCAAoC,K,oCAI5D,SAAuB,GACrB,OAAO,KAAK,UAAU,uBAAuB,K,4BAI/C,SAAe,EAAkB,GAC/B,OAAO,KAAK,UAAU,eAAe,EAAS,K,4BAIhD,SAAe,EAAkB,GAC/B,OAAO,KAAK,UAAU,eAAe,EAAS,K,gCAIhD,SAAmB,EAAkB,GACnC,OAAO,KAAK,UAAU,mBAAmB,EAAS,K,kCAIpD,SAAqB,EAAkB,GACrC,OAAO,KAAK,UAAU,qBAAqB,EAAS,K,8DAItD,SACE,GAEA,OAAO,KAAK,UAAU,iDAAiD,K,mDAIzE,SAAsC,GACpC,OAAO,KAAK,UAAU,sCAAsC,K,qCAI9D,SAAwB,EAAkB,GACxC,OAAO,KAAK,UAAU,wBAAwB,EAAS,K,qCAIzD,SAAwB,GACtB,OAAO,KAAK,UAAU,wBAAwB,K,0CAIhD,SAA6B,EAAkB,GAC7C,OAAO,KAAK,UAAU,6BAA6B,EAAS,K,yCAI9D,SAA4B,EAAkB,GAC5C,OAAO,KAAK,UAAU,4BAA4B,EAAS,K,uBAY7D,SAAU,EAA4B,GACpC,OAAO,KAAK,UAAU,UAAU,EAAQ,K,gCAI1C,SAAmB,GACjB,OAAO,KAAK,UAAU,mBAAmB,K,6BAI3C,SACE,GAEA,OAAO,KAAK,UAAU,gBAAgB,K,qBAIxC,SAAQ,GACN,OAAO,KAAK,UAAU,QAAQ,K,0BAIhC,SAAa,EAAkB,GAC7B,OAAO,KAAK,UAAU,aAAa,EAAS,K,gCAI9C,SAAmB,GACjB,OAAO,KAAK,UAAU,mBAAmB,K,+BAI3C,SAAkB,EAAkB,GAClC,OAAO,KAAK,UAAU,kBAAkB,EAAS9D,K,uBAUnD,SACE,EACA,EACA,GAEA,OAAO,KAAK,KACT,UAAU,EAAQ,EAAkC,GACpD,KAAK,K,wBAUV,SAAW,GACT,OAAO,KAAK,KAAK,WAAW,GAAW,KAAK,K,yBAU9C,SACE,EACA,EACA,GAEA,OAAO,KAAK,KACT,YAAY,EAAQ,EAAkC,GACtD,KAAK,K,+BAUV,SACE,EACA,GAEA,OAAO,KAAK,KAAK,kBAAkB,EAAQ,GAAW,KAAK,K,gCAU7D,SACE,EACA,GAEA,OAAO,KAAK,KAAK,mBAAmB,EAAQ,GAAW,KAAK,K,wBAU9D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,WAAW,EAAQ,EAAkB,GAAW,KAAK,K,uBAUxE,SACE,EACA,GAEA,OAAO,KAAK,KAAK,UAAU,EAAQ,GAAW,KAAK,K,sBAIrD,SAAS,EAAmB,GAC1B,OAAO,KAAK,KAAK,SAAS,EAAO,GAAW,KAAK,K,uBAUnD,SACE,EACA,GAEA,OAAO,KAAK,KAAK,UAAU,EAAS,GAAW,KAAK,K,2BAUtD,SACE,EACA,GAEA,OAAO,KAAK,KAAK,cAAc,EAAkC,GAAW,KAAK,K,wCAUnF,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,2BAA2B,EAAQ,EAAa,GAAW,KAAK,K,2CAUnF,SACE,EACA,GAEA,OAAO,KAAK,KAAK,8BAA8B,EAAQ,GAAW,KAAK,K,4CAUzE,SACE,GAEA,OAAO,KAAK,KAAK,+BAA+B,GAAW,KAAK,K,2CAUlE,SACE,GAEA,OAAO,KAAK,KAAK,8BAA8B,GAAW,KAAK,K,sBAUjE,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,SAAS,EAAW,EAAQ,GAAW,KAAK,K,sBAU/D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,SAAS,EAAW,EAAQ,GAAW,KAAK,K,wBAU/D,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,WAAW,EAAQ,EAAmB,GAAW,KAAK,K,oCAUzE,SAAuB,GACrB,OAAO,KAAK,KAAK,uBAAuB,GAAW,KAAK,K,uBAU1D,SAAU,EAAoB,GAC5B,OAAO,KAAK,KAAK,UAAU,EAAQ,GAAW,KAAK,K,yBAUrD,SAAY,EAAoB,GAC9B,OAAO,KAAK,KAAK,YAAY,EAAQ,GAAW,KAAK,K,sCAUvD,SAAyB,GACvB,OAAO,KAAK,KAAK,yBAAyB,GAAW,KAAK,K,8BAU5D,SAAiB,EAA0B,GACzC,OAAO,KAAK,KAAK,iBAAiB,EAAc,GAAW,KAAK,K,2BAIlE,SACE,EACA,EACA,GAEA,OAAO,KAAK,KAAK,cAAc,EAAQ,EAAS,GAAW,KAAK,K,8BAUlE,SAAiB,EAAwB,GACvC,OAAO,KAAK,KAAK,iBAAiB,EAAW,GAAW,KAAK,K,4BAU/D,SAAe,EAAoB,GACjC,OAAO,KAAK,KAAK,eAAe,EAAQ,GAAW,KAAK,K,8BAU1D,SAAiB,EAAoB,GACnC,OAAO,KAAK,KAAK,iBAAiB,EAAQ,GAAW,KAAK,K,mDAU5D,SAAsC,GACpC,OAAO,KAAK,KAAK,sCAAsC,GAAW,KAAK,K,iCAUzE,SAAoB,GAClB,OAAO,KAAK,KAAK,oBAAoB,GAAW,KAAK,M,oBA1iBvD,SAAa,GACX,OAAI,cAAY,GACP,IAAI,EAAwB,wBAAsB,MAAM,IAExD,IAAI,EAAc,wBAAsB,MAAM,M,gDAsBzD,WACE,EACA,GAFF,2EAIS,EAJT,SAImC,WAAS,EAAkB,GAJ9D,iDAIuB,MAJvB,4D,gEAvDF,kB,IAslBM,E,8BAKJ,WAAY,GAA2C,wBACrD,cAAM,IAED,MAAQ,EAAS,MAH+B,E,kCAMvD,SAAS,GACP,YAAiB,IAAV,GAAuB,IAAU,KAAK,WAAW,a,GAXlD,I,yKCzqBV,WAIA,SACA,SASa,oBAAoB,SAC/B,EACA,GAEE,IAAI,EAAQ,oBACR,EAAW,SAAO,GAClB,EAAQ,SAAO,EAAK,EAAM,QAHoB,EAI/B,cAAW,iBAAO,KAAK,IAAnC,EAJ2C,UAM9C,EAAW,eACf,SAAC,GACC,IAAM,EAAW,EAAO,EAAM,QAAS,GAElC,SAAO,EAAU,EAAM,WAC1B,EAAM,QAAU,EAChB,OAGJ,CAAC,IAaH,OAVA,aAAU,kBAAM,EAAM,WAAU,YAAM,OAAI,EAAQ,GAAG,KAAM,eAAkB,SAAY,CACvF,EACA,IAGE,EAAS,UAAY,IACvB,EAAM,QAAU,EAAK,EAAM,OAC3B,EAAS,QAAU,GAGd,CAAC,EAAM,QAAS,K,0HC7CzB,WAIA,SACA,SAEa,qBAAqB,SAAO,GACrC,IAAI,EAAQ,oBAD0E,EAEnE,cAAW,iBAAO,KAAK,IAAnC,EAF+E,UAcxF,OAVE,EAAF,WACE,WAAI,OACF,EAAM,WAAU,YAA2B,IAAxB,EAAwB,EAAxB,SAAU,EAAc,EAAd,SACtB,SAAO,EAAO,GAAW,EAAO,KACnC,SAGN,CAAC,EAAO,IAGH,EAAO,EAAM,S,yZ5BrBtB,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACAJ,EAAa,EAAb,S,uyE6BHMmE,EAAuC,CAC3CC,YAAaC,KAGf,SAASC,EAAyBC,EAAWC,GAC3C,OAAOA,KAAKD,EAGd,IAAME,EAAc,SAACf,GACnB,IAAMgB,EAAM,eAAQP,GAEpB,GAAoB,kBAATT,GAA8B,OAATA,EAAe,CAC7C,GAAIY,EAAOZ,EAAM,gBAAuC,KAArBA,EAAKU,YAAoB,CAAC,IACnDA,EAAgBV,EAAhBU,YAEmB,kBAAhBA,GAA4BO,oBAAUP,GAC/CM,EAAON,YAAcQ,qBAAWR,IAEhCS,QAAQlB,MAAM,0BACdkB,QAAQC,IAAIV,IAIhB,GAAIE,EAAOZ,EAAM,iBAAyC,KAAtBA,EAAKqB,aAAqB,CAAC,IACrDA,EAAiBrB,EAAjBqB,aAEoB,kBAAjBA,EACTL,EAAOK,aAAeA,GAEtBF,QAAQlB,MAAM,2BACdkB,QAAQC,IAAIC,IAIhB,GAAIT,EAAOZ,EAAM,eAAgB,CAAC,IACxBsB,EAAgBtB,EAAhBsB,YAEmB,mBAAhBA,EACTN,EAAOM,YAAcA,GAErBH,QAAQlB,MAAM,0BACdkB,QAAQC,IAAIE,UAIhBH,QAAQlB,MAAM,qBACdkB,QAAQC,IAAIpB,GAGd,OAAOgB,GAGLO,OAA4DhC,EAE1DiC,EAAW,uCAAG,4BAAAjB,EAAA,+EAEOZ,MAAM,eAFb,WAEVD,EAFU,QAIF+B,GAJE,sBAKR,IAAI7D,MAAJ,8CAAiD8B,EAASgC,OAA1D,MALQ,mBAQTX,EARS,SAQSrB,EAASM,OARlB,qGAUhBmB,QAAQlB,MAAR,MAVgB,iCAWJQ,IAXI,0DAAH,qDAeJkB,EAAY,WAKvB,OAJKJ,IACHA,EAAgBC,KAGXD,G,OC3DHK,EAAiBC,6BAA+CtC,GAahEuC,EAA6B,CAAC,YAAa,QAAS,UAAW,UAAW,UAEnEC,EAAkD,SAAC,GAKzD,IAJLC,EAII,EAJJA,SACAC,EAGI,EAHJA,OACAC,EAEI,EAFJA,2BACAC,EACI,EADJA,2BACI,EAC4CC,cAA/BC,EADb,EACIC,QAAmBC,EADvB,EACuBA,QAASC,EADhC,EACgCA,QADhC,EAEwBC,qBAFxB,mBAEGzB,EAFH,KAEW0B,EAFX,KAIEC,EAAaC,mBAAQ,WACzB,GAAI5B,GAAUqB,GAAYE,GAAWC,EACnC,IACE,OAAOK,4BAAkBR,EAAUA,EAASS,UAAUP,GAAUC,EAAS,CACvEO,YAAaR,EACb7B,YAAaM,EAAON,YACpBsC,SAAU,gBAEZ,aAEH,CAAChC,EAAQqB,EAAUE,EAASC,IAkC/B,GAhCAS,qBAAU,WACRtB,IAAYuB,KAAKR,KAChB,IAEHO,qBAAU,WACR,GAAIjC,GAAU2B,EAAY,CAAC,IACjBN,EAAsBM,EAAtBN,SAAUG,EAAYG,EAAZH,QAMlB,GAJIW,4BAAkBd,IAAaA,EAASG,UAAYA,IACtDH,EAASG,QAAUA,GAGjBY,uCAA6Bf,GAAW,CAC1C,IAAMgB,EAAUC,YAAWd,GAY3B,OATEa,EAAQE,MACRzB,EAA2B0B,SAASH,EAAQE,OAC5CvC,EAAOK,aAEPgB,EAASoB,cAAT,MAAApB,EAAQ,YAhDD,SAACgB,EAAiBhC,GAAlB,MAA6D,CAAC,SAAD,OACvD,cAAZgC,EAA0B,UAAYA,EAD6B,4BACFhC,GAC1EgC,GA8CkCK,CAASL,EAAQE,KAAMvC,EAAOK,gBAC/CsB,EAAWgB,QACpBtB,EAASoB,cAAT,eAA+BG,OAAOC,SAASC,SAA/C,SAAgEtB,GAG3D,WACLH,EAAS0B,sBAId,CAAC/C,EAAQ2B,KAEP3B,IAAWqB,IAAaE,IAAYC,EACvC,OAAO,mCAAGP,IAGZ,GAAIjB,EAAOM,aAA2B,IAAZkB,EACxB,OAAO,mCAAGL,IAGZ,IAAKQ,EACH,OAAOT,EAA6B,mCAAGA,EAA2BM,KAAe,KAGnF,IAAMwB,EAAUC,gBAAcC,MAAMvB,GAGpC,OAFAqB,EAAQG,MAAMC,SAAU,EAGtB,cAACxC,EAAeyC,SAAhB,CAAyBtG,MAAO,CAAEiD,SAAQuB,UAASF,WAAU2B,WAA7D,SACGhC,KAKMsC,EAAa,WACxB,IAAMC,EAAiBC,qBAAW5C,GAElC,IAAK2C,EACH,MAAM,IAAI3G,MAAM,yDAGlB,OAAO2G,GCvHIE,EAAoB,I,OAAIC,GAAkB,I,gDCiCvDpC,IAAQqC,IACNC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,KAGF,IAAMC,EAAU,SAACnD,GACf,OAAQA,GACN,IAAK,YACH,MAAO,CAAC,MAAO,aACjB,IAAK,kBACH,MAAO,CAAC,MAAO,mBACjB,QACE,OAAOA,IAQAoD,EAA4B,SAAC,GAAD,IAAGpD,EAAH,EAAGA,KAAMqD,EAAT,EAASA,MAAUtH,EAAnB,uCACvC,cAAC,IAAD,aAAiBsH,MAAOA,EAAOC,KAAMH,EAAQnD,IAAWjE,KCrEpDwH,EAAiB,SAACC,GACtB,OAAQA,GACN,IAAK,UACH,OAAO,cAAC,EAAD,CAAMxD,KAAK,eAAeyD,MAAM,UAAUC,aAAW,YAC9D,IAAK,UACH,OAAO,cAAC,EAAD,CAAM1D,KAAK,uBAAuByD,MAAM,UAAUC,aAAW,YACtE,IAAK,SACH,OAAO,cAAC,EAAD,CAAM1D,KAAK,uBAAuByD,MAAM,SAASC,aAAW,WACrE,IAAK,OACH,OAAO,cAAC,EAAD,CAAM1D,KAAK,cAAcyD,MAAM,OAAOC,aAAW,SAE5D,OAAO,MAGIC,EAAgC,SAAC,GAAD,IAC3CH,EAD2C,EAC3CA,OACAI,EAF2C,EAE3CA,MACAN,EAH2C,EAG3CA,KACAO,EAJ2C,EAI3CA,YACAC,EAL2C,EAK3CA,SACArF,EAN2C,EAM3CA,SAN2C,OAQ3C,eAAC,IAAD,CAAMsF,GAAI,CAAEC,EAAG,EAAGC,aAAc,OAAhC,UACGT,EAAS,cAAC,IAAD,CAAKO,GAAI,CAAEG,OAAQ,MAAOC,GAAIX,EAAQS,aAAc,iBAAsB,KACpF,eAAC,IAAD,CACEF,GAAI,CACFK,eAAgB,gBAChBC,WAAY,SACZC,aAAc,EACdC,YAAa,QACbP,EAAG,CAAC,EAAG,GACPQ,GAAI,GAPR,UAUGlB,GAAQC,EAAeC,GACxB,cAAC,IAAD,CAASiB,GAAG,KAAKV,GAAI,CAAEW,UAAW,SAAUC,SAAU,CAAC,EAAG,GAAIC,GAAI,CAAC,EAAG,IAAtE,SACGhB,IAEH,cAAC,IAAD,CAAQiB,QAAQ,OAAOC,QAAShB,EAAhC,SACE,cAAC,EAAD,CAAM9D,KAAK,QAAQ+E,KAAK,KAAKrB,aAAYG,GAAe,gBAG3DpF,MC5CQuG,EAA0C,SAAC,GAAD,IACrDpB,EADqD,EACrDA,MACAC,EAFqD,EAErDA,YACAC,EAHqD,EAGrDA,SACAmB,EAJqD,EAIrDA,WACAC,EALqD,EAKrDA,QACAzG,EANqD,EAMrDA,SANqD,OAQrD,eAAC,EAAD,CAAQ+E,OAAO,SAASI,MAAOA,EAAOC,YAAaA,EAAaC,SAAUA,EAA1E,UACE,cAAC,IAAD,CAAKC,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SAAyBvF,IACzB,eAAC,IAAD,CACEsF,GAAI,CACFC,EAAG,CAAC,EAAG,GACPmB,UAAW,EACXZ,YAAa,QACbH,eAAgB,WAChBgB,cAAe,CAAC,SAAU,OAC1Bf,WAAY,UAPhB,UAUE,cAAC,IAAD,CACEQ,QAAQ,SACRd,GAAI,CACFsB,GAAI,CAAC,EAAG,GACRC,GAAI,CAAC,EAAG,GACRC,MAAO,CAAC,OAAQ,SAElBT,QAAShB,EAPX,SASGD,GAAe,WAElB,cAAC,IAAD,CAAQE,GAAI,CAAEwB,MAAO,CAAC,OAAQ,SAAWT,QAASI,EAAlD,SACGD,GAAc,iBChCVO,EAA8C,SAAC,GAAD,IACzD5B,EADyD,EACzDA,MACAN,EAFyD,EAEzDA,KACAmC,EAHyD,EAGzDA,WACA5B,EAJyD,EAIzDA,YACAC,EALyD,EAKzDA,SACArF,EANyD,EAMzDA,SANyD,OAQzD,eAAC,EAAD,CAAQmF,MAAOA,EAAON,KAAMA,EAAMO,YAAaA,EAAaC,SAAUA,EAAtE,UACGrF,EACD,cAAC,IAAD,CAAKsF,GAAI,CAAEa,GAAI,CAAC,EAAG,GAAIJ,GAAI,CAAC,EAAG,IAA/B,SACE,eAAC,IAAD,CACET,GAAI,CACFqB,cAAe,CAAC,SAAU,OAC1BjB,GAAI,QACJH,EAAG,CAAC,EAAG,GACPK,WAAY,CAAC,SAAU,SAL3B,UAQE,cAAC,IAAD,CAASU,KAAK,MAAMhB,GAAI,CAAEsB,GAAI,CAAC,EAAG,GAAIC,GAAI,CAAC,EAAG,MAC9C,cAAC,IAAD,CAAMvB,GAAI,CAAEqB,cAAe,SAAUf,WAAY,CAAC,SAAU,eAA5D,SACGoB,aCvBEC,EAA4E,SAAC,GAAD,IACvF9B,EADuF,EACvFA,MACAN,EAFuF,EAEvFA,KACAQ,EAHuF,EAGvFA,SACArF,EAJuF,EAIvFA,SAJuF,OAMvF,cAAC,EAAD,CACEmF,MAAOA,EACPN,KAAMA,EACNmC,WACE,qCACE,cAAC,IAAD,CAAM1B,GAAI,CAAE4B,WAAY,QAAxB,oDACA,cAAC,IAAD,oDAGJ9B,YAAY,oBACZC,SAAUA,EAVZ,SAYE,cAAC,IAAD,CAAKC,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SAAyBvF,OC3BhBmH,EAAyB,kBACpC,sBAAKL,MAAM,KAAKrB,OAAO,KAAK2B,QAAQ,YAAYC,KAAK,OAAOC,MAAM,6BAAlE,UACE,4DACA,sBACEC,EAAE,+IACFF,KAAK,YAEP,sBAAME,EAAE,oDAAoDF,KAAK,YACjE,sBAAMG,EAAE,UAAUC,EAAE,UAAUX,MAAM,UAAUrB,OAAO,IAAI4B,KAAK,YAC9D,sBACEE,EAAE,ylFACFF,KAAK,gBCVEK,EAAkB,SAAC,GAAD,IAAG1H,EAAH,EAAGA,SAAH,OAC7B,cAAC,IAAD,CAAWoG,QAAQ,eAAnB,SACE,cAAC,IAAD,CAAWA,QAAQ,QAAnB,SAA4BpG,OC2B1B2H,EAAsE,SAACC,EAAOC,GAClF,OAAQA,EAAOC,MACb,IAAK,kBACH,MAAO,CACLA,KAAM,aACNC,UAAWF,EAAOE,WAEtB,IAAK,mBACH,MAAO,CACLD,KAAM,SACNC,UAA0B,aAAfH,EAAME,KAAsBrF,EAAoBmF,EAAMG,WAErE,IAAK,OACH,GAAmB,aAAfH,EAAME,KACR,MAAO,CACLA,KAAMD,EAAO5J,MAAMC,QAAQ8J,MAAM,kBAC7B,iBACAH,EAAO5J,MAAMC,QAAQ8J,MAAM,oBAC3B,iBACA,SACJD,UAAWH,EAAMG,WAGrB,MACF,IAAK,QACH,GAAmB,aAAfH,EAAME,KACR,MAAO,CACLA,KAAM,aACNC,UAAWH,EAAMG,WAGrB,MACF,IAAK,SAIL,IAAK,aACH,MAAO,CACLD,KAAM,YASZ,OALA3I,QAAQ8I,KAAK,sCACb9I,QAAQC,IAAIyI,GACZ1I,QAAQC,IAAI,eACZD,QAAQC,IAAIwI,GAELA,GASIM,EAAkD,SAAC,GAA0B,IAAxBlI,EAAuB,EAAvBA,SAAUC,EAAa,EAAbA,OAAa,EACvCG,cAAxC+H,EAD+E,EAC/EA,SAAUC,EADqE,EACrEA,WAAYC,EADyD,EACzDA,OAAQpK,EADiD,EACjDA,MAChCqK,EC1ED,WAA6C,IAAD,EACpBlI,cAArB+H,EADyC,EACzCA,SAAUE,EAD+B,EAC/BA,OAD+B,EAEvB5H,oBAAS,GAFc,mBAE1C8H,EAF0C,KAEnCC,EAFmC,KAyBjD,OArBAvH,qBAAU,YACuB,uCAAG,sBAAA1C,EAAA,+EAEpBkE,EAAkBgG,eAFE,kDAGtBN,EAAS1F,OAAmBlF,GAAW,GAHjB,mCAKtB,IAAI3B,MAAM,gBALY,yDAQ9B4M,GAAS,GARqB,0DAAH,oDAW/BE,KACC,CAACP,IAEJlH,qBAAU,WACJoH,GACFG,GAAS,KAEV,CAACH,IAEGE,EDiD2BI,GAFqD,EAGnDC,qBAAWjB,EAAmB,CAAEG,KAAM,aAHa,mBAGhFe,EAHgF,KAG/DC,EAH+D,KAIjFC,EAVe,8CAAOnH,OAA4BoH,gBAAnC,aAAM,EAAuCD,kBAA7C,SAUFE,GAiBnB,OAfAhI,qBAAU,WACJhD,IACF6K,EAAS,CAAEhB,KAAM,OAAQ7J,UACzBmK,OAED,CAACnK,EAAOmK,IAEXnH,qBAAU,WAEN6H,EADET,EACO,CAAEP,KAAM,oBAER,CAAEA,KAAM,iBAElB,CAACO,IAECC,EAIwB,WAAzBO,EAAgBf,KACX,mCAAG9H,IAIV,qCACE,cAAC,IAAD,CAAMsF,GAAI,CAAEG,OAAQ,QAASE,eAAgB,SAAUC,WAAY,UAAnE,SACE,cAAC,IAAD,CACES,QAAS,WACPyC,EAAS,CAAEhB,KAAM,kBAAmBC,UAAWtF,IAC/C0F,EAAS1F,IAHb,SAMGsG,EACC,qCACE,cAAC,EAAD,IACA,cAAC,IAAD,CAAKzD,GAAI,CAAE4D,GAAI,GAAf,oCAGF,qCACE,cAAC,EAAD,CAAM3H,KAAK,OAAO+E,KAAK,OACvB,cAAC,IAAD,CAAKhB,GAAI,CAAE4D,GAAI,GAAf,mCAMkB,WAAzBL,EAAgBf,MACf,cAAC,EAAD,UACE,eAAC,EAAD,CACE3C,MAAO4D,EAAa,gCAAkC,2BACtD1D,SAAU,kBAAMyD,EAAS,CAAEhB,KAAM,YACjCrB,QAAS,WACPqC,EAAS,CAAEhB,KAAM,UACjBK,EAASU,EAAgBd,YAL7B,UAQE,cAAC,IAAD,CAAKzC,GAAI,CAAEW,UAAW,UAAtB,4EAGA,eAAC,IAAD,CAAMX,GAAI,CAAE6D,WAAY,GAAKC,KAAK,oCAAoCC,OAAO,SAA7E,wBACa,cAAC,EAAD,CAAM/C,KAAK,KAAK/E,KAAK,8BAMd,eAAzBsH,EAAgBf,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MACE4D,EAAa,iCAAmC,oCAElDlE,KAAMkE,EAAa,cAAC,EAAD,IAAmB,cAAC,EAAD,CAAMxH,KAAK,SAAS+E,KAAK,OAC/DjB,SAAU,kBAAMyD,EAAS,CAAEhB,KAAM,YALnC,SAOE,eAAC,IAAD,CAAMxC,GAAI,CAAEW,UAAW,UAAvB,sDAEG8C,EACC,mHAEA,+GAOgB,mBAAzBF,EAAgBf,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MAAM,qBACNE,SAAU,kBAAMyD,EAAS,CAAEhB,KAAM,YACjCrB,QAAS,WACPqC,EAAS,CAAEhB,KAAM,UACjBK,EAASU,EAAgBd,YAL7B,SAQE,cAAC,IAAD,6EAKoB,mBAAzBc,EAAgBf,MACf,cAAC,EAAD,UACE,cAAC,EAAD,CACE3C,MAAM,+BACNE,SAAU,kBAAMyD,EAAS,CAAEhB,KAAM,YACjCrB,QAAS,WACPqC,EAAS,CAAEhB,KAAM,UACjBK,EAASU,EAAgBd,YAL7B,SAQE,cAAC,IAAD,iGAhGD,mCAAG9H,K,mCEjGP,MAAMqJ,GAA8C,EAAGC,UAE1D,eAAC,IAAD,CAAMH,KAAMG,EAAMF,OAAO,SAAzB,wBACa,cAAC,EAAD,CAAM/C,KAAK,KAAK/E,KAAK,yBAKzBiI,GAAkC,EAAGxJ,WAAU9B,UAASuL,YAAY,MAAOF,UAEpF,cAAC,KAAD,CACEG,aAAa,EACbD,UAAWA,EACXE,QACE,eAAC,IAAD,CAAMvD,QAAQ,UAAd,UACGlI,EACAqL,GACC,cAAC,IAAD,CAAKK,GAAI,EAAT,SACE,cAACN,GAAD,CAAeC,KAAMA,SAR/B,SAcE,+BAAOvJ,M,cC3BP6J,GAA2B,CAC/BC,cAAe,OACfC,UAAW,QACXC,WAAY,6BAGRC,GAAe,CACnBC,YATkB,GAUlBC,OAAQC,aAAY,2BACfP,IADc,IAEjBQ,uBAAwB,OAItBC,GAAe,CACnBJ,YAjBkB,GAkBlBC,OAAQC,aAAY,2BACfP,IADc,IAEjBQ,uBAAwB,QAMtBE,GAAQC,eACZC,MACA,uBAAG1O,QAAH,EAAoBA,SAOhB2O,GAAoE,SAAC,GAAe,IAAb9C,EAAY,EAAZA,MAAY,EAC7DnH,mBAAS,GADoD,mBAChF1E,EADgF,KACzE4O,EADyE,KAYvF,OARA1J,qBAAU,WACM,cAAV2G,EACFgD,YAAW,kBAAMD,EAJJ,KAIwB,IAErCC,YAAW,kBAAMD,EAASE,OAAkB,MAE7C,CAACjD,IAEa,cAAVA,EACL,cAAC2C,GAAD,wCAAaxO,QAAO8O,SAXL,GAWkBP,KAAjC,aACE,cAAC,EAAD,CAAM/I,KAAK,QAAQyD,MAAM,QAAQsB,KAAK,UAE5B,WAAVsB,GAAgC,cAAVA,EACxB,cAAC2C,GAAD,yBAAOxO,MAAO,GAAd,aAAuB8O,SAfR,GAeqBP,KAApC,aACE,cAAC,EAAD,CAAM/I,KAAK,QAAQyD,MAAM,QAAQsB,KAAK,UAGxC,cAACiE,GAAD,wCAAaxO,QAAO8O,SAnBL,GAmBkBZ,KAAjC,aACE,cAAC,EAAD,CAAM1I,KAAK,MAAMyD,MAAM,QAAQsB,KAAK,KAAKwE,MAAI,QAWtCC,GAAsD,SAAC,GAA+B,IAA7BnD,EAA4B,EAA5BA,MAAO1J,EAAqB,EAArBA,QAAS0G,EAAY,EAAZA,MACpF,MAAc,SAAVgD,GAA8B,uBAAVA,EACf,KAIP,eAAC,IAAD,CACEtC,GAAE,aACAM,WAAY,SACZF,GACY,cAAVkC,EACI,UACU,cAAVA,EACA,UACU,WAAVA,EACA,SACA,UACNrC,EAAG,EACHyF,GAAI,EACJC,SAAU,QACVnE,MAAO,QACPoE,OAAQ,EACRC,SAAU,UACPvG,GAjBP,UAoBE,cAAC,IAAD,CAAKU,GAAI,CAAEsB,GAAI,EAAGE,MAAO,OAAQrB,OAAQ,QAAzC,SACE,cAAC,GAAD,CAA0BmC,MAAOA,MAGnC,cAAC,IAAD,CAAMtC,GAAI,CAAEY,SAAU,EAAGlB,MAAO,SAAhC,SACa,2BAAV4C,EACG,2BACU,cAAVA,EACA,YACU,WAAVA,EACA1J,GAAW,wCACX,kBCnDZ,MAAMkN,GAAqBC,IAAMxL,mBAE/BtC,GAEW+N,GAAgC,EAAGtL,eAC9C,MAAMuL,EAAmB9K,mBAA2B,CAAEqH,KAAM,SAC5D,OACE,cAACsD,GAAmB/I,SAApB,CAA6BtG,MAAOwP,EAApC,SAAuDvL,KAIrDwL,GAAsB,KAC1B,MAAMD,EAAmB/I,qBAAW4I,IAEpC,IAAKG,EACH,MAAM,IAAI3P,MAAM,iEAGlB,OAAO2P,GAGIE,GAAyBC,IACpC,MAAOH,GAAoBC,KAE3B,MAAiC,SAA1BD,EAAiBzD,OACL,kBAAT4D,EAAoBH,EAAiBvQ,KAAO0Q,EAAOH,EAAiBvQ,GAAGgN,MAAM0D,IACnFH,EACA,CAAEzD,KAAM,SAkCD6D,GAAyB,CACpC3Q,EACAa,KAEA,MAAO0P,EAAkBK,GAAuBJ,KA4BhD,MAAO,CA1BiBK,uBAAYzO,UAClCwO,EAAoB,CAAE9D,KAAM,qBAAsB9M,OAElD,IACE,MAAM8Q,QAAWjQ,IAEjB+P,EAAoB,CAClB9D,KAAM,yBACN9M,KACA8Q,OAEF,MAAO7N,GAhDOA,IACD,kBAAVA,GACG,OAAVA,GACA,YAAaA,GACsC,kBAA3CA,EAA+BC,QA6C/B6N,CAAW9N,IAAUA,EAAMC,QAAQsD,SAAS,qCAC9CoK,EAAoB,CAAE9D,KAAM,YAAa9M,QAEzCmE,QAAQlB,MAAMA,GAEd2N,EAAoB,CAClB9D,KAAM,SACN9M,KACAiD,MAAO,IAAIrC,MAAM,gDAItB,CAACC,EAAMb,EAAI4Q,IAEWL,IAGpB,SAASS,IAA2D,GACzEhR,EADyE,QAEzEiR,EAFyE,iBAGzEC,EAHyE,YAIzEC,EAJyE,SAKzEC,EALyE,KAMzEvQ,EANyE,SAOzEmE,IACuB,IAAD,EACtB,MAAOqM,EAAiBd,GAAoBI,GAAuB3Q,EAAIa,GACjEyQ,EAAUjB,IAAMkB,SAASC,KAAQxM,GAEjCyM,GAAkBL,GAAY,IACjCM,QAAO,EAAEC,MAAkBA,IAC3BxP,KAAI,EAAE,CAAEyP,KAAYA,IAGK,uBAA1BrB,EAAiBzD,MACS,2BAA1ByD,EAAiBzD,MAEjB2E,EAAeI,KAAK,kCAMtB,MAAMC,EACY,iBAJlBX,EACEM,EAAeM,OAAS,EAAxB,UAA4BZ,SAA5B,QAA4CF,EAAU,YAAc,mBAAiB1O,GAIjF8N,IAAM2B,aACJV,EACA,CACEW,UAAU,EACV7G,QAAS,UAEXqG,EAAe,IAED,cAAhBN,EACAd,IAAM2B,aAAaV,EAAS,CAAEW,UAAU,IACxC5B,IAAM2B,aAAaV,EAAS,CAAEjG,QAASgG,IAM7C,MAJoB,cAAhBF,IACFF,EAAUQ,EAAe,IAGpBR,EACL,mCACE,cAACzC,GAAD,CAAStL,QAAS+N,EAASxC,UAAWyC,GAAoB,QAA1D,SACGY,MAILA,EAMJ,MAYaI,GAA+B,KAC1C,MAAM,SAAE7M,GAAaiC,KACdiJ,EAAkBK,GAAuBJ,KAE1CxQ,EAA+B,SAA1BuQ,EAAiBzD,KAAkByD,EAAiBvQ,QAAKuC,EAC9DuO,EAA+B,2BAA1BP,EAAiBzD,KAAoCyD,EAAiBO,QAAKvO,EA2GtF,OAzGA0D,qBAAU,KACR,GAAIjG,GAAM8Q,EAAI,CACZ,IAAIqB,GAAY,EACZC,GAAW,EAEf,MAAMC,EAASvB,EAAGwB,mBAAmBC,KAE/BC,EAAsBpQ,UAC1B,IACE,MAAMqQ,QAAgB3B,EAAG4B,iBAEzB,GAAIP,EACF,OAGF,MAAM,cAAEQ,GAAkBF,EAAQG,WAC5BC,EAAcJ,EAAQG,WAAWC,YAAcF,EAAgB,EAKrE,GAJAxO,QAAQC,IAAK,UAASyO,KAAeF,iBAA6BN,KAClElO,QAAQC,IAAK,wBAAuBiO,KACpCD,GAAW,EAEY,cAAnBK,EAAQ/N,OACVP,QAAQC,IAAK,GAAEqO,KAEf7B,EAAoB,CAClB9D,KAAM,mBACN9M,WAEG,CACL,MAAM4R,OAhDWxP,OAAOiD,EAAoByL,KACtD,IACE,MAAMzN,QAAegC,EAASyN,KAAKhC,EAAIA,EAAG+B,aAE1C,GAAIE,wBAAc1P,GAAU,KAAO,GAAoC,eAA/B2P,uBAAa3P,EAAQ,EAAG,GAC9D,OAAQ4P,IAAgBC,OAAO,CAAC,UAAWF,uBAAa3P,EAAQ,IAAiB,GAEnF,MACA,SAwC6B8P,CAAqB9N,EAAUoN,EAAQG,YAE5D,GAAIT,EACF,OAGFhO,QAAQlB,MAAO,MAAKoP,YAChBT,GACFzN,QAAQlB,MAAO,kBAAiB2O,KAGlChB,EAAoB,CAClB9D,KAAM,SACN9M,KACAiD,MAAO,IAAIrC,MAAMgR,EAAU,aAAYA,IAAW,aAGtD,MAAOwB,GACP,GAAIjB,EACF,OAGFC,GAAW,EAEPgB,aAAoBC,mCACtBlP,QAAQC,IAAK,gBAAeiO,KAC5BzB,EAAoB,CAAE9D,KAAM,YAAa9M,SAEzCmE,QAAQlB,MAAO,gCAA+BoP,KAC9ClO,QAAQlB,MAAMmQ,GAEdxC,EAAoB,CAClB9D,KAAM,SACN9M,KACAiD,MAAO,IAAIrC,MAAM,eASzB,OAHAuD,QAAQC,IAAK,uBAAsBiO,KACnCG,IAEO,KACAJ,IACHxB,EAAoB,CAAE9D,KAAM,SAC5B3I,QAAQC,IAAK,wBAAuBiO,KACpCF,GAAY,OAIjB,CAAC9M,EAAUrF,EAAI8Q,EAAIF,IAEtB3K,qBAAU,KACR,GAA8B,qBAA1BsK,EAAiBzD,MAA+B9M,EAElD4Q,EAAoB,CAAE9D,KAAM,YAAa9M,YACpC,GACqB,cAA1BuQ,EAAiBzD,MACS,WAA1ByD,EAAiBzD,MACS,cAA1ByD,EAAiBzD,KACjB,CACA,IAAIqF,GAAY,EAQhB,OANAvC,YAAW,KACJuC,GACHvB,EAAoB,CAAE9D,KAAM,WAE7B,KAEI,KACLqF,GAAY,MAGf,CAAC5B,EAAiBzD,KAAM8D,EAAqB5Q,IAElB,SAA1BuQ,EAAiBzD,MAA6C,uBAA1ByD,EAAiBzD,KAChD,KAIP,cAAC,GAAD,CACEF,MAAO2D,EAAiBzD,KACxB5J,QAAmC,WAA1BqN,EAAiBzD,KAAoByD,EAAiBtN,MAAMC,aAAUX,KCxV/E+Q,GACE,UASFC,GAAS,CACbC,QAASF,GACTG,UAVQ,UAWRC,OAVM,UAYNC,QAXO,UAYPC,QAXQ,UAYRC,OAXK,UAYLC,YAXU,UAYVC,KAAMT,GACNU,QAAS,OAETC,KAAM,UACNC,WAAY,QACZC,MAAO,UACPC,UAAW,WAGPC,GAAiC,CACrCC,QAAS,OACT1J,WAAY,SACZD,eAAgB,SAEhB,WAAY,CAAE4J,OAAQ,YAGlBC,GAA6B,IAC9BH,GAEHlJ,GAAI,OACJsJ,GAAI,OAEJzK,MAAO,QACP0K,OAAQ,EAERxI,WAAY,OAEZ,YAAa,CACXyI,QAAS,KAIPC,GAAgB,CAAC5K,EAAe6K,KAAhB,CACpB7K,QACAc,YAAad,EACbkK,WAAY,OAEZ,iBAAkB,CAChBlK,MAAO,aACPU,GAAImK,EACJ/J,YAAa+J,KAIXC,GAAiC,IAClCT,GAEHU,QAAS,EACTjJ,MAAO,OACPrB,OAAQ,OAERyJ,WAAY,OAEZ,YAAa,CACXlK,MAAO,OACP2K,QAAS,MAIPK,GAAsB,QAEtBC,GAAW,CAAC,EAAG,EAAG,GAClBC,GAAW,CAAC,EAAG,EAAG,GAElBC,GAA2B,CAC/BlF,SAAU,WACVrB,GAAIsG,GACJR,OAAQ,EACRU,UAAW,CAAC,EAAG,KAAM,IAGjBC,GAA+B,IAChCF,GAEHJ,QAAS,EAETjK,YAAa,wBACboJ,WAAY,4CAEZoB,GAAI,CACFzJ,GAAI,EACJX,SAAU8J,KAIRO,GAA+B,CACnCjB,QAAS,QACTxI,MAAO,OACP0J,WAAY,EACZT,QAAS,EACT7J,SAAU,GAGNuK,GAA+B,IAChCF,GAEH7K,GAAI,aACJgK,OAAQ,EACR5J,YAAa,QACbN,aAAc,EACd4K,UAAW,CAAC,EAAG,IAYXM,GAAmC,CACvCzF,SAAU,QAEV0F,KAAM,EACNC,IAAK,EACL9J,MAAO,QACPrB,OAAQ,SAGJoL,GAAqC,CACzC3B,WAAa,0BAAyBX,GAAOW,eAAeX,GAAOY,UAuWtD2B,OApWM,CACnBC,YAAa,CAAC,OAAQ,OAAQ,QAE9BC,MAAO,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAEvCC,MAAO,CACLpT,KAAM,CACJ,YACA,gBACA,qBACA,aACA,SACA,mBACA,cACAqT,KAAK,MACPC,QAAS,UACTC,UAAW,oBAGbC,UAAW,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAE5CC,YAAa,CACXzT,KAAM,IACNsT,QAAS,IAETI,MAAO,IACPC,OAAQ,IACRC,KAAM,KAGRC,YAAa,CACX7T,KAAM,IACNsT,QAAS,MAGX5C,UAEAoD,QAAS,CAAC,EAAG,YAAa,aAE1BC,QAAS,CAAC,IAAK,oCAAqC,sCAEpD3C,KAAM,CACJxU,QAAS,CACPoX,WAAY,YACZ3L,SAAU,IAId4L,QAAS,CACPtD,QAAS,IACJgB,GAEH9J,GAAI,UACJI,YAAa,UAEb,iBAAkB,CAChBJ,GAAI,YACJI,YAAa,cAIjBiM,QAAS,IACJvC,MACAI,GAAc,UAAW,cAG9BoC,OAAQ,IACHxC,MACAI,GAAc,OAAQ,QAEzBD,QAAS,IAGXd,OAAQ,IACHW,GAEH9J,GAAI,SACJI,YAAa,SAEb,iBAAkB,CAChBJ,GAAI,cACJI,YAAa,gBAIjBjB,KAAM,IACDiL,GACH9K,MAAO,UACP,iBAAkB,CAAEA,MAAO,WAG7BiN,WAAY,IACPnC,GACH9K,MAAO,SACP,iBAAkB,CAAEA,MAAO,gBAG7BkN,UAAW,IACNpC,GACH9K,MAAO,OACP,iBAAkB,CAAEA,MAAO,YAG7BmN,MAAO,CACL5C,OAAQ,YAIZ6C,MAAO,CACL5D,QAAS,IACJ2B,GAEHJ,QAAS,EAETjK,YAAa,QACbJ,GAAI,aAEJ,OAAQ,CACN4J,QAAS,OACT3J,eAAgB,gBAChBC,WAAY,SAEZH,OAAQ,OAERuF,GAAI,EACJyE,GAAI,EACJ4C,GAAI,EAEJ3M,GAAI,QAEJQ,SAAU8J,KAIdjB,KAAM,IACDsB,GAEHf,QAAS,CAAC,OAAQ,UAGpBgD,UAAW,IACNjC,GAEHpF,SAAU,QACV2F,IAAK,EACL2B,MAAO,EACP5B,KAAM,EACN/G,GAAI,OACJnE,OAAQ,MACR+M,UAAW,UAGbvG,QAAS,CACP/E,WAAY,OACZuL,QAAS,EAETlU,EAAG,CACDyG,MAAO,SACP,SAAU,CACR2K,QAAS,OAMjB+C,MAAO,CACLC,MAAO,IACFpC,IAGLqC,WAAY,CACVhM,GAAI,EACJE,MAAO,QAEP+L,IAAK,CACHjM,GAAI,IAIRkM,KAAM,IACDrC,GAEHxK,UAAW,SACXP,GAAI,SAGNqN,MAAO,IACFtC,GAEHuC,KAAM,GAGRC,OAAQ,IAGVC,OAAQ,CACNC,OAAQ,CACN7D,QAAS,OACT3J,eAAgB,gBAChBC,WAAY,UAEZqF,SAAU,CAAC,QAAS,YACpB2F,IAAK,EACLwC,OAAQ,EAERjN,GAAI,CAAC,EAAG,OAAQ,OAAQ,GACxBsJ,GAAI,CAAC,EAAG,OAAQ,WAEboB,GACHT,UAAW,CAAC,EAAG,SAGjBiD,OAAQ,CACN/D,QAAS,OACT1J,WAAY,SACZD,eAAgB,SAEhBiE,GAAIsG,GACJ/J,GAAI,EACJmN,UAAW,OAEX5N,GAAI,SAGN6N,KAAM,CACJzM,MAAO,OACP0M,SAAU,SACVC,GAAI,OACJ7J,GAAI,CAAC,OAAQ,GACb/C,GAAI,CAAC,OAAQ,QACbV,GAAI8J,IAGNyD,QAAS,CACPpE,QAAS,OACTqE,SAAU,OACVC,aAAc,UAGhBjD,KAAM,CACJ0B,GAAIpC,GACJnJ,MAAO,CAAC,OAAQ,QAGlByL,MAAO,CACLzL,MAAO,CAAC,OAAQ,QAGlB+M,QAAS,CACPlO,eAAgB,WAChBiE,GAAI,EAEJ4F,OAAQ,CACNtG,GAAI,IAIR4K,gBAAiB,CAtRnB7I,SAAU,WAEV0F,KAAM,EACNC,IAAK,EACL9J,MAAO,OACPrB,OAAQ,OAoRJC,GAAI,4BAGNgL,aAAc,IACTA,GAEHhL,GAAI,qBAEJ4J,QAAS,OACT3J,eAAgB,SAChBC,WAAY,UAGdmO,MAAO,CACLhE,QAAS,EACTjJ,MAAO,CAAC,OAAQ,SAGlBkN,YAAa,IACRtD,GAEHpB,QAAS,CAAC,QAAS,QAEnB5J,GAAI,4BAGNuO,YAAa,CACX3E,QAAS,OACT3J,eAAgB,SAChBuO,EAAG,EACHtO,WAAY,SACZuO,SAAU,SAGZC,QAAS,CACP9E,QAAS,CAAC,OAAQ,QAClB3I,cAAe,SACfpB,EAAG,EACH2O,EAAG,EACHpO,YAAa,QACbc,GAAI,OACJnB,OAAQ,UACLoL,IAGLwD,MAAO,CACL3E,OAAQ,EACRlK,aAAc,EACdD,EAAG,EACHY,GAAI,EACJmO,gBAAiB,QACjBtP,MAAO,QACPkB,SAAU,EACVgB,WAAY,SAIhBiD,OAAQ,CACNoK,KAAM,CACJ1C,WAAY,OACZ1I,WAAY,OACZjC,WAAY,OAEZzB,OAAQ,OAER,QAAS,CACPA,OAAQ,SAIZlH,EAAG,CACDyG,MAAO,UACP,SAAU,CAAEA,MAAO,UACnBwP,eAAgB,OAChBtN,WAAY,QAGduN,SAAU,CACRzP,MAAOuJ,GAAOI,UAIlB+F,MAAO,CACLC,IAAK,CACHxO,GAAI,EACJsJ,GAAI,EACJvI,WAAY,SACZhB,SAAU,EACV0O,cAAe,YACfC,cAAe,MACf/N,MAAO,CAAC,OAAQ,QAChB8C,GAAI,CAAC,EAAG,W,uDClfDkL,GAAO,OACPC,GAAK,OCDLC,GAAiB,SAACva,GAAD,OAAqBA,EAAQwa,OAAO,EAAG,GAAK,MAAQxa,EAAQwa,QAAQ,ICE3F,MAAMC,GAAyB,CACpCC,KAAM,gBACNC,YAAa,+EAGFC,GAAiB,CAC5BF,KAAM,QACNC,YAAa,mFAGFE,GAA0B,CACrCH,KAAM,oCACNC,YACE,yFAGSG,GAA4B,CACvCJ,KAAM,SAGKK,GAAwB,CACnCL,KAAM,eACNC,YACE,0FAGSK,GAA2B,CACtCN,KAAM,kBACNC,YAAa,sCAGFM,GAAsB,CACjCP,KAAM,QACNC,YAAa,2CAGFO,GAAoB,CAC/BR,KAAM,MACNC,YACE,8GAGSQ,GAA2B,CACtCT,KAAM,kBACNC,YACE,qIAGSS,GAA+B,CAC1CV,KAAM,cACNC,YACE,gJAGSU,GAAyB,CACpCX,KAAO,GAAEU,GAAoBV,cAC7BC,YAAc,mEAAkES,GAAoBV,+EAGzFY,GAA2B,CACtCZ,KAAO,GAAEU,GAAoBV,WAC7BC,YAAc,8DAA6DS,GAAoBV,+EAGpFa,GAAuB,CAClCb,KAAM,UACNC,YAAc,6DAA4DS,GAAoBV,0FAGnFc,GAA2B,CACtCd,KAAM,iBACNC,YAAc,kDAAiDS,GAAoBV,qCACnF5L,KAAM,mEAGK2M,GAAwB,CACnCf,KAAM,UACNC,YACE,4FAGSe,GAA0B,CACrChB,KAAM,WACNC,YAAa,qDAGFgB,GAAwB,CACnCjB,KAAM,gBACNC,YACE,oKAGSiB,GAAoB,CAC/BlB,KAAM,MACNC,YAAa,gDAGFkB,GAAuB,CAClCnB,KAAM,mBACNC,YACE,0JACF7L,KAAM,mEAGKgN,GAAuB,CAClCpB,KAAM,SACNC,YAAa,wDAGFoB,GAA0B,CACrCrB,KAAM,UACNC,YAAa,4EAGFqB,GAA4B,CACvCtB,KAAM,YACNC,YAAa,+BAGFsB,GAA0B,CACrCvB,KAAM,UACNC,YAAa,6BAGFuB,GAAuB,CAClCxB,KAAM,cACNC,YACE,uHACF7L,KAAM,+DAGKqN,GAAsB,CACjCzB,KAAM,aACNC,YACE,6GACF7L,KAAM,+DAGKsN,GAA8B,CACzC1B,KAAM,eACNC,YAAa,iEAGF0B,GAA4B,CACvC3B,KAAM,aACNC,YACE,8KACF7L,KAAM,sFAGKwN,GAAiC,CAC5C5B,KAAM,cACNC,YAAa,wEAGF4B,GAAmC,CAC9C7B,KAAM,gBACNC,YACE,4FAGS6B,GAAqC,CAChD9B,KAAM,kBACNC,YAAa,mDAGF8B,GAAmC,CAC9C/B,KAAM,gBACNC,YAAa,iDAGF+B,GAAwB,CACnChC,KAAM,eACNC,YAAa,wFAGFgC,GAA6B,CACxCjC,KAAM,cACNC,YACE,gHACF7L,KAAM,qEAGK8N,GAAiC,CAC5ClC,KAAM,kBACNC,YACE,wQACF7L,KACE,2GAGS+N,GAAqB,CAChCnC,KAAM,YACNC,YAAa,mFACb7L,KAAM,mEAGKgO,GAAwB,CACnCpC,KAAM,SACNC,YACE,sIACF7L,KAAM,mEAGKiO,GAAqC,CAChDrC,KAAM,sBACNC,YACE,gLACF7L,KAAM,yEAGKkO,GAA0B,CACrCtC,KAAM,QACNC,YACE,wGACF7L,KAAM,oEAGKmO,GAA4B,CACvCvC,KAAM,UACNC,YACE,6MACF7L,KAAM,oEAGKoO,GAA6B,CACxCxC,KAAM,UACNC,YACE,gPACF7L,KAAM,oEAGKqO,GAA8B,CACzCzC,KAAM,YACNC,YACE,+JACF7L,KAAM,oEAGKsO,GAAwB,CACnCzC,YAAa,wEACb7L,KAAM,mEAGKuO,GAAsB,CACjC1C,YACE,wNACF7L,KACE,uHC9LSwO,GAAkBlY,wBAA0C,MAE5DmY,GAAc,KACzB,MAAMC,EAAsCzV,qBAAWuV,IAEvD,GAAgB,OAAZE,EACF,MAAM,IAAIrc,MAAM,yDAGlB,OAAOqc,GAGIC,GAAW,CACtBC,QAAS3B,GAAerB,KACxBiD,UAAW3B,GAAiBtB,KAC5BkD,QAAS3B,GAAevB,KACxBmD,aAAc,gB,wBCrEhB,MAAMC,GAA2B,CAC/BC,kBAAmB,KACnBC,0BAA2B,KAC3BC,oBAAqB,KACrBC,iBAAkB,KAClBC,6BAA8B,KAC9BC,sBAAuB,KACvBC,qBAAsB,MAGXC,GAA0D,CACrEC,EAAGC,GACHC,EAAGC,IAIQC,GAAuBvZ,6BAAqCtC,GAE5D8b,GAAmB,KAC9B,MAAMpB,EAAUzV,qBAAW4W,IAE3B,QAAgB7b,IAAZ0a,EACF,MAAM,IAAIrc,MAAM,8DAGlB,OAAOqc,GAGIqB,GAAkC,EAAGtZ,eAAgB,IAAD,EAC/D,MAAM,QAAEQ,GAAYJ,cAEdmZ,OACQhc,IAAZiD,GAAA,UAAwBuY,GAAoBvY,UAA5C,QAAwE+X,GAE1E,OAAO,cAACa,GAAqB/W,SAAtB,CAA+BtG,MAAOwd,EAAtC,SAAkDvZ,KC3B3D,IAAMwZ,GAAS,SAAC,GAAD,MAAsE,CACnFC,eADa,EAAGA,eAEhBC,YAFa,EAAmBA,YAGhCC,YAHa,EAAgCA,cAMlCC,GAAwB,WAAO,IAClCrZ,EAAY+B,IAAZ/B,QADiC,EAE6BsZ,8BAAmBL,IAAjFC,EAFiC,EAEjCA,eAA6BK,EAFI,EAEjBJ,YAA8BC,EAFb,EAEaA,YAFb,EAGgB3B,KAAjD+B,EAHiC,EAGjCA,aAA2BC,EAHM,EAGnBN,YAGhBA,EAAwC,OAFZL,KAA1BR,sBAE6CiB,EAAkBE,EAEvE,OACE,eAAC,IAAD,CAAK1U,GAAI,CAAEgK,QAAS,CAAC,OAAQ,SAA7B,UACE,eAAC,IAAD,CAAMhK,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMrE,KAAK,cAAc+E,KAAK,OAC9B,eAAC,IAAD,CAAMhB,GAAI,CAAE4D,GAAI,EAAGtC,GAAI,EAAGD,cAAe,UAAzC,UACE,cAAC,IAAD,CAASrB,GAAI,CAAEY,SAAU,GAAzB,0BACA,cAAC,IAAD,CAAMF,GAAG,OAAOV,GAAI,CAAEY,SAAU,GAAhC,SACG8O,GAAezU,WAKtB,eAAC,IAAD,CAAM+E,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMrE,KAAK,SAAS+E,KAAK,OAEvB,CACA,CAAC,MAAOmT,GACR,CAAC3E,GAAMvZ,WAAQC,KAAKke,GAAe,IACnC,CAAC3E,GAAIxZ,WAAQC,KAAKme,IAClB,CAAC,QAASpe,WAAQC,KAAKue,GAAgB,KAC7B5c,KAAI,WAAsB8c,GAAtB,uBAAEC,EAAF,KAAYC,EAAZ,YACd,eAAC,IAAD,CAAc7U,GAAI,CAAE4D,GAAI,EAAGvC,cAAe,UAA1C,UACE,cAAC,IAAD,CAASrB,GAAI,CAAEY,SAAU,GAAzB,SAA+BgU,IAC/B,cAAC,IAAD,CAAM5U,GAAI,CAAEY,SAAU,GAAtB,SAA4BiU,EAAQC,eAF3BH,aCtCd,MAAMI,GAAoC,EAC/C9Q,OACAE,YAAY,QACZwC,UACA3F,OAAO,QAGL,eAACkD,GAAD,CAAStL,QAAS+N,EAASxC,UAAWA,EAAWF,KAAMA,EAAvD,iBAEE,cAAC,EAAD,CAAMhI,KAAK,kBAAkB+E,KAAMA,OCX5BgU,GAAsC,EAAGC,UAASva,cAE3D,eAAC,IAAD,CAAMsF,GAAI,CAAEO,aAAc,EAAGC,YAAa,sBAA1C,UACE,eAAC,IAAD,CAAMR,GAAI,CAAEM,WAAY,SAAUD,eAAgB,aAAcqN,KAAM,IAAK9L,WAAY,KAAvF,UACE,cAAC,IAAD,UAAOqT,EAAQpF,OACdoF,EAAQpF,MAAQ,cAACkF,GAAD,CAAU/T,KAAK,KAAK2F,QAASsO,EAAQnF,YAAa7L,KAAMgR,EAAQhR,UAEnF,cAAC,IAAD,CAAMjE,GAAI,CAAEK,eAAgB,WAAYqN,KAAM,EAAGpN,WAAY,UAA7D,SAA0E5F,OCVnEwa,GAAsB,CACjCrF,KAAM,gBACNC,YACE,uMAGSqF,GAAe,CAC1BtF,KAAM,MACNC,YACE,sHAGSsF,GAAuB,CAClCvF,KAAM,cACNC,YAAa,oEAGFuF,GAAe,CAC1BxF,KAAM,yBACNC,YACE,0HAGSwF,GAAyB,CACpCzF,KAAM,gBACNC,YACE,4UAGSyF,GAA+B,CAC1C1F,KAAM,yBACNC,YACE,kHAGS0F,GAAyB,CACpC3F,KAAM,gBACNC,YACE,kLAGS2F,GAAe,CAC1B5F,KAAM,OAGK6F,GAAgB,CAC3B7F,KAAM,QAGK8F,GAAgB,CAC3B9F,KAAM,QAGK+F,GAAkB,CAC7B/F,KAAM,SACNC,YAAa,oDAGF+F,GAAuB,CAClChG,KAAM,cACNC,YAAa,kDCxDTgG,GAAiB,EAAG3B,iBAAgBC,cAAaC,kBAAhC,CACrBF,iBACAC,cACAC,gBAGI0B,GAAqB,KACzB,MAAM,eAAE5B,EAAF,YAAkBC,EAAlB,YAA+BC,GAAgBE,8BAAmBuB,IAExE,OACE,eAAC,IAAD,CAAK9V,GAAI,CAAEuB,GAAI,GAAf,UACE,cAAC,IAAD,kCACA,cAACyT,GAAD,CAAWC,QAASe,GAApB,SAA4B7B,EAAeW,SAAS,KACpD,cAACE,GAAD,CAAWC,QAASe,GAApB,SAA6B5B,EAAYU,aACzC,cAACE,GAAD,CAAWC,QAASe,GAApB,SAA6B3B,EAAYS,iBAKzCmB,GAAgD,EAAGvb,eAC/C,OAARA,QAAQ,IAARA,OAAA,EAAAA,EAAUgI,MAAM,iBACd,cAAC,IAAD,CAAMoB,KAAO,yCAAwCpJ,IAArD,SAAkEA,EAASiV,OAAO,EAAG,KAErF,+CAQEuE,GAAS,EACbgC,iBACAC,QACAC,QACAC,sBACAC,gBACAC,iBACAC,kBACAC,eARa,CAUbP,iBACAC,QACAC,QACAC,sBACAC,gBACAC,iBACAC,kBACAE,aAAkC,eAApBD,EAASrc,OAA0Bqc,EAASC,aAAe,OAG9DC,GAA0C,EAAG7V,UAAU,OAAQ8V,mBAC1E,MACEla,SACErB,YAAc7D,QAASqf,EAAX,eAA6BC,EAA7B,YAA6C1d,KAEzD4D,KAEE,eACJkZ,EADI,MAEJC,EAFI,oBAGJE,EAHI,MAIJD,EAJI,cAKJE,EALI,gBAMJE,EANI,aAOJE,GACEnC,8BAAmBL,IAEjB6C,EACJX,EAAMY,KAAKC,SAAW,IAAIC,WAAQb,EAAoBc,IAAIf,EAAMY,OAC5DI,EAA0B,IAAIF,WAAQd,EAAMiB,gBAAgBlB,IAC5DmB,EAAkB,IAAIJ,WAAQZ,GAC9BiB,EAAkBne,IAAgBC,IAAc,MAA9B,OAAsCqd,QAAtC,IAAsCA,OAAtC,EAAsCA,EAAcc,IAAI,KAAK1C,WAErF,OACE,eAAC,IAAD,CAAYhU,UAAZ,UACG8V,GAAgB,cAACb,GAAD,IAEjB,cAAC,IAAD,iCAEA,cAAC,IAAD,CAASrV,GAAG,KAAKV,GAAI,CAAEsE,GAAI,EAAG1C,WAAY,QAA1C,sBAIA,cAACoT,GAAD,CAAWC,QAASe,GAApB,SAAmCsB,EAAgBG,SAAS,KAE5D,eAACzC,GAAD,CAAWC,QAASe,GAApB,UACGI,EAAMsB,WAAWC,UADpB,IAC+B,cAAC,IAAD,CAAM3X,GAAI,CAAEY,SAAU,GAAtB,qBAC7B,eAAC,IAAD,CAAMZ,GAAI,CAAEY,SAAU,GAAtB,mBACW3K,WAAQC,KAAKkgB,EAAMsB,WAAWF,IAAIrB,IAAQwB,UADrD,UAIF,cAAC3C,GAAD,CAAWC,QAASe,GAApB,SAA+B/f,WAAQC,KAAKggB,GAAgBpB,SAAS,KACrE,cAACE,GAAD,CAAWC,QAASe,GAApB,SAAoCI,EAAMY,KAAKW,YAC9CZ,GACC,eAAC/B,GAAD,CAAWC,QAASe,GAApB,UACGK,EAAoBsB,UACrB,eAAC,IAAD,CAAM3X,GAAI,CAAEY,SAAU,GAAtB,kBAAmCmW,EAAuBU,SAAS,GAAnE,UAGJ,cAACzC,GAAD,CAAWC,QAASe,GAApB,SAAoCQ,EAAgBmB,YACpD,cAAC3C,GAAD,CAAWC,QAASe,GAApB,SAA4BoB,EAAwBtC,aACpD,cAACE,GAAD,CAAWC,QAASe,GAApB,SACGI,EAAMwB,+BAA+BzB,GAAS,cAAC,IAAD,CAAKzW,MAAM,SAAX,iBAAgC,OAIjF,cAAC,IAAD,CAASgB,GAAG,KAAKV,GAAI,CAAEsE,GAAI,EAAG1C,WAAY,QAA1C,sBAGC2V,GAAmB,eAACvC,GAAD,CAAWC,QAASe,GAApB,UAAsCuB,EAAtC,OAEpB,eAAC,IAAD,CAAKvX,GAAI,CAAEsE,GAAI,EAAG+F,QAAS,KAA3B,UACE,eAAC,IAAD,CAAKrK,GAAI,CAAEY,SAAU,GAArB,gCACqB,cAACqV,GAAD,UAAeY,OAEpC,eAAC,IAAD,CAAK7W,GAAI,CAAEY,SAAU,GAArB,uBAAqCkW,EAAee,oBACpD,eAAC,IAAD,CAAK7X,GAAI,CAAEY,SAAU,GAArB,8BACoB,IAIhB,cAACqV,GAAD,UAAe6B,uDC3H3B,IAAM5D,GAAS,SAAC,GAAD,MAA0C,CAAEkC,MAA5C,EAAGA,MAAgDD,MAAnD,EAAUA,QAEZ4B,GAA6B,WAAO,IAAD,EACrBxD,8BAAmBL,IAApCiC,EADsC,EACtCA,MAAOC,EAD+B,EAC/BA,MAD+B,EAGAjb,oBAAS,GAHT,mBAGvC6c,EAHuC,KAGtBC,EAHsB,KAIxCC,EAAwBC,iBAAuB,MAErD,OACE,qCACE,eAAC,IAAD,CACEpX,QAAS,kBAAMkX,GAAoBD,IACnClX,QAAQ,OACRd,GAAI,CACF2F,SAAU,WACVqE,QAAS,CAAC,QAAS,SALvB,UAQE,cAAC,EAAD,CAAM/N,KAAK,cAAc+E,KAAK,OAE7BoV,EAAMwB,+BAA+BzB,IACpC,cAAC,IAAD,CACEnW,GAAI,CACF2F,SAAU,WACVsH,MAAO,EACP3B,IAAK,EACL9J,MAAO,OACPrB,OAAQ,OAERG,WAAY,aACZD,eAAgB,WAChB+X,GAAI,MAEJ1Y,MAAO,UAZX,SAeE,cAAC,EAAD,CAAMzD,KAAK,qBAAqB+E,KAAK,YAK1CgX,GACC,cAAC,IAAD,CACElX,QAAQ,cACRuX,IAAKH,EACLnX,QAAS,SAAAuX,GACHA,EAAEvU,SAAWmU,EAAsBK,SACrCN,GAAmB,IALzB,SASE,cAACtB,GAAD,CAAa7V,QAAQ,YAAY8V,cAAY,UCrD1C4B,GAA0C,SAAC,GAAD,IAAGrY,EAAH,EAAGA,OAAWsY,EAAd,iCACrD,cAAC,IAAD,yBAAKzY,GAAI,CAAE6D,WAAY,IAAS4U,GAAhC,aACE,cAAC,IAAD,CAAOC,IAAI,kBAAkB1Y,GAAI,CAAEG,gBCJjCwY,GAAqC,SAAAC,GACzC,OAAO,cAAC,KAAD,aAAYC,OAAK,GAAKD,KAGlBE,GAAgC,SAAAF,GAC3C,OAAO,cAAC,IAAD,2BAAoBA,GAApB,IAA2BlY,GAAIiY,OCPlCI,GAAoB,WAExB,OAD6B,IAAIC,KAAS,IAAIA,KAAK,cAGjD,cAAC,IAAD,CAAOpV,GAAI,EAAG5D,GAAI,CAAEY,SAAU,QAA9B,iBAFgC,MAQvBqY,GAAgB,WAC3B,OACE,eAAC,IAAD,CAAKvY,GAAG,MAAMV,GAAI,CAAEgK,QAAS,CAAC,OAAQ,QAAS1J,WAAY,SAAUoN,KAAM,GAA3E,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CAAMlX,GAAG,IAAT,uBACA,cAAC,GAAD,CAAMA,GAAG,SAAT,SACE,eAAC,IAAD,CAAMwJ,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,IAAD,oBACA,cAAC,GAAD,YAIN,cAAC,IAAD,CAAMN,GAAI,CAAEK,eAAgB,WAAYiB,GAAI,EAAGoM,KAAM,GAArD,SACE,cAAC,GAAD,CAAM1N,GAAI,CAAEY,SAAU,GAAKpK,GAAG,gBAA9B,gCClBK0iB,GAAoB,WAAO,IAAD,EACH/d,oBAAS,GADN,mBAC9Bge,EAD8B,KACnBC,EADmB,KAE/BC,EAAUlB,iBAAuB,MAEvC,OAAKgB,EAQH,cAAC,IAAD,CACErY,QAAQ,cACRuX,IAAKgB,EACLtY,QAAS,SAAAuX,GACHA,EAAEvU,SAAWsV,EAAQd,SACvBa,GAAa,IALnB,SASE,eAAC,IAAD,CAAMtY,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEd,GAAI,CAAE2F,SAAU,QAASsH,MAAO,OAAQ2B,EAAG,GAC3C9N,QAAQ,OACRC,QAAS,kBAAMqY,GAAa,IAH9B,SAKE,cAAC,EAAD,CAAMnd,KAAK,QAAQ+E,KAAK,SAE1B,cAAC,GAAD,CAAab,OA/BF,OA+BsBF,EAAG,IACpC,eAAC,IAAD,CAAKS,GAAG,MAAMV,GAAI,CAAE4O,EAAG,EAAGtK,GAAI,EAAGrE,EAAG,GAAKc,QAAS,kBAAMqY,GAAa,IAArE,UACE,cAAC,GAAD,CAAM5iB,GAAG,IAAT,uBACA,cAAC,GAAD,CAAMA,GAAG,SAAT,mBACA,cAAC,GAAD,CAAMA,GAAG,gBAAT,kCA3BJ,cAAC,IAAD,CAAQwJ,GAAI,CAAEgK,QAAS,CAAC,OAAQ,SAAWlJ,QAAQ,OAAOC,QAAS,kBAAMqY,GAAa,IAAtF,SACE,cAAC,EAAD,CAAMnd,KAAK,OAAO+E,KAAK,UCFzBkT,GAAS,SAAC,GAAD,MAAsC,CACnDuC,SADa,EAAGA,WAIL6C,GAAmB,SAAC,GAAkB,IAAhB5e,EAAe,EAAfA,SAErBtB,EACR4D,IADFtD,OAAUN,YAEJqd,EAAalC,8BAAmBL,IAAhCuC,SACF8C,EAAuBngB,IAAgBC,KAAmC,eAApBod,EAASrc,OAErE,OACE,eAAC,IAAD,CAAW0G,QAAQ,SAAnB,UACE,eAAC,IAAD,CAAMd,GAAI,CAAEM,WAAY,SAAUoN,KAAM,GAAxC,UACE,cAAC,GAAD,CAAavN,OAhBF,SAkBX,cAAC,IAAD,CACEH,GAAI,CACFmO,GAAI,CAAC,EAAG,GACR3M,MAAO,MACPrB,OAAQ,OACRqZ,WAAY,CAAC,OAAQ,0BAGxBD,GACC,qCACE,cAAC,GAAD,IACA,cAAC,GAAD,UAKL7e,MCzCM+e,GAA8B,SAAC,GAAD,IAAG/e,EAAH,EAAGA,SAAH,OACzC,cAAC,IAAD,CACEsF,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEHmK,OAAQ,EACRlK,aAAc,MACdM,YAAa,SACbsK,UAAW,EACX1K,GAAI,4BAbR,SAgBE,eAAC,IAAD,CAAMJ,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMrE,KAAK,cAAc+E,KAAK,OAC9B,cAAC,IAAD,CAAMhB,GAAI,CAAE4D,GAAI,GAAhB,SAAsBlJ,UAKfgf,GAAmB,SAAC,GAAD,IAAGhf,EAAH,EAAGA,SAAH,OAC9B,cAAC,IAAD,CAAMsF,GAAI,CAAE4B,WAAY,OAAQ+X,WAAY,UAA5C,SAAyDjf,KCjBpD,MAAMkf,GAA0B,EAAG5Z,KAAIqN,QAAOwM,UAASC,WAAUpf,WAAUqf,cAE9E,eAAC,IAAD,CAAM/Z,GAAI,CAAEM,WAAY,UAAWqF,SAAU,WAAYnE,MAAO,UAAWxB,GAA3E,UACE,cAAC,IAAD,CACEtK,GAAImkB,EACJG,QAASF,EACT9Z,GAAI,CACFC,EAAG,EACHyF,GAAI,EACJ0S,GAAI,OACJzS,SAAU,WACV/E,SAAU,EACVwJ,OAAQ,EACR5J,YAAa,eAVjB,SAaE,eAAC,IAAD,CAAMR,GAAI,CAAEM,WAAY,UAAxB,UACG+M,EACA0M,GAAYA,OAGhBrf,KASDuf,GAAuD,EAAGja,KAAIvJ,WAClE,eAAC,IAAD,CAAYuJ,KAAZ,cAEa,OAAVvJ,EACC,cAAC,EAAD,CAAMwF,KAAK,oBACC,OAAVxF,EACF,cAAC,EAAD,CAAMwF,KAAK,uBACJ,OAALxF,QAAK,IAALA,OAAA,EAAAA,EAAOyjB,WAAW,MACpB,qCACE,cAAC,EAAD,CAAMje,KAAK,aADb,IAC4BxF,EAAMkZ,OAAO,OAElC,OAALlZ,QAAK,IAALA,OAAA,EAAAA,EAAOyjB,WAAW,MACpB,qCACE,cAAC,EAAD,CAAMje,KAAK,eADb,IAC8BxF,EAAMkZ,OAAO,MAG3ClZ,EAfJ,OAgCW0jB,GAAuD,EAClEna,KACAoa,UACAC,aACAC,SACA9M,OACA9N,QACA6a,gBACAC,eACAzZ,UACArG,cAGE,eAAC,IAAD,CACEhF,GAAI0kB,EACJK,kBAAiBJ,EACXtZ,UACNf,GAAI,CACFK,eAAgB,gBAChBC,WAAY,YAERS,EAAU,CAAEkJ,OAAQ,QAAW,MAEhCyQ,MACA1a,GAXP,UAcGsa,GACC,eAAC,IAAD,CAAMta,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,IAAD,CAAMN,GAAI,CAAEN,QAAOkC,WAAY,UAA/B,SAA4C0Y,IAE3C9M,GACC,4CAEE,cAAC,IAAD,CAAMxN,GAAI,CAAE4B,WAAY,QAASyI,QAAS,IAA1C,SAAkDmD,OAIrD+M,GACC,4CAEE,cAACN,GAAD,CACEja,GAAI,CAAEN,MAAO8a,EAAcnQ,QAAS,GAAKzJ,SAAU,WACnDnK,MAAO8jB,UAOhB7f,KAKDggB,GAAoC,CACxCC,SAAU,EAEVpZ,GAAI,EACJmE,GAAI,EACJqH,GAAI,OACJtM,GAAI,EACJ2X,GAAI,OAEJxX,SAAU,EAEVwJ,OAAQ,EACR5J,YAAa,eAGToa,GAAsC,CAC1CD,SAAU,EAEVpZ,GAAI,CAAC,EAAG,GACRmE,GAAI,EACJqH,GAAI,OACJtM,GAAI,EACJ2X,GAAI,OAEJxX,SAAU,EAEVkK,UAAW,CAAC,EAAG,GACfV,OAAQ,EACR5J,YAAa,SAKFqa,GAAsC,EACjDxN,QACAwM,UACAC,WACAC,WACAO,SACA5f,cACGke,KAEH,cAACgB,GAAD,CACEvM,MAAOA,EACPwM,QAASA,EACTC,SAAUA,EACVC,SAAUA,EACV/Z,GAAI,CAAEsE,GAAI,EAAE,GAAI,GAAI7D,GAAI,CAAC,EAAG,IAL9B,SAOG6Z,EACC,cAACH,GAAD,CAAeG,OAAQA,KAAY1B,EAAnC,SACGle,IAGHA,IASOogB,GAAiE,EAC5EV,UACA1f,WACAsF,QACG4Y,KAEH,cAACuB,GAAD,CACEna,GAAI,IAAK4a,GAAe9P,UAAW,KAAM9K,GACzCqa,WAAa,GAAED,UACfA,QAASA,KACLxB,EAJN,SAMGle,IAIQqgB,GAA0D,EACrEX,UACA/M,QACAiN,SACA5f,cACGke,KAEH,cAACgB,GAAD,CAAKC,QAAU,GAAEO,UAAiB/M,MAAOA,EAAzC,SACGiN,EACC,cAACQ,GAAD,CAAyBV,QAASA,EAASE,OAAQA,KAAY1B,EAA/D,SACGle,IAGHA,IAaOsgB,GAA0C,EACrD3N,QACA+M,UACA5M,OACA8M,SACA5a,QACA6a,gBACAC,eACAS,eACAC,eACAC,kBACAC,YACAC,eAEA,MAAOC,EAASC,GAAcN,GACvBvR,EAAS8R,GAAcrgB,oBAAS,GAEvC,OAAOmgB,IAAYlB,EACjB,cAACR,GAAD,CAAWvM,QAAOyM,SAAUM,EAAS5M,OAArC,SACE,cAAC,IAAD,CACEiO,WAAS,EACT/lB,GAAI0kB,EACJ5X,KAAK,SACLkZ,KAAK,MACLC,aAAcT,EACRxR,UACNkS,SAAUtD,IACR,IACE6C,EAAgB7C,EAAEvU,OAAOtN,OACzB+kB,GAAW,GACX,MACAA,GAAW,KAGfK,OAAQ,KACNN,OAAWtjB,GACXujB,GAAW,IAEb1a,QAAQ,SACRd,GAAI,IACC4a,GACHhZ,WAAY,SACZxB,GAAIsJ,EAAU,UAAY,kBAKhC,cAACkQ,GAAD,CAAKC,QAAU,GAAEO,UAAuB/M,QAAOG,OAA/C,SACE,cAAC2M,GAAD,CACEna,GAAI,IACC4a,GACHxa,GAAIsJ,EAAU,UAAY,cAE5B2Q,WAAa,GAAED,UACfrZ,QAAS,IAAMwa,EAAWnB,GACpBA,UAASE,SAAQ9M,OAAM9N,QAAO6a,gBAAeC,eAAc9Q,UAPnE,SASG0R,GACC,cAAC,IAAD,CACEpb,GAAI,CAAEY,SAAU,EAAGX,EAAG,EAAGY,GAAI,GAC7BE,QAAS+a,IACPX,EAAgBC,GAChBU,EAAMC,mBAERpU,SAAU0T,EANZ,sBClSH,IAAMW,GAA2B,kBACtC,cAAC,IAAD,CACElb,QAAQ,kBACRd,GAAI,CAAEC,EAAG,OAAQ+J,QAAS,OAAQ3J,eAAgB,YAFpD,SAIE,cAAC,IAAD,CAASW,KAAK,OAAOhB,GAAI,CAAEN,MAAO,aCQzBuc,GAAkD,SAAC,GAAuB,IAAD,UAApBxlB,EAAoB,EAApBA,MAAOylB,EAAa,EAAbA,OACjEC,EAAqB,IAAIjF,WAAJ,OAAYzgB,QAAZ,IAAYA,IAAS,CAAEghB,SAAU,iBAAM,SAC5D2E,EAAYF,GAAU,IAAIhF,WAAQgF,GACxC,OACE,qCACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAKlc,GAAI,CAAEsE,GAAI,CAAC,EAAG,GAAIV,GAAI,EAAGtC,IAAK,EAAGV,SAAU,QAAhD,SACE,cAAC,EAAD,CAAM3E,KAAK,gBAGb,cAAC4e,GAAD,CACExN,MAAM,mBACN+M,QAAQ,yBACRE,OAAQ6B,EAAmBrH,WAC3BpV,OACO,OAALjJ,QAAK,IAALA,OAAA,EAAAA,EAAO4lB,GAAGC,+BACN,WACK,OAAL7lB,QAAK,IAALA,OAAA,EAAAA,EAAO4lB,GAAG,MACV,WACK,OAAL5lB,QAAK,IAALA,OAAA,EAAAA,EAAO8lB,IAAI,MACX,SACA,QAENhC,eACQ,OAAN2B,QAAM,IAANA,GAAA,UAAAA,EAAQM,gBAAR,mBAAkBC,qBAAlB,eAAiCJ,GAAG,KAChC,MACM,OAANH,QAAM,IAANA,GAAA,UAAAA,EAAQQ,gBAAR,mBAAkBD,qBAAlB,eAAiCJ,GAAG,KACpC,KADA,OAEAD,QAFA,IAEAA,GAFA,UAEAA,EAAWO,WAAW,UAFtB,aAEA,EAA0B7H,WAEhC0F,cAAoB,OAAN0B,QAAM,IAANA,OAAA,EAAAA,EAAQM,UAAW,UAAY,SAC7CzC,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,gXAYJ,OAAL/K,QAAK,IAALA,OAAA,EAAAA,EAAOmmB,GAAG,OACT,cAAC,GAAD,6FC/BF1I,GAAS,SAAC,GAAD,MAAmC,CAAEiC,MAArC,EAAGA,QAEL0G,GAA0C,SAAC,GAOjD,IANLniB,EAMI,EANJA,SACAoiB,EAKI,EALJA,SACAC,EAII,EAJJA,OACAC,EAGI,EAHJA,IACA1G,EAEI,EAFJA,cACA2G,EACI,EADJA,cAEQ9G,EAAU5B,8BAAmBL,IAA7BiC,MAEF+G,EAAS,IAAIhG,WAAQZ,GAErB6G,EAA2BL,EAASM,aAA4CnlB,EAAlC6kB,EAASzF,gBAAgBlB,GACvEkB,EAAmB0F,EAAOK,aAA0CnlB,EAAhC8kB,EAAO1F,gBAAgBlB,GAC3DkH,EAAwBC,cAAWC,QAAQlG,EAAiB8F,GAElE,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBAEA,eAAC,IAAD,CAAKnd,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC4a,GAAD,CACExN,MAAM,aACN+M,QAAQ,mBACRE,OAAQyC,EAAOrF,WAAW5C,SAAS,GACnCtH,KAAK,QAGP,cAACqN,GAAD,CAAWxN,MAAM,OAAO+M,QAAQ,aAAaE,OAAQyC,EAAO/F,KAAKlC,WAAYtH,KAAMgC,KAElFsN,EAASM,SACR,cAACvC,GAAD,CACExN,MAAM,sBACN+M,QAAQ,4BACRE,OAAM,UAAKkD,6BACXhQ,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAWV,cAACqZ,GAAD,CACExN,MAAM,gBACN+M,QAAQ,sBACRE,OAAQ0C,EAAIvF,SAAS,GACrB8C,cAAe2C,EAAOzF,SAAS,GAC/BjK,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAAC,GAAD,CAAiB/K,MAAO4gB,EAAiB6E,OAAQmB,IAEhD3iB,KAGFuiB,GAAiB,cAAC,GAAD,QC7FXQ,GAA0C,SAAC,GAMjD,IALL/iB,EAKI,EALJA,SACAgjB,EAII,EAJJA,cACAxB,EAGI,EAHJA,OACAyB,EAEI,EAFJA,iBACAC,EACI,EADJA,kCAEQlhB,EAAYM,IAAZN,QADJ,EAGsB2J,GACxBqX,EACgB,aAAhBxB,EAAO1Z,KACH9F,EAAQnG,KAAKsnB,UAAUC,KAAKphB,EAAQnG,KAAM2lB,EAAOplB,OAAQ,CACvD6mB,mBACAC,sCAEc,YAAhB1B,EAAO1Z,KACP9F,EAAQnG,KAAKwnB,WAAWD,KAAKphB,EAAQnG,MACrCmG,EAAQnG,KAAKynB,YAAYF,KAAKphB,EAAQnG,KAAM2lB,EAAOplB,OAAQ,CACzD6mB,mBACAC,uCAXD7W,EAHH,oBAkBJ,OAAO,cAAC,IAAD,CAAQhG,QAASgG,EAAjB,SAAmCrM,KC9B/BujB,GAAmB1jB,wBAA2C,MAE9D2jB,GAAe,WAC1B,IAAMvL,EAAuCzV,qBAAW+gB,IAExD,GAAgB,OAAZtL,EACF,MAAM,IAAIrc,MAAM,0DAGlB,OAAOqc,GCbIwL,GAA6B,SAAC,GAAD,IAAGzjB,EAAH,EAAGA,SAAH,OACxC,cAAC,IAAD,CACEsF,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEHmK,OAAQ,EACRlK,aAAc,MACdM,YAAa,SACbsK,UAAW,EACX1K,GAAI,2BAbR,SAgBE,eAAC,IAAD,CAAMJ,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMrE,KAAK,uBAAuB+E,KAAK,OACvC,cAAC,IAAD,CAAMhB,GAAI,CAAE4D,GAAI,GAAhB,SAAsBlJ,UCHtB0jB,GAAa,IAAIlH,WAAQmH,6BAA0B5G,SAAS,GAC5D6G,GAAa,IAAIpH,WAAQoF,8BAA2B7E,SAAS,GAM7D8G,GAAqE,SAAC,GAAD,IAAGznB,EAAH,EAAGA,OAAH,OACzE,eAAC,GAAD,WACGA,EAAO0nB,mBAAqB1nB,EAAO2nB,WAClC,yDACmB,eAAC,GAAD,WAAS3nB,EAAO0nB,kBAAkB1J,WAAlC,UADnB,eAC0F,IACxF,eAAC,GAAD,WACGhe,EAAO2nB,WAAW3J,WADrB,IACkCtF,SAGlC1Y,EAAO4nB,WAAa5nB,EAAO6nB,mBAC7B,oDACe,IACb,eAAC,GAAD,WACG7nB,EAAO4nB,UAAU5J,WADpB,IACiCtF,MACvB,IAJZ,eAKc,eAAC,GAAD,WAAS1Y,EAAO6nB,mBAAmB7J,WAAnC,aAEZhe,EAAO0nB,mBAAqB1nB,EAAO4nB,UACrC,yDACmB,eAAC,GAAD,WAAS5nB,EAAO0nB,kBAAkB1J,WAAlC,UADnB,WACsF,IACpF,eAAC,GAAD,WACGhe,EAAO4nB,UAAU5J,WADpB,IACiCtF,SAGjC1Y,EAAO2nB,YAAc3nB,EAAO6nB,mBAC9B,yDACmB,eAAC,GAAD,WAAS7nB,EAAO6nB,mBAAmB7J,WAAnC,UADnB,OACmF,IACjF,eAAC,GAAD,WACGhe,EAAO2nB,WAAW3J,WADrB,IACkCtF,SAGlC1Y,EAAO0nB,kBACT,yDACmB,eAAC,GAAD,WAAS1nB,EAAO0nB,kBAAkB1J,WAAlC,aAEjBhe,EAAO6nB,mBACT,yDACmB,eAAC,GAAD,WAAS7nB,EAAO6nB,mBAAmB7J,WAAnC,aAEjBhe,EAAO2nB,WACT,wDACmB,IACjB,eAAC,GAAD,WACG3nB,EAAO2nB,WAAW3J,WADrB,IACkCtF,SAIpC,oDACe,IACb,eAAC,GAAD,WACG1Y,EAAO4nB,UAAU5J,WADpB,IACiCtF,SAjDvC,QAyDWoP,GAAiC,SAAC,GAAD,MAMpB,CAAEzI,MANkB,EAC5CA,MAKiCC,MANW,EAE5CA,MAIwCjC,eANI,EAG5CA,eAGwDC,YANZ,EAI5CA,YAEqE8B,eANzB,EAK5CA,iBAYW2I,GAAsB,SACjCC,EACAC,EACAzI,EACA0I,GAII,IACI5I,EAAiB4I,EAAjB5I,MAAOD,EAAU6I,EAAV7I,MACT+F,EAAS4C,EAAcG,YAAYF,EAAezI,GAExD,IAAK4F,EACH,MAAO,MAACjkB,OAAWA,GAKrB,IAAMinB,EAAiBJ,EAAcK,MAAMjD,EAAQ5F,GAC7C8I,EAAehJ,EAAMwB,+BAA+BzB,GACpDkJ,EAA2BjJ,EAC9BkJ,SAASR,GACTzhB,IAAI6hB,GACJtH,+BAA+BzB,GAE5BxD,EAAqC,2BACtCqM,GADsC,IAEzCF,gBACAI,iBACAE,eACAC,6BAGF,GAAoB,oBAAhBnD,EAAO1Z,KAET,MAAO,MACLvK,EACA,eAAC,GAAD,yCAC8B,IAC5B,eAAC,GAAD,WACGsnB,qBAAkB9H,WADrB,IACkCjI,MAHpC,QAUJ,IAAMgQ,EACY,aAAhBtD,EAAO1Z,KACHid,GAAsBvD,EAAOplB,OAAQ6b,GACrB,YAAhBuJ,EAAO1Z,KACPkd,GAAqBxD,EAAOplB,OAAQ6b,GACpCgN,GAAwBzD,EAAOplB,OAAQ6b,GAE7C,OAAI6M,EACK,MAACvnB,EAAWunB,GAGd,CAACtD,EAAQ,cAAC,GAAD,CAAwBplB,OAAQolB,EAAOplB,WAGnD2oB,GAAwB,SAAC,EAAD,GASJ,IARtBjB,EAQqB,EARrBA,kBAAmBC,EAQE,EARFA,WAEnBS,EAMqB,EANrBA,eACAE,EAKqB,EALrBA,aACAC,EAIqB,EAJrBA,yBACAlL,EAGqB,EAHrBA,eACAgC,EAEqB,EAFrBA,MAGF,GAAIsI,EAAW7B,GAAGgD,0BAChB,OACE,eAAC,GAAD,sCAC2B,IACzB,eAAC,GAAD,WACGA,yBAAsBnI,WADzB,IACsCjI,MAHxC,OAUJ,GAAI4P,GACF,IAAKF,EAAeW,yBAAyB1J,GAC3C,OACE,eAAC,GAAD,gEACoD,cAAC,GAAD,UAASmI,KAD7D,gGAMC,CACL,GAAIY,EAAeY,8BAA8B3J,GAC/C,OACE,eAAC,GAAD,gDACoC,cAAC,GAAD,UAASiI,KAD7C,OAMJ,GAAIiB,EACF,OACE,eAAC,GAAD,2GAEQ,cAAC,GAAD,UAASf,KAFjB,sDAQN,OAAIE,EAAkBnC,GAAGlI,GAErB,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WAASqK,EAAkBuB,IAAI5L,GAAgBW,WAA/C,UAFF,OAOG,MAGH6K,GAA0B,SAAC,EAAD,GAWN,IAVtBnB,EAUqB,EAVrBA,kBAAmBG,EAUE,EAVFA,mBAAoBF,EAUlB,EAVkBA,WAAYC,EAU9B,EAV8BA,UAEnDI,EAQqB,EARrBA,cACAI,EAOqB,EAPrBA,eACAE,EAMqB,EANrBA,aACAC,EAKqB,EALrBA,yBACAlJ,EAIqB,EAJrBA,MACAhC,EAGqB,EAHrBA,eACAC,EAEqB,EAFrBA,YAGF,GAAIgL,EAAc,CAChB,GAAIT,EACF,OACE,cAAC,GAAD,8EAMJ,GAAIF,EAAY,CACd,GAAIS,EAAetH,+BAA+BzB,GAChD,OACE,eAAC,GAAD,qDACyC,cAAC,GAAD,UAASmI,KADlD,4EAOJ,GAAIY,EAAe7H,gBAAgBlB,GAAOyG,GAAGkC,EAAczH,gBAAgBlB,IACzE,OACE,cAAC,GAAD,8FAMD,CACL,GAAI+I,EAAeY,8BAA8B3J,GAC/C,OACE,eAAC,GAAD,gDACoC,cAAC,GAAD,UAASiI,KAD7C,OAMJ,GAAIiB,EACF,OACE,eAAC,GAAD,uGAC4F,IAC1F,cAAC,GAAD,UAASf,KAFX,sDAQN,GAAII,EAAW,CACb,GAAIQ,EAAelI,KAAK4F,GAAG2C,sBACzB,OACE,eAAC,GAAD,yCAC8B,IAC5B,eAAC,GAAD,WACGA,qBAAkB9H,WADrB,IACkCjI,MAHpC,OAUJ,GAAIkP,EAAUrC,GAAGjI,GACf,OACE,eAAC,GAAD,uEAC4D,IAC1D,eAAC,GAAD,WACGsK,EAAUqB,IAAI3L,GAAaU,WAD9B,IAC2CtF,MAH7C,OAWN,cAAIgP,QAAJ,IAAIA,OAAJ,EAAIA,EAAmBnC,GAAGlI,IAEtB,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WAASqK,EAAkBuB,IAAI5L,GAAgBW,WAA/C,UAFF,OAOG,MAGH4K,GAAuB,SAAC,EAAD,GAQH,IAPtBhB,EAOqB,EAPrBA,UAEAU,EAKqB,EALrBA,aACAC,EAIqB,EAJrBA,yBACAnJ,EAGqB,EAHrBA,eACA9B,EAEqB,EAFrBA,YAGF,OAAuB,IAAnB8B,EAEA,cAAC,GAAD,mGAMAkJ,EAEA,cAAC,GAAD,4EAMJ,OAAIV,QAAJ,IAAIA,OAAJ,EAAIA,EAAWrC,GAAGjI,IAEd,eAAC,GAAD,sBACW,IACT,eAAC,GAAD,WACGsK,EAAUqB,IAAI3L,GAAaU,WAD9B,IAC2CtF,MACjC,IAJZ,+BAUA6P,EAEA,eAAC,GAAD,oHAEa,cAAC,GAAD,UAASf,KAFtB,+DAQG,MC7VH0B,GAAO,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAH,MAAmC,CAC9CnD,SAAUmD,EACVlD,OAAQ,IAAImD,SAAMD,EAAMvI,WAAYuI,EAAMjJ,MAC1CiG,eAAe,EACfkD,WAAW,EACXC,kBAAkB,IASdC,GAAa,SAAC9d,GAAD,OAAgC,SAACD,GAAD,OACjDge,GAAOhe,EAAOC,KAEVge,GAAiBF,GAAW,CAAE7d,KAAM,mBACpCge,GAAoBH,GAAW,CAAE7d,KAAM,sBACvCie,GAAeJ,GAAW,CAAE7d,KAAM,iBAClCke,GAASL,GAAW,CAAE7d,KAAM,WAE5B8d,GAAS,SAAChe,EAA0BC,GAAkD,IAIlFua,EAAiExa,EAAjEwa,SAAUC,EAAuDza,EAAvDya,OAAQE,EAA+C3a,EAA/C2a,cAAekD,EAAgC7d,EAAhC6d,UAAWC,EAAqB9d,EAArB8d,iBAEpD,OAAQ7d,EAAOC,MACb,IAAK,cAEH,OADA3I,QAAQC,IAAI,mBACL,2BAAKwI,GAAZ,IAAmB2a,eAAe,IAGpC,IAAK,eACH,OAAO,2BAAK3a,GAAZ,IAAmB2a,eAAe,IAEpC,IAAK,gBACH,IAAM0D,EAAgB1qB,WAAQC,KAAKqM,EAAOqe,UAEpCC,EAAQ,2BACTve,GADS,IAEZya,OAAQA,EAAO+D,cAAcH,KAG/B,IAAKR,EAAW,CACd,GAAIpD,EAAOK,SAAWuD,EAAc1J,QAClC,OAAOsJ,GAAeM,GAExB,GAAIT,GAAoBO,EAAcI,OACpC,OAAOP,GAAkBK,GAI7B,OAAOA,EAGT,IAAK,UACH,OAAO,2BACFve,GADL,IAEEya,OAAQA,EAAOiE,QAAQze,EAAOqe,UAC9BT,WAAW,IAGf,IAAK,iBACH,OAAO,2BACF7d,GADL,IAEEya,OAAQA,EAAOiE,QAAQzB,sBACvBa,kBAAkB,IAGtB,IAAK,oBACH,OAAO,2BACF9d,GADL,IAEEya,OAAQA,EAAOiE,QAAQ,GACvBZ,kBAAkB,IAGtB,IAAK,SACH,OAAO,2BACF9d,GADL,IAEEya,OAAQ,IAAImD,SAAMpD,EAASpF,WAAYoF,EAAS9F,MAChDmJ,WAAW,EACXC,kBAAkB,IAGtB,IAAK,cAAgB,IAELH,EAEV1d,EAFFse,SAAYZ,MAC8BgB,EACxC1e,EADF2e,YAAeC,0BAGXN,EAAQ,2BACTve,GADS,IAEZwa,SAAUmD,IAGZ,GAAIhD,GAAiBgE,EACnB,OAAOR,GAAaC,GAAOG,IAG7B,IAAM3E,EAASY,EAASmC,YAAYlC,EAAQ,GAE5C,MACoB,cAAX,OAANb,QAAM,IAANA,OAAA,EAAAA,EAAQ1Z,QAAwByd,EAAM7C,SACrB,aAAX,OAANlB,QAAM,IAANA,OAAA,EAAAA,EAAQ1Z,OAAsByd,EAAM7C,QAE9BsD,GAAOG,GAGT,2BAAKA,GAAZ,IAAsB9D,OAAQkD,EAAMd,MAAMjD,EAAQ,OAKlDkF,GAAU,SAACtE,EAAiBC,EAAezG,GAC/C,IAAM4F,EAASY,EAASmC,YAAYlC,EAAQzG,GAE5C,OAAI4F,GAA0B,oBAAhBA,EAAO1Z,MAA8B0Z,EAAOplB,OAAO2nB,WACxDvC,EAAOplB,OAAO2nB,WAAWjH,IAAIlB,GAE7BrgB,WAAQorB,MAIbnN,GAAS,SAAC5R,GAAD,MAA+B,CAC5Cgf,KAAMhf,EAAMgf,KACZC,kBAAmB3C,GAA+Btc,KAG9Ckf,GAAsB,SACtBC,GAAuB,IAAIC,OAAJ,WAAeF,KAO/BG,GAA4C,SAAC,GAA0B,IAAxBjK,EAAuB,EAAvBA,WAAYV,EAAW,EAAXA,KAAW,EACzB4K,6BAAkBtB,GAAQN,IADD,0BACxElD,EADwE,EACxEA,SAAUC,EAD8D,EAC9DA,OAAQE,EADsD,EACtDA,cAAiBzZ,EADqC,OAE7C+Q,8BAAmBL,IAA/CoN,EAFyE,EAEzEA,KAAMC,EAFmE,EAEnEA,kBAEd5lB,qBAAU,gBACW1D,IAAfyf,GACFlU,EAAS,CAAEhB,KAAM,gBAAiBoe,SAAUlJ,SAEjCzf,IAAT+e,GACFxT,EAAS,CAAEhB,KAAM,UAAWoe,SAAU5J,MAEvC,CAACU,EAAYV,EAAMxT,IAEtB,IAAM8S,EAAgBgL,EAAKhL,gBACrBqH,EAAmBrH,EAAcjZ,IAAI,MAdsC,EAgB9CwhB,GACjC/B,EACAC,EACAzG,EACAiL,GApB+E,mBAgB1EM,EAhB0E,KAgB7D/R,EAhB6D,KAuBzEgS,EAAkB5D,KAAlB4D,cAEFC,EAAexb,uBAAY,WAC/Bub,EAAc,iCACb,CAACA,IAEEE,EAAkBlF,EAASM,QAE3B6E,EAAqB9b,GAAsBsb,IAmBjD,OAjBA9lB,qBAAU,WAEsB,uBAA5BsmB,EAAmBzf,MACS,2BAA5Byf,EAAmBzf,KAEnBgB,EAAS,CAAEhB,KAAM,gBACoB,WAA5Byf,EAAmBzf,MAAiD,cAA5Byf,EAAmBzf,KACpEgB,EAAS,CAAEhB,KAAM,iBACoB,qBAA5Byf,EAAmBzf,OACxByf,EAAmBvsB,KAAnB,UAA6B8rB,GAA7B,WACFM,EAAc,gBAEdA,EAAc,qBAGjB,CAACG,EAAoBze,EAAUse,IAGhC,eAAC,GAAD,CACEhF,SAAUA,EACVC,OAAQA,EACRC,IAAKoE,GAAQtE,EAAUC,EAAQzG,GAC/BA,cAAeA,EACf2G,cAAeA,EACfzZ,SAAUA,EANZ,iBAQGsM,QARH,IAQGA,IACEkS,EACC,cAAC,GAAD,uFAIA,cAAC,GAAD,4EAKJ,eAAC,IAAD,CAAMlhB,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASghB,EAAlC,oBAICF,EACC,cAAC,GAAD,CACEnE,cAAa,UAAK8D,IAAL,OAA2BK,EAAYrf,MACpD0Z,OAAQ2F,EACRlE,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQjW,UAAQ,EAAhB,4BCxOJuM,GAAS,SAAC,GAAD,MAA0C,CAAE+L,MAA5C,EAAGA,MAAgD9J,MAAnD,EAAUA,QAEZ+L,GAA0B,WAAO,IACpCJ,EAAkB5D,KAAlB4D,cACFK,EAAoB5b,uBAAY,WACpCub,EAAc,0BACb,CAACA,IACEM,EAAmB7b,uBAAY,WACnCub,EAAc,yBACb,CAACA,IAPuC,EASlBvN,8BAAmBL,IAApC+L,EATmC,EASnCA,MAAO9J,EAT4B,EAS5BA,MAGf,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAKnW,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,IAAD,WACE,cAAC8a,GAAD,CACE1N,MAAM,aACN+M,QAAQ,mBACRE,OAAQ2F,EAAMvI,WAAW5C,SAAS,GAClCtH,KAAK,QAGP,cAACuN,GAAD,CACE1N,MAAM,OACN+M,QAAQ,aACRE,OAAQ2F,EAAMjJ,KAAKlC,WACnBtH,KAAMgC,KAGR,cAAC,GAAD,CAAiB/Y,MAAOwpB,EAAM5I,gBAAgBlB,QAGhD,eAAC,IAAD,CAAMrV,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,UAAUC,QAASqhB,EAAnC,yBAGA,eAAC,IAAD,CAAQrhB,QAASohB,EAAjB,UACE,cAAC,EAAD,CAAMlmB,KAAK,MAAM+E,KAAK,OADxB,0BCzCGqhB,GAA0C,SAAC,GAAD,IAAGxiB,EAAH,EAAGA,MAAOnF,EAAV,EAAUA,SAAU6E,EAApB,EAAoBA,KAApB,OACrD,eAAC,IAAD,CAAKS,GAAI,CAAEmO,GAAI,EAAG5M,GAAI,GAAtB,UACE,eAAC,IAAD,CAAMvB,GAAI,CAAEM,WAAY,SAAUiB,GAAI,QAAtC,UACE,cAAC,IAAD,CAAKvB,GAAI,CAAEsB,GAAI,OAAQV,SAAU,QAAjC,SAA4CrB,GAAQ,cAAC,EAAD,CAAMtD,KAAK,kBAE/D,cAAC,IAAD,CAASyE,GAAG,KAAZ,SAAkBb,OAGpB,cAAC,IAAD,CAAMG,GAAI,CAAEY,SAAU,GAAtB,SAA4BlG,QCZnB4nB,GAAoB,SAAA1J,GAAU,IACjCkJ,EAAkB5D,KAAlB4D,cAEFS,EAAkBhc,uBAAY,WAClCub,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9hB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,qCAAnB,qDAIA,cAAC,IAAD,CAAMiB,QAAQ,iBAAd,SACE,cAAC,IAAD,CAAQC,QAASwhB,EAAjB,iCChBJC,GAAW,SAACvpB,EAAawpB,GAAd,OAA+BxpB,GAAKwpB,EAAIxpB,EAAEypB,GAAGD,IAAMxpB,IAAMwpB,GAY7DE,GAAuB,SAClCC,GACkC,IAAD,EACiBznB,mBAASynB,GAD1B,mBAC1BC,EAD0B,KACPC,EADO,KAWjC,OARAnnB,qBAAU,WAfG,IAAC1C,EAAqBwpB,IAgB3BI,MAAwBD,EAC5BE,EAAqBF,IACZC,IAAqBD,IAlBCH,EAkByCG,GAlB9D3pB,EAkB2C4pB,GAhBrDrgB,OAASigB,EAAEjgB,MACbggB,GAASvpB,EAAEnC,OAAO2nB,WAAYgE,EAAE3rB,OAAO2nB,aACvC+D,GAASvpB,EAAEnC,OAAO4nB,UAAW+D,EAAE3rB,OAAO4nB,YACtC8D,GAASvpB,EAAEnC,OAAO0nB,kBAAmBiE,EAAE3rB,OAAO0nB,oBAC9CgE,GAASvpB,EAAEnC,OAAO6nB,mBAAoB8D,EAAE3rB,OAAO6nB,sBAa7CmE,EAAqBF,KAEtB,CAACC,EAAmBD,IAEhBC,GC1BIE,GAAoB,SAAC,GAAD,IAAGroB,EAAH,EAAGA,SAAH,OAC/B,cAAC,IAAD,CACEsF,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBkB,GAAI,CAAC,EAAG,GACRtB,EAAG,EAEHmK,OAAQ,EACRlK,aAAc,MACdM,YAAa,UACbsK,UAAW,GAZf,SAgBE,eAAC,IAAD,CAAM9K,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,EAAD,CAAMrE,KAAK,uBAAuB+E,KAAK,OACvC,cAAC,IAAD,CAAMhB,GAAI,CAAE4D,GAAI,GAAhB,SAAsBlJ,UCHfsoB,GAA2E,SAAC,GAMlF,IALLJ,EAKI,EALJA,YACAjF,EAII,EAJJA,iBACAC,EAGI,EAHJA,kCACAqF,EAEI,EAFJA,mBACAC,EACI,EADJA,sBAEQxmB,EAAYM,IAAZN,QAsCR,OApCAf,qBAAU,WACR,GAAIinB,GAAoC,YAArBA,EAAYpgB,KAAoB,CACjD0gB,EAAsB,CAAE1gB,KAAM,eAE9B,IAAIqF,GAAY,EAEVsb,EAAY7d,WAAU,sBAAC,4BAAArM,EAAA,sEACqB,aAArB2pB,EAAYpgB,KACnC9F,EAAQ0mB,SAASvF,UAAU+E,EAAY9rB,OAAQ,CAC7C6mB,mBACAC,sCAEFlhB,EAAQ0mB,SAASpF,YAAY4E,EAAY9rB,OAAQ,CAC/C6mB,mBACAC,sCARqB,OACrByF,EADqB,OAWtBxb,IACHqb,EAAsB,CAAE1gB,KAAM,WAAY6gB,gBAC1CxpB,QAAQC,IACN,sBACE7D,WAAQC,KAAR,UAAgBmtB,EAAYC,wBAAwBnrB,WAAY2c,SAAS,KAfpD,2CAkB1B,KAEH,OAAO,WACLyO,aAAaJ,GACbtb,GAAY,GAGdqb,EAAsB,CAAE1gB,KAAM,WAG/B,CAACogB,IAGFA,GAC4B,aAA5BK,EAAmBzgB,WAC4BvK,IAA/CgrB,EAAmBI,YAAYG,aAC/BP,EAAmBI,YAAYG,aAAe,IAElB,aAArBZ,EAAYpgB,KACjB,cAAC,GAAD,oJAKA,cAAC,GAAD,wJAOG,MCvDHihB,GAAW,SAACnhB,GAEhB,MAAO,CACLgf,KAFsChf,EAAhCgf,KAGNnL,MAHsC7T,EAA1B6T,MAIZhC,eAJsC7R,EAAnB6R,eAKnBoN,kBAAmB3C,GAA+Btc,KAIhDohB,GAAc,IAAIxD,SAAMjqB,WAAQorB,KAAMprB,WAAQorB,MAC9CsC,GAAiB,iBACjBC,GAAe3tB,WAAQC,KAAK,IAErB2tB,GAAoB,WAAO,IAC9B/B,EAAkB5D,KAAlB4D,cAD6B,EAEsBvN,8BAAmBkP,IAAtEnC,EAF6B,EAE7BA,KAAMnL,EAFuB,EAEvBA,MAAOhC,EAFgB,EAEhBA,eAAgBoN,EAFA,EAEAA,kBAC/BjL,EAAgBgL,EAAKhL,gBACrB2E,EAAe9f,qBAJgB,EAMDA,mBAAkBlF,WAAQorB,MANzB,mBAM9B3J,EAN8B,KAMlBoJ,EANkB,OAOG3lB,mBAAkBlF,WAAQorB,MAP7B,mBAO9ByC,EAP8B,KAOhBC,EAPgB,KAS/BpG,EAAmBrH,EAAcjZ,IAAI,MAErC2f,EAAM8G,EAAatM,IAAIlB,GACvB4G,EAAS,IAAIhG,WAAQZ,GACrB0N,EAAYF,EAAazmB,IAAImgB,6BAA0BngB,IAAI2f,GAC3DiH,GAAWvM,EAAWqJ,SAAW+C,EAAa/C,OAC9Cd,EAAQgE,EAAU,IAAI/D,SAAMxI,EAAYsM,GAAaN,GACrDQ,EAAgB/P,EAAekI,GAAGuH,IACpCzP,EAAe4L,IAAI6D,IACnB3tB,WAAQorB,KACN8C,EAAqBzM,EAAWgL,GAAGwB,GACnC7M,EACHK,EAAWqJ,QAAW+C,EAAa/C,YAAwC9oB,EAA/BgoB,EAAM5I,gBAAgBlB,GArBhC,EAuBF0I,GACjC6E,GACAzD,EACA3J,EACAiL,GA3BmC,mBAuB9BqB,EAvB8B,KAuBjB9S,EAvBiB,KA8B/B+S,EAAoBF,GAAqBC,GA9BV,EA+BeznB,mBAA6B,CAAEqH,KAAM,SA/BpD,mBA+B9BygB,EA/B8B,KA+BVC,EA/BU,KAiC/Bjd,EAAmBE,GAAsBwd,IACzCS,EACsB,uBAA1Bne,EAAiBzD,MACS,2BAA1ByD,EAAiBzD,KAEb6hB,EAAsB9d,uBAAY,WACtCub,EAAc,iCACb,CAACA,IAEEwC,EAAQ/d,uBAAY,WACxBua,EAAc7qB,WAAQorB,MACtB0C,EAAgB9tB,WAAQorB,QACvB,IAQH,OANA1lB,qBAAU,YACH+b,EAAWqJ,QAAU+C,EAAa/C,QACrCgD,EAAgBnE,4BAEjB,CAAClI,EAAYoM,IAGd,eAAC,IAAD,WACE,eAAC,IAAD,mBAEGG,IAAYG,GACX,cAAC,IAAD,CAAQtjB,QAAQ,YAAYd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WAAcqB,QAASujB,EAApF,SACE,cAAC,EAAD,CAAMroB,KAAK,UAAU+E,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC+a,GAAD,CACE3N,MAAM,aACN+M,QAAQ,mBACRE,OAAQ5C,EAAW5C,SAAS,GAC5BsG,UAAW8I,EAAczM,WACzB4D,SAAU8I,EACVlJ,aAAcA,EACdzN,KAAK,MACL0N,aAAcxD,EAAWD,SAAS,GAClC0D,gBAAiB,SAACb,GAAD,OAAoBwG,EAAc7qB,WAAQC,KAAKokB,OAGlE,cAACU,GAAD,CACE3N,MAAM,SACN+M,QAAQ,sBACRE,OAAQwJ,EAAahP,WACrBtH,KAAMgC,GACNyL,aAAcA,EACdC,aAAc4I,EAAarM,SAAS,GACpC0D,gBAAiB,SAACb,GAAD,OAAoByJ,EAAgB9tB,WAAQC,KAAKokB,OAGpE,cAACO,GAAD,CACExN,MAAM,sBACN+M,QAAQ,4BACRE,OAAM,UAAKkD,6BACXhQ,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAUR,cAACqZ,GAAD,CACExN,MAAM,gBACN+M,QAAQ,sBACRE,OAAQ0C,EAAIlI,SAAS,GACrByF,cAAe2C,EAAOzF,SAAS,GAC/BjK,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAACqZ,GAAD,CACExN,MAAM,aACN+M,QAAQ,mBACRE,OAAQ0J,EAAUlP,SAAS,GAC3BtH,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,eAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,2DACiD,IAC9CyiB,GACC,+DAC0BD,EAAUjE,IAAIvC,6BAA0B1I,SAAS,GAAI,IAD/E,oCAEoC0I,4BAAyB/F,WAF7D,iDAYZ,cAAC,GAAD,CAAiBhhB,MAAO4gB,IAlF1B,OAoFGvH,QApFH,IAoFGA,IACC,cAAC,GAAD,uFAKF,cAAC,GAAD,CACE8S,YAAaC,EACblF,iBAAkBA,EAClBC,kCAAmC,GACnCqF,mBAAoBA,EACpBC,sBAAuBA,IAGzB,eAAC,IAAD,CAAMpiB,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsjB,EAAlC,oBAI6B,eAA5BpB,EAAmBzgB,KAClB,cAAC,IAAD,CAAQmF,UAAQ,EAAhB,SACE,cAAC,IAAD,CAAS3G,KAAK,OAAOhB,GAAI,CAAEN,MAAO,kBAElCmjB,EACF,cAAC,GAAD,CACEnF,cAAeiG,GACfzH,OAAQ2G,EACRlF,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQjW,UAAQ,EAAhB,2BAILyc,GAAwB,cAAC,GAAD,QCvMzBX,GAAW,SAACnhB,GAEhB,MAAO,CACL2d,MAF6C3d,EAAvC2d,MAGNqB,KAH6Chf,EAAhCgf,KAIbnL,MAJ6C7T,EAA1B6T,MAKnBhC,eAL6C7R,EAAnB6R,eAM1BoN,kBAAmB3C,GAA+Btc,KAIhDqhB,GAAiB,mBACjBC,GAAe3tB,WAAQC,KAAK,IA0CrBquB,GAAsB,WAAO,IAChCzC,EAAkB5D,KAAlB4D,cAD+B,EAE2BvN,8BAAmBkP,IAA7ExD,EAF+B,EAE/BA,MAAOqB,EAFwB,EAExBA,KAAMnL,EAFkB,EAElBA,MAAOhC,EAFW,EAEXA,eAAgBoN,EAFL,EAEKA,kBACtCtG,EAAe9f,qBACfqpB,EAAgBrM,iBAAc8H,GAJG,EAKH9kB,mBAAkB8kB,EAAMvI,YALrB,mBAKhCA,EALgC,KAKpBoJ,EALoB,OAMT3lB,mBAAkB8kB,EAAMwE,SANf,mBAMhCA,EANgC,KAMvBC,EANuB,KAQjCze,EAAmBE,GAAsBwd,IACzCrN,EAAgBgL,EAAKhL,gBAE3B3a,qBAAU,WACsB,qBAA1BsK,EAAiBzD,MACnBsf,EAAc,oBAEf,CAAC7b,EAAiBzD,KAAMsf,IAE3BnmB,qBAAU,WACR,IAAK6oB,EAAcjM,QAAQb,WAAWgL,GAAGzC,EAAMvI,YAAa,CAC1D,IACMiN,EAlD0B,SAACC,EAA4B3E,GACjE,OAAI2E,EAAenI,cACbmI,EAAepI,SACVyD,EAAMvI,WAAWra,IAAIunB,EAAenI,eAEzCmI,EAAelI,UACbkI,EAAenI,cAAcG,GAAGqD,EAAMvI,YACjCuI,EAAMvI,WAAWqI,IAAI6E,EAAenI,eAGxCwD,EAAMvI,WAERuI,EAAMvI,WAsCcmN,CADAvH,cAAWC,QAAQ7F,EAAY8M,EAAcjM,QAAQb,YACPuI,GACrEa,EAAc6D,GAEhB,IAAKH,EAAcjM,QAAQkM,QAAQ/B,GAAGzC,EAAMwE,SAAU,CACpD,IACMK,EAxCuB,SAACF,EAA4B3E,GAC9D,OAAI2E,EAAenI,cACbmI,EAAepI,SACVyD,EAAMwE,QAAQpnB,IAAIunB,EAAenI,eAEtCmI,EAAelI,UACbkI,EAAenI,cAAcG,GAAGqD,EAAMwE,SACjCxE,EAAMwE,QAAQ1E,IAAI6E,EAAenI,eAGrCwD,EAAMwE,QAERxE,EAAMwE,QA4BWM,CADGzH,cAAWC,QAAQkH,EAASD,EAAcjM,QAAQkM,SACVxE,GAC/DyE,EAAWI,GAEbN,EAAcjM,QAAU0H,IACvB,CAACA,EAAOvI,EAAY+M,IAEvB,IAAMJ,EAAsB9d,uBAAY,WACtCub,EAAc,iCACb,CAACA,IAEEwC,EAAQ/d,uBAAY,WACxBua,EAAcb,EAAMvI,YACpBgN,EAAWzE,EAAMwE,WAChB,CAACxE,EAAMvI,WAAYuI,EAAMwE,UAEtBR,GAAWvM,EAAWgL,GAAGzC,EAAMvI,cAAgB+M,EAAQ/B,GAAGzC,EAAMwE,SAChEO,EAAiBP,EAAQpI,GAAG4D,EAAMwE,SAClCQ,EAAqBD,EAAiBP,EAAQ1E,IAAIE,EAAMwE,SAAWxuB,WAAQorB,KAE3ErE,EAAMgI,EApFE,SAAClI,EAAiBC,EAAezG,GAC/C,IAAM4F,EAASY,EAASmC,YAAYlC,EAAQzG,GAE5C,OAAI4F,GAA0B,oBAAhBA,EAAO1Z,MAA8B0Z,EAAOplB,OAAO2nB,WACxDvC,EAAOplB,OAAO2nB,WAAWjH,IAAIlB,GAE7BrgB,WAAQorB,KA+EbD,CAAQnB,EAAO,IAAIC,SAAMD,EAAMvI,WAAYuI,EAAMjJ,KAAK3Z,IAAI4nB,IAAsB3O,GAChFrgB,WAAQorB,KACN2C,EAAYS,EAAQpnB,IAAImgB,6BAA0BngB,IAAI2f,GACtDW,EAAmBrH,EAAcjZ,IAAI,MACrC6nB,EAAejB,EAAU,IAAI/D,SAAMxI,EAAYsM,GAAa/D,EAC5D/C,EAAS,IAAIhG,WAAQZ,GACrB6O,EAAehR,EAAekI,GAAGuH,IACnCzP,EAAe4L,IAAI6D,IACnB3tB,WAAQorB,KACN6C,EAAgBjE,EAAMvI,WAAWra,IAAI8nB,GACrChB,EAAqBzM,EAAWgL,GAAGwB,GACnC7M,EACHK,EAAWqJ,QAAW0D,EAAQ1D,YAA+C9oB,EAAtCitB,EAAa7N,gBAAgBlB,GACjEkH,EAAwBC,cAAWC,QAAQlG,EAAiB4I,EAAM5I,gBAAgBlB,IA1DjD,EA4DJ0I,GACjCoB,EACAiF,EACA5O,EACAiL,GAhEqC,mBA4DhCqB,EA5DgC,KA4DnB9S,EA5DmB,KAmEjC+S,EAAoBF,GAAqBC,GAnER,EAoEaznB,mBAA6B,CAAEqH,KAAM,SApElD,mBAoEhCygB,EApEgC,KAoEZC,EApEY,KAsEjCkB,EACsB,uBAA1Bne,EAAiBzD,MACS,2BAA1ByD,EAAiBzD,KAEnB,MAAqB,SAAjByd,EAAM7lB,OACD,KAIP,eAAC,IAAD,WACE,eAAC,IAAD,mBAEG6pB,IAAYG,GACX,cAAC,IAAD,CAAQtjB,QAAQ,YAAYd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WAAcqB,QAASujB,EAApF,SACE,cAAC,EAAD,CAAMroB,KAAK,UAAU+E,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC+a,GAAD,CACE3N,MAAM,aACN+M,QAAQ,mBACRE,OAAQ5C,EAAW5C,SAAS,GAC5BsG,UAAW8I,EAAczM,WACzB4D,SAAU8I,EACVlJ,aAAcA,EACdzN,KAAK,MACL0N,aAAcxD,EAAWD,SAAS,GAClC0D,gBAAiB,SAACb,GAAD,OAAoBwG,EAAc7qB,WAAQC,KAAKokB,OAGlE,cAACU,GAAD,CACE3N,MAAM,WACN+M,QAAQ,wBACRE,OAAQmK,EAAQ3P,WAChBtH,KAAMgC,GACNyL,aAAcA,EACdC,aAAcuJ,EAAQhN,SAAS,GAC/B0D,gBAAiB,SAACb,GAAD,OAAoBoK,EAAWzuB,WAAQC,KAAKokB,OAG/D,cAACO,GAAD,CACExN,MAAM,sBACN+M,QAAQ,4BACRE,OAAM,UAAKkD,6BACXhQ,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6NAUR,cAACqZ,GAAD,CACExN,MAAM,gBACN+M,QAAQ,sBACRE,OAAQ0C,EAAIlI,SAAS,GACrByF,cAAe2C,EAAOzF,SAAS,GAC/BjK,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,6JASR,cAACqZ,GAAD,CACExN,MAAM,aACN+M,QAAQ,mBACRE,OAAQ0J,EAAUlP,SAAS,GAC3BtH,KAAMgC,GACNuK,SACE,cAAChF,GAAD,CACEpO,QACE,eAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,2DACiD,IAC9CyiB,GACC,+DAC0BD,EAAUjE,IAAIvC,6BAA0B1I,SAAS,GAAI,IAD/E,oCAEoC0I,4BAAyB/F,WAF7D,iDAYZ,cAAC,GAAD,CAAiBhhB,MAAO4gB,EAAiB6E,OAAQmB,IAlFnD,OAoFGvN,QApFH,IAoFGA,IACC,cAAC,GAAD,4EAKF,cAAC,GAAD,CACE8S,YAAaC,EACblF,iBAAkBA,EAClBC,kCAAmC,GACnCqF,mBAAoBA,EACpBC,sBAAuBA,IAGzB,eAAC,IAAD,CAAMpiB,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASsjB,EAAlC,oBAICxB,EACC,cAAC,GAAD,CACEnF,cAAeiG,GACfzH,OAAQ2G,EACRlF,iBAAkBA,EAClBC,kCAAmC,GAJrC,qBASA,cAAC,IAAD,CAAQjW,UAAQ,EAAhB,2BAILyc,GAAwB,cAAC,GAAD,QCtRzBlQ,GAAS,SAAC,GAAD,MAAsD,CACnEkR,yBADa,EAAGA,2BAILC,GAAoC,WAAO,IAC9CD,EAA6B7Q,8BAAmBL,IAAhDkR,yBAEW1oB,EACfM,IADFN,QAAWnG,KAGP+uB,EAAkB,qBAClBrD,EAAqB9b,GAAsBmf,GAEzCxD,EAAkB5D,KAAlB4D,cAQR,OANAnmB,qBAAU,WACwB,qBAA5BsmB,EAAmBzf,MACrBsf,EAAc,sCAEf,CAACG,EAAmBzf,KAAMsf,IAEM,uBAA5BG,EAAmBzf,KACxB,cAAC,IAAD,CAAM1B,QAAQ,iBAAd,SACE,eAAC,IAAD,CAAQ6G,UAAQ,EAAC3H,GAAI,CAAEmO,GAAI,GAA3B,UACE,cAAC,IAAD,CAASnO,GAAI,CAAEsB,GAAI,EAAG5B,MAAO,SAAWsB,KAAK,SAD/C,iCAK4B,2BAA5BihB,EAAmBzf,MACO,cAA5Byf,EAAmBzf,KACnB,cAAC,IAAD,CAAM1B,QAAQ,iBAAd,SACE,cAAC4F,GAAD,CACEhR,GAAI4vB,EACJ/uB,KAAMmG,EAAQ6oB,uBAAuBzH,KAAKphB,OAASzE,GAFrD,SAIE,eAAC,IAAD,CAAQ+H,GAAI,CAAEmO,GAAI,GAAlB,mBAA8BiX,EAAyBtQ,WAAvD,cAGF,MCzCAZ,GAAS,SAAC,GAAD,MAAsD,CACnEsR,sBADa,EAAGJ,yBACgCrE,SAGrC0E,GAA0B,WAAO,IACpCD,EAAyBjR,8BAAmBL,IAA5CsR,qBACA1D,EAAkB5D,KAAlB4D,cAEFS,EAAkBhc,uBAAY,WAClCub,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9hB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,gCAAnB,SACG2lB,EACG,uEACA,4CAGN,eAAC,IAAD,CAAM1kB,QAAQ,iBAAd,UACG0kB,GAAwB,cAAC,GAAD,KACvBA,GAAwB,cAAC,IAAD,CAAQzkB,QAASwhB,EAAjB,kCCxB9BrO,GAAS,SAAC,GAAD,MAAsD,CACnEsR,sBADa,EAAGJ,yBACgCrE,SAGrC2E,GAA4B,WAAO,IACtCF,EAAyBjR,8BAAmBL,IAA5CsR,qBACA1D,EAAkB5D,KAAlB4D,cAEFS,EAAkBhc,uBAAY,WAClCub,EAAc,wBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,cAAC,IAAD,oBACA,eAAC,IAAD,CAAK9hB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,kCAAnB,SACG2lB,EACG,uEACA,4CAGN,eAAC,IAAD,CAAM1kB,QAAQ,iBAAd,UACG0kB,GAAwB,cAAC,GAAD,KACvBA,GAAwB,cAAC,IAAD,CAAQzkB,QAASwhB,EAAjB,kCCrBvBrC,GAAkB,SAAAtH,GAG7B,OAFiBsF,KAATyH,MAIN,IAAK,SACH,OAAO,cAAC,GAAD,eAAmB/M,IAE5B,IAAK,YACH,OAAO,cAAC,GAAD,eAAeA,IAExB,IAAK,UACH,OAAO,cAAC,GAAD,2BAAkBA,GAAlB,IAAyBlB,WAAYzhB,WAAQorB,KAAMrK,KAAM/gB,WAAQorB,QAE1E,IAAK,UACH,OAAO,cAAC,GAAD,eAAazI,IAEtB,IAAK,aACH,OAAO,cAAC,GAAD,eAAqBA,IAE9B,IAAK,WACH,OAAO,cAAC,GAAD,eAAmBA,IAE5B,IAAK,OACH,OAAO,cAAC,GAAD,eAAaA,MCfpB1E,GAAS,SAAC,GAAD,MAA8D,CAC3EE,YADa,EAAGA,YAEhBiC,oBAFa,EAAgBA,sBAYlBuP,GAAgE,SAAC,GAMvE,IALLC,EAKI,EALJA,gBACAC,EAII,EAJJA,WACA7I,EAGI,EAHJA,cACAzZ,EAEI,EAFJA,SACA9I,EACI,EADJA,SACI,EACyC6Z,8BAAmBL,IAAxDE,EADJ,EACIA,YAAaiC,EADjB,EACiBA,oBACf4E,EAAe9f,qBAEf4hB,GAAU+I,EAAWpD,GAAGmD,EAAgBE,aAExC3K,EAAYyK,EAAgBE,YAAY1oB,IAAI+W,GAC5CiH,EAAWyK,EAAWpD,GAAGtH,GAEzB4K,EAAiC3P,EACpC0J,IAAI8F,EAAgBE,aACpB1oB,IAAIyoB,GAEDG,EAAoBJ,EAAgBE,YAAYG,OAAO,IAAK7P,GAC5D8P,EAAeL,EAAWI,OAAO,IAAKF,GACtCI,EACJP,EAAgBE,YAAY9O,SAC5BqG,cAAWC,QAAQ4I,EAAcF,GAAmBhP,QAEtD,OACE,eAAC,IAAD,WACE,eAAC,IAAD,4BAEG8F,IAAWE,GACV,cAAC,IAAD,CACEnc,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAMyC,EAAS,CAAEhB,KAAM,YAHlC,SAKE,cAAC,EAAD,CAAMvG,KAAK,UAAU+E,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC+a,GAAD,CACE3N,MAAM,UACN+M,QAAQ,eACRE,OAAQwL,EAAWhR,WACnBsG,UAAWA,EAAU3D,WACrB4D,SAAUA,EACV7N,KAAMgC,GACAyL,eACNC,aAAc4K,EAAWrO,SAAS,GAClC0D,gBAAiB,SAAAyF,GAAQ,OAAIpd,EAAS,CAAEhB,KAAM,aAAcoe,gBAG7DuF,EAAaE,SACZ,cAACxL,GAAD,CAAWxN,MAAM,aAAa+M,QAAQ,gBAAgBE,OAAO,QAE7D,cAACO,GAAD,CACExN,MAAM,aACN+M,QAAQ,gBACRE,OAAQ6L,EAAarR,SAAS,GAC9ByF,cAAa,OAAE6L,QAAF,IAAEA,OAAF,EAAEA,EAAiBtR,SAAS,GAAGwR,OAAO,KACnD9L,cAA6B,OAAf4L,QAAe,IAAfA,OAAA,EAAAA,EAAiB5J,UAAW,UAAY,SACtDhP,KAAK,OAIPqY,EAAgBzI,SAChB,qCACE,cAACvC,GAAD,CACExN,MAAM,mBACN+M,QAAQ,eACRE,OAAQuL,EAAgBU,eAAezR,SAAS,GAChDpV,MAAOmmB,EAAgBU,eAAetP,SAAW,UACjDzJ,KAAK,QAGP,cAACqN,GAAD,CACExN,MAAM,SACN+M,QAAQ,iBACRE,OAAQuL,EAAgBW,WAAW1R,WACnCpV,MAAOmmB,EAAgBW,WAAWvP,SAAW,UAC7CzJ,KAAMiC,GACNsK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,mPAWX9G,KAGFuiB,GAAiB,cAAC,GAAD,QCvHlBwJ,GAA2B,SAAC,GAAD,MACX,eADW,EAAGhQ,SACzBrc,QAEEssB,GAAgE,SAAC,GAIvE,IAHLhsB,EAGI,EAHJA,SACAgjB,EAEI,EAFJA,cACAxB,EACI,EADJA,OACI,EACwBlf,IAApBtD,EADJ,EACIA,OAAQgD,EADZ,EACYA,QAGVtD,EAFqBmb,8BAAmBkS,IAEL/sB,EAAON,iBAAcnB,EAJ1D,EAMsBoO,GACxBqX,EACAxB,EAAOyK,YACHjqB,EAAQnG,KAAKqwB,2BAA2B9I,KAAKphB,EAAQnG,KAAM2lB,EAAOyK,YAAavtB,GAC/EsD,EAAQnG,KAAKswB,8BAA8B/I,KAAKphB,EAAQnG,KAAM2lB,EAAO4K,eAJpE/f,EANH,oBAaJ,OAAO,cAAC,IAAD,CAAQhG,QAASgG,EAAjB,SAAmCrM,KCxB/BqsB,GAAuBxsB,wBAA+C,MAEtEysB,GAAmB,WAC9B,IAAMrU,EAA2CzV,qBAAW6pB,IAE5D,GAAgB,OAAZpU,EACF,MAAM,IAAIrc,MAAM,8DAGlB,OAAOqc,GCLIsU,GAAwE,SAAC,GAG/E,IAAD,IAFJpB,EAEI,EAFJA,gBACA3J,EACI,EADJA,OAEMqK,EAAc,UAAGV,EAAgBU,eAAetP,eAAlC,aAAG,EAAwCnC,SAAS,GAAGwR,OAAO,QAC5EE,EAAU,UAAGX,EAAgBW,WAAWvP,eAA9B,aAAG,EAAoCnC,WAAWwR,OAAO,IAAK7W,IAE9E,OACE,eAAC,GAAD,WACGyM,EAAOyK,YACN,0DACqB,IACnB,eAAC,GAAD,WACGzK,EAAOyK,YAAY7R,WADtB,IACmCtF,MACzB,IAJZ,2BAQA,2DACsB,IACpB,eAAC,GAAD,WACG0M,EAAO4K,aAAahS,WADvB,IACoCtF,MAC1B,IAJZ,qBAQA+W,GAAkBC,IAClB,qCACG,IADH,wBAEwB,IACrBD,GAAkBC,EACjB,qCACE,cAAC,GAAD,UAASD,IADX,QACwC,cAAC,GAAD,UAASC,OAGjD,cAAC,GAAD,iBAASD,QAAT,IAASA,IAAkBC,OA3BnC,QCRSU,GAA4C,SAAC,GAAD,IACvDjH,EADuD,EACvDA,MACA7L,EAFuD,EAEvDA,YACA+S,EAHuD,EAGvDA,YACAC,EAJuD,EAIvDA,8BAJuD,MAK/B,CACxBnH,QACA7L,cACAiT,gBAAwC,eAAvBF,EAAY/sB,OAC7BgtB,kCCFIpH,GAAO,SAAC,GAAD,IAAGsH,EAAH,EAAGA,iBAAH,MAA8C,CACzDzB,gBAAiByB,EACjBxB,WAAYwB,EAAiBvB,YAC7B9I,eAAe,IASXoD,GAAa,SAAC9d,GAAD,OAA2C,SAC5DD,GAD4D,OAE3Bge,GAAOhe,EAAOC,KAE3Cke,GAAeJ,GAAW,CAAE7d,KAAM,iBAClCke,GAASL,GAAW,CAAE7d,KAAM,WAE5B8d,GAAS,SACbhe,EACAC,GACiC,IAIzBsjB,EAA+CvjB,EAA/CujB,gBAAiBC,EAA8BxjB,EAA9BwjB,WAAY7I,EAAkB3a,EAAlB2a,cAErC,OAAQ1a,EAAOC,MACb,IAAK,cAEH,OADA3I,QAAQC,IAAI,iBACL,2BAAKwI,GAAZ,IAAmB2a,eAAe,IAGpC,IAAK,eACH,OAAO,2BAAK3a,GAAZ,IAAmB2a,eAAe,IAEpC,IAAK,aACH,OAAO,2BAAK3a,GAAZ,IAAmBwjB,WAAY7vB,WAAQC,KAAKqM,EAAOqe,YAErD,IAAK,SACH,OAAO,2BAAKte,GAAZ,IAAmBwjB,WAAYD,EAAgBE,cAEjD,IAAK,cAAgB,IAEgBwB,EAC/BhlB,EADF2e,YAAeoG,iBAGjB,IAAKC,EACH,OAAOjlB,EAGT,IAAMue,EAAQ,2BAAQve,GAAR,IAAeujB,gBAAiB0B,IAExCtG,GACHsG,EAAeC,YAAY9E,GAAGmD,EAAgB2B,cAC/CD,EAAexB,YAAY1J,GAAGwJ,EAAgBE,cAC9CwB,EAAehB,eAAe3J,GAAGiJ,EAAgBU,iBACjDgB,EAAef,WAAW5J,GAAGiJ,EAAgBW,YAE/C,OAAIvJ,GAAiBgE,EACZR,GAAaC,GAAOG,IAGtB,2BACFA,GADL,IAEEiF,WAAYyB,EAAepI,MAAM0G,EAAgB5G,YAAY6G,QAM/DpI,GAAgB,oBAET+J,GAAoC,WAAO,IAAD,EACc7F,6BAAkBtB,GAAQN,IADxC,0BAC5C6F,EAD4C,EAC5CA,gBAAiBC,EAD2B,EAC3BA,WAAY7I,EADe,EACfA,cAAiBzZ,EADF,KAE/C+d,EAAoBhN,8BAAmB2S,IACrCpF,EAAkBkF,KAAlBlF,cAEFC,EAAexb,uBAAY,WAC/Bub,EAAc,oBACb,CAACA,IAPiD,EDjET,SAC5C+D,EACAC,EAF4C,GAWxC,IAAD,EAPD1R,EAOC,EAPDA,YACAiT,EAMC,EANDA,gBACAD,EAKC,EALDA,8BAMIlL,EAAS2J,EAAgB5G,YAAY6G,GAE3C,OAAIuB,EACK,MACLpvB,EACA,cAAC,GAAD,+FAMCikB,GAIL,UAAIA,EAAOyK,mBAAX,aAAI,EAAoBtK,GAAGjI,IAClB,MACLnc,EACA,eAAC,GAAD,yEAC8D,IAC5D,eAAC,GAAD,WACGikB,EAAOyK,YAAY5G,IAAI3L,GAAaU,WADvC,IACoDtF,MAHtD,QAUA0M,EAAO4K,cAAgBM,EAClB,MACLnvB,EACA,cAAC,GAAD,4KAOG,CAACikB,EAAQ,cAAC,GAAD,CAA4B2J,gBAAiBA,EAAiB3J,OAAQA,KA1B7E,MAACjkB,OAAWA,GCkDcyvB,CACjC7B,EACAC,EACAvE,GAZmD,mBAS9CM,EAT8C,KASjC/R,EATiC,KAe/C6X,EAAmB9B,EAAgBzI,QAEnC6E,EAAqB9b,GAAsBuX,IAejD,OAbA/hB,qBAAU,WAEsB,uBAA5BsmB,EAAmBzf,MACS,2BAA5Byf,EAAmBzf,KAEnBgB,EAAS,CAAEhB,KAAM,gBACoB,WAA5Byf,EAAmBzf,MAAiD,cAA5Byf,EAAmBzf,KACpEgB,EAAS,CAAEhB,KAAM,iBACoB,qBAA5Byf,EAAmBzf,MAC5Bsf,EAAc,uBAEf,CAACG,EAAmBzf,KAAMgB,EAAUse,IAGrC,eAAC,GAAD,CACE+D,gBAAiBA,EACjBC,WAAYA,EACZ7I,cAAeA,EACfzZ,SAAUA,EAJZ,iBAMGsM,QANH,IAMGA,IACE6X,EACC,eAAC,GAAD,kCAAwCnY,GAAxC,6BAEA,eAAC,GAAD,yBAA+BA,GAA/B,qCAGJ,eAAC,IAAD,CAAM1O,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAASghB,EAAlC,oBAICF,EACC,cAAC,GAAD,CAAwBnE,cAAeA,GAAexB,OAAQ2F,EAA9D,qBAIA,cAAC,IAAD,CAAQla,UAAQ,EAAhB,4BC5IGigB,GAA4C,SAAC,GAA4B,IAA1BjgB,EAAyB,EAAzBA,SAAUjN,EAAe,EAAfA,SAC5DgC,EAAYM,IAAZN,QAD2E,EAGzD2J,GACxB,oBACA3J,EAAQnG,KAAKsxB,8BAA8B/J,KAAKphB,EAAQnG,OAFnDwQ,EAH4E,oBAQnF,OACE,cAAC,IAAD,CACEjG,QAAQ,UACRd,GAAI,CAAEsE,GAAI,EAAG9C,MAAO,QACpBT,QAASgG,EACTY,SAAUA,EAJZ,SAMGjN,KCdMotB,GAA4C,SAAC,GAA4B,IAA1BngB,EAAyB,EAAzBA,SAAUjN,EAAe,EAAfA,SAC5DgC,EAAYM,IAAZN,QAD2E,EAGzD2J,GACxB,oBACA3J,EAAQnG,KAAKwxB,+BAA+BjK,KAAKphB,EAAQnG,OAFpDwQ,EAH4E,oBAQnF,OACE,cAAC,IAAD,CAAQhG,QAASgG,EAAiBY,SAAUA,EAA5C,SACGjN,KCdD+oB,GAAW,SAAC,GAAD,MAA8D,CAC7EuE,iCADe,EAAGA,mCAIPC,GAA0B,WAAO,IACpCD,EAAqCzT,8BAAmBkP,IAAxDuE,iCAER,OACE,eAAC,IAAD,CAAMhoB,GAAI,CAAEsB,GAAI,EAAGV,SAAU,EAAGgB,WAAY,UAA5C,UACGomB,EAAiClT,SAAS,GAD7C,sBCXSoT,GAAkB,SAAC,GAAkB,IAAhBxtB,EAAe,EAAfA,SAChC,OAAO,cAAC,IAAD,CAAMoG,QAAQ,eAAd,SAA8BpG,K,SCIjCytB,GAAU,SAAsB5uB,EAAM0G,GAA5B,OAAqEA,KAAK1G,GAEpF6uB,GAAuC,SAC3CC,EACAC,EACA/vB,GAEA,GAAoB,kBAATA,GAA8B,OAATA,EAC9B,MAAM,IAAIjC,MAAJ,sCAF+B,qBAKlB+xB,GALkB,IAKvC,2BAAsC,CAAC,IAA5BE,EAA2B,QACpC,IAAKJ,GAAQ5vB,EAAMgwB,GACjB,MAAM,IAAIjyB,MAAJ,gBAAmBiyB,EAAnB,sCAGR,IALoC,EAK9BC,EAAajwB,EAAKgwB,GALY,eAObD,GAPa,IAOpC,2BAA2C,CAAC,IAAjC1T,EAAgC,QACzC,IAAKuT,GAAQK,EAAY5T,GACvB,MAAM,IAAIte,MAAJ,oBAAuBse,EAAvB,sCAGR,GAAoC,kBAAzB4T,EAAW5T,GACpB,MAAM,IAAIte,MAAJ,yBAA4BiyB,EAA5B,0BAAoD3T,EAApD,uBAb0B,gCALC,8BAuBvC,OAAOrc,GAGHkwB,GAAyB,uCAAG,WAChCC,EACAC,GAFgC,iBAAA1vB,EAAA,6DAI1B2vB,EACJ,iDACA,IAAIC,gBAAgB,CAClBC,IAAKJ,EAAQ9c,KAAK,KAClBmd,cAAeJ,EAAa/c,KAAK,OARL,SAWTtP,OAAOjE,MAAMuwB,EAAgB,CAClDtwB,QAAS,CACP0wB,OAAQ,sBAboB,WAW1B5wB,EAX0B,QAiBlB+B,GAjBkB,sBAkBxB,IAAI7D,MAAJ,0DAA6D8B,EAASgC,SAlB9C,mBAqBzBguB,GArByB,KAqBYM,EArBZ,KAqBqBC,EArBrB,UAqByCvwB,EAASM,OArBlD,mHAAH,wDA4BlBuwB,GAAc,uCAAG,4BAAAhwB,EAAA,sEACLwvB,GAA0B,CAAC,WAAqB,CAAC,QAD5C,cACtBrwB,EADsB,yBAGrB,CACL8wB,aAAcjzB,WAAQC,KAAKkC,EAASsE,QAAQysB,OAJlB,2CAAH,qDC5DrB1F,GAAW,SAAC,GAAD,MAAmF,CAClGpN,oBADe,EAAGA,oBAElB2R,iCAFe,EAAwBA,mCAMnCoB,GAAwBnzB,WAAQC,KAAK,WADZ,GAC2C,EAAI,MACxEmzB,GAA0BD,GAAsB5R,IAAI,KAE7C8R,GAAkB,WAAO,IAAD,EAC+B/U,8BAAmBkP,IAA7EpN,EAD2B,EAC3BA,oBAAqB2R,EADM,EACNA,iCADM,EAGD7sB,wBAA8BlD,GAH7B,mBAG5BsxB,EAH4B,KAGjBC,EAHiB,KAI7BC,EAAezB,EAAiCjH,QAAU1K,EAAoB0K,OAapF,GAXAplB,qBAAU,WACR,sBAAC,8BAAA1C,EAAA,+EAEkCgwB,KAFlC,gBAEWC,EAFX,EAEWA,aACRM,EAAaN,GAHhB,gDAKGrvB,QAAQlB,MAAR,MALH,wDAAD,KAQC,IAEC8wB,QAA8BxxB,IAAdsxB,EAAyB,OAAO,KAEpD,IAEMG,EAFqB1B,EAAiCxQ,IAAI4R,IACb5R,IAAI+R,GACTrD,OAAO,MAAW7P,GAC1DsT,EAAqB3B,EAAiCxQ,IAAI+R,GAEhE,OAAIG,EAAc3I,OAAe,KAG/B,eAAC,GAAD,WACE,eAAC,IAAD,uBAAgB2I,EAAcjS,SAAS,GAAvC,OACA,cAAC1C,GAAD,CACEpO,QACE,eAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,CAAC,QAAS,UAA/C,UACE,eAAC,IAAD,iBACK,cAAC,IAAD,CAAMxB,GAAI,CAAE4B,WAAY,QAAxB,sBADL,yIAKA,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQ2L,WAAY,YAAajI,GAAI,GAAhE,6EACmE,IACjE,cAAC,IAAD,CAAMtE,GAAI,CAAE4B,WAAY,QAAxB,qBAEF,eAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,OAAQ2L,WAAY,aAA/C,eAEGod,EAAmBhS,UAFtB,MAEoC0R,GAAwB5R,SAAS,GAFrE,QAGGpB,EAAoBsB,UAHvB,kBAIE,eAAC,IAAD,CAAM3X,GAAI,CAAE4B,WAAY,QAAxB,cAAoC8nB,EAAcjS,SAAS,GAA3D,mBC5CRgM,GAAW,SAAC,GAAD,MAA0E,CACzF6D,iBADe,EAAGA,iBAElBrH,MAFe,EAAqBA,MAGpC5J,oBAHe,EAA4BA,sBAMhCuT,GAA0B,WAAO,IACpC9H,EAAkBkF,KAAlBlF,cADmC,EAEcvN,8BAAmBkP,IAApE6D,EAFmC,EAEnCA,iBAAkBrH,EAFiB,EAEjBA,MAAO5J,EAFU,EAEVA,oBAE3BwT,EAAYvC,EAAiBvB,YAAYG,OAAO,IAAK7P,GAErDyT,EAAsBvjB,uBAAY,WACtCub,EAAc,4BACb,CAACA,IAEEiI,GAAazC,EAAiBd,WAAWzF,OACzCiJ,GAAW1C,EAAiBf,eAAexF,OAC3CkJ,GAAYhK,EAAM7C,QAGlBnX,EAAmBE,GADH,qBAEhB+jB,EACsB,uBAA1BjkB,EAAiBzD,MACS,2BAA1ByD,EAAiBzD,KAQnB,OANA7G,qBAAU,WACsB,qBAA1BsK,EAAiBzD,MACnBsf,EAAc,qBAEf,CAAC7b,EAAiBzD,KAAMsf,IAGzB,eAAC,IAAD,WACE,eAAC,IAAD,6BAEIoI,GACA,cAAC,IAAD,CAAMlqB,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAIN,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,IAAD,WACE,cAAC8a,GAAD,CACE1N,MAAM,UACN+M,QAAQ,eACRE,OAAQgN,EAAiBvB,YAAYjR,WACrCtH,KAAMgC,KAGR,cAACqL,GAAD,CACExN,MAAM,aACN+M,QAAQ,gBACRE,OAAQuP,EAAU/U,SAAS,GAC3BtH,KAAK,MAGP,cAACqN,GAAD,CACExN,MAAM,mBACN+M,QAAQ,eACRE,OAAQgN,EAAiBf,eAAezR,SAAS,GACjDpV,MAAO4nB,EAAiBf,eAAetP,SAAW,UAClDzJ,KAAK,QAGP,eAAC,IAAD,CAAMxN,GAAI,CAAEM,WAAY,UAAxB,UACE,cAACua,GAAD,CACExN,MAAM,SACN+M,QAAQ,iBACRE,OAAQgN,EAAiBd,WAAW1R,WACpCpV,MAAO4nB,EAAiBd,WAAWvP,SAAW,UAC9CzJ,KAAMiC,GACNsK,SACE,cAAChF,GAAD,CACEpO,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,gPASR,cAAC,IAAD,CAAMxB,GAAI,CAAEK,eAAgB,WAAYqN,KAAM,GAA9C,SACE,cAAC,GAAD,YAKN,eAAC,IAAD,CAAM5M,QAAQ,iBAAd,UACE,eAAC,IAAD,CAAQA,QAAQ,UAAUC,QAAS+oB,EAAnC,UACE,cAAC,EAAD,CAAM7tB,KAAK,MAAM+E,KAAK,OADxB,gBAKA,cAAC,GAAD,CAAc2G,UAAWqiB,IAAYD,EAArC,mCAGDE,GACC,cAAC,GAAD,CAActiB,UAAWqiB,EAAzB,iDAIHE,GAA2B,cAAC,GAAD,QCpHrBC,GAAsB,SAAAvR,GAAU,IACnCkJ,EAAkBkF,KAAlBlF,cAEFS,EAAkBhc,uBAAY,WAClCub,EAAc,qBACb,CAACA,IAEJ,OACE,eAAC,IAAD,WACE,eAAC,IAAD,4BAEE,cAAC,IAAD,CAAM9hB,GAAI,CAAEK,eAAgB,YAA5B,SACE,cAAC,GAAD,SAGJ,eAAC,IAAD,CAAKL,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,CAAaJ,MAAM,0CAAnB,mEAIA,eAAC,IAAD,CAAMiB,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAMd,GAAI,CAAEK,eAAgB,aAAcqN,KAAM,EAAGpN,WAAY,UAA/D,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAQS,QAASwhB,EAAjB,+BCzBG6H,GAAsB,SAAAxR,GAGjC,OAFiBoO,KAATrB,MAGN,IAAK,OACH,OAAO,cAAC,GAAD,eAAe/M,IAExB,IAAK,aAGL,IAAK,YACH,OAAO,cAAC,GAAD,eAA6BA,IAEtC,IAAK,SACH,OAAO,cAAC,GAAD,eAAmBA,MCT1ByR,GAAc,SAAC,GAAD,SAAGlU,OAEVmU,GAAyB,WAAO,IAAD,EAMtCttB,IAJFN,QACQA,EAHgC,EAGtCnG,KACmCg0B,EAJG,EAItClvB,WAAcmvB,oBAIZrU,EAAQ5B,8BAAmB8V,IARS,EASJlvB,mBAASgb,EAAMsB,SAAS,IATpB,mBASnCgT,EATmC,KAStBC,EATsB,KAe1C,OAJA/uB,qBAAU,WACR+uB,EAAevU,EAAMsB,SAAS,MAC7B,CAACtB,IAGF,eAAC,IAAD,WACE,cAAC,IAAD,yBAEA,cAAC,IAAD,CAAKnW,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CAAMD,GAAI,CAAEM,WAAY,WAAxB,UACE,cAAC,IAAD,kBAEA,cAAC,IAAD,CAAOQ,QAAQ,OAAf,eAEA,cAAC,IAAD,CACE0B,KAAM+nB,EAAc,SAAW,OAC/B7O,KAAK,MACLjlB,MAAOg0B,EACP7O,SAAU,SAAAtD,GAAC,OAAIoS,EAAepS,EAAEvU,OAAOtN,QACvCkR,UAAW4iB,IAGZA,GACC,cAAC,IAAD,CAAMvqB,GAAI,CAAE4D,GAAI,EAAGtD,WAAY,UAA/B,SACE,cAACoG,GAAD,CACEhR,GAAG,YACHiR,QAAQ,MACRC,iBAAiB,SACjBrQ,KAAM,SAAAnB,GACJ,IAAKq1B,EACH,MAAM,IAAIn0B,MAAM,iBAElB,OAAOoG,EAAQiuB,SAAS10B,WAAQC,KAAKu0B,GAAcr1B,IARvD,SAWE,cAAC,IAAD,CAAQ0L,QAAQ,OAAhB,SACE,cAAC,EAAD,CAAM7E,KAAK,aAAa+E,KAAK,sBC3ClC4pB,GAAqBrwB,wBAA6C,MAElEswB,GAAiB,WAC5B,IAAMlY,EAAUzV,qBAAW0tB,IAE3B,GAAgB,OAAZjY,EACF,MAAM,IAAIrc,MAAM,0DAGlB,OAAOqc,GClBHmY,GAAkB,SAAC,GAAD,SAAGC,WAEdC,GAA+B,WAAO,IACzCtuB,EAAYM,IAAZN,QADwC,EAEX6X,8BAAmBuW,IAAhDvE,EAFwC,EAExCA,eAAgB0E,EAFwB,EAExBA,SAFwB,EAItB5kB,GACxB,QACA3J,EAAQnG,KAAK20B,yBAAyBpN,KAAKphB,EAAQnG,OAF9CwQ,EAJyC,oBAShD,OACE,cAAC,IAAD,CAAQhG,QAASgG,EAAiBY,SAAU4e,EAAexF,QAAUkK,EAASlK,OAA9E,0BCNE7M,GAAS,SAAC,GAAD,MAAwD,CACrE6W,UADa,EAAGA,UAEhBvU,gBAFa,EAAcA,kBAKhB2U,GAA0B,WAAO,IAAD,EACPN,KAA5B5N,EADmC,EACnCA,cAAezZ,EADoB,EACpBA,SADoB,EAEJ+Q,8BAAmBL,IAAlD6W,EAFmC,EAEnCA,UAAWvU,EAFwB,EAExBA,gBAEbqT,EAAYkB,EAAUK,WAAWlF,OAAO,IAAK1P,GAEnD,OACE,eAAC,IAAD,WACE,cAAC,IAAD,sBAEA,eAAC,IAAD,CAAKxW,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC8a,GAAD,CACE1N,MAAM,QACN+M,QAAQ,aACRE,OAAQyQ,EAAUK,WAAWtW,WAC7BtH,KAAMiC,KAGR,cAACoL,GAAD,CACExN,MAAM,aACN+M,QAAQ,cACRE,OAAQuP,EAAU/U,SAAS,GAC3BtH,KAAK,MAGP,cAACqN,GAAD,CACExN,MAAM,kBACN+M,QAAQ,iBACRE,OAAQyQ,EAAUxE,eAAezR,SAAS,GAC1CpV,MAAOqrB,EAAUxE,eAAetP,SAAW,UAC3CzJ,KAAK,QAGP,cAACqN,GAAD,CACExN,MAAM,gBACN+M,QAAQ,kBACRE,OAAQyQ,EAAUE,SAASnW,WAC3BpV,MAAOqrB,EAAUE,SAAShU,SAAW,UACrCzJ,KAAMgC,KAGR,eAAC,IAAD,CAAM1O,QAAQ,iBAAd,UACE,eAAC,IAAD,CAAQA,QAAQ,UAAUC,QAAS,kBAAMyC,EAAS,CAAEhB,KAAM,oBAA1D,UACE,cAAC,EAAD,CAAMvG,KAAK,MAAM+E,KAAK,OADxB,gBAKA,cAAC,GAAD,UAIHic,GAAiB,cAAC,GAAD,QCxDlB/I,GAAS,SAAC,GAAD,MAA0D,CACvEG,YADa,EAAGA,YAEhBmC,gBAFa,EAAgBA,kBAYlB6U,GAA8C,SAAC,GAMrD,IALL3wB,EAKI,EALJA,SACAmF,EAII,EAJJA,MACAyrB,EAGI,EAHJA,cACAC,EAEI,EAFJA,WACA/nB,EACI,EADJA,SACI,EACqC+Q,8BAAmBL,IAApDG,EADJ,EACIA,YAAamC,EADjB,EACiBA,gBACbyG,EAAkB4N,KAAlB5N,cACFhC,EAAe9f,qBAEf4hB,GAAUwO,EAAW7I,GAAG4I,EAAcF,YAEtChQ,EAAYkQ,EAAcF,WAAW/tB,IAAIgX,GACzCgH,EAAWkQ,EAAW7I,GAAGtH,GAEzBoQ,EAA6BhV,EAAgBuJ,IAAIuL,EAAcF,YAAY/tB,IAAIkuB,GAE/EtF,EAAoBqF,EAAcF,WAAWlF,OAAO,IAAK1P,GACzD2P,EAAeoF,EAAWrF,OAAO,IAAKsF,GACtCpF,EACJkF,EAAcF,WAAWnU,SAAWqG,cAAWC,QAAQ4I,EAAcF,GAAmBhP,QAE1F,OACE,eAAC,IAAD,WACE,eAAC,IAAD,WACGpX,EACAkd,IAAWE,GACV,cAAC,IAAD,CACEnc,QAAQ,YACRd,GAAI,CAAE,iBAAkB,CAAEN,MAAO,WACjCqB,QAAS,kBAAMyC,EAAS,CAAEhB,KAAM,YAHlC,SAKE,cAAC,EAAD,CAAMvG,KAAK,UAAU+E,KAAK,YAKhC,eAAC,IAAD,CAAKhB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC+a,GAAD,CACE3N,MAAM,QACN+M,QAAQ,aACRE,OAAQiR,EAAWzW,WACnBsG,UAAWA,EAAU3D,WACrB4D,SAAUA,EACV7N,KAAMiC,GACAwL,eACNC,aAAcqQ,EAAW9T,SAAS,GAClC0D,gBAAiB,SAAAyF,GAAQ,OAAIpd,EAAS,CAAEhB,KAAM,WAAYoe,gBAG3DuF,EAAaE,SACZ,cAACxL,GAAD,CAAWxN,MAAM,aAAa+M,QAAQ,cAAcE,OAAO,QAE3D,cAACO,GAAD,CACExN,MAAM,aACN+M,QAAQ,cACRE,OAAQ6L,EAAarR,SAAS,GAC9ByF,cAAa,OAAE6L,QAAF,IAAEA,OAAF,EAAEA,EAAiBtR,SAAS,GAAGwR,OAAO,KACnD9L,cAA6B,OAAf4L,QAAe,IAAfA,OAAA,EAAAA,EAAiB5J,UAAW,UAAY,SACtDhP,KAAK,OAIP8d,EAAclO,SACd,qCACE,cAACvC,GAAD,CACExN,MAAM,kBACN+M,QAAQ,iBACRE,OAAQgR,EAAc/E,eAAezR,SAAS,GAC9CpV,MAAO4rB,EAAc/E,eAAetP,SAAW,UAC/CzJ,KAAK,QAGP,cAACqN,GAAD,CACExN,MAAM,gBACN+M,QAAQ,kBACRE,OAAQgR,EAAcL,SAASnW,WAC/BpV,MAAO4rB,EAAcL,SAAShU,SAAW,UACzCzJ,KAAMgC,QAKX9U,KAGFuiB,GAAiB,cAAC,GAAD,QCtGXwO,GAAqD,SAAC,GAA0B,IAAxBvP,EAAuB,EAAvBA,OAAQxhB,EAAe,EAAfA,SACnEgC,EAAYM,IAAZN,QADkF,EAGhE2J,GACxB,QACA6V,EAAOwP,UACHhvB,EAAQnG,KAAKm1B,UAAU5N,KAAKphB,EAAQnG,KAAM2lB,EAAOwP,WACjDhvB,EAAQnG,KAAKo1B,YAAY7N,KAAKphB,EAAQnG,KAAM2lB,EAAOyP,cAJlD5kB,EAHmF,oBAU1F,OAAO,cAAC,IAAD,CAAQhG,QAASgG,EAAjB,SAAmCrM,KCAtCslB,GAAO,SAAC,GAAD,IAAG+K,EAAH,EAAGA,UAAH,MAAuC,CAClDO,cAAeP,EACfQ,WAAYR,EAAUK,aASlB9K,GAAS,SAAChe,EAA0BC,GAAkD,IAIlF+oB,EAA8BhpB,EAA9BgpB,cAAeC,EAAejpB,EAAfipB,WAEvB,OAAQhpB,EAAOC,MACb,IAAK,WACH,OAAO,2BAAKF,GAAZ,IAAmBipB,WAAYt1B,WAAQC,KAAKqM,EAAOqe,YAErD,IAAK,SACH,OAAO,2BAAKte,GAAZ,IAAmBipB,WAAYD,EAAcF,aAE/C,IAAK,cAAgB,IAESQ,EACxBrpB,EADF2e,YAAe6J,UAGjB,GAAIa,EACF,MAAO,CACLN,cAAeM,EACfL,WAAYK,EAAazM,MAAMmM,EAAcrM,YAAYsM,KAMjE,OAAOjpB,GAGHupB,GAAoB,SAAC,GAAD,SAAGxX,aAOvByX,GAAkF,SAAC,GAGlF,IAAD,QAFJR,EAEI,EAFJA,cACApP,EACI,EADJA,OAEMwP,EAAS,UAAGxP,EAAOwP,iBAAV,aAAG,EAAkB5W,WAAWwR,OAAO,IAAK7W,IACrDkc,EAAW,UAAGzP,EAAOyP,mBAAV,aAAG,EAAoB7W,WAAWwR,OAAO,IAAK7W,IACzD8W,EAAc,UAAG+E,EAAc/E,eAAetP,eAAhC,aAAG,EAAsCnC,SAAS,GAAGwR,OAAO,QAC1E2E,EAAQ,UAAGK,EAAcL,SAAShU,eAA1B,aAAG,EAAgCnC,WAAWwR,OAAO,IAAK9W,IAExE,OAAI8b,EAAclO,SAAWsO,EAEzB,eAAC,GAAD,8BACkB,cAAC,GAAD,UAASA,IAD3B,OAOF,eAAC,GAAD,WACGA,GACC,uDACiB,cAAC,GAAD,UAASA,IAD1B,oBAIDC,GACC,4DACsB,cAAC,GAAD,UAASA,IAD/B,sBAIApF,GAAkB0E,IAClB,qCACG,IADH,eAEe,IACZ1E,GAAkB0E,EACjB,qCACE,cAAC,GAAD,UAAS1E,IADX,QACwC,cAAC,GAAD,UAAS0E,OAGjD,mCACE,cAAC,GAAD,iBAAS1E,QAAT,IAASA,IAAkB0E,SArBrC,QA+BSc,GAA2B,WAAO,IAAD,EAC1BC,EAA8BnB,KAAxCrnB,SADoC,EAEMoe,6BAAkBtB,GAAQN,IAFhC,0BAEnCsL,EAFmC,EAEnCA,cAAeC,EAFoB,EAEpBA,WAAc/nB,EAFM,KAGtC6Q,EAAcE,8BAAmBsX,IAEjC3P,EAASoP,EAAcrM,YAAYsM,GALG,EAMRrP,GAEhC,UAAAA,EAAOwP,iBAAP,eAAkBrP,GAAGhI,IACrB,MACEpc,EACA,eAAC,GAAD,uEAC4D,IAC1D,eAAC,GAAD,WACGikB,EAAOwP,UAAU3L,IAAI1L,GAAaS,WADrC,IACkDrF,MAHpD,QAQF,CAACyM,EAAQ,cAAC,GAAD,CAAiCoP,cAAeA,EAAepP,OAAQA,KAZhF,MAACjkB,OAAWA,GAP4B,mBAMrC4pB,EANqC,KAMxB/R,EANwB,KAqBtCmc,EAAiBX,EAAclO,QAErC,OACE,eAAC,GAAD,CAAevd,MAAO,UAAiByrB,gBAAeC,aAAY/nB,WAAlE,iBACGsM,QADH,IACGA,IACEmc,EACC,eAAC,GAAD,kCAAwCxc,GAAxC,2BAEA,eAAC,GAAD,yBAA+BA,GAA/B,mCAGJ,eAAC,IAAD,CAAM3O,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEA,QAAQ,SACRC,QAAS,kBAAMirB,EAA0B,CAAExpB,KAAM,qBAFnD,oBAOCqf,EACC,cAAC,GAAD,CAAsB3F,OAAQ2F,EAA9B,qBAEA,cAAC,IAAD,CAAQla,UAAQ,EAAhB,4BC1JGukB,GAAoB,WAAO,IAC9B1oB,EAAaqnB,KAAbrnB,SAER,OACE,eAAC,IAAD,WACE,cAAC,IAAD,sBACA,eAAC,IAAD,CAAKxD,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,eAAC,GAAD,CAAaJ,MAAK,6BAAwB4P,GAAxB,SAAlB,mBACSA,GADT,wDAIA,cAAC,IAAD,CAAM3O,QAAQ,iBAAd,SACE,cAAC,IAAD,CAAQC,QAAS,kBAAMyC,EAAS,CAAEhB,KAAM,oBAAxC,oCCdG2pB,GAAoB,WAG/B,OAFiBtB,KAATlF,MAGN,IAAK,SACH,OAAO,cAAC,GAAD,IAET,IAAK,YACH,OAAO,cAAC,GAAD,IAET,IAAK,OACH,OAAO,cAAC,GAAD,MCZAyG,GAAkB,WAC7B,OAAO,cAAC,GAAD,CAAavsB,MAAOmQ,GAAeH,KAAnC,SAA0CG,GAAeF,eCG3D,MAAMuc,GAAoD,EAAGC,WAAU5xB,cACxE4xB,EAAS7U,aAAexhB,WAAQs2B,SAAS9U,WAAmB,0CAAG/c,QAAH,IAAGA,IAAY4xB,IAG7E,qCACGr2B,WAAQs2B,SAAS9U,WAClB,cAAC1C,GAAD,CACE/T,KAAK,KACL2F,QAASqP,GAAsBlG,YAC/B7L,KAAM+R,GAAsB/R,OALhC,U,YCDJ,MACE8L,MADI,GAEJa,aAAc4b,GACd3b,eAHI,GAIJC,aAJI,GAKJP,oBALI,GAMJD,gBANI,IAOF2E,EAEEwX,GAAwB,IAC5B,aAAC,IAAD,CACEzsB,GAAI,CACFoB,UAAW,kBACXI,MAAO,OACP8C,GAAI,QACJ/C,GAAI,KAKJmrB,GAAcC,GAClBA,EAAO,EACH,UACS,IAATA,EACA,MACAC,WAAWD,EAAKE,QAAQ,IAAM,EAC7B,GAAEF,EAAKE,QAAQ,UAChBF,EAAO,IACP12B,WAAQs2B,SAAS9U,WAChB,GAAEkV,EAAKE,QAAQ,UAEhBC,GAAQ1e,GACZ2e,MAAM72B,KAAK62B,MAAM3e,IAAUvW,KAAI,CAACm1B,EAAGC,IAAQ,aAACR,GAAD,GAAkBQ,KAIlDC,GAAuB,KAClC,MAAM,MAAEC,EAAF,UAASC,GAAc1a,KAE7B,IAAK0a,EAAW,OAAO,KAEvB,MAAMC,EAAeF,EAAQA,EAAM/lB,QAAOkmB,GAAwB,YAAhBA,EAAKlzB,SAAwB,GACzEmzB,EAAWF,EAAa5lB,OAAS,EACvC,OACE,aAAC,IAAD,WACE,aAAC,IAAD,UACE,aAAC,IAAD,2BACgB,IACd,aAACsN,GAAD,CACE5Q,UAAU,OACVnD,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyBiP,GAAMD,qBAK9C,aAAC,IAAD,CAAK9P,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,WACIstB,GAAY,aAAC,GAAD,IACbA,GACC,aAAC,IAAD,CACEC,IAAI,WACJpf,QAAS,CA3BL,EA2Be,2BACnBpO,GAAI,CAAEM,WAAY,SAAUgO,aAAc,SAAUmf,aAAc,UAHpE,UAKE,aAAC,IAAD,CAAMztB,GAAI,CAAE4B,WAAY,QAAxB,UACG4qB,GAAY3c,KAAM,IACnB,aAACkF,GAAD,CACE/T,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyB0rB,GAAY1c,mBAGlD,aAAC,IAAD,CAAM9P,GAAI,CAAE4B,WAAY,QAAxB,UACGiP,GAAehB,KAAM,IACtB,aAACkF,GAAD,CACE/T,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyB+P,GAAef,mBAGrD,aAAC,IAAD,CAAM9P,GAAI,CAAE4B,WAAY,QAAxB,UACGkP,GAAajB,KAAM,IACpB,aAACkF,GAAD,CACE/T,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyBgQ,GAAahB,mBAGnD,aAAC,IAAD,CAAM9P,GAAI,CAAE4B,WAAY,QAAxB,UACG0O,GAAgBT,KAAM,IACvB,aAACkF,GAAD,CACE/T,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyBwP,GAAgBR,mBAGtD,aAAC,IAAD,CAAM9P,GAAI,CAAE4B,WAAY,QAAxB,UACG2O,GAAoBV,KAAM,IAC3B,aAACkF,GAAD,CACE/T,KAAK,KACL2F,QAAS,aAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyByP,GAAoBT,mBAGzDgd,GAAK,GAELO,EAAax1B,KAAI,CAACy1B,EAAML,KACvB,MAAMS,EAAgBhB,IACnBY,EAAKK,cAAcC,UAAY5U,KAAK6U,OAAS,IAAO,GAAK,GAAK,IAE3DC,EAAapB,IAChBY,EAAKS,WAAWH,UAAY5U,KAAK6U,OAAS,IAAO,GAAK,GAAK,IAE9D,OACE,aAAC,IAAMG,SAAP,WACE,aAAC,IAAD,WAAOV,EAAKW,QAAQtW,UAApB,WACA,aAAC,IAAD,WAAO2V,EAAKY,QAAQvW,UAApB,YACA,aAAC,IAAD,WAAO2V,EAAKa,YAAYxW,UAAxB,WACA,aAAC,IAAD,UACE,aAAC0U,GAAD,CAAkBC,SAAUoB,MAE9B,aAAC,IAAD,UACE,aAACrB,GAAD,CAAkBC,SAAUwB,MAE7BhB,GAAK,KAVaG,SAgB7B,aAAC,IAAD,CAAMnsB,QAAQ,iBAAiBwD,GAAI,EAAnC,SACE,aAAC,GAAD,CAAM9N,GAAG,iBAAiBoY,EAAG,EAAG3O,EAAG,EAAnC,SACE,aAAC,IAAD,CAAQa,QAAQ,UAAhB,oCCjIL,IAAMstB,GAAsB,kBACjC,eAAC,IAAD,CAAWttB,QAAQ,UAAnB,UACE,eAAC,IAAD,CAAWA,QAAQ,OAAnB,UACE,cAACosB,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,OAGF,eAAC,IAAD,CAAWpsB,QAAQ,QAAnB,UACE,cAAC6V,GAAD,IACA,cAAC,GAAD,WCdO0X,GAAiC,WAAO,IAEvCj1B,EACR4D,IADFtD,OAAUN,YAGZ,OACE,eAAC,IAAD,CACE4G,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBuO,EAAG,EACH3O,EAAG,EACHiO,SAAU,QAEV9D,OAAQ,EACRlK,aAAc,MACdM,YAAa,UACbsK,UAAW,GAbf,UAgBE,eAAC,IAAD,CAAM9K,GAAI,CAAEM,WAAY,SAAU6N,GAAI,EAAG5M,GAAI,GAA7C,UACE,cAAC,EAAD,CAAMtF,KAAK,uBAAuB+E,KAAK,OACvC,cAAC,IAAD,CAAShB,GAAI,CAAE4D,GAAI,EAAGhD,SAAU,QAAhC,4CAGF,eAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,GAA3B,oEACyD,4BAAI8O,GAAetW,KAAkB,IAD9F,0DCnBAk1B,GAAwE,SAAC,GAAsB,IAApB5X,EAAmB,EAAnBA,aAE5Dha,EACfM,IADFN,QAAWnG,KAGP+uB,EAAkB,oBAClBrD,EAAqB9b,GAAsBmf,GAEjD,MAAmC,uBAA5BrD,EAAmBzf,KACxB,eAAC,IAAD,CAAQmF,UAAQ,EAAhB,UACE,cAAC,IAAD,CAAS3H,GAAI,CAAEsB,GAAI,EAAG5B,MAAO,SAAWsB,KAAK,SAD/C,+BAI8B,2BAA5BihB,EAAmBzf,MACO,cAA5Byf,EAAmBzf,KACnB,cAACkE,GAAD,CAAahR,GAAI4vB,EAAiB/uB,KAAMmG,EAAQ6xB,iBAAiBzQ,KAAKphB,EAASga,GAA/E,SACE,cAAC,IAAD,yBAEA,MAGO8X,GAAiC,WAAO,IAC3CvzB,EAAY+B,IAAZ/B,QAD0C,EAGVE,mBAASlF,WAAQC,KAAK,KAHZ,mBAG3CwgB,EAH2C,KAG7B+X,EAH6B,OAI5BtzB,mBAASlF,WAAQC,KAAK,KAJM,mBAI3Cw4B,EAJ2C,KAItCC,EAJsC,OAKExzB,mBAAS,MALX,mBAK3CyzB,EAL2C,KAKvBC,EALuB,KAOlD,OACE,qCACE,eAAC,IAAD,WACE,cAAC,IAAD,qCAEA,cAAC,IAAD,CAAK7uB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,4BACA,cAAC,IAAD,CAAOa,QAAQ,OAAf,eAEA,cAAC,IAAD,CACEd,GAAI,CAAEkO,SAAU,SAChB1L,KAAK,SACLkZ,KAAK,MACLjlB,MAAOm4B,EACPhT,SAAU,SAAAtD,GACRuW,EAAsBvW,EAAEvU,OAAOtN,OAC/B,IACE,IAAMq4B,EAAkB74B,WAAQC,KAAKoiB,EAAEvU,OAAOtN,OAAS,GAAG0gB,IAAI,KACxD4X,EAAS94B,WAAQ+4B,IAAIjP,IAAI+O,GAE/BL,EAAgBK,GAChBH,EAAOI,GACP,YAEJlT,OAAQ,WACNgT,EAAsBnY,EAAac,IAAI,KAAKC,uBAOtD,eAAC,IAAD,CACEzX,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBuO,EAAG,EACHtK,GAAI,CAAC,EAAG,KAAM,GACd/C,GAAI,EACJtB,EAAG,EACHiO,SAAU,QAEV9D,OAAQ,EACRlK,aAAc,MACdM,YAAa,SACbsK,UAAW,GAff,UAkBE,eAAC,IAAD,CAAM9K,GAAI,CAAEM,WAAY,SAAU6N,GAAI,EAAGvN,SAAU,GAAnD,UACE,cAAC,EAAD,CAAM3E,KAAK,eACX,cAAC,IAAD,CAAS+D,GAAI,CAAE4D,GAAI,EAAGhD,SAAU,QAAhC,mCAGF,eAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,EAAG0D,GAAI,GAAlC,uCAC4B,4BAAIoL,GAAezU,KAD/C,cACwE,IACtE,8BAAIyzB,EAAIlX,IAAI,KAAKC,WAAjB,OAFF,wDAKA,cAAC,IAAD,CAAWzX,GAAI,CAAEY,SAAU,EAAG0D,GAAI,EAAG1C,WAAY,QAAjD,sFAIA,cAAC,IAAD,CAAW5B,GAAI,CAAEY,SAAU,EAAG0D,GAAI,GAAlC,kJAMF,cAAC,GAAD,CAAkCoS,qBCzG3BuY,GAA0E,SAAC,GAAD,IACrFC,EADqF,EACrFA,UADqF,OAGrF,qCACE,eAAC,IAAD,CACElvB,GAAI,CACFgK,QAAS,OACT3I,cAAe,SACfhB,eAAgB,eAEhBuO,EAAG,EACHtK,GAAI,EACJ/C,GAAI,EACJtB,EAAG,EACHiO,SAAU,QAEV9N,GAAI,2BACJV,MAAO,UAEP0K,OAAQ,EACRlK,aAAc,MACdM,YAAa,UACbsK,UAAW,GAlBf,UAqBE,eAAC,IAAD,CAAM9K,GAAI,CAAEM,WAAY,SAAU6N,GAAI,EAAG5M,GAAI,EAAGX,SAAU,GAA1D,UACE,cAAC,EAAD,CAAM3E,KAAK,UACX,cAAC,IAAD,CAAS+D,GAAI,CAAE4D,GAAI,EAAGhD,SAAU,GAAhC,yBAGF,cAAC,IAAD,CAAWZ,GAAI,CAAEY,SAAU,GAA3B,oEAGF,cAAC,IAAD,CAAQG,QAASmuB,EAAjB,iCC5BEC,GAAiB,SAAC,GAAD,SAAG1Y,UAEb2Y,GAAyB,WAAO,IAAD,EAItCpyB,IAFF/B,EAFwC,EAExCA,QACU7B,EAH8B,EAGxCM,OAAUN,YAGNqd,EAAWlC,8BAAmB4a,IAC9BE,EAAej2B,IAAgBC,KAAmC,iBAApBod,EAASrc,OAPnB,EASJe,oBAAS,GATL,mBASnCm0B,EATmC,KAStBC,EATsB,KAiB1C,OANA5zB,qBAAU,WACJ0zB,GACFE,GAAe,KAEhB,CAACF,IAEAC,GAAeD,EACO,eAApB5Y,EAASrc,OACJ,cAAC,GAAD,CAA6B80B,UAAW,kBAAMK,GAAe,MAC3Dt0B,IAAY7B,EACd,cAAC,GAAD,IAEA,cAAC,GAAD,IAGF,cAAC,GAAD,KCjCEo2B,GAA+B,WAAO,IAE9B9yB,EACfM,IADFN,QAAWnG,KAFmC,EAIkB4E,mBAAS,MAJ3B,mBAIzCs0B,EAJyC,KAIdC,EAJc,KAMhD,OACE,eAAC,IAAD,WACE,cAAC,IAAD,wBAEA,cAAC,IAAD,CAAK1vB,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CAAMD,GAAI,CAAEM,WAAY,WAAxB,UACE,cAAC,IAAD,oBAEA,cAAC,IAAD,CACEkC,KAAK,SACLmtB,IAAI,IACJjU,KAAK,IACLjlB,MAAOg5B,EACP7T,SAAU,SAAAtD,GAAC,OAAIoX,EAA6BpX,EAAEvU,OAAOtN,UAGvD,cAAC,IAAD,qBAEA,cAAC,IAAD,CAAMuJ,GAAI,CAAE4D,GAAI,EAAGtD,WAAY,UAA/B,SACE,cAACoG,GAAD,CACEhR,GAAG,kBACHiR,QAAQ,YACRC,iBAAiB,SACjBrQ,KAAM,SAAAnB,GACJ,IAAKq6B,EACH,MAAM,IAAIn5B,MAAM,kBAElB,OAAOoG,EAAQkzB,cAAcC,SAASJ,EAA2B,IAAKr6B,IAR1E,SAWE,cAAC,IAAD,CAAQ0L,QAAQ,aAAhB,SACE,cAAC,EAAD,CAAM7E,KAAK,QAAQ+E,KAAK,sB,qBCtC3B8uB,GAA4C,SAAC,GAAD,IAAGp1B,EAAH,EAAGA,SAAUq1B,EAAb,EAAaA,MAAUtX,EAAvB,2CACvD,eAAC,IAAD,yBAAK/X,GAAG,QAAW+X,GAAnB,cACE,cAAC,IAAD,CAAK/X,GAAG,OAAOV,GAAI,CAAEgK,QAAS,CAAC,OAAQ,UAAvC,SACGtP,IAGH,cAAC,IAAD,CAAKgG,GAAG,OAAOV,GAAI,CAAEgK,QAAS,CAAC,QAAS,SAAxC,SACG+lB,SCUDC,GAAY,OAEZC,GAA2B,SAAChQ,EAAkB9J,GAAnB,MAC/B,CAAC8J,EAAMH,8BAA8B3J,GAAQ,oCAEzC+Z,GAA6B,SACjCjQ,EACA9J,EACAga,EACA9Z,GAEA,IAAMgB,EAAkB4I,EAAM5I,gBAAgBlB,GAE9C,OAAIkB,EAAgB+Y,IAAI/R,8BAA6BhH,EAAgBuF,GAAGuT,GAC/D,CACLlQ,EAAMjJ,KAAKuF,IAAIlG,GACf,mEAGK4Z,GAAyBhQ,EAAO9J,IAQrCjC,GAAS,SAAC,GAAD,IACbgC,EADa,EACbA,eACAC,EAFa,EAEbA,MACAC,EAHa,EAGbA,MACAC,EAJa,EAIbA,oBACAga,EALa,EAKbA,SALa,MAMsB,CACnCna,iBACAC,QACAiJ,aAAchJ,EAAMwB,+BAA+BzB,GACnDga,qBAAsB/Z,EAAMiB,gBAAgBlB,GAC5CE,sBACAga,aAGWC,GAA0C,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAAe,EAQnEhc,8BAAmBL,IANrBmc,EAFqE,EAErEA,SACAna,EAHqE,EAGrEA,eACAkJ,EAJqE,EAIrEA,aACA+Q,EALqE,EAKrEA,qBACA9Z,EANqE,EAMrEA,oBACAF,EAPqE,EAOrEA,MAEMzZ,EAAYM,IAAZN,QAT+D,EAWzCvB,oBAAS,GAXgC,mBAWhEq1B,EAXgE,KAWvDC,EAXuD,OAY3Ct1B,qBAZ2C,mBAYhEu1B,EAZgE,KAYxDC,EAZwD,OAc3Cx1B,mBAAS,IAdkC,mBAchEy1B,EAdgE,KAcxDC,EAdwD,KAejEC,EAAcvqB,uBAAY,kBAAMsqB,EAAU,MAAK,IAfkB,EAiB/C11B,mBAAS,GAjBsC,mBAiBhE41B,EAjBgE,KAiB1DC,EAjB0D,KAkBjEC,EAAgBC,KAAKC,KAAKjb,EAAiBqa,IAAa,EACxDa,EAAcF,KAAKvB,IAAIoB,EAAME,EAAgB,GAcnDt1B,qBAAU,WACJo1B,IAASK,GACXJ,EAAQI,KAET,CAACL,EAAMK,IAEVz1B,qBAAU,WACR,IAAI01B,GAAU,EAoBd,OAlBAZ,GAAW,GAEX/zB,EACG40B,UACC,CACEC,MAAOhB,EACPiB,SAAU,2BACVC,WAAYL,EAAcb,GAE5B,CAAEF,aAEHz0B,MAAK,SAAA80B,GACAW,IACFV,EAAUD,GACVD,GAAW,OAIV,WACLY,GAAU,KAIX,CAAC30B,EAAS00B,EAAab,EAAUK,IAEpCj1B,qBAAU,WACRm1B,MACC,CAACA,EAAa5a,IArEsD,MAuE3C/a,qBAvE2C,mBAuEhEu2B,EAvEgE,KAuExDC,EAvEwD,KAyFvE,OAhBAh2B,qBAAU,WACR,QAAe1D,IAAXy5B,EAAsB,CACxB,IAAI7pB,GAAY,EAQhB,OANAvC,YAAW,WACJuC,GACH8pB,OAAU15B,KAEX,KAEI,WACL4P,GAAY,MAGf,CAAC6pB,IAGF,eAAC,IAAD,CAAM1xB,GAAI,CAAEwB,MAAO,QAAnB,UACE,eAAC,IAAD,WACE,cAAC,GAAD,CAAcuuB,MAAM,SAApB,0BAEA,eAAC,IAAD,CAAM/vB,GAAI,CAAEM,WAAY,UAAxB,UACsB,IAAnB4V,GACC,qCACE,eAAC,GAAD,CACE6Z,MAAK,eAAUqB,EAAc,EAAxB,cAA+BH,GACpCjxB,GAAI,CAAEsB,GAAI,CAAC,EAAG,GAAIM,WAAY,OAAQhB,SAAU,CAAC,EAAG,GAAI2O,cAAe,EAAE,EAAG,IAF9E,UAIG6hB,EAAcb,EAAW,EAJ5B,IAIgCW,KAAKvB,KAAKyB,EAAc,GAAKb,EAAUra,GAAiB,IAJxF,MAKMA,KAGN,cAAC,IAAD,CAAQpV,QAAQ,YAAYC,QA9EnB,WACfqwB,EAAc,GAChBJ,EAAQI,EAAc,IA4EqCzpB,SAAUypB,GAAe,EAA5E,SACE,cAAC,EAAD,CAAMn1B,KAAK,eAAe+E,KAAK,SAGjC,cAAC,IAAD,CACEF,QAAQ,YACRC,QA1FG,WACXqwB,EAAcH,EAAgB,GAChCD,EAAQI,EAAc,IAyFZzpB,SAAUypB,GAAeH,EAAgB,EAH3C,SAKE,cAAC,EAAD,CAAMh1B,KAAK,gBAAgB+E,KAAK,YAKtC,cAAC,IAAD,CACEF,QAAQ,YACRd,GAAI,CAAEqK,QAASmmB,EAAU,EAAI,EAAG5sB,GAAI,CAAC,EAAG,IACxC7C,QAAS+vB,EAHX,SAKE,cAAC,EAAD,CAAM70B,KAAK,OAAO+E,KAAK,eAK3B0vB,GAA4B,IAAlBA,EAAOjpB,OAOjB,cAAC,IAAD,CAAKzH,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,IAAD,CACES,GAAG,QACHV,GAAI,CACFsE,GAAI,EACJoB,GAAI,CAAC,EAAG,GACRlE,MAAO,OAEPb,UAAW,SACXkD,WAAY,MARhB,UAWE,qCACE,qBAAKvE,MAAO,CAAEkC,MAAO,UACrB,wBACA,wBACA,wBACA,qBAAKlC,MAAO,CAAEkC,MAAOwuB,SAGvB,gCACE,+BACE,uCACA,+BACE,cAAC,GAAD,CAAcD,MAAM,QAApB,wBACA,cAAC,IAAD,CAAK/vB,GAAI,CAAEY,SAAU,CAAC,EAAG,GAAIgB,WAAY,OAAQyI,QAAS,IAA1D,oBAEF,sCAEE,cAAC,IAAD,CAAKrK,GAAI,CAAEY,SAAU,CAAC,EAAG,GAAIgB,WAAY,OAAQyI,QAAS,IAA1D,SAAkEmF,QAEpE,uCAEE,uBAFF,WAKA,4BAIJ,gCACGkhB,EAAO74B,KACN,SAAAooB,GAAK,OACFA,EAAM7C,SAEL,+BACE,qBACE9d,MAAO,CACL0K,QAAS,OACT1J,WAAY,SACZH,OAAQ6vB,IAJZ,UAOE,cAAC9rB,GAAD,CAAStL,QAASqnB,EAAM2R,aAAcztB,UAAU,MAAhD,SACE,eAAC,IAAD,CACErD,QAAQ,UACRd,GAAI,CACFwB,MAAO,CAAC,OAAQ,SAChBqE,SAAU,SACVF,SAAU,YALd,UAQG+J,GAAeuQ,EAAM2R,cACtB,cAAC,IAAD,CACE5xB,GAAI,CACFgK,QAAS,CAAC,QAAS,QACnBrE,SAAU,WACV2F,IAAK,EACL2B,MAAO,EACPzL,MAAO,OACPrB,OAAQ,OACRyJ,WACE,mFAMV,cAAC,KAAD,CACED,KAAMsW,EAAM2R,aACZC,OAAQ,kBAAMF,EAAU1R,EAAM2R,eAFhC,SAIE,cAAC,IAAD,CAAQ9wB,QAAQ,OAAOd,GAAI,CAAEwB,MAAO,OAAQrB,OAAQ,QAApD,SACE,cAAC,EAAD,CACElE,KAAMy1B,IAAWzR,EAAM2R,aAAe,kBAAoB,YAC1D5wB,KAAK,cAKb,6BACE,cAAC,GAAD,CAAc+uB,MAAO9P,EAAMvI,WAAWC,UAAtC,SACGsI,EAAMvI,WAAW5C,SAAS,OAG/B,6BACE,cAAC,GAAD,CAAcib,MAAO9P,EAAMjJ,KAAKW,UAAhC,SACGsI,EAAMjJ,KAAKlC,eAGhB,8BACIuC,EAYC4I,EAAM5I,gBAAgBlB,GAXvB,cAAC,IAAD,CACEzW,MACE2X,EAAgBgF,GAAGC,8BACf,UACAjF,EAAgBgF,GAAG,KACnB,UACA,SANR,SASG,IAAInF,WAAQG,GAAiBvC,gBAIpC,6BACE,cAACpO,GAAD,CACEhR,GAAE,oBAAeuqB,EAAM2R,cACvBjrB,QAAQ,YACRG,SAAU,CACRsY,EACI8Q,GACEjQ,EACA9J,EACAga,EACA9Z,GAEF4Z,GAAyBhQ,EAAO9J,IAEtC5f,KAAMmG,EAAQnG,KAAKu7B,UAAUhU,KAAKphB,EAAQnG,KAAM0pB,EAAM2R,cAbxD,SAeE,cAAC,IAAD,CAAQ9wB,QAAQ,aAAhB,SACE,cAAC,EAAD,CAAM7E,KAAK,kBAvFVgkB,EAAM2R,cAwDT,IAAAva,YA3GlB,cAAC,IAAD,CAAKrX,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,cAAC,IAAD,CAAKD,GAAI,CAAEC,EAAG,EAAGW,SAAU,EAAGD,UAAW,UAAzC,SACI+vB,EAAwB,0BAAf,iBAoJhBF,GAAW,cAAC,GAAD,QCnVLuB,GAA4B,kBACvC,eAAC,IAAD,CAAWjxB,QAAQ,UAAnB,UACE,eAAC,IAAD,CAAWA,QAAQ,OAAnB,UACE,cAAC,IAAD,UACE,cAAC,IAAD,CAAKd,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,SACE,eAAC,GAAD,CAAaJ,MAAM,oBAAnB,UACE,cAAC,IAAD,iEACA,cAAC,IAAD,oIAON,cAAC,GAAD,OAGF,cAAC,IAAD,CAAWiB,QAAQ,QAAnB,SACE,cAAC6V,GAAD,MAEF,cAAC,GAAD,CAAa4Z,SAAU,S,kDCvBrByB,GAAS,CAAC,UAAW,UAAW,aAChC/oB,GAAS,CAAC,UAAW,UAAW,WAChCgpB,GAASf,KAAKgB,GAAK,IAEZC,GAAgB,WAAO,IAC1BC,EAAiB1f,KAAjB0f,aAER,QAAqBn6B,IAAjBm6B,EAA4B,OAAO,KAEvC,IAAMC,EAAoB,GAEpBC,EAAU,CACd1F,WAAWwF,EAAaG,SAASC,QAAQ/a,YACzCmV,WAAWwF,EAAaG,SAASE,QAAQhb,YACzCmV,WAAWwF,EAAaG,SAASG,UAAUjb,aAwB7C,OArBI2a,EAAaG,SAASC,UAAYv8B,WAAQorB,MAC5CgR,EAAkB9qB,KAAK,CACrBtL,KAAM,UACNxF,MAAO67B,EAAQ,KAIfF,EAAaG,SAASE,UAAYx8B,WAAQorB,MAC5CgR,EAAkB9qB,KAAK,CACrBtL,KAAM,UACNxF,MAAO67B,EAAQ,KAIfF,EAAaG,SAASG,YAAcz8B,WAAQorB,MAC9CgR,EAAkB9qB,KAAK,CACrBtL,KAAM,YACNxF,MAAO67B,EAAQ,KAKjB,cAACK,GAAA,EAAD,CAAqBnxB,MAAM,OAAOrB,OAAQ,IAA1C,SACE,eAACyyB,GAAA,EAAD,WACE,cAAC,KAAD,CAASC,mBAAmB,IAC5B,cAACC,GAAA,EAAD,CACEz7B,KAAMg7B,EACNU,QAAQ,QACRC,QAAQ,OACRC,GAAG,MACHC,GAAG,MACHC,YAAa,IACb9lB,MAAO,YAA4D,IAAzD4lB,EAAwD,EAAxDA,GAAIC,EAAoD,EAApDA,GAAIE,EAAgD,EAAhDA,SAAUC,EAAsC,EAAtCA,YAAaF,EAAyB,EAAzBA,YAAaG,EAAY,EAAZA,MAC9CC,EAASF,EAA4C,IAA7BF,EAAcE,GACtCnxB,EAAI+wB,EAAKM,EAASrC,KAAKsC,KAAKJ,EAAWnB,IACvC9vB,EAAI+wB,EAAKK,EAASrC,KAAKuC,KAAKL,EAAWnB,IAE7C,OACE,sBACErxB,SAAU,GACVgB,WAAY,IACZM,EAAO,MAAJA,EACHC,EAAO,KAAJA,EACHJ,KAAK,QACL2xB,WAAW,SACXC,iBAAiB,UAPnB,SASGrB,EAAQgB,GAAS,EAAItB,GAAOsB,GAAS,MAI5CT,mBAAmB,EACnBe,cAAc,OA3BhB,SA6BGvB,EAAkBx6B,KAAI,SAACm1B,EAAGsG,GAAJ,OACrB,cAACO,GAAA,EAAD,CAA6B9xB,KAAMkH,GAAOqqB,IAA1C,gBAAoBA,SAGxB,cAACR,GAAA,EAAD,CACEz7B,KAAMg7B,EACNU,QAAQ,QACRC,QAAQ,OACRC,GAAG,MACHC,GAAG,MACHG,YAAa,IACbF,YAAa,IACbN,mBAAmB,EACnBe,cAAc,OACdvmB,MAAO,YAA+B,IAA5BnL,EAA2B,EAA3BA,EAAGC,EAAwB,EAAxBA,EAAG2xB,EAAqB,EAArBA,QAASR,EAAY,EAAZA,MACvB,OAAMhB,EAAQgB,GAAS,EAErB,8BACE,wBACEI,WAAW,SACXT,GAAI/wB,EAAI,IAAU,IAAJA,EAAc,IAAJA,EACxBgxB,GAAI/wB,EAAI,IAAU,IAAJA,EAAc,IAAJA,EACxB4xB,EAAG,GACHhyB,KAAMkH,GAAOqqB,KAEf,sBACEpxB,EAAGA,EAAI,IAAU,IAAJA,EAAc,IAAJA,EACvBC,EAAGA,EAAI,IAAU,IAAJA,EAAc,IAAJA,EACvBvB,SAAU,KACVmB,KAAK,QACLH,WAAY,IACZ8xB,WAAW,SACXC,iBAAiB,UAPnB,oBASiB,IAAVG,GAAejH,QAAQ,GAT9B,UAV8B,MAwBpCmH,WAAW,EAnCb,SAqCG3B,EAAkBx6B,KAAI,SAACm1B,EAAGsG,GAAJ,OACrB,cAACO,GAAA,EAAD,CAA6B9xB,KAAMkH,GAAOqqB,IAA1C,gBAAoBA,eCpGhC,MAAMW,GAAgC,EAAGx9B,QAAO+W,UAE5C,qCACG/W,EADH,OAGG+W,GAAQ,cAAC,IAAD,CAAMxN,GAAI,CAAE4B,WAAY,QAAShB,SAAU,GAA3C,SAAiD4M,OAKnD0mB,GAAsC,KACjD,MAAM,MAAEC,EAAF,aAAS/B,GAAiB1f,KAEhC,YAAcza,IAAVk8B,QAAwCl8B,IAAjBm6B,EAAmC,KAG5D,eAAC,IAAD,CAAMtxB,QAAQ,OAAd,UACE,cAAC,IAAD,CAASd,GAAI,CAAEo0B,WAAY,QAA3B,wBAEA,cAAC,IAAD,CAAS1zB,GAAG,KAAKV,GAAI,CAAEsE,GAAI,EAAG1C,WAAY,QAA1C,mBAGA,cAACoT,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaiC,YAAYvf,SAAS,GAAItH,KAAK,WAE5D,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CACEx9B,MACE27B,EAAakC,UAAUC,MAAM7R,GAAGzsB,WAAQs2B,UACpC,MACC,GAAE6F,EAAakC,UAAUC,MAAMzf,SAC9B,QACKsd,EAAakC,UAAUE,MAAM1f,SAAS,KAEnDtH,KAAK,WAGT,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaqC,iCAAiC3f,SAAS,GAAItH,KAAK,WAEjF,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAasC,cAAc5f,SAAS,GAAItH,KAAK,WAE9D,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CACEx9B,MACE27B,EAAauC,UAAYvC,EAAawC,YAAYvY,GAAG,GACjD+V,EAAauC,SAASnd,IAAI,KAAK1C,SAAS,GACxC,MAENtH,KAAK,QAGT,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CACEx9B,WAC+BwB,KAAjB,OAAZm6B,QAAY,IAAZA,OAAA,EAAAA,EAAcyC,YAA2BzC,EAAayC,WAAW/f,SAAS,GAAK,MAEjFtH,KAAK,QAGT,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CACEx9B,MACE27B,EAAa0C,oBAAsB1C,EAAawC,YAAYvY,GAAG,GAC3D+V,EAAa0C,mBAAmBhgB,SAAS,GACzC,MAENtH,KAAK,QAGT,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAawC,YAAYjd,UAAWnK,KAAK,YAG1D,cAAC,IAAD,CAAS9M,GAAG,KAAKV,GAAI,CAAEsE,GAAI,EAAG1C,WAAY,QAA1C,wBAGA,cAACoT,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO09B,EAAM9G,aAAavY,SAAS,OAE7C,cAACE,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO09B,EAAMY,eAAejgB,SAAS,OAE/C,cAACE,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO09B,EAAMa,aAAalgB,SAAS,OAE7C,cAACE,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO09B,EAAMc,WAAWngB,SAAS,OAG3C,cAAC,IAAD,CAASpU,GAAG,KAAKV,GAAI,CAAEsE,GAAI,EAAG1C,WAAY,QAA1C,sBAGA,cAACoT,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaG,SAASC,QAAQ7a,UAAWnK,KAAK,WAE/D,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaG,SAASE,QAAQ9a,UAAWnK,KAAK,WAE/D,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaG,SAASG,UAAU/a,UAAWnK,KAAK,WAEjE,cAACwH,GAAD,CAAWC,QAASe,GAApB,SACE,cAACie,GAAD,CAAQx9B,MAAO27B,EAAaG,SAASnc,MAAMuB,UAAWnK,KAAK,WAG7D,cAAC,IAAD,CAAMlJ,GAAI,EAAV,SACE,cAAC,GAAD,U,0BCzHFksB,GAAU0E,aAAH,6FAWAC,GAA0C,SAAC,GAAe,IAAb71B,EAAY,EAAZA,MACxD,OACE,eAAC,IAAD,CACEU,GAAE,aACA2F,SAAU,WACVqJ,gBAAiB,qBACjBnJ,SAAU,SACV3F,aAAc,MACdC,OAAQ,OACRqB,MAAO,QACJlC,GARP,UAWE,cAAC,IAAD,CACEU,GAAI,CACF2F,SAAU,WACV0F,KAAM,OACNlL,OAAQ,OACRqB,MAAO,MACP4zB,gBACE,gJACFC,UAAU,GAAD,OAAK7E,GAAL,mBAnBf,WCXJ,MAAM8E,GAAY,UAEZC,GAAqB,CACzBp1B,OAAQ,OACRqB,MAAO,OACP2M,GAAI,OACJjO,aAAc,MACdkK,OAAQ,YACR5J,YAAa80B,GACb1rB,WAAY,OACZkE,OAAQ,GAEJ0nB,GAAmB,CACvBxmB,gBAAiB,OACjBxO,YAAa,QAETi1B,GAAyB,CAC7Bj0B,MAAO,MACP2M,GAAI,OACJ9D,QAAS,GAELqrB,GAAmB,CACvBv1B,OAAQ,EACRwa,SAAU,EACVvQ,OAAQ,EACR4E,gBAAiBsmB,GACjBK,OAAQ,EACRlrB,QAAS,GAGLmrB,GAAiB,CACrB5mB,gBAAiB,OACjB3E,QAAS,GAGLwrB,GAAgB,CAACC,EAAmBC,KAApB,CACpBnsB,WAAa,6BAA4BksB,MAAcC,OAOnDC,GAAgC,EAAG12B,WAChC,cAAC,IAAD,CAAKU,GAAI,IAAKu1B,MAAuBj2B,KAOxCwtB,GAA4B,EAAGxtB,WAC5B,cAAC,IAAD,CAAKU,GAAI,IAAK01B,MAAqBp2B,KAI/B22B,GAAe,IAAIjd,KAAK,QAuBxBkd,GAAoC,EAAG52B,QAAO5E,cACzD,cAAC,IAAD,CACEsF,GAAI,CACF4B,WAAY,IACZhB,SAAU,SACVu1B,UAAW,SACX91B,eAAgB,SAChBsa,SAAU,KACPrb,GAPP,SAUG5E,IAIQ07B,GAA8B,EAAG17B,WAAUoV,cAAaxQ,WAEjE,eAAC,IAAD,CACEU,GAAI,CACF4B,WAAY,IACZu0B,UAAW,SACX1I,aAAc,SACdntB,WAAY,YACThB,GANP,UASG5E,EATH,OAWGoV,EAAc,cAACiF,GAAD,CAAU/T,KAAK,KAAK2F,QAASmJ,IAAkB,QAK9DumB,GAAqD,EAAGhpB,WAE1D,eAAC,IAAD,CAAMrN,GAAI,CAAEqB,cAAe,SAAUsZ,SAAU,GAA/C,UACE,cAAC,IAAD,CAAM3a,GAAI,CAAEK,eAAgB,UAA5B,SACE,cAAC,GAAD,CAAaf,MAAO,CAAE6O,GAAI,WAE5B,eAAC,IAAD,CAAMnO,GAAI,CAAEs2B,GAAI,EAAGh2B,WAAY,UAA/B,UACE,cAAC,GAAD,CAAMhB,MAAOo2B,KACb,cAACM,GAAD,CAAQ12B,MAAOi2B,KACf,cAAC,GAAD,CAAMj2B,MAAOo2B,QAGf,cAAC,IAAD,CAAM11B,GAAI,CAAEqB,cAAe,UAA3B,SAAwCgM,OAIxCkpB,GAA8B,EAClCC,UACAC,SACAC,SACAC,OACAtpB,QACAupB,cACAC,eAAc,EACdC,gBAEA,GAAIA,EAAW,OAAO,cAACT,GAAD,CAAchpB,MAAOA,IAE3C,MAAM0pB,EAAUJ,EAAKK,wBAAyB,IAAIhe,MAAOge,qBACnDC,EAAgBN,EAAKO,iBAAmBjB,GAAaiB,eAE3D,IAAIC,EAAkC,IAAK5B,IACvC6B,EAAoC,IAAK1B,IACzC2B,EAAqC,IAAK3B,KAE1CgB,GAAUE,KACZO,EAAc,IAAK3B,IACnB4B,EAAgB,IAAKxB,KAGnBc,IACFW,EAAiB,IAAKzB,KAGnBiB,IACHM,EAAc,IAAK1B,KAGjBe,IACFY,EAAgB,IAAKA,KAAkBvB,GAAc,QAAS,UAG5DY,IACFY,EAAiB,IAAKA,KAAmBxB,GAAcP,GAAW,WAGpE,MAAMgC,EACJP,GAAWH,EACP,MACAK,EACA,UACAN,EAAKK,mBAAmB,QAAS,CAAEO,MAAO,QAASC,IAAK,UAAWC,KAAM,YAE/E,OACE,eAAC,IAAD,CAAMz3B,GAAI,CAAEqB,cAAe,SAAUsZ,SAAU,GAA/C,UACE,cAAC,IAAD,CAAM3a,GAAI,CAAEK,eAAgB,UAA5B,SACE,cAAC,IAAD,CAAML,GAAI,CAAE4B,WAAY,IAAKu0B,UAAW,UAAxC,SAAqDmB,MAEvD,eAAC,IAAD,CAAMt3B,GAAI,CAAEs2B,GAAI,EAAGh2B,WAAY,UAA/B,UACE,cAAC,GAAD,CAAMhB,MAAO83B,IACb,cAACpB,GAAD,CAAQ12B,MAAO63B,IACf,cAAC,GAAD,CAAM73B,MAAO+3B,OAGf,cAAC,IAAD,CAAMr3B,GAAI,CAAEqB,cAAe,UAA3B,SAAwCgM,QAUjCqqB,GAAwD,EAAGC,SAAQr4B,YAE9E,MAAMs4B,EAAgB,IAAID,GAAQE,MAAK,CAAC5+B,EAAGwpB,IACzCxpB,EAAE09B,KAAK/I,YAAcnL,EAAEkU,KAAK/I,UACxBkK,OAAO7+B,EAAE29B,aAAekB,OAAOrV,EAAEmU,aACjC39B,EAAE09B,KAAK/I,UAAYnL,EAAEkU,KAAK/I,UAC1B,GACC,IAGDmK,EAAeH,EAAcI,WAAUlc,GAASA,EAAM8a,cAE5D,OACE,cAAC,IAAD,CAAM52B,GAAI,CAAE2a,SAAU,KAAMrb,GAA5B,SACGs4B,EAAc//B,KAAI,CAACikB,EAAOmR,IACzB,cAACsJ,GAAD,CAEEC,QAAiB,IAARvJ,EACTwJ,OAAQxJ,IAAQ2K,EAAcnwB,OAAS,EACvCivB,OAAQzJ,EAAM8K,EACdpB,KAAM7a,EAAM6a,KACZtpB,MAAOyO,EAAMzO,MACbupB,YAAa9a,EAAM8a,YACnBC,YAAa/a,EAAM+a,YACnBC,UAAWhb,EAAMgb,WARZ7J,QC7MFgL,GAA+B,EAAGhjB,UAASxe,QAAO+L,OAAMlD,WAEjE,eAAC,IAAD,CAAMU,GAAI,CAAEqB,cAAe,YAAa/B,GAAxC,UACE,eAAC,IAAD,CAAMoB,GAAG,KAAKV,GAAI,CAAE4B,WAAY,MAAOtB,WAAY,WAAYD,eAAgB,UAA/E,UACG4U,EAAQpF,KADX,IACiB,cAACkF,GAAD,CAAU/T,KAAK,KAAK2F,QAASsO,EAAQnF,YAAa7L,KAAMgR,EAAQhR,UAEjF,eAAC,IAAD,CAAMvD,GAAG,KAAKV,GAAI,CAAEgK,QAAS,OAAQ3J,eAAgB,UAArD,UACG5J,EACC,cAAC,IAAD,CAAMuJ,GAAI,CAAE4B,WAAY,OAAxB,SAAkCnL,IAElC,cAAC,GAAD,CAAa6I,MAAO,CAAE6O,GAAI,SAJ9B,OAOG1X,GAAS,cAAC,IAAD,CAAMuJ,GAAI,CAAE4B,WAAY,QAASyI,QAAS,IAA1C,SAAkD7H,UCnBpE,IAMa01B,GAAkC,SAAC,GAAkC,IAAhCC,EAA+B,EAA/BA,OAA+B,IAAvBxwB,gBAAuB,WAC5B+K,KAA3CoP,EADuE,EACvEA,cAAesW,EADwD,EACxDA,wBAUjBnuB,EAAStC,EAAW,OAjBF,yKAmBxB,OACE,qCACE,cAAC,IAAD,CACEA,SAAUA,EACV7G,QAAQ,UACRd,GAAI,CAAEG,OAAQ,QACdb,MAAO,CACL2K,UAEFlJ,QAnB0B,WAC9B+gB,EAAc,sBAAuB,CAAEqW,YAWrC,SASG9mB,GAAYxB,OAEduoB,GACC,cAAC,KAAD,CACEh0B,aAAa,EACbD,UAAU,QACVE,QAAQ,+DACR6J,SAAS,QAJX,SAME,+BACE,cAAC,IAAD,CAAQvG,UAAU,EAAM7G,QAAQ,UAAUd,GAAI,CAAEG,OAAQ,QAAxD,SACGmR,GAAWzB,YAKlBuoB,GACA,cAAC,IAAD,CACEzwB,SAAUA,EACV7G,QAAQ,UACRd,GAAI,CAAEG,OAAQ,QACdb,MAAO,CACL2K,OAAQtC,EAAW,OAASsC,GAE9BlJ,QAzCuB,WAC7B+gB,EAAc,qBAAsB,CAAEqW,YAiClC,SASG7mB,GAAWzB,WCdf,MAAMwoB,GAAoC,CAC/CC,KAAM,CACJC,oBAAqB,WACrBC,oBAAqB,aACrBC,mBAAoB,WACpBC,aAAc,WACdC,yBAA0B,sBAE5BC,SAAU,CACRC,cAAe,OACfC,sBAAuB,OACvBC,aAAc,OACdC,gBAAiB,YAEnBC,SAAU,CACRJ,cAAe,OACfE,aAAc,OACdC,gBAAiB,WACjBE,qBAAsB,QAExBC,WAAY,CACVN,cAAe,OACfE,aAAc,OACdC,gBAAiB,aACjBI,sBAAuB,QAEzBC,SAAU,CACRR,cAAe,OACfE,aAAc,OACdO,gBAAiB,WACjBN,gBAAiB,WACjBO,eAAgB,QAElBC,mBAAoB,CAClBX,cAAe,OACfE,aAAc,OACdO,gBAAiB,qBACjBN,gBAAiB,qBACjBS,2BAA4B,SAIzB,IAAKC,I,SAAAA,O,iBAAAA,I,eAAAA,I,kCAAAA,Q,KChFZ,MAyEaC,GAA4B,EAAGrM,OAAMhuB,YAAa,IAAD,IAC5D,MAAMq4B,EA1EerK,KAAiC,IAAD,IACrD,MAAMqK,EAAS,CACb,CACEhB,KAAM,IAAI3d,KAAKsU,EAAKsM,WACpBvsB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAakG,GAAelG,YAAnC,SAAiDkG,GAAenG,OAChE,cAACqmB,GAAD,UAAY,mBAIlB,CACES,KAAM,IAAI3d,KAAqB,YAAhBsU,EAAKlzB,OAAuB4e,KAAK6U,MAAjC,iBAAyCP,QAAzC,IAAyCA,OAAzC,EAAyCA,EAAMuM,eAA/C,QAA0D,GACzExsB,MACE,qCACE,cAAC+oB,GAAD,CACEtmB,YACkB,YAAhBwd,EAAKlzB,OACD4b,GAAiBlG,YAChB,gBAAe8C,GAAS0a,EAAKlzB,QAAQ/D,2BAE5CiJ,MAAO,CAAEsC,WAAY,KANvB,SAQmB,YAAhB0rB,EAAKlzB,OAAuB4b,GAAiBnG,KAAO+C,GAAS0a,EAAKlzB,UAErE,cAAC87B,GAAD,CAAU52B,MAAO,CAAEsC,WAAY,KAA/B,SACmB,YAAhB0rB,EAAKlzB,OACD,GAAEkzB,EAAKY,QAAQpZ,SAAS,WACT,YAAhBwY,EAAKlzB,OACJ,GAAD,OAAGkzB,QAAH,IAAGA,GAAH,UAAGA,EAAMwM,qBAAT,aAAG,EAAqBhlB,SAAS,WACjC,QAIV8hB,aAAa,EACbC,YAA6B,YAAhBvJ,EAAKlzB,SAIU,IAAD,QA6B/B,MA7BoB,YAAhBkzB,EAAKlzB,SACPu9B,EAAOpwB,KAAK,CACVovB,KAAM,IAAI3d,KAAKsU,EAAKK,eACpBtgB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAakG,GAAkBlG,YAAtC,SAAoDkG,GAAkBnG,OACtE,cAACqmB,GAAD,UACE,eAAC7J,GAAD,CAAkBC,SAAQ,OAAEgB,QAAF,IAAEA,OAAF,EAAEA,EAAMyM,iBAAlC,2BACGzM,QADH,IACGA,GADH,UACGA,EAAMyM,wBADT,aACG,EAAwBjlB,SAAS,UADpC,QAC0C,IAD1C,mBAQR6iB,EAAOpwB,KAAK,CACVovB,KAAM,IAAI3d,KAAKsU,EAAKS,YACpB1gB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAakG,GAAsBlG,YAA1C,SAAwDkG,GAAsBnG,OAC9E,cAACqmB,GAAD,UACE,eAAC7J,GAAD,CAAkBC,SAAQ,OAAEgB,QAAF,IAAEA,OAAF,EAAEA,EAAM0M,cAAlC,2BACG1M,QADH,IACGA,GADH,UACGA,EAAM0M,qBADT,aACG,EAAqBllB,SAAS,UADjC,QACuC,IADvC,oBAQH6iB,GAMQsC,CAAc3M,IACvB,cAAExL,GAAkBpP,MACpB,iBAAEW,GAAqBU,KAM7B,OACE,eAAC,IAAD,CACE/T,GAAI,CACFK,eAAgB,SAChBC,WAAY,SACZktB,IAAK,UACFluB,GALP,UAQE,cAAC,IAAD,CACEU,GAAI,CACFkL,WAAY,EACZJ,UAAW,EACX5K,aAAc,IACdkK,OAAQ,EACR5J,YAAa,QACbJ,GAAI,cAPR,SAUE,cAAC,IAAD,CACEJ,GAAI,CAAEiK,OAAQ,UAAW4E,SAAU,SACnC6J,IAAK4U,EAAK4M,SACVC,IAAI,yCACJp5B,QAAS,KACPzE,OAAO89B,KACJ,qCAAoC/mB,KAAoBia,EAAK53B,KAC9D,eAKR,cAAC,IAAD,CAAM4O,GAAI,CAAC,EAAG,EAAG,EAAG,GAAItE,GAAI,CAAEE,aAAc,GAAIya,SAAU,GAA1D,SACE,eAAC,IAAD,CAAM1a,EAAG,CAAC,EAAG,GAAID,GAAI,CAAEqB,cAAe,UAAtC,UACE,cAACq2B,GAAD,CACEp4B,MAAO,CAAEsB,SAAU,SAAUP,eAAgB,SAAU+X,GAAI,EAAGjK,GAAI,GAClEwpB,OAAQA,IAGV,eAAC,IAAD,CAAMrzB,GAAI,EAAGoB,GAAI,EAAG5E,QAAQ,iBAAiBd,GAAI,CAAEK,eAAgB,YAAnE,UACE,eAAC,IAAD,CACEL,GAAI,CACFK,eAAgB,aAChBsa,SAAU,EACVra,WAAY,SACZktB,IAAK,SACL5sB,SAAU,UANd,UASE,cAACq3B,GAAD,CAAQhjB,QAASe,GAAgBvf,MAAO62B,EAAKW,QAAQnZ,SAAS,GAAItS,KAAK,SACtD,YAAhB8qB,EAAKlzB,QACJ,cAAC69B,GAAD,CACEhjB,QAASe,GACTvf,MAAK,iBAAE62B,QAAF,IAAEA,GAAF,UAAEA,EAAMa,mBAAR,aAAE,EAAmBrZ,SAAS,UAA9B,QAAoC,IACzCtS,KAAK,YAIM,YAAhB8qB,EAAKlzB,QAAwB,cAAC,GAAD,CAAS+9B,OAAQ7K,EAAK53B,KACnC,YAAhB43B,EAAKlzB,QAAwC,YAAhBkzB,EAAKlzB,QACjC,cAAC,IAAD,CAAQ0G,QAAQ,UAAUd,GAAI,CAAEG,OAAQ,QAAUY,QA/D/B,KAC7B+gB,EAAc,eAAgB,CAAEuY,WAAYX,GAAmBY,SA8DrD,oCCzFDC,GAAsC,EAAGjN,OAAMhuB,YAC1D,MAAMq4B,EAvDerK,IACd,CACL,CACEqJ,KAAM,IAAI3d,KAAKsU,EAAKsM,WACpBvsB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAY,yDAAnB,SACGkG,GAAenG,OAElB,cAACqmB,GAAD,UAAY,mBAIlB,CACES,KAAM,IAAI3d,KAAKA,KAAK6U,OACpBxgB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAakG,GAAiBlG,YAAaxQ,MAAO,CAAEsC,WAAY,KAAvE,SACGoU,GAAiBnG,OAEpB,cAACqmB,GAAD,CAAU52B,MAAO,CAAEsC,WAAY,UAGnCg1B,aAAa,GAEf,CACED,KAAMV,GACN5oB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAY,yEAAnB,SACGkG,GAAkBnG,OAErB,cAACqmB,GAAD,CAAU52B,MAAO,CAAEsC,WAAY,UAGnCk1B,WAAW,GAEb,CACEH,KAAMV,GACN5oB,MACE,qCACE,cAAC+oB,GAAD,CAAOtmB,YAAY,sHAAnB,SACGkG,GAAsBnG,OAEzB,cAACqmB,GAAD,CAAU52B,MAAO,CAAEsC,WAAY,UAGnCk1B,WAAW,IAQAmD,CAAc3M,GAE7B,OACE,eAAC,IAAD,CACEttB,GAAI,CACFK,eAAgB,SAChBC,WAAY,SACZktB,IAAK,UACFluB,GALP,UAQE,cAAC,IAAD,CAAMU,GAAI,CAAEwB,MAAO,IAAKrB,OAAQ,KAAhC,SACE,cAAC,GAAD,MAEF,cAAC,IAAD,CAAMmE,GAAI,CAAC,EAAG,EAAG,EAAG,GAAItE,GAAI,CAAEE,aAAc,GAAIya,SAAU,GAA1D,SACE,eAAC,IAAD,CAAM1a,EAAG,CAAC,EAAG,GAAID,GAAI,CAAEqB,cAAe,UAAtC,UACE,cAACq2B,GAAD,CACEp4B,MAAO,CAAEsB,SAAU,SAAUP,eAAgB,SAAU+X,GAAI,EAAGjK,GAAI,GAClEwpB,OAAQA,IAGV,eAAC,IAAD,CAAMrzB,GAAI,EAAGxD,QAAQ,iBAAiBd,GAAI,CAAEK,eAAgB,YAA5D,UACE,eAAC,IAAD,CACEL,GAAI,CACFK,eAAgB,aAChBsa,SAAU,EACVra,WAAY,SACZoF,GAAI,EACJ8nB,IAAK,SACL5sB,SAAU,UAPd,UAUE,cAACq3B,GAAD,CAAQhjB,QAASe,GAAgBvf,MAAO62B,EAAKW,QAAQnZ,SAAS,GAAItS,KAAK,SAEvE,cAACy1B,GAAD,CAAQhjB,QAASe,GAAgBxT,KAAK,YAExC,cAAC,GAAD,CAAS21B,OAAQ7K,EAAK53B,GAAIiS,UAAQ,gBC1FxC6yB,GAA4D,CAChEhI,QAAS,UACTiI,QAAS,UACT5yB,UAAW,aAQA6yB,GAAmB,KAC9B,MAAM,MAAEvN,EAAF,eAASwN,GAAmBjoB,MAC5B,WAAEkoB,GAAeC,eAEvB,QAAc5iC,IAAVk1B,EAAqB,OAAO,KAEhC,MACM2N,OAAwC7iC,IAAnB0iC,IADW,QAAfC,GAAuC,YAAfA,GAGzCG,EAA+B,QAAfH,EAAuBzN,EAdtB,EAACA,EAAmByN,IAC3CzN,EAAM/lB,QAAOkmB,GAAQA,EAAKlzB,SAAWogC,GAA0BI,KAaVI,CAAiB7N,EAAOyN,GAE7E,OACE,qCAGIE,GAAsB,cAACP,GAAD,CAAgBjN,KAAMqN,EAAgBr7B,MAAO,CAAEgF,GAAI,UAG1Ey2B,EAAcljC,KAAI,CAACy1B,EAAgBL,KAClC,MACM3tB,EAAQ,CAAEgF,GADQ,IAAR2oB,IAAc6N,EACA,OAAS,QACvC,OAAO,cAACnB,GAAD,CAAMrM,KAAMA,EAAgBhuB,MAAOA,GAAZ2tB,OAG9B6N,GAA+C,IAAzBC,EAActzB,QACpC,cAAC,IAAD,CAAKnD,GAAI,EAAT,SACE,eAAC,GAAD,iCACqC,QAAfs2B,EAAuBA,EAAa,KAD1D,kBCxCGK,GAAqB,KAChC,MAAM,MAAE9N,GAAUza,MACZ,IAAEnd,EAAF,KAAO2lC,GAASC,eAEtB,OACE,qCACGhO,GACC,eAAC,IAAD,CAAMzsB,GAAG,MAAM4D,GAAI,EAAnB,UACE,cAAC,GAAD,CAAM9N,GAAK,GAAEjB,QAAW0K,EAAG,EAA3B,iBAGA,cAAC,GAAD,CAAMzJ,GAAK,GAAEjB,YAAe0K,EAAG,EAA/B,qBAGA,cAAC,GAAD,CAAMzJ,GAAK,GAAEjB,YAAe0K,EAAG,EAA/B,qBAGA,cAAC,GAAD,CAAMzJ,GAAK,GAAEjB,cAAiB0K,EAAG,EAAjC,0BAMJ,eAAC,KAAD,WACE,cAAC,KAAD,CAAO4Y,OAAK,EAACqiB,KAAMA,EAAnB,SACE,cAAC,KAAD,CAAU1kC,GAAK,GAAE0kC,gBAEnB,cAAC,KAAD,CAAOA,KAAO,GAAEA,gBAAhB,SACE,cAACR,GAAD,aCxBGU,GAAiB,KAC5B,MAAM,QAAE1+B,GAAYM,KACd,sBAAEuW,GAA0BQ,MAE5B,cAAE+N,EAAF,MAAiBqL,EAAjB,kBAAwBkO,EAAxB,YAA2CjnB,EAA3C,UAAwDgZ,GAAc1a,MACrE4oB,EAAOC,GAAYpgC,qBAU1B,GARAQ,qBAAU,KACR,WACE,QAAkC1D,IAA9ByE,EAAQrB,WAAWmgC,aAAkCvjC,IAAVqjC,EAAqB,OACpE,MAAMpgC,QAAgBwB,EAAQrB,WAAWmgC,OAAOC,aAChDF,EAASrgC,IAHX,KAKC,CAACogC,EAAO5+B,EAAQrB,WAAWmgC,UAEzBpO,EAAW,OAAO,KAEvB,MAAMG,OAAqBt1B,IAAVk1B,GAAuBA,EAAM1lB,OAAS,EAEjDi0B,EAA2C,OAA1BnoB,IAAA,OAAkCa,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAasO,GAAG,IAUzE,OACE,qCACE,eAAC,IAAD,CAAM5hB,QAAQ,iBAAiBd,GAAI,CAAEsE,GAAI,EAAG/C,GAAI,GAAhD,UACE,cAAC,IAAD,CAAQT,QAAQ,UAAUC,QAXK,IAAM+gB,EAAc,4BAWnD,8BAIA,cAAC,IAAD,CAAQhhB,QAAQ,UAAUC,QAbF,IAC5B+gB,EAAc,eAAgB,CAAEuY,WAAYX,GAAmBhkB,OAY3D,uBAIA,cAAC,IAAD,CAAQ5U,QAAQ,UAAUC,QAdD,IAC7B+gB,EAAc,eAAgB,CAAEuY,WAAYX,GAAmBY,QAa3D,wBAICoB,GACC,cAAC,IAAD,CAAQ56B,QAASysB,EAAW,UAAY,UAAWxsB,QAAS,IAAMs6B,IAAlE,0BAKD9N,GACC,cAAC,IAAD,CAAQzsB,QAAQ,UAAUC,QAAS,IAAM+gB,EAAc,uBAAvD,qCAMFyL,GACA,eAAC,IAAD,WACE,cAAC,IAAD,UACE,eAAC,IAAD,WACGxd,GAAMF,KACP,cAACkF,GAAD,CACE5Q,UAAU,OACVnD,KAAK,KACL2F,QAAS,cAAC,IAAD,CAAM7F,QAAQ,UAAd,SAAyBiP,GAAMD,qBAI9C,eAAC,IAAD,CAAK9P,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,cAAC,GAAD,IAEA,cAAC,IAAD,CAAMa,QAAQ,iBAAiBwD,GAAI,EAAnC,SACE,cAAC,IAAD,CAAQxD,QAAQ,UAAUC,QAAS,IAAM+gB,EAAc,uBAAvD,iCAQPyL,GAAY,cAAC0N,GAAD,QCvFZ,IAAMU,GAAmB,WAAO,IAAD,EACoBjpB,KAAhDoP,EAD4B,EAC5BA,cAA6BwL,EADD,EACbsO,aAEjBC,EAA8C,YAHhB,EACOjpB,SAEFkpB,OAUzC,YAAa7jC,IAATq1B,EAA2B,KAG7B,qCACE,eAAC,GAAD,0CAC+B,IAC7B,eAAC,IAAD,CAAMttB,GAAI,CAAE4B,WAAY,QAAxB,UAAmC0rB,EAAKW,QAAQnZ,SAAS,GAAzD,WAFF,kBAE0F,IACxF,eAAC,IAAD,CAAM9U,GAAI,CAAE4B,WAAY,QAAxB,UAAmC0rB,EAAKY,QAAQvW,UAAhD,eAGF,eAAC,IAAD,CAAM7W,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAfL,WACxB+gB,EAAc,iBAc2Cna,SAAUk0B,EAA/D,kBAGA,eAAC,IAAD,CAAQ/6B,QAAQ,UAAUC,QAtBH,WAC3B+gB,EAAc,oBAqB+Cna,SAAUk0B,EAAnE,WACIA,GAA2B,+CAC5BA,GAA2B,cAAC,IAAD,CAAS76B,KAAK,OAAOhB,GAAI,CAAEN,MAAO,qBC7B3Dq8B,GAAkB,WAAO,IAAD,EACqBrpB,KAAhDoP,EAD2B,EAC3BA,cAA6BwL,EADF,EACZsO,aAEjBC,EAA6C,YAHhB,EACQjpB,SAEFopB,MAUzC,YAAa/jC,IAATq1B,EAA2B,KAG7B,qCACE,eAAC,GAAD,+BACmB,eAAC,IAAD,CAAMttB,GAAI,CAAE4B,WAAY,QAAxB,UAAmC0rB,EAAKY,QAAQpZ,SAAS,GAAzD,YAA0E,IAD7F,wBAEwB,IACtB,eAAC,IAAD,CAAM9U,GAAI,CAAE4B,WAAY,QAAxB,UAAmC0rB,EAAKW,QAAQnZ,SAAS,GAAzD,cAGF,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAfL,WACxB+gB,EAAc,iBAc2Cna,SAAUk0B,EAA/D,kBAGA,eAAC,IAAD,CAAQ/6B,QAAQ,UAAUC,QAtBH,WAC3B+gB,EAAc,oBAqB+Cna,SAAUk0B,EAAnE,WACIA,GAA2B,+CAC5BA,GAA2B,cAAC,IAAD,CAAS76B,KAAK,OAAOhB,GAAI,CAAEN,MAAO,qBC/BxE,MAAMu8B,GAAa,CACjB53B,QAAS,CACPiH,IAAK,MACLD,KAAM,MACN4B,MAAO,OACPrH,OAAQ,OACRs2B,YAAa,OACbC,UAAW,wBACXjuB,SAAU,QACV1M,MAAO,QACP46B,UAAW,OACXv2B,SAAU,WAEZwT,QAAS,CAAEvL,OAAQ,IAQRuuB,GAAmC,EAAG3hC,WAAUw0B,YAAW5vB,WAIpE,cAAC,IAAD,CACEg9B,QAAQ,EACRC,eALkB,IAAMrN,IAMxB5vB,MAAO,IACF28B,GACH53B,QAAS,IAAK43B,GAAW53B,WAAY/E,IALzC,SAQE,qBACEA,MAAO,CACLqG,SAAU,SACVuH,UAAW,SACXkvB,UAAW,QAJf,SAOG1hC,M,cCvCT,MAAM8hC,GAAgBC,GAA8B,IAAVA,EAEpCC,GAAWC,GAA6B/P,WAAW+P,EAAQllB,YAE3DmlB,GAAaC,GAAiCA,EAAUC,WAExDC,GAAcF,GAClB5mC,WAAQ+mC,oBAAoBH,EAAUI,eAElCC,GAAcC,GAAwC,IAAXA,EAE3CC,GAAiBX,GAA4BA,EAAU,GAAK,GAAK,GAUjEY,GAAY,CAACnP,EAAkBD,EAAkBoG,KACrD,MAAMiJ,EAAmBpP,EAAQ1W,IAAI6c,GACrC,OAAOzH,WAAW0Q,EAAiB7lB,YAAcmV,WAAWqB,EAAQxW,aAkBhE8lB,GAA2B,CAC/BC,EACAC,EACAC,KAEA,MAAMC,EAAmBF,EAAmBjmB,IAAIvhB,WAAQ+4B,IAAIjP,IAAI2d,IAChE,OAAIC,EAAiBphB,IAAItmB,WAAQ+4B,KAAa/4B,WAAQs2B,SAC/CiR,EAAmBrmB,IAAIwmB,EAAiB5d,IAAI9pB,WAAQ+4B,OAGvD4O,GAA8B,CAClCC,EACAC,EACAN,EACAO,EAAgB9nC,WAAQorB,QAExB,MAAM2c,EAAWF,EAAa/d,IAAIge,GAClC,OAAO9nC,WAAQ+4B,IAAI7X,IAAI0mB,GAAYrmB,IAAIwmB,EAAS7mB,IAAI6mB,EAAS3gC,IAAImgC,MAG7DS,GAAwB,CAC5BT,EACAC,EACAC,KAEA,MAAMC,EAAmB1nC,WAAQ+4B,IAAIjP,IAAI2d,GAAclmB,IAAIimB,GAC3D,GAAIE,EAAiBphB,IAAItmB,WAAQ+4B,KAAM,OAAO/4B,WAAQs2B,SACtD,MAAM2R,EAAOjoC,WAAQC,KAAKg7B,KAAKgN,KAAKtR,WAAW+Q,EAAiBlmB,cAC1D0mB,EAAWloC,WAAQ+4B,IAAI3xB,IAAI6gC,GAC3BE,EAAUT,EAAiB5d,IAAI9pB,WAAQ+4B,KAC7C,OAAOwO,EAAmBhmB,IAAI2mB,EAAShnB,IAAIinB,KAqDvCC,GAAoC,CACxCC,EACAC,EACAC,EACAC,KAEA,MAAMV,EAAgBX,GAAcV,GAAQ4B,IACtCI,EAAqChC,GAhCC,EAC5C8B,EACAD,KAEA,MAAMI,EAAeJ,EAAuBliB,GAAGmiB,GAC3CD,EAAuBxe,IAAIye,GAC3BvoC,WAAQorB,KACNud,EAAYxB,GAAcxQ,WAAW+R,EAAalnB,aACxD,OAAOxhB,WAAQC,KAAK0oC,IAyBlBC,CAAsCL,EAAyBD,IAE3DO,EAAiCpC,GAAQ+B,GAAiCV,EAEhF,GAAIe,EAAiCJ,EACnC,OAAOI,EAGT,MAAMC,EAAkB7N,KAAKp3B,IAAI,KAAQ4iC,GAAQ+B,GAC3CO,EAAiB,MAASjB,EAAgBW,GAUhD,QATwBO,sBAAYF,EAAkBC,GAGlC9N,KAAKp3B,IAAI,MAASikC,EAAgBW,IAE/BxN,KAAKp3B,IAAI,MAO5BolC,GAAmD,CACvDZ,EACAC,EACAC,EACAC,KAEA,MAAMU,EAAwCd,GAC5CC,EACAC,EACAC,EACAC,GAGF,OA7F2B9R,EA6FAwS,EA5FpB,IAAInmB,KAAKkY,KAAKkO,MAAMpmB,KAAK6U,MA9DNlB,IAAgC,GAAPA,EAAY,GAAK,GAAK,IA8DjC0S,CAAmB1S,KADhCA,OC9DhB2S,GAAsB,KACjC,MAAM,cAAExd,EAAF,KAAiB6D,EAAMiW,aAActO,GAAS5a,KAE9C6sB,EAAgB,KACpBzd,EAAc,kBAGhB,QAAa7pB,IAATq1B,EAAoB,OAAO,KAE/B,IAAI4K,EACJ,OAAQvS,GACN,IAAK,aACHuS,EAAU,aAAC,GAAD,IACV,MAEF,IAAK,WACHA,EAAU,aAAC,GAAD,IAKd,MAAMP,EAAsB,CAC1B,CACEhB,KAAM,IAAI3d,KAAKsU,EAAKsM,WACpBvsB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAelG,YAAnC,SAAiDkG,GAAenG,OAChE,aAACqmB,GAAD,UAAY,gBAIlB,CACES,KAAM,IAAI3d,KAAKsU,EAAKK,eACpBtgB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAkBlG,YAAtC,SAAoDkG,GAAkBnG,OACtE,aAACqmB,GAAD,UACE,aAAC7J,GAAD,CAAkBC,SAAUgB,EAAKyM,iBAAjC,UACGzM,EAAKyM,iBAAiBjlB,SAAS,GADlC,kBAOR,CACE6hB,KAAM,IAAI3d,KAAKsU,EAAKS,YACpB1gB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAsBlG,YAA1C,SAAwDkG,GAAsBnG,OAC9E,aAACqmB,GAAD,UACE,aAAC7J,GAAD,CAAkBC,SAAUgB,EAAK0M,cAAjC,UACG1M,EAAK0M,cAAcllB,SAAS,GAD/B,kBAOR,CACE6hB,KAAM,IAAI3d,KAAKA,KAAK6U,OACpBxgB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAiBlG,YAAaxQ,MAAO,CAAEsC,WAAY,KAAvE,SACGoU,GAAiBnG,OAEpB,aAACqmB,GAAD,CAAU52B,MAAO,CAAEsC,WAAY,KAA/B,SAAwC,GAAE0rB,EAAKY,QAAQpZ,SAAS,gBAGpE8hB,aAAa,EACbC,aAAa,IAIjB,OACE,aAACwF,GAAD,CAAYnN,UAAWqQ,EAAvB,UACE,aAAC,IAAD,CAAS7+B,GAAG,KAAKV,GAAI,CAAEoY,GAAI,EAAG3X,GAAI,EAAGI,GAAI,GAAzC,UACE,aAAC,IAAD,CAAMb,GAAI,CAAEK,eAAgB,UAA5B,SACY,eAATslB,EAAwB3P,GAAcnG,KAAOmG,GAAanG,OAE7D,aAAC,IAAD,CACE9O,QAASw+B,EACTv/B,GAAI,CACF2F,SAAU,WACVsH,MAAO,OACP3B,IAAK,aAIX,aAAC,IAAD,CAAMgrB,GAAI,EAAGnoB,GAAI,EAAGnO,GAAI,CAAEK,eAAgB,UAA1C,SACE,aAACq3B,GAAD,CAAoBC,OAAQA,MAE9B,aAAC,IAAD,CAAMnK,IAAI,OAAOpf,QAAS,EAAGpO,GAAI,CAAEs2B,GAAI,EAAGhoB,aAAc,UAAxD,UACE,aAAC2pB,GAAD,CAAQhjB,QAASe,GAAgBvf,MAAO62B,EAAKW,QAAQnZ,SAAS,GAAItS,KAAK,SAEvE,aAACy1B,GAAD,CAAQhjB,QAASe,GAAgBvf,MAAO62B,EAAKa,YAAYrZ,SAAS,GAAItS,KAAK,SAEjE,aAATmjB,GACC,aAACsS,GAAD,CAAQhjB,QAASe,GAAevf,MAAO62B,EAAKkS,eAAe3S,QAAQ,GAAIrqB,KAAK,YAGhF,kCACE,wBAASxC,GAAI,CAAE0F,GAAI,EAAGpB,GAAI,EAAG2F,OAAQ,WAArC,gCACA,aAAC,IAAD,CAAMujB,IAAI,OAAOpf,QAAS,EAAGpO,GAAI,CAAEs2B,GAAI,EAAGhoB,aAAc,UAAxD,UACE,aAAC2pB,GAAD,CACEhjB,QAASe,GACTvf,MAAO62B,EAAK0M,cAActX,GAAGzsB,WAAQs2B,UAAY,MAAQe,EAAKmS,aAAa5S,QAAQ,GACnFrqB,KAAK,SAGP,aAACy1B,GAAD,CACEhjB,QAASe,GACTvf,MACE62B,EAAK0M,cAActX,GAAGzsB,WAAQs2B,UAC1B,MACA2Q,GAAW5P,EAAKoS,WAAW7S,QAAQ,GAAK,MAIhD,aAACoL,GAAD,CACEhjB,QAASe,GACTvf,MACE62B,EAAK0M,cAActX,GAAGzsB,WAAQs2B,UAC1B,MACA2Q,GAAW5P,EAAKqS,WAAW9S,QAAQ,GAAK,YAMpD,aAAC,IAAD,CAAKvoB,GAAI,EAAT,UACY,aAATqhB,GAAuB2H,EAAKkS,eAAiB,GAC5C,aAAC,GAAD,4EAEQ,eAAT7Z,GAAyB2H,EAAKY,QAAQkC,IAAI9C,EAAKyM,mBAC9C,aAAC,GAAD,gFAIH7B,MC/IA,I,MAAM0H,GAAgBrlC,wBAAwC,MAExDslC,GAAY,WACvB,IAAMltB,EAAoCzV,qBAAW0iC,IAErD,OAAgB,OAAZjtB,EACK,CACLmtB,KAAM,KACNC,KAAM,KACNC,GAAI,MAIDrtB,GASIstB,GAAgD,SAAC,GAAsC,IAApCvlC,EAAmC,EAAnCA,SAAUqF,EAAyB,EAAzBA,SAAUmgC,EAAe,EAAfA,SAAe,EACzE/kC,mBAAiB,GADwD,mBAC1FugB,EAD0F,KACpFykB,EADoF,OAEnEhlC,mBAAmB,IAFgD,mBAE1FilC,EAF0F,KAEjFC,EAFiF,KAyB3FtlC,EAA8B,CAClC+kC,KAtBW,WACX,GAAIpkB,IAAShhB,EAAS+M,OAAS,GAAKy4B,EAAU,OAAOA,IACrD,IAAMI,EAAWpP,KAAKvB,IAAIj1B,EAAS+M,OAAS,EAAGiU,EAAO,GACtDykB,EAAQG,GACRD,EAAWD,EAAQ9Z,OAAO5K,KAmB1BqkB,KAhBW,WAAO,IAAD,EACjB,GAAa,IAATrkB,GAAc3b,EAAU,OAAOA,IACnC,IAAMwgC,EAAI,UAAGH,EAAQlpC,MAAMkpC,EAAQ34B,OAAS,GAAG,UAArC,QAA2C,EACrD04B,EAAQI,GACRF,EAAWD,EAAQlpC,MAAM,EAAGkpC,EAAQ34B,OAAS,KAa7Cu4B,GAVS,SAACQ,GACV,IAAMvT,EAAMvyB,EAASs9B,WAAU,SAAAyI,GAAK,OAAIA,EAAMj+B,KAAKvG,OAASukC,EAAUvkC,SACzD,IAATgxB,IACJkT,EAAQlT,GACRoT,EAAWD,EAAQ9Z,OAAO5K,OAS5B,OAAO,cAACkkB,GAAc7iC,SAAf,CAAwBtG,MAAOsE,EAA/B,SAA0CL,EAASghB,MC3D/CglB,GAAwC,SAAC,GAAsC,IAApChmC,EAAmC,EAAnCA,SAAUwlC,EAAyB,EAAzBA,SAAUngC,EAAe,EAAfA,SAC1E,OACE,cAAC,GAAD,CAAgBmgC,SAAUA,EAAUngC,SAAUA,EAA9C,SACGrF,KCGMimC,GAA0C,SAAC,GAAoC,IAAlCjmC,EAAiC,EAAjCA,SAAUw0B,EAAuB,EAAvBA,UAAW5vB,EAAY,EAAZA,MAG7E,OACE,cAAC+8B,GAAD,CAAYnN,UAHQ,kBAAMA,KAGY5vB,MAAOA,EAA7C,SACE,cAAC,GAAD,CAAQS,SAAUmvB,EAAlB,SAA8Bx0B,O,gDCiDpC,MAAMuW,GAA4B,CAAC,eAAgB,UAAW,YAAa,WAErE2vB,GAAyB,6CACzBC,GAAqB,6CACrBC,GAA+B,6CAI/BC,GAAiD,CACrD,CAACF,IAAqB,OACtB,6CAAqB,OAGjBG,GAA6BC,KAAU/qC,KAAK,KAW5CgrC,GAA6D,YACjEvtB,GAAQP,2BADyD,UAClC,GADkC,WAEjEO,GAAQT,yBAFyD,UAEpC,GAC7B0tB,GACAA,GACAC,IAGIM,GAAmB,IAAID,IAAkBE,UAMzCC,GAAYhH,GAAiE,CACjF,IACMA,IAAeX,GAAmBY,MAAQ4G,GAAmBC,GACjEG,aAAUjoC,YACVioC,aAAUjoC,YACVioC,aAAUjoC,YACVioC,aAAUjoC,aAEZ,CAgBEghC,IAAeX,GAAmBY,MAAQ,CAAC,EAAG,EAAG,GAAK,CAAC,EAAG,EAAG,GAC7DD,IAAeX,GAAmBY,MAAQ,CAAC,EAAG,EAAG,GAAK,CAAC,EAAG,EAAG,GAC7D,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,KAUX,IAAIiH,GAA8B,CAChCC,cAAUvpC,EACVwpC,mBAAexpC,EACfypC,mBAAezpC,GAwBjB,MAEM0pC,GAAkB7pC,UACtB,IAAK,IAAD,QACF,MAAM8pC,cACEtlC,OAAOjE,MAAM,8DACnBK,OAEImpC,oBACEvlC,OAAOjE,MAAM,2DACnBK,OAEIopC,EAAQ,UAAGF,EAAsBvqC,YAAzB,aAAG,EAA4ByqC,SAAS1rC,MAAK2rC,GAZzC,uBAYiDA,EAAKrsC,KAClEssC,EAAU,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAAUG,aAAa3hB,QAAO,CAAClK,EAAOmC,IAAYnC,EAAQmC,EAAQ2pB,KAAK,GACpFC,EAAO,OAAGN,QAAH,IAAGA,GAAH,UAAGA,EAA0BxqC,YAA7B,iBAAG,EAAgC+qC,mBAAnC,iBAAG,EAA6ChsC,MAC3D2rC,GAhH+B,+CAgHvBA,EAAKM,qBADF,aAAG,EAEbH,IAEH,QAAmBjqC,IAAf+pC,QAAwC/pC,IAAZkqC,EAAuB,OAEvD,MAAMG,GAAM,OAACN,QAAD,IAACA,IAAc,IAAf,OAAqBG,QAArB,IAAqBA,IAAW,GAE5CZ,GAAWG,cAAgBzrC,WAAQC,KAAKosC,GACxC,MAAO3pC,GACPkB,QAAQC,IAAI,0BACZD,QAAQlB,MAAMA,KAIZ4pC,GAAsBzqC,UAC1B,IAAK,IAAD,IACF,QAA4BG,IAAxBspC,GAAWC,SAAwB,OAEvC,MAAMgB,cACElmC,OAAOjE,MAAM,qDACnBK,OAEI+pC,EAAgBD,EAAcpsC,MAClCssC,IAAK,aAAS,OAALA,QAAK,IAALA,GAAA,UAAAA,EAAOC,aAAP,eAAcxtC,WAAYyrC,MAG/BgC,EAAqBJ,EAAcpsC,MACvCssC,IAAK,aAAS,OAALA,QAAK,IAALA,GAAA,UAAAA,EAAOC,aAAP,eAAcxtC,WAAY0rC,MAGrC,QACkC5oC,KAAnB,OAAbwqC,QAAa,IAAbA,GAAA,UAAAA,EAAeP,WAAf,eAAoBW,eACiB5qC,KAAnB,OAAlB2qC,QAAkB,IAAlBA,GAAA,UAAAA,EAAoBV,WAApB,eAAyBW,SAEzB,OAGFtB,GAAWC,SAAWvrC,WAAQC,KAAKusC,EAAcP,IAAIW,SACrDtB,GAAWE,cAAgBxrC,WAAQC,KAAK0sC,EAAmBV,IAAIW,SAC/D,MAAOlqC,GACPkB,QAAQC,IAAI,8BACZD,QAAQlB,MAAMA,KAiKLmqC,GAAmB,CAC9BzO,EACAwJ,EACAH,EACAF,KAEA,MAAMC,EAAqBpJ,EAAYld,IAAI0mB,GACrCkF,EAAmBtF,EAAmBjmB,IAAIvhB,WAAQ+4B,IAAIjP,IAAI2d,IAAerhB,GAAGpmB,WAAQ+4B,KAEpFgU,EAAwBzF,GAC5BC,EACAC,EACAC,GAEIuF,EAAqBhF,GACzBT,EACAC,EACAC,GAaF,MAAO,CACLD,qBACAsF,mBACAG,uBAd6BtF,GAC7BC,EACAmF,EACAxF,GAYA2F,oBAV0BvF,GAC1BC,EACAoF,EACAzF,GAQAwF,wBACAC,uBAIEG,GAAsBntC,WAAQ+4B,IAAI7X,IAAI,KAEtCksB,GAAmBvrC,UACvB,IAOE,aANmCwrC,GACjC5J,GAAmBY,MACnB8I,GACAG,IAG0BpsB,IAAIisB,IAChC,MAAOzqC,GACPkB,QAAQlB,MAAM,8DAA+DA,GAG/E,OAAO1C,WAAQ+4B,IAAI7X,IAAI4lB,SAAiBwG,EAASC,kBAG7CC,GAA0B3rC,UAC9B,IAOE,aANmC4rC,GACjChK,GAAmBY,MACnB8I,GACAG,IAG0BpsB,IAAIisB,IAChC,MAAOzqC,GACPkB,QAAQlB,MAAM,gEAAiEA,GAGjF,MAAMgrC,EAAe,IAAIC,YACvBhD,GACA,CACE,kGAEF2C,EAASxoC,WAGJ8oC,EAAaC,SAA8BnsC,QAAQC,IAAI,CAC5D2rC,EAASC,eAAe5nC,KAAKmhC,IAC7B4G,EAAaI,uBAAuBX,GAAoB1sC,IAAK,GAAckF,KAAKmhC,MAGlF,OAAO+G,EAAqB3sB,IAAIisB,IAAqBjsB,IAAI0sB,IAuKrDG,GAAY,CAACC,EAAsBC,IACtC,IAAIN,YACHK,EACA,CACE,mEACA,4EACA,qDACA,iDAEFC,GAiOEC,GAAiBC,GACrBA,IAAc1K,GAAmBY,MAAQZ,GAAmBhkB,KAAOgkB,GAAmBY,MAElFgJ,GAAwBxrC,MAC5BuiC,EACAgK,EACAd,IAEAxG,SAAiBwG,EAASe,OAAOjK,EAAY8J,GAAc9J,GAAagK,EAAY3tC,MAEhFgtC,GAA+B5rC,MACnCuiC,EACAgK,EACAd,KAEA,MAAMgB,QAAwBhB,EAASiB,SAAS,GAE1CC,EAAaxuC,WAAQC,KAAK,GAAGihB,IAAI,MACvC,GAAIotB,EAAgB7hB,GAAG,GAAI,OAAO2hB,EAAYltB,IAAIstB,GAElD,MAAMC,EAAQC,+BAA4BC,QAAQ9D,GAA8ByC,EAAS/H,QAEzF,OAAOuB,SACC2H,EAAM,qEACPrD,GAAShH,GACZgK,EAAY3tC,OA8ULmuC,GAAM,CACjBC,gBA1+BsBhtC,MACtBmD,EACA8pC,EACAC,EACA5S,KAEA,IACE,MAAM,YACJiC,EADI,mBAEJmJ,EAFI,mBAGJC,EAHI,aAIJC,EAJI,WAKJG,EALI,oBAMJoH,EANI,eAOJC,GACE9S,EAEE6C,SAAoB8P,EAAQI,UAAUlqC,IAAU6hC,WAEhDsI,EAAiBrY,MAAM72B,KAAK62B,MAAMkI,IAAap9B,KAAI,CAACm1B,EAAGsG,IAC3DyR,EAAQM,oBAAoBpqC,EAASq4B,KAGjCgS,QAAgB3tC,QAAQC,IAAIwtC,GAE5BG,EAAe,CACnBC,SAAUF,EAAQztC,KAAIsgC,GAAU4M,EAAQU,cAActN,KACtDuN,SAAUJ,EAAQztC,KAAIsgC,GAAU6M,EAAmBW,iBAAiBxN,KACpEyN,WAAYN,EAAQztC,KAAIsgC,GAAU4M,EAAQc,iBAAiB1N,KAC3D2N,SAAUR,EAAQztC,KAAIsgC,GAAU4M,EAAQgB,eAAe5N,KACvDvlB,SAAU0yB,EAAQztC,KAAIsgC,GAAU4M,EAAQiB,cAAc7N,KACtD8N,UAAWX,EAAQztC,KAAIsgC,GAAU4M,EAAQmB,SAAS/N,KAClDgO,eAAgBb,EAAQztC,KAAIsgC,GAAU4M,EAAQqB,oBAAoBjO,MAG9DkO,QAAqB1uC,QAAQC,IAAI2tC,EAAaC,UAC9Cc,QAAqB3uC,QAAQC,IAAI2tC,EAAaG,UAC9Ca,QAAuB5uC,QAAQC,IAAI2tC,EAAaK,YAChDY,QAAqB7uC,QAAQC,IAAI2tC,EAAaO,UAC9CW,QAAqB9uC,QAAQC,IAAI2tC,EAAa3yB,UAC9C8zB,QAAsB/uC,QAAQC,IAAI2tC,EAAaU,WAC/CU,QAA2BhvC,QAAQC,IAAI2tC,EAAaY,gBA6G1D,OA3Gcb,EACXhlB,QAAe,CAACsmB,EAAa5Z,EAAGC,KAC/B,MAAMv3B,EAAKknC,GAAU0I,EAAQrY,IAAMxV,WAC7BwW,EAAU8O,GAAWsJ,EAAapZ,IAClCiB,EAAU6O,GAAWuJ,EAAarZ,IAClC2M,EAAY4C,GAAaI,GAAU2J,EAAetZ,KAClD4M,EAAU2C,GAAaI,GAAU4J,EAAavZ,KAC9C7yB,EAAS6W,GAAYw1B,EAAaxZ,IAClCiN,ELrPO2M,KAAqC,IAAD,EAEvD,MAAMC,EAAiBD,EAAgBE,QAAQ,WAAa,UAAUt/B,OACtE,IAAwB,IAApBq/B,EAAuB,MAAO,QAElC,MAAME,EAAOC,KAAKJ,EAAgB3vC,MAAM4vC,IACrCI,QAAS,sBAAuB,wBAChCA,QAAQ,KAAM,KAGjB,OADiBF,EAAI,UAAG1vC,KAAKC,MAAMyvC,UAAd,aAAG,EAAkBG,MAV1C,sgGKsPuBC,CAAYV,EAAczZ,IACrC8Q,ELnQYnE,IACxBwD,IAAepkB,KAAK6U,MAAQ+L,GAAa,KKkQbyN,CAAiBzN,GACjCqJ,EAAqBhF,GACzBT,EACAC,EACAC,GAEIY,EAAmBroC,WAAQC,KAAK8iB,KAAK6U,MAAQ+L,GAAWziB,IAAI,KAC5DmwB,EAAsBjJ,GAC1BC,EACA2G,EACAC,EACAjC,GAGID,EAAwBzF,GAC5BC,EACAC,EACAC,GAEI6J,EAAyBlJ,GAC7BC,EACA2G,EACAC,EACAlC,GAGIwE,EAA2BvxC,WAAQ+4B,IAAIjP,IAAI2d,GAAclmB,IAAIyW,GAC7D+L,EACJiJ,IAAuBhtC,WAAQs2B,SAC3Bt2B,WAAQs2B,SACRqR,GAA4BC,EAAYoF,EAAoBzF,GAAoBhmB,IAC9EgwB,GAGFzN,EACJiJ,IAA0B/sC,WAAQs2B,SAC9Bt2B,WAAQs2B,SACRqR,GAA4BC,EAAYmF,EAAuBxF,GAAoBhmB,IACjFgwB,GAGF7Z,EACJqV,IAA0B/sC,WAAQs2B,SAC9B0J,GACAiJ,GACEZ,EACA2G,EACAC,EACAlC,GAGFjV,EACJkV,IAAuBhtC,WAAQs2B,SAC3B0J,GACAiJ,GACEZ,EACA2G,EACAC,EACAjC,GAGF9U,EAAc4O,GAAWuJ,EAAarZ,IAAMzV,IAAI6c,GAGhDmL,EAAiBtR,EAAQnN,OAAS,EAAIsc,GAAUnP,EAASD,EAASoG,GAClEoL,EAAevR,EAAQnN,OAAS,EAAIsc,GAAUrD,EAAe/L,EAASoG,GACtEqL,EAAYD,EAAe/C,GAAQzO,GAIzC,MAAO,IACF2Y,EACH,CACElxC,KACAu4B,UACAC,UACA0L,YACAC,UACAz/B,SACA8/B,WACAH,mBACAC,gBACArM,gBACAI,aACAI,cACAsR,eACAD,iBACAE,YACAC,UArBcD,GAAa,KAAO3B,EAAgBuJ,IAsBlDxN,cArBkB7jC,WAAQC,KAAK0mC,GAAU+J,EAAmB1Z,KAsB5D8Q,gBACAuJ,sBACAC,6BAGH,IACF1P,MAAK,CAAC5+B,EAAGwpB,IAAOxpB,EAAE2gC,UAAYnX,EAAEmX,WAAa,EAAI3gC,EAAE2gC,UAAYnX,EAAEmX,UAAY,EAAI,IAGpF,MAAOjhC,GACPkB,QAAQlB,MAAMA,GAEhB,MAAO,IAi1BP8uC,SAhnBe3vC,UACf,MAAOu1B,EAAc0H,EAAgBC,SAAsBr9B,QAAQC,IAAI,CACrEotC,EAAmB0C,mBACnB1C,EAAmB2C,kBACnB3C,EAAmB4C,mBAGf3S,EAAa5H,EAAahwB,IAAI03B,GAAgB13B,IAAI23B,GAExD,MAAO,CACL3H,aAAcp3B,WAAQC,KAAKm3B,EAAa5V,YACxCsd,eAAgB9+B,WAAQC,KAAK6+B,EAAetd,YAC5Cud,aAAc/+B,WAAQC,KAAK8+B,EAAavd,YACxCwd,WAAYh/B,WAAQC,KAAK++B,EAAWxd,cAomBtCusB,aACA6D,WAzkBiB/vC,UAAA,aACjBksC,SAAgBjC,EAAKY,QAAZ,UAAqBZ,EAAKvG,cAA1B,QAAoCuG,EAAKhnC,WAykBlD+sC,gBAvkBsBhwC,MAAOmD,EAAiB0nC,IACvC5F,SAAiB4F,EAAMwC,UAAUlqC,IAukBxC8sC,oBApkB0BjwC,SACnBilC,SAAiB4F,EAAMqF,eAokB9BC,gBA5vBsBnwC,MACtBowC,EACA3E,EACAyB,EACAmD,KAGA,MAAMC,EAAsBpD,EAAmBqD,kBAAkBzsC,KAAKmhC,KAGpEnI,EACAP,EACAiU,EACAC,EACAC,EACAC,EACA/K,EACAF,EACAyH,EACAyD,SACQ/wC,QAAQC,IAAI,CACpBswC,EAAWF,cAAcpsC,KAAKmhC,IAC9BoL,EAAY1E,GAAwBF,GAAYF,GAAiBE,GACjEyB,EAAmB2D,cAAc/sC,MAAKgtC,GAAUA,EAAO/wC,IAAIklC,MAC3DiI,EAAmB6D,mBAAmBjtC,KAAKmhC,IAC3CiI,EAAmB8D,sBAAsBltC,KAAKmhC,IAC9CiI,EAAmB+D,yBAAyBntC,KAAKmhC,IACjDiI,EAAmBgE,qBAAqBptC,KAAKmhC,IAC7CiI,EAAmBiE,8BAA8BrtC,MAAKqE,GAAK88B,GAAW98B,GAAGkX,IAAI,SAC7E6tB,EAAmBkE,0BAA0BttC,MAAKutC,GAAKlzC,WAAQC,KAAKizC,EAAE1xB,cACtEutB,EAAmB0D,0BAA0B9sC,KAAKmhC,MAG9CqM,QAAqBhB,EAErB7V,EAAW,CACfC,QAAS8V,EAAU,GACnB7V,QAAS6V,EAAU,GACnB5V,UAAW4V,EAAU,GACrBlyB,MAAOkyB,EAAU,GAAGjrC,IAAIirC,EAAU,IAAIjrC,IAAIirC,EAAU,KAGhDe,OACoBpxC,IAAxBspC,GAAWC,eACkBvpC,IAA7BspC,GAAWE,oBACkBxpC,IAA7BspC,GAAWG,cACP,CAACa,KAAuBZ,MACxB,KAEA2H,EAA8B/W,EAASC,QAAQn1B,IAAIkrC,GAEnD1K,EAAajJ,EAAY7T,OAAS9qB,WAAQ+4B,IAAMyZ,EAEhDhU,EAAmCG,EAAY7T,OACjD9qB,WAAQ+4B,IL1bQ,EACpBoa,EACAG,EACAC,EACAC,EACA7U,IAEOwU,EAAa/rC,IAAIksC,GAAkBxpB,IAAIypB,GAAazpB,IAAI0pB,GAAetyB,IAAIyd,GKob9E8U,CACEN,EACAZ,EACAjW,EAASC,QACTD,EAASG,UACTkC,GAGAsQ,ELzb2B,EACjCwD,EACAiB,KAEA,MAAMC,EACgF,IAApF1Y,KAAKkO,MAAMxS,WAAW8b,EAAwBvxB,IAAIwyB,GAAmBlyB,aAGvE,OAFgCxhB,WAAQC,KAAK8iB,KAAK6U,MAAQ+b,GAAoBzyB,IAAI,MKmb3D0yB,CAA2BnB,EAAyBnW,EAASC,SAEpF,IAAIsC,EACAH,EACAE,EAA6B0M,GAAWG,cAE5C,MAAMpN,EAAY,CAChBC,MAAOhC,EAASnc,MAAM2J,IAAIwS,EAASC,SAASrb,IAAIyd,GAChDJ,MAAOjC,EAASnc,MAAMe,IAAIyd,KAGtB,mBACJ6I,EADI,iBAEJsF,EAFI,uBAGJG,EAHI,oBAIJC,EAJI,sBAKJH,EALI,mBAMJC,GACEH,GAAiBzO,EAAawJ,EAAYH,EAAcF,GAEtDsM,EAAuBzV,EAEvBK,EAAgBnC,EAASE,QAAQp1B,IAAIk1B,EAASG,WAAWvb,IAAIyd,GAKnE,GAFIyU,SAA0B1xC,QAAQC,IAAIyxC,QAGhBpxC,IAAxBspC,GAAWC,eACkBvpC,IAA7BspC,GAAWE,eACXlP,EAASE,QAAQpW,GAAG,GACpB,CACA,MAAM0tB,EAA6BxI,GAAWE,cAAcjqB,IAAI8xB,GAC1DU,EAAqBzI,GAAWC,SAAShqB,IAAIgxB,GACnD7T,EAAWoV,EAA2B1sC,IAAI2sC,GAAoB7yB,IAAIob,EAASE,SAC3EqC,EAAqBH,EAASxd,IAAIoqB,GAAWE,eAE7CnN,EAAUC,MAAQ+U,EACfvpB,IAAIwS,EAASC,SACbn1B,IAAImrC,EAAoBhxB,IAAI+pB,GAAWC,SAASrqB,IAAIoqB,GAAWE,iBAC/DtqB,IAAIyd,GAEPN,EAAUE,MAAQ8U,EACfjsC,IAAImrC,EAAoBhxB,IAAI+pB,GAAWC,SAASrqB,IAAIoqB,GAAWE,iBAC/DtqB,IAAIyd,GAGT,MAAO,CACLA,cACAP,cACA9B,WACA+B,YACAuJ,aACAH,eACAF,qBACAC,qBACAsF,mBACAG,yBACAC,sBACAH,wBACAC,qBACA6G,uBACAhV,qBACAH,WACAE,aACAoQ,sBACAC,iBACAzQ,mCACAC,kBA0nBFuV,WAlkBiBnyC,MACjBoyC,EACAC,EACAC,EACAC,EACArF,EACAxJ,KACqC,IAAD,MACpC,QAA2BvjC,IAAvB+sC,QAAkD/sC,IAAdoyC,EACtC,MAAM,IAAI/zC,MAAM,6CAGlB,MACMg0C,EAAUtF,EAAmB7vC,QAC7Bo1C,EAAWrZ,KAAKkO,MAAMpmB,KAAK6U,MAAQ,KAFV,IAGzB91B,SAAesyC,EAAUG,OAAOL,IAAQrN,WACxC2N,EAAS,CACbxuC,WAAYouC,EAAUpuC,OACtBzE,QAAS,IACT0D,cAAesgC,EAAOC,aACtBiP,kBAAmBN,GAWfxxC,EAAU,CACduxC,QACAG,UACA7zC,MAAOyzC,EAAWxzC,IAClBqB,QACAwyC,YAIII,QAAkBnP,EAAOoP,eAAeH,EAlBhC,CACZI,OAAQ,CACN,CAAE5uC,KAAM,QAASuG,KAAM,WACvB,CAAEvG,KAAM,UAAWuG,KAAM,WACzB,CAAEvG,KAAM,QAASuG,KAAM,WACvB,CAAEvG,KAAM,QAASuG,KAAM,WACvB,CAAEvG,KAAM,WAAYuG,KAAM,aAY+B5J,IAEvD,EAAEkyC,EAAF,EAAK/W,EAAL,EAAQgX,GAAMC,0BAAeL,GAE7BM,QAAoBjG,EAAmBkG,YAAYC,qBACvDhB,EACAD,EAAWxzC,IACX6zC,EACAO,EACA/W,EACAgX,GAGI5iC,cACE68B,EAAmBmG,qBAAqBhB,EAAOD,EAAWxzC,IAAK6zC,EAAUO,EAAG/W,EAAGgX,EAAG,CACtF5yC,SAAU8yC,EAAY5tC,IAAI2jC,OAE5BoK,OAEFvxC,QAAQC,IACN,cADF,OAEEqO,QAFF,IAEEA,OAFF,EAEEA,EAASwvB,OAFX,OAGExvB,QAHF,IAGEA,GAHF,UAGEA,EAASwvB,cAHX,aAGE,EAAiB9/B,KAAIwzC,GAAKA,EAAEvvB,QAH9B,OAIE3T,QAJF,IAIEA,GAJF,UAIEA,EAASwvB,cAJX,aAIE,EAAiBvhC,MAAKkiB,GAAiB,gBAAZA,EAAEwD,SAE/B,MAAMwvB,EAAY,OAAGnjC,QAAH,IAAGA,GAAH,UAAGA,EAASwvB,cAAZ,aAAG,EAAiBvhC,MACpCkiB,GAAiB,gBAAZA,EAAEwD,QAGT,QAAqB7jB,IAAjBqzC,EACF,MAAM,IAAIh1C,MAAM,wDAIlB,OADAuD,QAAQC,IAAI,yBAA0BwxC,EAAaC,MAC5CD,EAAaC,MAyfpBC,WAtfiB1zC,MACjBqgC,EACAsT,EACAzG,KACuC,IAAD,EACtC,QAA2B/sC,IAAvB+sC,EAAkC,MAAM,IAAI1uC,MAAM,6CACtDuD,QAAQC,IAAI,wBAAyBq+B,EAAQsT,EAAYh0B,YAEzD,MAAMwzB,QAAoBjG,EAAmBkG,YAAYQ,WAAWvT,EAAQsT,EAAY/0C,KAElFyR,cACE68B,EAAmB0G,WAAWvT,EAAQsT,EAAY/0C,IAAK,CAC3DyB,SAAU8yC,EAAY5tC,IAAI2jC,OAE5BoK,OAEIO,EAAc,OAAGxjC,QAAH,IAAGA,GAAH,UAAGA,EAASwvB,cAAZ,aAAG,EAAiBvhC,MACtCkiB,GAAiB,kBAAZA,EAAEwD,QAGT,QAAuB7jB,IAAnB0zC,EACF,MAAM,IAAIr1C,MAAM,0DAGlB,OADAuD,QAAQC,IAAI,yBAA0B6xC,EAAeJ,MAC9CI,EAAeJ,MA+dtBK,UA5dgB9zC,MAChBqgC,EACA6M,KAEA,IAAK,IAAD,EACF,QAA2B/sC,IAAvB+sC,EACF,MAAM,IAAI1uC,MAAM,4CAClBuD,QAAQC,IAAI,sBAAuBq+B,GAEnC,MAAM8S,QAAoBjG,EAAmBkG,YAAYW,UAAU1T,GAQ7D2T,EAAgB,uBALd9G,EAAmB6G,UAAU1T,EAAQ,CACzChgC,SAAU8yC,EAAY5tC,IAAI2jC,OAE5BoK,QAE+BzT,cAAX,aAAG,EAAgBvhC,MACvCkiB,GAAiB,gBAAZA,EAAEwD,QAGT,QAAyB7jB,IAArB6zC,EACF,MAAM,IAAIx1C,MAAM,uDAIlB,OADAuD,QAAQC,IAAI,uBAAwBgyC,EAAiBP,MAC9CO,EAAiBP,KACxB,MAAO5yC,GAEP,MADAkB,QAAQlB,MAAM,sBAAuBA,GAC/BA,IAgcRozC,4BA5bkCj0C,MAClCmD,EACA0nC,EACAqJ,KAEA,GAAwB,OAApBA,EACF,MAAM,IAAI11C,MAAM,8DAQlB,aALwBqsC,EAAMsJ,UAAUhxC,EAAS+wC,IAKhC3vB,GAAGilB,aAAU4K,YA+a9BC,mCA5ayCr0C,MACzCmD,EACA0nC,WAEwBA,EAAMsJ,UAAUhxC,EAAS6lC,KAKhCzkB,GAAGilB,aAAU4K,WAoa9BE,yBArZ+Bt0C,MAC/B6qC,EACAqJ,KAEA,QAAc/zC,IAAV0qC,GAA2C,OAApBqJ,EACzB,MAAM,IAAI11C,MAAM,uEAGLqsC,EAAM0J,QAAQL,EAAiB1K,aAAUgL,aAAalB,QA8YnEmB,gCA9XsCz0C,UACtC,QAAcG,IAAV0qC,EACF,MAAM,IAAIrsC,MAAM,8EAGLqsC,EAAM0J,QAAQvL,GAA8BQ,aAAUgL,aAAalB,QA0XhFoB,6BAnamC10C,MACnCmD,EACA0nC,EACA8J,KAEA,GAAyB,OAArBA,EACF,MAAM,IAAIn2C,MAAM,+DAGlB,aADwBqsC,EAAMsJ,UAAUhxC,EAASwxC,IAChCpwB,GAAGilB,aAAU4K,YA2Z9BQ,aA5YmB50C,MACnB6qC,EACAgK,KAEA,QAAc10C,IAAV0qC,GAA0C,OAAnBgK,EACzB,MAAM,IAAIr2C,MAAM,2DAGLqsC,EAAM0J,QAAQM,EAAgBrL,aAAUgL,aAAalB,QAqYlE9H,sBAjBiB,GAkBjBI,gCACAkJ,WA5ViB90C,MACjBuiC,EACAgK,EACAwI,EACAtJ,KACuC,IAAD,EACtC,QAAiBtrC,IAAbsrC,EAAwB,MAAM,IAAIjtC,MAAM,6CAE5C,MAAM20C,QAAoB1H,EAAS2H,YAAY,6CAC7C7Q,EACA8J,GAAc9J,GACdgK,EAAY3tC,IACZm2C,EAAgBn2C,KAGZyR,cACEo7B,EAAS,6CACblJ,EACA8J,GAAc9J,GACdgK,EAAY3tC,IACZm2C,EAAgBn2C,IAChB,CAAEyB,SAAU8yC,EAAYzzB,IAAI,GAAGL,IAAI,MAErCi0B,OAEI0B,EAAa,OAAG3kC,QAAH,IAAGA,GAAH,UAAGA,EAASwvB,cAAZ,aAAG,EAAiBvhC,MACrCkiB,GAAiB,kBAAZA,EAAEwD,QAGT,QAAsB7jB,IAAlB60C,EACF,MAAM,IAAIx2C,MAAM,0DAIlB,OADAuD,QAAQC,IAAI,yBAA0BgzC,EAAcvB,MAC7CuB,EAAcvB,MA2TrBwB,kBAxTwBj1C,MACxBuiC,EACAgK,EACAwI,EACAtJ,KAEA,QAAiBtrC,IAAbsrC,EAAwB,MAAM,IAAIjtC,MAAM,oDAE5C,MAAMouC,EAAQC,+BAA4BC,QAAQ9D,GAA8ByC,EAAS/H,QACnFwR,EAAQ3L,GAAShH,GAEjB4Q,QAAoBvG,EAAMwG,YAC9B,kEACG8B,EAAO3I,EAAY3tC,IAAKm2C,EAAgBn2C,KAW7C,iBARQguC,EAAM,kEACPsI,EACH3I,EAAY3tC,IACZm2C,EAAgBn2C,IAChB,CAAEyB,SAAU8yC,EAAYzzB,IAAI,GAAGL,IAAI,MAErCi0B,QAEWhxC,OACX,MAAM,IAAI9D,MAAM,8BAGlBuD,QAAQC,IAAI,iCA6RZmzC,gBA3NuBlL,GACvBpqC,QAAQC,IAAI,CAACmqC,EAAKyC,SAAS,GAAG5oC,KAAKmhC,IAAagF,EAAKyC,SAAS,GAAG5oC,KAAKmhC,MA2NtEmQ,oBAlR0Bp1C,MAC1Bq1C,EACAjD,EACAkD,KAGA,IAAIC,EAAwBp3C,WAAQorB,KACpC,IAEEgsB,OAlBuCv1C,OACzCq1C,EACAjD,EACAkD,IAGOrQ,SAAiBqQ,EAAYE,eAAeH,EAAYz2C,IAAKwzC,EAAWxzC,MAAM8gB,IAAI,KAYzD+1B,CAC5BJ,EACAjD,EACAkD,GAEF,MAEA,OAAOC,EAET,OAAOA,GAiQPG,aA9PmB11C,MACnBq1C,EACAjD,EACAuD,EACAC,EACAN,KAEA,QAAoBn1C,IAAhBm1C,EAA2B,MAAM,IAAI92C,MAAM,+CAE/C,MAAMq3C,EAAiBD,EAAqB,uBAAyB,eAE/DzC,QAAoBmC,EAAYlC,YAAYyC,GAChDR,EAAYz2C,IACZwzC,EAAWxzC,IACX+2C,EAAY/2C,KAYd,iBARQ02C,EAAYO,GAChBR,EAAYz2C,IACZwzC,EAAWxzC,IACX+2C,EAAY/2C,IACZ,CAAEyB,SAAU8yC,EAAYzzB,IAAI,GAAGL,IAAI,MAErCi0B,QAEWhxC,OACX,MAAM,IAAI9D,MAAM,yBAGlBuD,QAAQC,IAAI,4BAiOZ8zC,sBA3N4B91C,MAC5B+1C,EACAC,EACAV,EACA7J,KAEA,GAAe,SAAXuK,EAAmB,CACrB,MAAOX,EAAajD,SAAoBkD,EAAYW,uBAAuBF,EAAOn3C,KAElF,OAAO,IAAIs3C,IAAI,CACb,CAACtU,GAAmBY,MAAOyC,GAAWoQ,IACtC,CAACzT,GAAmBhkB,KAAMqnB,GAAWmN,MAElC,CACL,MAAM+D,EACJH,IAAWpU,GAAmBhkB,KAC1B,IAAM03B,EAAYc,mBAAmBL,EAAOn3C,KAC5C,IAAM6sC,EAASQ,uBAAuB8J,EAAOn3C,IAAK,GACxD,OAAO,IAAIs3C,IAAI,CAAC,CAACF,QAAcG,IAA4BryC,KAAKmhC,SA0MlEoR,gBAtMsBr2C,MACtBs2C,EACAC,EACAC,EACAlB,KAEA,QAAoBn1C,IAAhBm1C,EAA2B,MAAM,IAAI92C,MAAM,kDAU/C,iBAPQ82C,EAAYmB,wBAChBH,EAAa13C,IACb23C,EAAe33C,IACf43C,EAAc53C,MAEhB00C,QAEWhxC,OACX,MAAM,IAAI9D,MAAM,4BAGlBuD,QAAQC,IAAI,+BAmLZ00C,uBAjH6B12C,MAC7Bs2C,EACAN,EACAW,EACArB,EACA7J,IAEIuK,IAAWpU,GAAmBhkB,KAtER5d,OAC1Bs2C,EACAK,EACArB,KAEA,QAAoBn1C,IAAhBm1C,EACF,MAAM,IAAI92C,MAAM,sDAElB,MAEM20C,QAAoBmC,EAAYlC,YAAZ,oBACxBkD,EAAa13C,IACb+3C,EAAU/3C,KAWZ,iBAPQ02C,EAAW,oBACfgB,EAAa13C,IACb+3C,EAAU/3C,IACV,CAAEyB,SAAU8yC,EAAYzzB,IAAI,GAAGL,IAAI,MAErCi0B,QAEWhxC,OACX,MAAM,IAAI9D,MAAM,gCAGlBuD,QAAQC,IAAI,mCA4CH40C,CAAoBN,EAAcK,EAAWrB,GAzC3Bt1C,OAC3Bs2C,EACAK,EACAlL,KAEA,QAAiBtrC,IAAbsrC,EAAwB,MAAM,IAAIjtC,MAAM,uDAE5C,MAAMq4C,EAA0B,0DAE1B1D,QAAoB1H,EAAS2H,YAAYyD,GAC7CP,EAAa13C,IACb,EACA+3C,EAAU/3C,KACV,GAaF,iBATQ6sC,EAASoL,GACbP,EAAa13C,IACb,EACA+3C,EAAU/3C,KACV,EACA,CAAEyB,SAAU8yC,EAAYzzB,IAAI,GAAGL,IAAI,MAErCi0B,QAEWhxC,OACX,MAAM,IAAI9D,MAAM,iCAGlBuD,QAAQC,IAAI,oCAaH80C,CAAqBR,EAAcK,EAAWlL,GAwGvDsL,eApGqB/2C,MACrBg3C,EACAC,KACiC,IAAD,EAChC,QAAmB92C,IAAf82C,EACF,MAAM,IAAIz4C,MAAM,iDAElB,MAAM6R,cAAuB4mC,EAAW,oBAAoBD,EAAYp4C,MAAM00C,OAExE4D,EAAY,OAAG7mC,QAAH,IAAGA,GAAH,UAAGA,EAASwvB,cAAZ,aAAG,EAAiBvhC,MAAKkiB,GAAkB,aAAZ,OAADA,QAAC,IAADA,OAAA,EAAAA,EAAGwD,SAEnD,QAAqB7jB,IAAjB+2C,EACF,MAAM,IAAI14C,MAAM,yDAIlB,OADAuD,QAAQC,IAAI,6BAA8Bk1C,EAAazD,MAChDyD,EAAazD,MAqFpB0D,iBAlFuBn3C,MACvBo3C,EACAH,KACkC,IAAD,EACjC,QAAmB92C,IAAf82C,EACF,MAAM,IAAIz4C,MAAM,mDAElB,MACM6R,cACE4mC,EAAW,0BAA0BG,EAAcx4C,KAFtC,IAGnB00C,OAEI+D,EAAa,OAAGhnC,QAAH,IAAGA,GAAH,UAAGA,EAASwvB,cAAZ,aAAG,EAAiBvhC,MAAKkiB,GAAkB,cAAZ,OAADA,QAAC,IAADA,OAAA,EAAAA,EAAGwD,SAEpD,QAAsB7jB,IAAlBk3C,EACF,MAAM,IAAI74C,MAAM,2DAIlB,OADAuD,QAAQC,IAAI,+BAAgCq1C,EAAc5D,MACnD4D,EAAc5D,MAgErB6D,aAjDmBt3C,MACnBmD,EACA8zC,KAEA,IAAIM,EAA0B,GAE9B,MAAMC,SAA2BP,EAAWQ,gBAAgBzS,WAE5D,IAAK,IAAI0S,EAAa,EAAGA,EAAaF,EAAmBE,IAAc,CACrE,MAAMvL,QAAqB8K,EAAWU,cAAcD,GAC9CE,EAAe3S,SAAiBgS,EAAWY,iBAAiB10C,EAASgpC,IACrE2L,EACJ7O,GAAuBkD,IACtB,GAAEA,EAAa/sC,MAAM,EAAG,OAAO+sC,EAAa/sC,MAAM+sC,EAAax8B,OAAS,KAE3E4nC,EAAQ9nC,KAAK,CAAEtL,KAAM2zC,EAAWz6C,QAAS8uC,EAAc3pB,OAAQo1B,IAEjE,OAAOL,GAiCPQ,eA9DqB/3C,UACrB,QAAmBG,IAAf82C,EACF,MAAM,IAAIz4C,MAAM,iDAKlB,iBAF6By4C,EAAW,sBAAsB3D,QAEjDhxC,OACX,MAAM,IAAI9D,MAAM,sEChrCb,SAASw5C,GACdC,EACAC,GACuD,IAAD,EAC1B70C,mBAA4B,QADF,mBAC/Cf,EAD+C,KACvC61C,EADuC,KA4BtD,OAzBAt0C,qBAAU,WACR,GAAe,cAAXvB,GAAqC,WAAXA,EAAqB,CACjD,IAAM81C,EAAU5qC,YAAW,WACzB2qC,EAAU,UACT,MACH,OAAO,kBAAM1sB,aAAa2sB,OAE3B,CAAC91C,IAkBG,CAhBamM,sBAAW,sBAC7B,4CAAAtN,EAAA,qEAAUsyC,EAAV,yBAAUA,EAAV,wBAEI0E,EAAU,WAFd,SAGUF,EAAmB,WAAnB,EAAuBxE,GAHjC,OAII0E,EAAU,aAJd,sDAMIA,EAAU,UACJ,IAAI35C,MAAJ,yBAA4Bi1C,EAA5B,oBAPV,yDAD6B,CAa5BwE,GAb4B,mBAaJC,KAGN51C,G,iCC3BhB,SAAS+1C,GACdh7C,EACAi7C,GAC8C,IAAD,EACfpzC,IAAtBjC,EADqC,EACrCA,SAAU2B,EAD2B,EAC3BA,QAD2B,EAEbvB,qBAFa,mBAEtCk1C,EAFsC,KAE5BC,EAF4B,KAiC7C,OA7BA30C,qBAAU,WACR,sBAAC,4BAAA1C,EAAA,uEAEoBhB,IAAbo4C,EAFP,oDAGmB,OAAZl7C,EAHP,uBAIKm7C,EAAY,CAAEC,cAAUt4C,EAAWmC,OAAQ,WAJhD,0CAQyBW,EAASy1C,QAAQr7C,GAR1C,sBAQwD,OARxD,4BASsB,IAAImB,MAAJ,mBAAsBnB,EAAtB,oBATtB,QAWSs7C,EAAqB,IAAIC,UAAO9M,SACpCzuC,EACAi7C,EACA1zC,EAAQrB,WAAWmgC,QAGrB8U,EAAY,CAAEC,SAAUE,EAAmBr2C,OAAQ,WAjBtD,kDAmBGk2C,EAAY,CAAEC,cAAUt4C,EAAWmC,OAAQ,WAC3CP,QAAQlB,MAAR,MACAkB,QAAQlB,MAAR,mBACcxD,EADd,wFArBH,yDAAD,KA0BC,CAAC4F,EAAU2B,EAAQrB,WAAWmgC,OAAQrmC,EAASi7C,EAAKC,IAEhD,QAACA,QAAD,IAACA,OAAD,EAACA,EAAUE,UAAkB,OAARF,QAAQ,IAARA,OAAA,EAAAA,EAAUj2C,SAAU,WCiB3C,MClBMu2C,GAA6B/3B,IACxC,MAAM,SAAEle,GAAake,GACd+M,EAAMirB,GAAWz1C,mBAAmB,QACrC01C,EAAU14B,iBAAiBwN,IAC1BmrB,EAAgBC,GAAqB51C,sBACrCw/B,EAAgBqW,GAAqB71C,sBACrC81C,EAAmBC,GAAwB/1C,oBAAkB,IAC7DgyB,EAAOgkB,GAAYh2C,sBACnBg5B,EAAOid,GAAYj2C,sBACnBi3B,EAAcif,GAAmBl2C,sBACjCm2C,EAAuBC,GAA4Bp2C,sBACnDq2C,EAAWC,GAAgBt2C,sBAC3Bu2C,EAA4BC,GAAiCx2C,oBAAS,IACtEy2C,EAA6BC,GAAkC12C,oBAAS,IACxE22C,EAA6BC,GAAkC52C,oBAAS,IACxE62C,EAA8BC,GAAmC92C,oBAAS,IAC1E+2C,EAAgCC,GAAqCh3C,oBAAS,IAC9Ei3C,EAA4BC,GAAiCl3C,oBAAS,IACtEm3C,EAAiBC,GAAsBp3C,oBAAS,IAChDk/B,EAAYmY,GAAiBr3C,mBAClCu+B,GAAmBY,QAEd1nB,EAAU6/B,GAAet3C,mBAAkC,CAChEu3C,OAAQ,OACR5W,OAAQ,OACRE,MAAO,OACP2W,YAAa,OACbC,gBAAiB,OACjBC,KAAM,OACNC,iBAAkB,UAEbr+B,EAAcs+B,GAAmB53C,sBACjCiZ,EAAa4+B,GAAkB73C,sBAC/B83C,EAAgBC,GAAqB/3C,sBACrCg4C,EAAsBC,GAA2Bj4C,sBAEjDk4C,EAAeC,GAAoBn4C,sBACnCo4C,EAAsBC,IAA2Br4C,sBACjDs4C,GAAqBC,IAA0Bv4C,sBAC/Ci9B,GAAyBub,IAA8Bx4C,sBACxD,QAAEF,GAAF,QAAWyB,IAAYM,KACvB,sBACJuW,GADI,kBAEJL,GAFI,qBAGJM,GAHI,0BAIJL,IACEY,KACE6/B,GD7BwB,MAC9B,MAAM,QAAEl3C,GAAYM,KACd,QAAE9B,GAAYJ,cACdqtC,EAAwB,IAAZjtC,EAEZ+Y,EAAYF,MAEZ,kBACJb,EADI,oBAEJE,EAFI,iBAGJC,EAHI,6BAIJC,EAJI,sBAKJC,EALI,qBAMJC,EANI,0BAOJL,GACEc,GAEG4/B,EAAkBC,GAA0B3D,GACjDzzC,EAAQrB,WAAW4Y,UAAUo2B,UAC7B0J,KAGKC,EAAmBC,GAA2B9D,GACnD58B,EACA2gC,wBAAqB9D,MAGhB/F,EAAW8J,GACU,OAA1B5gC,EACI,CAACsgC,EAAkBC,GACnB,CAAEE,EAA4CC,IAE7C/L,EAAYkM,GAAoBjE,GACrC/8B,EACAihC,uBAAoBjE,MAGfrL,EAASuP,GAAiBnE,GAAqB98B,EAAkBkhC,oBAAiBnE,MAClFpL,EAAoBwP,GAA4BrE,GACrD78B,EACAmhC,+BAA4BrE,MAGvB7M,EAAUmR,GAAkBvE,GACjCj9B,EACAyhC,gCAA6BvE,MAGxBwE,EAAgBC,GAAuB1E,GAC5C38B,EACAshC,uBAAoB1E,MAGfrB,EAAYgG,GAAoB5E,GACrCh9B,EACA6hC,kCAA+B5E,KAG3B6E,OASsCh9C,IAR1C,CACEk8C,EACAG,EACAE,EACAJ,EACAM,EACAG,EACAE,GACA3+C,MAAKgE,GAAqB,WAAXA,IAEb86C,EAAgB3uC,uBACpBzO,MAAOmD,EAAiB4pC,KACtB,QACgB5sC,IAAdoyC,QACYpyC,IAAZ8sC,QACuB9sC,IAAvB+sC,QACe/sC,IAAfiwC,QACajwC,IAAbsrC,QACetrC,IAAf82C,GAC8B,OAA9B57B,EAEA,OAGF,MAAMgiC,EAAsBtQ,EAAIoD,gBAC9BC,EACA3E,EACAyB,EACAmD,GAGIiN,EAAevQ,EAAIC,gBACvB7pC,EACA8pC,EACAC,QACMmQ,IAGD/iB,EAAc+B,EAAOkhB,EAASC,SAA2B39C,QAAQC,IAAI,CAC1Eu9C,EACAtQ,EAAI4C,SAASzC,GACbH,EAAIgD,WAAWtE,GACfsB,EAAIb,UAAU7wB,EAA2BowB,EAASxoC,aAIlD0Z,EACAL,EACA6+B,EACAE,EACAE,EACAkC,EACA/D,SACQ75C,QAAQC,IAAI,CACpBitC,EAAIiD,gBAAgB7sC,EAASitC,GAC7BrD,EAAIiD,gBAAgB7sC,EAASovC,GAC7BxF,EAAIiD,gBAAgB7sC,EAASo6C,GAC7BxQ,EAAIiD,gBAAgB7sC,EAASq6C,GAC7BzQ,EAAIkD,oBAAoBsN,GACxBxQ,EAAIoI,gBAAgB1J,GACpBsB,EAAIuK,aAAan0C,EAAS8zC,KAK5B,MAAO,CACL3c,eACAjF,YAJkBioB,EAKlBjhB,QACA1f,eACAL,cACA6+B,iBACAE,uBACAE,gBACAE,qBAAsBgC,EAAqB7b,GAAmBY,OAC9DmZ,oBAAqB8B,EAAqB7b,GAAmBhkB,MAC7D87B,eAGJ,CACExM,EACAD,EACAmD,EACAmC,EACA9G,EACA4E,EACAh1B,EACA47B,IAIJ,MAAO,CACL96B,YACAo2B,YACAnC,aACAnD,UACAC,qBACAzB,WACAqR,iBACA7F,aACAmG,gBACAD,sBCnIgBO,IACZ,QAAEt6C,IAAYJ,cACdqtC,GAAwB,IAAZjtC,GAEZu6C,GAA0BlvC,uBAC7B8tB,IACC,QAAqBp8B,IAAjBm6B,EAA4B,OAChC,MAAMkf,EAAwBxO,GAC5BzO,EACAjC,EAAayL,WACbzL,EAAasL,aACbtL,EAAaoL,oBAGf+T,EAAyB,IACpBnf,KACAkf,EACHxH,qBAAsBzV,MAG1B,CAACjC,IAGGsjB,GAA4BnvC,uBAAY,UACvBtO,IAAjBm6B,GAEJmf,EAAyB,IAAKnf,MAC7B,CAACA,IAEEujB,GAAqBpvC,uBACxB4xB,IACC,QAAclgC,IAAVk1B,EAAqB,OACzB,MAAMF,EAAME,EAAM6K,WAAU1K,GAAQA,EAAK53B,KAAOyiC,IAC1Cyd,EAAYzoB,EAAMj2B,MAAM,EAAG+1B,GAAK3G,OAAO6G,EAAMj2B,MAAM+1B,EAAM,IAC/DkkB,EAASyE,KAEX,CAACzoB,IAGG0oB,GAA4BtvC,uBAC/B4xB,IACC,QAAclgC,IAAVk1B,EAAqB,OACzB,MAAMF,EAAME,EAAM6K,WAAU1K,GAAQA,EAAK53B,KAAOyiC,IAC1C2d,EAAoB,IAAK3oB,EAAMF,GAAM7yB,OAAQ,WAC7Cw7C,EAAYzoB,EACfj2B,MAAM,EAAG+1B,GACT3G,OAAOwvB,GACPxvB,OAAO6G,EAAMj2B,MAAM+1B,EAAM,IAC5BkkB,EAASyE,KAEX,CAACzoB,IAGGkO,GAAoB90B,uBAAYzO,eACRG,IAAxB27C,GAAUvJ,WAEc,OAA1B92B,WACOqgC,GAAUvJ,UAAUlF,UAAUlqC,KAAUynB,GAAG,IAClD,QAASkxB,GAAUvJ,wBAEJuJ,GAAUvJ,UAAsC0L,OAAO3K,OACtE8F,GAAqB,MAEtB,CAAC0C,GAAUvJ,UAAWpvC,GAASsY,KAElC5X,qBAAU,KACR,WACE,GACwB,OAAtBuX,SACwBjb,IAAxB27C,GAAUvJ,WACVqH,EAEA,OAEF,MAAMsE,QAAoB7N,GACtBtD,GAAIsH,mCAAmClxC,GAAS24C,GAAUvJ,WAC1DxF,GAAIkH,4BAA4B9wC,GAAS24C,GAAUvJ,UAAWn3B,KAElEy+B,EAA8BqE,IAZhC,KAcC,CAACpC,GAAUvJ,UAAWpvC,GAASy2C,EAA4BvJ,GAAWj1B,KAEzEvX,qBAAU,KACR,WACE,GACwB,OAAtBuX,SACyBjb,IAAzB27C,GAAU1L,YACV0J,EAEA,OAGF,MAAMoE,QAAoB7N,GACtBtD,GAAIsH,mCAAmClxC,GAAS24C,GAAU1L,YAC1DrD,GAAIkH,4BAA4B9wC,GAAS24C,GAAU1L,WAAYh1B,KAEnE2+B,EAA+BmE,IAbjC,KAeC,CAACpC,GAAU1L,WAAYjtC,GAAS22C,EAA6BzJ,GAAWj1B,KAE3EvX,qBAAU,KACR,WACE,GAC2B,OAAzB6X,SACwBvb,IAAxB27C,GAAUvJ,WACVyH,EAEA,OAGF,MAAMmE,QAAuBpR,GAAI2H,6BAC/BvxC,GACA24C,GAAUvJ,UACV72B,IAGFu+B,EAA+BkE,IAfjC,KAiBC,CAACrC,GAAUvJ,UAAWpvC,GAAS62C,EAA6Bt+B,KAE/D7X,qBAAU,KACR,WACE,QAA2B1D,IAAvB27C,GAAUrQ,UAA0B2O,EAAgC,OACxE,MAAMmD,QAAgBxQ,GAAIgD,WAAW+L,GAAUrQ,UACzC2S,QAAqBrR,GAAI2H,6BAC7BvxC,GACAo6C,EACA7hC,IAGF2+B,EAAkC+D,IATpC,KAWC,CAACtC,GAAUrQ,SAAUtoC,GAASi3C,EAAgC1+B,KAEjE7X,qBAAU,KACR,WACE,GAC2B,OAAzB6X,SACyBvb,IAAzB27C,GAAU1L,YACV8J,EAEA,OAGF,MAAMmE,QAAwBtR,GAAI2H,6BAChCvxC,GACA24C,GAAU1L,WACV10B,IAGFu+B,EAA+BoE,IAfjC,KAiBC,CAACvC,GAAU1L,WAAYjtC,GAAS+2C,EAA8Bx+B,KAEjE7X,qBAAU,KACR,GAAI22C,EAAiB,OACrB,MAAM8D,EAAQ9wC,YAAW,IAAM4rC,GAAqB,IAxNxB,MA0N5B,MAAO,KACL3tB,aAAa6yB,MAEd,CAAC9D,IAEJ32C,qBAAU,KACR,WACE,IACE,QAC0B1D,IAAxB27C,GAAUvJ,gBACYpyC,IAAtB27C,GAAU7O,cACuB9sC,IAAjC27C,GAAU5O,yBACe/sC,IAAzB27C,GAAU1L,iBACajwC,IAAvB27C,GAAUrQ,eACetrC,IAAzB27C,GAAU7E,aACTkC,GACDqB,EAEA,OAEFC,GAAmB,GAEnB,MAAM8D,QAAezC,GAAUsB,cAAcj6C,GAAS4pC,IACtD,QAAe5sC,IAAXo+C,EAEF,YADA9D,GAAmB,GAIrB,MAAM,aACJngB,EADI,MAEJjF,EAFI,MAGJgH,EAHI,aAIJ1f,EAJI,YAKJL,EALI,eAMJ6+B,EANI,qBAOJE,EAPI,cAQJE,EARI,qBASJE,EATI,oBAUJE,EAVI,UAWJjC,GACE6E,EAKJ,GAHAhF,EAAgBjf,QAGcn6B,IAA1Bq5C,EAAqC,CACvC,MAAMA,EAAwBxO,GAC5B1Q,EAAa0X,qBACb1X,EAAayL,WACbzL,EAAasL,aACbtL,EAAaoL,oBAEf+T,EAAyB,IACpBnf,KACAkf,EACHxH,qBAAsB1X,EAAa0X,uBAIvCoH,GAAqB,GACrBO,EAAaD,GACbuB,EAAgBt+B,GAChBu+B,EAAe5+B,GACf8+B,EAAkBD,GAClBG,EAAwBD,GACxBG,EAAiBD,GACjBG,GAAwBD,GACxBG,GAAuBD,GACvBrC,EAASjd,GACTgd,EAAShkB,GACT6jB,OAAkB/4C,GAClB,MAAOU,GACPkB,QAAQlB,MAAM,iCAAkCA,GAGlD45C,GAAmB,IArErB,KAuEC,CAACD,EAAiBrB,EAAmBh2C,GAAS24C,GAAWtC,IAE5D,MAAOgF,GAAYC,IAAoBzG,IACrCh4C,UACE,IAAK,MAAM6qC,KAAS6T,EACd7T,IAAUjJ,GAAmBY,aACxB6N,GACHtD,GAAI0H,gCAAgCqH,GAAU1L,YAC9CrD,GAAIuH,yBAAyBwH,GAAU1L,WAAYh1B,KAEvD2+B,GAA+B,WAExB1J,GACHtD,GAAI0H,gCAAgCqH,GAAUvJ,WAC9CxF,GAAIuH,yBAAyBwH,GAAUvJ,UAAWn3B,KAEtDy+B,GAA8B,MAIpC,CAACiC,GAAU1L,WAAY0L,GAAUvJ,UAAWlC,GAAWj1B,MAGlDujC,GAAeC,IAAuB5G,IAC3Ch4C,OAAS0+C,4BACP,QAA2Bv+C,IAAvB27C,GAAUrQ,SACd,IAAK,MAAOZ,EAAO2H,KAAYvd,MAAM72B,KAAKsgD,GACxC,GAAI7T,IAAUjJ,GAAmBY,YACzBuK,GAAI6H,aAAakH,GAAU1L,WAAYoC,GACzCA,IAAYp3B,GACd2+B,GAA+B,GACtBvH,IAAY92B,IACrBy+B,GAAgC,QAE7B,GAAItP,IAAUjJ,GAAmBhkB,WAChCmvB,GAAI6H,aAAakH,GAAUvJ,UAAW72B,IAC5Cu+B,GAA+B,QAC1B,GAAIpP,IAAUjJ,GAAmBid,oBAA6B1+C,IAAZqyC,EAAuB,CAC9E,MAAM+K,QAAgBxQ,GAAIgD,WAAW+L,GAAUrQ,gBACzCsB,GAAI6H,aAAa2I,EAAS7hC,IAChC2+B,GAAkC,QAC7B,GAAIxP,IAAUjJ,GAAmBid,cAAe,CACrD,MAAMtB,QAAgBxQ,GAAIgD,WAAW+L,GAAUrQ,gBACzCsB,GAAI6H,aAAa2I,EAAS/K,GAC5BA,IAAY92B,GACd2+B,GAAkC,GACzB7H,IAAYn3B,IACrBk/B,GAA8B,MAKtC,CACEuB,GAAUrQ,SACVqQ,GAAU1L,WACV0L,GAAUvJ,UACV72B,GACAL,GACAD,GACA8+B,EACAF,KAIG7H,GAAY2M,IAAgB9G,IACjCh4C,UACE,QAAkCG,IAA9ByE,GAAQrB,WAAWmgC,OAAsB,aAEvCqJ,GAAIoF,WACRC,EACAjvC,GAFI,OAGJsY,SAHI,IAGJA,MAAyB7W,GAAQrB,WAAW4Y,UAAUo2B,UACtDuJ,GAAUvJ,UACVuJ,GAAU5O,mBACVtoC,GAAQrB,WAAWmgC,QAErB,MAAMb,EAAiC,CACrCjlC,GAAI,kBACJu4B,QAASic,EACTtQ,UAAW5gB,KAAK6U,MAChBzzB,OAAQ,WAEV42C,EAAkBrW,GAClBuW,GAAqB,KAEvB,CAAC0C,GAAU5O,mBAAoB4O,GAAUvJ,UAAW3tC,GAAQrB,WAAWmgC,OAAQvgC,MAG1EuwC,GAAYqL,IAAgB/G,IACjCh4C,MAAOqgC,EAAgBsT,WACf5G,GAAI2G,WAAWrT,EAAQsT,EAAamI,GAAU5O,oBACpD2Q,GAAmBxd,GACnB+Y,GAAqB,KAEvB,CAAC0C,GAAU5O,mBAAoB2Q,MAG1B/J,GAAWkL,IAAehH,IAC/Bh4C,gBACQ+sC,GAAI+G,UAAUzT,EAAQyb,GAAU5O,oBACtC6Q,GAA0B1d,GAC1B+Y,GAAqB,KAEvB,CAAC0C,GAAU5O,mBAAoB6Q,KAG3BvS,GAAwB/8B,uBAC5BzO,MAAOuiC,EAAgCgK,IACrCuP,GAAUrQ,UACL4E,GAAYtD,GAAInB,6BAA+BmB,GAAIvB,uBAClDjJ,EACAgK,EACAuP,GAAUrQ,UAEZttC,WAAQorB,MACd,CAACuyB,GAAUrQ,SAAU4E,MAGhByE,GAAYmK,IAAcjH,IAC/Bh4C,MAAOuiC,EAAgCgK,EAAsBwI,WACpD1E,GAAYtD,GAAIkI,kBAAoBlI,GAAI+H,YAC7CvS,EACAgK,EACAwI,EACA+G,GAAUrQ,UAEZ2N,GAAqB,KAEvB,CAAC0C,GAAUrQ,WAGP2J,GAAsB3mC,uBAC1BzO,MAAOq1C,EAAsBjD,SACOjyC,IAA9ByE,GAAQrB,WAAWmgC,OAA6BvlC,WAAQorB,KAErDuyB,GAAUgB,eACb/P,GAAIqI,oBAAoBC,EAAajD,EAAY0J,GAAUgB,gBAC3D3+C,WAAQorB,MAEd,CAACuyB,GAAUgB,eAAgBl4C,GAAQrB,WAAWmgC,UAGzCwb,GAAiBC,IAAyBnH,IAC/Ch4C,UACwB,iBAAlBhB,EAAOyL,aACHsiC,GAAI2I,aACR12C,EAAOq2C,YACPr2C,EAAOozC,WACPpzC,EAAO22C,YACP32C,EAAO42C,mBACPkG,GAAUgB,gBAEe,oBAAlB99C,EAAOyL,aACVsiC,GAAIsJ,gBACRr3C,EAAOs3C,aACPt3C,EAAOu3C,eACPv3C,EAAOw3C,cACPsF,GAAUgB,gBAEe,2BAAlB99C,EAAOyL,aACVsiC,GAAI2J,uBACR13C,EAAOs3C,aACPt3C,EAAOg3C,OACPh3C,EAAO23C,UACPmF,GAAUgB,eACVhB,GAAUrQ,UAEe,mBAAlBzsC,EAAOyL,aACVsiC,GAAIgK,eAAe/3C,EAAOg4C,YAAa8E,GAAU7E,YAC5B,qBAAlBj4C,EAAOyL,aACVsiC,GAAIoK,iBAAiBn4C,EAAOo4C,cAAe0E,GAAU7E,YAChC,mBAAlBj4C,EAAOyL,cACVsiC,GAAIgL,eAAe+D,GAAU7E,YAErCmC,GAAqB,KAEvB,CAAC0C,GAAUgB,eAAgBhB,GAAU7E,aAGjCnB,GAAwBrnC,uBAC5BzO,MACE+1C,EACAC,SAE2B71C,IAAvB27C,GAAUrQ,SACL,IAAIyK,IAAI,CACb,CAACtU,GAAmBhkB,KAAMzf,WAAQorB,MAClC,CAACqY,GAAmBY,MAAOrkC,WAAQorB,QAGhCuyB,GAAUgB,eACb/P,GAAI+I,sBAAsBC,EAAQC,EAAQ8F,GAAUgB,eAAgBhB,GAAUrQ,UAC9E,IAAIyK,KAEV,CAAC4F,GAAUgB,eAAgBhB,GAAUrQ,WAGjC3H,GAAetgC,mBAAQ,WAAM6xB,QAAN,IAAMA,OAAN,EAAMA,EAAO/2B,MAAKk3B,GAAQA,EAAK53B,KAAOo7C,KAAiB,CAClF3jB,EACA2jB,IAGIhvB,GAAgBvb,uBACpBzO,MAAOgkB,EAAkBo7B,KACvB,IAjfe,EAACvxB,EAAgB7J,SACA7jB,IAA7BogC,GAAY1S,GAAM7J,GAgfhBq7B,CAAatG,EAAQt4B,QAASuD,GAEjC,YADAjiB,QAAQlB,MAAM,gBAAiBmjB,EAAOo7B,EAAS,UAAWrG,EAAQt4B,SAIpE,MAAM6+B,EAlfO,EAACzxB,EAAgB7J,KAAgC,IAAD,EAEjE,OADc,UAAGuc,GAAY1S,GAAM7J,UAArB,QAA+B6J,GAifxB0xB,CAAWxG,EAAQt4B,QAASuD,GAC7C80B,EAAQwG,GAEJF,GAAW,WAAYA,GAAWA,EAAQ/e,SAAW2Y,GACvDC,EAAkBmG,EAAQ/e,QAGxB+e,GAAW,eAAgBA,GAAWA,EAAQ7c,aAAeA,GAC/DmY,EAAc0E,EAAQ7c,YAGxB,MAAMid,EAAqB,CAACC,EAAiBC,IAC3C3G,EAAQt4B,UAAYg/B,GAASz7B,IAAU07B,EAEzC,IACE,GAAIF,EAAmB,WAAY,yBAC3BrN,GAAYiN,EAA8BjpB,eAC1CnM,GAAc,8BACf,GAAIw1B,EAAmB,aAAc,mBAAoB,CAC9D,QAAqBr/C,IAAjB2jC,GAIF,YAHA/hC,QAAQlB,MACN,sFAIE6yC,GAAW5P,GAAalmC,GAAIkmC,GAAa3N,eACzCnM,GAAc,8BACf,GAAIw1B,EAAmB,WAAY,mBAAoB,CAC5D,QAAqBr/C,IAAjB2jC,GAIF,YAHA/hC,QAAQlB,MACN,qFAIEizC,GAAUhQ,GAAalmC,UACvBosB,GAAc,6BACf,GAAIw1B,EAAmB,WAAY,yBAClChB,GAAW,CAACjc,SACb,GAAIid,EAAmB,WAAY,mBAAoB,CAC5D,MAAM,YAAEjT,EAAF,gBAAewI,GAAoBqK,QACnCtK,GAAWvS,EAAYgK,EAAawI,SACpC/qB,GAAc,uBACXw1B,EAAmB,qBAAsB,yBAC5Cb,GAAcS,GACXI,EAAmB,qBAAsB,2BAC5CN,GAAgBE,SAChBp1B,GAAc,+BAEtB,MAAOnpB,GACPkB,QAAQlB,MAAM,4CAA6CA,MAG/D,CACEm4C,EACAtF,GACAvB,GACA2B,GACAhQ,GACA0a,GACAG,GACA7J,GACAvS,EACA2c,KAIJr7C,qBAAU,KACR82C,GAAY7/B,IAAQ,IACfA,EACH8/B,OAAQkE,GACR9a,OAAQ+a,GACR7a,MAAO8a,GACPnE,YAAa4D,GACb3D,gBAAiB8D,GACjB7D,KAAMkE,GACNjE,iBAAkBmE,SAEnB,CACDL,GACAC,GACAC,GACAP,GACAG,GACAK,GACAE,KAGFt7C,qBAAU,KACRk1C,EAAQt4B,QAAUoN,IACjB,CAACA,IAEJhqB,qBAAU,KACR,WACE,QACY1D,IAAVk1B,QACiBl1B,IAAjBm6B,QACiCn6B,IAAjC27C,GAAU5O,mBAEV,OAEF,GAAI5S,EAAawC,YAAYvY,GAAG,GAE9B,YADAs3B,IAA2B,GAI7B,MAAM8D,EAC4E,WAAzE7D,GAAU5O,mBAAmB0S,+BAA+B5a,WAE/D6a,OACoE1/C,IAAxEk1B,EAAM/2B,MAAKk3B,GAAQtU,KAAK6U,MAAQP,EAAKsM,UAAY6d,IAEnD9D,IAA4BgE,IAnB9B,KAqBC,CAACxqB,EAAOiF,EAAcwhB,GAAU5O,qBAEnC,MAAMjqC,GAAgC,CACpC4qB,OACA7D,iBACAgvB,iBACAnW,iBACAvI,eACA+B,QACAhH,QACAva,WACAgpB,gBACAnnB,eACAL,cACA6+B,iBACAE,uBACAE,gBACAE,uBACAE,uBACAnB,kBACAjX,qBACAoa,2BACAC,6BACApE,wBACA2D,kBAAmBrB,GAAUqB,kBAC7BrD,8BACAF,6BACAI,8BACAE,+BACAE,iCACAE,6BACA/X,aACAud,iCACEvd,IAAeX,GAAmBY,MAC9BsX,EACAF,EACNpO,yBACA4J,uBACAU,yBACAxV,2BACAhL,eAA4Bn1B,IAAjBm6B,QAAwCn6B,IAAVk1B,EACzClZ,UAAW2/B,GAAU3/B,UACrBu9B,aAMF,OAFAl1C,OAAOu7C,kBAAoB98C,GAASwd,QAE7B,cAAC9F,GAAgB1V,SAAjB,CAA0BtG,MAAOsE,GAAjC,SAA4CL,KCpqBxCo9C,GAA0C,EACrD77C,OACA6T,cACAioC,kBACAthD,QACA+L,OACAmtB,MACAqoB,MACAt8B,OAAO,IACPu8B,iBACAC,aAGE,eAAC,IAAD,CAAM32C,GAAI,EAAG4M,GAAI,EAAGnO,GAAI,CAAEqB,cAAe,UAAzC,UACE,eAAC,IAAD,CACEX,GAAG,KACHV,GAAI,CACF4B,WAAY,MACZtB,WAAY,SACZD,eAAgB,UALpB,UAQGpE,EACA6T,GAAe,cAACiF,GAAD,CAAU/T,KAAK,KAAK2F,QAASmJ,EAAa7L,KAAM8zC,IAC/DG,GACC,cAAC,IAAD,CACEp3C,QAAQ,OACRd,GAAI,CACF4O,EAAG,EACHhL,GAAI,OACJU,GAAI,EACJ8F,OAAQ,OACRxJ,SAAU,EACVY,MAAO,EACPrB,OAAQ,GAEVY,QAASm3C,EAXX,sBAkBJ,eAAC,IAAD,CAAMl4C,GAAI,CAAE2a,SAAU,EAAGra,WAAY,UAArC,UACE,cAAC,IAAD,CAAMgB,GAAI,EAAGtB,GAAI,CAAEY,SAAU,GAA7B,SACG+uB,IAEH,cAAC,IAAD,CACEl5B,MAAOimC,GAAQjmC,GACfk5B,IAAKA,EACLqoB,IAAKA,EACLt8B,KAAMA,EACNE,SAAUtD,GAAK2/B,EAAehiD,WAAQC,KAAKoiB,EAAEvU,OAAOtN,UAEtD,cAAC,IAAD,CAAMmN,GAAI,EAAG5D,GAAI,CAAEY,SAAU,GAA7B,SACGo3C,OAGL,cAAC,IAAD,CAAMh4C,GAAI,CAAE4B,WAAY,MAAOvB,eAAgB,SAAUC,WAAY,UAArE,SACE,eAAC,IAAD,WACG7J,EAAMqe,SAAS,GADlB,IACuBtS,UC9ClB21C,GAAkC,EAAGC,aAAc,IAAD,IAC7D,MAAM,cACJt2B,EADI,SAEJlP,EAFI,YAGJwB,EAHI,sBAIJk9B,EAJI,wBAKJmE,EALI,0BAMJC,EANI,aAOJtjB,GACE1f,MACE,KAAEqtB,GAASF,MACV5R,EAASoqB,GAAcl9C,mBAAQ,OAAUiZ,QAAV,IAAUA,IAAene,WAAQorB,MACjEi3B,EAAsBn9C,qBACtBo9C,EAAej9C,mBAAQ,IAA0B,YAApBsX,EAAS8/B,QAAsB,CAAC9/B,EAAS8/B,SACtE8F,EAAU,iBAAGzY,QAAH,IAAGA,IAAQqY,SAAX,QAAsB,IAAMt2B,EAAc,iBACnD22B,EAAiBC,GAAsBv9C,mBAAQ,iBAAUiZ,QAAV,IAAUA,OAAV,EAAUA,EAAagc,IAAI,YAA3B,WAC/CuoB,EAA0BC,GAA+Bz9C,oBAAkB,GAuBlF,GALAQ,qBAAU,IACD,IAAM+5C,KAEZ,SAEkBz9C,IAAjBm6B,QAAwDn6B,IAA1Bq5C,QAAuDr5C,IAAhBmc,EACvE,OAAO,KAET,MAAM2uB,EAAmBuO,EAAsBvO,iBACzCyE,EAA2BvxC,WAAQ+4B,IAAIjP,IAAIqS,EAAasL,cAAclmB,IAAIyW,GAC1EwR,EAAepC,GACnBmK,EAAyBhwB,IAAI85B,EAAsBnO,qBACnDlV,EACAqjB,EAAsBxH,sBAElBpK,EAAYD,EAAe/C,GAAQzO,IAAY,EAC/C4qB,EAAiBzmB,EAAayL,WAAWrmB,IAAI,OAAO1C,SAAS,GAC7DgkC,EAAiB7iD,WAAQ+hD,IAC7B5lB,EAAaiC,YAAY7c,IAAI,KAC7B4a,EAAayL,WAAWrmB,IAAI,MAC5B1C,SAAS,GAELgZ,EAAamQ,GACjBqT,EAAsB9T,mBACtB8T,EAAsB7T,mBACtBrL,EAAasL,cAGTqb,EAA+B1a,GACnCpoC,WAAQorB,KACRiwB,EAAsBrM,oBACtBqM,EAAsBpM,eACtBpX,GAGIJ,EAAgB6P,GACpB+T,EAAsB9T,mBACtB8T,EAAsB7T,mBACtBrL,EAAasL,cAGT/P,EAAgBD,EAAchL,GAAGzsB,WAAQs2B,UAC3C0J,GACAiJ,GACEjpC,WAAQorB,KACRiwB,EAAsBrM,oBACtBqM,EAAsBpM,eACtBxX,GAGAK,EAAaD,EAAWpL,GAAGzsB,WAAQs2B,UACrC0J,GACAiJ,GACEjpC,WAAQorB,KACRiwB,EAAsBrM,oBACtBqM,EAAsBpM,eACtBpX,GAGAiM,EAAmBgJ,EACrByE,EAAyBhwB,IAAI85B,EAAsBpO,wBACnDjtC,WAAQs2B,SAENyN,EAAgB+I,EAClByE,EAAyBhwB,IAAI85B,EAAsBnO,qBACnDltC,WAAQs2B,SAEZ,OACE,6BACE,aAAC,IAAD,CAAS7rB,GAAG,KAAKV,GAAI,CAAEoY,GAAI,EAAG3X,GAAI,EAAGI,GAAI,GAAzC,UACE,aAAC,IAAD,CAAMb,GAAI,CAAEK,eAAgB,UAA5B,uBACA,aAAC,IAAD,CACEU,QAxFc,KACpB+gB,EAAc,kBAwFR9hB,GAAI,CACF2F,SAAU,WACVsH,MAAO,OACP3B,IAAK,aAKX,aAAC,IAAD,CAAMtL,GAAI,CAAEK,eAAgB,SAAUC,WAAY,UAAlD,UACE,aAAC,IAAD,CACEN,GAAI,CACFG,OAAQ,IACRiK,OAAQ,mBACRlK,aAAc,MACdM,YAAa,SAEfkY,IFnHiB,wBEqHnB,aAAC3D,GAAD,CACEpO,QACE,aAAC,IAAD,CAAM7F,QAAQ,UAAUd,GAAI,CAAEwB,MAAO,SAArC,SACGwU,GAAWlG,mBAMpB,aAAC,IAAD,CAAMwmB,GAAI,EAAGt2B,GAAI,CAAEK,eAAgB,UAAnC,SACE,aAACq3B,GAAD,CACEC,OAAQ,CACN,CACEhB,KAAM,IAAI3d,MXpJEggC,EWoJoBhgC,KAAK6U,MXpJH,IAAI7U,KAAK,IAAIA,KAAKggC,GAAW9hB,kBWqJ/D7pB,MACE,6BACE,aAAC+oB,GAAD,CAAO6iB,SAAS,UAAUnpC,YAAakG,GAAelG,YAAtD,SACGkG,GAAenG,OAElB,aAACqmB,GAAD,yBAGJU,aAAa,GAEf,CACED,KAAMhJ,EACNtgB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAkBlG,YAAtC,SAAoDkG,GAAkBnG,OACtE,aAACqmB,GAAD,UACE,aAAC7J,GAAD,CAAkBC,SAAUyN,EAA5B,UACGA,EAAiBjlB,SAAS,GAD7B,kBAOR,CACE6hB,KAAM5I,EACN1gB,MACE,6BACE,aAAC+oB,GAAD,CAAOtmB,YAAakG,GAAsBlG,YAA1C,SACGkG,GAAsBnG,OAEzB,aAACqmB,GAAD,UACE,aAAC7J,GAAD,CAAkBC,SAAU0N,EAA5B,UACGA,EAAcllB,SAAS,GAD1B,uBAWd,aAACkG,GAAD,CACE3N,MAAO2I,GAAenG,KACtBuK,QAAQ,sBACRE,OAAQ2T,EAAQnZ,SAAS,GACzBtH,KAAK,OACLyN,aAAcq9B,EACdp9B,aAAc+S,EAAQxW,WACtB0D,gBAAiBb,GAlKaA,KAClC,MAAMm+B,EAAkBn+B,EAAO8V,IAAI,KAC7BuoB,KAA4B,OAACvkC,QAAD,IAACA,OAAD,EAACA,EAAawI,GAAGtC,IACnD+9B,EAAW/9B,GACXo+B,EAAmBD,GACnBG,EAA4BD,IA6JGO,CAA2BjjD,WAAQC,KAAKokB,IACnEe,SAAU4S,EAAQvL,GAAGtO,GACrBgH,UAAWhH,EAAYqD,aAGzB,aAAC,IAAD,CAAMzX,GAAI,CAAEs2B,GAAI,EAAG/0B,GAAI,EAAG+M,aAAc,SAAU5I,GAAI,GAAK8nB,IAAI,OAAOpf,QAAS,EAA/E,UACE,aAAC6pB,GAAD,CACEhjB,QAASe,GACTvf,MAAOssC,EAAmBtD,EAAa5S,QAAQ,GAAK,MACpDrqB,KAAK,SAGP,aAACy1B,GAAD,CACEhjB,QAASe,GACTvf,MAAOssC,EAAmB7F,GAAWwC,GAAW7S,QAAQ,GAAK,IAAM,MACnErqB,KAAK,KAGP,aAACy1B,GAAD,CACEhjB,QAASe,GACTvf,MACEssC,EACI7F,GAAWwC,GAAa,IAAMqZ,IAA+BlsB,QAAQ,GAAK,IAC1E,MAENrqB,KAAK,QAIT,aAACs1C,GAAD,CACE77C,KAAM,wBACN6T,YAAc,2OACdioC,gBAAgB,kEAChBthD,MAAO66C,EAAsBxH,qBAC7Bna,IAAKkpB,EACLb,IAAKc,EACLt2C,KAAK,OACLy1C,eAAgBxhD,GAASg/C,EAAwBh/C,GACjDyhD,QAAS,IAAMxC,MAGI,WAApB9iC,EAAS8/B,QAAuB,aAAC,GAAD,wDAE/BtgB,EAAa2Q,kBACb,aAAC,GAAD,4LAEuF,IACrF,aAAC/+B,GAAD,CAAeC,KAAM+R,GAAsB/R,WAI7Cw0C,GAAmB,aAAC,GAAD,mDACpBE,GACC,aAAC,GAAD,6CACiC,aAAC,GAAD,WAAS1qB,EAAQlO,IAAI3L,GAAaU,SAAS,GAA3C,cAInC,aAAC,IAAD,CAAMrU,GAAI,EAAGT,GAAI,CAAEY,SAAU,SAAUP,eAAgB,SAAU84C,UAAW,UAA5E,iFAIA,aAAC,IAAD,CAAMr4C,QAAQ,iBAAd,UACE,aAAC,IAAD,CAAQA,QAAQ,SAASC,QAASy3C,EAAY7wC,SAAU4wC,EAAxD,kBAGA,aAAC,IAAD,CAAQx3C,QAxOe,KAC3B+gB,EAAc,kBAAmB,CAAEmM,aAuOQtmB,SAAU4wC,EAAjD,WACIA,GAAgB,wCACjBA,GAAgB,aAAC,IAAD,CAASv3C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,oBX1QnCs5C,OYJpBI,GAAiC,EAAG1+C,eACxC,MAAM,cAAEonB,GAAkBpP,KAG1B,OACE,6BACE,aAAC,IAAD,CAAShS,GAAG,KAAKV,GAAI,CAAEoY,GAAI,EAAG3X,GAAI,EAAGI,GAAI,GAAzC,UACE,aAAC,IAAD,CAAMb,GAAI,CAAEK,eAAgB,UAA5B,uBACA,aAAC,IAAD,CACEU,QAPc,IAAM+gB,EAAc,iBAQlC9hB,GAAI,CACF2F,SAAU,WACVsH,MAAO,OACP3B,IAAK,aAKX,aAAC,IAAD,CAAMtL,GAAI,CAAEK,eAAgB,UAA5B,SACE,aAAC,IAAD,CAAOqY,IAAI,wBAAwB1Y,GAAI,CAAEG,OAAQ,aAGlDzF,MAKM2+C,GAAwB,KACnC,MAAMC,EAAiBnhC,iBAAyB,OAE1C,GAAE6nB,EAAF,KAAMD,GAASF,KASrB,OACE,aAACuZ,GAAD,WACE,aAAC,IAAD,CAAKp5C,GAAI,CAAEC,EAAG,CAAC,EAAG,IAAlB,UACE,aAAC,IAAD,CAAWD,GAAI,CAAEsE,GAAI,GAArB,gOAKA,aAAC,IAAD,CAAWtE,GAAI,CAAEsE,GAAI,GAArB,iCAEE,aAAC,IAAD,CAAMR,KAAK,iCAAiCC,OAAO,SAAnD,kBAFF,0CASF,aAAC,IAAD,CAAMjD,QAAQ,iBAAd,UACE,aAAC,IAAD,CAAMd,GAAI,CAAEK,eAAgB,WAAYgB,cAAe,UAAvD,SACE,aAAC,IAAD,CAAOrB,GAAI,CAAEY,SAAU,QAAvB,SACE,aAAC,IAAD,WACE,aAAC,IAAD,CAAUyX,IAAKihC,IADjB,uCAMJ,aAAC,IAAD,CAAQx4C,QAAQ,SAASC,QAASg/B,GAAc,SAAhD,kBAGA,aAAC,IAAD,CAAQh/B,QApCkB,KAAO,IAAD,GACpC,OAAIu4C,QAAJ,IAAIA,GAAJ,UAAIA,EAAgB/gC,eAApB,aAAI,EAAyBghC,UAC3Bj9C,OAAOk9C,aAAaC,QAAQ,4BAA6B,QAE3DzZ,GAAMA,EAAGmY,KAgCL,6BC/ED,IAAMuB,GAAqB,WAAO,IAC/B53B,EAAkBpP,KAAlBoP,cAEFyd,EAAgB,WACpBzd,EAAc,kBAIhB,MAFuF,SAA7DxlB,OAAOk9C,aAAaG,QAAQ,6BAQpD,cAACtd,GAAD,CAAYnN,UAAWqQ,EAAvB,SACE,cAAC4Y,GAAD,MANF,eAAC,GAAD,CAAajpB,UAAWqQ,EAAxB,UACE,cAAC8Z,GAAD,IACA,cAAClB,GAAD,QCCN,MAAMyB,GAAkF,CACtF,CAAClgB,GAAmBY,OAAQ,QAC5B,CAACZ,GAAmBhkB,MAAO,QAGvBmkC,GAGF,CACF,CAACngB,GAAmBY,OAAQZ,GAAmBhkB,KAC/C,CAACgkB,GAAmBhkB,MAAOgkB,GAAmBY,OAG1Cwf,GAAiB7jD,WAAQ+4B,IAAI7X,IAAI,KAY1B4iC,GAAqB,KAAO,IAAD,EACtC,MAAM,cACJj4B,EADI,SAEJlP,EAFI,WAGJynB,EAHI,YAIJjmB,EAJI,aAKJK,EALI,iCAMJmjC,EANI,qBAOJrE,EAPI,oBAQJE,EARI,sBASJnQ,GACE5wB,KACEuI,EAAe9f,qBACf6+C,EAAiB,UACpB3f,IAAeX,GAAmBY,MAAQ7lB,EAAeL,SADrC,QACqDne,WAAQorB,MAC7EgjB,EAAa4V,GAAkB9+C,mBAAkBlF,WAAQorB,OACzD64B,EAAcC,GAAmBh/C,sBACjCi/C,EAAcC,GAAmBl/C,sBACjCm/C,EAAaC,GAAkBp/C,sBAC/Bq/C,EAAyBC,GAA8Bt/C,mBAA4B,SACnFu/C,EAAyBC,GAA8Bx/C,sBACvDy/C,EAA8BC,GAAmC1/C,oBAAS,GAC3E2/C,EAA6B3iC,iBAAyB,MAEtD4iC,EAAiBT,GAAe,IAAIpjC,WAAQojC,GAC5CU,EAA4C,YAAzBpoC,EAAS+/B,YAC5BsI,EAAkC,YAAlBroC,EAASigC,KACzBqI,EAAwB7W,EAAYhoB,GAAG29B,GACvCmB,EACwB,WAA5BX,KACEE,GACAA,EAAwB99B,GAAG,OAC3B89B,EAAwBr+B,GAAGpmB,WAAQ+4B,MACjCosB,EAAuB,OAAGV,QAAH,IAAGA,OAAH,EAAGA,EAAyBr+B,GAAG,KAGtDg/B,EAAa,GAAE9H,KAAwBE,IAsCvC6H,EAAiChjC,GACrCmiC,EAnF4BhkD,KAC9B,GAAc,SAAVA,GAA8B,QAAVA,GAA6B,WAAVA,EACzC,OAAOA,EAGT,MAAM,IAAIH,MAAO,sCAAqCG,OA8EzB8kD,CAAuBjjC,EAAEvU,OAAOtN,QAuC7D,OArCAkF,qBAAU,KACR,IAAIkM,GAAY,EAEhB,MAAMsb,EAAY7d,YAAWxN,UAC3BqiD,OAAgBliD,GAChBoiD,OAAgBpiD,GAChBsiD,OAAetiD,GAEf,IACE,MAAOujD,EAAgBtB,SAAsBviD,QAAQC,IAAI,CACvD0rC,EAAsBjJ,EAAYyf,IAClCzV,EAAYptB,SAAWqsB,EAAsBjJ,EAAYgK,KAG3D,GAAIx8B,EAAW,OAEf,MAAM4zC,EAAuBD,EAAerkC,IAAI2iC,IAC1CM,EAAY,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAAc/iC,IAAIktB,GACjCiW,GAA0B,OAAZF,QAAY,IAAZA,OAAA,EAAAA,EAAc79B,IAAIk/B,IAClCA,EAAqB17B,IAAIq6B,GAAcjjC,IAAIskC,GAC3CxlD,WAAQorB,KAEZ84B,EAAe,OAACD,QAAD,IAACA,IAAgBjkD,WAAQorB,MACxCg5B,EAAe,OAACD,QAAD,IAACA,IAAgBqB,GAChClB,EAAeD,GACf,MAAO3hD,GACPkB,QAAQlB,MAAM,kCACdkB,QAAQC,IAAInB,MAEb,KAEH,MAAO,KACL4qB,aAAaJ,GACbtb,GAAY,KAEb,CAACwyB,EAAYgK,EAAaf,EAAuB+X,IAGlD,6BACE,aAAC,IAAD,CAAS36C,GAAG,KAAKV,GAAI,CAAEoY,GAAI,EAAG3X,GAAI,EAAGI,GAAI,GAAzC,UACE,aAAC,IAAD,CAAMb,GAAI,CAAEK,eAAgB,UAA5B,UACGg6B,IAAeX,GAAmBY,MAAQ,qCAAY,oCADzD,YAGA,aAAC,IAAD,CACEv5B,QAnFc,KACpB+gB,EAAc,kBAmFR9hB,GAAI,CACF2F,SAAU,WACVsH,MAAO,OACP3B,IAAK,aAKX,aAAC0P,GAAD,CACE3N,MAAM,OACN+M,QAAQ,oBACRE,OAAQ+pB,EAAYvvB,SAAS,GAC7BtH,KAAMosC,GAAYvf,GAClBpf,aAAcA,EACdC,aAAcmpB,EAAY5sB,WAC1B0D,gBAAiBb,GAAU2/B,EAAehkD,WAAQC,KAAKokB,IACvDc,UAAW4+B,EAAkBviC,WAC7B4D,SAAUgpB,EAAY3hB,GAAGs3B,KAG3B,aAAC,IAAD,CAAMh6C,GAAI,CAAEK,eAAgB,SAAUkB,GAAI,GAA1C,SACE,aAAC,EAAD,CAAMtF,KAAK,aAAa+E,KAAK,SAG/B,aAAC+Z,GAAD,CAAqB1N,MAAM,MAA3B,SACG6sC,EACC,aAACp/B,GAAD,CACEV,QAAQ,qBACRE,OAAQ4/B,EAAaplC,SAAS,GAC9BtH,KAAMosC,GAAYC,GAAYxf,MAGhC,aAACvf,GAAD,CAAyBV,QAAQ,qBAAjC,SACE,aAAC,IAAD,CAAKpa,GAAI,CAAEwB,MAAO,QAASrB,OAAQ,OAAQmE,GAAI,OAAQ/C,GAAI,OAA3D,SACE,aAAC,GAAD,UAMR,aAACsZ,GAAD,CAAWxN,MAAM,gBAAjB,SACG+sC,EACC,aAACjgC,GAAD,CACEC,QAAQ,qBACRE,OAAQ8/B,EAAatlC,SAAS,GAC9BtH,KAAO,GAAEosC,GAAYvf,MAAeuf,GAAYC,GAAYxf,QAG9D,aAAClgB,GAAD,CAAeC,QAAQ,qBAAvB,SACE,aAAC,IAAD,CAAKpa,GAAI,CAAEwB,MAAO,QAASrB,OAAQ,OAAQmE,GAAI,MAAO/C,GAAI,OAA1D,SACE,aAAC,GAAD,UAMR,aAACsZ,GAAD,CAAWxN,MAAM,eAAjB,SACGitC,GAAeS,EACd,aAAC5gC,GAAD,CACEC,QAAQ,oBACRE,OAAQygC,EAAetjC,SAAS,GAChC/X,MAAO46C,EAAYlqB,IAAI,MAAS,cAAWn4B,IAG7C,aAACkiB,GAAD,CAAeC,QAAQ,oBAAvB,SACE,aAAC,IAAD,CAAKpa,GAAI,CAAEwB,MAAO,OAAQrB,OAAQ,OAAQmE,GAAI,MAAO/C,GAAI,OAAzD,SACE,aAAC,GAAD,UAMR,kCACE,wBAASvB,GAAI,CAAEiK,OAAQ,UAAWkE,GAAI,EAAG5M,GAAI,GAA7C,gCAEA,aAAC,IAAD,CAAMvB,GAAI,CAAEM,WAAY,SAAU6N,GAAI,EAAG5M,GAAI,GAA7C,UACE,aAAC,IAAD,CAAOT,QAAQ,aAAf,UACE,aAAC,IAAD,CACE7E,KAAK,0BACLxF,MAAM,OACN8iD,QAAqC,SAA5BiB,EACT5+B,SAAU0/B,IALd,UAUA,aAAC,IAAD,CAAOx6C,QAAQ,aAAf,UACE,aAAC,IAAD,CACE7E,KAAK,0BACLxF,MAAM,MACN8iD,QAAqC,QAA5BiB,EACT5+B,SAAU0/B,IALd,QAUA,aAAC,IAAD,CAAOx6C,QAAQ,aAAad,GAAI,CAAEM,WAAY,UAA9C,UACE,aAAC,IAAD,CACErE,KAAK,0BACLxF,MAAM,SACN8iD,QAAqC,WAA5BiB,EACT5+B,SAAU0/B,IAEZ,aAAC,IAAD,CACEjjC,IAAKyiC,EACL96C,GAAI,CACFmK,GAAI,MACJtJ,GAAI,OACJW,MAAO,QACPZ,SAAU,KACLg6C,EAMD,GALAO,EACE,CAAE/6C,GAAI,UAAWI,YAAa,UAC9B46C,EACA,CAAE56C,YAAa,WACf,IAGRgC,KAAK,SACLmtB,IAAK,EACLqoB,IAAK,IACLt8B,KAAM,GACNggC,YAAY,SACZC,QAAS,KACPlB,EAA2B,UAC3BI,GAAgC,IAElCe,UAAWtjC,IACe,IAAD,EAAT,UAAVA,EAAEujC,MACJ,UAAAf,EAA2BviC,eAA3B,SAAoCujC,SAGxCjgC,OAAQ,IAAMg/B,GAAgC,GAC9Cj/B,SAAUtD,IACR,IACEqiC,EAA2B1kD,WAAQC,KAAKoiB,EAAEvU,OAAOtN,OAAO0gB,IAAI,MAC5D,MACAwjC,OAA2B1iD,OAzCnC,iBAkDHijD,GACC,aAAC,GAAD,4CACiC,IAC/B,aAAC,GAAD,WACG7W,EAAYtkB,IAAIi6B,GAAmBllC,SAAS,GAD/C,IACoD8kC,GAAYvf,WAK9C,OAApBkZ,QAAoB,IAApBA,OAAA,EAAAA,EAAsBxyB,UAAtB,OAAgC0yB,QAAhC,IAAgCA,OAAhC,EAAgCA,EAAqB1yB,UACrD,aAAC,GAAD,0DAGF,aAAC,IAAD,CAAMtgB,GAAI,EAAGT,GAAI,CAAEY,SAAU,SAAUP,eAAgB,SAAU84C,UAAW,UAA5E,mDAEE,aAAC,IAAD,CAAMr1C,KAAK,sCAAsCC,OAAO,SAAxD,mBAFF,mBAQA,aAAC,IAAD,CAAMjD,QAAQ,iBAAd,UACE,aAAC,IAAD,CACEA,QAAQ,SACRC,QA9NkB,KACxB+gB,EAAc,iBA8NRna,SAAUqzC,GAAoBC,EAHhC,kBAQCrD,EACC,aAAC,IAAD,CACE92C,QAAQ,UACRC,QA/PmB,KAC3B,IAAKm5C,EACH,OAGF,MAAM6B,EACwB,SAA5BvB,EACIvkD,WAAQC,KAAK,MACe,QAA5BskD,EACAvkD,WAAQC,KAAK,KACbwkD,EAEN,IAAKqB,GAAqBZ,EACxB,OAGF,MAAMa,EAAkB/lD,WAAQ+4B,IAAIjP,IAAIg8B,GAExCj6B,EAAc,kBAAmB,CAC/BuiB,cACAwI,gBAAiBqN,EAAa1iC,IAAIwkC,MA4O5Br0C,SACE08B,EAAYtjB,SACXm5B,GACDgB,GACAC,GACAF,EARJ,SAWGA,EAAgB,aAAC,IAAD,CAASj6C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,0CAGrE,aAAC,IAAD,CAAQoB,QAAQ,UAAUC,QA/QL,KAC3B+gB,EAAc,oBA8QiDna,SAAUqzC,EAAnE,SACGA,EAAmB,aAAC,IAAD,CAASh6C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,iDCjW3E,IAAMu8C,GAAqB,WAAO,IAC/Bn6B,EAAkBpP,KAAlBoP,cAMR,OACE,cAACua,GAAD,CAAYnN,UALQ,WACpBpN,EAAc,kBAId,SACE,cAACi4B,GAAD,OCZC,MAAMmC,GAA4C,EAAGC,SAAQzhD,cAClE,qCACE,cAAC,IAAD,CAAMsF,GAAI,CAAE4B,WAAY,UAAxB,SAAqClH,IADvC,OAGE,cAAC,IAAD,CAAMsF,GAAI,CAAE4B,WAAY,QAASyI,QAAS,IAA1C,SAAkD8xC,OCAzCC,GAAwB,KAAO,IAAD,IACzC,MAAM,cAAE/I,EAAF,qBAAiBE,EAAjB,oBAAuCE,EAAvC,aAA4DrhB,GAAiB1f,KAC7E2pC,EACJ9I,GAAwBE,EACpBA,EAAoBt8B,IAAIo8B,GACxBt9C,WAAQ+4B,IAEd,OACE,oCACE,cAAC,IAAD,CAAKtuB,GAAG,UAAUV,GAAI,CAAEiK,OAAQ,UAAW1I,GAAI,EAAGqC,GAAI,GAAtD,0BAIA,eAAC,IAAD,CAAK5D,GAAI,CAAEsE,GAAI,GAAf,UACE,cAACuW,GAAD,CAAWxN,MAAM,eAAjB,SACE,eAAC8M,GAAD,CACEna,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAC5C+Z,QAAQ,uBAFV,UAIE,cAAC8hC,GAAD,CAAaC,OAAO,QAApB,UACG,OAAC5I,QAAD,IAACA,IAAwBt9C,WAAQorB,MAAMvM,SAAS,KAEnD,cAAC,IAAD,CAAM9U,GAAI,CAAE4B,WAAY,QAASuM,GAAI,QAArC,eACA,cAAC+tC,GAAD,CAAaC,OAAO,YAApB,UACG,OAAC1I,QAAD,IAACA,IAAuBx9C,WAAQorB,MAAMvM,SAAS,UAKtD,cAAC+F,GAAD,CAAWxN,MAAM,qBAAjB,SACE,eAAC8M,GAAD,CACEna,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAC5C+Z,QAAQ,qBAFV,UAIE,cAAC8hC,GAAD,CAAaC,OAAO,QAApB,eACA,cAAC,IAAD,CAAMn8C,GAAI,CAAE4B,WAAY,OAAQuM,GAAI,OAApC,eACA,cAAC+tC,GAAD,CAAaC,OAAO,YAApB,SAAiCE,EAAiBvnC,SAAS,UAI/D,eAAC,IAAD,WACE,cAAC+F,GAAD,CACExN,MAAM,kBACN+M,QAAQ,yBACRE,QAAQ,OAAC+4B,QAAD,IAACA,IAAiBp9C,WAAQorB,MAAMvM,SAAS,KAGnD,cAAC+F,GAAD,CAAWxN,MAAM,cAAjB,SACE,eAAC8M,GAAD,CAAena,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAA3D,UACE,cAAC67C,GAAD,CAAaC,OAAO,OAApB,UACG,iBAAC/pB,QAAD,IAACA,OAAD,EAACA,EAAciC,mBAAf,QAA8Bp+B,WAAQs2B,UAAUzX,SAAS,KAC7C,SAInB,cAAC+F,GAAD,CAAWxN,MAAM,eAAjB,SACE,eAAC8M,GAAD,CAAena,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAA3D,UACE,cAAC67C,GAAD,CAAaC,OAAO,IAApB,UACG,iBAAC/pB,QAAD,IAACA,OAAD,EAACA,EAAcyC,kBAAf,QAA6B5+B,WAAQs2B,UAAUzX,SAAS,KAC5C,mBCpDhBwnC,GAAwB,KACnC,MAAM,cACJx6B,EADI,SAEJlP,EAFI,YAGJwB,EAHI,aAIJK,EAJI,6BAKJu9B,EALI,4BAMJF,EANI,oBAOJ5E,EAPI,UAQJj5B,EARI,qBASJs/B,EATI,oBAUJE,GACE/gC,KAEEuI,EAAe9f,sBACdgyC,EAAaoP,GAAkBphD,mBAAkBlF,WAAQorB,OACzD6oB,EAAYsS,GAAiBrhD,mBAAkBlF,WAAQorB,OACvDo7B,EAAUC,GAAevhD,mBAAkBlF,WAAQorB,OACnDqsB,EAAoBiP,GAAyBxhD,oBAAS,IACtDyhD,EAAuBC,GAA4B1hD,oBAAS,GAE7D2hD,EAAqB,OAAGroC,QAAH,IAAGA,IAAgBxe,WAAQorB,KAChD07B,EAAoB,OAAG3oC,QAAH,IAAGA,IAAene,WAAQorB,KAE9C25B,EAAgD,YAA7BpoC,EAASggC,gBAC5BoK,EAAyD,YAA9BpqC,EAASkgC,iBACpCmK,EAA6B9P,EAAY9wB,GAAGygC,GAC5CI,EAA4BhT,EAAW7tB,GAAG0gC,GAC1CI,EAA2BF,GAA8BC,EAEzDE,EAAmBlT,EAAW7tB,GAAG,GACjCghC,EAAoBlQ,EAAY9wB,GAAG,GAEnCihC,EAA0BF,IAAqBtL,EAC/CyL,EAA2BF,IAAsBrL,EACjDwL,EAAmBF,GAA2BC,EAE9ClB,EACJ9I,GAAwBE,EACpBA,EAAoBt8B,IAAIo8B,GACxBt9C,WAAQ+4B,IAwCRyuB,EAAkB,CAAC9a,EAAyBroB,KAC5CsiC,IACY,UAAVja,EAAmB6Z,EAAcH,EAAiB7kC,IAAI8C,IACvC,SAAVqoB,GAAkB4Z,EAAejiC,EAAOnD,IAAIklC,KAGzC,UAAV1Z,EAAmB4Z,EAAejiC,GACnB,SAAVqoB,GAAkB6Z,EAAcliC,IA4B3C,OAzBA3e,qBAAU,KACR,GAAIwxC,EAAYpsB,QAAUmpB,EAAWnpB,OAEnC,YADA27B,EAAYzmD,WAAQorB,MAItB,IAAIxZ,GAAY,EAEhB,MAAMsb,EAAY7d,YAAWxN,UAC3B,IACE,MAAM4lD,QAAyBxQ,EAAoBC,EAAajD,GAChE,GAAIriC,EAAW,OACf60C,EAAYgB,GACZ,MAAO/kD,GACPkB,QAAQlB,MAAM,gCACdkB,QAAQC,IAAInB,MAEb,KAEH,MAAO,KACL4qB,aAAaJ,GACbtb,GAAY,KAEb,CAACslC,EAAajD,EAAYgD,IAG3B,qCACE,cAAClyB,GAAD,CACE3N,MAAM,eACN+M,QAAQ,gBACRE,OAAQ6yB,EAAYr4B,SAAS,GAC7BtH,KAAK,QACLyN,aAAcA,EACdC,aAAciyB,EAAY11B,WAC1B0D,gBAAiBb,GAAUmjC,EAAgB,QAASxnD,WAAQC,KAAKokB,IACjEc,UAAW0hC,EAAsBrlC,WACjC4D,SAAU8xB,EAAYzqB,GAAGo6B,KAG3B,cAAC9hC,GAAD,CACE3N,MAAM,cACN+M,QAAQ,eACRE,OAAQ4vB,EAAWp1B,SAAS,GAC5BtH,KAAK,OACLyN,aAAcA,EACdC,aAAcgvB,EAAWzyB,WACzB0D,gBAAiBb,GAAUmjC,EAAgB,OAAQxnD,WAAQC,KAAKokB,IAChEc,UAAW2hC,EAAqBtlC,WAChC4D,SAAU6uB,EAAWxnB,GAAGq6B,KAG1B,cAAC,IAAD,CAAM/8C,GAAI,CAAEK,eAAgB,SAAUkB,GAAI,GAA1C,SACE,cAAC,EAAD,CAAMtF,KAAK,aAAa+E,KAAK,SAG/B,cAAC+Z,GAAD,CACE1N,MAAM,iBACN+M,QAAQ,yBACRE,OAAQmiC,EAAS3nC,SAAS,KAG5B,cAAC,IAAD,UACE,eAAC,IAAD,CAAM9U,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,IAAD,CAAUi5C,QAASqD,EAAuBhhC,SAjFR,KACnCghC,IACHL,EAAetmD,WAAQorB,MACvBm7B,EAAcvmD,WAAQorB,OAExBw7B,GAAyBc,IAAWA,OA6E9B,cAAC,IAAD,CAAM39C,GAAI,CAAE4B,WAAY,IAAKhB,SAAU,QAAvC,gDACA,cAACmU,GAAD,CACE5Q,UAAU,QACVnD,KAAK,KACL2F,QACE,eAAC,IAAD,CAAM7F,QAAQ,UAAd,2HAE6Bu7C,EAAiBvnC,SAAS,GAFvD,mBASR,cAAC,IAAD,CAAOvT,GAAI,EAAX,SACE,eAAC,IAAD,CAAMvB,GAAI,CAAEM,WAAY,UAAxB,UACE,cAAC,IAAD,CAAUi5C,QAAS7L,EAAoB9xB,SAtGR,KACrC+gC,GAAsBgB,IAAWA,OAsG3B,cAAC,IAAD,CAAM39C,GAAI,CAAE4B,WAAY,IAAKhB,SAAU,QAAvC,4CACA,cAACmU,GAAD,CACE5Q,UAAU,QACVnD,KAAK,KACL2F,QACE,cAAC,IAAD,CAAM7F,QAAQ,UAAd,4JASR,cAACs7C,GAAD,IAECe,GACC,eAAC,GAAD,6CACkC,IAC/BF,GACC,qCACE,eAAC,GAAD,WAAS9P,EAAYptB,IAAI+8B,GAAuBhoC,SAAS,GAAzD,YACCooC,GAA6B,gDAGjCA,GACC,eAAC,GAAD,WAAShT,EAAWnqB,IAAIg9B,GAAsBjoC,SAAS,GAAvD,cAKN,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEA,QAAQ,SACRC,QA7IkB,KACxB+gB,EAAc,iBA6IRna,SAAUqzC,GAAoBgC,EAHhC,kBAQEQ,EAiBA,cAAC,IAAD,CAAQ18C,QAAQ,UAAUC,QA1LL,KAC3B,MAAMy1C,EAAwB,IAAIxI,IAC9BsP,GACF9G,EAAsBoH,IAAIlkB,GAAmBhkB,KAAMzB,EAAUT,sBAE3D+pC,GACF/G,EAAsBoH,IAAIlkB,GAAmBY,MAAOrmB,EAAUT,sBAGhEsO,EAAc,kBAAmB,CAAE00B,2BAiL4B7uC,SAAUqzC,EAAnE,SACGA,EAAmB,cAAC,IAAD,CAASh6C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,iDAjBxE,cAAC,IAAD,CACEoB,QAAQ,UACRC,QAhKmB,KAC3B+gB,EAAc,kBAAmB,CAC/Bvf,OAAQ,eACR4qC,cACAjD,aACAuD,YAAagP,EACb/O,wBA2JM/lC,SACGwlC,EAAYpsB,QAAUmpB,EAAWnpB,QAClCo8B,GACAH,EANJ,SASGA,EACC,cAAC,IAAD,CAASh8C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAElC,wDCjORk6C,GAAc,IAAI5L,IAAI,CAC1B,CAACtU,GAAmBY,MAAO,SAC3B,CAACZ,GAAmBhkB,KAAM,UAGtBmoC,GAAgD,EAAG1B,SAAQzhD,cAC/D,qCACE,cAAC,IAAD,CAAMsF,GAAI,CAAE4B,WAAY,UAAxB,SAAqClH,IADvC,OAGE,cAAC,IAAD,CAAMsF,GAAI,CAAE4B,WAAY,QAASyI,QAAS,IAA1C,SAAkD8xC,OAiBhD2B,GAAQ,IAAI9P,IAAiC,CACjD,CAACtU,GAAmBY,MAAOrkC,WAAQorB,MACnC,CAACqY,GAAmBhkB,KAAMzf,WAAQorB,QAGvB08B,GAAyB,KACpC,MACM,cACJj8B,EADI,SAEJlP,EAFI,eAGJqgC,EAHI,sBAIJrF,EAJI,+BAKJsE,EALI,qBAMJiB,EANI,UAOJl/B,GACEvB,KAEEuI,EAAe9f,sBACdizC,EAAc4P,GAAa7iD,mBAAkBlF,WAAQorB,OACrDysB,EAAQmQ,GAAa9iD,mBAAsC,SAC3D+iD,EAAYC,GAAiBhjD,mBAA2C2iD,IAEzE9C,EAAgD,YAA7BpoC,EAASggC,gBAC5BwL,EAAuB,OAAGnL,QAAH,IAAGA,IAAkBh9C,WAAQorB,KACpD27B,EAAyD,YAA9BpqC,EAASkgC,iBACpCoI,EAAwB9M,EAAa/xB,GAAG+hC,GACxCC,EAAgBvQ,IAAWpU,GAAmBY,QAAU4X,EAUxDoM,EAAsBhmC,GAC1B2lC,EAlDiBxnD,KACnB,GAAc,SAAVA,EACF,MAAO,OAGT,MAAMke,EAAIkb,SAASp5B,GACnB,GAAIke,IAAM+kB,GAAmBY,OAAS3lB,IAAM+kB,GAAmBhkB,KAC7D,OAAOf,EAGT,MAAM,IAAIre,MAAO,0BAAyBG,OAwC9B8nD,CAAYjmC,EAAEvU,OAAOtN,QAiDjC,OAzBAkF,qBAAU,KACR,GAAIyyC,EAAartB,OAEf,YADAo9B,EAAyB,SAAXrQ,EAAoBgQ,GAAQ,IAAI9P,IAAI,CAAC,CAACF,EAAQ73C,WAAQorB,SAItE,IAAIxZ,GAAY,EAEhB,MAAMsb,EAAY7d,YAAWxN,UAC3B,IACE,MAAM0mD,QAA2B5Q,EAAsBQ,EAAcN,GACrE,GAAIjmC,EAAW,OACfs2C,EAAcK,GACd,MAAO7lD,GACPkB,QAAQlB,MAAM,kCACdkB,QAAQC,IAAInB,MAEb,KAEH,MAAO,KACL4qB,aAAaJ,GACbtb,GAAY,KAEb,CAACumC,EAAcR,EAAuBE,IAGvC,sCACuB,OAApBqF,QAAoB,IAApBA,OAAA,EAAAA,EAAsBl8B,UACrB,eAAC,GAAD,mBACqB,OAAdg8B,QAAc,IAAdA,OAAA,EAAAA,EAAgBh8B,UAAW,SADlC,SACkDk8B,EAAqBx7B,UADvE,sEAKF,cAACqD,GAAD,CACE3N,MAAM,iBACN+M,QAAQ,mBACRE,OAAQ8zB,EAAat5B,SAAS,GAC9BmG,aAAcA,EACdC,aAAckzB,EAAa32B,WAC3B0D,gBAAiBb,GAAU0jC,EAAU/nD,WAAQC,KAAKokB,IAClDc,UAAWgjC,EAAwB3mC,WACnC4D,SAAU+yB,EAAa1rB,GAAG07B,KAG5B,cAAC,IAAD,CAAMp+C,GAAI,CAAEK,eAAgB,SAAUkB,GAAI,GAA1C,SACE,cAAC,EAAD,CAAMtF,KAAK,aAAa+E,KAAK,SAG/B,eAAC,IAAD,CAAMhB,GAAI,CAAEK,eAAgB,SAAUkB,GAAI,GAA1C,UACGwrB,MAAM72B,KAAK0jD,GAAY6E,WAAW5mD,KAAI,EAAEgkD,EAAKM,KAC5C,eAAC,IAAD,CAAiBr7C,QAAQ,aAAzB,UACE,cAAC,IAAD,CACE7E,KAAK,yBACLxF,MAAOolD,EACPtC,QAASzL,IAAW+N,EACpBjgC,SAAU0iC,IAEXnC,IAPSN,KAWd,eAAC,IAAD,CAAkB/6C,QAAQ,aAA1B,UACE,cAAC,IAAD,CACE7E,KAAK,yBACLxF,MAAM,OACN8iD,QAAoB,SAAXzL,EACTlyB,SAAU0iC,IALd,SAAW,WAWb,cAACvjC,GAAD,CAAqB1N,MAAM,WAAW+M,QAAQ,yBAA9C,SACE,cAACU,GAAD,CAAyB9a,GAAI,CAAEK,eAAgB,cAA/C,SACG0sB,MAAM72B,KAAKgoD,EAAWO,WAAW5mD,KAAI,EAAE8qC,EAAOroB,GAAS3F,KAAlB,aACpC,eAAC,IAAMqZ,SAAP,WACGrZ,EAAI,GAAK,cAAC,IAAD,CAAM3U,GAAI,CAAE4B,WAAY,QAASuM,GAAI,QAArC,eACV,cAAC0vC,GAAD,CAAiB1B,OAAM,UAAEvC,GAAY8E,IAAI/b,UAAlB,QAA4B,GAAnD,SACGroB,EAAOxF,SAAS,OAHAH,UAU3B,cAACynC,GAAD,IAEClB,GACC,eAAC,GAAD,qDAC0C,IACxC,cAAC,GAAD,UAAS9M,EAAaruB,IAAIq+B,GAAyBtpC,SAAS,QAIhE,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CACEA,QAAQ,SACRC,QArGkB,KACxB+gB,EAAc,iBAqGRna,SAAUqzC,GAAoBgC,EAHhC,kBAQCqB,GACC,cAAC,IAAD,CACEv9C,QAAQ,UACRC,QA3ImB,KAC3B,MAAMy1C,EAAwB,IAAIxI,IAC9BqQ,GACF7H,EAAsBoH,IAAIlkB,GAAmBid,cAAe1iC,EAAUT,sBAExEsO,EAAc,kBAAmB,CAAE00B,2BAuI3B7uC,SAAUymC,EAAartB,QAAUi6B,EAHnC,SAKGA,EAAmB,cAAC,IAAD,CAASh6C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,kDAIxE2+C,GACA,cAAC,IAAD,CAAQv9C,QAAQ,UAAUC,QAxIL,KAEzB+gB,EAAc,kBADD,SAAXgsB,EAC+B,CAC/BvrC,OAAQ,kBACR6rC,eACAC,eAAgBp4C,WAAQorB,KACxBitB,cAAer4C,WAAQorB,MAGQ,CAC/B9e,OAAQ,yBACR6rC,eACAN,SACAW,UAAWx4C,WAAQorB,QA2HwC1Z,UAzKrC,EAyKpB,SACGq1C,EACC,cAAC,IAAD,CAASh8C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAElC,wDC/MDi/C,GAAsB,KAAO,IAAD,EACvC,MAAM,cACJ78B,EADI,SAEJlP,EAFI,eAGJqgC,EAHI,2BAIJb,EAJI,UAKJn+B,EALI,aAMJme,GACE1f,KAEEuI,EAAe9f,sBACd2zC,EAAa8P,GAAkBzjD,mBAAkBlF,WAAQorB,MAE1D25B,EAAgD,YAA7BpoC,EAASggC,gBAC5BwL,EAAuB,OAAGnL,QAAH,IAAGA,IAAkBh9C,WAAQorB,KACpD27B,EAAyD,YAA9BpqC,EAASkgC,iBACpCoI,EAAwBpM,EAAYzyB,GAAG+hC,GA0B7C,OACE,qCACE,cAACpjC,GAAD,CACE3N,MAAM,mBACN+M,QAAQ,WACRE,OAAQw0B,EAAYh6B,SAAS,GAC7BmG,aAAcA,EACdC,aAAc4zB,EAAYr3B,WAC1B0D,gBAAiBb,GAAUskC,EAAe3oD,WAAQC,KAAKokB,IACvDc,UAAWgjC,EAAwB3mC,WACnC4D,SAAUyzB,EAAYpsB,GAAG07B,KAG3B,cAAC,IAAD,CAAM95C,GAAI,EAAV,SACE,cAACuW,GAAD,CAAWxN,MAAM,eAAjB,SACE,eAAC8M,GAAD,CAAena,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAA3D,UACE,cAAC67C,GAAD,CAAaC,OAAO,IAApB,UACG,iBAAC/pB,QAAD,IAACA,OAAD,EAACA,EAAcyC,kBAAf,QAA6B5+B,WAAQs2B,UAAUzX,SAAS,KAC5C,WAKrB,cAAC,IAAD,CAAMwhB,GAAI,EAAGt2B,GAAI,CAAE4B,WAAY,IAAKhB,SAAU,QAA9C,6GAKCs6C,GACC,eAAC,GAAD,qDAC0C,IACxC,cAAC,GAAD,UAASpM,EAAY/uB,IAAIq+B,GAAyBtpC,SAAS,QAI/D,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAxCL,KACxB+gB,EAAc,iBAuC2Cna,SAAUq1C,EAA/D,mBAIE5K,GACA,cAAC,IAAD,CACEtxC,QAAQ,UACRC,QAnEmB,KAC3B,MAAMy1C,EAAwB,IAAIxI,IAC7BoE,GACHoE,EAAsBoH,IACpBlkB,GAAmBid,cACnB1iC,EAAUd,2BAGd2O,EAAc,kBAAmB,CAC/B00B,2BA2DM7uC,SAAUmnC,EAAY/tB,QAAUi6B,EAHlC,SAKGA,EAAmB,cAAC,IAAD,CAASh6C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,iDAIzE0yC,GACC,cAAC,IAAD,CACEtxC,QAAQ,UACRC,QAhEmB,KAC3B+gB,EAAc,kBAAmB,CAC/Bvf,OAAQ,iBACRusC,iBA8DMnnC,SAAUmnC,EAAY/tB,QAAUm6B,GAAyB8B,EAH3D,SAKGA,EACC,cAAC,IAAD,CAASh8C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAElC,wDC1GDm/C,GAA2B,KACtC,MAAM,UAAErN,GAAc9+B,KAEtB,OACE,qCACE,cAAC,IAAD,CAAKhS,GAAG,UAAUV,GAAI,CAAEiK,OAAQ,UAAW3F,GAAI,EAAG/C,GAAI,EAAGqC,GAAI,GAA7D,qBAIA,eAAC,IAAD,kBACG4tC,QADH,IACGA,OADH,EACGA,EAAW35C,KAAIinD,GAEZ,cAACjkC,GAAD,CACEP,OAAQwkC,EAAOxkC,OAAO3C,UACtBtK,MACE,eAAC,IAAD,WACGyxC,EAAO7iD,KACR,cAAC8Y,GAAD,CACE5Q,UAAU,QACVnD,KAAK,KACL2F,QAAS,eAAC,IAAD,CAAM7F,QAAQ,UAAd,mCAA+Cg+C,EAAO3pD,0BAO3D8C,IAAdu5C,GAAiD,KAAb,OAATA,QAAS,IAATA,OAAA,EAAAA,EAAW/pC,UACtC,cAAC,IAAD,iDCvBGs3C,GAAwB,KAAO,IAAD,EACzC,MAAM,cAAEj9B,EAAF,SAAiBlP,EAAjB,qBAA2BugC,EAA3B,aAAiD/gB,GAAiB1f,KAElEuI,EAAe9f,sBACd+zC,EAAe8P,GAAoB7jD,mBAAkBlF,WAAQorB,MAE9D49B,EAA6B,OAAG9L,QAAH,IAAGA,IAAwBl9C,WAAQorB,KAChE27B,EAAyD,YAA9BpqC,EAASkgC,iBACpCoI,EAAwBhM,EAAc7yB,GAAG4iC,GAa/C,OACE,qCACE,cAACjkC,GAAD,CACE3N,MAAM,mBACN+M,QAAQ,aACRE,OAAQ40B,EAAcp6B,SAAS,GAC/BmG,aAAcA,EACdC,aAAcg0B,EAAcz3B,WAC5B0D,gBAAiBb,GAAU0kC,EAAiB/oD,WAAQC,KAAKokB,IACzDc,UAAW6jC,EAA8BxnC,WACzC4D,SAAU6zB,EAAcxsB,GAAGu8B,KAG7B,cAACJ,GAAD,IAEA,cAAChkC,GAAD,CAAWxN,MAAM,eAAjB,SACE,eAAC8M,GAAD,CAAena,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAA3D,UACE,cAAC67C,GAAD,CAAaC,OAAO,IAApB,UACG,iBAAC/pB,QAAD,IAACA,OAAD,EAACA,EAAcyC,kBAAf,QAA6B5+B,WAAQs2B,UAAUzX,SAAS,KAC5C,SAInB,cAAC,IAAD,CAAMvT,GAAI,EAAGvB,GAAI,CAAE4B,WAAY,IAAKhB,SAAU,QAA9C,4KAKCs6C,GACC,eAAC,GAAD,qDAC0C,IACxC,cAAC,GAAD,UAAShM,EAAcnvB,IAAIk/B,GAA+BnqC,SAAS,QAIvE,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAxCL,KACxB+gB,EAAc,iBAuC2Cna,SAAUq1C,EAA/D,kBAIA,cAAC,IAAD,CACEl8C,QAAQ,UACRC,QArDqB,KAC3B+gB,EAAc,kBAAmB,CAC/Bvf,OAAQ,mBACR2sC,mBAmDIvnC,SAAUunC,EAAcnuB,QAAUm6B,GAAyB8B,EAH7D,SAKGA,EAA2B,cAAC,IAAD,CAASh8C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAAgB,wDCpE3Ew/C,GAAwB,KAAO,IAAD,EACzC,MAAM,cAAEp9B,EAAF,SAAiBlP,EAAjB,UAA2B4+B,EAA3B,aAAsCpf,GAAiB1f,KAEvDsqC,EAAyD,YAA9BpqC,EAASkgC,iBACpCqM,OAAgElnD,KAA1C,OAATu5C,QAAS,IAATA,OAAA,EAAAA,EAAWp7C,MAAK0oD,GAAUA,EAAOxkC,OAAO+B,GAAG,MAY9D,OACE,qCACE,cAACwiC,GAAD,IAEA,cAAChkC,GAAD,CAAWxN,MAAM,eAAjB,SACE,eAAC8M,GAAD,CAAena,GAAI,CAAEM,WAAY,SAAUD,eAAgB,cAA3D,UACE,cAAC67C,GAAD,CAAaC,OAAO,IAApB,UACG,iBAAC/pB,QAAD,IAACA,OAAD,EAACA,EAAcyC,kBAAf,QAA6B5+B,WAAQs2B,UAAUzX,SAAS,KAC5C,SAInB,eAAC,IAAD,CAAMhU,QAAQ,iBAAd,UACE,cAAC,IAAD,CAAQA,QAAQ,SAASC,QAjBL,KACxB+gB,EAAc,iBAgB2Cna,SAAUq1C,EAA/D,kBAIA,cAAC,IAAD,CAAQl8C,QAAQ,UAAUC,QA3BH,KAC3B+gB,EAAc,kBAAmB,CAC/Bvf,OAAQ,oBAyBmDoF,UAAWw3C,EAApE,SACGnC,EACC,cAAC,IAAD,CAASh8C,KAAK,OAAOhB,GAAI,CAAEN,MAAO,WAElC,kEC/BNoZ,GAA4B,EAAG/V,SAAQrI,cAAake,KACxD,cAAC,IAAD,IAAaA,EAAO5Y,GAAI,CAAEiK,OAAQ,aAAelH,EAAS,CAAErD,MAAO,WAAc,IAAjF,SACGhF,IAIQ0kD,GAA8B,KACzC,MAAM,cAAEt9B,GAAkBpP,MACnB2sC,EAAcC,GAAmBnkD,mBAEtC,WAEIokC,EAAgB,KACpBzd,EAAc,kBAGhB,OACE,eAACua,GAAD,CAAYnN,UAAWqQ,EAAvB,UACE,eAAC,IAAD,CAAS7+B,GAAG,KAAKV,GAAI,CAAEoY,GAAI,EAAG3X,GAAI,EAAGI,GAAI,GAAzC,UACE,cAAC,IAAD,CAAMb,GAAI,CAAEK,eAAgB,UAA5B,8BACA,cAAC,IAAD,CACEU,QAASw+B,EACTv/B,GAAI,CACF2F,SAAU,WACVsH,MAAO,OACP3B,IAAK,aAKX,eAAC,IAAD,CAAM5K,GAAG,MAAMV,GAAI,CAAEuB,GAAI,GAAzB,UACE,cAAC,GAAD,CAAMwB,OAAyB,YAAjBs8C,EAA4Bt+C,QAAS,IAAMu+C,EAAgB,WAAzE,qBAIA,cAAC,GAAD,CAAMv8C,OAAyB,aAAjBs8C,EAA6Bt+C,QAAS,IAAMu+C,EAAgB,YAA1E,sBAIA,cAAC,GAAD,CAAMv8C,OAAyB,UAAjBs8C,EAA0Bt+C,QAAS,IAAMu+C,EAAgB,SAAvE,mBAIA,cAAC,GAAD,CAAMv8C,OAAyB,YAAjBs8C,EAA4Bt+C,QAAS,IAAMu+C,EAAgB,WAAzE,qBAIA,cAAC,GAAD,CAAMv8C,OAAyB,UAAjBs8C,EAA0Bt+C,QAAS,IAAMu+C,EAAgB,SAAvE,wBAKgB,YAAjBD,GAA8B,cAAC/C,GAAD,IACb,aAAjB+C,GAA+B,cAACtB,GAAD,IACd,UAAjBsB,GAA4B,cAACV,GAAD,IACX,YAAjBU,GAA8B,cAACN,GAAD,IACb,UAAjBM,GAA4B,cAACH,GAAD,QC5DtBK,GAAkB,KAC7B,MAAM,KAAE55B,EAAF,kBAAQsvB,GAAsBviC,KAEpC,IAAKuiC,EACH,OACE,cAAC,IAAD,CAAWj1C,GAAI,CAAE2F,SAAU,WAAY0F,KAAM,MAAOC,IAAK,OAAzD,SACE,cAAC,GAAD,CAAazL,MAAM,sBAAnB,qEAON,IAAI2/C,EAAO,KACX,OAAQ75B,GACN,IAAK,aACL,IAAK,WACH65B,EAAO,cAAClgB,GAAD,IACP,MAEF,IAAK,WACHkgB,EAAO,cAAC,GAAD,IACP,MAEF,IAAK,WACHA,EAAO,cAAC,GAAD,IACP,MAEF,IAAK,qBACHA,EAAO,cAACJ,GAAD,IAKX,OACE,qCACE,cAAChkB,GAAD,IACCokB,MChCP,IAAMC,GAAwD,CAC5DnnB,KAAM,OACNzlB,QAAS,yBACT6sC,OAAQ,SACRC,UAAW,aAGAJ,GAAkB,WAAO,IAC5B3sC,EAAaF,KAAbE,SACFgtC,EAAe/mD,OAAOgnD,KAAKjtC,GAAgCxc,MAC/D,SAAAgE,GAAM,MAAyB,SAArBwY,EAASxY,MAEfA,EAASwlD,EAAcH,GAAU7sC,EAASgtC,IAAgB,KAEhE,OACE,qCACE,eAAC,IAAD,CAAW9+C,QAAQ,UAAUd,GAAI,CAAEK,eAAgB,cAAnD,UACE,cAAC,IAAD,CAAWS,QAAQ,OAAOd,GAAI,CAAEwB,MAAO,CAAC,OAAQ,QAAhD,SACE,cAAC,GAAD,MAGF,cAAC,IAAD,CAAWV,QAAQ,QAAQd,GAAI,CAAEwB,MAAO,CAAC,OAAQ,QAAjD,SACE,cAAC0yB,GAAD,SAGH95B,GAAU,cAAC,GAAD,CAAmBkI,MAAOlI,EAAQkF,MAAO,CAAEwO,OAAQ,kBChC9DuqB,GAAqC,CACzCynB,KAAM,CACJC,mBAAoB,UACpBC,aAAc,UAEhBC,WAAY,CACVF,mBAAoB,UACpBG,iCAAkC,OAClCF,aAAc,UAEhBG,SAAU,CACRJ,mBAAoB,UACpBG,iCAAkC,OAClCF,aAAc,UAEhBI,QAAS,CACPC,4BAA6B,OAC7BL,aAAc,UAEhBM,UAAW,CACTD,4BAA6B,SAC7BE,eAAgB,SAChBC,aAAc,OACdC,iBAAkB,aAClBC,eAAgB,YAElBC,QAAS,CACPN,4BAA6B,SAC7BG,aAAc,OACdD,eAAgB,SAChBE,iBAAkB,aAClBC,eAAgB,YAElBE,OAAQ,CACNC,qBAAsB,YACtBC,oBAAqB,UACrBN,aAAc,OACdC,iBAAkB,aAClBC,eAAgB,aAMdK,GAAsC,CAC1C3mB,KAAM,eACN4mB,cAAe,eACfC,oBAAqB,mBACrBC,mBAAoB,kBAqBhBhtC,GAAS,SAAC,GAAD,SAAG+L,MAAS7lB,QAEd+mD,GAA8B,SAAAvoC,GAAU,IAC3Cle,EAAake,EAAble,SACF0mD,EAAc7sC,8BAAmBL,IAFW,EAI1B/Y,mBAnBH,SAACimD,GACtB,MAAoB,wBAAhBA,EACK,aAEW,uBAAhBA,EACK,WAEW,SAAhBA,EACK,SAEF,OASqCC,CAAeD,IAJT,mBAI3Cz7B,EAJ2C,KAIrCirB,EAJqC,KAK5CC,EAAU14B,iBAAkBwN,GAE5B7D,EAAgBvb,uBAAY,SAACuV,GACjC,IAAMs7B,EA5BS,SAACzxB,EAAiB7J,GAAkC,IAAD,EAEpE,OADc,UAAGuc,GAAY1S,GAAM7J,UAArB,QAA+B6J,EA2B1B0xB,CAAWxG,EAAQt4B,QAASuD,GAE7CjiB,QAAQC,IACN,mDACA+2C,EAAQt4B,QACRuD,EACAs7B,GAEFxG,EAAQwG,KACP,IAEHz7C,qBAAU,WACRk1C,EAAQt4B,QAAUoN,IACjB,CAACA,IAEJhqB,qBAAU,WAAO,IAAD,EACRmgB,EAAK,UAAGilC,GAAkBK,UAArB,QAAqC,KAClC,OAAVtlC,GACFgG,EAAchG,KAEf,CAACslC,EAAat/B,IAEjB,IAAM/mB,EAAW,CACf4qB,OACA7D,iBAEF,OAAO,cAAC7D,GAAiBlhB,SAAlB,CAA2BtG,MAAOsE,EAAlC,SAA6CL,KCtGhD29B,GAAyC,CAC7CynB,KAAM,CACJwB,gBAAiB,cAEnBC,WAAY,CACVC,eAAgB,OAChBC,kBAAmB,UAErBb,OAAQ,CACNc,gBAAiB,SACjBC,uBAAwB,YACxBC,gBAAiB,QAEnBtB,UAAW,CACTkB,eAAgB,SAChBC,kBAAmB,SACnBG,gBAAiB,SAaf1tC,GAAS,SAAC,GAAD,SAAGoT,kBAELu6B,GAAkC,SAAAjpC,GAAU,IAC/Cle,EAAake,EAAble,SACF4sB,EAAmB/S,8BAAmBL,IAFU,EAI9B/Y,mBAVH,SAACmsB,GACtB,OAAOA,EAAiBlK,QAAU,OAAS,SASKikC,CAAe/5B,IAJT,mBAI/C3B,EAJ+C,KAIzCirB,EAJyC,KAKhDC,EAAU14B,iBAAsBwN,GAEhC7D,EAAgBvb,uBAAY,SAACuV,GACjC,IAAMs7B,EAnBS,SAACzxB,EAAqB7J,GAA0C,IAAD,EAEhF,OADc,UAAGuc,GAAY1S,GAAM7J,UAArB,QAA+B6J,EAkB1B0xB,CAAWxG,EAAQt4B,QAASuD,GAE7CjiB,QAAQC,IACN,mDACA+2C,EAAQt4B,QACRuD,EACAs7B,GAEFxG,EAAQwG,KACP,IAEHz7C,qBAAU,WACRk1C,EAAQt4B,QAAUoN,IACjB,CAACA,IAEJhqB,qBAAU,WACJ2rB,EAAiBlK,SACnB0E,EAAc,qBAEf,CAACwF,EAAiBlK,QAAS0E,IAE9B,IAAM/mB,EAAW,CACf4qB,OACA7D,iBAGF,OAAO,cAACiF,GAAqBhqB,SAAtB,CAA+BtG,MAAOsE,EAAtC,SAAiDL,KCxDpDslB,GAAO,SAAC,GAAD,MAAiE,CAC5E+K,UADW,EAAGA,UAEd9N,eAAe,EACf6kC,WAAW,IAGPxhC,GAAS,SACbhe,EACAC,GAKA,OAAQA,EAAOC,MACb,IAAK,iBACH,OAAO,2BAAKF,GAAZ,IAAmBw/C,WAAW,IAEhC,IAAK,kBACH,OAAO,2BAAKx/C,GAAZ,IAAmBw/C,WAAW,IAEhC,IAAK,cACH,OAAO,2BAAKx/C,GAAZ,IAAmB2a,eAAe,IAEpC,IAAK,cACH,OAAO,2BAAK3a,GAAZ,IAAmB2a,eAAe,IAEpC,IAAK,cAAgB,IAEM8kC,EAErBx/C,EAFFy/C,SAAYj3B,UACca,EACxBrpB,EADF2e,YAAe6J,UAGjB,GAAIa,EAAc,CAChB,IAAM3K,GACH2K,EAAaR,WAAW1I,GAAGq/B,EAAS32B,aACrCQ,EAAarF,eAAe3J,GAAGmlC,EAASx7B,iBACxCqF,EAAaX,SAASrO,GAAGmlC,EAAS92B,UAEpC,OAAO,2BACF3oB,GADL,IAEEyoB,UAAWa,EACXk2B,WAAW,EACX7kC,eAAegE,GAA0B3e,EAAM2a,iBAMvD,OAAO3a,GAGI2/C,GAAgC,SAAC,GAAkB,IAAhBvnD,EAAe,EAAfA,SACxCwnD,EAA0B/7C,GAAsB,SADO,EAEDyb,6BAAkBtB,GAAQN,IAFzB,0BAEpD8hC,EAFoD,EAEpDA,UAAW7kC,EAFyC,EAEzCA,cAAe8N,EAF0B,EAE1BA,UAAavnB,EAFa,KAkB7D,OAdA7H,qBAAU,WAE2B,uBAAjCumD,EAAwB1/C,MACS,2BAAjC0/C,EAAwB1/C,KAExBgB,EAAS,CAAEhB,KAAM,gBAEgB,WAAjC0/C,EAAwB1/C,MACS,cAAjC0/C,EAAwB1/C,MAExBgB,EAAS,CAAEhB,KAAM,kBAElB,CAAC0/C,EAAwB1/C,KAAMgB,IAGhC,cAAConB,GAAmB7tB,SAApB,CACEtG,MAAO,CACLkvB,KAAMm8B,EAAY,YAAc/2B,EAAU3N,QAAU,OAAS,SAC7DH,gBACAzZ,YAJJ,SAOG9I,KC9FMynD,I,OAA0B,SAAC,GAAkB,IAAhBznD,EAAe,EAAfA,SACxC,OACE,cAACsZ,GAAD,UACE,cAAC28B,GAAD,UAAmBj2C,QCqBZ0nD,GAAkD,SAAC,GAAgB,IAAdznD,EAAa,EAAbA,OAAa,EACtCqC,IAA/B/B,EADqE,EACrEA,QAASF,EAD4D,EAC5DA,SAAU2B,EADkD,EAClDA,QAa3B,OAVA7D,OAAOC,OAAOwD,OAAQ,CACpBrB,UACAF,WACA2B,UACAwjB,eACAjqB,mBACAqnB,yBACAvnB,mBAIA,eAAC,wBAAD,CAA4B4E,SAAUkC,MAAOH,EAAQG,MAArD,UACE,cAAC,KAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,cAAC,GAAD,UACE,eAAC,IAAD,CAAMmD,GAAI,CAAEqB,cAAe,SAAU2M,UAAW,QAAhD,UACE,eAAC,GAAD,WACE,cAAC,GAAD,IACA,cAAC,GAAD,OAGF,cAAC,IAAD,CACElN,QAAQ,OACRd,GAAI,CACFgK,QAAS,OACT2Q,SAAU,EACVtZ,cAAe,SACff,WAAY,UANhB,SASE,eAAC,KAAD,WACE,cAAC,KAAD,CAAO46B,KAAK,IAAIriB,OAAK,EAArB,SACE,cAAC,GAAD,MAEF,cAAC,KAAD,CAAOqiB,KAAK,SAAZ,SACE,cAAC,GAAD,MAEF,cAAC,KAAD,CAAOA,KAAK,gBAAZ,SACE,cAAC,GAAD,wBAUlB,cAACtzB,GAAD,QC/EOy6C,GAAY,kBACvB,eAAC,IAAD,CAAMriD,GAAI,CAAEM,WAAY,SAAUD,eAAgB,SAAUF,OAAQ,SAApE,UACE,cAAC,IAAD,CAASH,GAAI,CAAE4O,EAAG,EAAGlP,MAAO,QAAUsB,KAAK,SAC3C,cAAC,IAAD,6BCgBJ,GALI1E,OAAOoH,UAET7K,OAAOC,OAAOwD,OAAOoH,SAAU,CAAE4+C,4BAA4B,IAGvB,SAApCxqC,iMAAYyqC,oBAAgC,CAC9C,IAAM7+C,GAAW,IAAIrO,KACnByiB,iMAAY0qC,mBAAZ,iBAA2ClmD,OAAOC,SAASC,SAA3D,SACA,sEAGF3D,OAAOC,OAAOwD,OAAQ,CAAEoH,cAI1BrJ,IAAYuB,MAAK,SAAAlC,GAGfb,OAAOC,OAAOwD,OAAQ,CAAE5C,cAG1B,IAAM+oD,GAAoC,SAAC,GAAkB,IAAhB/nD,EAAe,EAAfA,SAC3C,OACE,cAAC,IAAD,CAAmBgoD,WAAY,SAAA3nD,GAAQ,OAAI,IAAI4nD,wCAAsC5nD,IAArF,SACGL,KAKDkoD,GAAuC,kBAC3C,eAAC,IAAD,CACE5iD,GAAI,CACFqB,cAAe,SACff,WAAY,SACZD,eAAgB,SAChBF,OAAQ,QACRQ,UAAW,UANf,UASE,eAAC,IAAD,CAASX,GAAI,CAAEuB,GAAI,GAAnB,UACE,cAAC,EAAD,CAAMtF,KAAK,yBADb,6CAIA,cAAC,IAAD,CAAW+D,GAAI,CAAEuB,GAAI,GAArB,sFAIA,eAAC,IAAD,0FAC+E,IAC7E,eAAC,IAAD,CAAMuC,KAAK,mCAAX,kBACO,cAAC,EAAD,CAAM7H,KAAK,oBAAoB+E,KAAK,UAH7C,WAgDW6hD,GAtCH,WAmBV,OACE,cAAC,GAAD,UACE,cAAC,IAAD,CAAer3C,MAAOA,GAAtB,SACE,cAAC,EAAD,CAAiB7Q,OAAQ,cAAC,GAAD,IAAzB,SACE,cAAC,EAAD,CACEA,OAAQ,cAAC,GAAD,IACRC,2BAxByB,SAACM,GAAD,OACjC,eAAC,IAAD,CACE8E,GAAI,CACFqB,cAAe,SACff,WAAY,SACZD,eAAgB,SAChBF,OAAQ,QACRQ,UAAW,UANf,UASE,eAAC,IAAD,CAASX,GAAI,CAAEuB,GAAI,GAAnB,UACE,cAAC,EAAD,CAAMtF,KAAK,yBADb,kCACsE,IACvD,IAAZf,EAAgB,UAAY,eAF/B,OATF,kEAwBQL,2BAA4B,cAAC,GAAD,IAH9B,SAKE,cAACmL,GAAD,UACE,cAAC,GAAD,CAAiBrL,OAAQ,cAAC,GAAD,iBC/FvCyH,IAAM0gD,cAAc,SAEpBC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEFC,SAASC,eAAe,W","file":"static/js/main.461e7f62.chunk.js","sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connect = exports._connectByChainId = exports._connectToDeployment = exports.UnsupportedNetworkError = exports._usingStore = exports._requireFrontendAddress = exports._requireAddress = exports._getProvider = exports._requireSigner = exports._getBlockTimestamp = exports._getContracts = void 0;\r\nconst abstract_signer_1 = require(\"@ethersproject/abstract-signer\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst dev_json_1 = __importDefault(require(\"../deployments/dev.json\"));\r\nconst goerli_json_1 = __importDefault(require(\"../deployments/goerli.json\"));\r\nconst kovan_json_1 = __importDefault(require(\"../deployments/kovan.json\"));\r\nconst rinkeby_json_1 = __importDefault(require(\"../deployments/rinkeby.json\"));\r\nconst ropsten_json_1 = __importDefault(require(\"../deployments/ropsten.json\"));\r\nconst mainnet_json_1 = __importDefault(require(\"../deployments/mainnet.json\"));\r\nconst kiln_json_1 = __importDefault(require(\"../deployments/kiln.json\"));\r\nconst _utils_1 = require(\"./_utils\");\r\nconst contracts_1 = require(\"./contracts\");\r\nconst _Multicall_1 = require(\"./_Multicall\");\r\nconst dev = dev_json_1.default;\r\nconst deployments = {\r\n    [mainnet_json_1.default.chainId]: mainnet_json_1.default,\r\n    [ropsten_json_1.default.chainId]: ropsten_json_1.default,\r\n    [rinkeby_json_1.default.chainId]: rinkeby_json_1.default,\r\n    [goerli_json_1.default.chainId]: goerli_json_1.default,\r\n    [kovan_json_1.default.chainId]: kovan_json_1.default,\r\n    [kiln_json_1.default.chainId]: kiln_json_1.default,\r\n    ...(dev !== null ? { [dev.chainId]: dev } : {})\r\n};\r\nconst branded = (t) => t;\r\nconst connectionFrom = (provider, signer, _contracts, _multicall, { deploymentDate, totalStabilityPoolLQTYReward, liquidityMiningLQTYRewardRate, ...deployment }, optionalParams) => {\r\n    if (optionalParams &&\r\n        optionalParams.useStore !== undefined &&\r\n        !validStoreOptions.includes(optionalParams.useStore)) {\r\n        throw new Error(`Invalid useStore value ${optionalParams.useStore}`);\r\n    }\r\n    return branded({\r\n        provider,\r\n        signer,\r\n        _contracts,\r\n        _multicall,\r\n        deploymentDate: new Date(deploymentDate),\r\n        totalStabilityPoolLQTYReward: lib_base_1.Decimal.from(totalStabilityPoolLQTYReward),\r\n        liquidityMiningLQTYRewardRate: lib_base_1.Decimal.from(liquidityMiningLQTYRewardRate),\r\n        ...deployment,\r\n        ...optionalParams\r\n    });\r\n};\r\n/** @internal */\r\nconst _getContracts = (connection) => connection._contracts;\r\nexports._getContracts = _getContracts;\r\nconst getMulticall = (connection) => connection._multicall;\r\nconst getTimestampFromBlock = ({ timestamp }) => timestamp;\r\n/** @internal */\r\nconst _getBlockTimestamp = (connection, blockTag = \"latest\") => { var _a, _b; return (_b = (_a = \r\n// Get the timestamp via a contract call whenever possible, to make it batchable with other calls\r\ngetMulticall(connection)) === null || _a === void 0 ? void 0 : _a.getCurrentBlockTimestamp({ blockTag }).then(_utils_1.numberify)) !== null && _b !== void 0 ? _b : exports._getProvider(connection).getBlock(blockTag).then(getTimestampFromBlock); };\r\nexports._getBlockTimestamp = _getBlockTimestamp;\r\n/** @internal */\r\nconst _requireSigner = (connection) => { var _a; return (_a = connection.signer) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"Must be connected through a Signer\")); };\r\nexports._requireSigner = _requireSigner;\r\n/** @internal */\r\nconst _getProvider = (connection) => connection.provider;\r\nexports._getProvider = _getProvider;\r\n// TODO parameterize error message?\r\n/** @internal */\r\nconst _requireAddress = (connection, overrides) => { var _a, _b; return (_b = (_a = overrides === null || overrides === void 0 ? void 0 : overrides.from) !== null && _a !== void 0 ? _a : connection.userAddress) !== null && _b !== void 0 ? _b : _utils_1.panic(new Error(\"A user address is required\")); };\r\nexports._requireAddress = _requireAddress;\r\n/** @internal */\r\nconst _requireFrontendAddress = (connection) => { var _a; return (_a = connection.frontendTag) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"A frontend address is required\")); };\r\nexports._requireFrontendAddress = _requireFrontendAddress;\r\n/** @internal */\r\nconst _usingStore = (connection) => connection.useStore !== undefined;\r\nexports._usingStore = _usingStore;\r\n/**\r\n * Thrown when trying to connect to a network where Liquity is not deployed.\r\n *\r\n * @remarks\r\n * Thrown by {@link ReadableEthersLiquity.(connect:2)} and {@link EthersLiquity.(connect:2)}.\r\n *\r\n * @public\r\n */\r\nclass UnsupportedNetworkError extends Error {\r\n    /** @internal */\r\n    constructor(chainId) {\r\n        super(`Unsupported network (chainId = ${chainId})`);\r\n        this.name = \"UnsupportedNetworkError\";\r\n        this.chainId = chainId;\r\n    }\r\n}\r\nexports.UnsupportedNetworkError = UnsupportedNetworkError;\r\nconst getProviderAndSigner = (signerOrProvider) => {\r\n    var _a;\r\n    const provider = abstract_signer_1.Signer.isSigner(signerOrProvider)\r\n        ? (_a = signerOrProvider.provider) !== null && _a !== void 0 ? _a : _utils_1.panic(new Error(\"Signer must have a Provider\")) : signerOrProvider;\r\n    const signer = abstract_signer_1.Signer.isSigner(signerOrProvider) ? signerOrProvider : undefined;\r\n    return [provider, signer];\r\n};\r\n/** @internal */\r\nconst _connectToDeployment = (deployment, signerOrProvider, optionalParams) => connectionFrom(...getProviderAndSigner(signerOrProvider), contracts_1._connectToContracts(signerOrProvider, deployment), undefined, deployment, optionalParams);\r\nexports._connectToDeployment = _connectToDeployment;\r\nconst validStoreOptions = [\"blockPolled\"];\r\n/** @internal */\r\nfunction _connectByChainId(provider, signer, chainId, optionalParams) {\r\n    var _a;\r\n    const deployment = (_a = deployments[chainId]) !== null && _a !== void 0 ? _a : _utils_1.panic(new UnsupportedNetworkError(chainId));\r\n    return connectionFrom(provider, signer, contracts_1._connectToContracts(signer !== null && signer !== void 0 ? signer : provider, deployment), _Multicall_1._connectToMulticall(signer !== null && signer !== void 0 ? signer : provider, chainId), deployment, optionalParams);\r\n}\r\nexports._connectByChainId = _connectByChainId;\r\n/** @internal */\r\nconst _connect = async (signerOrProvider, optionalParams) => {\r\n    const [provider, signer] = getProviderAndSigner(signerOrProvider);\r\n    if (signer) {\r\n        if ((optionalParams === null || optionalParams === void 0 ? void 0 : optionalParams.userAddress) !== undefined) {\r\n            throw new Error(\"Can't override userAddress when connecting through Signer\");\r\n        }\r\n        optionalParams = {\r\n            ...optionalParams,\r\n            userAddress: await signer.getAddress()\r\n        };\r\n    }\r\n    return _connectByChainId(provider, signer, (await provider.getNetwork()).chainId, optionalParams);\r\n};\r\nexports._connect = _connect;\r\n//# sourceMappingURL=EthersLiquityConnection.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Percent = exports.Difference = exports.Decimal = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst bignumber_1 = require(\"@ethersproject/bignumber\");\r\nconst getDigits = (numDigits) => TEN.pow(numDigits);\r\nconst MAX_UINT_256 = \"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\";\r\nconst PRECISION = 18;\r\nconst ONE = bignumber_1.BigNumber.from(1);\r\nconst TEN = bignumber_1.BigNumber.from(10);\r\nconst DIGITS = getDigits(PRECISION);\r\nconst stringRepresentationFormat = /^[0-9]*(\\.[0-9]*)?(e[-+]?[0-9]+)?$/;\r\nconst trailingZeros = /0*$/;\r\nconst magnitudes = [\"\", \"K\", \"M\", \"B\", \"T\"];\r\nconst roundedMul = (x, y) => x.mul(y).add(Decimal.HALF.hex).div(DIGITS);\r\n/**\r\n * Fixed-point decimal bignumber with 18 digits of precision.\r\n *\r\n * @remarks\r\n * Used by Liquity libraries to precisely represent native currency (e.g. Ether), LUSD and LQTY\r\n * amounts, as well as derived metrics like collateral ratios.\r\n *\r\n * @public\r\n */\r\nclass Decimal {\r\n    constructor(bigNumber) {\r\n        if (bigNumber.isNegative()) {\r\n            throw new Error(\"negatives not supported by Decimal\");\r\n        }\r\n        this._bigNumber = bigNumber;\r\n    }\r\n    /** @internal */\r\n    get hex() {\r\n        return this._bigNumber.toHexString();\r\n    }\r\n    /** @internal */\r\n    get bigNumber() {\r\n        return this._bigNumber.toString();\r\n    }\r\n    static fromBigNumberString(bigNumberString) {\r\n        return new Decimal(bignumber_1.BigNumber.from(bigNumberString));\r\n    }\r\n    static _fromString(representation) {\r\n        if (!representation || !representation.match(stringRepresentationFormat)) {\r\n            throw new Error(`bad decimal format: \"${representation}\"`);\r\n        }\r\n        if (representation.includes(\"e\")) {\r\n            // eslint-disable-next-line prefer-const\r\n            let [coefficient, exponent] = representation.split(\"e\");\r\n            if (exponent.startsWith(\"-\")) {\r\n                return new Decimal(Decimal._fromString(coefficient)._bigNumber.div(TEN.pow(bignumber_1.BigNumber.from(exponent.substr(1)))));\r\n            }\r\n            if (exponent.startsWith(\"+\")) {\r\n                exponent = exponent.substr(1);\r\n            }\r\n            return new Decimal(Decimal._fromString(coefficient)._bigNumber.mul(TEN.pow(bignumber_1.BigNumber.from(exponent))));\r\n        }\r\n        if (!representation.includes(\".\")) {\r\n            return new Decimal(bignumber_1.BigNumber.from(representation).mul(DIGITS));\r\n        }\r\n        // eslint-disable-next-line prefer-const\r\n        let [characteristic, mantissa] = representation.split(\".\");\r\n        if (mantissa.length < PRECISION) {\r\n            mantissa += \"0\".repeat(PRECISION - mantissa.length);\r\n        }\r\n        else {\r\n            mantissa = mantissa.substr(0, PRECISION);\r\n        }\r\n        return new Decimal(bignumber_1.BigNumber.from(characteristic || 0)\r\n            .mul(DIGITS)\r\n            .add(mantissa));\r\n    }\r\n    static from(decimalish) {\r\n        switch (typeof decimalish) {\r\n            case \"object\":\r\n                if (decimalish instanceof Decimal) {\r\n                    return decimalish;\r\n                }\r\n                else {\r\n                    throw new Error(\"invalid Decimalish value\");\r\n                }\r\n            case \"string\":\r\n                return Decimal._fromString(decimalish);\r\n            case \"number\":\r\n                return Decimal._fromString(decimalish.toString());\r\n            default:\r\n                throw new Error(\"invalid Decimalish value\");\r\n        }\r\n    }\r\n    _toStringWithAutomaticPrecision() {\r\n        const characteristic = this._bigNumber.div(DIGITS);\r\n        const mantissa = this._bigNumber.mod(DIGITS);\r\n        if (mantissa.isZero()) {\r\n            return characteristic.toString();\r\n        }\r\n        else {\r\n            const paddedMantissa = mantissa.toString().padStart(PRECISION, \"0\");\r\n            const trimmedMantissa = paddedMantissa.replace(trailingZeros, \"\");\r\n            return characteristic.toString() + \".\" + trimmedMantissa;\r\n        }\r\n    }\r\n    _roundUp(precision) {\r\n        const halfDigit = getDigits(PRECISION - 1 - precision).mul(5);\r\n        return this._bigNumber.add(halfDigit);\r\n    }\r\n    _toStringWithPrecision(precision) {\r\n        if (precision < 0) {\r\n            throw new Error(\"precision must not be negative\");\r\n        }\r\n        const value = precision < PRECISION ? this._roundUp(precision) : this._bigNumber;\r\n        const characteristic = value.div(DIGITS);\r\n        const mantissa = value.mod(DIGITS);\r\n        if (precision === 0) {\r\n            return characteristic.toString();\r\n        }\r\n        else {\r\n            const paddedMantissa = mantissa.toString().padStart(PRECISION, \"0\");\r\n            const trimmedMantissa = paddedMantissa.substr(0, precision);\r\n            return characteristic.toString() + \".\" + trimmedMantissa;\r\n        }\r\n    }\r\n    toString(precision) {\r\n        if (this.infinite) {\r\n            return \"∞\";\r\n        }\r\n        else if (precision !== undefined) {\r\n            return this._toStringWithPrecision(precision);\r\n        }\r\n        else {\r\n            return this._toStringWithAutomaticPrecision();\r\n        }\r\n    }\r\n    prettify(precision = 2) {\r\n        const [characteristic, mantissa] = this.toString(precision).split(\".\");\r\n        const prettyCharacteristic = characteristic.replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1,\");\r\n        return mantissa !== undefined ? prettyCharacteristic + \".\" + mantissa : prettyCharacteristic;\r\n    }\r\n    shorten() {\r\n        const characteristicLength = this.toString(0).length;\r\n        const magnitude = Math.min(Math.floor((characteristicLength - 1) / 3), magnitudes.length - 1);\r\n        const precision = Math.max(3 * (magnitude + 1) - characteristicLength, 0);\r\n        const normalized = this.div(new Decimal(getDigits(PRECISION + 3 * magnitude)));\r\n        return normalized.prettify(precision) + magnitudes[magnitude];\r\n    }\r\n    add(addend) {\r\n        return new Decimal(this._bigNumber.add(Decimal.from(addend)._bigNumber));\r\n    }\r\n    sub(subtrahend) {\r\n        return new Decimal(this._bigNumber.sub(Decimal.from(subtrahend)._bigNumber));\r\n    }\r\n    mul(multiplier) {\r\n        return new Decimal(this._bigNumber.mul(Decimal.from(multiplier)._bigNumber).div(DIGITS));\r\n    }\r\n    div(divider) {\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(DIGITS).div(divider._bigNumber));\r\n    }\r\n    /** @internal */\r\n    _divCeil(divider) {\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(DIGITS).add(divider._bigNumber.sub(ONE)).div(divider._bigNumber));\r\n    }\r\n    mulDiv(multiplier, divider) {\r\n        multiplier = Decimal.from(multiplier);\r\n        divider = Decimal.from(divider);\r\n        if (divider.isZero) {\r\n            return Decimal.INFINITY;\r\n        }\r\n        return new Decimal(this._bigNumber.mul(multiplier._bigNumber).div(divider._bigNumber));\r\n    }\r\n    pow(exponent) {\r\n        assert_1.default(Number.isInteger(exponent));\r\n        assert_1.default(0 <= exponent && exponent <= 0xffffffff); // Ensure we're safe to use bitwise ops\r\n        if (exponent === 0) {\r\n            return Decimal.ONE;\r\n        }\r\n        if (exponent === 1) {\r\n            return this;\r\n        }\r\n        let x = this._bigNumber;\r\n        let y = DIGITS;\r\n        for (; exponent > 1; exponent >>>= 1) {\r\n            if (exponent & 1) {\r\n                y = roundedMul(x, y);\r\n            }\r\n            x = roundedMul(x, x);\r\n        }\r\n        return new Decimal(roundedMul(x, y));\r\n    }\r\n    get isZero() {\r\n        return this._bigNumber.isZero();\r\n    }\r\n    get zero() {\r\n        if (this.isZero) {\r\n            return this;\r\n        }\r\n    }\r\n    get nonZero() {\r\n        if (!this.isZero) {\r\n            return this;\r\n        }\r\n    }\r\n    get infinite() {\r\n        if (this.eq(Decimal.INFINITY)) {\r\n            return this;\r\n        }\r\n    }\r\n    get finite() {\r\n        if (!this.eq(Decimal.INFINITY)) {\r\n            return this;\r\n        }\r\n    }\r\n    /** @internal */\r\n    get absoluteValue() {\r\n        return this;\r\n    }\r\n    lt(that) {\r\n        return this._bigNumber.lt(Decimal.from(that)._bigNumber);\r\n    }\r\n    eq(that) {\r\n        return this._bigNumber.eq(Decimal.from(that)._bigNumber);\r\n    }\r\n    gt(that) {\r\n        return this._bigNumber.gt(Decimal.from(that)._bigNumber);\r\n    }\r\n    gte(that) {\r\n        return this._bigNumber.gte(Decimal.from(that)._bigNumber);\r\n    }\r\n    lte(that) {\r\n        return this._bigNumber.lte(Decimal.from(that)._bigNumber);\r\n    }\r\n    static min(a, b) {\r\n        a = Decimal.from(a);\r\n        b = Decimal.from(b);\r\n        return a.lt(b) ? a : b;\r\n    }\r\n    static max(a, b) {\r\n        a = Decimal.from(a);\r\n        b = Decimal.from(b);\r\n        return a.gt(b) ? a : b;\r\n    }\r\n}\r\nexports.Decimal = Decimal;\r\nDecimal.INFINITY = Decimal.fromBigNumberString(MAX_UINT_256);\r\nDecimal.ZERO = Decimal.from(0);\r\nDecimal.HALF = Decimal.from(0.5);\r\nDecimal.ONE = Decimal.from(1);\r\n/** @alpha */\r\nclass Difference {\r\n    constructor(number) {\r\n        this._number = number;\r\n    }\r\n    static between(d1, d2) {\r\n        if (d1 === undefined || d2 === undefined) {\r\n            return new Difference(undefined);\r\n        }\r\n        d1 = Decimal.from(d1);\r\n        d2 = Decimal.from(d2);\r\n        if (d1.infinite && d2.infinite) {\r\n            return new Difference(undefined);\r\n        }\r\n        else if (d1.infinite) {\r\n            return new Difference({ sign: \"+\", absoluteValue: d1 });\r\n        }\r\n        else if (d2.infinite) {\r\n            return new Difference({ sign: \"-\", absoluteValue: d2 });\r\n        }\r\n        else if (d1.gt(d2)) {\r\n            return new Difference({ sign: \"+\", absoluteValue: Decimal.from(d1).sub(d2) });\r\n        }\r\n        else if (d2.gt(d1)) {\r\n            return new Difference({ sign: \"-\", absoluteValue: Decimal.from(d2).sub(d1) });\r\n        }\r\n        else {\r\n            return new Difference({ sign: \"\", absoluteValue: Decimal.ZERO });\r\n        }\r\n    }\r\n    toString(precision) {\r\n        if (!this._number) {\r\n            return \"N/A\";\r\n        }\r\n        return this._number.sign + this._number.absoluteValue.toString(precision);\r\n    }\r\n    prettify(precision) {\r\n        if (!this._number) {\r\n            return this.toString();\r\n        }\r\n        return this._number.sign + this._number.absoluteValue.prettify(precision);\r\n    }\r\n    mul(multiplier) {\r\n        return new Difference(this._number && {\r\n            sign: this._number.sign,\r\n            absoluteValue: this._number.absoluteValue.mul(multiplier)\r\n        });\r\n    }\r\n    get nonZero() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.nonZero) && this;\r\n    }\r\n    get positive() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.sign) === \"+\" ? this : undefined;\r\n    }\r\n    get negative() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.sign) === \"-\" ? this : undefined;\r\n    }\r\n    get absoluteValue() {\r\n        var _a;\r\n        return (_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue;\r\n    }\r\n    get infinite() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.infinite) && this;\r\n    }\r\n    get finite() {\r\n        var _a;\r\n        return ((_a = this._number) === null || _a === void 0 ? void 0 : _a.absoluteValue.finite) && this;\r\n    }\r\n}\r\nexports.Difference = Difference;\r\n/** @alpha */\r\nclass Percent {\r\n    constructor(ratio) {\r\n        this._percent = ratio.infinite || (ratio.mul && ratio.mul(100)) || ratio;\r\n    }\r\n    nonZeroish(precision) {\r\n        var _a;\r\n        const zeroish = `0.${\"0\".repeat(precision)}5`;\r\n        if ((_a = this._percent.absoluteValue) === null || _a === void 0 ? void 0 : _a.gte(zeroish)) {\r\n            return this;\r\n        }\r\n    }\r\n    toString(precision) {\r\n        return (this._percent.toString(precision) +\r\n            (this._percent.absoluteValue && !this._percent.infinite ? \"%\" : \"\"));\r\n    }\r\n    prettify() {\r\n        var _a, _b;\r\n        if ((_a = this._percent.absoluteValue) === null || _a === void 0 ? void 0 : _a.gte(\"1000\")) {\r\n            return this.toString(0);\r\n        }\r\n        else if ((_b = this._percent.absoluteValue) === null || _b === void 0 ? void 0 : _b.gte(\"10\")) {\r\n            return this.toString(1);\r\n        }\r\n        else {\r\n            return this.toString(2);\r\n        }\r\n    }\r\n}\r\nexports.Percent = Percent;\r\n//# sourceMappingURL=Decimal.js.map","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__exportStar(require(\"./src/constants\"), exports);\r\n__exportStar(require(\"./src/Decimal\"), exports);\r\n__exportStar(require(\"./src/Trove\"), exports);\r\n__exportStar(require(\"./src/StabilityDeposit\"), exports);\r\n__exportStar(require(\"./src/LQTYStake\"), exports);\r\n__exportStar(require(\"./src/Fees\"), exports);\r\n__exportStar(require(\"./src/ReadableLiquity\"), exports);\r\n__exportStar(require(\"./src/ObservableLiquity\"), exports);\r\n__exportStar(require(\"./src/TransactableLiquity\"), exports);\r\n__exportStar(require(\"./src/SendableLiquity\"), exports);\r\n__exportStar(require(\"./src/PopulatableLiquity\"), exports);\r\n__exportStar(require(\"./src/LiquityStore\"), exports);\r\n__exportStar(require(\"./src/_CachedReadableLiquity\"), exports);\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.promiseAllValues = exports.panic = exports.decimalify = exports.numberify = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst numberify = (bigNumber) => bigNumber.toNumber();\r\nexports.numberify = numberify;\r\nconst decimalify = (bigNumber) => lib_base_1.Decimal.fromBigNumberString(bigNumber.toHexString());\r\nexports.decimalify = decimalify;\r\nconst panic = (e) => {\r\n    throw e;\r\n};\r\nexports.panic = panic;\r\nconst promiseAllValues = (object) => {\r\n    const keys = Object.keys(object);\r\n    return Promise.all(Object.values(object)).then(values => Object.fromEntries(values.map((value, i) => [keys[i], value])));\r\n};\r\nexports.promiseAllValues = promiseAllValues;\r\n//# sourceMappingURL=_utils.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.MINIMUM_REDEMPTION_RATE = exports.MAXIMUM_BORROWING_RATE = exports.MINIMUM_BORROWING_RATE = exports.LUSD_MINIMUM_DEBT = exports.LUSD_MINIMUM_NET_DEBT = exports.LUSD_LIQUIDATION_RESERVE = exports.MINIMUM_COLLATERAL_RATIO = exports.CRITICAL_COLLATERAL_RATIO = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * Total collateral ratio below which recovery mode is triggered.\r\n *\r\n * @public\r\n */\r\nexports.CRITICAL_COLLATERAL_RATIO = Decimal_1.Decimal.from(1.5);\r\n/**\r\n * Collateral ratio below which a Trove can be liquidated in normal mode.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_COLLATERAL_RATIO = Decimal_1.Decimal.from(1.1);\r\n/**\r\n * Amount of LUSD that's reserved for compensating the liquidator of a Trove.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_LIQUIDATION_RESERVE = Decimal_1.Decimal.from(200);\r\n/**\r\n * A Trove must always have at least this much debt on top of the\r\n * {@link LUSD_LIQUIDATION_RESERVE | liquidation reserve}.\r\n *\r\n * @remarks\r\n * Any transaction that would result in a Trove with less net debt than this will be reverted.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_MINIMUM_NET_DEBT = Decimal_1.Decimal.from(1800);\r\n/**\r\n * A Trove must always have at least this much debt.\r\n *\r\n * @remarks\r\n * Any transaction that would result in a Trove with less debt than this will be reverted.\r\n *\r\n * @public\r\n */\r\nexports.LUSD_MINIMUM_DEBT = exports.LUSD_LIQUIDATION_RESERVE.add(exports.LUSD_MINIMUM_NET_DEBT);\r\n/**\r\n * Value that the {@link Fees.borrowingRate | borrowing rate} will never decay below.\r\n *\r\n * @remarks\r\n * Note that the borrowing rate can still be lower than this during recovery mode, when it's\r\n * overridden by zero.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_BORROWING_RATE = Decimal_1.Decimal.from(0.005);\r\n/**\r\n * Value that the {@link Fees.borrowingRate | borrowing rate} will never exceed.\r\n *\r\n * @public\r\n */\r\nexports.MAXIMUM_BORROWING_RATE = Decimal_1.Decimal.from(0.05);\r\n/**\r\n * Value that the {@link Fees.redemptionRate | redemption rate} will never decay below.\r\n *\r\n * @public\r\n */\r\nexports.MINIMUM_REDEMPTION_RATE = Decimal_1.Decimal.from(0.005);\r\n//# sourceMappingURL=constants.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquityStore = void 0;\r\nconst react_1 = require(\"react\");\r\nconst LiquityStoreProvider_1 = require(\"../components/LiquityStoreProvider\");\r\nconst useLiquityStore = () => {\r\n    const store = react_1.useContext(LiquityStoreProvider_1.LiquityStoreContext);\r\n    if (!store) {\r\n        throw new Error(\"You must provide a LiquityStore via LiquityStoreProvider\");\r\n    }\r\n    return store;\r\n};\r\nexports.useLiquityStore = useLiquityStore;\r\n//# sourceMappingURL=useLiquityStore.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.WebSocketAugmentedWeb3Provider = exports.WebSocketAugmented = exports.isWebSocketAugmentedProvider = void 0;\r\nconst providers_1 = require(\"@ethersproject/providers\");\r\nconst bytes_1 = require(\"@ethersproject/bytes\");\r\nconst WebSocketProvider_1 = require(\"./WebSocketProvider\");\r\nconst webSocketAugmentedProviders = [];\r\nconst isWebSocketAugmentedProvider = (provider) => webSocketAugmentedProviders.some(webSocketAugmentedProvider => provider instanceof webSocketAugmentedProvider);\r\nexports.isWebSocketAugmentedProvider = isWebSocketAugmentedProvider;\r\nconst isHeaderNotFoundError = (error) => typeof error === \"object\" &&\r\n    typeof error.message === \"string\" &&\r\n    (error.message.includes(\r\n    // geth\r\n    \"header not found\") ||\r\n        error.message.includes(\r\n        // openethereum\r\n        \"request is not supported because your node is running with state pruning\"));\r\nconst isTransactionHash = (eventName) => typeof eventName === \"string\" && bytes_1.hexDataLength(eventName) === 32;\r\nconst loadBalancingGlitchRetryIntervalMs = 200;\r\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));\r\nconst waitFor = (f) => (g) => (t, { isActive }) => {\r\n    f(t).then(u => {\r\n        if (u !== null && isActive()) {\r\n            g(u);\r\n        }\r\n    });\r\n};\r\nconst pass = (f) => (t, _) => {\r\n    f(t);\r\n};\r\nconst passOnce = (f) => (t, { removeMe }) => {\r\n    f(t);\r\n    removeMe();\r\n};\r\nconst sequence = (f, g) => (h) => (t, context) => {\r\n    f(u => g(h)(u, context))(t, context);\r\n};\r\nconst defer = (f) => (t) => {\r\n    setTimeout(() => {\r\n        f(t);\r\n    }, 0);\r\n};\r\nconst WebSocketAugmented = (Base) => {\r\n    let webSocketAugmentedProvider = class extends Base {\r\n        constructor() {\r\n            super(...arguments);\r\n            this._seenBlock = 0;\r\n            this._blockListenerScheduled = false;\r\n            this._blockListeners = new Map();\r\n            this._blockListener = this._onBlock.bind(this);\r\n        }\r\n        openWebSocket(url, network) {\r\n            this._wsProvider = new WebSocketProvider_1.WebSocketProvider(url, network);\r\n            this._wsProvider.onClose = this._onWebSocketClose.bind(this);\r\n            this._wsParams = [url, network];\r\n            this._switchover();\r\n        }\r\n        _onWebSocketClose() {\r\n            this.closeWebSocket();\r\n            console.warn(\"WebSocketProvider disconnected. Retrying in 10 seconds.\");\r\n            this._reconnectTimerId = setTimeout(() => this.openWebSocket(...this._wsParams), 10000);\r\n        }\r\n        closeWebSocket() {\r\n            if (this._wsProvider) {\r\n                this._wsProvider.onClose = null;\r\n                this._wsProvider.close(1000); // normal closure\r\n                this._wsProvider = undefined;\r\n                this._switchover();\r\n                if (this._reconnectTimerId !== undefined) {\r\n                    clearTimeout(this._reconnectTimerId);\r\n                    this._reconnectTimerId = undefined;\r\n                }\r\n            }\r\n        }\r\n        _switchover() {\r\n            if (this._blockListeners.size > 0) {\r\n                if (this._wsProvider) {\r\n                    super.off(\"block\", this._blockListener);\r\n                }\r\n                this._startBlockEvents();\r\n            }\r\n        }\r\n        _onBlock(blockNumber) {\r\n            this._seenBlock = blockNumber;\r\n            if (!this._blockListenerScheduled) {\r\n                this._blockListenerScheduled = true;\r\n                setTimeout(() => {\r\n                    this._blockListenerScheduled = false;\r\n                    [...this._blockListeners].forEach(([, listener]) => listener(this._seenBlock));\r\n                }, 50);\r\n            }\r\n        }\r\n        async _retrySeenBlock(perform, startingBlock) {\r\n            for (let retries = 0;; ++retries) {\r\n                try {\r\n                    const ret = await perform();\r\n                    if (retries) {\r\n                        // console.log(`Glitch resolved after ${retries} ${retries === 1 ? \"retry\" : \"retries\"}.`);\r\n                    }\r\n                    return ret;\r\n                }\r\n                catch (error) {\r\n                    if (this._seenBlock !== startingBlock || !isHeaderNotFoundError(error)) {\r\n                        throw error;\r\n                    }\r\n                }\r\n                // console.warn(\"Load balancing glitch. Retrying...\");\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n        }\r\n        async call(transaction, blockTag) {\r\n            const resolvedBlockTag = await blockTag;\r\n            const perform = () => {\r\n                var _a;\r\n                return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.call(transaction, resolvedBlockTag)\r\n                    : super.call(transaction, resolvedBlockTag);\r\n            };\r\n            return resolvedBlockTag === this._seenBlock\r\n                ? this._retrySeenBlock(perform, this._seenBlock)\r\n                : perform();\r\n        }\r\n        async getBalance(addressOrName, blockTag) {\r\n            const resolvedBlockTag = await blockTag;\r\n            const perform = () => {\r\n                var _a;\r\n                return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBalance(addressOrName, resolvedBlockTag)\r\n                    : super.getBalance(addressOrName, resolvedBlockTag);\r\n            };\r\n            return resolvedBlockTag === this._seenBlock\r\n                ? this._retrySeenBlock(perform, this._seenBlock)\r\n                : perform();\r\n        }\r\n        _startBlockEvents() {\r\n            if (this._wsProvider) {\r\n                console.log(\"Listening for new blocks on WebSocketProvider\");\r\n                this._wsProvider.on(\"block\", this._blockListener);\r\n            }\r\n            else {\r\n                console.log(\"Listening for new blocks on basic Provider\");\r\n                super.on(\"block\", this._blockListener);\r\n            }\r\n        }\r\n        _stopBlockEvents() {\r\n            if (this._wsProvider) {\r\n                this._wsProvider.off(\"block\", this._blockListener);\r\n            }\r\n            else {\r\n                super.off(\"block\", this._blockListener);\r\n            }\r\n        }\r\n        _wrap(f, g) {\r\n            return [\r\n                f,\r\n                (u) => g(defer(f))(u, {\r\n                    isActive: () => this._blockListeners.has(f),\r\n                    removeMe: () => this._blockListeners.delete(f)\r\n                })\r\n            ];\r\n        }\r\n        on(eventName, listener) {\r\n            if (isTransactionHash(eventName)) {\r\n                const fetchReceipt = this._getTransactionReceiptFromLatest.bind(this, eventName);\r\n                const [, passReceipt] = this._wrap(listener, waitFor(fetchReceipt));\r\n                passReceipt(undefined);\r\n                return this._addBlockListener(listener, passReceipt);\r\n            }\r\n            else if (eventName === \"block\") {\r\n                return this._addBlockListener(...this._wrap(listener, pass));\r\n            }\r\n            else {\r\n                return super.on(eventName, listener);\r\n            }\r\n        }\r\n        _addBlockListener(key, blockListener) {\r\n            if (!this._blockListeners.has(key)) {\r\n                this._blockListeners.set(key, blockListener);\r\n                if (this._blockListeners.size === 1) {\r\n                    this._startBlockEvents();\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        once(eventName, listener) {\r\n            if (isTransactionHash(eventName)) {\r\n                const fetchReceipt = this._getTransactionReceiptFromLatest.bind(this, eventName);\r\n                const [, passReceiptOnce] = this._wrap(listener, sequence(waitFor(fetchReceipt), passOnce));\r\n                passReceiptOnce(undefined);\r\n                return this._addBlockListener(listener, passReceiptOnce);\r\n            }\r\n            else if (eventName === \"block\") {\r\n                return this._addBlockListener(...this._wrap(listener, passOnce));\r\n            }\r\n            else {\r\n                return super.once(eventName, listener);\r\n            }\r\n        }\r\n        off(eventName, listener) {\r\n            if (isTransactionHash(eventName) || eventName === \"block\") {\r\n                return this._removeBlockListener(listener);\r\n            }\r\n            else {\r\n                return super.off(eventName, listener);\r\n            }\r\n        }\r\n        _removeBlockListener(key) {\r\n            if (this._blockListeners.has(key)) {\r\n                this._blockListeners.delete(key);\r\n                if (this._blockListeners.size === 0) {\r\n                    this._stopBlockEvents();\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        async getTransaction(transactionHash) {\r\n            var _a, _b;\r\n            const txPromises = [\r\n                super.getTransaction(transactionHash),\r\n                ...(((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? [this._wsProvider.getTransaction(transactionHash)] : [])\r\n            ];\r\n            const first = await Promise.race(txPromises);\r\n            const tx = (_b = first !== null && first !== void 0 ? first : (await Promise.all(txPromises)).find(tx => tx !== null)) !== null && _b !== void 0 ? _b : null;\r\n            return tx;\r\n        }\r\n        getTransactionReceipt(transactionHash) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getTransactionReceipt(transactionHash)\r\n                : super.getTransactionReceipt(transactionHash);\r\n        }\r\n        getTransactionCount(addressOrName, blockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getTransactionCount(addressOrName, blockTag)\r\n                : super.getTransactionCount(addressOrName, blockTag);\r\n        }\r\n        getBlock(blockHashOrBlockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBlock(blockHashOrBlockTag)\r\n                : super.getBlock(blockHashOrBlockTag);\r\n        }\r\n        getBlockWithTransactions(blockHashOrBlockTag) {\r\n            var _a;\r\n            return ((_a = this._wsProvider) === null || _a === void 0 ? void 0 : _a.isReady) ? this._wsProvider.getBlockWithTransactions(blockHashOrBlockTag)\r\n                : super.getBlockWithTransactions(blockHashOrBlockTag);\r\n        }\r\n        async _blockContainsTx(blockNumber, txHash) {\r\n            let block;\r\n            for (block = null; !block; block = await this.getBlock(blockNumber)) {\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n            return block.transactions.some(txHashInBlock => txHashInBlock === txHash);\r\n        }\r\n        async _getTransactionReceiptFromLatest(txHash, latestBlock) {\r\n            txHash = await txHash;\r\n            for (let retries = 0;; ++retries) {\r\n                const receipt = (await this.getTransactionReceipt(txHash));\r\n                if (latestBlock === undefined ||\r\n                    (receipt === null && !(await this._blockContainsTx(latestBlock, txHash))) ||\r\n                    (receipt !== null && receipt.blockNumber + receipt.confirmations - 1 >= latestBlock)) {\r\n                    if (retries) {\r\n                        // console.log(`Glitch resolved after ${retries} ${retries === 1 ? \"retry\" : \"retries\"}.`);\r\n                    }\r\n                    return receipt;\r\n                }\r\n                // console.warn(\"Load balancing glitch. Retrying...\");\r\n                await delay(loadBalancingGlitchRetryIntervalMs);\r\n            }\r\n        }\r\n        async waitForTransaction(txHash, confirmations, timeout) {\r\n            if (timeout !== undefined) {\r\n                // We don't use timeout, don't implement it\r\n                return super.waitForTransaction(txHash, confirmations, timeout);\r\n            }\r\n            let latestBlock = undefined;\r\n            for (;;) {\r\n                const receipt = await this._getTransactionReceiptFromLatest(txHash, latestBlock);\r\n                if (receipt !== null &&\r\n                    (confirmations === undefined || receipt.confirmations >= confirmations)) {\r\n                    return receipt;\r\n                }\r\n                latestBlock = await new Promise(resolve => this.once(\"block\", resolve));\r\n            }\r\n        }\r\n    };\r\n    webSocketAugmentedProviders.push(webSocketAugmentedProvider);\r\n    return webSocketAugmentedProvider;\r\n};\r\nexports.WebSocketAugmented = WebSocketAugmented;\r\nexports.WebSocketAugmentedWeb3Provider = exports.WebSocketAugmented(providers_1.Web3Provider);\r\n//# sourceMappingURL=WebSocketAugmentedProvider.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.WebSocketProvider = void 0;\r\nconst providers_1 = require(\"@ethersproject/providers\");\r\nclass WebSocketProvider extends providers_1.WebSocketProvider {\r\n    get isReady() {\r\n        return this._websocket.readyState === WebSocket.OPEN;\r\n    }\r\n    set onClose(closeListener) {\r\n        this._websocket.onclose = closeListener;\r\n    }\r\n    close(code) {\r\n        this._websocket.close(code);\r\n    }\r\n    async detectNetwork() {\r\n        return this.network;\r\n    }\r\n}\r\nexports.WebSocketProvider = WebSocketProvider;\r\n//# sourceMappingURL=WebSocketProvider.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connectToContracts = exports._uniTokenIsMock = exports._priceFeedIsTestnet = exports._LiquityContract = void 0;\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst ActivePool_json_1 = __importDefault(require(\"../abi/ActivePool.json\"));\r\nconst BorrowerOperations_json_1 = __importDefault(require(\"../abi/BorrowerOperations.json\"));\r\nconst TroveManager_json_1 = __importDefault(require(\"../abi/TroveManager.json\"));\r\nconst LUSDToken_json_1 = __importDefault(require(\"../abi/LUSDToken.json\"));\r\nconst CollSurplusPool_json_1 = __importDefault(require(\"../abi/CollSurplusPool.json\"));\r\nconst CommunityIssuance_json_1 = __importDefault(require(\"../abi/CommunityIssuance.json\"));\r\nconst DefaultPool_json_1 = __importDefault(require(\"../abi/DefaultPool.json\"));\r\nconst LQTYToken_json_1 = __importDefault(require(\"../abi/LQTYToken.json\"));\r\nconst HintHelpers_json_1 = __importDefault(require(\"../abi/HintHelpers.json\"));\r\nconst LockupContractFactory_json_1 = __importDefault(require(\"../abi/LockupContractFactory.json\"));\r\nconst LQTYStaking_json_1 = __importDefault(require(\"../abi/LQTYStaking.json\"));\r\nconst MultiTroveGetter_json_1 = __importDefault(require(\"../abi/MultiTroveGetter.json\"));\r\nconst PriceFeed_json_1 = __importDefault(require(\"../abi/PriceFeed.json\"));\r\nconst PriceFeedTestnet_json_1 = __importDefault(require(\"../abi/PriceFeedTestnet.json\"));\r\nconst SortedTroves_json_1 = __importDefault(require(\"../abi/SortedTroves.json\"));\r\nconst StabilityPool_json_1 = __importDefault(require(\"../abi/StabilityPool.json\"));\r\nconst GasPool_json_1 = __importDefault(require(\"../abi/GasPool.json\"));\r\nconst Unipool_json_1 = __importDefault(require(\"../abi/Unipool.json\"));\r\nconst IERC20_json_1 = __importDefault(require(\"../abi/IERC20.json\"));\r\nconst ERC20Mock_json_1 = __importDefault(require(\"../abi/ERC20Mock.json\"));\r\nconst buildEstimatedFunctions = (estimateFunctions, functions) => Object.fromEntries(Object.keys(estimateFunctions).map(functionName => [\r\n    functionName,\r\n    async (overrides, adjustEstimate, ...args) => {\r\n        if (overrides.gasLimit === undefined) {\r\n            const estimatedGas = await estimateFunctions[functionName](...args, overrides);\r\n            overrides = {\r\n                ...overrides,\r\n                gasLimit: adjustEstimate(estimatedGas)\r\n            };\r\n        }\r\n        return functions[functionName](...args, overrides);\r\n    }\r\n]));\r\nclass _LiquityContract extends contracts_1.Contract {\r\n    constructor(addressOrName, contractInterface, signerOrProvider) {\r\n        super(addressOrName, contractInterface, signerOrProvider);\r\n        // this.estimateAndCall = buildEstimatedFunctions(this.estimateGas, this);\r\n        this.estimateAndPopulate = buildEstimatedFunctions(this.estimateGas, this.populateTransaction);\r\n    }\r\n    extractEvents(logs, name) {\r\n        return logs\r\n            .filter(log => log.address === this.address)\r\n            .map(log => this.interface.parseLog(log))\r\n            .filter(e => e.name === name);\r\n    }\r\n}\r\nexports._LiquityContract = _LiquityContract;\r\n/** @internal */\r\nconst _priceFeedIsTestnet = (priceFeed) => \"setPrice\" in priceFeed;\r\nexports._priceFeedIsTestnet = _priceFeedIsTestnet;\r\n/** @internal */\r\nconst _uniTokenIsMock = (uniToken) => \"mint\" in uniToken;\r\nexports._uniTokenIsMock = _uniTokenIsMock;\r\nconst getAbi = (priceFeedIsTestnet, uniTokenIsMock) => ({\r\n    activePool: ActivePool_json_1.default,\r\n    borrowerOperations: BorrowerOperations_json_1.default,\r\n    troveManager: TroveManager_json_1.default,\r\n    lusdToken: LUSDToken_json_1.default,\r\n    communityIssuance: CommunityIssuance_json_1.default,\r\n    defaultPool: DefaultPool_json_1.default,\r\n    lqtyToken: LQTYToken_json_1.default,\r\n    hintHelpers: HintHelpers_json_1.default,\r\n    lockupContractFactory: LockupContractFactory_json_1.default,\r\n    lqtyStaking: LQTYStaking_json_1.default,\r\n    multiTroveGetter: MultiTroveGetter_json_1.default,\r\n    priceFeed: priceFeedIsTestnet ? PriceFeedTestnet_json_1.default : PriceFeed_json_1.default,\r\n    sortedTroves: SortedTroves_json_1.default,\r\n    stabilityPool: StabilityPool_json_1.default,\r\n    gasPool: GasPool_json_1.default,\r\n    collSurplusPool: CollSurplusPool_json_1.default,\r\n    unipool: Unipool_json_1.default,\r\n    uniToken: uniTokenIsMock ? ERC20Mock_json_1.default : IERC20_json_1.default\r\n});\r\nconst mapLiquityContracts = (contracts, f) => Object.fromEntries(Object.entries(contracts).map(([key, t]) => [key, f(t, key)]));\r\n/** @internal */\r\nconst _connectToContracts = (signerOrProvider, { addresses, _priceFeedIsTestnet, _uniTokenIsMock }) => {\r\n    const abi = getAbi(_priceFeedIsTestnet, _uniTokenIsMock);\r\n    return mapLiquityContracts(addresses, (address, key) => new _LiquityContract(address, abi[key], signerOrProvider));\r\n};\r\nexports._connectToContracts = _connectToContracts;\r\n//# sourceMappingURL=contracts.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ReadableEthersLiquity = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst BlockPolledLiquityStore_1 = require(\"./BlockPolledLiquityStore\");\r\n// TODO: these are constant in the contracts, so it doesn't make sense to make a call for them,\r\n// but to avoid having to update them here when we change them in the contracts, we could read\r\n// them once after deployment and save them to LiquityDeployment.\r\nconst MINUTE_DECAY_FACTOR = lib_base_1.Decimal.from(\"0.999037758833783000\");\r\nconst BETA = lib_base_1.Decimal.from(2);\r\nvar BackendTroveStatus;\r\n(function (BackendTroveStatus) {\r\n    BackendTroveStatus[BackendTroveStatus[\"nonExistent\"] = 0] = \"nonExistent\";\r\n    BackendTroveStatus[BackendTroveStatus[\"active\"] = 1] = \"active\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByOwner\"] = 2] = \"closedByOwner\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByLiquidation\"] = 3] = \"closedByLiquidation\";\r\n    BackendTroveStatus[BackendTroveStatus[\"closedByRedemption\"] = 4] = \"closedByRedemption\";\r\n})(BackendTroveStatus || (BackendTroveStatus = {}));\r\nconst userTroveStatusFrom = (backendStatus) => backendStatus === BackendTroveStatus.nonExistent\r\n    ? \"nonExistent\"\r\n    : backendStatus === BackendTroveStatus.active\r\n        ? \"open\"\r\n        : backendStatus === BackendTroveStatus.closedByOwner\r\n            ? \"closedByOwner\"\r\n            : backendStatus === BackendTroveStatus.closedByLiquidation\r\n                ? \"closedByLiquidation\"\r\n                : backendStatus === BackendTroveStatus.closedByRedemption\r\n                    ? \"closedByRedemption\"\r\n                    : _utils_1.panic(new Error(`invalid backendStatus ${backendStatus}`));\r\nconst convertToDate = (timestamp) => new Date(timestamp * 1000);\r\nconst validSortingOptions = [\"ascendingCollateralRatio\", \"descendingCollateralRatio\"];\r\nconst expectPositiveInt = (obj, key) => {\r\n    if (obj[key] !== undefined) {\r\n        if (!Number.isInteger(obj[key])) {\r\n            throw new Error(`${key} must be an integer`);\r\n        }\r\n        if (obj[key] < 0) {\r\n            throw new Error(`${key} must not be negative`);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#ReadableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass ReadableEthersLiquity {\r\n    /** @internal */\r\n    constructor(connection) {\r\n        this.connection = connection;\r\n    }\r\n    /** @internal */\r\n    static _from(connection) {\r\n        const readable = new ReadableEthersLiquity(connection);\r\n        return connection.useStore === \"blockPolled\"\r\n            ? new _BlockPolledReadableEthersLiquity(readable)\r\n            : readable;\r\n    }\r\n    /**\r\n     * Connect to the Liquity protocol and create a `ReadableEthersLiquity` object.\r\n     *\r\n     * @param signerOrProvider - Ethers `Signer` or `Provider` to use for connecting to the Ethereum\r\n     *                           network.\r\n     * @param optionalParams - Optional parameters that can be used to customize the connection.\r\n     */\r\n    static async connect(signerOrProvider, optionalParams) {\r\n        return ReadableEthersLiquity._from(await EthersLiquityConnection_1._connect(signerOrProvider, optionalParams));\r\n    }\r\n    hasStore() {\r\n        return false;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalRedistributed} */\r\n    async getTotalRedistributed(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [collateral, debt] = await Promise.all([\r\n            troveManager.L_ETH({ ...overrides }).then(_utils_1.decimalify),\r\n            troveManager.L_LUSDDebt({ ...overrides }).then(_utils_1.decimalify)\r\n        ]);\r\n        return new lib_base_1.Trove(collateral, debt);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTroveBeforeRedistribution} */\r\n    async getTroveBeforeRedistribution(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [trove, snapshot] = await Promise.all([\r\n            troveManager.Troves(address, { ...overrides }),\r\n            troveManager.rewardSnapshots(address, { ...overrides })\r\n        ]);\r\n        if (trove.status === BackendTroveStatus.active) {\r\n            return new lib_base_1.TroveWithPendingRedistribution(address, userTroveStatusFrom(trove.status), _utils_1.decimalify(trove.coll), _utils_1.decimalify(trove.debt), _utils_1.decimalify(trove.stake), new lib_base_1.Trove(_utils_1.decimalify(snapshot.ETH), _utils_1.decimalify(snapshot.LUSDDebt)));\r\n        }\r\n        else {\r\n            return new lib_base_1.TroveWithPendingRedistribution(address, userTroveStatusFrom(trove.status));\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTrove} */\r\n    async getTrove(address, overrides) {\r\n        const [trove, totalRedistributed] = await Promise.all([\r\n            this.getTroveBeforeRedistribution(address, overrides),\r\n            this.getTotalRedistributed(overrides)\r\n        ]);\r\n        return trove.applyRedistribution(totalRedistributed);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getNumberOfTroves} */\r\n    async getNumberOfTroves(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return (await troveManager.getTroveOwnersCount({ ...overrides })).toNumber();\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getPrice} */\r\n    getPrice(overrides) {\r\n        const { priceFeed } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return priceFeed.callStatic.fetchPrice({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** @internal */\r\n    async _getActivePool(overrides) {\r\n        const { activePool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [activeCollateral, activeDebt] = await Promise.all([\r\n            activePool.getETH({ ...overrides }),\r\n            activePool.getLUSDDebt({ ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.Trove(activeCollateral, activeDebt);\r\n    }\r\n    /** @internal */\r\n    async _getDefaultPool(overrides) {\r\n        const { defaultPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [liquidatedCollateral, closedDebt] = await Promise.all([\r\n            defaultPool.getETH({ ...overrides }),\r\n            defaultPool.getLUSDDebt({ ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.Trove(liquidatedCollateral, closedDebt);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotal} */\r\n    async getTotal(overrides) {\r\n        const [activePool, defaultPool] = await Promise.all([\r\n            this._getActivePool(overrides),\r\n            this._getDefaultPool(overrides)\r\n        ]);\r\n        return activePool.add(defaultPool);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getStabilityDeposit} */\r\n    async getStabilityDeposit(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [{ frontEndTag, initialValue }, currentLUSD, collateralGain, lqtyReward] = await Promise.all([\r\n            stabilityPool.deposits(address, { ...overrides }),\r\n            stabilityPool.getCompoundedLUSDDeposit(address, { ...overrides }),\r\n            stabilityPool.getDepositorETHGain(address, { ...overrides }),\r\n            stabilityPool.getDepositorLQTYGain(address, { ...overrides })\r\n        ]);\r\n        return new lib_base_1.StabilityDeposit(_utils_1.decimalify(initialValue), _utils_1.decimalify(currentLUSD), _utils_1.decimalify(collateralGain), _utils_1.decimalify(lqtyReward), frontEndTag);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingStabilityPoolLQTYReward} */\r\n    async getRemainingStabilityPoolLQTYReward(overrides) {\r\n        const { communityIssuance } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const issuanceCap = this.connection.totalStabilityPoolLQTYReward;\r\n        const totalLQTYIssued = _utils_1.decimalify(await communityIssuance.totalLQTYIssued({ ...overrides }));\r\n        // totalLQTYIssued approaches but never reaches issuanceCap\r\n        return issuanceCap.sub(totalLQTYIssued);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDInStabilityPool} */\r\n    getLUSDInStabilityPool(overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return stabilityPool.getTotalLUSDDeposits({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDBalance} */\r\n    getLUSDBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lusdToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYBalance} */\r\n    getLQTYBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lqtyToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lqtyToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenBalance} */\r\n    getUniTokenBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { uniToken } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return uniToken.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenAllowance} */\r\n    getUniTokenAllowance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { uniToken, unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return uniToken.allowance(address, unipool.address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** @internal */\r\n    async _getRemainingLiquidityMiningLQTYRewardCalculator(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [totalSupply, rewardRate, periodFinish, lastUpdateTime] = await Promise.all([\r\n            unipool.totalSupply({ ...overrides }),\r\n            unipool.rewardRate({ ...overrides }).then(_utils_1.decimalify),\r\n            unipool.periodFinish({ ...overrides }).then(_utils_1.numberify),\r\n            unipool.lastUpdateTime({ ...overrides }).then(_utils_1.numberify)\r\n        ]);\r\n        return (blockTimestamp) => rewardRate.mul(Math.max(0, periodFinish - (totalSupply.isZero() ? lastUpdateTime : blockTimestamp)));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingLiquidityMiningLQTYReward} */\r\n    async getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        const [calculateRemainingLQTY, blockTimestamp] = await Promise.all([\r\n            this._getRemainingLiquidityMiningLQTYRewardCalculator(overrides),\r\n            this._getBlockTimestamp(overrides === null || overrides === void 0 ? void 0 : overrides.blockTag)\r\n        ]);\r\n        return calculateRemainingLQTY(blockTimestamp);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningStake} */\r\n    getLiquidityMiningStake(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.balanceOf(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedUniTokens} */\r\n    getTotalStakedUniTokens(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.totalSupply({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningLQTYReward} */\r\n    getLiquidityMiningLQTYReward(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return unipool.earned(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getCollateralSurplusBalance} */\r\n    getCollateralSurplusBalance(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { collSurplusPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return collSurplusPool.getCollateral(address, { ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    async getTroves(params, overrides) {\r\n        var _a, _b;\r\n        const { multiTroveGetter } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        expectPositiveInt(params, \"first\");\r\n        expectPositiveInt(params, \"startingAt\");\r\n        if (!validSortingOptions.includes(params.sortedBy)) {\r\n            throw new Error(`sortedBy must be one of: ${validSortingOptions.map(x => `\"${x}\"`).join(\", \")}`);\r\n        }\r\n        const [totalRedistributed, backendTroves] = await Promise.all([\r\n            params.beforeRedistribution ? undefined : this.getTotalRedistributed({ ...overrides }),\r\n            multiTroveGetter.getMultipleSortedTroves(params.sortedBy === \"descendingCollateralRatio\"\r\n                ? (_a = params.startingAt) !== null && _a !== void 0 ? _a : 0 : -(((_b = params.startingAt) !== null && _b !== void 0 ? _b : 0) + 1), params.first, { ...overrides })\r\n        ]);\r\n        const troves = mapBackendTroves(backendTroves);\r\n        if (totalRedistributed) {\r\n            return troves.map(trove => trove.applyRedistribution(totalRedistributed));\r\n        }\r\n        else {\r\n            return troves;\r\n        }\r\n    }\r\n    /** @internal */\r\n    _getBlockTimestamp(blockTag) {\r\n        return EthersLiquityConnection_1._getBlockTimestamp(this.connection, blockTag);\r\n    }\r\n    /** @internal */\r\n    async _getFeesFactory(overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [lastFeeOperationTime, baseRateWithoutDecay] = await Promise.all([\r\n            troveManager.lastFeeOperationTime({ ...overrides }),\r\n            troveManager.baseRate({ ...overrides }).then(_utils_1.decimalify)\r\n        ]);\r\n        return (blockTimestamp, recoveryMode) => new lib_base_1.Fees(baseRateWithoutDecay, MINUTE_DECAY_FACTOR, BETA, convertToDate(lastFeeOperationTime.toNumber()), convertToDate(blockTimestamp), recoveryMode);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFees} */\r\n    async getFees(overrides) {\r\n        const [createFees, total, price, blockTimestamp] = await Promise.all([\r\n            this._getFeesFactory(overrides),\r\n            this.getTotal(overrides),\r\n            this.getPrice(overrides),\r\n            this._getBlockTimestamp(overrides === null || overrides === void 0 ? void 0 : overrides.blockTag)\r\n        ]);\r\n        return createFees(blockTimestamp, total.collateralRatioIsBelowCritical(price));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYStake} */\r\n    async getLQTYStake(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this.connection));\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const [stakedLQTY, collateralGain, lusdGain] = await Promise.all([\r\n            lqtyStaking.stakes(address, { ...overrides }),\r\n            lqtyStaking.getPendingETHGain(address, { ...overrides }),\r\n            lqtyStaking.getPendingLUSDGain(address, { ...overrides })\r\n        ].map(getBigNumber => getBigNumber.then(_utils_1.decimalify)));\r\n        return new lib_base_1.LQTYStake(stakedLQTY, collateralGain, lusdGain);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedLQTY} */\r\n    async getTotalStakedLQTY(overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        return lqtyStaking.totalLQTYStaked({ ...overrides }).then(_utils_1.decimalify);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFrontendStatus} */\r\n    async getFrontendStatus(address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireFrontendAddress(this.connection));\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this.connection);\r\n        const { registered, kickbackRate } = await stabilityPool.frontEnds(address, { ...overrides });\r\n        return registered\r\n            ? { status: \"registered\", kickbackRate: _utils_1.decimalify(kickbackRate) }\r\n            : { status: \"unregistered\" };\r\n    }\r\n}\r\nexports.ReadableEthersLiquity = ReadableEthersLiquity;\r\nconst mapBackendTroves = (troves) => troves.map(trove => new lib_base_1.TroveWithPendingRedistribution(trove.owner, \"open\", // These Troves are coming from the SortedTroves list, so they must be open\r\n_utils_1.decimalify(trove.coll), _utils_1.decimalify(trove.debt), _utils_1.decimalify(trove.stake), new lib_base_1.Trove(_utils_1.decimalify(trove.snapshotETH), _utils_1.decimalify(trove.snapshotLUSDDebt))));\r\nclass _BlockPolledReadableEthersLiquity {\r\n    constructor(readable) {\r\n        const store = new BlockPolledLiquityStore_1.BlockPolledLiquityStore(readable);\r\n        this.store = store;\r\n        this.connection = readable.connection;\r\n        this._readable = readable;\r\n    }\r\n    _blockHit(overrides) {\r\n        return (!overrides ||\r\n            overrides.blockTag === undefined ||\r\n            overrides.blockTag === this.store.state.blockTag);\r\n    }\r\n    _userHit(address, overrides) {\r\n        return (this._blockHit(overrides) &&\r\n            (address === undefined || address === this.store.connection.userAddress));\r\n    }\r\n    _frontendHit(address, overrides) {\r\n        return (this._blockHit(overrides) &&\r\n            (address === undefined || address === this.store.connection.frontendTag));\r\n    }\r\n    hasStore(store) {\r\n        return store === undefined || store === \"blockPolled\";\r\n    }\r\n    async getTotalRedistributed(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalRedistributed\r\n            : this._readable.getTotalRedistributed(overrides);\r\n    }\r\n    async getTroveBeforeRedistribution(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.troveBeforeRedistribution\r\n            : this._readable.getTroveBeforeRedistribution(address, overrides);\r\n    }\r\n    async getTrove(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.trove\r\n            : this._readable.getTrove(address, overrides);\r\n    }\r\n    async getNumberOfTroves(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.numberOfTroves\r\n            : this._readable.getNumberOfTroves(overrides);\r\n    }\r\n    async getPrice(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.price : this._readable.getPrice(overrides);\r\n    }\r\n    async getTotal(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.total : this._readable.getTotal(overrides);\r\n    }\r\n    async getStabilityDeposit(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.stabilityDeposit\r\n            : this._readable.getStabilityDeposit(address, overrides);\r\n    }\r\n    async getRemainingStabilityPoolLQTYReward(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.remainingStabilityPoolLQTYReward\r\n            : this._readable.getRemainingStabilityPoolLQTYReward(overrides);\r\n    }\r\n    async getLUSDInStabilityPool(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.lusdInStabilityPool\r\n            : this._readable.getLUSDInStabilityPool(overrides);\r\n    }\r\n    async getLUSDBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lusdBalance\r\n            : this._readable.getLUSDBalance(address, overrides);\r\n    }\r\n    async getLQTYBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lqtyBalance\r\n            : this._readable.getLQTYBalance(address, overrides);\r\n    }\r\n    async getUniTokenBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.uniTokenBalance\r\n            : this._readable.getUniTokenBalance(address, overrides);\r\n    }\r\n    async getUniTokenAllowance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.uniTokenAllowance\r\n            : this._readable.getUniTokenAllowance(address, overrides);\r\n    }\r\n    async getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.remainingLiquidityMiningLQTYReward\r\n            : this._readable.getRemainingLiquidityMiningLQTYReward(overrides);\r\n    }\r\n    async getLiquidityMiningStake(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.liquidityMiningStake\r\n            : this._readable.getLiquidityMiningStake(address, overrides);\r\n    }\r\n    async getTotalStakedUniTokens(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalStakedUniTokens\r\n            : this._readable.getTotalStakedUniTokens(overrides);\r\n    }\r\n    async getLiquidityMiningLQTYReward(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.liquidityMiningLQTYReward\r\n            : this._readable.getLiquidityMiningLQTYReward(address, overrides);\r\n    }\r\n    async getCollateralSurplusBalance(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.collateralSurplusBalance\r\n            : this._readable.getCollateralSurplusBalance(address, overrides);\r\n    }\r\n    async _getBlockTimestamp(blockTag) {\r\n        return this._blockHit({ blockTag })\r\n            ? this.store.state.blockTimestamp\r\n            : this._readable._getBlockTimestamp(blockTag);\r\n    }\r\n    async _getFeesFactory(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state._feesFactory\r\n            : this._readable._getFeesFactory(overrides);\r\n    }\r\n    async getFees(overrides) {\r\n        return this._blockHit(overrides) ? this.store.state.fees : this._readable.getFees(overrides);\r\n    }\r\n    async getLQTYStake(address, overrides) {\r\n        return this._userHit(address, overrides)\r\n            ? this.store.state.lqtyStake\r\n            : this._readable.getLQTYStake(address, overrides);\r\n    }\r\n    async getTotalStakedLQTY(overrides) {\r\n        return this._blockHit(overrides)\r\n            ? this.store.state.totalStakedLQTY\r\n            : this._readable.getTotalStakedLQTY(overrides);\r\n    }\r\n    async getFrontendStatus(address, overrides) {\r\n        return this._frontendHit(address, overrides)\r\n            ? this.store.state.frontend\r\n            : this._readable.getFrontendStatus(address, overrides);\r\n    }\r\n    getTroves(params, overrides) {\r\n        return this._readable.getTroves(params, overrides);\r\n    }\r\n    _getActivePool() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    _getDefaultPool() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    _getRemainingLiquidityMiningLQTYRewardCalculator() {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n}\r\n//# sourceMappingURL=ReadableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BlockPolledLiquityStore = void 0;\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\n/**\r\n * Ethers-based {@link @liquity/lib-base#LiquityStore} that updates state whenever there's a new\r\n * block.\r\n *\r\n * @public\r\n */\r\nclass BlockPolledLiquityStore extends lib_base_1.LiquityStore {\r\n    constructor(readable) {\r\n        super();\r\n        this.connection = readable.connection;\r\n        this._readable = readable;\r\n        this._provider = EthersLiquityConnection_1._getProvider(readable.connection);\r\n    }\r\n    async _getRiskiestTroveBeforeRedistribution(overrides) {\r\n        const riskiestTroves = await this._readable.getTroves({ first: 1, sortedBy: \"ascendingCollateralRatio\", beforeRedistribution: true }, overrides);\r\n        if (riskiestTroves.length === 0) {\r\n            return new lib_base_1.TroveWithPendingRedistribution(constants_1.AddressZero, \"nonExistent\");\r\n        }\r\n        return riskiestTroves[0];\r\n    }\r\n    async _get(blockTag) {\r\n        const { userAddress, frontendTag } = this.connection;\r\n        const { blockTimestamp, _feesFactory, calculateRemainingLQTY, ...baseState } = await _utils_1.promiseAllValues({\r\n            blockTimestamp: this._readable._getBlockTimestamp(blockTag),\r\n            _feesFactory: this._readable._getFeesFactory({ blockTag }),\r\n            calculateRemainingLQTY: this._readable._getRemainingLiquidityMiningLQTYRewardCalculator({\r\n                blockTag\r\n            }),\r\n            price: this._readable.getPrice({ blockTag }),\r\n            numberOfTroves: this._readable.getNumberOfTroves({ blockTag }),\r\n            totalRedistributed: this._readable.getTotalRedistributed({ blockTag }),\r\n            total: this._readable.getTotal({ blockTag }),\r\n            lusdInStabilityPool: this._readable.getLUSDInStabilityPool({ blockTag }),\r\n            totalStakedLQTY: this._readable.getTotalStakedLQTY({ blockTag }),\r\n            _riskiestTroveBeforeRedistribution: this._getRiskiestTroveBeforeRedistribution({ blockTag }),\r\n            totalStakedUniTokens: this._readable.getTotalStakedUniTokens({ blockTag }),\r\n            remainingStabilityPoolLQTYReward: this._readable.getRemainingStabilityPoolLQTYReward({\r\n                blockTag\r\n            }),\r\n            frontend: frontendTag\r\n                ? this._readable.getFrontendStatus(frontendTag, { blockTag })\r\n                : { status: \"unregistered\" },\r\n            ...(userAddress\r\n                ? {\r\n                    accountBalance: this._provider.getBalance(userAddress, blockTag).then(_utils_1.decimalify),\r\n                    lusdBalance: this._readable.getLUSDBalance(userAddress, { blockTag }),\r\n                    lqtyBalance: this._readable.getLQTYBalance(userAddress, { blockTag }),\r\n                    uniTokenBalance: this._readable.getUniTokenBalance(userAddress, { blockTag }),\r\n                    uniTokenAllowance: this._readable.getUniTokenAllowance(userAddress, { blockTag }),\r\n                    liquidityMiningStake: this._readable.getLiquidityMiningStake(userAddress, { blockTag }),\r\n                    liquidityMiningLQTYReward: this._readable.getLiquidityMiningLQTYReward(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    collateralSurplusBalance: this._readable.getCollateralSurplusBalance(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    troveBeforeRedistribution: this._readable.getTroveBeforeRedistribution(userAddress, {\r\n                        blockTag\r\n                    }),\r\n                    stabilityDeposit: this._readable.getStabilityDeposit(userAddress, { blockTag }),\r\n                    lqtyStake: this._readable.getLQTYStake(userAddress, { blockTag }),\r\n                    ownFrontend: this._readable.getFrontendStatus(userAddress, { blockTag })\r\n                }\r\n                : {\r\n                    accountBalance: lib_base_1.Decimal.ZERO,\r\n                    lusdBalance: lib_base_1.Decimal.ZERO,\r\n                    lqtyBalance: lib_base_1.Decimal.ZERO,\r\n                    uniTokenBalance: lib_base_1.Decimal.ZERO,\r\n                    uniTokenAllowance: lib_base_1.Decimal.ZERO,\r\n                    liquidityMiningStake: lib_base_1.Decimal.ZERO,\r\n                    liquidityMiningLQTYReward: lib_base_1.Decimal.ZERO,\r\n                    collateralSurplusBalance: lib_base_1.Decimal.ZERO,\r\n                    troveBeforeRedistribution: new lib_base_1.TroveWithPendingRedistribution(constants_1.AddressZero, \"nonExistent\"),\r\n                    stabilityDeposit: new lib_base_1.StabilityDeposit(lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, lib_base_1.Decimal.ZERO, constants_1.AddressZero),\r\n                    lqtyStake: new lib_base_1.LQTYStake(),\r\n                    ownFrontend: { status: \"unregistered\" }\r\n                })\r\n        });\r\n        return [\r\n            {\r\n                ...baseState,\r\n                _feesInNormalMode: _feesFactory(blockTimestamp, false),\r\n                remainingLiquidityMiningLQTYReward: calculateRemainingLQTY(blockTimestamp)\r\n            },\r\n            {\r\n                blockTag,\r\n                blockTimestamp,\r\n                _feesFactory\r\n            }\r\n        ];\r\n    }\r\n    /** @internal @override */\r\n    _doStart() {\r\n        this._get().then(state => {\r\n            if (!this._loaded) {\r\n                this._load(...state);\r\n            }\r\n        });\r\n        const blockListener = async (blockTag) => {\r\n            const state = await this._get(blockTag);\r\n            if (this._loaded) {\r\n                this._update(...state);\r\n            }\r\n            else {\r\n                this._load(...state);\r\n            }\r\n        };\r\n        this._provider.on(\"block\", blockListener);\r\n        return () => {\r\n            this._provider.off(\"block\", blockListener);\r\n        };\r\n    }\r\n    /** @internal @override */\r\n    _reduceExtra(oldState, stateUpdate) {\r\n        var _a, _b, _c;\r\n        return {\r\n            blockTag: (_a = stateUpdate.blockTag) !== null && _a !== void 0 ? _a : oldState.blockTag,\r\n            blockTimestamp: (_b = stateUpdate.blockTimestamp) !== null && _b !== void 0 ? _b : oldState.blockTimestamp,\r\n            _feesFactory: (_c = stateUpdate._feesFactory) !== null && _c !== void 0 ? _c : oldState._feesFactory\r\n        };\r\n    }\r\n}\r\nexports.BlockPolledLiquityStore = BlockPolledLiquityStore;\r\n//# sourceMappingURL=BlockPolledLiquityStore.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.PopulatableEthersLiquity = exports.PopulatedEthersRedemption = exports.PopulatedEthersLiquityTransaction = exports.SentEthersLiquityTransaction = exports.EthersTransactionCancelledError = exports._RawErrorReason = exports._redeemMaxIterations = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst logger_1 = require(\"@ethersproject/logger\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst _utils_1 = require(\"./_utils\");\r\nconst contracts_1 = require(\"./contracts\");\r\nconst parseLogs_1 = require(\"./parseLogs\");\r\nconst bigNumberMax = (a, b) => ((b === null || b === void 0 ? void 0 : b.gt(a)) ? b : a);\r\n// With 70 iterations redemption costs about ~10M gas, and each iteration accounts for ~138k more\r\n/** @internal */\r\nexports._redeemMaxIterations = 70;\r\nconst defaultBorrowingRateSlippageTolerance = lib_base_1.Decimal.from(0.005); // 0.5%\r\nconst defaultRedemptionRateSlippageTolerance = lib_base_1.Decimal.from(0.001); // 0.1%\r\nconst defaultBorrowingFeeDecayToleranceMinutes = 10;\r\nconst noDetails = () => undefined;\r\nconst compose = (f, g) => (_) => f(g(_));\r\nconst id = (t) => t;\r\n// Takes ~6-7K (use 10K to be safe) to update lastFeeOperationTime, but the cost of calculating the\r\n// decayed baseRate increases logarithmically with time elapsed since the last update.\r\nconst addGasForBaseRateUpdate = (maxMinutesSinceLastUpdate = 10) => (gas) => gas.add(10000 + 1414 * Math.ceil(Math.log2(maxMinutesSinceLastUpdate + 1)));\r\n// First traversal in ascending direction takes ~50K, then ~13.5K per extra step.\r\n// 80K should be enough for 3 steps, plus some extra to be safe.\r\nconst addGasForPotentialListTraversal = (gas) => gas.add(80000);\r\nconst addGasForLQTYIssuance = (gas) => gas.add(50000);\r\nconst addGasForUnipoolRewardUpdate = (gas) => gas.add(20000);\r\n// To get the best entropy available, we'd do something like:\r\n//\r\n// const bigRandomNumber = () =>\r\n//   BigNumber.from(\r\n//     `0x${Array.from(crypto.getRandomValues(new Uint32Array(8)))\r\n//       .map(u32 => u32.toString(16).padStart(8, \"0\"))\r\n//       .join(\"\")}`\r\n//   );\r\n//\r\n// However, Window.crypto is browser-specific. Since we only use this for randomly picking Troves\r\n// during the search for hints, Math.random() will do fine, too.\r\n//\r\n// This returns a random integer between 0 and Number.MAX_SAFE_INTEGER\r\nconst randomInteger = () => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\r\n// Maximum number of trials to perform in a single getApproxHint() call. If the number of trials\r\n// required to get a statistically \"good\" hint is larger than this, the search for the hint will\r\n// be broken up into multiple getApproxHint() calls.\r\n//\r\n// This should be low enough to work with popular public Ethereum providers like Infura without\r\n// triggering any fair use limits.\r\nconst maxNumberOfTrialsAtOnce = 2500;\r\nfunction* generateTrials(totalNumberOfTrials) {\r\n    assert_1.default(Number.isInteger(totalNumberOfTrials) && totalNumberOfTrials > 0);\r\n    while (totalNumberOfTrials) {\r\n        const numberOfTrials = Math.min(totalNumberOfTrials, maxNumberOfTrialsAtOnce);\r\n        yield numberOfTrials;\r\n        totalNumberOfTrials -= numberOfTrials;\r\n    }\r\n}\r\n/** @internal */\r\nvar _RawErrorReason;\r\n(function (_RawErrorReason) {\r\n    _RawErrorReason[\"TRANSACTION_FAILED\"] = \"transaction failed\";\r\n    _RawErrorReason[\"TRANSACTION_CANCELLED\"] = \"cancelled\";\r\n    _RawErrorReason[\"TRANSACTION_REPLACED\"] = \"replaced\";\r\n    _RawErrorReason[\"TRANSACTION_REPRICED\"] = \"repriced\";\r\n})(_RawErrorReason = exports._RawErrorReason || (exports._RawErrorReason = {}));\r\nconst transactionReplacementReasons = [\r\n    _RawErrorReason.TRANSACTION_CANCELLED,\r\n    _RawErrorReason.TRANSACTION_REPLACED,\r\n    _RawErrorReason.TRANSACTION_REPRICED\r\n];\r\nconst hasProp = (o, p) => p in o;\r\nconst isTransactionFailedError = (error) => hasProp(error, \"code\") &&\r\n    error.code === logger_1.ErrorCode.CALL_EXCEPTION &&\r\n    hasProp(error, \"reason\") &&\r\n    error.reason === _RawErrorReason.TRANSACTION_FAILED;\r\nconst isTransactionReplacedError = (error) => hasProp(error, \"code\") &&\r\n    error.code === logger_1.ErrorCode.TRANSACTION_REPLACED &&\r\n    hasProp(error, \"reason\") &&\r\n    transactionReplacementReasons.includes(error.reason);\r\n/**\r\n * Thrown when a transaction is cancelled or replaced by a different transaction.\r\n *\r\n * @public\r\n */\r\nclass EthersTransactionCancelledError extends Error {\r\n    /** @internal */\r\n    constructor(rawError) {\r\n        assert_1.default(rawError.reason !== _RawErrorReason.TRANSACTION_REPRICED);\r\n        super(`Transaction ${rawError.reason}`);\r\n        this.name = \"TransactionCancelledError\";\r\n        this.rawReplacementReceipt = rawError.receipt;\r\n        this.rawError = rawError;\r\n    }\r\n}\r\nexports.EthersTransactionCancelledError = EthersTransactionCancelledError;\r\n/**\r\n * A transaction that has already been sent.\r\n *\r\n * @remarks\r\n * Returned by {@link SendableEthersLiquity} functions.\r\n *\r\n * @public\r\n */\r\nclass SentEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawSentTransaction, connection, parse) {\r\n        this.rawSentTransaction = rawSentTransaction;\r\n        this._connection = connection;\r\n        this._parse = parse;\r\n    }\r\n    _receiptFrom(rawReceipt) {\r\n        return rawReceipt\r\n            ? rawReceipt.status\r\n                ? lib_base_1._successfulReceipt(rawReceipt, this._parse(rawReceipt), () => parseLogs_1.logsToString(rawReceipt, EthersLiquityConnection_1._getContracts(this._connection)))\r\n                : lib_base_1._failedReceipt(rawReceipt)\r\n            : lib_base_1._pendingReceipt;\r\n    }\r\n    async _waitForRawReceipt(confirmations) {\r\n        try {\r\n            return await this.rawSentTransaction.wait(confirmations);\r\n        }\r\n        catch (error) {\r\n            if (error instanceof Error) {\r\n                if (isTransactionFailedError(error)) {\r\n                    return error.receipt;\r\n                }\r\n                if (isTransactionReplacedError(error)) {\r\n                    if (error.cancelled) {\r\n                        throw new EthersTransactionCancelledError(error);\r\n                    }\r\n                    else {\r\n                        return error.receipt;\r\n                    }\r\n                }\r\n            }\r\n            throw error;\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SentLiquityTransaction.getReceipt} */\r\n    async getReceipt() {\r\n        return this._receiptFrom(await this._waitForRawReceipt(0));\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#SentLiquityTransaction.waitForReceipt}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    async waitForReceipt() {\r\n        const receipt = this._receiptFrom(await this._waitForRawReceipt());\r\n        assert_1.default(receipt.status !== \"pending\");\r\n        return receipt;\r\n    }\r\n}\r\nexports.SentEthersLiquityTransaction = SentEthersLiquityTransaction;\r\nconst normalizeBorrowingOperationOptionalParams = (maxBorrowingRateOrOptionalParams, currentBorrowingRate) => {\r\n    var _a, _b;\r\n    if (maxBorrowingRateOrOptionalParams === undefined) {\r\n        return {\r\n            maxBorrowingRate: (_a = currentBorrowingRate === null || currentBorrowingRate === void 0 ? void 0 : currentBorrowingRate.add(defaultBorrowingRateSlippageTolerance)) !== null && _a !== void 0 ? _a : lib_base_1.Decimal.ZERO,\r\n            borrowingFeeDecayToleranceMinutes: defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n    else if (typeof maxBorrowingRateOrOptionalParams === \"number\" ||\r\n        typeof maxBorrowingRateOrOptionalParams === \"string\" ||\r\n        maxBorrowingRateOrOptionalParams instanceof lib_base_1.Decimal) {\r\n        return {\r\n            maxBorrowingRate: lib_base_1.Decimal.from(maxBorrowingRateOrOptionalParams),\r\n            borrowingFeeDecayToleranceMinutes: defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n    else {\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = maxBorrowingRateOrOptionalParams;\r\n        return {\r\n            maxBorrowingRate: maxBorrowingRate !== undefined\r\n                ? lib_base_1.Decimal.from(maxBorrowingRate)\r\n                : (_b = currentBorrowingRate === null || currentBorrowingRate === void 0 ? void 0 : currentBorrowingRate.add(defaultBorrowingRateSlippageTolerance)) !== null && _b !== void 0 ? _b : lib_base_1.Decimal.ZERO,\r\n            borrowingFeeDecayToleranceMinutes: borrowingFeeDecayToleranceMinutes !== null && borrowingFeeDecayToleranceMinutes !== void 0 ? borrowingFeeDecayToleranceMinutes : defaultBorrowingFeeDecayToleranceMinutes\r\n        };\r\n    }\r\n};\r\n/**\r\n * A transaction that has been prepared for sending.\r\n *\r\n * @remarks\r\n * Returned by {@link PopulatableEthersLiquity} functions.\r\n *\r\n * @public\r\n */\r\nclass PopulatedEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawPopulatedTransaction, connection, parse, gasHeadroom) {\r\n        this.rawPopulatedTransaction = rawPopulatedTransaction;\r\n        this._connection = connection;\r\n        this._parse = parse;\r\n        if (gasHeadroom !== undefined) {\r\n            this.gasHeadroom = gasHeadroom;\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatedLiquityTransaction.send} */\r\n    async send() {\r\n        return new SentEthersLiquityTransaction(await EthersLiquityConnection_1._requireSigner(this._connection).sendTransaction(this.rawPopulatedTransaction), this._connection, this._parse);\r\n    }\r\n}\r\nexports.PopulatedEthersLiquityTransaction = PopulatedEthersLiquityTransaction;\r\n/**\r\n * {@inheritDoc @liquity/lib-base#PopulatedRedemption}\r\n *\r\n * @public\r\n */\r\nclass PopulatedEthersRedemption extends PopulatedEthersLiquityTransaction {\r\n    /** @internal */\r\n    constructor(rawPopulatedTransaction, connection, attemptedLUSDAmount, redeemableLUSDAmount, increaseAmountByMinimumNetDebt) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(connection);\r\n        super(rawPopulatedTransaction, connection, ({ logs }) => troveManager\r\n            .extractEvents(logs, \"Redemption\")\r\n            .map(({ args: { _ETHSent, _ETHFee, _actualLUSDAmount, _attemptedLUSDAmount } }) => ({\r\n            attemptedLUSDAmount: _utils_1.decimalify(_attemptedLUSDAmount),\r\n            actualLUSDAmount: _utils_1.decimalify(_actualLUSDAmount),\r\n            collateralTaken: _utils_1.decimalify(_ETHSent),\r\n            fee: _utils_1.decimalify(_ETHFee)\r\n        }))[0]);\r\n        this.attemptedLUSDAmount = attemptedLUSDAmount;\r\n        this.redeemableLUSDAmount = redeemableLUSDAmount;\r\n        this.isTruncated = redeemableLUSDAmount.lt(attemptedLUSDAmount);\r\n        this._increaseAmountByMinimumNetDebt = increaseAmountByMinimumNetDebt;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatedRedemption.increaseAmountByMinimumNetDebt} */\r\n    increaseAmountByMinimumNetDebt(maxRedemptionRate) {\r\n        if (!this._increaseAmountByMinimumNetDebt) {\r\n            throw new Error(\"PopulatedEthersRedemption: increaseAmountByMinimumNetDebt() can \" +\r\n                \"only be called when amount is truncated\");\r\n        }\r\n        return this._increaseAmountByMinimumNetDebt(maxRedemptionRate);\r\n    }\r\n}\r\nexports.PopulatedEthersRedemption = PopulatedEthersRedemption;\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#PopulatableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass PopulatableEthersLiquity {\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n    }\r\n    _wrapSimpleTransaction(rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, noDetails);\r\n    }\r\n    _wrapTroveChangeWithFees(params, rawPopulatedTransaction, gasHeadroom) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const [newTrove] = borrowerOperations\r\n                .extractEvents(logs, \"TroveUpdated\")\r\n                .map(({ args: { _coll, _debt } }) => new lib_base_1.Trove(_utils_1.decimalify(_coll), _utils_1.decimalify(_debt)));\r\n            const [fee] = borrowerOperations\r\n                .extractEvents(logs, \"LUSDBorrowingFeePaid\")\r\n                .map(({ args: { _LUSDFee } }) => _utils_1.decimalify(_LUSDFee));\r\n            return {\r\n                params,\r\n                newTrove,\r\n                fee\r\n            };\r\n        }, gasHeadroom);\r\n    }\r\n    async _wrapTroveClosure(rawPopulatedTransaction) {\r\n        const { activePool, lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs, from: userAddress }) => {\r\n            const [repayLUSD] = lusdToken\r\n                .extractEvents(logs, \"Transfer\")\r\n                .filter(({ args: { from, to } }) => from === userAddress && to === constants_1.AddressZero)\r\n                .map(({ args: { value } }) => _utils_1.decimalify(value));\r\n            const [withdrawCollateral] = activePool\r\n                .extractEvents(logs, \"EtherSent\")\r\n                .filter(({ args: { _to } }) => _to === userAddress)\r\n                .map(({ args: { _amount } }) => _utils_1.decimalify(_amount));\r\n            return {\r\n                params: repayLUSD.nonZero ? { withdrawCollateral, repayLUSD } : { withdrawCollateral }\r\n            };\r\n        });\r\n    }\r\n    _wrapLiquidation(rawPopulatedTransaction) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const liquidatedAddresses = troveManager\r\n                .extractEvents(logs, \"TroveLiquidated\")\r\n                .map(({ args: { _borrower } }) => _borrower);\r\n            const [totals] = troveManager\r\n                .extractEvents(logs, \"Liquidation\")\r\n                .map(({ args: { _LUSDGasCompensation, _collGasCompensation, _liquidatedColl, _liquidatedDebt } }) => ({\r\n                collateralGasCompensation: _utils_1.decimalify(_collGasCompensation),\r\n                lusdGasCompensation: _utils_1.decimalify(_LUSDGasCompensation),\r\n                totalLiquidated: new lib_base_1.Trove(_utils_1.decimalify(_liquidatedColl), _utils_1.decimalify(_liquidatedDebt))\r\n            }));\r\n            return {\r\n                liquidatedAddresses,\r\n                ...totals\r\n            };\r\n        });\r\n    }\r\n    _extractStabilityPoolGainsWithdrawalDetails(logs) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const [newLUSDDeposit] = stabilityPool\r\n            .extractEvents(logs, \"UserDepositChanged\")\r\n            .map(({ args: { _newDeposit } }) => _utils_1.decimalify(_newDeposit));\r\n        const [[collateralGain, lusdLoss]] = stabilityPool\r\n            .extractEvents(logs, \"ETHGainWithdrawn\")\r\n            .map(({ args: { _ETH, _LUSDLoss } }) => [_utils_1.decimalify(_ETH), _utils_1.decimalify(_LUSDLoss)]);\r\n        const [lqtyReward] = stabilityPool\r\n            .extractEvents(logs, \"LQTYPaidToDepositor\")\r\n            .map(({ args: { _LQTY } }) => _utils_1.decimalify(_LQTY));\r\n        return {\r\n            lusdLoss,\r\n            newLUSDDeposit,\r\n            collateralGain,\r\n            lqtyReward\r\n        };\r\n    }\r\n    _wrapStabilityPoolGainsWithdrawal(rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => this._extractStabilityPoolGainsWithdrawalDetails(logs));\r\n    }\r\n    _wrapStabilityDepositTopup(change, rawPopulatedTransaction) {\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => ({\r\n            ...this._extractStabilityPoolGainsWithdrawalDetails(logs),\r\n            change\r\n        }));\r\n    }\r\n    async _wrapStabilityDepositWithdrawal(rawPopulatedTransaction) {\r\n        const { stabilityPool, lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs, from: userAddress }) => {\r\n            const gainsWithdrawalDetails = this._extractStabilityPoolGainsWithdrawalDetails(logs);\r\n            const [withdrawLUSD] = lusdToken\r\n                .extractEvents(logs, \"Transfer\")\r\n                .filter(({ args: { from, to } }) => from === stabilityPool.address && to === userAddress)\r\n                .map(({ args: { value } }) => _utils_1.decimalify(value));\r\n            return {\r\n                ...gainsWithdrawalDetails,\r\n                change: { withdrawLUSD, withdrawAllLUSD: gainsWithdrawalDetails.newLUSDDeposit.isZero }\r\n            };\r\n        });\r\n    }\r\n    _wrapCollateralGainTransfer(rawPopulatedTransaction) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return new PopulatedEthersLiquityTransaction(rawPopulatedTransaction, this._readable.connection, ({ logs }) => {\r\n            const [newTrove] = borrowerOperations\r\n                .extractEvents(logs, \"TroveUpdated\")\r\n                .map(({ args: { _coll, _debt } }) => new lib_base_1.Trove(_utils_1.decimalify(_coll), _utils_1.decimalify(_debt)));\r\n            return {\r\n                ...this._extractStabilityPoolGainsWithdrawalDetails(logs),\r\n                newTrove\r\n            };\r\n        });\r\n    }\r\n    async _findHintsForNominalCollateralRatio(nominalCollateralRatio, ownAddress) {\r\n        const { sortedTroves, hintHelpers } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const numberOfTroves = await this._readable.getNumberOfTroves();\r\n        if (!numberOfTroves) {\r\n            return [constants_1.AddressZero, constants_1.AddressZero];\r\n        }\r\n        if (nominalCollateralRatio.infinite) {\r\n            return [constants_1.AddressZero, await sortedTroves.getFirst()];\r\n        }\r\n        const totalNumberOfTrials = Math.ceil(10 * Math.sqrt(numberOfTroves));\r\n        const [firstTrials, ...restOfTrials] = generateTrials(totalNumberOfTrials);\r\n        const collectApproxHint = ({ latestRandomSeed, results }, numberOfTrials) => hintHelpers\r\n            .getApproxHint(nominalCollateralRatio.hex, numberOfTrials, latestRandomSeed)\r\n            .then(({ latestRandomSeed, ...result }) => ({\r\n            latestRandomSeed,\r\n            results: [...results, result]\r\n        }));\r\n        const { results } = await restOfTrials.reduce((p, numberOfTrials) => p.then(state => collectApproxHint(state, numberOfTrials)), collectApproxHint({ latestRandomSeed: randomInteger(), results: [] }, firstTrials));\r\n        const { hintAddress } = results.reduce((a, b) => (a.diff.lt(b.diff) ? a : b));\r\n        let [prev, next] = await sortedTroves.findInsertPosition(nominalCollateralRatio.hex, hintAddress, hintAddress);\r\n        if (ownAddress) {\r\n            // In the case of reinsertion, the address of the Trove being reinserted is not a usable hint,\r\n            // because it is deleted from the list before the reinsertion.\r\n            // \"Jump over\" the Trove to get the proper hint.\r\n            if (prev === ownAddress) {\r\n                prev = await sortedTroves.getPrev(prev);\r\n            }\r\n            else if (next === ownAddress) {\r\n                next = await sortedTroves.getNext(next);\r\n            }\r\n        }\r\n        // Don't use `address(0)` as hint as it can result in huge gas cost.\r\n        // (See https://github.com/liquity/dev/issues/600).\r\n        if (prev === constants_1.AddressZero) {\r\n            prev = next;\r\n        }\r\n        else if (next === constants_1.AddressZero) {\r\n            next = prev;\r\n        }\r\n        return [prev, next];\r\n    }\r\n    async _findHints(trove, ownAddress) {\r\n        if (trove instanceof lib_base_1.TroveWithPendingRedistribution) {\r\n            throw new Error(\"Rewards must be applied to this Trove\");\r\n        }\r\n        return this._findHintsForNominalCollateralRatio(trove._nominalCollateralRatio, ownAddress);\r\n    }\r\n    async _findRedemptionHints(amount) {\r\n        const { hintHelpers } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const price = await this._readable.getPrice();\r\n        const { firstRedemptionHint, partialRedemptionHintNICR, truncatedLUSDamount } = await hintHelpers.getRedemptionHints(amount.hex, price.hex, exports._redeemMaxIterations);\r\n        const [partialRedemptionUpperHint, partialRedemptionLowerHint] = partialRedemptionHintNICR.isZero()\r\n            ? [constants_1.AddressZero, constants_1.AddressZero]\r\n            : await this._findHintsForNominalCollateralRatio(_utils_1.decimalify(partialRedemptionHintNICR)\r\n            // XXX: if we knew the partially redeemed Trove's address, we'd pass it here\r\n            );\r\n        return [\r\n            _utils_1.decimalify(truncatedLUSDamount),\r\n            firstRedemptionHint,\r\n            partialRedemptionUpperHint,\r\n            partialRedemptionLowerHint,\r\n            partialRedemptionHintNICR\r\n        ];\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.openTrove} */\r\n    async openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const normalizedParams = lib_base_1._normalizeTroveCreation(params);\r\n        const { depositCollateral, borrowLUSD } = normalizedParams;\r\n        const [fees, blockTimestamp, total, price] = await Promise.all([\r\n            this._readable._getFeesFactory(),\r\n            this._readable._getBlockTimestamp(),\r\n            this._readable.getTotal(),\r\n            this._readable.getPrice()\r\n        ]);\r\n        const recoveryMode = total.collateralRatioIsBelowCritical(price);\r\n        const decayBorrowingRate = (seconds) => fees(blockTimestamp + seconds, recoveryMode).borrowingRate();\r\n        const currentBorrowingRate = decayBorrowingRate(0);\r\n        const newTrove = lib_base_1.Trove.create(normalizedParams, currentBorrowingRate);\r\n        const hints = await this._findHints(newTrove);\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = normalizeBorrowingOperationOptionalParams(maxBorrowingRateOrOptionalParams, currentBorrowingRate);\r\n        const txParams = (borrowLUSD) => [\r\n            maxBorrowingRate.hex,\r\n            borrowLUSD.hex,\r\n            ...hints,\r\n            { value: depositCollateral.hex, ...overrides }\r\n        ];\r\n        let gasHeadroom;\r\n        if ((overrides === null || overrides === void 0 ? void 0 : overrides.gasLimit) === undefined) {\r\n            const decayedBorrowingRate = decayBorrowingRate(60 * borrowingFeeDecayToleranceMinutes);\r\n            const decayedTrove = lib_base_1.Trove.create(normalizedParams, decayedBorrowingRate);\r\n            const { borrowLUSD: borrowLUSDSimulatingDecay } = lib_base_1.Trove.recreate(decayedTrove, currentBorrowingRate);\r\n            if (decayedTrove.debt.lt(lib_base_1.LUSD_MINIMUM_DEBT)) {\r\n                throw new Error(`Trove's debt might fall below ${lib_base_1.LUSD_MINIMUM_DEBT} ` +\r\n                    `within ${borrowingFeeDecayToleranceMinutes} minutes`);\r\n            }\r\n            const [gasNow, gasLater] = await Promise.all([\r\n                borrowerOperations.estimateGas.openTrove(...txParams(borrowLUSD)),\r\n                borrowerOperations.estimateGas.openTrove(...txParams(borrowLUSDSimulatingDecay))\r\n            ]);\r\n            const gasLimit = addGasForBaseRateUpdate(borrowingFeeDecayToleranceMinutes)(bigNumberMax(addGasForPotentialListTraversal(gasNow), gasLater));\r\n            gasHeadroom = gasLimit.sub(gasNow).toNumber();\r\n            overrides = { ...overrides, gasLimit };\r\n        }\r\n        return this._wrapTroveChangeWithFees(normalizedParams, await borrowerOperations.populateTransaction.openTrove(...txParams(borrowLUSD)), gasHeadroom);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.closeTrove} */\r\n    async closeTrove(overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapTroveClosure(await borrowerOperations.estimateAndPopulate.closeTrove({ ...overrides }, id));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.depositCollateral} */\r\n    depositCollateral(amount, overrides) {\r\n        return this.adjustTrove({ depositCollateral: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawCollateral} */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this.adjustTrove({ withdrawCollateral: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.borrowLUSD} */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this.adjustTrove({ borrowLUSD: amount }, maxBorrowingRate, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.repayLUSD} */\r\n    repayLUSD(amount, overrides) {\r\n        return this.adjustTrove({ repayLUSD: amount }, undefined, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.adjustTrove} */\r\n    async adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        const address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides);\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const normalizedParams = lib_base_1._normalizeTroveAdjustment(params);\r\n        const { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD } = normalizedParams;\r\n        const [trove, feeVars] = await Promise.all([\r\n            this._readable.getTrove(address),\r\n            borrowLUSD &&\r\n                _utils_1.promiseAllValues({\r\n                    fees: this._readable._getFeesFactory(),\r\n                    blockTimestamp: this._readable._getBlockTimestamp(),\r\n                    total: this._readable.getTotal(),\r\n                    price: this._readable.getPrice()\r\n                })\r\n        ]);\r\n        const decayBorrowingRate = (seconds) => feeVars === null || feeVars === void 0 ? void 0 : feeVars.fees(feeVars.blockTimestamp + seconds, feeVars.total.collateralRatioIsBelowCritical(feeVars.price)).borrowingRate();\r\n        const currentBorrowingRate = decayBorrowingRate(0);\r\n        const adjustedTrove = trove.adjust(normalizedParams, currentBorrowingRate);\r\n        const hints = await this._findHints(adjustedTrove, address);\r\n        const { maxBorrowingRate, borrowingFeeDecayToleranceMinutes } = normalizeBorrowingOperationOptionalParams(maxBorrowingRateOrOptionalParams, currentBorrowingRate);\r\n        const txParams = (borrowLUSD) => {\r\n            var _a;\r\n            return [\r\n                maxBorrowingRate.hex,\r\n                (withdrawCollateral !== null && withdrawCollateral !== void 0 ? withdrawCollateral : lib_base_1.Decimal.ZERO).hex,\r\n                ((_a = borrowLUSD !== null && borrowLUSD !== void 0 ? borrowLUSD : repayLUSD) !== null && _a !== void 0 ? _a : lib_base_1.Decimal.ZERO).hex,\r\n                !!borrowLUSD,\r\n                ...hints,\r\n                { value: depositCollateral === null || depositCollateral === void 0 ? void 0 : depositCollateral.hex, ...overrides }\r\n            ];\r\n        };\r\n        let gasHeadroom;\r\n        if ((overrides === null || overrides === void 0 ? void 0 : overrides.gasLimit) === undefined) {\r\n            const decayedBorrowingRate = decayBorrowingRate(60 * borrowingFeeDecayToleranceMinutes);\r\n            const decayedTrove = trove.adjust(normalizedParams, decayedBorrowingRate);\r\n            const { borrowLUSD: borrowLUSDSimulatingDecay } = trove.adjustTo(decayedTrove, currentBorrowingRate);\r\n            if (decayedTrove.debt.lt(lib_base_1.LUSD_MINIMUM_DEBT)) {\r\n                throw new Error(`Trove's debt might fall below ${lib_base_1.LUSD_MINIMUM_DEBT} ` +\r\n                    `within ${borrowingFeeDecayToleranceMinutes} minutes`);\r\n            }\r\n            const [gasNow, gasLater] = await Promise.all([\r\n                borrowerOperations.estimateGas.adjustTrove(...txParams(borrowLUSD)),\r\n                borrowLUSD &&\r\n                    borrowerOperations.estimateGas.adjustTrove(...txParams(borrowLUSDSimulatingDecay))\r\n            ]);\r\n            let gasLimit = bigNumberMax(addGasForPotentialListTraversal(gasNow), gasLater);\r\n            if (borrowLUSD) {\r\n                gasLimit = addGasForBaseRateUpdate(borrowingFeeDecayToleranceMinutes)(gasLimit);\r\n            }\r\n            gasHeadroom = gasLimit.sub(gasNow).toNumber();\r\n            overrides = { ...overrides, gasLimit };\r\n        }\r\n        return this._wrapTroveChangeWithFees(normalizedParams, await borrowerOperations.populateTransaction.adjustTrove(...txParams(borrowLUSD)), gasHeadroom);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.claimCollateralSurplus} */\r\n    async claimCollateralSurplus(overrides) {\r\n        const { borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await borrowerOperations.estimateAndPopulate.claimCollateral({ ...overrides }, id));\r\n    }\r\n    /** @internal */\r\n    async setPrice(price, overrides) {\r\n        const { priceFeed } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (!contracts_1._priceFeedIsTestnet(priceFeed)) {\r\n            throw new Error(\"setPrice() unavailable on this deployment of Liquity\");\r\n        }\r\n        return this._wrapSimpleTransaction(await priceFeed.estimateAndPopulate.setPrice({ ...overrides }, id, lib_base_1.Decimal.from(price).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.liquidate} */\r\n    async liquidate(address, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (Array.isArray(address)) {\r\n            return this._wrapLiquidation(await troveManager.estimateAndPopulate.batchLiquidateTroves({ ...overrides }, addGasForLQTYIssuance, address));\r\n        }\r\n        else {\r\n            return this._wrapLiquidation(await troveManager.estimateAndPopulate.liquidate({ ...overrides }, addGasForLQTYIssuance, address));\r\n        }\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.liquidateUpTo} */\r\n    async liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapLiquidation(await troveManager.estimateAndPopulate.liquidateTroves({ ...overrides }, addGasForLQTYIssuance, maximumNumberOfTrovesToLiquidate));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.depositLUSDInStabilityPool} */\r\n    async depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        var _a;\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const depositLUSD = lib_base_1.Decimal.from(amount);\r\n        return this._wrapStabilityDepositTopup({ depositLUSD }, await stabilityPool.estimateAndPopulate.provideToSP({ ...overrides }, addGasForLQTYIssuance, depositLUSD.hex, (_a = frontendTag !== null && frontendTag !== void 0 ? frontendTag : this._readable.connection.frontendTag) !== null && _a !== void 0 ? _a : constants_1.AddressZero));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawLUSDFromStabilityPool} */\r\n    async withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapStabilityDepositWithdrawal(await stabilityPool.estimateAndPopulate.withdrawFromSP({ ...overrides }, addGasForLQTYIssuance, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawGainsFromStabilityPool} */\r\n    async withdrawGainsFromStabilityPool(overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapStabilityPoolGainsWithdrawal(await stabilityPool.estimateAndPopulate.withdrawFromSP({ ...overrides }, addGasForLQTYIssuance, lib_base_1.Decimal.ZERO.hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.transferCollateralGainToTrove} */\r\n    async transferCollateralGainToTrove(overrides) {\r\n        const address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides);\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const [initialTrove, stabilityDeposit] = await Promise.all([\r\n            this._readable.getTrove(address),\r\n            this._readable.getStabilityDeposit(address)\r\n        ]);\r\n        const finalTrove = initialTrove.addCollateral(stabilityDeposit.collateralGain);\r\n        return this._wrapCollateralGainTransfer(await stabilityPool.estimateAndPopulate.withdrawETHGainToTrove({ ...overrides }, compose(addGasForPotentialListTraversal, addGasForLQTYIssuance), ...(await this._findHints(finalTrove, address))));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.sendLUSD} */\r\n    async sendLUSD(toAddress, amount, overrides) {\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lusdToken.estimateAndPopulate.transfer({ ...overrides }, id, toAddress, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.sendLQTY} */\r\n    async sendLQTY(toAddress, amount, overrides) {\r\n        const { lqtyToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyToken.estimateAndPopulate.transfer({ ...overrides }, id, toAddress, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.redeemLUSD} */\r\n    async redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const attemptedLUSDAmount = lib_base_1.Decimal.from(amount);\r\n        const [fees, total, [truncatedAmount, firstRedemptionHint, ...partialHints]] = await Promise.all([\r\n            this._readable.getFees(),\r\n            this._readable.getTotal(),\r\n            this._findRedemptionHints(attemptedLUSDAmount)\r\n        ]);\r\n        if (truncatedAmount.isZero) {\r\n            throw new Error(`redeemLUSD: amount too low to redeem (try at least ${lib_base_1.LUSD_MINIMUM_NET_DEBT})`);\r\n        }\r\n        const defaultMaxRedemptionRate = (amount) => lib_base_1.Decimal.min(fees.redemptionRate(amount.div(total.debt)).add(defaultRedemptionRateSlippageTolerance), lib_base_1.Decimal.ONE);\r\n        const populateRedemption = async (attemptedLUSDAmount, maxRedemptionRate, truncatedAmount = attemptedLUSDAmount, partialHints = [constants_1.AddressZero, constants_1.AddressZero, 0]) => {\r\n            const maxRedemptionRateOrDefault = maxRedemptionRate !== undefined\r\n                ? lib_base_1.Decimal.from(maxRedemptionRate)\r\n                : defaultMaxRedemptionRate(truncatedAmount);\r\n            return new PopulatedEthersRedemption(await troveManager.estimateAndPopulate.redeemCollateral({ ...overrides }, addGasForBaseRateUpdate(), truncatedAmount.hex, firstRedemptionHint, ...partialHints, exports._redeemMaxIterations, maxRedemptionRateOrDefault.hex), this._readable.connection, attemptedLUSDAmount, truncatedAmount, truncatedAmount.lt(attemptedLUSDAmount)\r\n                ? newMaxRedemptionRate => populateRedemption(truncatedAmount.add(lib_base_1.LUSD_MINIMUM_NET_DEBT), newMaxRedemptionRate !== null && newMaxRedemptionRate !== void 0 ? newMaxRedemptionRate : maxRedemptionRate)\r\n                : undefined);\r\n        };\r\n        return populateRedemption(attemptedLUSDAmount, maxRedemptionRate, truncatedAmount, partialHints);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.stakeLQTY} */\r\n    async stakeLQTY(amount, overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyStaking.estimateAndPopulate.stake({ ...overrides }, id, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.unstakeLQTY} */\r\n    async unstakeLQTY(amount, overrides) {\r\n        const { lqtyStaking } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await lqtyStaking.estimateAndPopulate.unstake({ ...overrides }, id, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawGainsFromStaking} */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this.unstakeLQTY(lib_base_1.Decimal.ZERO, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.registerFrontend} */\r\n    async registerFrontend(kickbackRate, overrides) {\r\n        const { stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await stabilityPool.estimateAndPopulate.registerFrontEnd({ ...overrides }, id, lib_base_1.Decimal.from(kickbackRate).hex));\r\n    }\r\n    /** @internal */\r\n    async _mintUniToken(amount, address, overrides) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection, overrides));\r\n        const { uniToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        if (!contracts_1._uniTokenIsMock(uniToken)) {\r\n            throw new Error(\"_mintUniToken() unavailable on this deployment of Liquity\");\r\n        }\r\n        return this._wrapSimpleTransaction(await uniToken.estimateAndPopulate.mint({ ...overrides }, id, address, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.approveUniTokens} */\r\n    async approveUniTokens(allowance, overrides) {\r\n        const { uniToken, unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await uniToken.estimateAndPopulate.approve({ ...overrides }, id, unipool.address, lib_base_1.Decimal.from(allowance !== null && allowance !== void 0 ? allowance : lib_base_1.Decimal.INFINITY).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.stakeUniTokens} */\r\n    async stakeUniTokens(amount, overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.stake({ ...overrides }, addGasForUnipoolRewardUpdate, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.unstakeUniTokens} */\r\n    async unstakeUniTokens(amount, overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.withdraw({ ...overrides }, addGasForUnipoolRewardUpdate, lib_base_1.Decimal.from(amount).hex));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.withdrawLQTYRewardFromLiquidityMining} */\r\n    async withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.claimReward({ ...overrides }, addGasForUnipoolRewardUpdate));\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#PopulatableLiquity.exitLiquidityMining} */\r\n    async exitLiquidityMining(overrides) {\r\n        const { unipool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        return this._wrapSimpleTransaction(await unipool.estimateAndPopulate.withdrawAndClaim({ ...overrides }, addGasForUnipoolRewardUpdate));\r\n    }\r\n}\r\nexports.PopulatableEthersLiquity = PopulatableEthersLiquity;\r\n//# sourceMappingURL=PopulatableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.SendableEthersLiquity = void 0;\r\nconst sendTransaction = (tx) => tx.send();\r\n/**\r\n * Ethers-based implementation of {@link @liquity/lib-base#SendableLiquity}.\r\n *\r\n * @public\r\n */\r\nclass SendableEthersLiquity {\r\n    constructor(populatable) {\r\n        this._populate = populatable;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.openTrove} */\r\n    async openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this._populate\r\n            .openTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.closeTrove} */\r\n    closeTrove(overrides) {\r\n        return this._populate.closeTrove(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.adjustTrove} */\r\n    adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this._populate\r\n            .adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.depositCollateral} */\r\n    depositCollateral(amount, overrides) {\r\n        return this._populate.depositCollateral(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawCollateral} */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this._populate.withdrawCollateral(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.borrowLUSD} */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this._populate.borrowLUSD(amount, maxBorrowingRate, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.repayLUSD} */\r\n    repayLUSD(amount, overrides) {\r\n        return this._populate.repayLUSD(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** @internal */\r\n    setPrice(price, overrides) {\r\n        return this._populate.setPrice(price, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.liquidate} */\r\n    liquidate(address, overrides) {\r\n        return this._populate.liquidate(address, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.liquidateUpTo} */\r\n    liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        return this._populate\r\n            .liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.depositLUSDInStabilityPool} */\r\n    depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        return this._populate\r\n            .depositLUSDInStabilityPool(amount, frontendTag, overrides)\r\n            .then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawLUSDFromStabilityPool} */\r\n    withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        return this._populate.withdrawLUSDFromStabilityPool(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawGainsFromStabilityPool} */\r\n    withdrawGainsFromStabilityPool(overrides) {\r\n        return this._populate.withdrawGainsFromStabilityPool(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.transferCollateralGainToTrove} */\r\n    transferCollateralGainToTrove(overrides) {\r\n        return this._populate.transferCollateralGainToTrove(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.sendLUSD} */\r\n    sendLUSD(toAddress, amount, overrides) {\r\n        return this._populate.sendLUSD(toAddress, amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.sendLQTY} */\r\n    sendLQTY(toAddress, amount, overrides) {\r\n        return this._populate.sendLQTY(toAddress, amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.redeemLUSD} */\r\n    redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        return this._populate.redeemLUSD(amount, maxRedemptionRate, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.claimCollateralSurplus} */\r\n    claimCollateralSurplus(overrides) {\r\n        return this._populate.claimCollateralSurplus(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.stakeLQTY} */\r\n    stakeLQTY(amount, overrides) {\r\n        return this._populate.stakeLQTY(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.unstakeLQTY} */\r\n    unstakeLQTY(amount, overrides) {\r\n        return this._populate.unstakeLQTY(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawGainsFromStaking} */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this._populate.withdrawGainsFromStaking(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.registerFrontend} */\r\n    registerFrontend(kickbackRate, overrides) {\r\n        return this._populate.registerFrontend(kickbackRate, overrides).then(sendTransaction);\r\n    }\r\n    /** @internal */\r\n    _mintUniToken(amount, address, overrides) {\r\n        return this._populate._mintUniToken(amount, address, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.approveUniTokens} */\r\n    approveUniTokens(allowance, overrides) {\r\n        return this._populate.approveUniTokens(allowance, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.stakeUniTokens} */\r\n    stakeUniTokens(amount, overrides) {\r\n        return this._populate.stakeUniTokens(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.unstakeUniTokens} */\r\n    unstakeUniTokens(amount, overrides) {\r\n        return this._populate.unstakeUniTokens(amount, overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.withdrawLQTYRewardFromLiquidityMining} */\r\n    withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        return this._populate.withdrawLQTYRewardFromLiquidityMining(overrides).then(sendTransaction);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#SendableLiquity.exitLiquidityMining} */\r\n    exitLiquidityMining(overrides) {\r\n        return this._populate.exitLiquidityMining(overrides).then(sendTransaction);\r\n    }\r\n}\r\nexports.SendableEthersLiquity = SendableEthersLiquity;\r\n//# sourceMappingURL=SendableEthersLiquity.js.map","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LiquityStoreProvider = exports.LiquityStoreContext = void 0;\r\nconst react_1 = __importStar(require(\"react\"));\r\nexports.LiquityStoreContext = react_1.createContext(undefined);\r\nconst LiquityStoreProvider = ({ store, loader, children }) => {\r\n    const [loadedStore, setLoadedStore] = react_1.useState();\r\n    react_1.useEffect(() => {\r\n        store.onLoaded = () => setLoadedStore(store);\r\n        const stop = store.start();\r\n        return () => {\r\n            store.onLoaded = undefined;\r\n            setLoadedStore(undefined);\r\n            stop();\r\n        };\r\n    }, [store]);\r\n    if (!loadedStore) {\r\n        return react_1.default.createElement(react_1.default.Fragment, null, loader);\r\n    }\r\n    return react_1.default.createElement(exports.LiquityStoreContext.Provider, { value: loadedStore }, children);\r\n};\r\nexports.LiquityStoreProvider = LiquityStoreProvider;\r\n//# sourceMappingURL=LiquityStoreProvider.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.equals = void 0;\r\nconst hasOwnProperty = (o, key) => Object.prototype.hasOwnProperty.call(o, key);\r\nconst shallowEquals = (a, b) => {\r\n    const keysA = Object.keys(a);\r\n    const keysB = Object.keys(b);\r\n    return (keysA.length === keysB.length &&\r\n        keysA.every(key => hasOwnProperty(b, key) && Object.is(a[key], b[key])));\r\n};\r\nconst isObject = (a) => a !== null && typeof a === \"object\";\r\nconst equals = (a, b) => isObject(a) && isObject(b) ? shallowEquals(a, b) : Object.is(a, b);\r\nexports.equals = equals;\r\n//# sourceMappingURL=equals.js.map","import { hexlify } from \"@ethersproject/bytes\";\r\nimport { Wallet } from \"@ethersproject/wallet\";\r\nimport { signTypedData, SignTypedDataVersion } from \"@metamask/eth-sig-util\";\r\n\r\nimport { Decimal, Decimalish } from \"@liquity/lib-base\";\r\n\r\nexport class DisposableWalletProvider {\r\n  private readonly url: string;\r\n  private id: number = 0;\r\n\r\n  private readonly wallet: Wallet;\r\n  private readonly funderWallet: Wallet;\r\n\r\n  private readonly ethAmount: Decimal;\r\n  private haveFunded = false;\r\n\r\n  constructor(url: string, funderPrivateKey: string, ethAmount: Decimalish = 100) {\r\n    this.url = url;\r\n    this.wallet = Wallet.createRandom();\r\n    this.funderWallet = new Wallet(funderPrivateKey);\r\n    this.ethAmount = Decimal.from(ethAmount);\r\n  }\r\n\r\n  private findWallet(address: string) {\r\n    const wallet = [this.wallet, this.funderWallet].find(\r\n      wallet => wallet.address.toLowerCase() === address.toLowerCase()\r\n    );\r\n\r\n    // console.log(address, this.wallet, this.funderWallet);\r\n\r\n    if (!wallet) {\r\n      throw new Error(`Unknow account ${address}`);\r\n    }\r\n\r\n    return wallet;\r\n  }\r\n\r\n  private async fund() {\r\n    return this.send(\"eth_sendTransaction\", [\r\n      {\r\n        from: this.funderWallet.address,\r\n        to: this.wallet.address,\r\n        value: this.ethAmount.hex,\r\n        gas: hexlify(21000)\r\n      }\r\n    ]);\r\n\r\n    // TODO maybe wait for tx to be mined (not a problem on devchains though)\r\n  }\r\n\r\n  async send(method: string, params: any[]): Promise<any> {\r\n    if (!this.haveFunded) {\r\n      this.haveFunded = true;\r\n      await this.fund();\r\n    }\r\n\r\n    switch (method) {\r\n      case \"eth_accounts\":\r\n      case \"eth_requestAccounts\":\r\n        return [this.wallet.address];\r\n      case \"eth_signTypedData_v4\": {\r\n        const privateKeyWithout0xPrefix = this.findWallet(params[0]).privateKey.slice(2);\r\n        const privateKey = Buffer.from(privateKeyWithout0xPrefix, \"hex\");\r\n        const signature = await signTypedData({\r\n          privateKey,\r\n          data: JSON.parse(params[1]),\r\n          version: SignTypedDataVersion.V4\r\n        });\r\n        return signature;\r\n      }\r\n\r\n      case \"eth_sendTransaction\":\r\n        return this.send(\r\n          \"eth_sendRawTransaction\",\r\n          await Promise.all(\r\n            params.map(async ({ from, nonce, gas, ...rest }) => {\r\n              if (nonce === undefined) {\r\n                nonce = await this.send(\"eth_getTransactionCount\", [from]);\r\n              }\r\n\r\n              return this.findWallet(from).signTransaction({\r\n                from,\r\n                nonce,\r\n                ...(gas !== undefined ? { gasLimit: gas } : {}),\r\n                ...rest\r\n              });\r\n            })\r\n          )\r\n        );\r\n    }\r\n\r\n    //console.log({ method, params });\r\n\r\n    const response = await fetch(this.url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        method: method,\r\n        params: params,\r\n        id: this.id++,\r\n        jsonrpc: \"2.0\"\r\n      })\r\n    });\r\n\r\n    const json = await response.json();\r\n\r\n    //console.log(json);\r\n\r\n    if (json.error) {\r\n      const { message, ...rest } = json.error;\r\n      const error = new Error(`${message} ${JSON.stringify(rest)}`);\r\n      throw Object.assign(error, rest);\r\n    }\r\n\r\n    return json.result;\r\n  }\r\n\r\n  request({ method, params }: { method: string; params: any[] }) {\r\n    return this.send(method, params);\r\n  }\r\n}\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BatchedWebSocketAugmentedWeb3Provider = exports.Batched = exports.isBatchedProvider = void 0;\r\nconst address_1 = require(\"@ethersproject/address\");\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst properties_1 = require(\"@ethersproject/properties\");\r\nconst WebSocketAugmentedProvider_1 = require(\"./WebSocketAugmentedProvider\");\r\nconst multicallAddress = {\r\n    1: \"0xeefBa1e63905eF1D7ACbA5a8513c70307C1cE441\",\r\n    3: \"0x53C43764255c17BD724F74c4eF150724AC50a3ed\",\r\n    4: \"0x42Ad527de7d4e9d9d011aC45B31D8551f8Fe9821\",\r\n    5: \"0x77dCa2C955b15e9dE4dbBCf1246B4B85b651e50e\",\r\n    42: \"0x2cc8688C5f75E365aaEEb4ea8D6a480405A48D2A\"\r\n};\r\nconst hasMulticall = (chainId) => chainId in multicallAddress;\r\nconst multicallAbi = [\r\n    {\r\n        type: \"function\",\r\n        name: \"aggregate\",\r\n        stateMutability: \"nonpayable\",\r\n        constant: false,\r\n        payable: false,\r\n        inputs: [\r\n            {\r\n                components: [\r\n                    {\r\n                        name: \"target\",\r\n                        type: \"address\"\r\n                    },\r\n                    {\r\n                        name: \"callData\",\r\n                        type: \"bytes\"\r\n                    }\r\n                ],\r\n                name: \"calls\",\r\n                type: \"tuple[]\"\r\n            }\r\n        ],\r\n        outputs: [\r\n            {\r\n                name: \"blockNumber\",\r\n                type: \"uint256\"\r\n            },\r\n            {\r\n                name: \"returnData\",\r\n                type: \"bytes[]\"\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        type: \"function\",\r\n        name: \"getEthBalance\",\r\n        stateMutability: \"view\",\r\n        constant: true,\r\n        payable: false,\r\n        inputs: [\r\n            {\r\n                name: \"addr\",\r\n                type: \"address\"\r\n            }\r\n        ],\r\n        outputs: [\r\n            {\r\n                name: \"balance\",\r\n                type: \"uint256\"\r\n            }\r\n        ]\r\n    }\r\n];\r\nconst emptyBatch = () => ({ calls: [], callbacks: [] });\r\n// TODO\r\n//\r\n// Technically, requests that have a `from` address shouldn't be batched, because `msg.sender` will\r\n// be replaced with the Multicall contract's address when the batched calls are being executed.\r\n//\r\n// Currently, `@liquity/lib-ethers` makes many of its read calls through Signers, which populates\r\n// `from`. Instead these calls should be made through a Provider, and `from` should be omitted\r\n// (since none of the read calls in Liquity care about `msg.sender`).\r\n//\r\n// Then we'll be able to properly exclude calls that have `from` addresses from batching.\r\nconst batchableCall = (request) => request.gasLimit === undefined && request.gasPrice === undefined && request.value === undefined;\r\nconst batchedCall = (request, multicallAddress) => request.to === multicallAddress &&\r\n    typeof request.data === \"string\" &&\r\n    request.data.startsWith(\"0x252dba42\"); // signature of `aggregate((address,bytes)[])`\r\nconst batchedProviders = [];\r\nconst isBatchedProvider = (provider) => batchedProviders.some(batchedProvider => provider instanceof batchedProvider);\r\nexports.isBatchedProvider = isBatchedProvider;\r\nconst Batched = (Base) => {\r\n    const batchedProvider = class extends Base {\r\n        constructor() {\r\n            super(...arguments);\r\n            this.batchingDelayMs = 10;\r\n            this._chainId = 0;\r\n            this._batched = emptyBatch();\r\n            this._numberOfBatchedCalls = 0;\r\n            this._numberOfActualCalls = 0;\r\n        }\r\n        get chainId() {\r\n            return this._chainId;\r\n        }\r\n        set chainId(chainId) {\r\n            if (this._multicall) {\r\n                throw new Error(\"can only set chainId once\");\r\n            }\r\n            if (hasMulticall(chainId)) {\r\n                this._multicall = new contracts_1.Contract(multicallAddress[chainId], multicallAbi, this);\r\n            }\r\n            this._chainId = chainId;\r\n        }\r\n        async _dispatchCalls() {\r\n            const { calls, callbacks, blockTag } = this._batched;\r\n            this._batched = emptyBatch();\r\n            try {\r\n                const results = calls.length > 1\r\n                    ? await this._multicall.callStatic.aggregate(calls, { blockTag }).then(x => x.returnData)\r\n                    : [await super.call({ to: calls[0].target, data: calls[0].callData }, blockTag)];\r\n                callbacks.forEach(([resolve], i) => resolve(results[i]));\r\n            }\r\n            catch (error) {\r\n                callbacks.forEach(([, reject]) => reject(error));\r\n            }\r\n        }\r\n        _enqueueCall(call) {\r\n            if (this._timeoutId !== undefined) {\r\n                clearTimeout(this._timeoutId);\r\n            }\r\n            this._batched.calls.push(call);\r\n            this._timeoutId = setTimeout(() => this._dispatchCalls(), this.batchingDelayMs);\r\n            return new Promise((resolve, reject) => this._batched.callbacks.push([resolve, reject]));\r\n        }\r\n        _alreadyBatchedCallsConflictWith(blockTag) {\r\n            var _a;\r\n            return (this._batched.calls.length !== 0 &&\r\n                (blockTag !== null && blockTag !== void 0 ? blockTag : \"latest\") !== ((_a = this._batched.blockTag) !== null && _a !== void 0 ? _a : \"latest\"));\r\n        }\r\n        async call(request, blockTag) {\r\n            if (!this._multicall) {\r\n                return super.call(request, blockTag);\r\n            }\r\n            else {\r\n                const now = new Date().getTime();\r\n                if (this._timeOfLastRatioCheck === undefined) {\r\n                    this._timeOfLastRatioCheck = now;\r\n                }\r\n                else {\r\n                    const timeSinceLastRatioCheck = now - this._timeOfLastRatioCheck;\r\n                    if (timeSinceLastRatioCheck >= 10000 && this._numberOfActualCalls) {\r\n                        // console.log(\r\n                        //   `Call batching ratio: ${\r\n                        //     Math.round((10 * this._numberOfBatchedCalls) / this._numberOfActualCalls) / 10\r\n                        //   }X`\r\n                        // );\r\n                        this._numberOfBatchedCalls = 0;\r\n                        this._numberOfActualCalls = 0;\r\n                        this._timeOfLastRatioCheck = now;\r\n                    }\r\n                }\r\n            }\r\n            const [resolvedRequest, resolvedBlockTag] = await Promise.all([\r\n                properties_1.resolveProperties(request),\r\n                blockTag\r\n            ]);\r\n            if (batchedCall(resolvedRequest, this._multicall.address) ||\r\n                !batchableCall(resolvedRequest) ||\r\n                this._alreadyBatchedCallsConflictWith(resolvedBlockTag)) {\r\n                this._numberOfActualCalls++;\r\n                return super.call(resolvedRequest, resolvedBlockTag);\r\n            }\r\n            else {\r\n                this._numberOfBatchedCalls++;\r\n                if (this._batched.calls.length === 0) {\r\n                    this._batched.blockTag = resolvedBlockTag;\r\n                }\r\n                return this._enqueueCall({ target: resolvedRequest.to, callData: resolvedRequest.data });\r\n            }\r\n        }\r\n        async getBalance(addressOrName, blockTag) {\r\n            const [resolvedAddressOrName, resolvedBlockTag] = await Promise.all([addressOrName, blockTag]);\r\n            if (!address_1.isAddress(resolvedAddressOrName) || !this._multicall) {\r\n                return super.getBalance(resolvedAddressOrName, blockTag);\r\n            }\r\n            const [balance] = await this._multicall.functions.getEthBalance(resolvedAddressOrName, {\r\n                blockTag: resolvedBlockTag\r\n            });\r\n            return balance;\r\n        }\r\n    };\r\n    batchedProviders.push(batchedProvider);\r\n    return batchedProvider;\r\n};\r\nexports.Batched = Batched;\r\nexports.BatchedWebSocketAugmentedWeb3Provider = exports.Batched(WebSocketAugmentedProvider_1.WebSocketAugmentedWeb3Provider);\r\n//# sourceMappingURL=BatchedProvider.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.TroveWithPendingRedistribution = exports.UserTrove = exports._emptyTrove = exports.Trove = exports._normalizeTroveAdjustment = exports._normalizeTroveCreation = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst Decimal_1 = require(\"./Decimal\");\r\nconst constants_1 = require(\"./constants\");\r\nconst invalidTroveCreation = (invalidTrove, error) => ({\r\n    type: \"invalidCreation\",\r\n    invalidTrove,\r\n    error\r\n});\r\nconst troveCreation = (params) => ({\r\n    type: \"creation\",\r\n    params\r\n});\r\nconst troveClosure = (params) => ({\r\n    type: \"closure\",\r\n    params\r\n});\r\nconst troveAdjustment = (params, setToZero) => ({\r\n    type: \"adjustment\",\r\n    params,\r\n    setToZero\r\n});\r\nconst valueIsDefined = (entry) => entry[1] !== undefined;\r\nconst allowedTroveCreationKeys = [\r\n    \"depositCollateral\",\r\n    \"borrowLUSD\"\r\n];\r\nfunction checkAllowedTroveCreationKeys(entries) {\r\n    const badKeys = entries\r\n        .filter(([k]) => !allowedTroveCreationKeys.includes(k))\r\n        .map(([k]) => `'${k}'`);\r\n    if (badKeys.length > 0) {\r\n        throw new Error(`TroveCreationParams: property ${badKeys.join(\", \")} not allowed`);\r\n    }\r\n}\r\nconst troveCreationParamsFromEntries = (entries) => {\r\n    const params = Object.fromEntries(entries);\r\n    const missingKeys = allowedTroveCreationKeys.filter(k => !(k in params)).map(k => `'${k}'`);\r\n    if (missingKeys.length > 0) {\r\n        throw new Error(`TroveCreationParams: property ${missingKeys.join(\", \")} missing`);\r\n    }\r\n    return params;\r\n};\r\nconst decimalize = ([k, v]) => [k, Decimal_1.Decimal.from(v)];\r\nconst nonZero = ([, v]) => !v.isZero;\r\n/** @internal */\r\nconst _normalizeTroveCreation = (params) => {\r\n    const definedEntries = Object.entries(params).filter(valueIsDefined);\r\n    checkAllowedTroveCreationKeys(definedEntries);\r\n    const nonZeroEntries = definedEntries.map(decimalize);\r\n    return troveCreationParamsFromEntries(nonZeroEntries);\r\n};\r\nexports._normalizeTroveCreation = _normalizeTroveCreation;\r\nconst allowedTroveAdjustmentKeys = [\r\n    \"depositCollateral\",\r\n    \"withdrawCollateral\",\r\n    \"borrowLUSD\",\r\n    \"repayLUSD\"\r\n];\r\nfunction checkAllowedTroveAdjustmentKeys(entries) {\r\n    const badKeys = entries\r\n        .filter(([k]) => !allowedTroveAdjustmentKeys.includes(k))\r\n        .map(([k]) => `'${k}'`);\r\n    if (badKeys.length > 0) {\r\n        throw new Error(`TroveAdjustmentParams: property ${badKeys.join(\", \")} not allowed`);\r\n    }\r\n}\r\nconst collateralChangeFrom = ({ depositCollateral, withdrawCollateral }) => {\r\n    if (depositCollateral !== undefined && withdrawCollateral !== undefined) {\r\n        throw new Error(\"TroveAdjustmentParams: 'depositCollateral' and 'withdrawCollateral' \" +\r\n            \"can't be present at the same time\");\r\n    }\r\n    if (depositCollateral !== undefined) {\r\n        return { depositCollateral };\r\n    }\r\n    if (withdrawCollateral !== undefined) {\r\n        return { withdrawCollateral };\r\n    }\r\n};\r\nconst debtChangeFrom = ({ borrowLUSD, repayLUSD }) => {\r\n    if (borrowLUSD !== undefined && repayLUSD !== undefined) {\r\n        throw new Error(\"TroveAdjustmentParams: 'borrowLUSD' and 'repayLUSD' can't be present at the same time\");\r\n    }\r\n    if (borrowLUSD !== undefined) {\r\n        return { borrowLUSD };\r\n    }\r\n    if (repayLUSD !== undefined) {\r\n        return { repayLUSD };\r\n    }\r\n};\r\nconst troveAdjustmentParamsFromEntries = (entries) => {\r\n    const params = Object.fromEntries(entries);\r\n    const collateralChange = collateralChangeFrom(params);\r\n    const debtChange = debtChangeFrom(params);\r\n    if (collateralChange !== undefined && debtChange !== undefined) {\r\n        return { ...collateralChange, ...debtChange };\r\n    }\r\n    if (collateralChange !== undefined) {\r\n        return collateralChange;\r\n    }\r\n    if (debtChange !== undefined) {\r\n        return debtChange;\r\n    }\r\n    throw new Error(\"TroveAdjustmentParams: must include at least one non-zero parameter\");\r\n};\r\n/** @internal */\r\nconst _normalizeTroveAdjustment = (params) => {\r\n    const definedEntries = Object.entries(params).filter(valueIsDefined);\r\n    checkAllowedTroveAdjustmentKeys(definedEntries);\r\n    const nonZeroEntries = definedEntries.map(decimalize).filter(nonZero);\r\n    return troveAdjustmentParamsFromEntries(nonZeroEntries);\r\n};\r\nexports._normalizeTroveAdjustment = _normalizeTroveAdjustment;\r\nconst applyFee = (borrowingRate, debtIncrease) => debtIncrease.mul(Decimal_1.Decimal.ONE.add(borrowingRate));\r\nconst unapplyFee = (borrowingRate, debtIncrease) => debtIncrease._divCeil(Decimal_1.Decimal.ONE.add(borrowingRate));\r\nconst NOMINAL_COLLATERAL_RATIO_PRECISION = Decimal_1.Decimal.from(100);\r\n/**\r\n * A combination of collateral and debt.\r\n *\r\n * @public\r\n */\r\nclass Trove {\r\n    /** @internal */\r\n    constructor(collateral = Decimal_1.Decimal.ZERO, debt = Decimal_1.Decimal.ZERO) {\r\n        this.collateral = collateral;\r\n        this.debt = debt;\r\n    }\r\n    get isEmpty() {\r\n        return this.collateral.isZero && this.debt.isZero;\r\n    }\r\n    /**\r\n     * Amount of LUSD that must be repaid to close this Trove.\r\n     *\r\n     * @remarks\r\n     * This doesn't include the liquidation reserve, which is refunded in case of normal closure.\r\n     */\r\n    get netDebt() {\r\n        if (this.debt.lt(constants_1.LUSD_LIQUIDATION_RESERVE)) {\r\n            throw new Error(`netDebt should not be used when debt < ${constants_1.LUSD_LIQUIDATION_RESERVE}`);\r\n        }\r\n        return this.debt.sub(constants_1.LUSD_LIQUIDATION_RESERVE);\r\n    }\r\n    /** @internal */\r\n    get _nominalCollateralRatio() {\r\n        return this.collateral.mulDiv(NOMINAL_COLLATERAL_RATIO_PRECISION, this.debt);\r\n    }\r\n    /** Calculate the Trove's collateralization ratio at a given price. */\r\n    collateralRatio(price) {\r\n        return this.collateral.mulDiv(price, this.debt);\r\n    }\r\n    /**\r\n     * Whether the Trove is undercollateralized at a given price.\r\n     *\r\n     * @returns\r\n     * `true` if the Trove's collateralization ratio is less than the\r\n     * {@link MINIMUM_COLLATERAL_RATIO}.\r\n     */\r\n    collateralRatioIsBelowMinimum(price) {\r\n        return this.collateralRatio(price).lt(constants_1.MINIMUM_COLLATERAL_RATIO);\r\n    }\r\n    /**\r\n     * Whether the collateralization ratio is less than the {@link CRITICAL_COLLATERAL_RATIO} at a\r\n     * given price.\r\n     *\r\n     * @example\r\n     * Can be used to check whether the Liquity protocol is in recovery mode by using it on the return\r\n     * value of {@link ReadableLiquity.getTotal | getTotal()}. For example:\r\n     *\r\n     * ```typescript\r\n     * const total = await liquity.getTotal();\r\n     * const price = await liquity.getPrice();\r\n     *\r\n     * if (total.collateralRatioIsBelowCritical(price)) {\r\n     *   // Recovery mode is active\r\n     * }\r\n     * ```\r\n     */\r\n    collateralRatioIsBelowCritical(price) {\r\n        return this.collateralRatio(price).lt(constants_1.CRITICAL_COLLATERAL_RATIO);\r\n    }\r\n    /** Whether the Trove is sufficiently collateralized to be opened during recovery mode. */\r\n    isOpenableInRecoveryMode(price) {\r\n        return this.collateralRatio(price).gte(constants_1.CRITICAL_COLLATERAL_RATIO);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return `{ collateral: ${this.collateral}, debt: ${this.debt} }`;\r\n    }\r\n    equals(that) {\r\n        return this.collateral.eq(that.collateral) && this.debt.eq(that.debt);\r\n    }\r\n    add(that) {\r\n        return new Trove(this.collateral.add(that.collateral), this.debt.add(that.debt));\r\n    }\r\n    addCollateral(collateral) {\r\n        return new Trove(this.collateral.add(collateral), this.debt);\r\n    }\r\n    addDebt(debt) {\r\n        return new Trove(this.collateral, this.debt.add(debt));\r\n    }\r\n    subtract(that) {\r\n        const { collateral, debt } = that;\r\n        return new Trove(this.collateral.gt(collateral) ? this.collateral.sub(collateral) : Decimal_1.Decimal.ZERO, this.debt.gt(debt) ? this.debt.sub(debt) : Decimal_1.Decimal.ZERO);\r\n    }\r\n    subtractCollateral(collateral) {\r\n        return new Trove(this.collateral.gt(collateral) ? this.collateral.sub(collateral) : Decimal_1.Decimal.ZERO, this.debt);\r\n    }\r\n    subtractDebt(debt) {\r\n        return new Trove(this.collateral, this.debt.gt(debt) ? this.debt.sub(debt) : Decimal_1.Decimal.ZERO);\r\n    }\r\n    multiply(multiplier) {\r\n        return new Trove(this.collateral.mul(multiplier), this.debt.mul(multiplier));\r\n    }\r\n    setCollateral(collateral) {\r\n        return new Trove(Decimal_1.Decimal.from(collateral), this.debt);\r\n    }\r\n    setDebt(debt) {\r\n        return new Trove(this.collateral, Decimal_1.Decimal.from(debt));\r\n    }\r\n    _debtChange({ debt }, borrowingRate) {\r\n        return debt.gt(this.debt)\r\n            ? { borrowLUSD: unapplyFee(borrowingRate, debt.sub(this.debt)) }\r\n            : { repayLUSD: this.debt.sub(debt) };\r\n    }\r\n    _collateralChange({ collateral }) {\r\n        return collateral.gt(this.collateral)\r\n            ? { depositCollateral: collateral.sub(this.collateral) }\r\n            : { withdrawCollateral: this.collateral.sub(collateral) };\r\n    }\r\n    /**\r\n     * Calculate the difference between this Trove and another.\r\n     *\r\n     * @param that - The other Trove.\r\n     * @param borrowingRate - Borrowing rate to use when calculating a borrowed amount.\r\n     *\r\n     * @returns\r\n     * An object representing the change, or `undefined` if the Troves are equal.\r\n     */\r\n    whatChanged(that, borrowingRate = constants_1.MINIMUM_BORROWING_RATE) {\r\n        var _a;\r\n        if (this.collateral.eq(that.collateral) && this.debt.eq(that.debt)) {\r\n            return undefined;\r\n        }\r\n        if (this.isEmpty) {\r\n            if (that.debt.lt(constants_1.LUSD_LIQUIDATION_RESERVE)) {\r\n                return invalidTroveCreation(that, \"missingLiquidationReserve\");\r\n            }\r\n            return troveCreation({\r\n                depositCollateral: that.collateral,\r\n                borrowLUSD: unapplyFee(borrowingRate, that.netDebt)\r\n            });\r\n        }\r\n        if (that.isEmpty) {\r\n            return troveClosure(this.netDebt.nonZero\r\n                ? { withdrawCollateral: this.collateral, repayLUSD: this.netDebt }\r\n                : { withdrawCollateral: this.collateral });\r\n        }\r\n        return this.collateral.eq(that.collateral)\r\n            ? troveAdjustment(this._debtChange(that, borrowingRate), that.debt.zero && \"debt\")\r\n            : this.debt.eq(that.debt)\r\n                ? troveAdjustment(this._collateralChange(that), that.collateral.zero && \"collateral\")\r\n                : troveAdjustment({\r\n                    ...this._debtChange(that, borrowingRate),\r\n                    ...this._collateralChange(that)\r\n                }, (_a = (that.debt.zero && \"debt\")) !== null && _a !== void 0 ? _a : (that.collateral.zero && \"collateral\"));\r\n    }\r\n    /**\r\n     * Make a new Trove by applying a {@link TroveChange} to this Trove.\r\n     *\r\n     * @param change - The change to apply.\r\n     * @param borrowingRate - Borrowing rate to use when adding a borrowed amount to the Trove's debt.\r\n     */\r\n    apply(change, borrowingRate = constants_1.MINIMUM_BORROWING_RATE) {\r\n        if (!change) {\r\n            return this;\r\n        }\r\n        switch (change.type) {\r\n            case \"invalidCreation\":\r\n                if (!this.isEmpty) {\r\n                    throw new Error(\"Can't create onto existing Trove\");\r\n                }\r\n                return change.invalidTrove;\r\n            case \"creation\": {\r\n                if (!this.isEmpty) {\r\n                    throw new Error(\"Can't create onto existing Trove\");\r\n                }\r\n                const { depositCollateral, borrowLUSD } = change.params;\r\n                return new Trove(depositCollateral, constants_1.LUSD_LIQUIDATION_RESERVE.add(applyFee(borrowingRate, borrowLUSD)));\r\n            }\r\n            case \"closure\":\r\n                if (this.isEmpty) {\r\n                    throw new Error(\"Can't close empty Trove\");\r\n                }\r\n                return exports._emptyTrove;\r\n            case \"adjustment\": {\r\n                const { setToZero, params: { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD } } = change;\r\n                const collateralDecrease = withdrawCollateral !== null && withdrawCollateral !== void 0 ? withdrawCollateral : Decimal_1.Decimal.ZERO;\r\n                const collateralIncrease = depositCollateral !== null && depositCollateral !== void 0 ? depositCollateral : Decimal_1.Decimal.ZERO;\r\n                const debtDecrease = repayLUSD !== null && repayLUSD !== void 0 ? repayLUSD : Decimal_1.Decimal.ZERO;\r\n                const debtIncrease = borrowLUSD ? applyFee(borrowingRate, borrowLUSD) : Decimal_1.Decimal.ZERO;\r\n                return setToZero === \"collateral\"\r\n                    ? this.setCollateral(Decimal_1.Decimal.ZERO).addDebt(debtIncrease).subtractDebt(debtDecrease)\r\n                    : setToZero === \"debt\"\r\n                        ? this.setDebt(Decimal_1.Decimal.ZERO)\r\n                            .addCollateral(collateralIncrease)\r\n                            .subtractCollateral(collateralDecrease)\r\n                        : this.add(new Trove(collateralIncrease, debtIncrease)).subtract(new Trove(collateralDecrease, debtDecrease));\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Calculate the result of an {@link TransactableLiquity.openTrove | openTrove()} transaction.\r\n     *\r\n     * @param params - Parameters of the transaction.\r\n     * @param borrowingRate - Borrowing rate to use when calculating the Trove's debt.\r\n     */\r\n    static create(params, borrowingRate) {\r\n        return exports._emptyTrove.apply(troveCreation(exports._normalizeTroveCreation(params)), borrowingRate);\r\n    }\r\n    /**\r\n     * Calculate the parameters of an {@link TransactableLiquity.openTrove | openTrove()} transaction\r\n     * that will result in the given Trove.\r\n     *\r\n     * @param that - The Trove to recreate.\r\n     * @param borrowingRate - Current borrowing rate.\r\n     */\r\n    static recreate(that, borrowingRate) {\r\n        const change = exports._emptyTrove.whatChanged(that, borrowingRate);\r\n        assert_1.default((change === null || change === void 0 ? void 0 : change.type) === \"creation\");\r\n        return change.params;\r\n    }\r\n    /**\r\n     * Calculate the result of an {@link TransactableLiquity.adjustTrove | adjustTrove()} transaction\r\n     * on this Trove.\r\n     *\r\n     * @param params - Parameters of the transaction.\r\n     * @param borrowingRate - Borrowing rate to use when adding to the Trove's debt.\r\n     */\r\n    adjust(params, borrowingRate) {\r\n        return this.apply(troveAdjustment(exports._normalizeTroveAdjustment(params)), borrowingRate);\r\n    }\r\n    /**\r\n     * Calculate the parameters of an {@link TransactableLiquity.adjustTrove | adjustTrove()}\r\n     * transaction that will change this Trove into the given Trove.\r\n     *\r\n     * @param that - The desired result of the transaction.\r\n     * @param borrowingRate - Current borrowing rate.\r\n     */\r\n    adjustTo(that, borrowingRate) {\r\n        const change = this.whatChanged(that, borrowingRate);\r\n        assert_1.default((change === null || change === void 0 ? void 0 : change.type) === \"adjustment\");\r\n        return change.params;\r\n    }\r\n}\r\nexports.Trove = Trove;\r\n/** @internal */\r\nexports._emptyTrove = new Trove();\r\n/**\r\n * A Trove that is associated with a single owner.\r\n *\r\n * @remarks\r\n * The SDK uses the base {@link Trove} class as a generic container of collateral and debt, for\r\n * example to represent the {@link ReadableLiquity.getTotal | total collateral and debt} locked up\r\n * in the protocol.\r\n *\r\n * The `UserTrove` class extends `Trove` with extra information that's only available for Troves\r\n * that are associated with a single owner (such as the owner's address, or the Trove's status).\r\n *\r\n * @public\r\n */\r\nclass UserTrove extends Trove {\r\n    /** @internal */\r\n    constructor(ownerAddress, status, collateral, debt) {\r\n        super(collateral, debt);\r\n        this.ownerAddress = ownerAddress;\r\n        this.status = status;\r\n    }\r\n    equals(that) {\r\n        return (super.equals(that) && this.ownerAddress === that.ownerAddress && this.status === that.status);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ ownerAddress: \"${this.ownerAddress}\"` +\r\n            `, collateral: ${this.collateral}` +\r\n            `, debt: ${this.debt}` +\r\n            `, status: \"${this.status}\" }`);\r\n    }\r\n}\r\nexports.UserTrove = UserTrove;\r\n/**\r\n * A Trove in its state after the last direct modification.\r\n *\r\n * @remarks\r\n * The Trove may have received collateral and debt shares from liquidations since then.\r\n * Use {@link TroveWithPendingRedistribution.applyRedistribution | applyRedistribution()} to\r\n * calculate the Trove's most up-to-date state.\r\n *\r\n * @public\r\n */\r\nclass TroveWithPendingRedistribution extends UserTrove {\r\n    /** @internal */\r\n    constructor(ownerAddress, status, collateral, debt, stake = Decimal_1.Decimal.ZERO, snapshotOfTotalRedistributed = exports._emptyTrove) {\r\n        super(ownerAddress, status, collateral, debt);\r\n        this.stake = stake;\r\n        this.snapshotOfTotalRedistributed = snapshotOfTotalRedistributed;\r\n    }\r\n    applyRedistribution(totalRedistributed) {\r\n        const afterRedistribution = this.add(totalRedistributed.subtract(this.snapshotOfTotalRedistributed).multiply(this.stake));\r\n        return new UserTrove(this.ownerAddress, this.status, afterRedistribution.collateral, afterRedistribution.debt);\r\n    }\r\n    equals(that) {\r\n        return (super.equals(that) &&\r\n            this.stake.eq(that.stake) &&\r\n            this.snapshotOfTotalRedistributed.equals(that.snapshotOfTotalRedistributed));\r\n    }\r\n}\r\nexports.TroveWithPendingRedistribution = TroveWithPendingRedistribution;\r\n//# sourceMappingURL=Trove.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.StabilityDeposit = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * A Stability Deposit and its accrued gains.\r\n *\r\n * @public\r\n */\r\nclass StabilityDeposit {\r\n    /** @internal */\r\n    constructor(initialLUSD, currentLUSD, collateralGain, lqtyReward, frontendTag) {\r\n        this.initialLUSD = initialLUSD;\r\n        this.currentLUSD = currentLUSD;\r\n        this.collateralGain = collateralGain;\r\n        this.lqtyReward = lqtyReward;\r\n        this.frontendTag = frontendTag;\r\n        if (this.currentLUSD.gt(this.initialLUSD)) {\r\n            throw new Error(\"currentLUSD can't be greater than initialLUSD\");\r\n        }\r\n    }\r\n    get isEmpty() {\r\n        return (this.initialLUSD.isZero &&\r\n            this.currentLUSD.isZero &&\r\n            this.collateralGain.isZero &&\r\n            this.lqtyReward.isZero);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ initialLUSD: ${this.initialLUSD}` +\r\n            `, currentLUSD: ${this.currentLUSD}` +\r\n            `, collateralGain: ${this.collateralGain}` +\r\n            `, lqtyReward: ${this.lqtyReward}` +\r\n            `, frontendTag: \"${this.frontendTag}\" }`);\r\n    }\r\n    /**\r\n     * Compare to another instance of `StabilityDeposit`.\r\n     */\r\n    equals(that) {\r\n        return (this.initialLUSD.eq(that.initialLUSD) &&\r\n            this.currentLUSD.eq(that.currentLUSD) &&\r\n            this.collateralGain.eq(that.collateralGain) &&\r\n            this.lqtyReward.eq(that.lqtyReward) &&\r\n            this.frontendTag === that.frontendTag);\r\n    }\r\n    /**\r\n     * Calculate the difference between the `currentLUSD` in this Stability Deposit and `thatLUSD`.\r\n     *\r\n     * @returns An object representing the change, or `undefined` if the deposited amounts are equal.\r\n     */\r\n    whatChanged(thatLUSD) {\r\n        thatLUSD = Decimal_1.Decimal.from(thatLUSD);\r\n        if (thatLUSD.lt(this.currentLUSD)) {\r\n            return { withdrawLUSD: this.currentLUSD.sub(thatLUSD), withdrawAllLUSD: thatLUSD.isZero };\r\n        }\r\n        if (thatLUSD.gt(this.currentLUSD)) {\r\n            return { depositLUSD: thatLUSD.sub(this.currentLUSD) };\r\n        }\r\n    }\r\n    /**\r\n     * Apply a {@link StabilityDepositChange} to this Stability Deposit.\r\n     *\r\n     * @returns The new deposited LUSD amount.\r\n     */\r\n    apply(change) {\r\n        if (!change) {\r\n            return this.currentLUSD;\r\n        }\r\n        if (change.withdrawLUSD !== undefined) {\r\n            return change.withdrawAllLUSD || this.currentLUSD.lte(change.withdrawLUSD)\r\n                ? Decimal_1.Decimal.ZERO\r\n                : this.currentLUSD.sub(change.withdrawLUSD);\r\n        }\r\n        else {\r\n            return this.currentLUSD.add(change.depositLUSD);\r\n        }\r\n    }\r\n}\r\nexports.StabilityDeposit = StabilityDeposit;\r\n//# sourceMappingURL=StabilityDeposit.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LQTYStake = void 0;\r\nconst Decimal_1 = require(\"./Decimal\");\r\n/**\r\n * Represents a user's LQTY stake and accrued gains.\r\n *\r\n * @remarks\r\n * Returned by the {@link ReadableLiquity.getLQTYStake | getLQTYStake()} function.\r\n\r\n * @public\r\n */\r\nclass LQTYStake {\r\n    /** @internal */\r\n    constructor(stakedLQTY = Decimal_1.Decimal.ZERO, collateralGain = Decimal_1.Decimal.ZERO, lusdGain = Decimal_1.Decimal.ZERO) {\r\n        this.stakedLQTY = stakedLQTY;\r\n        this.collateralGain = collateralGain;\r\n        this.lusdGain = lusdGain;\r\n    }\r\n    get isEmpty() {\r\n        return this.stakedLQTY.isZero && this.collateralGain.isZero && this.lusdGain.isZero;\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ stakedLQTY: ${this.stakedLQTY}` +\r\n            `, collateralGain: ${this.collateralGain}` +\r\n            `, lusdGain: ${this.lusdGain} }`);\r\n    }\r\n    /**\r\n     * Compare to another instance of `LQTYStake`.\r\n     */\r\n    equals(that) {\r\n        return (this.stakedLQTY.eq(that.stakedLQTY) &&\r\n            this.collateralGain.eq(that.collateralGain) &&\r\n            this.lusdGain.eq(that.lusdGain));\r\n    }\r\n    /**\r\n     * Calculate the difference between this `LQTYStake` and `thatStakedLQTY`.\r\n     *\r\n     * @returns An object representing the change, or `undefined` if the staked amounts are equal.\r\n     */\r\n    whatChanged(thatStakedLQTY) {\r\n        thatStakedLQTY = Decimal_1.Decimal.from(thatStakedLQTY);\r\n        if (thatStakedLQTY.lt(this.stakedLQTY)) {\r\n            return {\r\n                unstakeLQTY: this.stakedLQTY.sub(thatStakedLQTY),\r\n                unstakeAllLQTY: thatStakedLQTY.isZero\r\n            };\r\n        }\r\n        if (thatStakedLQTY.gt(this.stakedLQTY)) {\r\n            return { stakeLQTY: thatStakedLQTY.sub(this.stakedLQTY) };\r\n        }\r\n    }\r\n    /**\r\n     * Apply a {@link LQTYStakeChange} to this `LQTYStake`.\r\n     *\r\n     * @returns The new staked LQTY amount.\r\n     */\r\n    apply(change) {\r\n        if (!change) {\r\n            return this.stakedLQTY;\r\n        }\r\n        if (change.unstakeLQTY !== undefined) {\r\n            return change.unstakeAllLQTY || this.stakedLQTY.lte(change.unstakeLQTY)\r\n                ? Decimal_1.Decimal.ZERO\r\n                : this.stakedLQTY.sub(change.unstakeLQTY);\r\n        }\r\n        else {\r\n            return this.stakedLQTY.add(change.stakeLQTY);\r\n        }\r\n    }\r\n}\r\nexports.LQTYStake = LQTYStake;\r\n//# sourceMappingURL=LQTYStake.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Fees = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst Decimal_1 = require(\"./Decimal\");\r\nconst constants_1 = require(\"./constants\");\r\n/**\r\n * Calculator for fees.\r\n *\r\n * @remarks\r\n * Returned by the {@link ReadableLiquity.getFees | getFees()} function.\r\n *\r\n * @public\r\n */\r\nclass Fees {\r\n    /** @internal */\r\n    constructor(baseRateWithoutDecay, minuteDecayFactor, beta, lastFeeOperation, timeOfLatestBlock, recoveryMode) {\r\n        this._baseRateWithoutDecay = Decimal_1.Decimal.from(baseRateWithoutDecay);\r\n        this._minuteDecayFactor = Decimal_1.Decimal.from(minuteDecayFactor);\r\n        this._beta = Decimal_1.Decimal.from(beta);\r\n        this._lastFeeOperation = lastFeeOperation;\r\n        this._timeOfLatestBlock = timeOfLatestBlock;\r\n        this._recoveryMode = recoveryMode;\r\n        assert_1.default(this._minuteDecayFactor.lt(1));\r\n    }\r\n    /** @internal */\r\n    _setRecoveryMode(recoveryMode) {\r\n        return new Fees(this._baseRateWithoutDecay, this._minuteDecayFactor, this._beta, this._lastFeeOperation, this._timeOfLatestBlock, recoveryMode);\r\n    }\r\n    /**\r\n     * Compare to another instance of `Fees`.\r\n     */\r\n    equals(that) {\r\n        return (this._baseRateWithoutDecay.eq(that._baseRateWithoutDecay) &&\r\n            this._minuteDecayFactor.eq(that._minuteDecayFactor) &&\r\n            this._beta.eq(that._beta) &&\r\n            this._lastFeeOperation.getTime() === that._lastFeeOperation.getTime() &&\r\n            this._timeOfLatestBlock.getTime() === that._timeOfLatestBlock.getTime() &&\r\n            this._recoveryMode === that._recoveryMode);\r\n    }\r\n    /** @internal */\r\n    toString() {\r\n        return (`{ baseRateWithoutDecay: ${this._baseRateWithoutDecay}` +\r\n            `, lastFeeOperation: \"${this._lastFeeOperation.toLocaleString()}\"` +\r\n            `, recoveryMode: ${this._recoveryMode} } `);\r\n    }\r\n    /** @internal */\r\n    baseRate(when = this._timeOfLatestBlock) {\r\n        const millisecondsSinceLastFeeOperation = Math.max(when.getTime() - this._lastFeeOperation.getTime(), 0 // Clamp negative elapsed time to 0, in case the client's time is in the past.\r\n        // We will calculate slightly higher than actual fees, which is fine.\r\n        );\r\n        const minutesSinceLastFeeOperation = Math.floor(millisecondsSinceLastFeeOperation / 60000);\r\n        return this._minuteDecayFactor.pow(minutesSinceLastFeeOperation).mul(this._baseRateWithoutDecay);\r\n    }\r\n    /**\r\n     * Calculate the current borrowing rate.\r\n     *\r\n     * @param when - Optional timestamp that can be used to calculate what the borrowing rate would\r\n     *               decay to at a point of time in the future.\r\n     *\r\n     * @remarks\r\n     * By default, the fee is calculated at the time of the latest block. This can be overridden using\r\n     * the `when` parameter.\r\n     *\r\n     * To calculate the borrowing fee in LUSD, multiply the borrowed LUSD amount by the borrowing rate.\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const fees = await liquity.getFees();\r\n     *\r\n     * const borrowedLUSDAmount = 100;\r\n     * const borrowingRate = fees.borrowingRate();\r\n     * const borrowingFeeLUSD = borrowingRate.mul(borrowedLUSDAmount);\r\n     * ```\r\n     */\r\n    borrowingRate(when) {\r\n        return this._recoveryMode\r\n            ? Decimal_1.Decimal.ZERO\r\n            : Decimal_1.Decimal.min(constants_1.MINIMUM_BORROWING_RATE.add(this.baseRate(when)), constants_1.MAXIMUM_BORROWING_RATE);\r\n    }\r\n    /**\r\n     * Calculate the current redemption rate.\r\n     *\r\n     * @param redeemedFractionOfSupply - The amount of LUSD being redeemed divided by the total supply.\r\n     * @param when - Optional timestamp that can be used to calculate what the redemption rate would\r\n     *               decay to at a point of time in the future.\r\n     *\r\n     * @remarks\r\n     * By default, the fee is calculated at the time of the latest block. This can be overridden using\r\n     * the `when` parameter.\r\n  \r\n     * Unlike the borrowing rate, the redemption rate depends on the amount being redeemed. To be more\r\n     * precise, it depends on the fraction of the redeemed amount compared to the total LUSD supply,\r\n     * which must be passed as a parameter.\r\n     *\r\n     * To calculate the redemption fee in LUSD, multiply the redeemed LUSD amount with the redemption\r\n     * rate.\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const fees = await liquity.getFees();\r\n     * const total = await liquity.getTotal();\r\n     *\r\n     * const redeemedLUSDAmount = Decimal.from(100);\r\n     * const redeemedFractionOfSupply = redeemedLUSDAmount.div(total.debt);\r\n     * const redemptionRate = fees.redemptionRate(redeemedFractionOfSupply);\r\n     * const redemptionFeeLUSD = redemptionRate.mul(redeemedLUSDAmount);\r\n     * ```\r\n     */\r\n    redemptionRate(redeemedFractionOfSupply = Decimal_1.Decimal.ZERO, when) {\r\n        redeemedFractionOfSupply = Decimal_1.Decimal.from(redeemedFractionOfSupply);\r\n        let baseRate = this.baseRate(when);\r\n        if (redeemedFractionOfSupply.nonZero) {\r\n            baseRate = redeemedFractionOfSupply.div(this._beta).add(baseRate);\r\n        }\r\n        return Decimal_1.Decimal.min(constants_1.MINIMUM_REDEMPTION_RATE.add(baseRate), Decimal_1.Decimal.ONE);\r\n    }\r\n}\r\nexports.Fees = Fees;\r\n//# sourceMappingURL=Fees.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.TransactionFailedError = void 0;\r\n/**\r\n * Thrown by {@link TransactableLiquity} functions in case of transaction failure.\r\n *\r\n * @public\r\n */\r\nclass TransactionFailedError extends Error {\r\n    /** @internal */\r\n    constructor(name, message, failedReceipt) {\r\n        super(message);\r\n        this.name = name;\r\n        this.failedReceipt = failedReceipt;\r\n    }\r\n}\r\nexports.TransactionFailedError = TransactionFailedError;\r\n//# sourceMappingURL=TransactableLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._successfulReceipt = exports._failedReceipt = exports._pendingReceipt = void 0;\r\n/** @internal */\r\nexports._pendingReceipt = { status: \"pending\" };\r\n/** @internal */\r\nconst _failedReceipt = (rawReceipt) => ({\r\n    status: \"failed\",\r\n    rawReceipt\r\n});\r\nexports._failedReceipt = _failedReceipt;\r\n/** @internal */\r\nconst _successfulReceipt = (rawReceipt, details, toString) => ({\r\n    status: \"succeeded\",\r\n    rawReceipt,\r\n    details,\r\n    ...(toString ? { toString } : {})\r\n});\r\nexports._successfulReceipt = _successfulReceipt;\r\n//# sourceMappingURL=SendableLiquity.js.map","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LiquityStore = void 0;\r\nconst assert_1 = __importDefault(require(\"assert\"));\r\nconst strictEquals = (a, b) => a === b;\r\nconst eq = (a, b) => a.eq(b);\r\nconst equals = (a, b) => a.equals(b);\r\nconst frontendStatusEquals = (a, b) => a.status === \"unregistered\"\r\n    ? b.status === \"unregistered\"\r\n    : b.status === \"registered\" && a.kickbackRate.eq(b.kickbackRate);\r\nconst showFrontendStatus = (x) => x.status === \"unregistered\"\r\n    ? '{ status: \"unregistered\" }'\r\n    : `{ status: \"registered\", kickbackRate: ${x.kickbackRate} }`;\r\nconst wrap = (f) => (...args) => f(...args);\r\nconst difference = (a, b) => Object.fromEntries(Object.entries(a).filter(([key, value]) => value !== b[key]));\r\n/**\r\n * Abstract base class of Liquity data store implementations.\r\n *\r\n * @remarks\r\n * The type parameter `T` may be used to type extra state added to {@link LiquityStoreState} by the\r\n * subclass.\r\n *\r\n * Implemented by {@link @liquity/lib-ethers#BlockPolledLiquityStore}.\r\n *\r\n * @public\r\n */\r\nclass LiquityStore {\r\n    constructor() {\r\n        /** Turn console logging on/off. */\r\n        this.logging = false;\r\n        /** @internal */\r\n        this._loaded = false;\r\n        this._listeners = new Set();\r\n    }\r\n    /**\r\n     * The current store state.\r\n     *\r\n     * @remarks\r\n     * Should not be accessed before the store is loaded. Assign a function to\r\n     * {@link LiquityStore.onLoaded | onLoaded} to get a callback when this happens.\r\n     *\r\n     * See {@link LiquityStoreState} for the list of properties returned.\r\n     */\r\n    get state() {\r\n        return Object.assign({}, this._baseState, this._derivedState, this._extraState);\r\n    }\r\n    /**\r\n     * Start monitoring the blockchain for Liquity state changes.\r\n     *\r\n     * @remarks\r\n     * The {@link LiquityStore.onLoaded | onLoaded} callback will be called after the state is fetched\r\n     * for the first time.\r\n     *\r\n     * Use the {@link LiquityStore.subscribe | subscribe()} function to register listeners.\r\n     *\r\n     * @returns Function to stop the monitoring.\r\n     */\r\n    start() {\r\n        const doStop = this._doStart();\r\n        return () => {\r\n            doStop();\r\n            this._cancelUpdateIfScheduled();\r\n        };\r\n    }\r\n    _cancelUpdateIfScheduled() {\r\n        if (this._updateTimeoutId !== undefined) {\r\n            clearTimeout(this._updateTimeoutId);\r\n        }\r\n    }\r\n    _scheduleUpdate() {\r\n        this._cancelUpdateIfScheduled();\r\n        this._updateTimeoutId = setTimeout(() => {\r\n            this._updateTimeoutId = undefined;\r\n            this._update();\r\n        }, 30000);\r\n    }\r\n    _logUpdate(name, next, show) {\r\n        if (this.logging) {\r\n            console.log(`${name} updated to ${show ? show(next) : next}`);\r\n        }\r\n        return next;\r\n    }\r\n    _updateIfChanged(equals, name, prev, next, show) {\r\n        return next !== undefined && !equals(prev, next) ? this._logUpdate(name, next, show) : prev;\r\n    }\r\n    _silentlyUpdateIfChanged(equals, prev, next) {\r\n        return next !== undefined && !equals(prev, next) ? next : prev;\r\n    }\r\n    _updateFees(name, prev, next) {\r\n        if (next && !next.equals(prev)) {\r\n            // Filter out fee update spam that happens on every new block by only logging when string\r\n            // representation changes.\r\n            if (`${next}` !== `${prev}`) {\r\n                this._logUpdate(name, next);\r\n            }\r\n            return next;\r\n        }\r\n        else {\r\n            return prev;\r\n        }\r\n    }\r\n    _reduce(baseState, baseStateUpdate) {\r\n        return {\r\n            frontend: this._updateIfChanged(frontendStatusEquals, \"frontend\", baseState.frontend, baseStateUpdate.frontend, showFrontendStatus),\r\n            ownFrontend: this._updateIfChanged(frontendStatusEquals, \"ownFrontend\", baseState.ownFrontend, baseStateUpdate.ownFrontend, showFrontendStatus),\r\n            numberOfTroves: this._updateIfChanged(strictEquals, \"numberOfTroves\", baseState.numberOfTroves, baseStateUpdate.numberOfTroves),\r\n            accountBalance: this._updateIfChanged(eq, \"accountBalance\", baseState.accountBalance, baseStateUpdate.accountBalance),\r\n            lusdBalance: this._updateIfChanged(eq, \"lusdBalance\", baseState.lusdBalance, baseStateUpdate.lusdBalance),\r\n            lqtyBalance: this._updateIfChanged(eq, \"lqtyBalance\", baseState.lqtyBalance, baseStateUpdate.lqtyBalance),\r\n            uniTokenBalance: this._updateIfChanged(eq, \"uniTokenBalance\", baseState.uniTokenBalance, baseStateUpdate.uniTokenBalance),\r\n            uniTokenAllowance: this._updateIfChanged(eq, \"uniTokenAllowance\", baseState.uniTokenAllowance, baseStateUpdate.uniTokenAllowance),\r\n            remainingLiquidityMiningLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.remainingLiquidityMiningLQTYReward, baseStateUpdate.remainingLiquidityMiningLQTYReward),\r\n            liquidityMiningStake: this._updateIfChanged(eq, \"liquidityMiningStake\", baseState.liquidityMiningStake, baseStateUpdate.liquidityMiningStake),\r\n            totalStakedUniTokens: this._updateIfChanged(eq, \"totalStakedUniTokens\", baseState.totalStakedUniTokens, baseStateUpdate.totalStakedUniTokens),\r\n            liquidityMiningLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.liquidityMiningLQTYReward, baseStateUpdate.liquidityMiningLQTYReward),\r\n            collateralSurplusBalance: this._updateIfChanged(eq, \"collateralSurplusBalance\", baseState.collateralSurplusBalance, baseStateUpdate.collateralSurplusBalance),\r\n            price: this._updateIfChanged(eq, \"price\", baseState.price, baseStateUpdate.price),\r\n            lusdInStabilityPool: this._updateIfChanged(eq, \"lusdInStabilityPool\", baseState.lusdInStabilityPool, baseStateUpdate.lusdInStabilityPool),\r\n            total: this._updateIfChanged(equals, \"total\", baseState.total, baseStateUpdate.total),\r\n            totalRedistributed: this._updateIfChanged(equals, \"totalRedistributed\", baseState.totalRedistributed, baseStateUpdate.totalRedistributed),\r\n            troveBeforeRedistribution: this._updateIfChanged(equals, \"troveBeforeRedistribution\", baseState.troveBeforeRedistribution, baseStateUpdate.troveBeforeRedistribution),\r\n            stabilityDeposit: this._updateIfChanged(equals, \"stabilityDeposit\", baseState.stabilityDeposit, baseStateUpdate.stabilityDeposit),\r\n            remainingStabilityPoolLQTYReward: this._silentlyUpdateIfChanged(eq, baseState.remainingStabilityPoolLQTYReward, baseStateUpdate.remainingStabilityPoolLQTYReward),\r\n            _feesInNormalMode: this._silentlyUpdateIfChanged(equals, baseState._feesInNormalMode, baseStateUpdate._feesInNormalMode),\r\n            lqtyStake: this._updateIfChanged(equals, \"lqtyStake\", baseState.lqtyStake, baseStateUpdate.lqtyStake),\r\n            totalStakedLQTY: this._updateIfChanged(eq, \"totalStakedLQTY\", baseState.totalStakedLQTY, baseStateUpdate.totalStakedLQTY),\r\n            _riskiestTroveBeforeRedistribution: this._silentlyUpdateIfChanged(equals, baseState._riskiestTroveBeforeRedistribution, baseStateUpdate._riskiestTroveBeforeRedistribution)\r\n        };\r\n    }\r\n    _derive({ troveBeforeRedistribution, totalRedistributed, _feesInNormalMode, total, price, _riskiestTroveBeforeRedistribution }) {\r\n        const fees = _feesInNormalMode._setRecoveryMode(total.collateralRatioIsBelowCritical(price));\r\n        return {\r\n            trove: troveBeforeRedistribution.applyRedistribution(totalRedistributed),\r\n            fees,\r\n            borrowingRate: fees.borrowingRate(),\r\n            redemptionRate: fees.redemptionRate(),\r\n            haveUndercollateralizedTroves: _riskiestTroveBeforeRedistribution\r\n                .applyRedistribution(totalRedistributed)\r\n                .collateralRatioIsBelowMinimum(price)\r\n        };\r\n    }\r\n    _reduceDerived(derivedState, derivedStateUpdate) {\r\n        return {\r\n            fees: this._updateFees(\"fees\", derivedState.fees, derivedStateUpdate.fees),\r\n            trove: this._updateIfChanged(equals, \"trove\", derivedState.trove, derivedStateUpdate.trove),\r\n            borrowingRate: this._silentlyUpdateIfChanged(eq, derivedState.borrowingRate, derivedStateUpdate.borrowingRate),\r\n            redemptionRate: this._silentlyUpdateIfChanged(eq, derivedState.redemptionRate, derivedStateUpdate.redemptionRate),\r\n            haveUndercollateralizedTroves: this._updateIfChanged(strictEquals, \"haveUndercollateralizedTroves\", derivedState.haveUndercollateralizedTroves, derivedStateUpdate.haveUndercollateralizedTroves)\r\n        };\r\n    }\r\n    _notify(params) {\r\n        // Iterate on a copy of `_listeners`, to avoid notifying any new listeners subscribed by\r\n        // existing listeners, as that could result in infinite loops.\r\n        //\r\n        // Before calling a listener from our copy of `_listeners`, check if it has been removed from\r\n        // the original set. This way we avoid calling listeners that have already been unsubscribed\r\n        // by an earlier listener callback.\r\n        [...this._listeners].forEach(listener => {\r\n            if (this._listeners.has(listener)) {\r\n                listener(params);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Register a state change listener.\r\n     *\r\n     * @param listener - Function that will be called whenever state changes.\r\n     * @returns Function to unregister this listener.\r\n     */\r\n    subscribe(listener) {\r\n        const uniqueListener = wrap(listener);\r\n        this._listeners.add(uniqueListener);\r\n        return () => {\r\n            this._listeners.delete(uniqueListener);\r\n        };\r\n    }\r\n    /** @internal */\r\n    _load(baseState, extraState) {\r\n        assert_1.default(!this._loaded);\r\n        this._baseState = baseState;\r\n        this._derivedState = this._derive(baseState);\r\n        this._extraState = extraState;\r\n        this._loaded = true;\r\n        this._scheduleUpdate();\r\n        if (this.onLoaded) {\r\n            this.onLoaded();\r\n        }\r\n    }\r\n    /** @internal */\r\n    _update(baseStateUpdate, extraStateUpdate) {\r\n        assert_1.default(this._baseState && this._derivedState);\r\n        const oldState = this.state;\r\n        if (baseStateUpdate) {\r\n            this._baseState = this._reduce(this._baseState, baseStateUpdate);\r\n        }\r\n        // Always running this lets us derive state based on passage of time, like baseRate decay\r\n        this._derivedState = this._reduceDerived(this._derivedState, this._derive(this._baseState));\r\n        if (extraStateUpdate) {\r\n            assert_1.default(this._extraState);\r\n            this._extraState = this._reduceExtra(this._extraState, extraStateUpdate);\r\n        }\r\n        this._scheduleUpdate();\r\n        this._notify({\r\n            newState: this.state,\r\n            oldState,\r\n            stateChange: difference(this.state, oldState)\r\n        });\r\n    }\r\n}\r\nexports.LiquityStore = LiquityStore;\r\n//# sourceMappingURL=LiquityStore.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._CachedReadableLiquity = void 0;\r\n/** @internal */\r\nclass _CachedReadableLiquity {\r\n    constructor(readable, cache) {\r\n        this._readable = readable;\r\n        this._cache = cache;\r\n    }\r\n    async getTotalRedistributed(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalRedistributed(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalRedistributed(...extraParams));\r\n    }\r\n    async getTroveBeforeRedistribution(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTroveBeforeRedistribution(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTroveBeforeRedistribution(address, ...extraParams));\r\n    }\r\n    async getTrove(address, ...extraParams) {\r\n        const [troveBeforeRedistribution, totalRedistributed] = await Promise.all([\r\n            this.getTroveBeforeRedistribution(address, ...extraParams),\r\n            this.getTotalRedistributed(...extraParams)\r\n        ]);\r\n        return troveBeforeRedistribution.applyRedistribution(totalRedistributed);\r\n    }\r\n    async getNumberOfTroves(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getNumberOfTroves(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getNumberOfTroves(...extraParams));\r\n    }\r\n    async getPrice(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getPrice(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getPrice(...extraParams);\r\n    }\r\n    async getTotal(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getTotal(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotal(...extraParams);\r\n    }\r\n    async getStabilityDeposit(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getStabilityDeposit(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getStabilityDeposit(address, ...extraParams));\r\n    }\r\n    async getRemainingStabilityPoolLQTYReward(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getRemainingStabilityPoolLQTYReward(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getRemainingStabilityPoolLQTYReward(...extraParams));\r\n    }\r\n    async getLUSDInStabilityPool(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLUSDInStabilityPool(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLUSDInStabilityPool(...extraParams));\r\n    }\r\n    async getLUSDBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLUSDBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLUSDBalance(address, ...extraParams));\r\n    }\r\n    async getLQTYBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLQTYBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLQTYBalance(address, ...extraParams));\r\n    }\r\n    async getUniTokenBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getUniTokenBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getUniTokenBalance(address, ...extraParams));\r\n    }\r\n    async getUniTokenAllowance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getUniTokenAllowance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getUniTokenAllowance(address, ...extraParams));\r\n    }\r\n    async getRemainingLiquidityMiningLQTYReward(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getRemainingLiquidityMiningLQTYReward(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getRemainingLiquidityMiningLQTYReward(...extraParams));\r\n    }\r\n    async getLiquidityMiningStake(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLiquidityMiningStake(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLiquidityMiningStake(address, ...extraParams));\r\n    }\r\n    async getTotalStakedUniTokens(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalStakedUniTokens(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalStakedUniTokens(...extraParams));\r\n    }\r\n    async getLiquidityMiningLQTYReward(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLiquidityMiningLQTYReward(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLiquidityMiningLQTYReward(address, ...extraParams));\r\n    }\r\n    async getCollateralSurplusBalance(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getCollateralSurplusBalance(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getCollateralSurplusBalance(address, ...extraParams));\r\n    }\r\n    async getTroves(params, ...extraParams) {\r\n        var _a;\r\n        const { beforeRedistribution, ...restOfParams } = params;\r\n        const [totalRedistributed, troves] = await Promise.all([\r\n            beforeRedistribution ? undefined : this.getTotalRedistributed(...extraParams),\r\n            (_a = this._cache.getTroves({ beforeRedistribution: true, ...restOfParams }, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTroves({ beforeRedistribution: true, ...restOfParams }, ...extraParams)\r\n        ]);\r\n        if (totalRedistributed) {\r\n            return troves.map(trove => trove.applyRedistribution(totalRedistributed));\r\n        }\r\n        else {\r\n            return troves;\r\n        }\r\n    }\r\n    async getFees(...extraParams) {\r\n        var _a;\r\n        return (_a = this._cache.getFees(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getFees(...extraParams);\r\n    }\r\n    async getLQTYStake(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getLQTYStake(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getLQTYStake(address, ...extraParams));\r\n    }\r\n    async getTotalStakedLQTY(...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getTotalStakedLQTY(...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getTotalStakedLQTY(...extraParams));\r\n    }\r\n    async getFrontendStatus(address, ...extraParams) {\r\n        var _a;\r\n        return ((_a = this._cache.getFrontendStatus(address, ...extraParams)) !== null && _a !== void 0 ? _a : this._readable.getFrontendStatus(address, ...extraParams));\r\n    }\r\n}\r\nexports._CachedReadableLiquity = _CachedReadableLiquity;\r\n//# sourceMappingURL=_CachedReadableLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports._connectToMulticall = void 0;\r\nconst contracts_1 = require(\"@ethersproject/contracts\");\r\nconst multicallAbi = [\r\n    {\r\n        constant: true,\r\n        inputs: [],\r\n        name: \"getCurrentBlockTimestamp\",\r\n        outputs: [\r\n            {\r\n                name: \"timestamp\",\r\n                type: \"uint256\"\r\n            }\r\n        ],\r\n        payable: false,\r\n        stateMutability: \"view\",\r\n        type: \"function\"\r\n    }\r\n];\r\nconst multicallAddress = {\r\n    1: \"0xeefba1e63905ef1d7acba5a8513c70307c1ce441\",\r\n    3: \"0x53c43764255c17bd724f74c4ef150724ac50a3ed\",\r\n    4: \"0x42ad527de7d4e9d9d011ac45b31d8551f8fe9821\",\r\n    5: \"0x77dca2c955b15e9de4dbbcf1246b4b85b651e50e\",\r\n    42: \"0x2cc8688c5f75e365aaeeb4ea8d6a480405a48d2a\"\r\n};\r\nconst hasMulticall = (chainId) => chainId in multicallAddress;\r\nconst _connectToMulticall = (signerOrProvider, chainId) => hasMulticall(chainId)\r\n    ? new contracts_1.Contract(multicallAddress[chainId], multicallAbi, signerOrProvider)\r\n    : undefined;\r\nexports._connectToMulticall = _connectToMulticall;\r\n//# sourceMappingURL=_Multicall.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ObservableEthersLiquity = void 0;\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst debouncingDelayMs = 50;\r\nconst debounce = (listener) => {\r\n    let timeoutId = undefined;\r\n    let latestBlock = 0;\r\n    return (...args) => {\r\n        const event = args[args.length - 1];\r\n        if (event.blockNumber !== undefined && event.blockNumber > latestBlock) {\r\n            latestBlock = event.blockNumber;\r\n        }\r\n        if (timeoutId !== undefined) {\r\n            clearTimeout(timeoutId);\r\n        }\r\n        timeoutId = setTimeout(() => {\r\n            listener(latestBlock);\r\n            timeoutId = undefined;\r\n        }, debouncingDelayMs);\r\n    };\r\n};\r\n/** @alpha */\r\nclass ObservableEthersLiquity {\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n    }\r\n    watchTotalRedistributed(onTotalRedistributedChanged) {\r\n        const { activePool, defaultPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const etherSent = activePool.filters.EtherSent();\r\n        const redistributionListener = debounce((blockTag) => {\r\n            this._readable.getTotalRedistributed({ blockTag }).then(onTotalRedistributedChanged);\r\n        });\r\n        const etherSentListener = (toAddress, _amount, event) => {\r\n            if (toAddress === defaultPool.address) {\r\n                redistributionListener(event);\r\n            }\r\n        };\r\n        activePool.on(etherSent, etherSentListener);\r\n        return () => {\r\n            activePool.removeListener(etherSent, etherSentListener);\r\n        };\r\n    }\r\n    watchTroveWithoutRewards(onTroveChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { troveManager, borrowerOperations } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const troveUpdatedByTroveManager = troveManager.filters.TroveUpdated(address);\r\n        const troveUpdatedByBorrowerOperations = borrowerOperations.filters.TroveUpdated(address);\r\n        const troveListener = debounce((blockTag) => {\r\n            this._readable.getTroveBeforeRedistribution(address, { blockTag }).then(onTroveChanged);\r\n        });\r\n        troveManager.on(troveUpdatedByTroveManager, troveListener);\r\n        borrowerOperations.on(troveUpdatedByBorrowerOperations, troveListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdatedByTroveManager, troveListener);\r\n            borrowerOperations.removeListener(troveUpdatedByBorrowerOperations, troveListener);\r\n        };\r\n    }\r\n    watchNumberOfTroves(onNumberOfTrovesChanged) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { TroveUpdated } = troveManager.filters;\r\n        const troveUpdated = TroveUpdated();\r\n        const troveUpdatedListener = debounce((blockTag) => {\r\n            this._readable.getNumberOfTroves({ blockTag }).then(onNumberOfTrovesChanged);\r\n        });\r\n        troveManager.on(troveUpdated, troveUpdatedListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdated, troveUpdatedListener);\r\n        };\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    watchPrice(onPriceChanged) {\r\n        // TODO revisit\r\n        // We no longer have our own PriceUpdated events. If we want to implement this in an event-based\r\n        // manner, we'll need to listen to aggregator events directly. Or we could do polling.\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    watchTotal(onTotalChanged) {\r\n        const { troveManager } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { TroveUpdated } = troveManager.filters;\r\n        const troveUpdated = TroveUpdated();\r\n        const totalListener = debounce((blockTag) => {\r\n            this._readable.getTotal({ blockTag }).then(onTotalChanged);\r\n        });\r\n        troveManager.on(troveUpdated, totalListener);\r\n        return () => {\r\n            troveManager.removeListener(troveUpdated, totalListener);\r\n        };\r\n    }\r\n    watchStabilityDeposit(onStabilityDepositChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { activePool, stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { UserDepositChanged } = stabilityPool.filters;\r\n        const { EtherSent } = activePool.filters;\r\n        const userDepositChanged = UserDepositChanged(address);\r\n        const etherSent = EtherSent();\r\n        const depositListener = debounce((blockTag) => {\r\n            this._readable.getStabilityDeposit(address, { blockTag }).then(onStabilityDepositChanged);\r\n        });\r\n        const etherSentListener = (toAddress, _amount, event) => {\r\n            if (toAddress === stabilityPool.address) {\r\n                // Liquidation while Stability Pool has some deposits\r\n                // There may be new gains\r\n                depositListener(event);\r\n            }\r\n        };\r\n        stabilityPool.on(userDepositChanged, depositListener);\r\n        activePool.on(etherSent, etherSentListener);\r\n        return () => {\r\n            stabilityPool.removeListener(userDepositChanged, depositListener);\r\n            activePool.removeListener(etherSent, etherSentListener);\r\n        };\r\n    }\r\n    watchLUSDInStabilityPool(onLUSDInStabilityPoolChanged) {\r\n        const { lusdToken, stabilityPool } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { Transfer } = lusdToken.filters;\r\n        const transferLUSDFromStabilityPool = Transfer(stabilityPool.address);\r\n        const transferLUSDToStabilityPool = Transfer(null, stabilityPool.address);\r\n        const stabilityPoolLUSDFilters = [transferLUSDFromStabilityPool, transferLUSDToStabilityPool];\r\n        const stabilityPoolLUSDListener = debounce((blockTag) => {\r\n            this._readable.getLUSDInStabilityPool({ blockTag }).then(onLUSDInStabilityPoolChanged);\r\n        });\r\n        stabilityPoolLUSDFilters.forEach(filter => lusdToken.on(filter, stabilityPoolLUSDListener));\r\n        return () => stabilityPoolLUSDFilters.forEach(filter => lusdToken.removeListener(filter, stabilityPoolLUSDListener));\r\n    }\r\n    watchLUSDBalance(onLUSDBalanceChanged, address) {\r\n        address !== null && address !== void 0 ? address : (address = EthersLiquityConnection_1._requireAddress(this._readable.connection));\r\n        const { lusdToken } = EthersLiquityConnection_1._getContracts(this._readable.connection);\r\n        const { Transfer } = lusdToken.filters;\r\n        const transferLUSDFromUser = Transfer(address);\r\n        const transferLUSDToUser = Transfer(null, address);\r\n        const lusdTransferFilters = [transferLUSDFromUser, transferLUSDToUser];\r\n        const lusdTransferListener = debounce((blockTag) => {\r\n            this._readable.getLUSDBalance(address, { blockTag }).then(onLUSDBalanceChanged);\r\n        });\r\n        lusdTransferFilters.forEach(filter => lusdToken.on(filter, lusdTransferListener));\r\n        return () => lusdTransferFilters.forEach(filter => lusdToken.removeListener(filter, lusdTransferListener));\r\n    }\r\n}\r\nexports.ObservableEthersLiquity = ObservableEthersLiquity;\r\n//# sourceMappingURL=ObservableEthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.logsToString = void 0;\r\nconst bignumber_1 = require(\"@ethersproject/bignumber\");\r\nconst constants_1 = require(\"@ethersproject/constants\");\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst interfaceLookupFrom = (contractLookup) => {\r\n    return Object.fromEntries(Object.entries(contractLookup).map(([, contract]) => [contract.address, contract.interface]));\r\n};\r\nconst nameLookupFrom = (contractLookup) => {\r\n    return Object.fromEntries(Object.entries(contractLookup).map(([name, contract]) => [contract.address, name]));\r\n};\r\nconst tryToParseLog = (log, interfaceLookup) => {\r\n    const { address } = log;\r\n    if (address in interfaceLookup) {\r\n        try {\r\n            return { address, logDescription: interfaceLookup[address].parseLog(log) };\r\n        }\r\n        catch (err) {\r\n            console.warn(\"Failed to parse log:\");\r\n            console.warn(log);\r\n            console.warn(\"Caught:\");\r\n            console.warn(err);\r\n        }\r\n    }\r\n};\r\nconst parseLogs = (logs, interfaceLookup) => {\r\n    const parsedLogs = [];\r\n    const unparsedLogs = [];\r\n    logs.forEach(log => {\r\n        const parsedLog = tryToParseLog(log, interfaceLookup);\r\n        if (parsedLog) {\r\n            parsedLogs.push(parsedLog);\r\n        }\r\n        else {\r\n            unparsedLogs.push(log);\r\n        }\r\n    });\r\n    return [parsedLogs, unparsedLogs];\r\n};\r\nconst VERY_BIG = bignumber_1.BigNumber.from(10).pow(9);\r\nconst prettify = (arg, nameLookup) => {\r\n    if (bignumber_1.BigNumber.isBigNumber(arg)) {\r\n        if (arg.gte(VERY_BIG)) {\r\n            return `${lib_base_1.Decimal.fromBigNumberString(arg.toHexString())}e18`;\r\n        }\r\n        else {\r\n            return arg.toString();\r\n        }\r\n    }\r\n    else if (typeof arg === \"string\") {\r\n        return arg === constants_1.AddressZero\r\n            ? \"address(0)\"\r\n            : nameLookup && arg in nameLookup\r\n                ? nameLookup[arg]\r\n                : arg;\r\n    }\r\n    else {\r\n        return String(arg);\r\n    }\r\n};\r\nconst logDescriptionToString = (logDescription, nameLookup) => {\r\n    const prettyEntries = Object.entries(logDescription.args)\r\n        .filter(([key]) => !key.match(/^[0-9]/))\r\n        .map(([key, value]) => `${key}: ${prettify(value, nameLookup)}`);\r\n    return `${logDescription.name}({ ${prettyEntries.join(\", \")} })`;\r\n};\r\nconst logsToString = (receipt, contracts) => {\r\n    const contractLookup = contracts;\r\n    const interfaceLookup = interfaceLookupFrom(contractLookup);\r\n    const contractNameLookup = nameLookupFrom(contractLookup);\r\n    const nameLookup = {\r\n        [receipt.from]: \"user\",\r\n        ...contractNameLookup\r\n    };\r\n    const [parsedLogs, unparsedLogs] = parseLogs(receipt.logs, interfaceLookup);\r\n    if (unparsedLogs.length > 0) {\r\n        console.warn(\"Warning: not all logs were parsed. Unparsed logs:\");\r\n        console.warn(unparsedLogs);\r\n    }\r\n    if (parsedLogs.length > 0) {\r\n        return (`Logs of tx ${receipt.transactionHash}:\\n` +\r\n            parsedLogs\r\n                .map(({ address, logDescription }) => `  ${contractNameLookup[address]}.${logDescriptionToString(logDescription, nameLookup)}`)\r\n                .join(\"\\n\"));\r\n    }\r\n    else {\r\n        return `No logs were parsed in tx ${receipt.transactionHash}`;\r\n    }\r\n};\r\nexports.logsToString = logsToString;\r\n//# sourceMappingURL=parseLogs.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.EthersLiquity = exports.EthersTransactionFailedError = void 0;\r\nconst lib_base_1 = require(\"@liquity/lib-base\");\r\nconst EthersLiquityConnection_1 = require(\"./EthersLiquityConnection\");\r\nconst PopulatableEthersLiquity_1 = require(\"./PopulatableEthersLiquity\");\r\nconst ReadableEthersLiquity_1 = require(\"./ReadableEthersLiquity\");\r\nconst SendableEthersLiquity_1 = require(\"./SendableEthersLiquity\");\r\n/**\r\n * Thrown by {@link EthersLiquity} in case of transaction failure.\r\n *\r\n * @public\r\n */\r\nclass EthersTransactionFailedError extends lib_base_1.TransactionFailedError {\r\n    constructor(message, failedReceipt) {\r\n        super(\"EthersTransactionFailedError\", message, failedReceipt);\r\n    }\r\n}\r\nexports.EthersTransactionFailedError = EthersTransactionFailedError;\r\nconst waitForSuccess = async (tx) => {\r\n    const receipt = await tx.waitForReceipt();\r\n    if (receipt.status !== \"succeeded\") {\r\n        throw new EthersTransactionFailedError(\"Transaction failed\", receipt);\r\n    }\r\n    return receipt.details;\r\n};\r\n/**\r\n * Convenience class that combines multiple interfaces of the library in one object.\r\n *\r\n * @public\r\n */\r\nclass EthersLiquity {\r\n    /** @internal */\r\n    constructor(readable) {\r\n        this._readable = readable;\r\n        this.connection = readable.connection;\r\n        this.populate = new PopulatableEthersLiquity_1.PopulatableEthersLiquity(readable);\r\n        this.send = new SendableEthersLiquity_1.SendableEthersLiquity(this.populate);\r\n    }\r\n    /** @internal */\r\n    static _from(connection) {\r\n        if (EthersLiquityConnection_1._usingStore(connection)) {\r\n            return new _EthersLiquityWithStore(ReadableEthersLiquity_1.ReadableEthersLiquity._from(connection));\r\n        }\r\n        else {\r\n            return new EthersLiquity(ReadableEthersLiquity_1.ReadableEthersLiquity._from(connection));\r\n        }\r\n    }\r\n    static async connect(signerOrProvider, optionalParams) {\r\n        return EthersLiquity._from(await EthersLiquityConnection_1._connect(signerOrProvider, optionalParams));\r\n    }\r\n    hasStore() {\r\n        return false;\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalRedistributed} */\r\n    getTotalRedistributed(overrides) {\r\n        return this._readable.getTotalRedistributed(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTroveBeforeRedistribution} */\r\n    getTroveBeforeRedistribution(address, overrides) {\r\n        return this._readable.getTroveBeforeRedistribution(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTrove} */\r\n    getTrove(address, overrides) {\r\n        return this._readable.getTrove(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getNumberOfTroves} */\r\n    getNumberOfTroves(overrides) {\r\n        return this._readable.getNumberOfTroves(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getPrice} */\r\n    getPrice(overrides) {\r\n        return this._readable.getPrice(overrides);\r\n    }\r\n    /** @internal */\r\n    _getActivePool(overrides) {\r\n        return this._readable._getActivePool(overrides);\r\n    }\r\n    /** @internal */\r\n    _getDefaultPool(overrides) {\r\n        return this._readable._getDefaultPool(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotal} */\r\n    getTotal(overrides) {\r\n        return this._readable.getTotal(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getStabilityDeposit} */\r\n    getStabilityDeposit(address, overrides) {\r\n        return this._readable.getStabilityDeposit(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingStabilityPoolLQTYReward} */\r\n    getRemainingStabilityPoolLQTYReward(overrides) {\r\n        return this._readable.getRemainingStabilityPoolLQTYReward(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDInStabilityPool} */\r\n    getLUSDInStabilityPool(overrides) {\r\n        return this._readable.getLUSDInStabilityPool(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLUSDBalance} */\r\n    getLUSDBalance(address, overrides) {\r\n        return this._readable.getLUSDBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYBalance} */\r\n    getLQTYBalance(address, overrides) {\r\n        return this._readable.getLQTYBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenBalance} */\r\n    getUniTokenBalance(address, overrides) {\r\n        return this._readable.getUniTokenBalance(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getUniTokenAllowance} */\r\n    getUniTokenAllowance(address, overrides) {\r\n        return this._readable.getUniTokenAllowance(address, overrides);\r\n    }\r\n    /** @internal */\r\n    _getRemainingLiquidityMiningLQTYRewardCalculator(overrides) {\r\n        return this._readable._getRemainingLiquidityMiningLQTYRewardCalculator(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getRemainingLiquidityMiningLQTYReward} */\r\n    getRemainingLiquidityMiningLQTYReward(overrides) {\r\n        return this._readable.getRemainingLiquidityMiningLQTYReward(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningStake} */\r\n    getLiquidityMiningStake(address, overrides) {\r\n        return this._readable.getLiquidityMiningStake(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedUniTokens} */\r\n    getTotalStakedUniTokens(overrides) {\r\n        return this._readable.getTotalStakedUniTokens(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLiquidityMiningLQTYReward} */\r\n    getLiquidityMiningLQTYReward(address, overrides) {\r\n        return this._readable.getLiquidityMiningLQTYReward(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getCollateralSurplusBalance} */\r\n    getCollateralSurplusBalance(address, overrides) {\r\n        return this._readable.getCollateralSurplusBalance(address, overrides);\r\n    }\r\n    getTroves(params, overrides) {\r\n        return this._readable.getTroves(params, overrides);\r\n    }\r\n    /** @internal */\r\n    _getBlockTimestamp(blockTag) {\r\n        return this._readable._getBlockTimestamp(blockTag);\r\n    }\r\n    /** @internal */\r\n    _getFeesFactory(overrides) {\r\n        return this._readable._getFeesFactory(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFees} */\r\n    getFees(overrides) {\r\n        return this._readable.getFees(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getLQTYStake} */\r\n    getLQTYStake(address, overrides) {\r\n        return this._readable.getLQTYStake(address, overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getTotalStakedLQTY} */\r\n    getTotalStakedLQTY(overrides) {\r\n        return this._readable.getTotalStakedLQTY(overrides);\r\n    }\r\n    /** {@inheritDoc @liquity/lib-base#ReadableLiquity.getFrontendStatus} */\r\n    getFrontendStatus(address, overrides) {\r\n        return this._readable.getFrontendStatus(address, overrides);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.openTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    openTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this.send\r\n            .openTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.closeTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    closeTrove(overrides) {\r\n        return this.send.closeTrove(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.adjustTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides) {\r\n        return this.send\r\n            .adjustTrove(params, maxBorrowingRateOrOptionalParams, overrides)\r\n            .then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.depositCollateral}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    depositCollateral(amount, overrides) {\r\n        return this.send.depositCollateral(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawCollateral}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawCollateral(amount, overrides) {\r\n        return this.send.withdrawCollateral(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.borrowLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    borrowLUSD(amount, maxBorrowingRate, overrides) {\r\n        return this.send.borrowLUSD(amount, maxBorrowingRate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.repayLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    repayLUSD(amount, overrides) {\r\n        return this.send.repayLUSD(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /** @internal */\r\n    setPrice(price, overrides) {\r\n        return this.send.setPrice(price, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.liquidate}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    liquidate(address, overrides) {\r\n        return this.send.liquidate(address, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.liquidateUpTo}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides) {\r\n        return this.send.liquidateUpTo(maximumNumberOfTrovesToLiquidate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.depositLUSDInStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    depositLUSDInStabilityPool(amount, frontendTag, overrides) {\r\n        return this.send.depositLUSDInStabilityPool(amount, frontendTag, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawLUSDFromStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawLUSDFromStabilityPool(amount, overrides) {\r\n        return this.send.withdrawLUSDFromStabilityPool(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawGainsFromStabilityPool}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawGainsFromStabilityPool(overrides) {\r\n        return this.send.withdrawGainsFromStabilityPool(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.transferCollateralGainToTrove}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    transferCollateralGainToTrove(overrides) {\r\n        return this.send.transferCollateralGainToTrove(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.sendLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    sendLUSD(toAddress, amount, overrides) {\r\n        return this.send.sendLUSD(toAddress, amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.sendLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    sendLQTY(toAddress, amount, overrides) {\r\n        return this.send.sendLQTY(toAddress, amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.redeemLUSD}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    redeemLUSD(amount, maxRedemptionRate, overrides) {\r\n        return this.send.redeemLUSD(amount, maxRedemptionRate, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.claimCollateralSurplus}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    claimCollateralSurplus(overrides) {\r\n        return this.send.claimCollateralSurplus(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.stakeLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    stakeLQTY(amount, overrides) {\r\n        return this.send.stakeLQTY(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.unstakeLQTY}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    unstakeLQTY(amount, overrides) {\r\n        return this.send.unstakeLQTY(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawGainsFromStaking}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawGainsFromStaking(overrides) {\r\n        return this.send.withdrawGainsFromStaking(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.registerFrontend}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    registerFrontend(kickbackRate, overrides) {\r\n        return this.send.registerFrontend(kickbackRate, overrides).then(waitForSuccess);\r\n    }\r\n    /** @internal */\r\n    _mintUniToken(amount, address, overrides) {\r\n        return this.send._mintUniToken(amount, address, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.approveUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    approveUniTokens(allowance, overrides) {\r\n        return this.send.approveUniTokens(allowance, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.stakeUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    stakeUniTokens(amount, overrides) {\r\n        return this.send.stakeUniTokens(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.unstakeUniTokens}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    unstakeUniTokens(amount, overrides) {\r\n        return this.send.unstakeUniTokens(amount, overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.withdrawLQTYRewardFromLiquidityMining}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    withdrawLQTYRewardFromLiquidityMining(overrides) {\r\n        return this.send.withdrawLQTYRewardFromLiquidityMining(overrides).then(waitForSuccess);\r\n    }\r\n    /**\r\n     * {@inheritDoc @liquity/lib-base#TransactableLiquity.exitLiquidityMining}\r\n     *\r\n     * @throws\r\n     * Throws {@link EthersTransactionFailedError} in case of transaction failure.\r\n     * Throws {@link EthersTransactionCancelledError} if the transaction is cancelled or replaced.\r\n     */\r\n    exitLiquidityMining(overrides) {\r\n        return this.send.exitLiquidityMining(overrides).then(waitForSuccess);\r\n    }\r\n}\r\nexports.EthersLiquity = EthersLiquity;\r\nclass _EthersLiquityWithStore extends EthersLiquity {\r\n    constructor(readable) {\r\n        super(readable);\r\n        this.store = readable.store;\r\n    }\r\n    hasStore(store) {\r\n        return store === undefined || store === this.connection.useStore;\r\n    }\r\n}\r\n//# sourceMappingURL=EthersLiquity.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquityReducer = void 0;\r\nconst react_1 = require(\"react\");\r\nconst equals_1 = require(\"../utils/equals\");\r\nconst useLiquityStore_1 = require(\"./useLiquityStore\");\r\nconst useLiquityReducer = (reduce, init) => {\r\n    const store = useLiquityStore_1.useLiquityStore();\r\n    const oldStore = react_1.useRef(store);\r\n    const state = react_1.useRef(init(store.state));\r\n    const [, rerender] = react_1.useReducer(() => ({}), {});\r\n    const dispatch = react_1.useCallback((action) => {\r\n        const newState = reduce(state.current, action);\r\n        if (!equals_1.equals(newState, state.current)) {\r\n            state.current = newState;\r\n            rerender();\r\n        }\r\n    }, [reduce]);\r\n    react_1.useEffect(() => store.subscribe(params => dispatch({ type: \"updateStore\", ...params })), [\r\n        store,\r\n        dispatch\r\n    ]);\r\n    if (oldStore.current !== store) {\r\n        state.current = init(store.state);\r\n        oldStore.current = store;\r\n    }\r\n    return [state.current, dispatch];\r\n};\r\nexports.useLiquityReducer = useLiquityReducer;\r\n//# sourceMappingURL=useLiquityReducer.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useLiquitySelector = void 0;\r\nconst react_1 = require(\"react\");\r\nconst equals_1 = require(\"../utils/equals\");\r\nconst useLiquityStore_1 = require(\"./useLiquityStore\");\r\nconst useLiquitySelector = (select) => {\r\n    const store = useLiquityStore_1.useLiquityStore();\r\n    const [, rerender] = react_1.useReducer(() => ({}), {});\r\n    react_1.useEffect(() => store.subscribe(({ newState, oldState }) => {\r\n        if (!equals_1.equals(select(newState), select(oldState))) {\r\n            rerender();\r\n        }\r\n    }), [store, select]);\r\n    return select(store.state);\r\n};\r\nexports.useLiquitySelector = useLiquitySelector;\r\n//# sourceMappingURL=useLiquitySelector.js.map","import { AddressZero } from \"@ethersproject/constants\";\r\nimport { isAddress, getAddress } from \"@ethersproject/address\";\r\n\r\nexport type LiquityFrontendConfig = {\r\n  frontendTag: string;\r\n  infuraApiKey?: string;\r\n  testnetOnly?: boolean;\r\n};\r\n\r\nconst defaultConfig: LiquityFrontendConfig = {\r\n  frontendTag: AddressZero\r\n};\r\n\r\nfunction hasKey<K extends string>(o: object, k: K): o is Record<K, unknown> {\r\n  return k in o;\r\n}\r\n\r\nconst parseConfig = (json: unknown): LiquityFrontendConfig => {\r\n  const config = { ...defaultConfig };\r\n\r\n  if (typeof json === \"object\" && json !== null) {\r\n    if (hasKey(json, \"frontendTag\") && json.frontendTag !== \"\") {\r\n      const { frontendTag } = json;\r\n\r\n      if (typeof frontendTag === \"string\" && isAddress(frontendTag)) {\r\n        config.frontendTag = getAddress(frontendTag);\r\n      } else {\r\n        console.error(\"Malformed frontendTag:\");\r\n        console.log(frontendTag);\r\n      }\r\n    }\r\n\r\n    if (hasKey(json, \"infuraApiKey\") && json.infuraApiKey !== \"\") {\r\n      const { infuraApiKey } = json;\r\n\r\n      if (typeof infuraApiKey === \"string\") {\r\n        config.infuraApiKey = infuraApiKey;\r\n      } else {\r\n        console.error(\"Malformed infuraApiKey:\");\r\n        console.log(infuraApiKey);\r\n      }\r\n    }\r\n\r\n    if (hasKey(json, \"testnetOnly\")) {\r\n      const { testnetOnly } = json;\r\n\r\n      if (typeof testnetOnly === \"boolean\") {\r\n        config.testnetOnly = testnetOnly;\r\n      } else {\r\n        console.error(\"Malformed testnetOnly:\");\r\n        console.log(testnetOnly);\r\n      }\r\n    }\r\n  } else {\r\n    console.error(\"Malformed config:\");\r\n    console.log(json);\r\n  }\r\n\r\n  return config;\r\n};\r\n\r\nlet configPromise: Promise<LiquityFrontendConfig> | undefined = undefined;\r\n\r\nconst fetchConfig = async () => {\r\n  try {\r\n    const response = await fetch(\"config.json\");\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to fetch config.json (status ${response.status})`);\r\n    }\r\n\r\n    return parseConfig(await response.json());\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { ...defaultConfig };\r\n  }\r\n};\r\n\r\nexport const getConfig = (): Promise<LiquityFrontendConfig> => {\r\n  if (!configPromise) {\r\n    configPromise = fetchConfig();\r\n  }\r\n\r\n  return configPromise;\r\n};\r\n","import React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { Provider } from \"@ethersproject/abstract-provider\";\r\n// import { Signer } from \"@ethersproject/abstract-signer\";\r\nimport { getNetwork } from \"@ethersproject/networks\";\r\nimport { Web3Provider } from \"@ethersproject/providers\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\n\r\nimport { isBatchedProvider, isWebSocketAugmentedProvider } from \"@liquity/providers\";\r\nimport {\r\n  BlockPolledLiquityStore,\r\n  EthersLiquity,\r\n  EthersLiquityWithStore,\r\n  _connectByChainId\r\n} from \"@liquity/lib-ethers\";\r\n\r\nimport { LiquityFrontendConfig, getConfig } from \"../config\";\r\n\r\ntype LiquityContextValue = {\r\n  config: LiquityFrontendConfig;\r\n  account: string;\r\n  provider: Provider;\r\n  liquity: EthersLiquityWithStore<BlockPolledLiquityStore>;\r\n};\r\n\r\nconst LiquityContext = createContext<LiquityContextValue | undefined>(undefined);\r\n\r\ntype LiquityProviderProps = {\r\n  loader?: React.ReactNode;\r\n  unsupportedNetworkFallback?: (chainId: number) => React.ReactNode;\r\n  unsupportedMainnetFallback?: React.ReactNode;\r\n};\r\n\r\nconst wsParams = (network: string, infuraApiKey: string): [string, string] => [\r\n  `wss://${network === \"homestead\" ? \"mainnet\" : network}.infura.io/ws/v3/${infuraApiKey}`,\r\n  network\r\n];\r\n\r\nconst webSocketSupportedNetworks = [\"homestead\", \"kovan\", \"rinkeby\", \"ropsten\", \"goerli\"];\r\n\r\nexport const LiquityProvider: React.FC<LiquityProviderProps> = ({\r\n  children,\r\n  loader,\r\n  unsupportedNetworkFallback,\r\n  unsupportedMainnetFallback\r\n}) => {\r\n  const { library: provider, account, chainId } = useWeb3React<Web3Provider>();\r\n  const [config, setConfig] = useState<LiquityFrontendConfig>();\r\n\r\n  const connection = useMemo(() => {\r\n    if (config && provider && account && chainId) {\r\n      try {\r\n        return _connectByChainId(provider, provider.getSigner(account), chainId, {\r\n          userAddress: account,\r\n          frontendTag: config.frontendTag,\r\n          useStore: \"blockPolled\"\r\n        });\r\n      } catch {}\r\n    }\r\n  }, [config, provider, account, chainId]);\r\n\r\n  useEffect(() => {\r\n    getConfig().then(setConfig);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (config && connection) {\r\n      const { provider, chainId } = connection;\r\n\r\n      if (isBatchedProvider(provider) && provider.chainId !== chainId) {\r\n        provider.chainId = chainId;\r\n      }\r\n\r\n      if (isWebSocketAugmentedProvider(provider)) {\r\n        const network = getNetwork(chainId);\r\n\r\n        if (\r\n          network.name &&\r\n          webSocketSupportedNetworks.includes(network.name) &&\r\n          config.infuraApiKey\r\n        ) {\r\n          provider.openWebSocket(...wsParams(network.name, config.infuraApiKey));\r\n        } else if (connection._isDev) {\r\n          provider.openWebSocket(`ws://${window.location.hostname}:8546`, chainId);\r\n        }\r\n\r\n        return () => {\r\n          provider.closeWebSocket();\r\n        };\r\n      }\r\n    }\r\n  }, [config, connection]);\r\n\r\n  if (!config || !provider || !account || !chainId) {\r\n    return <>{loader}</>;\r\n  }\r\n\r\n  if (config.testnetOnly && chainId === 1) {\r\n    return <>{unsupportedMainnetFallback}</>;\r\n  }\r\n\r\n  if (!connection) {\r\n    return unsupportedNetworkFallback ? <>{unsupportedNetworkFallback(chainId)}</> : null;\r\n  }\r\n\r\n  const liquity = EthersLiquity._from(connection);\r\n  liquity.store.logging = true;\r\n\r\n  return (\r\n    <LiquityContext.Provider value={{ config, account, provider, liquity }}>\r\n      {children}\r\n    </LiquityContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useLiquity = () => {\r\n  const liquityContext = useContext(LiquityContext);\r\n\r\n  if (!liquityContext) {\r\n    throw new Error(\"You must provide a LiquityContext via LiquityProvider\");\r\n  }\r\n\r\n  return liquityContext;\r\n};\r\n","import { InjectedConnector } from \"@web3-react/injected-connector\";\r\n\r\nexport const injectedConnector = new InjectedConnector({});\r\n","import React from \"react\";\r\nimport { library, IconName, IconProp } from \"@fortawesome/fontawesome-svg-core\";\r\nimport {\r\n  faCircleNotch,\r\n  faCheckCircle,\r\n  faExclamationTriangle,\r\n  faInfoCircle,\r\n  faTimes,\r\n  faTrash,\r\n  faChartLine,\r\n  faRedo,\r\n  faHistory,\r\n  faChevronLeft,\r\n  faChevronRight,\r\n  faUserCircle,\r\n  faWallet,\r\n  faExternalLinkAlt,\r\n  faClipboardCheck,\r\n  faCog,\r\n  faCheck,\r\n  faPlug,\r\n  faExclamationCircle,\r\n  faAngleUp,\r\n  faAngleDoubleUp,\r\n  faAngleDown,\r\n  faAngleDoubleDown,\r\n  faPen,\r\n  faHandPaper,\r\n  faHeartbeat,\r\n  faBars,\r\n  faArrowDown\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\nimport { faClipboard, faQuestionCircle } from \"@fortawesome/free-regular-svg-icons\";\r\nimport { FontAwesomeIcon, FontAwesomeIconProps } from \"@fortawesome/react-fontawesome\";\r\n\r\nlibrary.add(\r\n  faCircleNotch,\r\n  faCheck,\r\n  faCheckCircle,\r\n  faExclamationTriangle,\r\n  faInfoCircle,\r\n  faTimes,\r\n  faTrash,\r\n  faChartLine,\r\n  faRedo,\r\n  faHistory,\r\n  faChevronLeft,\r\n  faChevronRight,\r\n  faClipboard,\r\n  faClipboardCheck,\r\n  faUserCircle,\r\n  faWallet,\r\n  faExternalLinkAlt,\r\n  faCog,\r\n  faPlug,\r\n  faExclamationCircle,\r\n  faAngleUp,\r\n  faAngleDoubleUp,\r\n  faAngleDown,\r\n  faAngleDoubleDown,\r\n  faPen,\r\n  faHandPaper,\r\n  faHeartbeat,\r\n  faBars,\r\n  faQuestionCircle,\r\n  faArrowDown\r\n);\r\n\r\nconst getIcon = (name: IconName): IconProp => {\r\n  switch (name) {\r\n    case \"clipboard\":\r\n      return [\"far\", \"clipboard\"];\r\n    case \"question-circle\":\r\n      return [\"far\", \"question-circle\"];\r\n    default:\r\n      return name;\r\n  }\r\n};\r\n\r\nexport type IconProps = Pick<FontAwesomeIconProps, \"style\" | \"size\" | \"color\" | \"spin\"> & {\r\n  name: IconName;\r\n};\r\n\r\nexport const Icon: React.FC<IconProps> = ({ name, style, ...rest }) => (\r\n  <FontAwesomeIcon style={style} icon={getIcon(name)} {...rest} />\r\n);\r\n","import React from \"react\";\r\nimport { Heading, Flex, Card, Button, Box } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\ntype DialogIntent = \"success\" | \"warning\" | \"danger\" | \"info\";\r\n\r\ntype DialogProps = {\r\n  intent?: DialogIntent;\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  cancelLabel?: string;\r\n  onCancel: () => void;\r\n};\r\n\r\nconst iconFromIntent = (intent: DialogIntent | undefined) => {\r\n  switch (intent) {\r\n    case \"success\":\r\n      return <Icon name=\"check-circle\" color=\"success\" aria-label=\"Success\" />;\r\n    case \"warning\":\r\n      return <Icon name=\"exclamation-triangle\" color=\"warning\" aria-label=\"Warning\" />;\r\n    case \"danger\":\r\n      return <Icon name=\"exclamation-triangle\" color=\"danger\" aria-label=\"Danger\" />;\r\n    case \"info\":\r\n      return <Icon name=\"info-circle\" color=\"info\" aria-label=\"Info\" />;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const Dialog: React.FC<DialogProps> = ({\r\n  intent,\r\n  title,\r\n  icon,\r\n  cancelLabel,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <Card sx={{ p: 0, borderRadius: \"4px\" }}>\r\n    {intent ? <Box sx={{ height: \"4px\", bg: intent, borderRadius: \"3px 3px 0 0\" }} /> : null}\r\n    <Flex\r\n      sx={{\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n        borderBottom: 1,\r\n        borderColor: \"muted\",\r\n        p: [3, 4],\r\n        pb: 3\r\n      }}\r\n    >\r\n      {icon || iconFromIntent(intent)}\r\n      <Heading as=\"h1\" sx={{ textAlign: \"center\", fontSize: [2, 3], px: [3, 0] }}>\r\n        {title}\r\n      </Heading>\r\n      <Button variant=\"icon\" onClick={onCancel}>\r\n        <Icon name=\"times\" size=\"lg\" aria-label={cancelLabel || \"Cancel\"} />\r\n      </Button>\r\n    </Flex>\r\n    {children}\r\n  </Card>\r\n);\r\n","import React from \"react\";\r\nimport { Box, Button, Flex } from \"theme-ui\";\r\n\r\nimport { Dialog } from \"./Dialog\";\r\n\r\ntype RetryDialogProps = {\r\n  title: string;\r\n  cancelLabel?: string;\r\n  retryLabel?: string;\r\n  onCancel: () => void;\r\n  onRetry: () => void;\r\n};\r\n\r\nexport const RetryDialog: React.FC<RetryDialogProps> = ({\r\n  title,\r\n  cancelLabel,\r\n  onCancel,\r\n  retryLabel,\r\n  onRetry,\r\n  children\r\n}) => (\r\n  <Dialog intent=\"danger\" title={title} cancelLabel={cancelLabel} onCancel={onCancel}>\r\n    <Box sx={{ p: [3, 4] }}>{children}</Box>\r\n    <Flex\r\n      sx={{\r\n        p: [3, 4],\r\n        borderTop: 1,\r\n        borderColor: \"muted\",\r\n        justifyContent: \"flex-end\",\r\n        flexDirection: [\"column\", \"row\"],\r\n        alignItems: \"center\"\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"danger\"\r\n        sx={{\r\n          mr: [0, 3],\r\n          mb: [2, 0],\r\n          width: [\"100%\", \"auto\"]\r\n        }}\r\n        onClick={onCancel}\r\n      >\r\n        {cancelLabel || \"Cancel\"}\r\n      </Button>\r\n      <Button sx={{ width: [\"100%\", \"auto\"] }} onClick={onRetry}>\r\n        {retryLabel || \"Retry\"}\r\n      </Button>\r\n    </Flex>\r\n  </Dialog>\r\n);\r\n","import React from \"react\";\r\nimport { Box, Flex, Spinner } from \"theme-ui\";\r\n\r\nimport { Dialog } from \"./Dialog\";\r\n\r\ntype WaitingDialogProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  waitReason: React.ReactNode;\r\n  cancelLabel?: string;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport const WaitingDialog: React.FC<WaitingDialogProps> = ({\r\n  title,\r\n  icon,\r\n  waitReason,\r\n  cancelLabel,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <Dialog title={title} icon={icon} cancelLabel={cancelLabel} onCancel={onCancel}>\r\n    {children}\r\n    <Box sx={{ px: [3, 4], pb: [3, 4] }}>\r\n      <Flex\r\n        sx={{\r\n          flexDirection: [\"column\", \"row\"],\r\n          bg: \"muted\",\r\n          p: [3, 4],\r\n          alignItems: [\"center\", \"auto\"]\r\n        }}\r\n      >\r\n        <Spinner size=\"3em\" sx={{ mr: [0, 3], mb: [2, 0] }} />\r\n        <Flex sx={{ flexDirection: \"column\", alignItems: [\"center\", \"flex-start\"] }}>\r\n          {waitReason}\r\n        </Flex>\r\n      </Flex>\r\n    </Box>\r\n  </Dialog>\r\n);\r\n","import React from \"react\";\r\nimport { Text, Box } from \"theme-ui\";\r\n\r\nimport { WaitingDialog } from \"./WaitingDialog\";\r\n\r\ntype ConnectionConfirmationDialogProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport const ConnectionConfirmationDialog: React.FC<ConnectionConfirmationDialogProps> = ({\r\n  title,\r\n  icon,\r\n  onCancel,\r\n  children\r\n}) => (\r\n  <WaitingDialog\r\n    title={title}\r\n    icon={icon}\r\n    waitReason={\r\n      <>\r\n        <Text sx={{ fontWeight: \"bold\" }}>Waiting for connection confirmation...</Text>\r\n        <Text>This won’t cost you any Ether</Text>\r\n      </>\r\n    }\r\n    cancelLabel=\"Cancel connection\"\r\n    onCancel={onCancel}\r\n  >\r\n    <Box sx={{ p: [3, 4] }}>{children}</Box>\r\n  </WaitingDialog>\r\n);\r\n","import React from \"react\";\r\n\r\nexport const MetaMaskIcon: React.FC = () => (\r\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <title>MetaMask extension icon</title>\r\n    <path\r\n      d=\"M8.49025 3.49976L1.49216 0.499756L0.492432 3.49976L2.49189 11.9998L21.4867 11.4998L23.4861 3.49976L21.9866 0.499756L15.4883 3.49976H8.49025Z\"\r\n      fill=\"#763D16\"\r\n    />\r\n    <path d=\"M6.99048 11.9998H17.9875V18.9998H6.99048V11.9998Z\" fill=\"#333333\" />\r\n    <rect x=\"7.99023\" y=\"16.9998\" width=\"5.99836\" height=\"3\" fill=\"#333333\" />\r\n    <path\r\n      d=\"M1.58124 10.6642C1.72755 10.8311 1.76935 11.0607 1.70665 11.2485L0.222731 15.8398C0.18093 15.9651 0.18093 16.0903 0.222731 16.1946L1.51854 20.6398C1.62304 20.9738 1.95745 21.1616 2.27095 21.0572L6.7227 19.8259C6.9108 19.7633 7.1198 19.8259 7.287 19.9511L8.06031 20.5772C8.08121 20.5981 8.08121 20.5981 8.10211 20.5981L10.0249 21.9338C10.1294 21.9964 10.2548 22.0381 10.3802 22.0381H13.5989C13.7243 22.0381 13.8497 21.9964 13.9542 21.9338L15.877 20.5981C15.8979 20.5981 15.8979 20.5772 15.9188 20.5772L16.6921 19.9511C16.8384 19.8259 17.0474 19.7842 17.2564 19.8259L21.7081 21.0572C22.0426 21.1407 22.377 20.9529 22.4606 20.6398L23.7564 16.1946C23.7982 16.0694 23.7982 15.9442 23.7564 15.8398L22.2725 11.2485C22.2098 11.0398 22.2516 10.8311 22.3979 10.6642L23.9863 3.54766C24.0072 3.44331 24.0072 3.33897 23.9654 3.23462L23.0249 0.417226C22.9204 0.0833133 22.5442 -0.0836433 22.2098 0.0415742L15.2709 2.6294C15.2082 2.65027 15.1246 2.67114 15.0619 2.67114H8.91722C8.83362 2.67114 8.77092 2.65027 8.70822 2.6294L1.76935 0.0415742C1.43494 -0.0836433 1.05874 0.0833133 0.954238 0.417226L0.0346286 3.23462C-0.00717182 3.3181 -0.00717182 3.44331 0.0137284 3.54766L1.58124 10.6642ZM13.996 14.2537L14.5185 13.1685C14.5812 13.0433 14.7484 12.9807 14.8738 13.0433L16.1278 13.6068C16.3577 13.7111 16.3368 14.0451 16.086 14.1285L14.3304 14.6503C14.1005 14.7129 13.8915 14.4833 13.996 14.2537ZM13.8915 6.71984C13.7661 6.61549 13.7661 6.40679 13.9124 6.32331L21.8126 0.918096C21.9381 0.834618 22.1262 0.876357 22.1889 1.04331L23.1712 3.73549C23.1921 3.77723 23.1921 3.81897 23.1712 3.88157L21.5618 10.0798C21.52 10.2051 21.3946 10.2677 21.2692 10.2259L16.922 9.05723C16.8802 9.05723 16.8593 9.03636 16.8384 9.01549L13.8915 6.71984ZM10.0667 19.5338L10.213 18.3233C10.213 18.2607 10.2548 18.1981 10.3175 18.1564L10.6101 17.9477C10.6519 17.9268 10.6937 17.9059 10.7355 17.9059H13.2018C13.2436 17.9059 13.3063 17.9268 13.3272 17.9477L13.6198 18.1564C13.6825 18.1981 13.7034 18.2607 13.7243 18.3233L13.8497 19.5338C13.8706 19.6798 13.7452 19.8051 13.6198 19.8051H10.2757C10.1712 19.8051 10.0667 19.6798 10.0667 19.5338ZM7.85131 13.6068L9.10532 13.0433C9.25162 12.9807 9.39792 13.0433 9.46062 13.1685L9.98313 14.2537C10.0876 14.4624 9.87863 14.692 9.64873 14.6294L7.87221 14.1077C7.64231 14.0451 7.62141 13.7111 7.85131 13.6068ZM0.807936 3.86071C0.787036 3.81897 0.807936 3.75636 0.807936 3.71462L1.79025 1.04331C1.85295 0.897226 2.04105 0.834618 2.16645 0.918096L10.0667 6.32331C10.213 6.42766 10.213 6.61549 10.0876 6.71984L7.1407 9.01549C7.1198 9.03636 7.078 9.05723 7.0571 9.05723L2.70986 10.2259C2.58445 10.2677 2.45905 10.2051 2.41725 10.0798L0.807936 3.86071Z\"\r\n      fill=\"#F36D34\"\r\n    />\r\n  </svg>\r\n);\r\n","import React from \"react\";\r\nimport { Container } from \"theme-ui\";\r\n\r\nexport const Modal: React.FC = ({ children }) => (\r\n  <Container variant=\"modalOverlay\">\r\n    <Container variant=\"modal\">{children}</Container>\r\n  </Container>\r\n);\r\n","import React, { useEffect, useReducer } from \"react\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\nimport { AbstractConnector } from \"@web3-react/abstract-connector\";\r\nimport { Button, Text, Flex, Link, Box } from \"theme-ui\";\r\n\r\nimport { injectedConnector } from \"../connectors/injectedConnector\";\r\nimport { useAuthorizedConnection } from \"../hooks/useAuthorizedConnection\";\r\n\r\nimport { RetryDialog } from \"./RetryDialog\";\r\nimport { ConnectionConfirmationDialog } from \"./ConnectionConfirmationDialog\";\r\nimport { MetaMaskIcon } from \"./MetaMaskIcon\";\r\nimport { Icon } from \"./Icon\";\r\nimport { Modal } from \"./Modal\";\r\n\r\ninterface MaybeHasMetaMask {\r\n  ethereum?: {\r\n    isMetaMask?: boolean;\r\n  };\r\n}\r\n\r\ntype ConnectionState =\r\n  | { type: \"inactive\" }\r\n  | {\r\n      type: \"activating\" | \"active\" | \"rejectedByUser\" | \"alreadyPending\" | \"failed\";\r\n      connector: AbstractConnector;\r\n    };\r\n\r\ntype ConnectionAction =\r\n  | { type: \"startActivating\"; connector: AbstractConnector }\r\n  | { type: \"fail\"; error: Error }\r\n  | { type: \"finishActivating\" | \"retry\" | \"cancel\" | \"deactivate\" };\r\n\r\nconst connectionReducer: React.Reducer<ConnectionState, ConnectionAction> = (state, action) => {\r\n  switch (action.type) {\r\n    case \"startActivating\":\r\n      return {\r\n        type: \"activating\",\r\n        connector: action.connector\r\n      };\r\n    case \"finishActivating\":\r\n      return {\r\n        type: \"active\",\r\n        connector: state.type === \"inactive\" ? injectedConnector : state.connector\r\n      };\r\n    case \"fail\":\r\n      if (state.type !== \"inactive\") {\r\n        return {\r\n          type: action.error.message.match(/user rejected/i)\r\n            ? \"rejectedByUser\"\r\n            : action.error.message.match(/already pending/i)\r\n            ? \"alreadyPending\"\r\n            : \"failed\",\r\n          connector: state.connector\r\n        };\r\n      }\r\n      break;\r\n    case \"retry\":\r\n      if (state.type !== \"inactive\") {\r\n        return {\r\n          type: \"activating\",\r\n          connector: state.connector\r\n        };\r\n      }\r\n      break;\r\n    case \"cancel\":\r\n      return {\r\n        type: \"inactive\"\r\n      };\r\n    case \"deactivate\":\r\n      return {\r\n        type: \"inactive\"\r\n      };\r\n  }\r\n\r\n  console.warn(\"Ignoring connectionReducer action:\");\r\n  console.log(action);\r\n  console.log(\"  in state:\");\r\n  console.log(state);\r\n\r\n  return state;\r\n};\r\n\r\nconst detectMetaMask = () => (window as MaybeHasMetaMask).ethereum?.isMetaMask ?? false;\r\n\r\ntype WalletConnectorProps = {\r\n  loader?: React.ReactNode;\r\n};\r\n\r\nexport const WalletConnector: React.FC<WalletConnectorProps> = ({ children, loader }) => {\r\n  const { activate, deactivate, active, error } = useWeb3React<unknown>();\r\n  const triedAuthorizedConnection = useAuthorizedConnection();\r\n  const [connectionState, dispatch] = useReducer(connectionReducer, { type: \"inactive\" });\r\n  const isMetaMask = detectMetaMask();\r\n\r\n  useEffect(() => {\r\n    if (error) {\r\n      dispatch({ type: \"fail\", error });\r\n      deactivate();\r\n    }\r\n  }, [error, deactivate]);\r\n\r\n  useEffect(() => {\r\n    if (active) {\r\n      dispatch({ type: \"finishActivating\" });\r\n    } else {\r\n      dispatch({ type: \"deactivate\" });\r\n    }\r\n  }, [active]);\r\n\r\n  if (!triedAuthorizedConnection) {\r\n    return <>{loader}</>;\r\n  }\r\n\r\n  if (connectionState.type === \"active\") {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Flex sx={{ height: \"100vh\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n        <Button\r\n          onClick={() => {\r\n            dispatch({ type: \"startActivating\", connector: injectedConnector });\r\n            activate(injectedConnector);\r\n          }}\r\n        >\r\n          {isMetaMask ? (\r\n            <>\r\n              <MetaMaskIcon />\r\n              <Box sx={{ ml: 2 }}>Connect to MetaMask</Box>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Icon name=\"plug\" size=\"lg\" />\r\n              <Box sx={{ ml: 2 }}>Connect wallet</Box>\r\n            </>\r\n          )}\r\n        </Button>\r\n      </Flex>\r\n\r\n      {connectionState.type === \"failed\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title={isMetaMask ? \"Failed to connect to MetaMask\" : \"Failed to connect wallet\"}\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Box sx={{ textAlign: \"center\" }}>\r\n              You might need to install MetaMask or use a different browser.\r\n            </Box>\r\n            <Link sx={{ lineHeight: 3 }} href=\"https://metamask.io/download.html\" target=\"_blank\">\r\n              Learn more <Icon size=\"xs\" name=\"external-link-alt\" />\r\n            </Link>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"activating\" && (\r\n        <Modal>\r\n          <ConnectionConfirmationDialog\r\n            title={\r\n              isMetaMask ? \"Confirm connection in MetaMask\" : \"Confirm connection in your wallet\"\r\n            }\r\n            icon={isMetaMask ? <MetaMaskIcon /> : <Icon name=\"wallet\" size=\"lg\" />}\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n          >\r\n            <Text sx={{ textAlign: \"center\" }}>\r\n              Confirm the request that&apos;s just appeared.\r\n              {isMetaMask ? (\r\n                <> If you can&apos;t see a request, open your MetaMask extension via your browser.</>\r\n              ) : (\r\n                <> If you can&apos;t see a request, you might have to open your wallet.</>\r\n              )}\r\n            </Text>\r\n          </ConnectionConfirmationDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"rejectedByUser\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title=\"Cancel connection?\"\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Text>To use Liquity, you need to connect your Ethereum account.</Text>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n\r\n      {connectionState.type === \"alreadyPending\" && (\r\n        <Modal>\r\n          <RetryDialog\r\n            title=\"Connection already requested\"\r\n            onCancel={() => dispatch({ type: \"cancel\" })}\r\n            onRetry={() => {\r\n              dispatch({ type: \"retry\" });\r\n              activate(connectionState.connector);\r\n            }}\r\n          >\r\n            <Text>Please check your wallet and accept the connection request before retrying.</Text>\r\n          </RetryDialog>\r\n        </Modal>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import { useState, useEffect } from \"react\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\n\r\nimport { injectedConnector } from \"../connectors/injectedConnector\";\r\n\r\n/**\r\n * React hook that tries to activate the InjectedConnector if the app's already authorized in the\r\n * browser's wallet (in the case of dApp-enabled browsers) or its wallet extension (e.g. MetaMask).\r\n *\r\n * Example: user has a browser with the MetaMask extension. MetaMask injects an Ethereum provider\r\n * into the window object. We check via InjectedConnector if our app is already authorized to use\r\n * the wallet through this provider, and in that case we try to activate the connector.\r\n *\r\n * @returns true when finished trying to activate the InjectedConnector, false otherwise\r\n */\r\n\r\nexport function useAuthorizedConnection(): boolean {\r\n  const { activate, active } = useWeb3React<unknown>();\r\n  const [tried, setTried] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const tryToActivateIfAuthorized = async () => {\r\n      try {\r\n        if (await injectedConnector.isAuthorized()) {\r\n          await activate(injectedConnector, undefined, true);\r\n        } else {\r\n          throw new Error(\"Unauthorized\");\r\n        }\r\n      } catch {\r\n        setTried(true);\r\n      }\r\n    };\r\n    tryToActivateIfAuthorized();\r\n  }, [activate]);\r\n\r\n  useEffect(() => {\r\n    if (active) {\r\n      setTried(true);\r\n    }\r\n  }, [active]);\r\n\r\n  return tried;\r\n}\r\n","import Tippy from \"@tippyjs/react\";\r\nimport type { TippyProps } from \"@tippyjs/react\";\r\nimport React from \"react\";\r\nimport { Box, Card, Link } from \"theme-ui\";\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport type TooltipProps = Pick<TippyProps, \"placement\"> & {\r\n  message: React.ReactNode;\r\n  link?: string;\r\n};\r\n\r\nexport type LearnMoreLinkProps = Pick<TooltipProps, \"link\">;\r\n\r\nexport const LearnMoreLink: React.FC<LearnMoreLinkProps> = ({ link }) => {\r\n  return (\r\n    <Link href={link} target=\"_blank\">\r\n      Learn more <Icon size=\"xs\" name=\"external-link-alt\" />\r\n    </Link>\r\n  );\r\n};\r\n\r\nexport const Tooltip: React.FC<TooltipProps> = ({ children, message, placement = \"top\", link }) => {\r\n  return (\r\n    <Tippy\r\n      interactive={true}\r\n      placement={placement}\r\n      content={\r\n        <Card variant=\"tooltip\">\r\n          {message}\r\n          {link && (\r\n            <Box mt={1}>\r\n              <LearnMoreLink link={link} />\r\n            </Box>\r\n          )}\r\n        </Card>\r\n      }\r\n    >\r\n      <span>{children}</span>\r\n    </Tippy>\r\n  );\r\n};\r\n","import { memo, useState, useEffect } from \"react\";\r\nimport { Flex, Box, Text, ThemeUIStyleObject } from \"theme-ui\";\r\nimport { CircularProgressbarWithChildren } from \"react-circular-progressbar\";\r\nimport { buildStyles } from \"react-circular-progressbar\";\r\nimport \"react-circular-progressbar/dist/styles.css\";\r\nimport { Icon } from \"./Icon\";\r\nimport type { TransactionState } from \"./Transaction\";\r\n\r\nconst strokeWidth = 10;\r\n\r\nconst circularProgressbarStyle = {\r\n  strokeLinecap: \"butt\",\r\n  pathColor: \"white\",\r\n  trailColor: \"rgba(255, 255, 255, 0.33)\"\r\n};\r\n\r\nconst slowProgress = {\r\n  strokeWidth,\r\n  styles: buildStyles({\r\n    ...circularProgressbarStyle,\r\n    pathTransitionDuration: 30\r\n  })\r\n};\r\n\r\nconst fastProgress = {\r\n  strokeWidth,\r\n  styles: buildStyles({\r\n    ...circularProgressbarStyle,\r\n    pathTransitionDuration: 0.75\r\n  })\r\n};\r\n\r\nexport type TransactionStateType = TransactionState[\"type\"];\r\n\r\nconst Donut = memo(\r\n  CircularProgressbarWithChildren,\r\n  ({ value: prev }, { value: next }) => prev === next\r\n);\r\n\r\ntype TransactionProgressDonutProps = {\r\n  state: TransactionStateType;\r\n};\r\n\r\nconst TransactionProgressDonut: React.FC<TransactionProgressDonutProps> = ({ state }) => {\r\n  const [value, setValue] = useState(0);\r\n  const maxValue = 1;\r\n\r\n  useEffect(() => {\r\n    if (state === \"confirmed\") {\r\n      setTimeout(() => setValue(maxValue), 40);\r\n    } else {\r\n      setTimeout(() => setValue(maxValue * 0.67), 20);\r\n    }\r\n  }, [state]);\r\n\r\n  return state === \"confirmed\" ? (\r\n    <Donut {...{ value, maxValue, ...fastProgress }}>\r\n      <Icon name=\"check\" color=\"white\" size=\"lg\" />\r\n    </Donut>\r\n  ) : state === \"failed\" || state === \"cancelled\" ? (\r\n    <Donut value={0} {...{ maxValue, ...fastProgress }}>\r\n      <Icon name=\"times\" color=\"white\" size=\"lg\" />\r\n    </Donut>\r\n  ) : (\r\n    <Donut {...{ value, maxValue, ...slowProgress }}>\r\n      <Icon name=\"cog\" color=\"white\" size=\"lg\" spin />\r\n    </Donut>\r\n  );\r\n};\r\n\r\ntype TransactionStatusProps = {\r\n  state: TransactionStateType;\r\n  message?: string;\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\nexport const TransactionStatus: React.FC<TransactionStatusProps> = ({ state, message, style }) => {\r\n  if (state === \"idle\" || state === \"waitingForApproval\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        alignItems: \"center\",\r\n        bg:\r\n          state === \"confirmed\"\r\n            ? \"success\"\r\n            : state === \"cancelled\"\r\n            ? \"warning\"\r\n            : state === \"failed\"\r\n            ? \"danger\"\r\n            : \"primary\",\r\n        p: 3,\r\n        pl: 4,\r\n        position: \"fixed\",\r\n        width: \"100vw\",\r\n        bottom: 0,\r\n        overflow: \"hidden\",\r\n        ...style\r\n      }}\r\n    >\r\n      <Box sx={{ mr: 3, width: \"40px\", height: \"40px\" }}>\r\n        <TransactionProgressDonut state={state} />\r\n      </Box>\r\n\r\n      <Text sx={{ fontSize: 3, color: \"white\" }}>\r\n        {state === \"waitingForConfirmation\"\r\n          ? \"Waiting for confirmation\"\r\n          : state === \"cancelled\"\r\n          ? \"Cancelled\"\r\n          : state === \"failed\"\r\n          ? message || \"Transaction failed. Please try again.\"\r\n          : \"Confirmed\"}\r\n      </Text>\r\n    </Flex>\r\n  );\r\n};\r\n","import React, { useState, useContext, useEffect, useCallback } from \"react\";\r\nimport { Provider, TransactionResponse, TransactionReceipt } from \"@ethersproject/abstract-provider\";\r\nimport { hexDataSlice, hexDataLength } from \"@ethersproject/bytes\";\r\nimport { defaultAbiCoder } from \"@ethersproject/abi\";\r\n\r\nimport \"react-circular-progressbar/dist/styles.css\";\r\n\r\nimport { EthersTransactionOverrides, EthersTransactionCancelledError } from \"@liquity/lib-ethers\";\r\nimport { SentLiquityTransaction, LiquityReceipt } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport type { TooltipProps } from \"./Tooltip\";\r\n\r\nimport { TransactionStatus } from \"./TransactionStatus\";\r\n\r\ntype TransactionIdle = {\r\n  type: \"idle\";\r\n};\r\n\r\ntype TransactionFailed = {\r\n  type: \"failed\";\r\n  id: string;\r\n  error: Error;\r\n};\r\n\r\ntype TransactionWaitingForApproval = {\r\n  type: \"waitingForApproval\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionCancelled = {\r\n  type: \"cancelled\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionWaitingForConfirmations = {\r\n  type: \"waitingForConfirmation\";\r\n  id: string;\r\n  tx: SentTransaction;\r\n};\r\n\r\ntype TransactionConfirmed = {\r\n  type: \"confirmed\";\r\n  id: string;\r\n};\r\n\r\ntype TransactionConfirmedOneShot = {\r\n  type: \"confirmedOneShot\";\r\n  id: string;\r\n};\r\n\r\nexport type TransactionState =\r\n  | TransactionIdle\r\n  | TransactionFailed\r\n  | TransactionWaitingForApproval\r\n  | TransactionCancelled\r\n  | TransactionWaitingForConfirmations\r\n  | TransactionConfirmed\r\n  | TransactionConfirmedOneShot;\r\n\r\nconst TransactionContext = React.createContext<\r\n  [TransactionState, (state: TransactionState) => void] | undefined\r\n>(undefined);\r\n\r\nexport const TransactionProvider: React.FC = ({ children }) => {\r\n  const transactionState = useState<TransactionState>({ type: \"idle\" });\r\n  return (\r\n    <TransactionContext.Provider value={transactionState}>{children}</TransactionContext.Provider>\r\n  );\r\n};\r\n\r\nconst useTransactionState = () => {\r\n  const transactionState = useContext(TransactionContext);\r\n\r\n  if (!transactionState) {\r\n    throw new Error(\"You must provide a TransactionContext via TransactionProvider\");\r\n  }\r\n\r\n  return transactionState;\r\n};\r\n\r\nexport const useMyTransactionState = (myId: string | RegExp): TransactionState => {\r\n  const [transactionState] = useTransactionState();\r\n\r\n  return transactionState.type !== \"idle\" &&\r\n    (typeof myId === \"string\" ? transactionState.id === myId : transactionState.id.match(myId))\r\n    ? transactionState\r\n    : { type: \"idle\" };\r\n};\r\n\r\nconst hasMessage = (error: unknown): error is { message: string } =>\r\n  typeof error === \"object\" &&\r\n  error !== null &&\r\n  \"message\" in error &&\r\n  typeof (error as { message: unknown }).message === \"string\";\r\n\r\ntype ButtonlikeProps = {\r\n  disabled?: boolean;\r\n  variant?: string;\r\n  onClick?: () => void;\r\n};\r\n\r\ntype SentTransaction = SentLiquityTransaction<\r\n  TransactionResponse,\r\n  LiquityReceipt<TransactionReceipt>\r\n>;\r\n\r\nexport type TransactionFunction = (\r\n  overrides?: EthersTransactionOverrides\r\n) => Promise<SentTransaction>;\r\n\r\ntype TransactionProps<C> = {\r\n  id: string;\r\n  tooltip?: string;\r\n  tooltipPlacement?: TooltipProps[\"placement\"];\r\n  showFailure?: \"asTooltip\" | \"asChildText\";\r\n  requires?: readonly (readonly [boolean, string])[];\r\n  send: TransactionFunction;\r\n  children: C;\r\n};\r\n\r\nexport const useTransactionFunction = (\r\n  id: string,\r\n  send: TransactionFunction\r\n): [sendTransaction: () => Promise<void>, transactionState: TransactionState] => {\r\n  const [transactionState, setTransactionState] = useTransactionState();\r\n\r\n  const sendTransaction = useCallback(async () => {\r\n    setTransactionState({ type: \"waitingForApproval\", id });\r\n\r\n    try {\r\n      const tx = await send();\r\n\r\n      setTransactionState({\r\n        type: \"waitingForConfirmation\",\r\n        id,\r\n        tx\r\n      });\r\n    } catch (error) {\r\n      if (hasMessage(error) && error.message.includes(\"User denied transaction signature\")) {\r\n        setTransactionState({ type: \"cancelled\", id });\r\n      } else {\r\n        console.error(error);\r\n\r\n        setTransactionState({\r\n          type: \"failed\",\r\n          id,\r\n          error: new Error(\"Failed to send transaction (try again)\")\r\n        });\r\n      }\r\n    }\r\n  }, [send, id, setTransactionState]);\r\n\r\n  return [sendTransaction, transactionState];\r\n};\r\n\r\nexport function Transaction<C extends React.ReactElement<ButtonlikeProps>>({\r\n  id,\r\n  tooltip,\r\n  tooltipPlacement,\r\n  showFailure,\r\n  requires,\r\n  send,\r\n  children\r\n}: TransactionProps<C>) {\r\n  const [sendTransaction, transactionState] = useTransactionFunction(id, send);\r\n  const trigger = React.Children.only<C>(children);\r\n\r\n  const failureReasons = (requires || [])\r\n    .filter(([requirement]) => !requirement)\r\n    .map(([, reason]) => reason);\r\n\r\n  if (\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\"\r\n  ) {\r\n    failureReasons.push(\"You must wait for confirmation\");\r\n  }\r\n\r\n  showFailure =\r\n    failureReasons.length > 0 ? showFailure ?? (tooltip ? \"asTooltip\" : \"asChildText\") : undefined;\r\n\r\n  const clonedTrigger =\r\n    showFailure === \"asChildText\"\r\n      ? React.cloneElement(\r\n          trigger,\r\n          {\r\n            disabled: true,\r\n            variant: \"danger\"\r\n          },\r\n          failureReasons[0]\r\n        )\r\n      : showFailure === \"asTooltip\"\r\n      ? React.cloneElement(trigger, { disabled: true })\r\n      : React.cloneElement(trigger, { onClick: sendTransaction });\r\n\r\n  if (showFailure === \"asTooltip\") {\r\n    tooltip = failureReasons[0];\r\n  }\r\n\r\n  return tooltip ? (\r\n    <>\r\n      <Tooltip message={tooltip} placement={tooltipPlacement || \"right\"}>\r\n        {clonedTrigger}\r\n      </Tooltip>\r\n    </>\r\n  ) : (\r\n    clonedTrigger\r\n  );\r\n}\r\n\r\n// Doesn't work on Kovan:\r\n// https://github.com/MetaMask/metamask-extension/issues/5579\r\nconst tryToGetRevertReason = async (provider: Provider, tx: TransactionReceipt) => {\r\n  try {\r\n    const result = await provider.call(tx, tx.blockNumber);\r\n\r\n    if (hexDataLength(result) % 32 === 4 && hexDataSlice(result, 0, 4) === \"0x08c379a0\") {\r\n      return (defaultAbiCoder.decode([\"string\"], hexDataSlice(result, 4)) as [string])[0];\r\n    }\r\n  } catch {\r\n    return undefined;\r\n  }\r\n};\r\n\r\nexport const TransactionMonitor: React.FC = () => {\r\n  const { provider } = useLiquity();\r\n  const [transactionState, setTransactionState] = useTransactionState();\r\n\r\n  const id = transactionState.type !== \"idle\" ? transactionState.id : undefined;\r\n  const tx = transactionState.type === \"waitingForConfirmation\" ? transactionState.tx : undefined;\r\n\r\n  useEffect(() => {\r\n    if (id && tx) {\r\n      let cancelled = false;\r\n      let finished = false;\r\n\r\n      const txHash = tx.rawSentTransaction.hash;\r\n\r\n      const waitForConfirmation = async () => {\r\n        try {\r\n          const receipt = await tx.waitForReceipt();\r\n\r\n          if (cancelled) {\r\n            return;\r\n          }\r\n\r\n          const { confirmations } = receipt.rawReceipt;\r\n          const blockNumber = receipt.rawReceipt.blockNumber + confirmations - 1;\r\n          console.log(`Block #${blockNumber} ${confirmations}-confirms tx ${txHash}`);\r\n          console.log(`Finish monitoring tx ${txHash}`);\r\n          finished = true;\r\n\r\n          if (receipt.status === \"succeeded\") {\r\n            console.log(`${receipt}`);\r\n\r\n            setTransactionState({\r\n              type: \"confirmedOneShot\",\r\n              id\r\n            });\r\n          } else {\r\n            const reason = await tryToGetRevertReason(provider, receipt.rawReceipt);\r\n\r\n            if (cancelled) {\r\n              return;\r\n            }\r\n\r\n            console.error(`Tx ${txHash} failed`);\r\n            if (reason) {\r\n              console.error(`Revert reason: ${reason}`);\r\n            }\r\n\r\n            setTransactionState({\r\n              type: \"failed\",\r\n              id,\r\n              error: new Error(reason ? `Reverted: ${reason}` : \"Failed\")\r\n            });\r\n          }\r\n        } catch (rawError) {\r\n          if (cancelled) {\r\n            return;\r\n          }\r\n\r\n          finished = true;\r\n\r\n          if (rawError instanceof EthersTransactionCancelledError) {\r\n            console.log(`Cancelled tx ${txHash}`);\r\n            setTransactionState({ type: \"cancelled\", id });\r\n          } else {\r\n            console.error(`Failed to get receipt for tx ${txHash}`);\r\n            console.error(rawError);\r\n\r\n            setTransactionState({\r\n              type: \"failed\",\r\n              id,\r\n              error: new Error(\"Failed\")\r\n            });\r\n          }\r\n        }\r\n      };\r\n\r\n      console.log(`Start monitoring tx ${txHash}`);\r\n      waitForConfirmation();\r\n\r\n      return () => {\r\n        if (!finished) {\r\n          setTransactionState({ type: \"idle\" });\r\n          console.log(`Cancel monitoring tx ${txHash}`);\r\n          cancelled = true;\r\n        }\r\n      };\r\n    }\r\n  }, [provider, id, tx, setTransactionState]);\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\" && id) {\r\n      // hack: the txn confirmed state lasts 5 seconds which blocks other states, review with Dani\r\n      setTransactionState({ type: \"confirmed\", id });\r\n    } else if (\r\n      transactionState.type === \"confirmed\" ||\r\n      transactionState.type === \"failed\" ||\r\n      transactionState.type === \"cancelled\"\r\n    ) {\r\n      let cancelled = false;\r\n\r\n      setTimeout(() => {\r\n        if (!cancelled) {\r\n          setTransactionState({ type: \"idle\" });\r\n        }\r\n      }, 5000);\r\n\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n  }, [transactionState.type, setTransactionState, id]);\r\n\r\n  if (transactionState.type === \"idle\" || transactionState.type === \"waitingForApproval\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <TransactionStatus\r\n      state={transactionState.type}\r\n      message={transactionState.type === \"failed\" ? transactionState.error.message : undefined}\r\n    />\r\n  );\r\n};\r\n","import { Theme, ThemeUIStyleObject } from \"theme-ui\";\r\n\r\nconst baseColors = {\r\n  blue: \"#1542cd\",\r\n  purple: \"#745ddf\",\r\n  cyan: \"#2eb6ea\",\r\n  green: \"#28c081\",\r\n  yellow: \"#fd9d28\",\r\n  red: \"#dc2c10\",\r\n  lightRed: \"#ff755f\"\r\n};\r\n\r\nconst colors = {\r\n  primary: baseColors.blue,\r\n  secondary: baseColors.purple,\r\n  accent: baseColors.cyan,\r\n\r\n  success: baseColors.green,\r\n  warning: baseColors.yellow,\r\n  danger: baseColors.red,\r\n  dangerHover: baseColors.lightRed,\r\n  info: baseColors.blue,\r\n  invalid: \"pink\",\r\n\r\n  text: \"#293147\",\r\n  background: \"white\",\r\n  muted: \"#eaebed\",\r\n  highlight: \"#efeffe\"\r\n};\r\n\r\nconst buttonBase: ThemeUIStyleObject = {\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"center\",\r\n\r\n  \":enabled\": { cursor: \"pointer\" }\r\n};\r\n\r\nconst button: ThemeUIStyleObject = {\r\n  ...buttonBase,\r\n\r\n  px: \"32px\",\r\n  py: \"12px\",\r\n\r\n  color: \"white\",\r\n  border: 1,\r\n\r\n  fontWeight: \"bold\",\r\n\r\n  \":disabled\": {\r\n    opacity: 0.5\r\n  }\r\n};\r\n\r\nconst buttonOutline = (color: string, hoverColor: string): ThemeUIStyleObject => ({\r\n  color,\r\n  borderColor: color,\r\n  background: \"none\",\r\n\r\n  \":enabled:hover\": {\r\n    color: \"background\",\r\n    bg: hoverColor,\r\n    borderColor: hoverColor\r\n  }\r\n});\r\n\r\nconst iconButton: ThemeUIStyleObject = {\r\n  ...buttonBase,\r\n\r\n  padding: 0,\r\n  width: \"40px\",\r\n  height: \"40px\",\r\n\r\n  background: \"none\",\r\n\r\n  \":disabled\": {\r\n    color: \"text\",\r\n    opacity: 0.25\r\n  }\r\n};\r\n\r\nconst cardHeadingFontSize = 18.7167;\r\n\r\nconst cardGapX = [0, 3, 4];\r\nconst cardGapY = [3, 3, 4];\r\n\r\nconst card: ThemeUIStyleObject = {\r\n  position: \"relative\",\r\n  mt: cardGapY,\r\n  border: 1,\r\n  boxShadow: [1, null, 2]\r\n};\r\n\r\nconst infoCard: ThemeUIStyleObject = {\r\n  ...card,\r\n\r\n  padding: 3,\r\n\r\n  borderColor: \"rgba(122,199,240,0.4)\",\r\n  background: \"linear-gradient(200deg, #d4d9fc, #cae9f9)\",\r\n\r\n  h2: {\r\n    mb: 2,\r\n    fontSize: cardHeadingFontSize\r\n  }\r\n};\r\n\r\nconst formBase: ThemeUIStyleObject = {\r\n  display: \"block\",\r\n  width: \"auto\",\r\n  flexShrink: 0,\r\n  padding: 2,\r\n  fontSize: 3\r\n};\r\n\r\nconst formCell: ThemeUIStyleObject = {\r\n  ...formBase,\r\n\r\n  bg: \"background\",\r\n  border: 1,\r\n  borderColor: \"muted\",\r\n  borderRadius: 0,\r\n  boxShadow: [1, 2]\r\n};\r\n\r\nconst overlay: ThemeUIStyleObject = {\r\n  position: \"absolute\",\r\n\r\n  left: 0,\r\n  top: 0,\r\n  width: \"100%\",\r\n  height: \"100%\"\r\n};\r\n\r\nconst modalOverlay: ThemeUIStyleObject = {\r\n  position: \"fixed\",\r\n\r\n  left: 0,\r\n  top: 0,\r\n  width: \"100vw\",\r\n  height: \"100vh\"\r\n};\r\n\r\nconst headerGradient: ThemeUIStyleObject = {\r\n  background: `linear-gradient(90deg, ${colors.background}, ${colors.muted})`\r\n};\r\n\r\nconst theme: Theme = {\r\n  breakpoints: [\"48em\", \"52em\", \"64em\"],\r\n\r\n  space: [0, 4, 8, 16, 32, 64, 128, 256, 512],\r\n\r\n  fonts: {\r\n    body: [\r\n      \"system-ui\",\r\n      \"-apple-system\",\r\n      \"BlinkMacSystemFont\",\r\n      '\"Segoe UI\"',\r\n      \"Roboto\",\r\n      '\"Helvetica Neue\"',\r\n      \"sans-serif\"\r\n    ].join(\", \"),\r\n    heading: \"inherit\",\r\n    monospace: \"Menlo, monospace\"\r\n  },\r\n\r\n  fontSizes: [12, 14, 16, 20, 24, 32, 48, 64, 96],\r\n\r\n  fontWeights: {\r\n    body: 400,\r\n    heading: 600,\r\n\r\n    light: 200,\r\n    medium: 500,\r\n    bold: 600\r\n  },\r\n\r\n  lineHeights: {\r\n    body: 1.5,\r\n    heading: 1.25\r\n  },\r\n\r\n  colors,\r\n\r\n  borders: [0, \"1px solid\", \"2px solid\"],\r\n\r\n  shadows: [\"0\", \"0px 4px 8px rgba(41, 49, 71, 0.1)\", \"0px 8px 16px rgba(41, 49, 71, 0.1)\"],\r\n\r\n  text: {\r\n    address: {\r\n      fontFamily: \"monospace\",\r\n      fontSize: 1\r\n    }\r\n  },\r\n\r\n  buttons: {\r\n    primary: {\r\n      ...button,\r\n\r\n      bg: \"primary\",\r\n      borderColor: \"primary\",\r\n\r\n      \":enabled:hover\": {\r\n        bg: \"secondary\",\r\n        borderColor: \"secondary\"\r\n      }\r\n    },\r\n\r\n    outline: {\r\n      ...button,\r\n      ...buttonOutline(\"primary\", \"secondary\")\r\n    },\r\n\r\n    cancel: {\r\n      ...button,\r\n      ...buttonOutline(\"text\", \"text\"),\r\n\r\n      opacity: 0.8\r\n    },\r\n\r\n    danger: {\r\n      ...button,\r\n\r\n      bg: \"danger\",\r\n      borderColor: \"danger\",\r\n\r\n      \":enabled:hover\": {\r\n        bg: \"dangerHover\",\r\n        borderColor: \"dangerHover\"\r\n      }\r\n    },\r\n\r\n    icon: {\r\n      ...iconButton,\r\n      color: \"primary\",\r\n      \":enabled:hover\": { color: \"accent\" }\r\n    },\r\n\r\n    dangerIcon: {\r\n      ...iconButton,\r\n      color: \"danger\",\r\n      \":enabled:hover\": { color: \"dangerHover\" }\r\n    },\r\n\r\n    titleIcon: {\r\n      ...iconButton,\r\n      color: \"text\",\r\n      \":enabled:hover\": { color: \"success\" }\r\n    },\r\n\r\n    close: {\r\n      cursor: \"pointer\"\r\n    }\r\n  },\r\n\r\n  cards: {\r\n    primary: {\r\n      ...card,\r\n\r\n      padding: 0,\r\n\r\n      borderColor: \"muted\",\r\n      bg: \"background\",\r\n\r\n      \"> h2\": {\r\n        display: \"flex\",\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n\r\n        height: \"56px\",\r\n\r\n        pl: 3,\r\n        py: 2,\r\n        pr: 2,\r\n\r\n        bg: \"muted\",\r\n\r\n        fontSize: cardHeadingFontSize\r\n      }\r\n    },\r\n\r\n    info: {\r\n      ...infoCard,\r\n\r\n      display: [\"none\", \"block\"]\r\n    },\r\n\r\n    infoPopup: {\r\n      ...infoCard,\r\n\r\n      position: \"fixed\",\r\n      top: 0,\r\n      right: 3,\r\n      left: 3,\r\n      mt: \"72px\",\r\n      height: \"80%\",\r\n      overflowY: \"scroll\"\r\n    },\r\n\r\n    tooltip: {\r\n      fontWeight: \"body\",\r\n      marginY: 1,\r\n\r\n      a: {\r\n        color: \"accent\",\r\n        \":hover\": {\r\n          opacity: 0.8\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  forms: {\r\n    label: {\r\n      ...formBase\r\n    },\r\n\r\n    radioLabel: {\r\n      mr: 4,\r\n      width: \"unset\",\r\n\r\n      svg: {\r\n        mr: 1\r\n      }\r\n    },\r\n\r\n    unit: {\r\n      ...formCell,\r\n\r\n      textAlign: \"center\",\r\n      bg: \"muted\"\r\n    },\r\n\r\n    input: {\r\n      ...formCell,\r\n\r\n      flex: 1\r\n    },\r\n\r\n    editor: {}\r\n  },\r\n\r\n  layout: {\r\n    header: {\r\n      display: \"flex\",\r\n      justifyContent: \"space-between\",\r\n      alignItems: \"stretch\",\r\n\r\n      position: [\"fixed\", \"relative\"],\r\n      top: 0,\r\n      zIndex: 1,\r\n\r\n      px: [2, \"12px\", \"12px\", 5],\r\n      py: [2, \"12px\", \"12px\"],\r\n\r\n      ...headerGradient,\r\n      boxShadow: [1, \"none\"]\r\n    },\r\n\r\n    footer: {\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n\r\n      mt: cardGapY,\r\n      px: 3,\r\n      minHeight: \"72px\",\r\n\r\n      bg: \"muted\"\r\n    },\r\n\r\n    main: {\r\n      width: \"100%\",\r\n      maxWidth: \"1280px\",\r\n      mx: \"auto\",\r\n      mt: [\"40px\", 0],\r\n      mb: [\"40px\", \"40px\"],\r\n      px: cardGapX\r\n    },\r\n\r\n    columns: {\r\n      display: \"flex\",\r\n      flexWrap: \"wrap\",\r\n      justifyItems: \"center\"\r\n    },\r\n\r\n    left: {\r\n      pr: cardGapX,\r\n      width: [\"100%\", \"58%\"]\r\n    },\r\n\r\n    right: {\r\n      width: [\"100%\", \"42%\"]\r\n    },\r\n\r\n    actions: {\r\n      justifyContent: \"flex-end\",\r\n      mt: 2,\r\n\r\n      button: {\r\n        ml: 2\r\n      }\r\n    },\r\n\r\n    disabledOverlay: {\r\n      ...overlay,\r\n\r\n      bg: \"rgba(255, 255, 255, 0.5)\"\r\n    },\r\n\r\n    modalOverlay: {\r\n      ...modalOverlay,\r\n\r\n      bg: \"rgba(0, 0, 0, 0.8)\",\r\n\r\n      display: \"flex\",\r\n      justifyContent: \"center\",\r\n      alignItems: \"center\"\r\n    },\r\n\r\n    modal: {\r\n      padding: 3,\r\n      width: [\"100%\", \"40em\"]\r\n    },\r\n\r\n    infoOverlay: {\r\n      ...modalOverlay,\r\n\r\n      display: [\"block\", \"none\"],\r\n\r\n      bg: \"rgba(255, 255, 255, 0.8)\"\r\n    },\r\n\r\n    infoMessage: {\r\n      display: \"flex\",\r\n      justifyContent: \"center\",\r\n      m: 3,\r\n      alignItems: \"center\",\r\n      minWidth: \"128px\"\r\n    },\r\n\r\n    sidenav: {\r\n      display: [\"flex\", \"none\"],\r\n      flexDirection: \"column\",\r\n      p: 0,\r\n      m: 0,\r\n      borderColor: \"muted\",\r\n      mr: \"25vw\",\r\n      height: \"100%\",\r\n      ...headerGradient\r\n    },\r\n\r\n    badge: {\r\n      border: 0,\r\n      borderRadius: 3,\r\n      p: 1,\r\n      px: 2,\r\n      backgroundColor: \"muted\",\r\n      color: \"slate\",\r\n      fontSize: 1,\r\n      fontWeight: \"body\"\r\n    }\r\n  },\r\n\r\n  styles: {\r\n    root: {\r\n      fontFamily: \"body\",\r\n      lineHeight: \"body\",\r\n      fontWeight: \"body\",\r\n\r\n      height: \"100%\",\r\n\r\n      \"#root\": {\r\n        height: \"100%\"\r\n      }\r\n    },\r\n\r\n    a: {\r\n      color: \"primary\",\r\n      \":hover\": { color: \"accent\" },\r\n      textDecoration: \"none\",\r\n      fontWeight: \"bold\"\r\n    },\r\n\r\n    progress: {\r\n      color: colors.success\r\n    }\r\n  },\r\n\r\n  links: {\r\n    nav: {\r\n      px: 2,\r\n      py: 1,\r\n      fontWeight: \"medium\",\r\n      fontSize: 2,\r\n      textTransform: \"uppercase\",\r\n      letterSpacing: \"2px\",\r\n      width: [\"100%\", \"auto\"],\r\n      mt: [3, \"auto\"]\r\n    }\r\n  }\r\n};\r\n\r\nexport default theme;\r\n","export const COIN = \"LUSD\";\r\nexport const GT = \"LQTY\";\r\nexport const LP = \"UNI LP\";\r\n// export const LP = \"ETH/LUSD LP\";\r\n","export const shortenAddress = (address: string) => address.substr(0, 6) + \"...\" + address.substr(-4);\r\n","import type { Lexicon } from \"../../lexicon\";\r\n\r\nexport const PENDING_BONDS: Lexicon = {\r\n  term: \"Pending bonds\",\r\n  description: \"Your active bonds which are accruing bLUSD and can be claimed or cancelled.\"\r\n};\r\n\r\nexport const BONDS: Lexicon = {\r\n  term: \"Bonds\",\r\n  description: \"List of your pending bonds and bonds you have claimed or cancelled in the past.\"\r\n};\r\n\r\nexport const NOT_BONDED_YET: Lexicon = {\r\n  term: \"You don't have any pending bonds.\",\r\n  description:\r\n    \"You can bond LUSD to obtain Boosted LUSD (bLUSD) - a yield-amplified version of LUSD.\"\r\n};\r\n\r\nexport const BONDS_NAVIGATION: Lexicon = {\r\n  term: \"Bonds\"\r\n};\r\n\r\nexport const BOND_CREATED: Lexicon = {\r\n  term: \"Bond created\",\r\n  description:\r\n    \"The date you created your bond. The bLUSD accrual starts at 0 and increases over time.\"\r\n};\r\n\r\nexport const AVAILABLE_BONDS: Lexicon = {\r\n  term: \"Available bonds\",\r\n  description: \"The types of bonds you can create.\"\r\n};\r\n\r\nexport const BOND_ASSET: Lexicon = {\r\n  term: \"Asset\",\r\n  description: \"The type of token accepted for bonding.\"\r\n};\r\n\r\nexport const BOND_NFT: Lexicon = {\r\n  term: \"NFT\",\r\n  description:\r\n    \"Bonds are represented as unique visual NFTs. The NFT image evolves when your bond is claimed or cancelled.\"\r\n};\r\n\r\nexport const BREAK_EVEN_TIME: Lexicon = {\r\n  term: \"Break-even time\",\r\n  description:\r\n    \"Estimated time at which the bond will have accrued enough bLUSD to offset the LUSD cost of the bond, under current market prices.\"\r\n};\r\n\r\nexport const OPTIMUM_REBOND_TIME: Lexicon = {\r\n  term: \"Rebond time\",\r\n  description:\r\n    \"Estimated optimum time to claim the bond, sell the bLUSD for LUSD, and then bond again, to maximize your return under current market prices.\"\r\n};\r\n\r\nexport const REBOND_RETURN: Lexicon = {\r\n  term: `${OPTIMUM_REBOND_TIME.term} return`,\r\n  description: `Estimated return from selling your accrued bLUSD to LUSD at the ${OPTIMUM_REBOND_TIME.term}, minus the initial LUSD cost of the bond, under current market prices.`\r\n};\r\n\r\nexport const REBOND_TIME_ROI: Lexicon = {\r\n  term: `${OPTIMUM_REBOND_TIME.term} ROI`,\r\n  description: `Estimated ROI of selling your accrued bLUSD to LUSD at the ${OPTIMUM_REBOND_TIME.term}, minus the initial LUSD cost of the bond, under current market prices.`\r\n};\r\n\r\nexport const OPTIMUM_APY: Lexicon = {\r\n  term: \"Max APR\",\r\n  description: `Estimated APY of continuously bonding and claiming at the ${OPTIMUM_REBOND_TIME.term}, under current market prices. Rebonding at other times could lead to a lower APY.`\r\n};\r\n\r\nexport const OPTIMUM_ACCRUAL: Lexicon = {\r\n  term: \"Rebond accrual\",\r\n  description: `The required amount of bLUSD to accrue for the ${OPTIMUM_REBOND_TIME.term}, under current market prices.`,\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_44lrt4qpho3a\"\r\n};\r\n\r\nexport const BOND_DEPOSIT: Lexicon = {\r\n  term: \"Deposit\",\r\n  description:\r\n    \"The amount deposited into the bond, which can be fully recovered by cancelling the bond.\"\r\n};\r\n\r\nexport const ACCRUED_AMOUNT: Lexicon = {\r\n  term: \"Accruing\",\r\n  description: \"The amount of bLUSD this bond has accrued so far.\"\r\n};\r\n\r\nexport const MARKET_VALUE: Lexicon = {\r\n  term: \"Accrued value\",\r\n  description:\r\n    \"Current market value of the accrued bLUSD. The bLUSD market price can fluctuate but will always be higher than the floor price under rational market conditions.\"\r\n};\r\n\r\nexport const BOND_AGE: Lexicon = {\r\n  term: \"Age\",\r\n  description: \"Time elapsed since the creation of the bond.\"\r\n};\r\n\r\nexport const BOND_RETURN: Lexicon = {\r\n  term: \"Claim-now return\",\r\n  description:\r\n    \"Expected LUSD gained from claiming the bond now and selling the bLUSD for LUSD and deducting the initial cost of the bond, under current market prices.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_44lrt4qpho3a\"\r\n};\r\n\r\nexport const BOND_STATUS: Lexicon = {\r\n  term: \"Status\",\r\n  description: \"One of three values: Pending, Cancelled, or Claimed.\"\r\n};\r\n\r\nexport const PENDING_STATUS: Lexicon = {\r\n  term: \"Pending\",\r\n  description: \"An active bond which is accruding bLUSD and can be cancelled or claimed.\"\r\n};\r\n\r\nexport const CANCELLED_STATUS: Lexicon = {\r\n  term: \"Cancelled\",\r\n  description: \"A bond which you cancelled.\"\r\n};\r\n\r\nexport const CLAIMED_STATUS: Lexicon = {\r\n  term: \"Claimed\",\r\n  description: \"A bond which you claimed.\"\r\n};\r\n\r\nexport const CANCEL_BOND: Lexicon = {\r\n  term: \"Cancel bond\",\r\n  description:\r\n    \"A bond can be cancelled at any time to recover the initially deposited LUSD amount while forgoing the accrued bLUSD.\",\r\n  link: \"https://docs.chickenbonds.org/faq/basic-usage#_rwpo6dhx26fq\"\r\n};\r\n\r\nexport const CLAIM_BOND: Lexicon = {\r\n  term: \"Claim bond\",\r\n  description:\r\n    \"A bond can be claimed at any time to forgo the initially deposited LUSD amount and gain the accrued bLUSD.\",\r\n  link: \"https://docs.chickenbonds.org/faq/basic-usage#_2c022erjceom\"\r\n};\r\n\r\nexport const BLUSD_MARKET_PRICE: Lexicon = {\r\n  term: \"Market price\",\r\n  description: \"The current price of bLUSD according to the bLUSD Curve pool.\"\r\n};\r\n\r\nexport const BLUSD_FAIR_PRICE: Lexicon = {\r\n  term: \"Fair price\",\r\n  description:\r\n    \"An estimated range of the market price of bLUSD based on the current yield amplification. The lower bound excludes the Pending bucket, the upper bound factors all buckets.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#how-is-the-fair-price-calculated\"\r\n};\r\n\r\nexport const TOTAL_BONDS_STATISTIC: Lexicon = {\r\n  term: \"Total bonds\",\r\n  description: \"The total number of bonds including: cancelled, claimed and pending.\"\r\n};\r\n\r\nexport const PENDING_BONDS_STATISTIC: Lexicon = {\r\n  term: \"Pending bonds\",\r\n  description:\r\n    \"The current number of active bonds in the system which are not yet claimed or cancelled.\"\r\n};\r\n\r\nexport const CANCELLED_BONDS_STATISTIC: Lexicon = {\r\n  term: \"Cancelled bonds\",\r\n  description: \"The total number of bonds which were cancelled.\"\r\n};\r\n\r\nexport const CLAIMED_BONDS_STATISTIC: Lexicon = {\r\n  term: \"Claimed bonds\",\r\n  description: \"The total number of bonds which were claimed.\"\r\n};\r\n\r\nexport const BLUSD_SUPPLY: Lexicon = {\r\n  term: \"Total supply\",\r\n  description: \"The total amount of bLUSD in circulation. Not including pending bonds accrued bLUSD.\"\r\n};\r\n\r\nexport const BLUSD_FLOOR_PRICE: Lexicon = {\r\n  term: \"Floor price\",\r\n  description:\r\n    \"The amount of LUSD that an arbitrageur could redeem bLUSD for thus creating a lower bound bLUSD market price.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_c2c3valbf2bj-1\"\r\n};\r\n\r\nexport const BLUSD_WIND_DOWN_PRICE: Lexicon = {\r\n  term: \"Net asset value\",\r\n  description:\r\n    \"The protocol supports a graceful wind down mechanism for migration purposes, whereby Yearn Finance governance can trigger a special function which moves the Permanent bucket LUSD into the Reserve, thus enabling all bLUSD to be redeemed for a higher floor price.\",\r\n  link:\r\n    \"https://docs.chickenbonds.org/faq/potential-future-system-migration#what-is-the-wind-down-functionality\"\r\n};\r\n\r\nexport const BLUSD_APR: Lexicon = {\r\n  term: \"bLUSD APR\",\r\n  description: \"The APR of bLUSD, based on the yield generated from each bucket in the Treasury.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_c2c3valbf2bj\"\r\n};\r\n\r\nexport const BLUSD_LP_APR: Lexicon = {\r\n  term: \"LP APR\",\r\n  description:\r\n    \"The APR from providing liquidity to the bLUSD/LUSD-3CRV pool. A combination of LUSD rewards from Chicken-in fees and Curve rewards.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_1qcmo1v5zahs\"\r\n};\r\n\r\nexport const BLUSD_YIELD_AMPLIFICATION: Lexicon = {\r\n  term: \"Yield amplification\",\r\n  description:\r\n    \"The bLUSD token generates a yield which is a multiple of the Stability Pool yield. It is derived from the total protocol yield which is being diverted to the Reserve bucket.\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#yield-amplification\"\r\n};\r\n\r\nexport const TREASURY_TOTAL: Lexicon = {\r\n  term: \"Total\",\r\n  description:\r\n    \"The total amount of LUSD held by the protocol within the three buckets (Pending, Reserve, Permanent).\",\r\n  link: \"https://docs.chickenbonds.org/faq/technical-design#_ydtvzh456fiz\"\r\n};\r\n\r\nexport const TREASURY_PENDING: Lexicon = {\r\n  term: \"Pending\",\r\n  description:\r\n    \"Contains the deposited LUSD of the users while they bond. Pending bonds can be claimed or cancelled any time, moving the LUSD into the Reserve and Permanent buckets, or back to the bonder, respectively.\",\r\n  link: \"https://docs.chickenbonds.org/faq/technical-design#_ydtvzh456fiz\"\r\n};\r\n\r\nexport const TREASURY_ACQUIRED: Lexicon = {\r\n  term: \"Reserve\",\r\n  description:\r\n    \"Contains a portion of the LUSD obtained from claimed bonds and captures the yield from the entire Treasury. It acts as a reserve backing the bLUSD supply. bLUSD can be redeemed for a pro-rata share of the LUSD held in the Reserve bucket.\",\r\n  link: \"https://docs.chickenbonds.org/faq/technical-design#_ydtvzh456fiz\"\r\n};\r\n\r\nexport const TREASURY_PERMANENT: Lexicon = {\r\n  term: \"Permanent\",\r\n  description:\r\n    \"Contains a portion of the LUSD obtained from claimed bonds which contributes a permanent price premium over LUSD. The LUSD in this bucket is not redeemable.\",\r\n  link: \"https://docs.chickenbonds.org/faq/technical-design#_ydtvzh456fiz\"\r\n};\r\n\r\nexport const ESTIMATES_ONLY_NOTICE = {\r\n  description: \"These metrics are estimations based on the current bLUSD market price\",\r\n  link: \"https://docs.chickenbonds.org/faq/economic-design#_lnta1xbq350e\"\r\n};\r\n\r\nexport const INFINITE_ESTIMATION = {\r\n  description:\r\n    \"The bLUSD market price premium is currently too low to make bonding profitable. Bonds will be profitable again if the premium returns. Buying bLUSD from the market currently generates a higher return than bonding.\",\r\n  link:\r\n    \"https://docs.chickenbonds.org/faq/basic-usage#what-should-the-market-price-be-in-order-for-bonding-to-be-profitable\"\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type {\r\n  BondView,\r\n  BondEvent,\r\n  Payload,\r\n  Bond,\r\n  Stats,\r\n  BondTransactionStatuses,\r\n  ProtocolInfo,\r\n  OptimisticBond,\r\n  BLusdAmmTokenIndex,\r\n  Addresses,\r\n  BLusdLpRewards\r\n} from \"./transitions\";\r\nimport { PENDING_STATUS, CANCELLED_STATUS, CLAIMED_STATUS } from \"../lexicon\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nexport type BondViewContextType = {\r\n  view: BondView;\r\n  dispatchEvent: (event: BondEvent, payload?: Payload) => void;\r\n  selectedBondId?: string;\r\n  protocolInfo?: ProtocolInfo;\r\n  stats?: Stats;\r\n  bonds?: Bond[];\r\n  selectedBond?: Bond;\r\n  optimisticBond?: OptimisticBond;\r\n  bLusdBalance?: Decimal;\r\n  lusdBalance?: Decimal;\r\n  lpTokenBalance?: Decimal;\r\n  stakedLpTokenBalance?: Decimal;\r\n  lpTokenSupply?: Decimal;\r\n  bLusdAmmBLusdBalance?: Decimal;\r\n  bLusdAmmLusdBalance?: Decimal;\r\n  statuses: BondTransactionStatuses;\r\n  isSynchronizing: boolean;\r\n  getLusdFromFaucet: () => Promise<void>;\r\n  simulatedProtocolInfo?: ProtocolInfo;\r\n  setSimulatedMarketPrice: (marketPrice: Decimal) => void;\r\n  resetSimulatedMarketPrice: () => void;\r\n  hasFoundContracts: boolean;\r\n  isBLusdApprovedWithBlusdAmm: boolean;\r\n  isLusdApprovedWithBlusdAmm: boolean;\r\n  isLusdApprovedWithAmmZapper: boolean;\r\n  isBLusdApprovedWithAmmZapper: boolean;\r\n  isBLusdLpApprovedWithAmmZapper: boolean;\r\n  isBLusdLpApprovedWithGauge: boolean;\r\n  inputToken: BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD;\r\n  isInputTokenApprovedWithBLusdAmm: boolean;\r\n  getExpectedSwapOutput: (inputToken: BLusdAmmTokenIndex, inputAmount: Decimal) => Promise<Decimal>;\r\n  getExpectedLpTokens: (bLusdAmount: Decimal, lusdAmount: Decimal) => Promise<Decimal>;\r\n  getExpectedWithdrawal: (\r\n    burnLp: Decimal,\r\n    output: BLusdAmmTokenIndex | \"both\"\r\n  ) => Promise<Map<BLusdAmmTokenIndex, Decimal>>;\r\n  isBootstrapPeriodActive?: boolean;\r\n  hasLoaded: boolean;\r\n  addresses: Addresses;\r\n  lpRewards: BLusdLpRewards | undefined;\r\n};\r\n\r\nexport const BondViewContext = createContext<BondViewContextType | null>(null);\r\n\r\nexport const useBondView = (): BondViewContextType => {\r\n  const context: BondViewContextType | null = useContext(BondViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <BondViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n\r\nexport const statuses = {\r\n  PENDING: PENDING_STATUS.term,\r\n  CANCELLED: CANCELLED_STATUS.term,\r\n  CLAIMED: CLAIMED_STATUS.term,\r\n  NON_EXISTENT: \"NON_EXISTENT\"\r\n};\r\n","import { useWeb3React } from \"@web3-react/core\";\r\nimport React, { useContext, createContext } from \"react\";\r\n\r\nimport mainnet from \"@liquity/chicken-bonds/lusd/addresses/mainnet.json\";\r\nimport goerli from \"@liquity/chicken-bonds/lusd/addresses/goerli.json\";\r\nimport { Addresses } from \"./transitions\";\r\n\r\nconst nullAddresses: Addresses = {\r\n  BLUSD_AMM_ADDRESS: null,\r\n  BLUSD_AMM_STAKING_ADDRESS: null,\r\n  BLUSD_TOKEN_ADDRESS: null,\r\n  BOND_NFT_ADDRESS: null,\r\n  CHICKEN_BOND_MANAGER_ADDRESS: null,\r\n  LUSD_OVERRIDE_ADDRESS: null,\r\n  BLUSD_LP_ZAP_ADDRESS: null\r\n};\r\n\r\nexport const chainIdAddressesMap: Partial<Record<number, Addresses>> = {\r\n  1: mainnet,\r\n  5: goerli\r\n  // 11155111: sepolia\r\n};\r\n\r\nexport const BondAddressesContext = createContext<Addresses | undefined>(undefined);\r\n\r\nexport const useBondAddresses = (): Addresses => {\r\n  const context = useContext(BondAddressesContext);\r\n\r\n  if (context === undefined) {\r\n    throw new Error(\"You must add a <BondAddressesProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n\r\nexport const BondAddressesProvider: React.FC = ({ children }) => {\r\n  const { chainId } = useWeb3React();\r\n\r\n  const addresses: Addresses =\r\n    chainId !== undefined ? chainIdAddressesMap[chainId] ?? nullAddresses : nullAddresses;\r\n\r\n  return <BondAddressesContext.Provider value={addresses}>{children}</BondAddressesContext.Provider>;\r\n};\r\n","import React from \"react\";\r\nimport { Text, Flex, Box, Heading } from \"theme-ui\";\r\n\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../strings\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { useBondView } from \"./Bonds/context/BondViewContext\";\r\nimport { useBondAddresses } from \"./Bonds/context/BondAddressesContext\";\r\n\r\nconst select = ({ accountBalance, lusdBalance, lqtyBalance }: LiquityStoreState) => ({\r\n  accountBalance,\r\n  lusdBalance,\r\n  lqtyBalance\r\n});\r\n\r\nexport const UserAccount: React.FC = () => {\r\n  const { account } = useLiquity();\r\n  const { accountBalance, lusdBalance: realLusdBalance, lqtyBalance } = useLiquitySelector(select);\r\n  const { bLusdBalance, lusdBalance: customLusdBalance } = useBondView();\r\n  const { LUSD_OVERRIDE_ADDRESS } = useBondAddresses();\r\n\r\n  const lusdBalance = LUSD_OVERRIDE_ADDRESS === null ? realLusdBalance : customLusdBalance;\r\n\r\n  return (\r\n    <Box sx={{ display: [\"none\", \"flex\"] }}>\r\n      <Flex sx={{ alignItems: \"center\" }}>\r\n        <Icon name=\"user-circle\" size=\"lg\" />\r\n        <Flex sx={{ ml: 3, mr: 4, flexDirection: \"column\" }}>\r\n          <Heading sx={{ fontSize: 1 }}>Connected as</Heading>\r\n          <Text as=\"span\" sx={{ fontSize: 1 }}>\r\n            {shortenAddress(account)}\r\n          </Text>\r\n        </Flex>\r\n      </Flex>\r\n\r\n      <Flex sx={{ alignItems: \"center\" }}>\r\n        <Icon name=\"wallet\" size=\"lg\" />\r\n\r\n        {([\r\n          [\"ETH\", accountBalance],\r\n          [COIN, Decimal.from(lusdBalance || 0)],\r\n          [GT, Decimal.from(lqtyBalance)],\r\n          [\"bLUSD\", Decimal.from(bLusdBalance || 0)]\r\n        ] as const).map(([currency, balance], i) => (\r\n          <Flex key={i} sx={{ ml: 3, flexDirection: \"column\" }}>\r\n            <Heading sx={{ fontSize: 1 }}>{currency}</Heading>\r\n            <Text sx={{ fontSize: 1 }}>{balance.prettify()}</Text>\r\n          </Flex>\r\n        ))}\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Icon } from \"./Icon\";\r\nimport { FontAwesomeIconProps } from \"@fortawesome/react-fontawesome\";\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport type { TooltipProps } from \"./Tooltip\";\r\n\r\nexport type InfoIconProps = Pick<TooltipProps, \"placement\" | \"link\"> &\r\n  Pick<FontAwesomeIconProps, \"size\"> & {\r\n    tooltip: React.ReactNode;\r\n  };\r\n\r\nexport const InfoIcon: React.FC<InfoIconProps> = ({\r\n  link,\r\n  placement = \"right\",\r\n  tooltip,\r\n  size = \"1x\"\r\n}) => {\r\n  return (\r\n    <Tooltip message={tooltip} placement={placement} link={link}>\r\n      &nbsp;\r\n      <Icon name=\"question-circle\" size={size} />\r\n    </Tooltip>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\nimport { InfoIcon } from \"./InfoIcon\";\r\nimport type { Lexicon } from \"../lexicon\";\r\n\r\ntype StatisticProps = {\r\n  lexicon: Lexicon;\r\n};\r\n\r\nexport const Statistic: React.FC<StatisticProps> = ({ lexicon, children }) => {\r\n  return (\r\n    <Flex sx={{ borderBottom: 1, borderColor: \"rgba(0, 0, 0, 0.1)\" }}>\r\n      <Flex sx={{ alignItems: \"center\", justifyContent: \"flex-start\", flex: 1.2, fontWeight: 200 }}>\r\n        <Flex>{lexicon.term}</Flex>\r\n        {lexicon.term && <InfoIcon size=\"xs\" tooltip={lexicon.description} link={lexicon.link} />}\r\n      </Flex>\r\n      <Flex sx={{ justifyContent: \"flex-end\", flex: 1, alignItems: \"center\" }}>{children}</Flex>\r\n    </Flex>\r\n  );\r\n};\r\n","export type Lexicon = {\r\n  term: string;\r\n  description?: string;\r\n  link?: string;\r\n};\r\n\r\nexport const BORROW_FEE: Lexicon = {\r\n  term: \"Borrowing Fee\",\r\n  description:\r\n    \"The Borrowing Fee is a one-off fee charged as a percentage of the borrowed amount (in LUSD) and is part of a Trove's debt. The fee varies between 0.5% and 5% depending on LUSD redemption volumes.\"\r\n};\r\n\r\nexport const TVL: Lexicon = {\r\n  term: \"TVL\",\r\n  description:\r\n    \"The Total Value Locked (TVL) is the total value of Ether locked as collateral in the system, given in ETH and USD.\"\r\n};\r\n\r\nexport const STAKED_LQTY: Lexicon = {\r\n  term: \"Staked LQTY\",\r\n  description: \"The total amount of LQTY that is staked for earning fee revenue.\"\r\n};\r\n\r\nexport const TCR: Lexicon = {\r\n  term: \"Total Collateral Ratio\",\r\n  description:\r\n    \"The ratio of the Dollar value of the entire system collateral at the current ETH:USD price, to the entire system debt.\"\r\n};\r\n\r\nexport const RECOVERY_MODE: Lexicon = {\r\n  term: \"Recovery Mode\",\r\n  description:\r\n    \"Recovery Mode is activated when the Total Collateral Ratio (TCR) falls below 150%. When active, your Trove can be liquidated if its collateral ratio is below the TCR. The maximum collateral you can lose from liquidation is capped at 110% of your Trove's debt. Operations are also restricted that would negatively impact the TCR.\"\r\n};\r\n\r\nexport const STABILITY_POOL_LUSD: Lexicon = {\r\n  term: \"LUSD in Stability Pool\",\r\n  description:\r\n    \"The total LUSD currently held in the Stability Pool, expressed as an amount and a fraction of the LUSD supply.\"\r\n};\r\n\r\nexport const KICKBACK_RATE: Lexicon = {\r\n  term: \"Kickback Rate\",\r\n  description:\r\n    \"A rate between 0 and 100% set by the Frontend Operator that determines the fraction of LQTY that will be paid out as a kickback to the Stability Providers using the frontend.\"\r\n};\r\n\r\nexport const ETH: Lexicon = {\r\n  term: \"ETH\"\r\n};\r\n\r\nexport const LUSD: Lexicon = {\r\n  term: \"LUSD\"\r\n};\r\n\r\nexport const LQTY: Lexicon = {\r\n  term: \"LQTY\"\r\n};\r\n\r\nexport const TROVES: Lexicon = {\r\n  term: \"Troves\",\r\n  description: \"The total number of active Troves in the system.\"\r\n};\r\n\r\nexport const LUSD_SUPPLY: Lexicon = {\r\n  term: \"LUSD supply\",\r\n  description: \"The total LUSD minted by the Liquity Protocol.\"\r\n};\r\n","import React from \"react\";\r\nimport { Card, Heading, Link, Box, Text } from \"theme-ui\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\nimport { Decimal, Percent, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { Statistic } from \"./Statistic\";\r\nimport * as l from \"../lexicon\";\r\n\r\nconst selectBalances = ({ accountBalance, lusdBalance, lqtyBalance }: LiquityStoreState) => ({\r\n  accountBalance,\r\n  lusdBalance,\r\n  lqtyBalance\r\n});\r\n\r\nconst Balances: React.FC = () => {\r\n  const { accountBalance, lusdBalance, lqtyBalance } = useLiquitySelector(selectBalances);\r\n\r\n  return (\r\n    <Box sx={{ mb: 3 }}>\r\n      <Heading>My Account Balances</Heading>\r\n      <Statistic lexicon={l.ETH}>{accountBalance.prettify(4)}</Statistic>\r\n      <Statistic lexicon={l.LUSD}>{lusdBalance.prettify()}</Statistic>\r\n      <Statistic lexicon={l.LQTY}>{lqtyBalance.prettify()}</Statistic>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst GitHubCommit: React.FC<{ children?: string }> = ({ children }) =>\r\n  children?.match(/[0-9a-f]{40}/) ? (\r\n    <Link href={`https://github.com/liquity/dev/commit/${children}`}>{children.substr(0, 7)}</Link>\r\n  ) : (\r\n    <>unknown</>\r\n  );\r\n\r\ntype SystemStatsProps = {\r\n  variant?: string;\r\n  showBalances?: boolean;\r\n};\r\n\r\nconst select = ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  borrowingRate,\r\n  redemptionRate,\r\n  totalStakedLQTY,\r\n  frontend\r\n}: LiquityStoreState) => ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  borrowingRate,\r\n  redemptionRate,\r\n  totalStakedLQTY,\r\n  kickbackRate: frontend.status === \"registered\" ? frontend.kickbackRate : null\r\n});\r\n\r\nexport const SystemStats: React.FC<SystemStatsProps> = ({ variant = \"info\", showBalances }) => {\r\n  const {\r\n    liquity: {\r\n      connection: { version: contractsVersion, deploymentDate, frontendTag }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const {\r\n    numberOfTroves,\r\n    price,\r\n    lusdInStabilityPool,\r\n    total,\r\n    borrowingRate,\r\n    totalStakedLQTY,\r\n    kickbackRate\r\n  } = useLiquitySelector(select);\r\n\r\n  const lusdInStabilityPoolPct =\r\n    total.debt.nonZero && new Percent(lusdInStabilityPool.div(total.debt));\r\n  const totalCollateralRatioPct = new Percent(total.collateralRatio(price));\r\n  const borrowingFeePct = new Percent(borrowingRate);\r\n  const kickbackRatePct = frontendTag === AddressZero ? \"100\" : kickbackRate?.mul(100).prettify();\r\n\r\n  return (\r\n    <Card {...{ variant }}>\r\n      {showBalances && <Balances />}\r\n\r\n      <Heading>Liquity statistics</Heading>\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Protocol\r\n      </Heading>\r\n\r\n      <Statistic lexicon={l.BORROW_FEE}>{borrowingFeePct.toString(2)}</Statistic>\r\n\r\n      <Statistic lexicon={l.TVL}>\r\n        {total.collateral.shorten()} <Text sx={{ fontSize: 1 }}>&nbsp;ETH</Text>\r\n        <Text sx={{ fontSize: 1 }}>\r\n          &nbsp;(${Decimal.from(total.collateral.mul(price)).shorten()})\r\n        </Text>\r\n      </Statistic>\r\n      <Statistic lexicon={l.TROVES}>{Decimal.from(numberOfTroves).prettify(0)}</Statistic>\r\n      <Statistic lexicon={l.LUSD_SUPPLY}>{total.debt.shorten()}</Statistic>\r\n      {lusdInStabilityPoolPct && (\r\n        <Statistic lexicon={l.STABILITY_POOL_LUSD}>\r\n          {lusdInStabilityPool.shorten()}\r\n          <Text sx={{ fontSize: 1 }}>&nbsp;({lusdInStabilityPoolPct.toString(1)})</Text>\r\n        </Statistic>\r\n      )}\r\n      <Statistic lexicon={l.STAKED_LQTY}>{totalStakedLQTY.shorten()}</Statistic>\r\n      <Statistic lexicon={l.TCR}>{totalCollateralRatioPct.prettify()}</Statistic>\r\n      <Statistic lexicon={l.RECOVERY_MODE}>\r\n        {total.collateralRatioIsBelowCritical(price) ? <Box color=\"danger\">Yes</Box> : \"No\"}\r\n      </Statistic>\r\n      {}\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Frontend\r\n      </Heading>\r\n      {kickbackRatePct && <Statistic lexicon={l.KICKBACK_RATE}>{kickbackRatePct}%</Statistic>}\r\n\r\n      <Box sx={{ mt: 3, opacity: 0.66 }}>\r\n        <Box sx={{ fontSize: 0 }}>\r\n          Contracts version: <GitHubCommit>{contractsVersion}</GitHubCommit>\r\n        </Box>\r\n        <Box sx={{ fontSize: 0 }}>Deployed: {deploymentDate.toLocaleString()}</Box>\r\n        <Box sx={{ fontSize: 0 }}>\r\n          Frontend version:{\" \"}\r\n          {process.env.NODE_ENV === \"development\" ? (\r\n            \"development\"\r\n          ) : (\r\n            <GitHubCommit>{process.env.REACT_APP_VERSION}</GitHubCommit>\r\n          )}\r\n        </Box>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useState, useRef } from \"react\";\r\nimport { Container, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { SystemStats } from \"./SystemStats\";\r\n\r\nconst select = ({ total, price }: LiquityStoreState) => ({ total, price });\r\n\r\nexport const SystemStatsPopup: React.FC = () => {\r\n  const { price, total } = useLiquitySelector(select);\r\n\r\n  const [systemStatsOpen, setSystemStatsOpen] = useState(false);\r\n  const systemStatsOverlayRef = useRef<HTMLDivElement>(null);\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        onClick={() => setSystemStatsOpen(!systemStatsOpen)}\r\n        variant=\"icon\"\r\n        sx={{\r\n          position: \"relative\",\r\n          display: [\"block\", \"none\"]\r\n        }}\r\n      >\r\n        <Icon name=\"info-circle\" size=\"2x\" />\r\n\r\n        {total.collateralRatioIsBelowCritical(price) && (\r\n          <Flex\r\n            sx={{\r\n              position: \"absolute\",\r\n              right: 0,\r\n              top: 0,\r\n              width: \"100%\",\r\n              height: \"100%\",\r\n\r\n              alignItems: \"flex-start\",\r\n              justifyContent: \"flex-end\",\r\n              pt: \"2px\",\r\n\r\n              color: \"danger\"\r\n            }}\r\n          >\r\n            <Icon name=\"exclamation-circle\" size=\"xs\" />\r\n          </Flex>\r\n        )}\r\n      </Button>\r\n\r\n      {systemStatsOpen && (\r\n        <Container\r\n          variant=\"infoOverlay\"\r\n          ref={systemStatsOverlayRef}\r\n          onClick={e => {\r\n            if (e.target === systemStatsOverlayRef.current) {\r\n              setSystemStatsOpen(false);\r\n            }\r\n          }}\r\n        >\r\n          <SystemStats variant=\"infoPopup\" showBalances />\r\n        </Container>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Box, Image } from \"theme-ui\";\r\n\r\ntype LiquityLogoProps = React.ComponentProps<typeof Box> & {\r\n  height?: number | string;\r\n};\r\n\r\nexport const LiquityLogo: React.FC<LiquityLogoProps> = ({ height, ...boxProps }) => (\r\n  <Box sx={{ lineHeight: 0 }} {...boxProps}>\r\n    <Image src=\"./lusd-icon.png\" sx={{ height }} />\r\n  </Box>\r\n);\r\n","import { NavLink as RouterLink, NavLinkProps as RouterLinkProps } from \"react-router-dom\";\r\nimport { NavLink as ThemeUINavLink, NavLinkProps as ThemeUILinkProps } from \"theme-ui\";\r\n\r\ntype CombinedProps = ThemeUILinkProps & RouterLinkProps<{}>;\r\n\r\nconst ExactLink: React.FC<CombinedProps> = props => {\r\n  return <RouterLink exact {...props} />;\r\n};\r\n\r\nexport const Link: React.FC<CombinedProps> = props => {\r\n  return <ThemeUINavLink {...props} as={ExactLink} />;\r\n};\r\n","import { Flex, Box, Badge, Text } from \"theme-ui\";\r\nimport { Link } from \"./Link\";\r\n\r\nconst TemporaryNewBadge = () => {\r\n  const isBeforeNovember2022 = new Date() < new Date(\"2022-11-01\");\r\n  if (!isBeforeNovember2022) return null;\r\n  return (\r\n    <Badge ml={1} sx={{ fontSize: \"12px\" }}>\r\n      New\r\n    </Badge>\r\n  );\r\n};\r\n\r\nexport const Nav: React.FC = () => {\r\n  return (\r\n    <Box as=\"nav\" sx={{ display: [\"none\", \"flex\"], alignItems: \"center\", flex: 1 }}>\r\n      <Flex>\r\n        <Link to=\"/\">Dashboard</Link>\r\n        <Link to=\"/bonds\">\r\n          <Flex sx={{ alignItems: \"center\" }}>\r\n            <Text>Bonds</Text>\r\n            <TemporaryNewBadge />\r\n          </Flex>\r\n        </Link>\r\n      </Flex>\r\n      <Flex sx={{ justifyContent: \"flex-end\", mr: 3, flex: 1 }}>\r\n        <Link sx={{ fontSize: 1 }} to=\"/risky-troves\">\r\n          Risky Troves\r\n        </Link>\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n","import React, { useState, useRef } from \"react\";\r\nimport { Box, Button, Container, Flex } from \"theme-ui\";\r\nimport { Icon } from \"./Icon\";\r\nimport { LiquityLogo } from \"./LiquityLogo\";\r\nimport { Link } from \"./Link\";\r\n\r\nconst logoHeight = \"32px\";\r\n\r\nexport const SideNav: React.FC = () => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const overlay = useRef<HTMLDivElement>(null);\r\n\r\n  if (!isVisible) {\r\n    return (\r\n      <Button sx={{ display: [\"flex\", \"none\"] }} variant=\"icon\" onClick={() => setIsVisible(true)}>\r\n        <Icon name=\"bars\" size=\"lg\" />\r\n      </Button>\r\n    );\r\n  }\r\n  return (\r\n    <Container\r\n      variant=\"infoOverlay\"\r\n      ref={overlay}\r\n      onClick={e => {\r\n        if (e.target === overlay.current) {\r\n          setIsVisible(false);\r\n        }\r\n      }}\r\n    >\r\n      <Flex variant=\"layout.sidenav\">\r\n        <Button\r\n          sx={{ position: \"fixed\", right: \"25vw\", m: 2 }}\r\n          variant=\"icon\"\r\n          onClick={() => setIsVisible(false)}\r\n        >\r\n          <Icon name=\"times\" size=\"2x\" />\r\n        </Button>\r\n        <LiquityLogo height={logoHeight} p={2} />\r\n        <Box as=\"nav\" sx={{ m: 3, mt: 1, p: 0 }} onClick={() => setIsVisible(false)}>\r\n          <Link to=\"/\">Dashboard</Link>\r\n          <Link to=\"/bonds\">Bonds</Link>\r\n          <Link to=\"/risky-troves\">Risky Troves</Link>\r\n        </Box>\r\n      </Flex>\r\n    </Container>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { Container, Flex, Box } from \"theme-ui\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { LiquityLogo } from \"./LiquityLogo\";\r\nimport { Nav } from \"./Nav\";\r\nimport { SideNav } from \"./SideNav\";\r\n\r\nconst logoHeight = \"32px\";\r\n\r\nconst select = ({ frontend }: LiquityStoreState) => ({\r\n  frontend\r\n});\r\n\r\nexport const Header: React.FC = ({ children }) => {\r\n  const {\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n  const { frontend } = useLiquitySelector(select);\r\n  const isFrontendRegistered = frontendTag === AddressZero || frontend.status === \"registered\";\r\n\r\n  return (\r\n    <Container variant=\"header\">\r\n      <Flex sx={{ alignItems: \"center\", flex: 1 }}>\r\n        <LiquityLogo height={logoHeight} />\r\n\r\n        <Box\r\n          sx={{\r\n            mx: [2, 3],\r\n            width: \"0px\",\r\n            height: \"100%\",\r\n            borderLeft: [\"none\", \"1px solid lightgrey\"]\r\n          }}\r\n        />\r\n        {isFrontendRegistered && (\r\n          <>\r\n            <SideNav />\r\n            <Nav />\r\n          </>\r\n        )}\r\n      </Flex>\r\n\r\n      {children}\r\n    </Container>\r\n  );\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const ActionDescription: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"accent\",\r\n      boxShadow: 2,\r\n      bg: \"rgba(46, 182, 234, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"info-circle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n\r\nexport const Amount: React.FC = ({ children }) => (\r\n  <Text sx={{ fontWeight: \"bold\", whiteSpace: \"nowrap\" }}>{children}</Text>\r\n);\r\n","import React, { useState } from \"react\";\r\nimport { Text, Flex, Label, Input, SxProp, Button, ThemeUICSSProperties } from \"theme-ui\";\r\n\r\nimport { Icon } from \"../Icon\";\r\n\r\ntype RowProps = SxProp & {\r\n  label: string | React.ReactNode;\r\n  labelId?: string;\r\n  labelFor?: string;\r\n  infoIcon?: React.ReactNode;\r\n};\r\n\r\nexport const Row: React.FC<RowProps> = ({ sx, label, labelId, labelFor, children, infoIcon }) => {\r\n  return (\r\n    <Flex sx={{ alignItems: \"stretch\", position: \"relative\", width: \"100%\", ...sx }}>\r\n      <Label\r\n        id={labelId}\r\n        htmlFor={labelFor}\r\n        sx={{\r\n          p: 0,\r\n          pl: 3,\r\n          pt: \"12px\",\r\n          position: \"absolute\",\r\n          fontSize: 1,\r\n          border: 1,\r\n          borderColor: \"transparent\"\r\n        }}\r\n      >\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          {label}\r\n          {infoIcon && infoIcon}\r\n        </Flex>\r\n      </Label>\r\n      {children}\r\n    </Flex>\r\n  );\r\n};\r\n\r\ntype PendingAmountProps = {\r\n  value: string;\r\n};\r\n\r\nconst PendingAmount: React.FC<PendingAmountProps & SxProp> = ({ sx, value }) => (\r\n  <Text {...{ sx }}>\r\n    (\r\n    {value === \"++\" ? (\r\n      <Icon name=\"angle-double-up\" />\r\n    ) : value === \"--\" ? (\r\n      <Icon name=\"angle-double-down\" />\r\n    ) : value?.startsWith(\"+\") ? (\r\n      <>\r\n        <Icon name=\"angle-up\" /> {value.substr(1)}\r\n      </>\r\n    ) : value?.startsWith(\"-\") ? (\r\n      <>\r\n        <Icon name=\"angle-down\" /> {value.substr(1)}\r\n      </>\r\n    ) : (\r\n      value\r\n    )}\r\n    )\r\n  </Text>\r\n);\r\n\r\ntype StaticAmountsProps = {\r\n  inputId?: string;\r\n  labelledBy?: string;\r\n  amount?: string;\r\n  unit?: string;\r\n  color?: string;\r\n  pendingAmount?: string;\r\n  pendingColor?: string;\r\n  onClick?: () => void;\r\n};\r\n\r\nexport const StaticAmounts: React.FC<StaticAmountsProps & SxProp> = ({\r\n  sx,\r\n  inputId,\r\n  labelledBy,\r\n  amount,\r\n  unit,\r\n  color,\r\n  pendingAmount,\r\n  pendingColor,\r\n  onClick,\r\n  children\r\n}) => {\r\n  return (\r\n    <Flex\r\n      id={inputId}\r\n      aria-labelledby={labelledBy}\r\n      {...{ onClick }}\r\n      sx={{\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n\r\n        ...(onClick ? { cursor: \"text\" } : {}),\r\n\r\n        ...staticStyle,\r\n        ...sx\r\n      }}\r\n    >\r\n      {amount && (\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          <Text sx={{ color, fontWeight: \"medium\" }}>{amount}</Text>\r\n\r\n          {unit && (\r\n            <>\r\n              &nbsp;\r\n              <Text sx={{ fontWeight: \"light\", opacity: 0.8 }}>{unit}</Text>\r\n            </>\r\n          )}\r\n\r\n          {pendingAmount && (\r\n            <>\r\n              &nbsp;\r\n              <PendingAmount\r\n                sx={{ color: pendingColor, opacity: 0.8, fontSize: \"0.666em\" }}\r\n                value={pendingAmount}\r\n              />\r\n            </>\r\n          )}\r\n        </Flex>\r\n      )}\r\n\r\n      {children}\r\n    </Flex>\r\n  );\r\n};\r\n\r\nconst staticStyle: ThemeUICSSProperties = {\r\n  flexGrow: 1,\r\n\r\n  mb: 0,\r\n  pl: 3,\r\n  pr: \"11px\",\r\n  pb: 0,\r\n  pt: \"28px\",\r\n\r\n  fontSize: 3,\r\n\r\n  border: 1,\r\n  borderColor: \"transparent\"\r\n};\r\n\r\nconst editableStyle: ThemeUICSSProperties = {\r\n  flexGrow: 1,\r\n\r\n  mb: [2, 3],\r\n  pl: 3,\r\n  pr: \"11px\",\r\n  pb: 2,\r\n  pt: \"28px\",\r\n\r\n  fontSize: 4,\r\n\r\n  boxShadow: [1, 2],\r\n  border: 1,\r\n  borderColor: \"muted\"\r\n};\r\n\r\ntype StaticRowProps = RowProps & StaticAmountsProps;\r\n\r\nexport const StaticRow: React.FC<StaticRowProps> = ({\r\n  label,\r\n  labelId,\r\n  labelFor,\r\n  infoIcon,\r\n  amount,\r\n  children,\r\n  ...props\r\n}) => (\r\n  <Row\r\n    label={label}\r\n    labelId={labelId}\r\n    labelFor={labelFor}\r\n    infoIcon={infoIcon}\r\n    sx={{ mt: [-2, -3], pb: [2, 3] }}\r\n  >\r\n    {amount ? (\r\n      <StaticAmounts amount={amount} {...props}>\r\n        {children}\r\n      </StaticAmounts>\r\n    ) : (\r\n      children\r\n    )}\r\n  </Row>\r\n);\r\n\r\ntype DisabledEditableRowProps = Omit<StaticAmountsProps, \"labelledBy\" | \"onClick\"> & {\r\n  label: string;\r\n};\r\n\r\nexport const DisabledEditableAmounts: React.FC<StaticAmountsProps & SxProp> = ({\r\n  inputId,\r\n  children,\r\n  sx,\r\n  ...props\r\n}) => (\r\n  <StaticAmounts\r\n    sx={{ ...editableStyle, boxShadow: 0, ...sx }}\r\n    labelledBy={`${inputId}-label`}\r\n    inputId={inputId}\r\n    {...props}\r\n  >\r\n    {children}\r\n  </StaticAmounts>\r\n);\r\n\r\nexport const DisabledEditableRow: React.FC<DisabledEditableRowProps> = ({\r\n  inputId,\r\n  label,\r\n  amount,\r\n  children,\r\n  ...props\r\n}) => (\r\n  <Row labelId={`${inputId}-label`} label={label}>\r\n    {amount ? (\r\n      <DisabledEditableAmounts inputId={inputId} amount={amount} {...props}>\r\n        {children}\r\n      </DisabledEditableAmounts>\r\n    ) : (\r\n      children\r\n    )}\r\n  </Row>\r\n);\r\n\r\ntype EditableRowProps = DisabledEditableRowProps & {\r\n  editingState: [string | undefined, (editing: string | undefined) => void];\r\n  editedAmount: string;\r\n  setEditedAmount: (editedAmount: string) => void;\r\n  maxAmount?: string;\r\n  maxedOut?: boolean;\r\n};\r\n\r\nexport const EditableRow: React.FC<EditableRowProps> = ({\r\n  label,\r\n  inputId,\r\n  unit,\r\n  amount,\r\n  color,\r\n  pendingAmount,\r\n  pendingColor,\r\n  editingState,\r\n  editedAmount,\r\n  setEditedAmount,\r\n  maxAmount,\r\n  maxedOut\r\n}) => {\r\n  const [editing, setEditing] = editingState;\r\n  const [invalid, setInvalid] = useState(false);\r\n\r\n  return editing === inputId ? (\r\n    <Row {...{ label, labelFor: inputId, unit }}>\r\n      <Input\r\n        autoFocus\r\n        id={inputId}\r\n        type=\"number\"\r\n        step=\"any\"\r\n        defaultValue={editedAmount}\r\n        {...{ invalid }}\r\n        onChange={e => {\r\n          try {\r\n            setEditedAmount(e.target.value);\r\n            setInvalid(false);\r\n          } catch {\r\n            setInvalid(true);\r\n          }\r\n        }}\r\n        onBlur={() => {\r\n          setEditing(undefined);\r\n          setInvalid(false);\r\n        }}\r\n        variant=\"editor\"\r\n        sx={{\r\n          ...editableStyle,\r\n          fontWeight: \"medium\",\r\n          bg: invalid ? \"invalid\" : \"background\"\r\n        }}\r\n      />\r\n    </Row>\r\n  ) : (\r\n    <Row labelId={`${inputId}-label`} {...{ label, unit }}>\r\n      <StaticAmounts\r\n        sx={{\r\n          ...editableStyle,\r\n          bg: invalid ? \"invalid\" : \"background\"\r\n        }}\r\n        labelledBy={`${inputId}-label`}\r\n        onClick={() => setEditing(inputId)}\r\n        {...{ inputId, amount, unit, color, pendingAmount, pendingColor, invalid }}\r\n      >\r\n        {maxAmount && (\r\n          <Button\r\n            sx={{ fontSize: 1, p: 1, px: 3 }}\r\n            onClick={event => {\r\n              setEditedAmount(maxAmount);\r\n              event.stopPropagation();\r\n            }}\r\n            disabled={maxedOut}\r\n          >\r\n            max\r\n          </Button>\r\n        )}\r\n      </StaticAmounts>\r\n    </Row>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Container, Spinner } from \"theme-ui\";\r\n\r\nexport const LoadingOverlay: React.FC = () => (\r\n  <Container\r\n    variant=\"disabledOverlay\"\r\n    sx={{ p: \"14px\", display: \"flex\", justifyContent: \"flex-end\" }}\r\n  >\r\n    <Spinner size=\"28px\" sx={{ color: \"text\" }} />\r\n  </Container>\r\n);\r\n","import React from \"react\";\r\nimport { Flex, Box, Card } from \"theme-ui\";\r\n\r\nimport { CRITICAL_COLLATERAL_RATIO, Decimal, Difference, Percent } from \"@liquity/lib-base\";\r\n\r\nimport { Icon } from \"../Icon\";\r\n\r\nimport { StaticRow } from \"./Editor\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\n\r\ntype CollateralRatioProps = {\r\n  value?: Decimal;\r\n  change?: Difference;\r\n};\r\n\r\nexport const CollateralRatio: React.FC<CollateralRatioProps> = ({ value, change }) => {\r\n  const collateralRatioPct = new Percent(value ?? { toString: () => \"N/A\" });\r\n  const changePct = change && new Percent(change);\r\n  return (\r\n    <>\r\n      <Flex>\r\n        <Box sx={{ mt: [2, 0], ml: 3, mr: -2, fontSize: \"24px\" }}>\r\n          <Icon name=\"heartbeat\" />\r\n        </Box>\r\n\r\n        <StaticRow\r\n          label=\"Collateral ratio\"\r\n          inputId=\"trove-collateral-ratio\"\r\n          amount={collateralRatioPct.prettify()}\r\n          color={\r\n            value?.gt(CRITICAL_COLLATERAL_RATIO)\r\n              ? \"success\"\r\n              : value?.gt(1.2)\r\n              ? \"warning\"\r\n              : value?.lte(1.2)\r\n              ? \"danger\"\r\n              : \"muted\"\r\n          }\r\n          pendingAmount={\r\n            change?.positive?.absoluteValue?.gt(10)\r\n              ? \"++\"\r\n              : change?.negative?.absoluteValue?.gt(10)\r\n              ? \"--\"\r\n              : changePct?.nonZeroish(2)?.prettify()\r\n          }\r\n          pendingColor={change?.positive ? \"success\" : \"danger\"}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"220px\" }}>\r\n                  The ratio between the dollar value of the collateral and the debt (in LUSD) you are\r\n                  depositing. While the Minimum Collateral Ratio is 110% during normal operation, it\r\n                  is recommended to keep the Collateral Ratio always above 150% to avoid liquidation\r\n                  under Recovery Mode. A Collateral Ratio above 200% or 250% is recommended for\r\n                  additional safety.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n      </Flex>\r\n      {value?.lt(1.5) && (\r\n        <ActionDescription>\r\n          Keeping your CR above 150% can help avoid liquidation under Recovery Mode.\r\n        </ActionDescription>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Heading, Box, Card } from \"theme-ui\";\r\n\r\nimport {\r\n  Percent,\r\n  Difference,\r\n  Decimalish,\r\n  Decimal,\r\n  Trove,\r\n  LiquityStoreState,\r\n  LUSD_LIQUIDATION_RESERVE\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN } from \"../../strings\";\r\n\r\nimport { StaticRow } from \"./Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\ntype TroveEditorProps = {\r\n  original: Trove;\r\n  edited: Trove;\r\n  fee: Decimal;\r\n  borrowingRate: Decimal;\r\n  changePending: boolean;\r\n  dispatch: (\r\n    action: { type: \"setCollateral\" | \"setDebt\"; newValue: Decimalish } | { type: \"revert\" }\r\n  ) => void;\r\n};\r\n\r\nconst select = ({ price }: LiquityStoreState) => ({ price });\r\n\r\nexport const TroveEditor: React.FC<TroveEditorProps> = ({\r\n  children,\r\n  original,\r\n  edited,\r\n  fee,\r\n  borrowingRate,\r\n  changePending\r\n}) => {\r\n  const { price } = useLiquitySelector(select);\r\n\r\n  const feePct = new Percent(borrowingRate);\r\n\r\n  const originalCollateralRatio = !original.isEmpty ? original.collateralRatio(price) : undefined;\r\n  const collateralRatio = !edited.isEmpty ? edited.collateralRatio(price) : undefined;\r\n  const collateralRatioChange = Difference.between(collateralRatio, originalCollateralRatio);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <StaticRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={edited.collateral.prettify(4)}\r\n          unit=\"ETH\"\r\n        />\r\n\r\n        <StaticRow label=\"Debt\" inputId=\"trove-debt\" amount={edited.debt.prettify()} unit={COIN} />\r\n\r\n        {original.isEmpty && (\r\n          <StaticRow\r\n            label=\"Liquidation Reserve\"\r\n            inputId=\"trove-liquidation-reserve\"\r\n            amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n            unit={COIN}\r\n            infoIcon={\r\n              <InfoIcon\r\n                tooltip={\r\n                  <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                    An amount set aside to cover the liquidator’s gas costs if your Trove needs to be\r\n                    liquidated. The amount increases your debt and is refunded if you close your\r\n                    Trove by fully paying off its net debt.\r\n                  </Card>\r\n                }\r\n              />\r\n            }\r\n          />\r\n        )}\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.toString(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} change={collateralRatioChange} />\r\n\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype TroveActionProps = {\r\n  transactionId: string;\r\n  change: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n  maxBorrowingRate: Decimal;\r\n  borrowingFeeDecayToleranceMinutes: number;\r\n};\r\n\r\nexport const TroveAction: React.FC<TroveActionProps> = ({\r\n  children,\r\n  transactionId,\r\n  change,\r\n  maxBorrowingRate,\r\n  borrowingFeeDecayToleranceMinutes\r\n}) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    transactionId,\r\n    change.type === \"creation\"\r\n      ? liquity.send.openTrove.bind(liquity.send, change.params, {\r\n          maxBorrowingRate,\r\n          borrowingFeeDecayToleranceMinutes\r\n        })\r\n      : change.type === \"closure\"\r\n      ? liquity.send.closeTrove.bind(liquity.send)\r\n      : liquity.send.adjustTrove.bind(liquity.send, change.params, {\r\n          maxBorrowingRate,\r\n          borrowingFeeDecayToleranceMinutes\r\n        })\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type { TroveView, TroveEvent } from \"./types\";\r\n\r\ntype TroveViewContextType = {\r\n  view: TroveView;\r\n  dispatchEvent: (event: TroveEvent) => void;\r\n};\r\n\r\nexport const TroveViewContext = createContext<TroveViewContextType | null>(null);\r\n\r\nexport const useTroveView = (): TroveViewContextType => {\r\n  const context: TroveViewContextType | null = useContext(TroveViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <TroveViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const ErrorDescription: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"danger\",\r\n      boxShadow: 2,\r\n      bg: \"rgba(220, 44, 16, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"exclamation-triangle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n","import {\r\n  Decimal,\r\n  LUSD_MINIMUM_DEBT,\r\n  LUSD_MINIMUM_NET_DEBT,\r\n  Trove,\r\n  TroveAdjustmentParams,\r\n  TroveChange,\r\n  Percent,\r\n  MINIMUM_COLLATERAL_RATIO,\r\n  CRITICAL_COLLATERAL_RATIO,\r\n  LiquityStoreState,\r\n  TroveClosureParams,\r\n  TroveCreationParams\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { COIN } from \"../../../strings\";\r\n\r\nimport { ActionDescription, Amount } from \"../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../ErrorDescription\";\r\n\r\nconst mcrPercent = new Percent(MINIMUM_COLLATERAL_RATIO).toString(0);\r\nconst ccrPercent = new Percent(CRITICAL_COLLATERAL_RATIO).toString(0);\r\n\r\ntype TroveAdjustmentDescriptionParams = {\r\n  params: TroveAdjustmentParams<Decimal>;\r\n};\r\n\r\nconst TroveChangeDescription: React.FC<TroveAdjustmentDescriptionParams> = ({ params }) => (\r\n  <ActionDescription>\r\n    {params.depositCollateral && params.borrowLUSD ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount> and receive{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.repayLUSD && params.withdrawCollateral ? (\r\n      <>\r\n        You will pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>{\" \"}\r\n        and receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.depositCollateral && params.repayLUSD ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount> and pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.borrowLUSD && params.withdrawCollateral ? (\r\n      <>\r\n        You will receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount> and{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : params.depositCollateral ? (\r\n      <>\r\n        You will deposit <Amount>{params.depositCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.withdrawCollateral ? (\r\n      <>\r\n        You will receive <Amount>{params.withdrawCollateral.prettify()} ETH</Amount>\r\n      </>\r\n    ) : params.borrowLUSD ? (\r\n      <>\r\n        You will receive{\" \"}\r\n        <Amount>\r\n          {params.borrowLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    ) : (\r\n      <>\r\n        You will pay{\" \"}\r\n        <Amount>\r\n          {params.repayLUSD.prettify()} {COIN}\r\n        </Amount>\r\n      </>\r\n    )}\r\n    .\r\n  </ActionDescription>\r\n);\r\n\r\nexport const selectForTroveChangeValidation = ({\r\n  price,\r\n  total,\r\n  accountBalance,\r\n  lusdBalance,\r\n  numberOfTroves\r\n}: LiquityStoreState) => ({ price, total, accountBalance, lusdBalance, numberOfTroves });\r\n\r\ntype TroveChangeValidationSelectedState = ReturnType<typeof selectForTroveChangeValidation>;\r\n\r\ninterface TroveChangeValidationContext extends TroveChangeValidationSelectedState {\r\n  originalTrove: Trove;\r\n  resultingTrove: Trove;\r\n  recoveryMode: boolean;\r\n  wouldTriggerRecoveryMode: boolean;\r\n}\r\n\r\nexport const validateTroveChange = (\r\n  originalTrove: Trove,\r\n  adjustedTrove: Trove,\r\n  borrowingRate: Decimal,\r\n  selectedState: TroveChangeValidationSelectedState\r\n): [\r\n  validChange: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }> | undefined,\r\n  description: JSX.Element | undefined\r\n] => {\r\n  const { total, price } = selectedState;\r\n  const change = originalTrove.whatChanged(adjustedTrove, borrowingRate);\r\n\r\n  if (!change) {\r\n    return [undefined, undefined];\r\n  }\r\n\r\n  // Reapply change to get the exact state the Trove will end up in (which could be slightly\r\n  // different from `edited` due to imprecision).\r\n  const resultingTrove = originalTrove.apply(change, borrowingRate);\r\n  const recoveryMode = total.collateralRatioIsBelowCritical(price);\r\n  const wouldTriggerRecoveryMode = total\r\n    .subtract(originalTrove)\r\n    .add(resultingTrove)\r\n    .collateralRatioIsBelowCritical(price);\r\n\r\n  const context: TroveChangeValidationContext = {\r\n    ...selectedState,\r\n    originalTrove,\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode\r\n  };\r\n\r\n  if (change.type === \"invalidCreation\") {\r\n    // Trying to create a Trove with negative net debt\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        Total debt must be at least{\" \"}\r\n        <Amount>\r\n          {LUSD_MINIMUM_DEBT.toString()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  const errorDescription =\r\n    change.type === \"creation\"\r\n      ? validateTroveCreation(change.params, context)\r\n      : change.type === \"closure\"\r\n      ? validateTroveClosure(change.params, context)\r\n      : validateTroveAdjustment(change.params, context);\r\n\r\n  if (errorDescription) {\r\n    return [undefined, errorDescription];\r\n  }\r\n\r\n  return [change, <TroveChangeDescription params={change.params} />];\r\n};\r\n\r\nconst validateTroveCreation = (\r\n  { depositCollateral, borrowLUSD }: TroveCreationParams<Decimal>,\r\n  {\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    accountBalance,\r\n    price\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (borrowLUSD.lt(LUSD_MINIMUM_NET_DEBT)) {\r\n    return (\r\n      <ErrorDescription>\r\n        You must borrow at least{\" \"}\r\n        <Amount>\r\n          {LUSD_MINIMUM_NET_DEBT.toString()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (recoveryMode) {\r\n    if (!resultingTrove.isOpenableInRecoveryMode(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to open a Trove with less than <Amount>{ccrPercent}</Amount> Collateral\r\n          Ratio during recovery mode. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  } else {\r\n    if (resultingTrove.collateralRatioIsBelowMinimum(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Collateral ratio must be at least <Amount>{mcrPercent}</Amount>.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (wouldTriggerRecoveryMode) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to open a Trove that would cause the Total Collateral Ratio to fall\r\n          below <Amount>{ccrPercent}</Amount>. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (depositCollateral.gt(accountBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>{depositCollateral.sub(accountBalance).prettify()} ETH</Amount>.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst validateTroveAdjustment = (\r\n  { depositCollateral, withdrawCollateral, borrowLUSD, repayLUSD }: TroveAdjustmentParams<Decimal>,\r\n  {\r\n    originalTrove,\r\n    resultingTrove,\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    price,\r\n    accountBalance,\r\n    lusdBalance\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (recoveryMode) {\r\n    if (withdrawCollateral) {\r\n      return (\r\n        <ErrorDescription>\r\n          You're not allowed to withdraw collateral during recovery mode.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (borrowLUSD) {\r\n      if (resultingTrove.collateralRatioIsBelowCritical(price)) {\r\n        return (\r\n          <ErrorDescription>\r\n            Your collateral ratio must be at least <Amount>{ccrPercent}</Amount> to borrow during\r\n            recovery mode. Please improve your collateral ratio.\r\n          </ErrorDescription>\r\n        );\r\n      }\r\n\r\n      if (resultingTrove.collateralRatio(price).lt(originalTrove.collateralRatio(price))) {\r\n        return (\r\n          <ErrorDescription>\r\n            You're not allowed to decrease your collateral ratio during recovery mode.\r\n          </ErrorDescription>\r\n        );\r\n      }\r\n    }\r\n  } else {\r\n    if (resultingTrove.collateralRatioIsBelowMinimum(price)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Collateral ratio must be at least <Amount>{mcrPercent}</Amount>.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (wouldTriggerRecoveryMode) {\r\n      return (\r\n        <ErrorDescription>\r\n          The adjustment you're trying to make would cause the Total Collateral Ratio to fall below{\" \"}\r\n          <Amount>{ccrPercent}</Amount>. Please increase your Trove's Collateral Ratio.\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (repayLUSD) {\r\n    if (resultingTrove.debt.lt(LUSD_MINIMUM_DEBT)) {\r\n      return (\r\n        <ErrorDescription>\r\n          Total debt must be at least{\" \"}\r\n          <Amount>\r\n            {LUSD_MINIMUM_DEBT.toString()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n\r\n    if (repayLUSD.gt(lusdBalance)) {\r\n      return (\r\n        <ErrorDescription>\r\n          The amount you're trying to repay exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {repayLUSD.sub(lusdBalance).prettify()} {COIN}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      );\r\n    }\r\n  }\r\n\r\n  if (depositCollateral?.gt(accountBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>{depositCollateral.sub(accountBalance).prettify()} ETH</Amount>.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst validateTroveClosure = (\r\n  { repayLUSD }: TroveClosureParams<Decimal>,\r\n  {\r\n    recoveryMode,\r\n    wouldTriggerRecoveryMode,\r\n    numberOfTroves,\r\n    lusdBalance\r\n  }: TroveChangeValidationContext\r\n): JSX.Element | null => {\r\n  if (numberOfTroves === 1) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close your Trove when there are no other Troves in the system.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (recoveryMode) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close your Trove during recovery mode.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (repayLUSD?.gt(lusdBalance)) {\r\n    return (\r\n      <ErrorDescription>\r\n        You need{\" \"}\r\n        <Amount>\r\n          {repayLUSD.sub(lusdBalance).prettify()} {COIN}\r\n        </Amount>{\" \"}\r\n        more to close your Trove.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  if (wouldTriggerRecoveryMode) {\r\n    return (\r\n      <ErrorDescription>\r\n        You're not allowed to close a Trove if it would cause the Total Collateralization Ratio to\r\n        fall below <Amount>{ccrPercent}</Amount>. Please wait until the Total Collateral Ratio\r\n        increases.\r\n      </ErrorDescription>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n","import { useCallback, useEffect } from \"react\";\r\nimport { Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState, Decimal, Trove, Decimalish, LUSD_MINIMUM_DEBT } from \"@liquity/lib-base\";\r\n\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\n\r\nimport { TroveEditor } from \"./TroveEditor\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\n\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst init = ({ trove }: LiquityStoreState) => ({\r\n  original: trove,\r\n  edited: new Trove(trove.collateral, trove.debt),\r\n  changePending: false,\r\n  debtDirty: false,\r\n  addedMinimumDebt: false\r\n});\r\n\r\ntype TroveManagerState = ReturnType<typeof init>;\r\ntype TroveManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"startChange\" | \"finishChange\" | \"revert\" | \"addMinimumDebt\" | \"removeMinimumDebt\" }\r\n  | { type: \"setCollateral\" | \"setDebt\"; newValue: Decimalish };\r\n\r\nconst reduceWith = (action: TroveManagerAction) => (state: TroveManagerState): TroveManagerState =>\r\n  reduce(state, action);\r\n\r\nconst addMinimumDebt = reduceWith({ type: \"addMinimumDebt\" });\r\nconst removeMinimumDebt = reduceWith({ type: \"removeMinimumDebt\" });\r\nconst finishChange = reduceWith({ type: \"finishChange\" });\r\nconst revert = reduceWith({ type: \"revert\" });\r\n\r\nconst reduce = (state: TroveManagerState, action: TroveManagerAction): TroveManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { original, edited, changePending, debtDirty, addedMinimumDebt } = state;\r\n\r\n  switch (action.type) {\r\n    case \"startChange\": {\r\n      console.log(\"starting change\");\r\n      return { ...state, changePending: true };\r\n    }\r\n\r\n    case \"finishChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"setCollateral\": {\r\n      const newCollateral = Decimal.from(action.newValue);\r\n\r\n      const newState = {\r\n        ...state,\r\n        edited: edited.setCollateral(newCollateral)\r\n      };\r\n\r\n      if (!debtDirty) {\r\n        if (edited.isEmpty && newCollateral.nonZero) {\r\n          return addMinimumDebt(newState);\r\n        }\r\n        if (addedMinimumDebt && newCollateral.isZero) {\r\n          return removeMinimumDebt(newState);\r\n        }\r\n      }\r\n\r\n      return newState;\r\n    }\r\n\r\n    case \"setDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(action.newValue),\r\n        debtDirty: true\r\n      };\r\n\r\n    case \"addMinimumDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(LUSD_MINIMUM_DEBT),\r\n        addedMinimumDebt: true\r\n      };\r\n\r\n    case \"removeMinimumDebt\":\r\n      return {\r\n        ...state,\r\n        edited: edited.setDebt(0),\r\n        addedMinimumDebt: false\r\n      };\r\n\r\n    case \"revert\":\r\n      return {\r\n        ...state,\r\n        edited: new Trove(original.collateral, original.debt),\r\n        debtDirty: false,\r\n        addedMinimumDebt: false\r\n      };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        newState: { trove },\r\n        stateChange: { troveBeforeRedistribution: changeCommitted }\r\n      } = action;\r\n\r\n      const newState = {\r\n        ...state,\r\n        original: trove\r\n      };\r\n\r\n      if (changePending && changeCommitted) {\r\n        return finishChange(revert(newState));\r\n      }\r\n\r\n      const change = original.whatChanged(edited, 0);\r\n\r\n      if (\r\n        (change?.type === \"creation\" && !trove.isEmpty) ||\r\n        (change?.type === \"closure\" && trove.isEmpty)\r\n      ) {\r\n        return revert(newState);\r\n      }\r\n\r\n      return { ...newState, edited: trove.apply(change, 0) };\r\n    }\r\n  }\r\n};\r\n\r\nconst feeFrom = (original: Trove, edited: Trove, borrowingRate: Decimal): Decimal => {\r\n  const change = original.whatChanged(edited, borrowingRate);\r\n\r\n  if (change && change.type !== \"invalidCreation\" && change.params.borrowLUSD) {\r\n    return change.params.borrowLUSD.mul(borrowingRate);\r\n  } else {\r\n    return Decimal.ZERO;\r\n  }\r\n};\r\n\r\nconst select = (state: LiquityStoreState) => ({\r\n  fees: state.fees,\r\n  validationContext: selectForTroveChangeValidation(state)\r\n});\r\n\r\nconst transactionIdPrefix = \"trove-\";\r\nconst transactionIdMatcher = new RegExp(`^${transactionIdPrefix}`);\r\n\r\ntype TroveManagerProps = {\r\n  collateral?: Decimalish;\r\n  debt?: Decimalish;\r\n};\r\n\r\nexport const TroveManager: React.FC<TroveManagerProps> = ({ collateral, debt }) => {\r\n  const [{ original, edited, changePending }, dispatch] = useLiquityReducer(reduce, init);\r\n  const { fees, validationContext } = useLiquitySelector(select);\r\n\r\n  useEffect(() => {\r\n    if (collateral !== undefined) {\r\n      dispatch({ type: \"setCollateral\", newValue: collateral });\r\n    }\r\n    if (debt !== undefined) {\r\n      dispatch({ type: \"setDebt\", newValue: debt });\r\n    }\r\n  }, [collateral, debt, dispatch]);\r\n\r\n  const borrowingRate = fees.borrowingRate();\r\n  const maxBorrowingRate = borrowingRate.add(0.005); // TODO slippage tolerance\r\n\r\n  const [validChange, description] = validateTroveChange(\r\n    original,\r\n    edited,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleCancel = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const openingNewTrove = original.isEmpty;\r\n\r\n  const myTransactionState = useMyTransactionState(transactionIdMatcher);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      myTransactionState.type === \"waitingForApproval\" ||\r\n      myTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (myTransactionState.type === \"failed\" || myTransactionState.type === \"cancelled\") {\r\n      dispatch({ type: \"finishChange\" });\r\n    } else if (myTransactionState.type === \"confirmedOneShot\") {\r\n      if (myTransactionState.id === `${transactionIdPrefix}closure`) {\r\n        dispatchEvent(\"TROVE_CLOSED\");\r\n      } else {\r\n        dispatchEvent(\"TROVE_ADJUSTED\");\r\n      }\r\n    }\r\n  }, [myTransactionState, dispatch, dispatchEvent]);\r\n\r\n  return (\r\n    <TroveEditor\r\n      original={original}\r\n      edited={edited}\r\n      fee={feeFrom(original, edited, borrowingRate)}\r\n      borrowingRate={borrowingRate}\r\n      changePending={changePending}\r\n      dispatch={dispatch}\r\n    >\r\n      {description ??\r\n        (openingNewTrove ? (\r\n          <ActionDescription>\r\n            Start by entering the amount of ETH you'd like to deposit as collateral.\r\n          </ActionDescription>\r\n        ) : (\r\n          <ActionDescription>\r\n            Adjust your Trove by modifying its collateral, debt, or both.\r\n          </ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleCancel}>\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <TroveAction\r\n            transactionId={`${transactionIdPrefix}${validChange.type}`}\r\n            change={validChange}\r\n            maxBorrowingRate={maxBorrowingRate}\r\n            borrowingFeeDecayToleranceMinutes={60}\r\n          >\r\n            Confirm\r\n          </TroveAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </TroveEditor>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { DisabledEditableRow } from \"./Editor\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { Icon } from \"../Icon\";\r\nimport { COIN } from \"../../strings\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\n\r\nconst select = ({ trove, price }: LiquityStoreState) => ({ trove, price });\r\n\r\nexport const ReadOnlyTrove: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const handleAdjustTrove = useCallback(() => {\r\n    dispatchEvent(\"ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n  const handleCloseTrove = useCallback(() => {\r\n    dispatchEvent(\"CLOSE_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const { trove, price } = useLiquitySelector(select);\r\n\r\n  // console.log(\"READONLY TROVE\", trove.collateral.prettify(4));\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Box>\r\n          <DisabledEditableRow\r\n            label=\"Collateral\"\r\n            inputId=\"trove-collateral\"\r\n            amount={trove.collateral.prettify(4)}\r\n            unit=\"ETH\"\r\n          />\r\n\r\n          <DisabledEditableRow\r\n            label=\"Debt\"\r\n            inputId=\"trove-debt\"\r\n            amount={trove.debt.prettify()}\r\n            unit={COIN}\r\n          />\r\n\r\n          <CollateralRatio value={trove.collateralRatio(price)} />\r\n        </Box>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={handleCloseTrove}>\r\n            Close Trove\r\n          </Button>\r\n          <Button onClick={handleAdjustTrove}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { Box, Flex, Heading, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\ntype InfoMessageProps = {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n};\r\n\r\nexport const InfoMessage: React.FC<InfoMessageProps> = ({ title, children, icon }) => (\r\n  <Box sx={{ mx: 1, mb: 3 }}>\r\n    <Flex sx={{ alignItems: \"center\", mb: \"10px\" }}>\r\n      <Box sx={{ mr: \"12px\", fontSize: \"20px\" }}>{icon || <Icon name=\"info-circle\" />}</Box>\r\n\r\n      <Heading as=\"h3\">{title}</Heading>\r\n    </Flex>\r\n\r\n    <Text sx={{ fontSize: 2 }}>{children}</Text>\r\n  </Box>\r\n);\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\n\r\nexport const NoTrove: React.FC = props => {\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"You haven't borrowed any LUSD yet.\">\r\n          You can borrow LUSD by opening a Trove.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button onClick={handleOpenTrove}>Open Trove</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { useEffect, useState } from \"react\";\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\n\r\ntype ValidTroveChange = Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n\r\nconst paramsEq = (a?: Decimal, b?: Decimal) => (a && b ? a.eq(b) : !a && !b);\r\n\r\nconst equals = (a: ValidTroveChange, b: ValidTroveChange): boolean => {\r\n  return (\r\n    a.type === b.type &&\r\n    paramsEq(a.params.borrowLUSD, b.params.borrowLUSD) &&\r\n    paramsEq(a.params.repayLUSD, b.params.repayLUSD) &&\r\n    paramsEq(a.params.depositCollateral, b.params.depositCollateral) &&\r\n    paramsEq(a.params.withdrawCollateral, b.params.withdrawCollateral)\r\n  );\r\n};\r\n\r\nexport const useStableTroveChange = (\r\n  troveChange: ValidTroveChange | undefined\r\n): ValidTroveChange | undefined => {\r\n  const [stableTroveChange, setStableTroveChange] = useState(troveChange);\r\n\r\n  useEffect(() => {\r\n    if (!!stableTroveChange !== !!troveChange) {\r\n      setStableTroveChange(troveChange);\r\n    } else if (stableTroveChange && troveChange && !equals(stableTroveChange, troveChange)) {\r\n      setStableTroveChange(troveChange);\r\n    }\r\n  }, [stableTroveChange, troveChange]);\r\n\r\n  return stableTroveChange;\r\n};\r\n","import { Box, Flex, Text } from \"theme-ui\";\r\n\r\nimport { Icon } from \"./Icon\";\r\n\r\nexport const Warning: React.FC = ({ children }) => (\r\n  <Box\r\n    sx={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      justifyContent: \"space-around\",\r\n\r\n      mb: [2, 3],\r\n      p: 3,\r\n\r\n      border: 1,\r\n      borderRadius: \"8px\",\r\n      borderColor: \"warning\",\r\n      boxShadow: 2\r\n      // bg: \"rgba(46, 182, 234, 0.05)\"\r\n    }}\r\n  >\r\n    <Flex sx={{ alignItems: \"center\" }}>\r\n      <Icon name=\"exclamation-triangle\" size=\"lg\" />\r\n      <Text sx={{ ml: 2 }}>{children}</Text>\r\n    </Flex>\r\n  </Box>\r\n);\r\n","import React, { useEffect } from \"react\";\r\n\r\nimport { Decimal, TroveChange } from \"@liquity/lib-base\";\r\nimport { PopulatedEthersLiquityTransaction } from \"@liquity/lib-ethers\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { Warning } from \"../Warning\";\r\n\r\nexport type GasEstimationState =\r\n  | { type: \"idle\" | \"inProgress\" }\r\n  | { type: \"complete\"; populatedTx: PopulatedEthersLiquityTransaction };\r\n\r\ntype ExpensiveTroveChangeWarningParams = {\r\n  troveChange?: Exclude<TroveChange<Decimal>, { type: \"invalidCreation\" }>;\r\n  maxBorrowingRate: Decimal;\r\n  borrowingFeeDecayToleranceMinutes: number;\r\n  gasEstimationState: GasEstimationState;\r\n  setGasEstimationState: (newState: GasEstimationState) => void;\r\n};\r\n\r\nexport const ExpensiveTroveChangeWarning: React.FC<ExpensiveTroveChangeWarningParams> = ({\r\n  troveChange,\r\n  maxBorrowingRate,\r\n  borrowingFeeDecayToleranceMinutes,\r\n  gasEstimationState,\r\n  setGasEstimationState\r\n}) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  useEffect(() => {\r\n    if (troveChange && troveChange.type !== \"closure\") {\r\n      setGasEstimationState({ type: \"inProgress\" });\r\n\r\n      let cancelled = false;\r\n\r\n      const timeoutId = setTimeout(async () => {\r\n        const populatedTx = await (troveChange.type === \"creation\"\r\n          ? liquity.populate.openTrove(troveChange.params, {\r\n              maxBorrowingRate,\r\n              borrowingFeeDecayToleranceMinutes\r\n            })\r\n          : liquity.populate.adjustTrove(troveChange.params, {\r\n              maxBorrowingRate,\r\n              borrowingFeeDecayToleranceMinutes\r\n            }));\r\n\r\n        if (!cancelled) {\r\n          setGasEstimationState({ type: \"complete\", populatedTx });\r\n          console.log(\r\n            \"Estimated TX cost: \" +\r\n              Decimal.from(`${populatedTx.rawPopulatedTransaction.gasLimit}`).prettify(0)\r\n          );\r\n        }\r\n      }, 333);\r\n\r\n      return () => {\r\n        clearTimeout(timeoutId);\r\n        cancelled = true;\r\n      };\r\n    } else {\r\n      setGasEstimationState({ type: \"idle\" });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [troveChange]);\r\n\r\n  if (\r\n    troveChange &&\r\n    gasEstimationState.type === \"complete\" &&\r\n    gasEstimationState.populatedTx.gasHeadroom !== undefined &&\r\n    gasEstimationState.populatedTx.gasHeadroom >= 200000\r\n  ) {\r\n    return troveChange.type === \"creation\" ? (\r\n      <Warning>\r\n        The cost of opening a Trove in this collateral ratio range is rather high. To lower it,\r\n        choose a slightly different collateral ratio.\r\n      </Warning>\r\n    ) : (\r\n      <Warning>\r\n        The cost of adjusting a Trove into this collateral ratio range is rather high. To lower it,\r\n        choose a slightly different collateral ratio.\r\n      </Warning>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n","import React, { useCallback, useEffect, useState } from \"react\";\r\nimport { Flex, Button, Box, Card, Heading, Spinner } from \"theme-ui\";\r\nimport {\r\n  LiquityStoreState,\r\n  Decimal,\r\n  Trove,\r\n  LUSD_LIQUIDATION_RESERVE,\r\n  LUSD_MINIMUM_NET_DEBT,\r\n  Percent\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useStableTroveChange } from \"../../hooks/useStableTroveChange\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { COIN } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { EditableRow, StaticRow } from \"./Editor\";\r\nimport { ExpensiveTroveChangeWarning, GasEstimationState } from \"./ExpensiveTroveChangeWarning\";\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst selector = (state: LiquityStoreState) => {\r\n  const { fees, price, accountBalance } = state;\r\n  return {\r\n    fees,\r\n    price,\r\n    accountBalance,\r\n    validationContext: selectForTroveChangeValidation(state)\r\n  };\r\n};\r\n\r\nconst EMPTY_TROVE = new Trove(Decimal.ZERO, Decimal.ZERO);\r\nconst TRANSACTION_ID = \"trove-creation\";\r\nconst GAS_ROOM_ETH = Decimal.from(0.1);\r\n\r\nexport const Opening: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const { fees, price, accountBalance, validationContext } = useLiquitySelector(selector);\r\n  const borrowingRate = fees.borrowingRate();\r\n  const editingState = useState<string>();\r\n\r\n  const [collateral, setCollateral] = useState<Decimal>(Decimal.ZERO);\r\n  const [borrowAmount, setBorrowAmount] = useState<Decimal>(Decimal.ZERO);\r\n\r\n  const maxBorrowingRate = borrowingRate.add(0.005);\r\n\r\n  const fee = borrowAmount.mul(borrowingRate);\r\n  const feePct = new Percent(borrowingRate);\r\n  const totalDebt = borrowAmount.add(LUSD_LIQUIDATION_RESERVE).add(fee);\r\n  const isDirty = !collateral.isZero || !borrowAmount.isZero;\r\n  const trove = isDirty ? new Trove(collateral, totalDebt) : EMPTY_TROVE;\r\n  const maxCollateral = accountBalance.gt(GAS_ROOM_ETH)\r\n    ? accountBalance.sub(GAS_ROOM_ETH)\r\n    : Decimal.ZERO;\r\n  const collateralMaxedOut = collateral.eq(maxCollateral);\r\n  const collateralRatio =\r\n    !collateral.isZero && !borrowAmount.isZero ? trove.collateralRatio(price) : undefined;\r\n\r\n  const [troveChange, description] = validateTroveChange(\r\n    EMPTY_TROVE,\r\n    trove,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const stableTroveChange = useStableTroveChange(troveChange);\r\n  const [gasEstimationState, setGasEstimationState] = useState<GasEstimationState>({ type: \"idle\" });\r\n\r\n  const transactionState = useMyTransactionState(TRANSACTION_ID);\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const reset = useCallback(() => {\r\n    setCollateral(Decimal.ZERO);\r\n    setBorrowAmount(Decimal.ZERO);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!collateral.isZero && borrowAmount.isZero) {\r\n      setBorrowAmount(LUSD_MINIMUM_NET_DEBT);\r\n    }\r\n  }, [collateral, borrowAmount]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Trove\r\n        {isDirty && !isTransactionPending && (\r\n          <Button variant=\"titleIcon\" sx={{ \":enabled:hover\": { color: \"danger\" } }} onClick={reset}>\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={collateral.prettify(4)}\r\n          maxAmount={maxCollateral.toString()}\r\n          maxedOut={collateralMaxedOut}\r\n          editingState={editingState}\r\n          unit=\"ETH\"\r\n          editedAmount={collateral.toString(4)}\r\n          setEditedAmount={(amount: string) => setCollateral(Decimal.from(amount))}\r\n        />\r\n\r\n        <EditableRow\r\n          label=\"Borrow\"\r\n          inputId=\"trove-borrow-amount\"\r\n          amount={borrowAmount.prettify()}\r\n          unit={COIN}\r\n          editingState={editingState}\r\n          editedAmount={borrowAmount.toString(2)}\r\n          setEditedAmount={(amount: string) => setBorrowAmount(Decimal.from(amount))}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Liquidation Reserve\"\r\n          inputId=\"trove-liquidation-reserve\"\r\n          amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                  An amount set aside to cover the liquidator’s gas costs if your Trove needs to be\r\n                  liquidated. The amount increases your debt and is refunded if you close your Trove\r\n                  by fully paying off its net debt.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.prettify(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Total debt\"\r\n          inputId=\"trove-total-debt\"\r\n          amount={totalDebt.prettify(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  The total amount of LUSD your Trove will hold.{\" \"}\r\n                  {isDirty && (\r\n                    <>\r\n                      You will need to repay {totalDebt.sub(LUSD_LIQUIDATION_RESERVE).prettify(2)}{\" \"}\r\n                      LUSD to reclaim your collateral ({LUSD_LIQUIDATION_RESERVE.toString()} LUSD\r\n                      Liquidation Reserve excluded).\r\n                    </>\r\n                  )}\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} />\r\n\r\n        {description ?? (\r\n          <ActionDescription>\r\n            Start by entering the amount of ETH you'd like to deposit as collateral.\r\n          </ActionDescription>\r\n        )}\r\n\r\n        <ExpensiveTroveChangeWarning\r\n          troveChange={stableTroveChange}\r\n          maxBorrowingRate={maxBorrowingRate}\r\n          borrowingFeeDecayToleranceMinutes={60}\r\n          gasEstimationState={gasEstimationState}\r\n          setGasEstimationState={setGasEstimationState}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n\r\n          {gasEstimationState.type === \"inProgress\" ? (\r\n            <Button disabled>\r\n              <Spinner size=\"24px\" sx={{ color: \"background\" }} />\r\n            </Button>\r\n          ) : stableTroveChange ? (\r\n            <TroveAction\r\n              transactionId={TRANSACTION_ID}\r\n              change={stableTroveChange}\r\n              maxBorrowingRate={maxBorrowingRate}\r\n              borrowingFeeDecayToleranceMinutes={60}\r\n            >\r\n              Confirm\r\n            </TroveAction>\r\n          ) : (\r\n            <Button disabled>Confirm</Button>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback, useEffect, useState, useRef } from \"react\";\r\nimport { Flex, Button, Box, Card, Heading } from \"theme-ui\";\r\nimport {\r\n  LiquityStoreState,\r\n  Decimal,\r\n  Trove,\r\n  LUSD_LIQUIDATION_RESERVE,\r\n  Percent,\r\n  Difference\r\n} from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useStableTroveChange } from \"../../hooks/useStableTroveChange\";\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { TroveAction } from \"./TroveAction\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { COIN } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { CollateralRatio } from \"./CollateralRatio\";\r\nimport { EditableRow, StaticRow } from \"./Editor\";\r\nimport { ExpensiveTroveChangeWarning, GasEstimationState } from \"./ExpensiveTroveChangeWarning\";\r\nimport {\r\n  selectForTroveChangeValidation,\r\n  validateTroveChange\r\n} from \"./validation/validateTroveChange\";\r\n\r\nconst selector = (state: LiquityStoreState) => {\r\n  const { trove, fees, price, accountBalance } = state;\r\n  return {\r\n    trove,\r\n    fees,\r\n    price,\r\n    accountBalance,\r\n    validationContext: selectForTroveChangeValidation(state)\r\n  };\r\n};\r\n\r\nconst TRANSACTION_ID = \"trove-adjustment\";\r\nconst GAS_ROOM_ETH = Decimal.from(0.1);\r\n\r\nconst feeFrom = (original: Trove, edited: Trove, borrowingRate: Decimal): Decimal => {\r\n  const change = original.whatChanged(edited, borrowingRate);\r\n\r\n  if (change && change.type !== \"invalidCreation\" && change.params.borrowLUSD) {\r\n    return change.params.borrowLUSD.mul(borrowingRate);\r\n  } else {\r\n    return Decimal.ZERO;\r\n  }\r\n};\r\n\r\nconst applyUnsavedCollateralChanges = (unsavedChanges: Difference, trove: Trove) => {\r\n  if (unsavedChanges.absoluteValue) {\r\n    if (unsavedChanges.positive) {\r\n      return trove.collateral.add(unsavedChanges.absoluteValue);\r\n    }\r\n    if (unsavedChanges.negative) {\r\n      if (unsavedChanges.absoluteValue.lt(trove.collateral)) {\r\n        return trove.collateral.sub(unsavedChanges.absoluteValue);\r\n      }\r\n    }\r\n    return trove.collateral;\r\n  }\r\n  return trove.collateral;\r\n};\r\n\r\nconst applyUnsavedNetDebtChanges = (unsavedChanges: Difference, trove: Trove) => {\r\n  if (unsavedChanges.absoluteValue) {\r\n    if (unsavedChanges.positive) {\r\n      return trove.netDebt.add(unsavedChanges.absoluteValue);\r\n    }\r\n    if (unsavedChanges.negative) {\r\n      if (unsavedChanges.absoluteValue.lt(trove.netDebt)) {\r\n        return trove.netDebt.sub(unsavedChanges.absoluteValue);\r\n      }\r\n    }\r\n    return trove.netDebt;\r\n  }\r\n  return trove.netDebt;\r\n};\r\n\r\nexport const Adjusting: React.FC = () => {\r\n  const { dispatchEvent } = useTroveView();\r\n  const { trove, fees, price, accountBalance, validationContext } = useLiquitySelector(selector);\r\n  const editingState = useState<string>();\r\n  const previousTrove = useRef<Trove>(trove);\r\n  const [collateral, setCollateral] = useState<Decimal>(trove.collateral);\r\n  const [netDebt, setNetDebt] = useState<Decimal>(trove.netDebt);\r\n\r\n  const transactionState = useMyTransactionState(TRANSACTION_ID);\r\n  const borrowingRate = fees.borrowingRate();\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"TROVE_ADJUSTED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  useEffect(() => {\r\n    if (!previousTrove.current.collateral.eq(trove.collateral)) {\r\n      const unsavedChanges = Difference.between(collateral, previousTrove.current.collateral);\r\n      const nextCollateral = applyUnsavedCollateralChanges(unsavedChanges, trove);\r\n      setCollateral(nextCollateral);\r\n    }\r\n    if (!previousTrove.current.netDebt.eq(trove.netDebt)) {\r\n      const unsavedChanges = Difference.between(netDebt, previousTrove.current.netDebt);\r\n      const nextNetDebt = applyUnsavedNetDebtChanges(unsavedChanges, trove);\r\n      setNetDebt(nextNetDebt);\r\n    }\r\n    previousTrove.current = trove;\r\n  }, [trove, collateral, netDebt]);\r\n\r\n  const handleCancelPressed = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_ADJUST_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const reset = useCallback(() => {\r\n    setCollateral(trove.collateral);\r\n    setNetDebt(trove.netDebt);\r\n  }, [trove.collateral, trove.netDebt]);\r\n\r\n  const isDirty = !collateral.eq(trove.collateral) || !netDebt.eq(trove.netDebt);\r\n  const isDebtIncrease = netDebt.gt(trove.netDebt);\r\n  const debtIncreaseAmount = isDebtIncrease ? netDebt.sub(trove.netDebt) : Decimal.ZERO;\r\n\r\n  const fee = isDebtIncrease\r\n    ? feeFrom(trove, new Trove(trove.collateral, trove.debt.add(debtIncreaseAmount)), borrowingRate)\r\n    : Decimal.ZERO;\r\n  const totalDebt = netDebt.add(LUSD_LIQUIDATION_RESERVE).add(fee);\r\n  const maxBorrowingRate = borrowingRate.add(0.005);\r\n  const updatedTrove = isDirty ? new Trove(collateral, totalDebt) : trove;\r\n  const feePct = new Percent(borrowingRate);\r\n  const availableEth = accountBalance.gt(GAS_ROOM_ETH)\r\n    ? accountBalance.sub(GAS_ROOM_ETH)\r\n    : Decimal.ZERO;\r\n  const maxCollateral = trove.collateral.add(availableEth);\r\n  const collateralMaxedOut = collateral.eq(maxCollateral);\r\n  const collateralRatio =\r\n    !collateral.isZero && !netDebt.isZero ? updatedTrove.collateralRatio(price) : undefined;\r\n  const collateralRatioChange = Difference.between(collateralRatio, trove.collateralRatio(price));\r\n\r\n  const [troveChange, description] = validateTroveChange(\r\n    trove,\r\n    updatedTrove,\r\n    borrowingRate,\r\n    validationContext\r\n  );\r\n\r\n  const stableTroveChange = useStableTroveChange(troveChange);\r\n  const [gasEstimationState, setGasEstimationState] = useState<GasEstimationState>({ type: \"idle\" });\r\n\r\n  const isTransactionPending =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  if (trove.status !== \"open\") {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Trove\r\n        {isDirty && !isTransactionPending && (\r\n          <Button variant=\"titleIcon\" sx={{ \":enabled:hover\": { color: \"danger\" } }} onClick={reset}>\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Collateral\"\r\n          inputId=\"trove-collateral\"\r\n          amount={collateral.prettify(4)}\r\n          maxAmount={maxCollateral.toString()}\r\n          maxedOut={collateralMaxedOut}\r\n          editingState={editingState}\r\n          unit=\"ETH\"\r\n          editedAmount={collateral.toString(4)}\r\n          setEditedAmount={(amount: string) => setCollateral(Decimal.from(amount))}\r\n        />\r\n\r\n        <EditableRow\r\n          label=\"Net debt\"\r\n          inputId=\"trove-net-debt-amount\"\r\n          amount={netDebt.prettify()}\r\n          unit={COIN}\r\n          editingState={editingState}\r\n          editedAmount={netDebt.toString(2)}\r\n          setEditedAmount={(amount: string) => setNetDebt(Decimal.from(amount))}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Liquidation Reserve\"\r\n          inputId=\"trove-liquidation-reserve\"\r\n          amount={`${LUSD_LIQUIDATION_RESERVE}`}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n                  An amount set aside to cover the liquidator’s gas costs if your Trove needs to be\r\n                  liquidated. The amount increases your debt and is refunded if you close your Trove\r\n                  by fully paying off its net debt.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Borrowing Fee\"\r\n          inputId=\"trove-borrowing-fee\"\r\n          amount={fee.prettify(2)}\r\n          pendingAmount={feePct.toString(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  This amount is deducted from the borrowed amount as a one-time fee. There are no\r\n                  recurring fees for borrowing, which is thus interest-free.\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Total debt\"\r\n          inputId=\"trove-total-debt\"\r\n          amount={totalDebt.prettify(2)}\r\n          unit={COIN}\r\n          infoIcon={\r\n            <InfoIcon\r\n              tooltip={\r\n                <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                  The total amount of LUSD your Trove will hold.{\" \"}\r\n                  {isDirty && (\r\n                    <>\r\n                      You will need to repay {totalDebt.sub(LUSD_LIQUIDATION_RESERVE).prettify(2)}{\" \"}\r\n                      LUSD to reclaim your collateral ({LUSD_LIQUIDATION_RESERVE.toString()} LUSD\r\n                      Liquidation Reserve excluded).\r\n                    </>\r\n                  )}\r\n                </Card>\r\n              }\r\n            />\r\n          }\r\n        />\r\n\r\n        <CollateralRatio value={collateralRatio} change={collateralRatioChange} />\r\n\r\n        {description ?? (\r\n          <ActionDescription>\r\n            Adjust your Trove by modifying its collateral, debt, or both.\r\n          </ActionDescription>\r\n        )}\r\n\r\n        <ExpensiveTroveChangeWarning\r\n          troveChange={stableTroveChange}\r\n          maxBorrowingRate={maxBorrowingRate}\r\n          borrowingFeeDecayToleranceMinutes={60}\r\n          gasEstimationState={gasEstimationState}\r\n          setGasEstimationState={setGasEstimationState}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"cancel\" onClick={handleCancelPressed}>\r\n            Cancel\r\n          </Button>\r\n\r\n          {stableTroveChange ? (\r\n            <TroveAction\r\n              transactionId={TRANSACTION_ID}\r\n              change={stableTroveChange}\r\n              maxBorrowingRate={maxBorrowingRate}\r\n              borrowingFeeDecayToleranceMinutes={60}\r\n            >\r\n              Confirm\r\n            </TroveAction>\r\n          ) : (\r\n            <Button disabled>Confirm</Button>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n      {isTransactionPending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useEffect } from \"react\";\r\nimport { Button, Flex, Spinner } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Transaction, useMyTransactionState } from \"./Transaction\";\r\nimport { useTroveView } from \"./Trove/context/TroveViewContext\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  collateralSurplusBalance\r\n});\r\n\r\nexport const CollateralSurplusAction: React.FC = () => {\r\n  const { collateralSurplusBalance } = useLiquitySelector(select);\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const myTransactionId = \"claim-coll-surplus\";\r\n  const myTransactionState = useMyTransactionState(myTransactionId);\r\n\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  useEffect(() => {\r\n    if (myTransactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"TROVE_SURPLUS_COLLATERAL_CLAIMED\");\r\n    }\r\n  }, [myTransactionState.type, dispatchEvent]);\r\n\r\n  return myTransactionState.type === \"waitingForApproval\" ? (\r\n    <Flex variant=\"layout.actions\">\r\n      <Button disabled sx={{ mx: 2 }}>\r\n        <Spinner sx={{ mr: 2, color: \"white\" }} size=\"20px\" />\r\n        Waiting for your approval\r\n      </Button>\r\n    </Flex>\r\n  ) : myTransactionState.type !== \"waitingForConfirmation\" &&\r\n    myTransactionState.type !== \"confirmed\" ? (\r\n    <Flex variant=\"layout.actions\">\r\n      <Transaction\r\n        id={myTransactionId}\r\n        send={liquity.claimCollateralSurplus.bind(liquity, undefined)}\r\n      >\r\n        <Button sx={{ mx: 2 }}>Claim {collateralSurplusBalance.prettify()} ETH</Button>\r\n      </Transaction>\r\n    </Flex>\r\n  ) : null;\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Button, Flex } from \"theme-ui\";\r\nimport { CollateralSurplusAction } from \"../CollateralSurplusAction\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  hasSurplusCollateral: !collateralSurplusBalance.isZero\r\n});\r\n\r\nexport const RedeemedTrove: React.FC = () => {\r\n  const { hasSurplusCollateral } = useLiquitySelector(select);\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"Your Trove has been redeemed.\">\r\n          {hasSurplusCollateral\r\n            ? \"Please reclaim your remaining collateral before opening a new Trove.\"\r\n            : \"You can borrow LUSD by opening a Trove.\"}\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          {hasSurplusCollateral && <CollateralSurplusAction />}\r\n          {!hasSurplusCollateral && <Button onClick={handleOpenTrove}>Open Trove</Button>}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Button, Flex } from \"theme-ui\";\r\nimport { CollateralSurplusAction } from \"../CollateralSurplusAction\";\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\n\r\nconst select = ({ collateralSurplusBalance }: LiquityStoreState) => ({\r\n  hasSurplusCollateral: !collateralSurplusBalance.isZero\r\n});\r\n\r\nexport const LiquidatedTrove: React.FC = () => {\r\n  const { hasSurplusCollateral } = useLiquitySelector(select);\r\n  const { dispatchEvent } = useTroveView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"OPEN_TROVE_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Trove</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"Your Trove has been liquidated.\">\r\n          {hasSurplusCollateral\r\n            ? \"Please reclaim your remaining collateral before opening a new Trove.\"\r\n            : \"You can borrow LUSD by opening a Trove.\"}\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          {hasSurplusCollateral && <CollateralSurplusAction />}\r\n          {!hasSurplusCollateral && <Button onClick={handleOpenTrove}>Open Trove</Button>}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { TroveManager } from \"./TroveManager\";\r\nimport { ReadOnlyTrove } from \"./ReadOnlyTrove\";\r\nimport { NoTrove } from \"./NoTrove\";\r\nimport { Opening } from \"./Opening\";\r\nimport { Adjusting } from \"./Adjusting\";\r\nimport { RedeemedTrove } from \"./RedeemedTrove\";\r\nimport { useTroveView } from \"./context/TroveViewContext\";\r\nimport { LiquidatedTrove } from \"./LiquidatedTrove\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nexport const Trove: React.FC = props => {\r\n  const { view } = useTroveView();\r\n\r\n  switch (view) {\r\n    // loading state not needed, as main app has a loading spinner that blocks render until the liquity backend data is available\r\n    case \"ACTIVE\": {\r\n      return <ReadOnlyTrove {...props} />;\r\n    }\r\n    case \"ADJUSTING\": {\r\n      return <Adjusting {...props} />;\r\n    }\r\n    case \"CLOSING\": {\r\n      return <TroveManager {...props} collateral={Decimal.ZERO} debt={Decimal.ZERO} />;\r\n    }\r\n    case \"OPENING\": {\r\n      return <Opening {...props} />;\r\n    }\r\n    case \"LIQUIDATED\": {\r\n      return <LiquidatedTrove {...props} />;\r\n    }\r\n    case \"REDEEMED\": {\r\n      return <RedeemedTrove {...props} />;\r\n    }\r\n    case \"NONE\": {\r\n      return <NoTrove {...props} />;\r\n    }\r\n  }\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Heading, Box, Card, Button } from \"theme-ui\";\r\n\r\nimport {\r\n  Decimal,\r\n  Decimalish,\r\n  StabilityDeposit,\r\n  LiquityStoreState,\r\n  Difference\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { Icon } from \"../Icon\";\r\nimport { EditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\nconst select = ({ lusdBalance, lusdInStabilityPool }: LiquityStoreState) => ({\r\n  lusdBalance,\r\n  lusdInStabilityPool\r\n});\r\n\r\ntype StabilityDepositEditorProps = {\r\n  originalDeposit: StabilityDeposit;\r\n  editedLUSD: Decimal;\r\n  changePending: boolean;\r\n  dispatch: (action: { type: \"setDeposit\"; newValue: Decimalish } | { type: \"revert\" }) => void;\r\n};\r\n\r\nexport const StabilityDepositEditor: React.FC<StabilityDepositEditorProps> = ({\r\n  originalDeposit,\r\n  editedLUSD,\r\n  changePending,\r\n  dispatch,\r\n  children\r\n}) => {\r\n  const { lusdBalance, lusdInStabilityPool } = useLiquitySelector(select);\r\n  const editingState = useState<string>();\r\n\r\n  const edited = !editedLUSD.eq(originalDeposit.currentLUSD);\r\n\r\n  const maxAmount = originalDeposit.currentLUSD.add(lusdBalance);\r\n  const maxedOut = editedLUSD.eq(maxAmount);\r\n\r\n  const lusdInStabilityPoolAfterChange = lusdInStabilityPool\r\n    .sub(originalDeposit.currentLUSD)\r\n    .add(editedLUSD);\r\n\r\n  const originalPoolShare = originalDeposit.currentLUSD.mulDiv(100, lusdInStabilityPool);\r\n  const newPoolShare = editedLUSD.mulDiv(100, lusdInStabilityPoolAfterChange);\r\n  const poolShareChange =\r\n    originalDeposit.currentLUSD.nonZero &&\r\n    Difference.between(newPoolShare, originalPoolShare).nonZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        {edited && !changePending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => dispatch({ type: \"revert\" })}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Deposit\"\r\n          inputId=\"deposit-lqty\"\r\n          amount={editedLUSD.prettify()}\r\n          maxAmount={maxAmount.toString()}\r\n          maxedOut={maxedOut}\r\n          unit={COIN}\r\n          {...{ editingState }}\r\n          editedAmount={editedLUSD.toString(2)}\r\n          setEditedAmount={newValue => dispatch({ type: \"setDeposit\", newValue })}\r\n        />\r\n\r\n        {newPoolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"deposit-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"deposit-share\"\r\n            amount={newPoolShare.prettify(4)}\r\n            pendingAmount={poolShareChange?.prettify(4).concat(\"%\")}\r\n            pendingColor={poolShareChange?.positive ? \"success\" : \"danger\"}\r\n            unit=\"%\"\r\n          />\r\n        )}\r\n\r\n        {!originalDeposit.isEmpty && (\r\n          <>\r\n            <StaticRow\r\n              label=\"Liquidation gain\"\r\n              inputId=\"deposit-gain\"\r\n              amount={originalDeposit.collateralGain.prettify(4)}\r\n              color={originalDeposit.collateralGain.nonZero && \"success\"}\r\n              unit=\"ETH\"\r\n            />\r\n\r\n            <StaticRow\r\n              label=\"Reward\"\r\n              inputId=\"deposit-reward\"\r\n              amount={originalDeposit.lqtyReward.prettify()}\r\n              color={originalDeposit.lqtyReward.nonZero && \"success\"}\r\n              unit={GT}\r\n              infoIcon={\r\n                <InfoIcon\r\n                  tooltip={\r\n                    <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                      Although the LQTY rewards accrue every minute, the value on the UI only updates\r\n                      when a user transacts with the Stability Pool. Therefore you may receive more\r\n                      rewards than is displayed when you claim or adjust your deposit.\r\n                    </Card>\r\n                  }\r\n                />\r\n              }\r\n            />\r\n          </>\r\n        )}\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState, StabilityDepositChange } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype StabilityDepositActionProps = {\r\n  transactionId: string;\r\n  change: StabilityDepositChange<Decimal>;\r\n};\r\n\r\nconst selectFrontendRegistered = ({ frontend }: LiquityStoreState) =>\r\n  frontend.status === \"registered\";\r\n\r\nexport const StabilityDepositAction: React.FC<StabilityDepositActionProps> = ({\r\n  children,\r\n  transactionId,\r\n  change\r\n}) => {\r\n  const { config, liquity } = useLiquity();\r\n  const frontendRegistered = useLiquitySelector(selectFrontendRegistered);\r\n\r\n  const frontendTag = frontendRegistered ? config.frontendTag : undefined;\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    transactionId,\r\n    change.depositLUSD\r\n      ? liquity.send.depositLUSDInStabilityPool.bind(liquity.send, change.depositLUSD, frontendTag)\r\n      : liquity.send.withdrawLUSDFromStabilityPool.bind(liquity.send, change.withdrawLUSD)\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import { createContext, useContext } from \"react\";\r\nimport type { StabilityView, StabilityEvent } from \"./types\";\r\n\r\ntype StabilityViewContextType = {\r\n  view: StabilityView;\r\n  dispatchEvent: (event: StabilityEvent) => void;\r\n};\r\n\r\nexport const StabilityViewContext = createContext<StabilityViewContextType | null>(null);\r\n\r\nexport const useStabilityView = (): StabilityViewContextType => {\r\n  const context: StabilityViewContextType | null = useContext(StabilityViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <StabilityViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import React from \"react\";\r\n\r\nimport { Decimal, StabilityDeposit, StabilityDepositChange } from \"@liquity/lib-base\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\nimport { ActionDescription, Amount } from \"../ActionDescription\";\r\n\r\ntype StabilityActionDescriptionProps = {\r\n  originalDeposit: StabilityDeposit;\r\n  change: StabilityDepositChange<Decimal>;\r\n};\r\n\r\nexport const StabilityActionDescription: React.FC<StabilityActionDescriptionProps> = ({\r\n  originalDeposit,\r\n  change\r\n}) => {\r\n  const collateralGain = originalDeposit.collateralGain.nonZero?.prettify(4).concat(\" ETH\");\r\n  const lqtyReward = originalDeposit.lqtyReward.nonZero?.prettify().concat(\" \", GT);\r\n\r\n  return (\r\n    <ActionDescription>\r\n      {change.depositLUSD ? (\r\n        <>\r\n          You are depositing{\" \"}\r\n          <Amount>\r\n            {change.depositLUSD.prettify()} {COIN}\r\n          </Amount>{\" \"}\r\n          in the Stability Pool\r\n        </>\r\n      ) : (\r\n        <>\r\n          You are withdrawing{\" \"}\r\n          <Amount>\r\n            {change.withdrawLUSD.prettify()} {COIN}\r\n          </Amount>{\" \"}\r\n          to your wallet\r\n        </>\r\n      )}\r\n      {(collateralGain || lqtyReward) && (\r\n        <>\r\n          {\" \"}\r\n          and claiming at least{\" \"}\r\n          {collateralGain && lqtyReward ? (\r\n            <>\r\n              <Amount>{collateralGain}</Amount> and <Amount>{lqtyReward}</Amount>\r\n            </>\r\n          ) : (\r\n            <Amount>{collateralGain ?? lqtyReward}</Amount>\r\n          )}\r\n        </>\r\n      )}\r\n      .\r\n    </ActionDescription>\r\n  );\r\n};\r\n","import {\r\n  Decimal,\r\n  LiquityStoreState,\r\n  StabilityDeposit,\r\n  StabilityDepositChange\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { COIN } from \"../../../strings\";\r\nimport { Amount } from \"../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../ErrorDescription\";\r\nimport { StabilityActionDescription } from \"../StabilityActionDescription\";\r\n\r\nexport const selectForStabilityDepositChangeValidation = ({\r\n  trove,\r\n  lusdBalance,\r\n  ownFrontend,\r\n  haveUndercollateralizedTroves\r\n}: LiquityStoreState) => ({\r\n  trove,\r\n  lusdBalance,\r\n  haveOwnFrontend: ownFrontend.status === \"registered\",\r\n  haveUndercollateralizedTroves\r\n});\r\n\r\ntype StabilityDepositChangeValidationContext = ReturnType<\r\n  typeof selectForStabilityDepositChangeValidation\r\n>;\r\n\r\nexport const validateStabilityDepositChange = (\r\n  originalDeposit: StabilityDeposit,\r\n  editedLUSD: Decimal,\r\n  {\r\n    lusdBalance,\r\n    haveOwnFrontend,\r\n    haveUndercollateralizedTroves\r\n  }: StabilityDepositChangeValidationContext\r\n): [\r\n  validChange: StabilityDepositChange<Decimal> | undefined,\r\n  description: JSX.Element | undefined\r\n] => {\r\n  const change = originalDeposit.whatChanged(editedLUSD);\r\n\r\n  if (haveOwnFrontend) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        You can’t deposit using a wallet address that is registered as a frontend.\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  if (!change) {\r\n    return [undefined, undefined];\r\n  }\r\n\r\n  if (change.depositLUSD?.gt(lusdBalance)) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        The amount you're trying to deposit exceeds your balance by{\" \"}\r\n        <Amount>\r\n          {change.depositLUSD.sub(lusdBalance).prettify()} {COIN}\r\n        </Amount>\r\n        .\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  if (change.withdrawLUSD && haveUndercollateralizedTroves) {\r\n    return [\r\n      undefined,\r\n      <ErrorDescription>\r\n        You're not allowed to withdraw LUSD from your Stability Deposit when there are\r\n        undercollateralized Troves. Please liquidate those Troves or try again later.\r\n      </ErrorDescription>\r\n    ];\r\n  }\r\n\r\n  return [change, <StabilityActionDescription originalDeposit={originalDeposit} change={change} />];\r\n};\r\n","import React, { useCallback, useEffect } from \"react\";\r\nimport { Button, Flex } from \"theme-ui\";\r\n\r\nimport { Decimal, Decimalish, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN } from \"../../strings\";\r\n\r\nimport { ActionDescription } from \"../ActionDescription\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\n\r\nimport { StabilityDepositEditor } from \"./StabilityDepositEditor\";\r\nimport { StabilityDepositAction } from \"./StabilityDepositAction\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport {\r\n  selectForStabilityDepositChangeValidation,\r\n  validateStabilityDepositChange\r\n} from \"./validation/validateStabilityDepositChange\";\r\n\r\nconst init = ({ stabilityDeposit }: LiquityStoreState) => ({\r\n  originalDeposit: stabilityDeposit,\r\n  editedLUSD: stabilityDeposit.currentLUSD,\r\n  changePending: false\r\n});\r\n\r\ntype StabilityDepositManagerState = ReturnType<typeof init>;\r\ntype StabilityDepositManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"startChange\" | \"finishChange\" | \"revert\" }\r\n  | { type: \"setDeposit\"; newValue: Decimalish };\r\n\r\nconst reduceWith = (action: StabilityDepositManagerAction) => (\r\n  state: StabilityDepositManagerState\r\n): StabilityDepositManagerState => reduce(state, action);\r\n\r\nconst finishChange = reduceWith({ type: \"finishChange\" });\r\nconst revert = reduceWith({ type: \"revert\" });\r\n\r\nconst reduce = (\r\n  state: StabilityDepositManagerState,\r\n  action: StabilityDepositManagerAction\r\n): StabilityDepositManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { originalDeposit, editedLUSD, changePending } = state;\r\n\r\n  switch (action.type) {\r\n    case \"startChange\": {\r\n      console.log(\"changeStarted\");\r\n      return { ...state, changePending: true };\r\n    }\r\n\r\n    case \"finishChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"setDeposit\":\r\n      return { ...state, editedLUSD: Decimal.from(action.newValue) };\r\n\r\n    case \"revert\":\r\n      return { ...state, editedLUSD: originalDeposit.currentLUSD };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        stateChange: { stabilityDeposit: updatedDeposit }\r\n      } = action;\r\n\r\n      if (!updatedDeposit) {\r\n        return state;\r\n      }\r\n\r\n      const newState = { ...state, originalDeposit: updatedDeposit };\r\n\r\n      const changeCommitted =\r\n        !updatedDeposit.initialLUSD.eq(originalDeposit.initialLUSD) ||\r\n        updatedDeposit.currentLUSD.gt(originalDeposit.currentLUSD) ||\r\n        updatedDeposit.collateralGain.lt(originalDeposit.collateralGain) ||\r\n        updatedDeposit.lqtyReward.lt(originalDeposit.lqtyReward);\r\n\r\n      if (changePending && changeCommitted) {\r\n        return finishChange(revert(newState));\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        editedLUSD: updatedDeposit.apply(originalDeposit.whatChanged(editedLUSD))\r\n      };\r\n    }\r\n  }\r\n};\r\n\r\nconst transactionId = \"stability-deposit\";\r\n\r\nexport const StabilityDepositManager: React.FC = () => {\r\n  const [{ originalDeposit, editedLUSD, changePending }, dispatch] = useLiquityReducer(reduce, init);\r\n  const validationContext = useLiquitySelector(selectForStabilityDepositChangeValidation);\r\n  const { dispatchEvent } = useStabilityView();\r\n\r\n  const handleCancel = useCallback(() => {\r\n    dispatchEvent(\"CANCEL_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const [validChange, description] = validateStabilityDepositChange(\r\n    originalDeposit,\r\n    editedLUSD,\r\n    validationContext\r\n  );\r\n\r\n  const makingNewDeposit = originalDeposit.isEmpty;\r\n\r\n  const myTransactionState = useMyTransactionState(transactionId);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      myTransactionState.type === \"waitingForApproval\" ||\r\n      myTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (myTransactionState.type === \"failed\" || myTransactionState.type === \"cancelled\") {\r\n      dispatch({ type: \"finishChange\" });\r\n    } else if (myTransactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"DEPOSIT_CONFIRMED\");\r\n    }\r\n  }, [myTransactionState.type, dispatch, dispatchEvent]);\r\n\r\n  return (\r\n    <StabilityDepositEditor\r\n      originalDeposit={originalDeposit}\r\n      editedLUSD={editedLUSD}\r\n      changePending={changePending}\r\n      dispatch={dispatch}\r\n    >\r\n      {description ??\r\n        (makingNewDeposit ? (\r\n          <ActionDescription>Enter the amount of {COIN} you'd like to deposit.</ActionDescription>\r\n        ) : (\r\n          <ActionDescription>Adjust the {COIN} amount to deposit or withdraw.</ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleCancel}>\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <StabilityDepositAction transactionId={transactionId} change={validChange}>\r\n            Confirm\r\n          </StabilityDepositAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </StabilityDepositEditor>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../../Transaction\";\r\n\r\ntype ClaimAndMoveProps = {\r\n  disabled?: boolean;\r\n};\r\n\r\nexport const ClaimAndMove: React.FC<ClaimAndMoveProps> = ({ disabled, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stability-deposit\",\r\n    liquity.send.transferCollateralGainToTrove.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button\r\n      variant=\"outline\"\r\n      sx={{ mt: 3, width: \"100%\" }}\r\n      onClick={sendTransaction}\r\n      disabled={disabled}\r\n    >\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Button } from \"theme-ui\";\r\n\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../../Transaction\";\r\n\r\ntype ClaimRewardsProps = {\r\n  disabled?: boolean;\r\n};\r\n\r\nexport const ClaimRewards: React.FC<ClaimRewardsProps> = ({ disabled, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stability-deposit\",\r\n    liquity.send.withdrawGainsFromStabilityPool.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button onClick={sendTransaction} disabled={disabled}>\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nconst selector = ({ remainingStabilityPoolLQTYReward }: LiquityStoreState) => ({\r\n  remainingStabilityPoolLQTYReward\r\n});\r\n\r\nexport const RemainingLQTY: React.FC = () => {\r\n  const { remainingStabilityPoolLQTYReward } = useLiquitySelector(selector);\r\n\r\n  return (\r\n    <Flex sx={{ mr: 2, fontSize: 2, fontWeight: \"medium\" }}>\r\n      {remainingStabilityPoolLQTYReward.prettify(0)} LQTY remaining\r\n    </Flex>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\n\r\nexport const Badge: React.FC = ({ children }) => {\r\n  return <Flex variant=\"layout.badge\">{children}</Flex>;\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\n\r\ntype CoinGeckoSimplePriceResponse<T extends string, U extends string> = {\r\n  [P in T]: {\r\n    [Q in U]: number;\r\n  };\r\n};\r\n\r\nconst hasProp = <T, P extends string>(o: T, p: P): o is T & { [_ in P]: unknown } => p in o;\r\n\r\nconst validateCoinGeckoSimplePriceResponse = <T extends string, U extends string>(\r\n  expectedCoinIds: readonly T[],\r\n  expectedCurrencies: readonly U[],\r\n  body: unknown\r\n): CoinGeckoSimplePriceResponse<T, U> => {\r\n  if (typeof body !== \"object\" || body === null) {\r\n    throw new Error(`unexpected response from CoinGecko`);\r\n  }\r\n\r\n  for (const coinId of expectedCoinIds) {\r\n    if (!hasProp(body, coinId)) {\r\n      throw new Error(`coin \"${coinId}\" missing from CoinGecko response`);\r\n    }\r\n\r\n    const coinPrices = body[coinId];\r\n\r\n    for (const currency of expectedCurrencies) {\r\n      if (!hasProp(coinPrices, currency)) {\r\n        throw new Error(`currency \"${currency}\" missing from CoinGecko response`);\r\n      }\r\n\r\n      if (typeof coinPrices[currency] !== \"number\") {\r\n        throw new Error(`price of coin \"${coinId}\" in currency \"${currency}\" is not a number`);\r\n      }\r\n    }\r\n  }\r\n\r\n  return body as CoinGeckoSimplePriceResponse<T, U>;\r\n};\r\n\r\nconst fetchCoinGeckoSimplePrice = async <T extends string, U extends string>(\r\n  coinIds: readonly T[],\r\n  vsCurrencies: readonly U[]\r\n): Promise<CoinGeckoSimplePriceResponse<T, U>> => {\r\n  const simplePriceUrl =\r\n    \"https://api.coingecko.com/api/v3/simple/price?\" +\r\n    new URLSearchParams({\r\n      ids: coinIds.join(\",\"),\r\n      vs_currencies: vsCurrencies.join(\",\")\r\n    });\r\n\r\n  const response = await window.fetch(simplePriceUrl, {\r\n    headers: {\r\n      accept: \"application/json\"\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`couldn't fetch price from CoinGecko: got status ${response.status}`);\r\n  }\r\n\r\n  return validateCoinGeckoSimplePriceResponse(coinIds, vsCurrencies, await response.json());\r\n};\r\n\r\nexport interface LqtyPriceResponse {\r\n  lqtyPriceUSD: Decimal;\r\n}\r\n\r\nexport const fetchLqtyPrice = async (): Promise<LqtyPriceResponse> => {\r\n  const response = await fetchCoinGeckoSimplePrice([\"liquity\"] as const, [\"usd\"] as const);\r\n\r\n  return {\r\n    lqtyPriceUSD: Decimal.from(response.liquity.usd)\r\n  };\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Card, Paragraph, Text } from \"theme-ui\";\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { Badge } from \"../Badge\";\r\nimport { fetchLqtyPrice } from \"./context/fetchLqtyPrice\";\r\n\r\nconst selector = ({ lusdInStabilityPool, remainingStabilityPoolLQTYReward }: LiquityStoreState) => ({\r\n  lusdInStabilityPool,\r\n  remainingStabilityPoolLQTYReward\r\n});\r\n\r\nconst yearlyIssuanceFraction = 0.5;\r\nconst dailyIssuanceFraction = Decimal.from(1 - yearlyIssuanceFraction ** (1 / 365));\r\nconst dailyIssuancePercentage = dailyIssuanceFraction.mul(100);\r\n\r\nexport const Yield: React.FC = () => {\r\n  const { lusdInStabilityPool, remainingStabilityPoolLQTYReward } = useLiquitySelector(selector);\r\n\r\n  const [lqtyPrice, setLqtyPrice] = useState<Decimal | undefined>(undefined);\r\n  const hasZeroValue = remainingStabilityPoolLQTYReward.isZero || lusdInStabilityPool.isZero;\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { lqtyPriceUSD } = await fetchLqtyPrice();\r\n        setLqtyPrice(lqtyPriceUSD);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  if (hasZeroValue || lqtyPrice === undefined) return null;\r\n\r\n  const lqtyIssuanceOneDay = remainingStabilityPoolLQTYReward.mul(dailyIssuanceFraction);\r\n  const lqtyIssuanceOneDayInUSD = lqtyIssuanceOneDay.mul(lqtyPrice);\r\n  const aprPercentage = lqtyIssuanceOneDayInUSD.mulDiv(365 * 100, lusdInStabilityPool);\r\n  const remainingLqtyInUSD = remainingStabilityPoolLQTYReward.mul(lqtyPrice);\r\n\r\n  if (aprPercentage.isZero) return null;\r\n\r\n  return (\r\n    <Badge>\r\n      <Text>LQTY APR {aprPercentage.toString(2)}%</Text>\r\n      <InfoIcon\r\n        tooltip={\r\n          <Card variant=\"tooltip\" sx={{ width: [\"220px\", \"518px\"] }}>\r\n            <Paragraph>\r\n              An <Text sx={{ fontWeight: \"bold\" }}>estimate</Text> of the LQTY return on the LUSD\r\n              deposited to the Stability Pool over the next year, not including your ETH gains from\r\n              liquidations.\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\", mt: 2 }}>\r\n              ($LQTY_REWARDS * DAILY_ISSUANCE% / DEPOSITED_LUSD) * 365 * 100 ={\" \"}\r\n              <Text sx={{ fontWeight: \"bold\" }}> APR</Text>\r\n            </Paragraph>\r\n            <Paragraph sx={{ fontSize: \"12px\", fontFamily: \"monospace\" }}>\r\n              ($\r\n              {remainingLqtyInUSD.shorten()} * {dailyIssuancePercentage.toString(4)}% / $\r\n              {lusdInStabilityPool.shorten()}) * 365 * 100 =\r\n              <Text sx={{ fontWeight: \"bold\" }}> {aprPercentage.toString(2)}%</Text>\r\n            </Paragraph>\r\n          </Card>\r\n        }\r\n      ></InfoIcon>\r\n    </Badge>\r\n  );\r\n};\r\n","import React, { useCallback, useEffect } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\nimport { Icon } from \"../Icon\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { useMyTransactionState } from \"../Transaction\";\r\nimport { DisabledEditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { ClaimAndMove } from \"./actions/ClaimAndMove\";\r\nimport { ClaimRewards } from \"./actions/ClaimRewards\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport { RemainingLQTY } from \"./RemainingLQTY\";\r\nimport { Yield } from \"./Yield\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\n\r\nconst selector = ({ stabilityDeposit, trove, lusdInStabilityPool }: LiquityStoreState) => ({\r\n  stabilityDeposit,\r\n  trove,\r\n  lusdInStabilityPool\r\n});\r\n\r\nexport const ActiveDeposit: React.FC = () => {\r\n  const { dispatchEvent } = useStabilityView();\r\n  const { stabilityDeposit, trove, lusdInStabilityPool } = useLiquitySelector(selector);\r\n\r\n  const poolShare = stabilityDeposit.currentLUSD.mulDiv(100, lusdInStabilityPool);\r\n\r\n  const handleAdjustDeposit = useCallback(() => {\r\n    dispatchEvent(\"ADJUST_DEPOSIT_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  const hasReward = !stabilityDeposit.lqtyReward.isZero;\r\n  const hasGain = !stabilityDeposit.collateralGain.isZero;\r\n  const hasTrove = !trove.isEmpty;\r\n\r\n  const transactionId = \"stability-deposit\";\r\n  const transactionState = useMyTransactionState(transactionId);\r\n  const isWaitingForTransaction =\r\n    transactionState.type === \"waitingForApproval\" ||\r\n    transactionState.type === \"waitingForConfirmation\";\r\n\r\n  useEffect(() => {\r\n    if (transactionState.type === \"confirmedOneShot\") {\r\n      dispatchEvent(\"REWARDS_CLAIMED\");\r\n    }\r\n  }, [transactionState.type, dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        {!isWaitingForTransaction && (\r\n          <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n            <RemainingLQTY />\r\n          </Flex>\r\n        )}\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Box>\r\n          <DisabledEditableRow\r\n            label=\"Deposit\"\r\n            inputId=\"deposit-lusd\"\r\n            amount={stabilityDeposit.currentLUSD.prettify()}\r\n            unit={COIN}\r\n          />\r\n\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"deposit-share\"\r\n            amount={poolShare.prettify(4)}\r\n            unit=\"%\"\r\n          />\r\n\r\n          <StaticRow\r\n            label=\"Liquidation gain\"\r\n            inputId=\"deposit-gain\"\r\n            amount={stabilityDeposit.collateralGain.prettify(4)}\r\n            color={stabilityDeposit.collateralGain.nonZero && \"success\"}\r\n            unit=\"ETH\"\r\n          />\r\n\r\n          <Flex sx={{ alignItems: \"center\" }}>\r\n            <StaticRow\r\n              label=\"Reward\"\r\n              inputId=\"deposit-reward\"\r\n              amount={stabilityDeposit.lqtyReward.prettify()}\r\n              color={stabilityDeposit.lqtyReward.nonZero && \"success\"}\r\n              unit={GT}\r\n              infoIcon={\r\n                <InfoIcon\r\n                  tooltip={\r\n                    <Card variant=\"tooltip\" sx={{ width: \"240px\" }}>\r\n                      Although the LQTY rewards accrue every minute, the value on the UI only updates\r\n                      when a user transacts with the Stability Pool. Therefore you may receive more\r\n                      rewards than is displayed when you claim or adjust your deposit.\r\n                    </Card>\r\n                  }\r\n                />\r\n              }\r\n            />\r\n            <Flex sx={{ justifyContent: \"flex-end\", flex: 1 }}>\r\n              <Yield />\r\n            </Flex>\r\n          </Flex>\r\n        </Box>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={handleAdjustDeposit}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n\r\n          <ClaimRewards disabled={!hasGain && !hasReward}>Claim ETH and LQTY</ClaimRewards>\r\n        </Flex>\r\n\r\n        {hasTrove && (\r\n          <ClaimAndMove disabled={!hasGain}>Claim LQTY and move ETH to Trove</ClaimAndMove>\r\n        )}\r\n      </Box>\r\n\r\n      {isWaitingForTransaction && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useCallback } from \"react\";\r\nimport { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\nimport { RemainingLQTY } from \"./RemainingLQTY\";\r\nimport { Yield } from \"./Yield\";\r\n\r\nexport const NoDeposit: React.FC = props => {\r\n  const { dispatchEvent } = useStabilityView();\r\n\r\n  const handleOpenTrove = useCallback(() => {\r\n    dispatchEvent(\"DEPOSIT_PRESSED\");\r\n  }, [dispatchEvent]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        Stability Pool\r\n        <Flex sx={{ justifyContent: \"flex-end\" }}>\r\n          <RemainingLQTY />\r\n        </Flex>\r\n      </Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title=\"You have no LUSD in the Stability Pool.\">\r\n          You can earn ETH and LQTY rewards by depositing LUSD.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Flex sx={{ justifyContent: \"flex-start\", flex: 1, alignItems: \"center\" }}>\r\n            <Yield />\r\n          </Flex>\r\n          <Button onClick={handleOpenTrove}>Deposit</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { StabilityDepositManager } from \"./StabilityDepositManager\";\r\nimport { ActiveDeposit } from \"./ActiveDeposit\";\r\nimport { NoDeposit } from \"./NoDeposit\";\r\nimport { useStabilityView } from \"./context/StabilityViewContext\";\r\n\r\nexport const Stability: React.FC = props => {\r\n  const { view } = useStabilityView();\r\n\r\n  switch (view) {\r\n    case \"NONE\": {\r\n      return <NoDeposit {...props} />;\r\n    }\r\n    case \"DEPOSITING\": {\r\n      return <StabilityDepositManager {...props} />;\r\n    }\r\n    case \"ADJUSTING\": {\r\n      return <StabilityDepositManager {...props} />;\r\n    }\r\n    case \"ACTIVE\": {\r\n      return <ActiveDeposit {...props} />;\r\n    }\r\n  }\r\n};\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { Card, Box, Heading, Flex, Button, Label, Input } from \"theme-ui\";\r\n\r\nimport { Decimal, LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { Transaction } from \"./Transaction\";\r\n\r\nconst selectPrice = ({ price }: LiquityStoreState) => price;\r\n\r\nexport const PriceManager: React.FC = () => {\r\n  const {\r\n    liquity: {\r\n      send: liquity,\r\n      connection: { _priceFeedIsTestnet: canSetPrice }\r\n    }\r\n  } = useLiquity();\r\n\r\n  const price = useLiquitySelector(selectPrice);\r\n  const [editedPrice, setEditedPrice] = useState(price.toString(2));\r\n\r\n  useEffect(() => {\r\n    setEditedPrice(price.toString(2));\r\n  }, [price]);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Price feed</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Flex sx={{ alignItems: \"stretch\" }}>\r\n          <Label>ETH</Label>\r\n\r\n          <Label variant=\"unit\">$</Label>\r\n\r\n          <Input\r\n            type={canSetPrice ? \"number\" : \"text\"}\r\n            step=\"any\"\r\n            value={editedPrice}\r\n            onChange={e => setEditedPrice(e.target.value)}\r\n            disabled={!canSetPrice}\r\n          />\r\n\r\n          {canSetPrice && (\r\n            <Flex sx={{ ml: 2, alignItems: \"center\" }}>\r\n              <Transaction\r\n                id=\"set-price\"\r\n                tooltip=\"Set\"\r\n                tooltipPlacement=\"bottom\"\r\n                send={overrides => {\r\n                  if (!editedPrice) {\r\n                    throw new Error(\"Invalid price\");\r\n                  }\r\n                  return liquity.setPrice(Decimal.from(editedPrice), overrides);\r\n                }}\r\n              >\r\n                <Button variant=\"icon\">\r\n                  <Icon name=\"chart-line\" size=\"lg\" />\r\n                </Button>\r\n              </Transaction>\r\n            </Flex>\r\n          )}\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { createContext, useContext } from \"react\";\r\n\r\nexport type StakingView = \"ACTIVE\" | \"ADJUSTING\" | \"NONE\";\r\n\r\nexport type StakingViewAction = { type: \"startAdjusting\" | \"cancelAdjusting\" };\r\n\r\nexport type StakingViewContextType = {\r\n  view: StakingView;\r\n\r\n  // Indicates that a staking TX is pending.\r\n  // The panel should be covered with a spinner overlay when this is true.\r\n  changePending: boolean;\r\n\r\n  // Dispatch an action that changes the Staking panel's view.\r\n  dispatch: (action: StakingViewAction) => void;\r\n};\r\n\r\nexport const StakingViewContext = createContext<StakingViewContextType | null>(null);\r\n\r\nexport const useStakingView = (): StakingViewContextType => {\r\n  const context = useContext(StakingViewContext);\r\n\r\n  if (context === null) {\r\n    throw new Error(\"You must add a <TroveViewProvider> into the React tree\");\r\n  }\r\n\r\n  return context;\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\nconst selectLQTYStake = ({ lqtyStake }: LiquityStoreState) => lqtyStake;\r\n\r\nexport const StakingGainsAction: React.FC = () => {\r\n  const { liquity } = useLiquity();\r\n  const { collateralGain, lusdGain } = useLiquitySelector(selectLQTYStake);\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stake\",\r\n    liquity.send.withdrawGainsFromStaking.bind(liquity.send)\r\n  );\r\n\r\n  return (\r\n    <Button onClick={sendTransaction} disabled={collateralGain.isZero && lusdGain.isZero}>\r\n      Claim gains\r\n    </Button>\r\n  );\r\n};\r\n","import { Heading, Box, Card, Flex, Button } from \"theme-ui\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { DisabledEditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\nimport { Icon } from \"../Icon\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\nimport { StakingGainsAction } from \"./StakingGainsAction\";\r\n\r\nconst select = ({ lqtyStake, totalStakedLQTY }: LiquityStoreState) => ({\r\n  lqtyStake,\r\n  totalStakedLQTY\r\n});\r\n\r\nexport const ReadOnlyStake: React.FC = () => {\r\n  const { changePending, dispatch } = useStakingView();\r\n  const { lqtyStake, totalStakedLQTY } = useLiquitySelector(select);\r\n\r\n  const poolShare = lqtyStake.stakedLQTY.mulDiv(100, totalStakedLQTY);\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Staking</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <DisabledEditableRow\r\n          label=\"Stake\"\r\n          inputId=\"stake-lqty\"\r\n          amount={lqtyStake.stakedLQTY.prettify()}\r\n          unit={GT}\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Pool share\"\r\n          inputId=\"stake-share\"\r\n          amount={poolShare.prettify(4)}\r\n          unit=\"%\"\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Redemption gain\"\r\n          inputId=\"stake-gain-eth\"\r\n          amount={lqtyStake.collateralGain.prettify(4)}\r\n          color={lqtyStake.collateralGain.nonZero && \"success\"}\r\n          unit=\"ETH\"\r\n        />\r\n\r\n        <StaticRow\r\n          label=\"Issuance gain\"\r\n          inputId=\"stake-gain-lusd\"\r\n          amount={lqtyStake.lusdGain.prettify()}\r\n          color={lqtyStake.lusdGain.nonZero && \"success\"}\r\n          unit={COIN}\r\n        />\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button variant=\"outline\" onClick={() => dispatch({ type: \"startAdjusting\" })}>\r\n            <Icon name=\"pen\" size=\"sm\" />\r\n            &nbsp;Adjust\r\n          </Button>\r\n\r\n          <StakingGainsAction />\r\n        </Flex>\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Heading, Box, Card, Button } from \"theme-ui\";\r\n\r\nimport { Decimal, Decimalish, Difference, LiquityStoreState, LQTYStake } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { COIN, GT } from \"../../strings\";\r\n\r\nimport { Icon } from \"../Icon\";\r\nimport { EditableRow, StaticRow } from \"../Trove/Editor\";\r\nimport { LoadingOverlay } from \"../LoadingOverlay\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\n\r\nconst select = ({ lqtyBalance, totalStakedLQTY }: LiquityStoreState) => ({\r\n  lqtyBalance,\r\n  totalStakedLQTY\r\n});\r\n\r\ntype StakingEditorProps = {\r\n  title: string;\r\n  originalStake: LQTYStake;\r\n  editedLQTY: Decimal;\r\n  dispatch: (action: { type: \"setStake\"; newValue: Decimalish } | { type: \"revert\" }) => void;\r\n};\r\n\r\nexport const StakingEditor: React.FC<StakingEditorProps> = ({\r\n  children,\r\n  title,\r\n  originalStake,\r\n  editedLQTY,\r\n  dispatch\r\n}) => {\r\n  const { lqtyBalance, totalStakedLQTY } = useLiquitySelector(select);\r\n  const { changePending } = useStakingView();\r\n  const editingState = useState<string>();\r\n\r\n  const edited = !editedLQTY.eq(originalStake.stakedLQTY);\r\n\r\n  const maxAmount = originalStake.stakedLQTY.add(lqtyBalance);\r\n  const maxedOut = editedLQTY.eq(maxAmount);\r\n\r\n  const totalStakedLQTYAfterChange = totalStakedLQTY.sub(originalStake.stakedLQTY).add(editedLQTY);\r\n\r\n  const originalPoolShare = originalStake.stakedLQTY.mulDiv(100, totalStakedLQTY);\r\n  const newPoolShare = editedLQTY.mulDiv(100, totalStakedLQTYAfterChange);\r\n  const poolShareChange =\r\n    originalStake.stakedLQTY.nonZero && Difference.between(newPoolShare, originalPoolShare).nonZero;\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        {title}\r\n        {edited && !changePending && (\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ \":enabled:hover\": { color: \"danger\" } }}\r\n            onClick={() => dispatch({ type: \"revert\" })}\r\n          >\r\n            <Icon name=\"history\" size=\"lg\" />\r\n          </Button>\r\n        )}\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <EditableRow\r\n          label=\"Stake\"\r\n          inputId=\"stake-lqty\"\r\n          amount={editedLQTY.prettify()}\r\n          maxAmount={maxAmount.toString()}\r\n          maxedOut={maxedOut}\r\n          unit={GT}\r\n          {...{ editingState }}\r\n          editedAmount={editedLQTY.toString(2)}\r\n          setEditedAmount={newValue => dispatch({ type: \"setStake\", newValue })}\r\n        />\r\n\r\n        {newPoolShare.infinite ? (\r\n          <StaticRow label=\"Pool share\" inputId=\"stake-share\" amount=\"N/A\" />\r\n        ) : (\r\n          <StaticRow\r\n            label=\"Pool share\"\r\n            inputId=\"stake-share\"\r\n            amount={newPoolShare.prettify(4)}\r\n            pendingAmount={poolShareChange?.prettify(4).concat(\"%\")}\r\n            pendingColor={poolShareChange?.positive ? \"success\" : \"danger\"}\r\n            unit=\"%\"\r\n          />\r\n        )}\r\n\r\n        {!originalStake.isEmpty && (\r\n          <>\r\n            <StaticRow\r\n              label=\"Redemption gain\"\r\n              inputId=\"stake-gain-eth\"\r\n              amount={originalStake.collateralGain.prettify(4)}\r\n              color={originalStake.collateralGain.nonZero && \"success\"}\r\n              unit=\"ETH\"\r\n            />\r\n\r\n            <StaticRow\r\n              label=\"Issuance gain\"\r\n              inputId=\"stake-gain-lusd\"\r\n              amount={originalStake.lusdGain.prettify()}\r\n              color={originalStake.lusdGain.nonZero && \"success\"}\r\n              unit={COIN}\r\n            />\r\n          </>\r\n        )}\r\n\r\n        {children}\r\n      </Box>\r\n\r\n      {changePending && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import { Button } from \"theme-ui\";\r\n\r\nimport { Decimal, LQTYStakeChange } from \"@liquity/lib-base\";\r\n\r\nimport { useLiquity } from \"../../hooks/LiquityContext\";\r\nimport { useTransactionFunction } from \"../Transaction\";\r\n\r\ntype StakingActionProps = {\r\n  change: LQTYStakeChange<Decimal>;\r\n};\r\n\r\nexport const StakingManagerAction: React.FC<StakingActionProps> = ({ change, children }) => {\r\n  const { liquity } = useLiquity();\r\n\r\n  const [sendTransaction] = useTransactionFunction(\r\n    \"stake\",\r\n    change.stakeLQTY\r\n      ? liquity.send.stakeLQTY.bind(liquity.send, change.stakeLQTY)\r\n      : liquity.send.unstakeLQTY.bind(liquity.send, change.unstakeLQTY)\r\n  );\r\n\r\n  return <Button onClick={sendTransaction}>{children}</Button>;\r\n};\r\n","import React from \"react\";\r\nimport { Button, Flex } from \"theme-ui\";\r\n\r\nimport {\r\n  Decimal,\r\n  Decimalish,\r\n  LiquityStoreState,\r\n  LQTYStake,\r\n  LQTYStakeChange\r\n} from \"@liquity/lib-base\";\r\n\r\nimport { LiquityStoreUpdate, useLiquityReducer, useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { GT, COIN } from \"../../strings\";\r\n\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\nimport { StakingEditor } from \"./StakingEditor\";\r\nimport { StakingManagerAction } from \"./StakingManagerAction\";\r\nimport { ActionDescription, Amount } from \"../ActionDescription\";\r\nimport { ErrorDescription } from \"../ErrorDescription\";\r\n\r\nconst init = ({ lqtyStake }: LiquityStoreState) => ({\r\n  originalStake: lqtyStake,\r\n  editedLQTY: lqtyStake.stakedLQTY\r\n});\r\n\r\ntype StakeManagerState = ReturnType<typeof init>;\r\ntype StakeManagerAction =\r\n  | LiquityStoreUpdate\r\n  | { type: \"revert\" }\r\n  | { type: \"setStake\"; newValue: Decimalish };\r\n\r\nconst reduce = (state: StakeManagerState, action: StakeManagerAction): StakeManagerState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  const { originalStake, editedLQTY } = state;\r\n\r\n  switch (action.type) {\r\n    case \"setStake\":\r\n      return { ...state, editedLQTY: Decimal.from(action.newValue) };\r\n\r\n    case \"revert\":\r\n      return { ...state, editedLQTY: originalStake.stakedLQTY };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        stateChange: { lqtyStake: updatedStake }\r\n      } = action;\r\n\r\n      if (updatedStake) {\r\n        return {\r\n          originalStake: updatedStake,\r\n          editedLQTY: updatedStake.apply(originalStake.whatChanged(editedLQTY))\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nconst selectLQTYBalance = ({ lqtyBalance }: LiquityStoreState) => lqtyBalance;\r\n\r\ntype StakingManagerActionDescriptionProps = {\r\n  originalStake: LQTYStake;\r\n  change: LQTYStakeChange<Decimal>;\r\n};\r\n\r\nconst StakingManagerActionDescription: React.FC<StakingManagerActionDescriptionProps> = ({\r\n  originalStake,\r\n  change\r\n}) => {\r\n  const stakeLQTY = change.stakeLQTY?.prettify().concat(\" \", GT);\r\n  const unstakeLQTY = change.unstakeLQTY?.prettify().concat(\" \", GT);\r\n  const collateralGain = originalStake.collateralGain.nonZero?.prettify(4).concat(\" ETH\");\r\n  const lusdGain = originalStake.lusdGain.nonZero?.prettify().concat(\" \", COIN);\r\n\r\n  if (originalStake.isEmpty && stakeLQTY) {\r\n    return (\r\n      <ActionDescription>\r\n        You are staking <Amount>{stakeLQTY}</Amount>.\r\n      </ActionDescription>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ActionDescription>\r\n      {stakeLQTY && (\r\n        <>\r\n          You are adding <Amount>{stakeLQTY}</Amount> to your stake\r\n        </>\r\n      )}\r\n      {unstakeLQTY && (\r\n        <>\r\n          You are withdrawing <Amount>{unstakeLQTY}</Amount> to your wallet\r\n        </>\r\n      )}\r\n      {(collateralGain || lusdGain) && (\r\n        <>\r\n          {\" \"}\r\n          and claiming{\" \"}\r\n          {collateralGain && lusdGain ? (\r\n            <>\r\n              <Amount>{collateralGain}</Amount> and <Amount>{lusdGain}</Amount>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Amount>{collateralGain ?? lusdGain}</Amount>\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n      .\r\n    </ActionDescription>\r\n  );\r\n};\r\n\r\nexport const StakingManager: React.FC = () => {\r\n  const { dispatch: dispatchStakingViewAction } = useStakingView();\r\n  const [{ originalStake, editedLQTY }, dispatch] = useLiquityReducer(reduce, init);\r\n  const lqtyBalance = useLiquitySelector(selectLQTYBalance);\r\n\r\n  const change = originalStake.whatChanged(editedLQTY);\r\n  const [validChange, description] = !change\r\n    ? [undefined, undefined]\r\n    : change.stakeLQTY?.gt(lqtyBalance)\r\n    ? [\r\n        undefined,\r\n        <ErrorDescription>\r\n          The amount you're trying to stake exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {change.stakeLQTY.sub(lqtyBalance).prettify()} {GT}\r\n          </Amount>\r\n          .\r\n        </ErrorDescription>\r\n      ]\r\n    : [change, <StakingManagerActionDescription originalStake={originalStake} change={change} />];\r\n\r\n  const makingNewStake = originalStake.isEmpty;\r\n\r\n  return (\r\n    <StakingEditor title={\"Staking\"} {...{ originalStake, editedLQTY, dispatch }}>\r\n      {description ??\r\n        (makingNewStake ? (\r\n          <ActionDescription>Enter the amount of {GT} you'd like to stake.</ActionDescription>\r\n        ) : (\r\n          <ActionDescription>Adjust the {GT} amount to stake or withdraw.</ActionDescription>\r\n        ))}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button\r\n          variant=\"cancel\"\r\n          onClick={() => dispatchStakingViewAction({ type: \"cancelAdjusting\" })}\r\n        >\r\n          Cancel\r\n        </Button>\r\n\r\n        {validChange ? (\r\n          <StakingManagerAction change={validChange}>Confirm</StakingManagerAction>\r\n        ) : (\r\n          <Button disabled>Confirm</Button>\r\n        )}\r\n      </Flex>\r\n    </StakingEditor>\r\n  );\r\n};\r\n","import { Card, Heading, Box, Flex, Button } from \"theme-ui\";\r\n\r\nimport { GT } from \"../../strings\";\r\n\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { useStakingView } from \"./context/StakingViewContext\";\r\n\r\nexport const NoStake: React.FC = () => {\r\n  const { dispatch } = useStakingView();\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Staking</Heading>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <InfoMessage title={`You haven't staked ${GT} yet.`}>\r\n          Stake {GT} to earn a share of borrowing and redemption fees.\r\n        </InfoMessage>\r\n\r\n        <Flex variant=\"layout.actions\">\r\n          <Button onClick={() => dispatch({ type: \"startAdjusting\" })}>Start staking</Button>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { useStakingView } from \"./context/StakingViewContext\";\r\nimport { ReadOnlyStake } from \"./ReadOnlyStake\";\r\nimport { StakingManager } from \"./StakingManager\";\r\nimport { NoStake } from \"./NoStake\";\r\n\r\nexport const Staking: React.FC = () => {\r\n  const { view } = useStakingView();\r\n\r\n  switch (view) {\r\n    case \"ACTIVE\":\r\n      return <ReadOnlyStake />;\r\n\r\n    case \"ADJUSTING\":\r\n      return <StakingManager />;\r\n\r\n    case \"NONE\":\r\n      return <NoStake />;\r\n  }\r\n};\r\n","import React from \"react\";\r\nimport { InfoMessage } from \"../../../InfoMessage\";\r\nimport { NOT_BONDED_YET } from \"../../lexicon\";\r\n\r\nexport const Empty: React.FC = () => {\r\n  return <InfoMessage title={NOT_BONDED_YET.term}>{NOT_BONDED_YET.description}</InfoMessage>;\r\n};\r\n","import { Decimal, Decimalish } from \"@liquity/lib-base\";\r\nimport { InfoIcon } from \"../../InfoIcon\";\r\nimport * as l from \"../lexicon\";\r\n\r\ntype InfiniteEstimateProps = {\r\n  estimate: Decimalish;\r\n};\r\n\r\nexport const InfiniteEstimate: React.FC<InfiniteEstimateProps> = ({ estimate, children }) => {\r\n  if (estimate.toString() !== Decimal.INFINITY.toString()) return <>{children ?? estimate}</>;\r\n\r\n  return (\r\n    <>\r\n      {Decimal.INFINITY.toString()}\r\n      <InfoIcon\r\n        size=\"xs\"\r\n        tooltip={l.INFINITE_ESTIMATION.description}\r\n        link={l.INFINITE_ESTIMATION.link}\r\n      />\r\n      &nbsp;\r\n    </>\r\n  );\r\n};\r\n","/** @jsxImportSource theme-ui */\r\nimport React from \"react\";\r\nimport { Card, Text, Box, Heading, Flex, Grid, Button } from \"theme-ui\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport * as lexicon from \"./lexicon\";\r\nimport { Empty } from \"./views/idle/Empty\";\r\nimport { Link } from \"../Link\";\r\nimport { useBondView } from \"./context/BondViewContext\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { InfiniteEstimate } from \"./views/InfiniteEstimation\";\r\n\r\nconst {\r\n  BONDS,\r\n  BOND_DEPOSIT: BOND_AMOUNT,\r\n  ACCRUED_AMOUNT,\r\n  MARKET_VALUE,\r\n  OPTIMUM_REBOND_TIME,\r\n  BREAK_EVEN_TIME\r\n} = lexicon;\r\n\r\nconst LineSegment: React.FC = () => (\r\n  <Flex\r\n    sx={{\r\n      borderTop: \"1px dotted gray\",\r\n      width: \"100%\",\r\n      mt: \"-20px\",\r\n      mb: 0\r\n    }}\r\n  />\r\n);\r\n\r\nconst formatDays = (days: number) =>\r\n  days < 0\r\n    ? \"Elapsed\"\r\n    : days === 0\r\n    ? \"Now\"\r\n    : parseFloat(days.toFixed(1)) < 1\r\n    ? `${days.toFixed(1)} days`\r\n    : days > 10000\r\n    ? Decimal.INFINITY.toString()\r\n    : `${days.toFixed(0)} days`;\r\n\r\nconst Line = (columns: number) =>\r\n  Array.from(Array(columns)).map((_, idx) => <LineSegment key={idx} />);\r\n\r\nconst columns = 5;\r\n\r\nexport const BondsTable: React.FC = () => {\r\n  const { bonds, hasLoaded } = useBondView();\r\n\r\n  if (!hasLoaded) return null;\r\n\r\n  const pendingBonds = bonds ? bonds.filter(bond => bond.status === \"PENDING\") : [];\r\n  const hasBonds = pendingBonds.length > 0;\r\n  return (\r\n    <Card>\r\n      <Heading>\r\n        <Flex>\r\n          Pending bonds{\" \"}\r\n          <InfoIcon\r\n            placement=\"left\"\r\n            size=\"xs\"\r\n            tooltip={<Card variant=\"tooltip\">{BONDS.description}</Card>}\r\n          />\r\n        </Flex>\r\n      </Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        {!hasBonds && <Empty />}\r\n        {hasBonds && (\r\n          <Grid\r\n            gap=\"12px 0px\"\r\n            columns={[columns, \"1fr 1fr 1.1fr 1.3fr 1fr\"]}\r\n            sx={{ alignItems: \"center\", justifyItems: \"center\", alignContent: \"center\" }}\r\n          >\r\n            <Text sx={{ fontWeight: \"bold\" }}>\r\n              {BOND_AMOUNT.term}{\" \"}\r\n              <InfoIcon\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{BOND_AMOUNT.description}</Card>}\r\n              />\r\n            </Text>\r\n            <Text sx={{ fontWeight: \"bold\" }}>\r\n              {ACCRUED_AMOUNT.term}{\" \"}\r\n              <InfoIcon\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{ACCRUED_AMOUNT.description}</Card>}\r\n              />\r\n            </Text>\r\n            <Text sx={{ fontWeight: \"bold\" }}>\r\n              {MARKET_VALUE.term}{\" \"}\r\n              <InfoIcon\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{MARKET_VALUE.description}</Card>}\r\n              />\r\n            </Text>\r\n            <Text sx={{ fontWeight: \"bold\" }}>\r\n              {BREAK_EVEN_TIME.term}{\" \"}\r\n              <InfoIcon\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{BREAK_EVEN_TIME.description}</Card>}\r\n              />\r\n            </Text>\r\n            <Text sx={{ fontWeight: \"bold\" }}>\r\n              {OPTIMUM_REBOND_TIME.term}{\" \"}\r\n              <InfoIcon\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{OPTIMUM_REBOND_TIME.description}</Card>}\r\n              />\r\n            </Text>\r\n            {Line(5)}\r\n\r\n            {pendingBonds.map((bond, idx) => {\r\n              const breakEvenDays = formatDays(\r\n                (bond.breakEvenTime.getTime() - Date.now()) / 1000 / 60 / 60 / 24\r\n              );\r\n              const rebondDays = formatDays(\r\n                (bond.rebondTime.getTime() - Date.now()) / 1000 / 60 / 60 / 24\r\n              );\r\n              return (\r\n                <React.Fragment key={idx}>\r\n                  <Text>{bond.deposit.shorten()} LUSD</Text>\r\n                  <Text>{bond.accrued.shorten()} bLUSD</Text>\r\n                  <Text>{bond.marketValue.shorten()} LUSD</Text>\r\n                  <Text>\r\n                    <InfiniteEstimate estimate={breakEvenDays} />\r\n                  </Text>\r\n                  <Text>\r\n                    <InfiniteEstimate estimate={rebondDays} />\r\n                  </Text>\r\n                  {Line(5)}\r\n                </React.Fragment>\r\n              );\r\n            })}\r\n          </Grid>\r\n        )}\r\n        <Flex variant=\"layout.actions\" mt={3}>\r\n          <Link to=\"/bonds/pending\" m={0} p={0}>\r\n            <Button variant=\"primary\">Go to bonds</Button>\r\n          </Link>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import { Container } from \"theme-ui\";\r\n\r\nimport { Trove } from \"../components/Trove/Trove\";\r\nimport { Stability } from \"../components/Stability/Stability\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { PriceManager } from \"../components/PriceManager\";\r\nimport { Staking } from \"../components/Staking/Staking\";\r\nimport { BondsTable } from \"../components/Bonds/BondsTable\";\r\n\r\nexport const Dashboard: React.FC = () => (\r\n  <Container variant=\"columns\">\r\n    <Container variant=\"left\">\r\n      <BondsTable />\r\n      <Trove />\r\n      <Stability />\r\n      <Staking />\r\n    </Container>\r\n\r\n    <Container variant=\"right\">\r\n      <SystemStats />\r\n      <PriceManager />\r\n    </Container>\r\n  </Container>\r\n);\r\n","import { Box, Flex, Heading, Paragraph } from \"theme-ui\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { Icon } from \"../components/Icon\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nexport const UnregisteredFrontend: React.FC = () => {\r\n  const {\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        justifyContent: \"space-around\",\r\n\r\n        m: 3,\r\n        p: 3,\r\n        maxWidth: \"500px\",\r\n\r\n        border: 1,\r\n        borderRadius: \"8px\",\r\n        borderColor: \"warning\",\r\n        boxShadow: 2\r\n      }}\r\n    >\r\n      <Flex sx={{ alignItems: \"center\", mx: 3, mb: 2 }}>\r\n        <Icon name=\"exclamation-triangle\" size=\"2x\" />\r\n        <Heading sx={{ ml: 3, fontSize: \"18px\" }}>Frontend not yet registered</Heading>\r\n      </Flex>\r\n\r\n      <Paragraph sx={{ fontSize: 2 }}>\r\n        If you're the operator of this frontend, please select <b>{shortenAddress(frontendTag)}</b>{\" \"}\r\n        in your wallet to proceed with the registration.\r\n      </Paragraph>\r\n    </Box>\r\n  );\r\n};\r\n","import { useState } from \"react\";\r\nimport { Card, Heading, Box, Flex, Input, Label, Paragraph, Button, Spinner } from \"theme-ui\";\r\n\r\nimport { Decimal } from \"@liquity/lib-base\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { Transaction, useMyTransactionState } from \"../components/Transaction\";\r\nimport { Icon } from \"../components/Icon\";\r\n\r\ntype FrontendRegistrationActionProps = {\r\n  kickbackRate: Decimal;\r\n};\r\n\r\nconst FrontendRegistrationAction: React.FC<FrontendRegistrationActionProps> = ({ kickbackRate }) => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n\r\n  const myTransactionId = \"register-frontend\";\r\n  const myTransactionState = useMyTransactionState(myTransactionId);\r\n\r\n  return myTransactionState.type === \"waitingForApproval\" ? (\r\n    <Button disabled>\r\n      <Spinner sx={{ mr: 2, color: \"white\" }} size=\"20px\" />\r\n      Waiting for your approval\r\n    </Button>\r\n  ) : myTransactionState.type !== \"waitingForConfirmation\" &&\r\n    myTransactionState.type !== \"confirmed\" ? (\r\n    <Transaction id={myTransactionId} send={liquity.registerFrontend.bind(liquity, kickbackRate)}>\r\n      <Button>Register</Button>\r\n    </Transaction>\r\n  ) : null;\r\n};\r\n\r\nexport const FrontendRegistration: React.FC = () => {\r\n  const { account } = useLiquity();\r\n\r\n  const [kickbackRate, setKickbackRate] = useState(Decimal.from(0.8));\r\n  const [cut, setCut] = useState(Decimal.from(0.2));\r\n  const [kickbackRateString, setKickbackRateString] = useState(\"80\");\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <Heading>Choose a kickback rate</Heading>\r\n\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Flex>\r\n            <Label>Kickback rate</Label>\r\n            <Label variant=\"unit\">%</Label>\r\n\r\n            <Input\r\n              sx={{ maxWidth: \"200px\" }}\r\n              type=\"number\"\r\n              step=\"any\"\r\n              value={kickbackRateString}\r\n              onChange={e => {\r\n                setKickbackRateString(e.target.value);\r\n                try {\r\n                  const newKickbackRate = Decimal.from(e.target.value || 0).div(100);\r\n                  const newCut = Decimal.ONE.sub(newKickbackRate);\r\n\r\n                  setKickbackRate(newKickbackRate);\r\n                  setCut(newCut);\r\n                } catch {}\r\n              }}\r\n              onBlur={() => {\r\n                setKickbackRateString(kickbackRate.mul(100).toString());\r\n              }}\r\n            />\r\n          </Flex>\r\n        </Box>\r\n      </Card>\r\n\r\n      <Box\r\n        sx={{\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          justifyContent: \"space-around\",\r\n\r\n          m: 3,\r\n          mt: [3, null, 4],\r\n          mb: 4,\r\n          p: 3,\r\n          maxWidth: \"450px\",\r\n\r\n          border: 1,\r\n          borderRadius: \"8px\",\r\n          borderColor: \"danger\",\r\n          boxShadow: 2\r\n        }}\r\n      >\r\n        <Flex sx={{ alignItems: \"center\", mx: 3, fontSize: 4 }}>\r\n          <Icon name=\"hand-paper\" />\r\n          <Heading sx={{ ml: 3, fontSize: \"18px\" }}>Before you proceed</Heading>\r\n        </Flex>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3 }}>\r\n          You are about to register <b>{shortenAddress(account)}</b> to receive{\" \"}\r\n          <b>{cut.mul(100).toString()}%</b> of the LQTY rewards earned through this frontend.\r\n        </Paragraph>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3, fontWeight: \"bold\" }}>\r\n          You will not be able to change the kickback rate for this address later.\r\n        </Paragraph>\r\n\r\n        <Paragraph sx={{ fontSize: 1, mt: 3 }}>\r\n          If you'd like to use a different kickback rate in the future, you will need to repeat this\r\n          registration with a different address.\r\n        </Paragraph>\r\n      </Box>\r\n\r\n      <FrontendRegistrationAction {...{ kickbackRate }} />\r\n    </>\r\n  );\r\n};\r\n","import { Box, Flex, Heading, Paragraph, Button } from \"theme-ui\";\r\n\r\nimport { Icon } from \"../components/Icon\";\r\n\r\ntype FrontendRegistrationSuccessProps = {\r\n  onDismiss: () => void;\r\n};\r\n\r\nexport const FrontendRegistrationSuccess: React.FC<FrontendRegistrationSuccessProps> = ({\r\n  onDismiss\r\n}) => (\r\n  <>\r\n    <Box\r\n      sx={{\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        justifyContent: \"space-around\",\r\n\r\n        m: 3,\r\n        mt: 4,\r\n        mb: 4,\r\n        p: 4,\r\n        maxWidth: \"500px\",\r\n\r\n        bg: \"rgba(40, 192, 129, 0.05)\",\r\n        color: \"success\",\r\n\r\n        border: 1,\r\n        borderRadius: \"8px\",\r\n        borderColor: \"success\",\r\n        boxShadow: 2\r\n      }}\r\n    >\r\n      <Flex sx={{ alignItems: \"center\", mx: 3, mb: 4, fontSize: 5 }}>\r\n        <Icon name=\"check\" />\r\n        <Heading sx={{ ml: 3, fontSize: 4 }}>Success!</Heading>\r\n      </Flex>\r\n\r\n      <Paragraph sx={{ fontSize: 2 }}>Your frontend is now ready to receive LQTY rewards.</Paragraph>\r\n    </Box>\r\n\r\n    <Button onClick={onDismiss}>Go to Dashboard</Button>\r\n  </>\r\n);\r\n","import { useEffect, useState } from \"react\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\n\r\nimport { LiquityStoreState } from \"@liquity/lib-base\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Dashboard } from \"./Dashboard\";\r\nimport { UnregisteredFrontend } from \"./UnregisteredFrontend\";\r\nimport { FrontendRegistration } from \"./FrontendRegistration\";\r\nimport { FrontendRegistrationSuccess } from \"./FrontendRegistrationSuccess\";\r\n\r\nconst selectFrontend = ({ frontend }: LiquityStoreState) => frontend;\r\n\r\nexport const PageSwitcher: React.FC = () => {\r\n  const {\r\n    account,\r\n    config: { frontendTag }\r\n  } = useLiquity();\r\n\r\n  const frontend = useLiquitySelector(selectFrontend);\r\n  const unregistered = frontendTag !== AddressZero && frontend.status === \"unregistered\";\r\n\r\n  const [registering, setRegistering] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (unregistered) {\r\n      setRegistering(true);\r\n    }\r\n  }, [unregistered]);\r\n\r\n  if (registering || unregistered) {\r\n    if (frontend.status === \"registered\") {\r\n      return <FrontendRegistrationSuccess onDismiss={() => setRegistering(false)} />;\r\n    } else if (account === frontendTag) {\r\n      return <FrontendRegistration />;\r\n    } else {\r\n      return <UnregisteredFrontend />;\r\n    }\r\n  } else {\r\n    return <Dashboard />;\r\n  }\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Card, Box, Heading, Flex, Button, Label, Input } from \"theme-ui\";\r\n\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { Transaction } from \"./Transaction\";\r\n\r\nexport const LiquidationManager: React.FC = () => {\r\n  const {\r\n    liquity: { send: liquity }\r\n  } = useLiquity();\r\n  const [numberOfTrovesToLiquidate, setNumberOfTrovesToLiquidate] = useState(\"90\");\r\n\r\n  return (\r\n    <Card>\r\n      <Heading>Liquidate</Heading>\r\n\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Flex sx={{ alignItems: \"stretch\" }}>\r\n          <Label>Up to</Label>\r\n\r\n          <Input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            step=\"1\"\r\n            value={numberOfTrovesToLiquidate}\r\n            onChange={e => setNumberOfTrovesToLiquidate(e.target.value)}\r\n          />\r\n\r\n          <Label>Troves</Label>\r\n\r\n          <Flex sx={{ ml: 2, alignItems: \"center\" }}>\r\n            <Transaction\r\n              id=\"batch-liquidate\"\r\n              tooltip=\"Liquidate\"\r\n              tooltipPlacement=\"bottom\"\r\n              send={overrides => {\r\n                if (!numberOfTrovesToLiquidate) {\r\n                  throw new Error(\"Invalid number\");\r\n                }\r\n                return liquity.liquidateUpTo(parseInt(numberOfTrovesToLiquidate, 10), overrides);\r\n              }}\r\n            >\r\n              <Button variant=\"dangerIcon\">\r\n                <Icon name=\"trash\" size=\"lg\" />\r\n              </Button>\r\n            </Transaction>\r\n          </Flex>\r\n        </Flex>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Box, BoxProps } from \"theme-ui\";\r\n\r\ntype AbbreviationProps = BoxProps & {\r\n  short: React.ReactNode;\r\n};\r\n\r\nexport const Abbreviation: React.FC<AbbreviationProps> = ({ children, short, ...boxProps }) => (\r\n  <Box as=\"span\" {...boxProps}>\r\n    <Box as=\"span\" sx={{ display: [\"none\", \"unset\"] }}>\r\n      {children}\r\n    </Box>\r\n\r\n    <Box as=\"span\" sx={{ display: [\"unset\", \"none\"] }}>\r\n      {short}\r\n    </Box>\r\n  </Box>\r\n);\r\n","import React, { useState, useEffect, useCallback } from \"react\";\r\nimport CopyToClipboard from \"react-copy-to-clipboard\";\r\nimport { Card, Button, Text, Box, Heading, Flex } from \"theme-ui\";\r\n\r\nimport {\r\n  Percent,\r\n  MINIMUM_COLLATERAL_RATIO,\r\n  CRITICAL_COLLATERAL_RATIO,\r\n  UserTrove,\r\n  Decimal\r\n} from \"@liquity/lib-base\";\r\nimport { BlockPolledLiquityStoreState } from \"@liquity/lib-ethers\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\n\r\nimport { shortenAddress } from \"../utils/shortenAddress\";\r\nimport { useLiquity } from \"../hooks/LiquityContext\";\r\nimport { COIN } from \"../strings\";\r\n\r\nimport { Icon } from \"./Icon\";\r\nimport { LoadingOverlay } from \"./LoadingOverlay\";\r\nimport { Transaction } from \"./Transaction\";\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport { Abbreviation } from \"./Abbreviation\";\r\n\r\nconst rowHeight = \"40px\";\r\n\r\nconst liquidatableInNormalMode = (trove: UserTrove, price: Decimal) =>\r\n  [trove.collateralRatioIsBelowMinimum(price), \"Collateral ratio not low enough\"] as const;\r\n\r\nconst liquidatableInRecoveryMode = (\r\n  trove: UserTrove,\r\n  price: Decimal,\r\n  totalCollateralRatio: Decimal,\r\n  lusdInStabilityPool: Decimal\r\n) => {\r\n  const collateralRatio = trove.collateralRatio(price);\r\n\r\n  if (collateralRatio.gte(MINIMUM_COLLATERAL_RATIO) && collateralRatio.lt(totalCollateralRatio)) {\r\n    return [\r\n      trove.debt.lte(lusdInStabilityPool),\r\n      \"There's not enough LUSD in the Stability pool to cover the debt\"\r\n    ] as const;\r\n  } else {\r\n    return liquidatableInNormalMode(trove, price);\r\n  }\r\n};\r\n\r\ntype RiskyTrovesProps = {\r\n  pageSize: number;\r\n};\r\n\r\nconst select = ({\r\n  numberOfTroves,\r\n  price,\r\n  total,\r\n  lusdInStabilityPool,\r\n  blockTag\r\n}: BlockPolledLiquityStoreState) => ({\r\n  numberOfTroves,\r\n  price,\r\n  recoveryMode: total.collateralRatioIsBelowCritical(price),\r\n  totalCollateralRatio: total.collateralRatio(price),\r\n  lusdInStabilityPool,\r\n  blockTag\r\n});\r\n\r\nexport const RiskyTroves: React.FC<RiskyTrovesProps> = ({ pageSize }) => {\r\n  const {\r\n    blockTag,\r\n    numberOfTroves,\r\n    recoveryMode,\r\n    totalCollateralRatio,\r\n    lusdInStabilityPool,\r\n    price\r\n  } = useLiquitySelector(select);\r\n  const { liquity } = useLiquity();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [troves, setTroves] = useState<UserTrove[]>();\r\n\r\n  const [reload, setReload] = useState({});\r\n  const forceReload = useCallback(() => setReload({}), []);\r\n\r\n  const [page, setPage] = useState(0);\r\n  const numberOfPages = Math.ceil(numberOfTroves / pageSize) || 1;\r\n  const clampedPage = Math.min(page, numberOfPages - 1);\r\n\r\n  const nextPage = () => {\r\n    if (clampedPage < numberOfPages - 1) {\r\n      setPage(clampedPage + 1);\r\n    }\r\n  };\r\n\r\n  const previousPage = () => {\r\n    if (clampedPage > 0) {\r\n      setPage(clampedPage - 1);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (page !== clampedPage) {\r\n      setPage(clampedPage);\r\n    }\r\n  }, [page, clampedPage]);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    setLoading(true);\r\n\r\n    liquity\r\n      .getTroves(\r\n        {\r\n          first: pageSize,\r\n          sortedBy: \"ascendingCollateralRatio\",\r\n          startingAt: clampedPage * pageSize\r\n        },\r\n        { blockTag }\r\n      )\r\n      .then(troves => {\r\n        if (mounted) {\r\n          setTroves(troves);\r\n          setLoading(false);\r\n        }\r\n      });\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n    // Omit blockTag from deps on purpose\r\n    // eslint-disable-next-line\r\n  }, [liquity, clampedPage, pageSize, reload]);\r\n\r\n  useEffect(() => {\r\n    forceReload();\r\n  }, [forceReload, numberOfTroves]);\r\n\r\n  const [copied, setCopied] = useState<string>();\r\n\r\n  useEffect(() => {\r\n    if (copied !== undefined) {\r\n      let cancelled = false;\r\n\r\n      setTimeout(() => {\r\n        if (!cancelled) {\r\n          setCopied(undefined);\r\n        }\r\n      }, 2000);\r\n\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n  }, [copied]);\r\n\r\n  return (\r\n    <Card sx={{ width: \"100%\" }}>\r\n      <Heading>\r\n        <Abbreviation short=\"Troves\">Risky Troves</Abbreviation>\r\n\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          {numberOfTroves !== 0 && (\r\n            <>\r\n              <Abbreviation\r\n                short={`page ${clampedPage + 1} / ${numberOfPages}`}\r\n                sx={{ mr: [0, 3], fontWeight: \"body\", fontSize: [1, 2], letterSpacing: [-1, 0] }}\r\n              >\r\n                {clampedPage * pageSize + 1}-{Math.min((clampedPage + 1) * pageSize, numberOfTroves)}{\" \"}\r\n                of {numberOfTroves}\r\n              </Abbreviation>\r\n\r\n              <Button variant=\"titleIcon\" onClick={previousPage} disabled={clampedPage <= 0}>\r\n                <Icon name=\"chevron-left\" size=\"lg\" />\r\n              </Button>\r\n\r\n              <Button\r\n                variant=\"titleIcon\"\r\n                onClick={nextPage}\r\n                disabled={clampedPage >= numberOfPages - 1}\r\n              >\r\n                <Icon name=\"chevron-right\" size=\"lg\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n\r\n          <Button\r\n            variant=\"titleIcon\"\r\n            sx={{ opacity: loading ? 0 : 1, ml: [0, 3] }}\r\n            onClick={forceReload}\r\n          >\r\n            <Icon name=\"redo\" size=\"lg\" />\r\n          </Button>\r\n        </Flex>\r\n      </Heading>\r\n\r\n      {!troves || troves.length === 0 ? (\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Box sx={{ p: 4, fontSize: 3, textAlign: \"center\" }}>\r\n            {!troves ? \"Loading...\" : \"There are no Troves yet\"}\r\n          </Box>\r\n        </Box>\r\n      ) : (\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <Box\r\n            as=\"table\"\r\n            sx={{\r\n              mt: 2,\r\n              pl: [1, 4],\r\n              width: \"100%\",\r\n\r\n              textAlign: \"center\",\r\n              lineHeight: 1.15\r\n            }}\r\n          >\r\n            <colgroup>\r\n              <col style={{ width: \"50px\" }} />\r\n              <col />\r\n              <col />\r\n              <col />\r\n              <col style={{ width: rowHeight }} />\r\n            </colgroup>\r\n\r\n            <thead>\r\n              <tr>\r\n                <th>Owner</th>\r\n                <th>\r\n                  <Abbreviation short=\"Coll.\">Collateral</Abbreviation>\r\n                  <Box sx={{ fontSize: [0, 1], fontWeight: \"body\", opacity: 0.5 }}>ETH</Box>\r\n                </th>\r\n                <th>\r\n                  Debt\r\n                  <Box sx={{ fontSize: [0, 1], fontWeight: \"body\", opacity: 0.5 }}>{COIN}</Box>\r\n                </th>\r\n                <th>\r\n                  Coll.\r\n                  <br />\r\n                  Ratio\r\n                </th>\r\n                <th></th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              {troves.map(\r\n                trove =>\r\n                  !trove.isEmpty && ( // making sure the Trove hasn't been liquidated\r\n                    // (TODO: remove check after we can fetch multiple Troves in one call)\r\n                    <tr key={trove.ownerAddress}>\r\n                      <td\r\n                        style={{\r\n                          display: \"flex\",\r\n                          alignItems: \"center\",\r\n                          height: rowHeight\r\n                        }}\r\n                      >\r\n                        <Tooltip message={trove.ownerAddress} placement=\"top\">\r\n                          <Text\r\n                            variant=\"address\"\r\n                            sx={{\r\n                              width: [\"73px\", \"unset\"],\r\n                              overflow: \"hidden\",\r\n                              position: \"relative\"\r\n                            }}\r\n                          >\r\n                            {shortenAddress(trove.ownerAddress)}\r\n                            <Box\r\n                              sx={{\r\n                                display: [\"block\", \"none\"],\r\n                                position: \"absolute\",\r\n                                top: 0,\r\n                                right: 0,\r\n                                width: \"50px\",\r\n                                height: \"100%\",\r\n                                background:\r\n                                  \"linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%)\"\r\n                              }}\r\n                            />\r\n                          </Text>\r\n                        </Tooltip>\r\n\r\n                        <CopyToClipboard\r\n                          text={trove.ownerAddress}\r\n                          onCopy={() => setCopied(trove.ownerAddress)}\r\n                        >\r\n                          <Button variant=\"icon\" sx={{ width: \"24px\", height: \"24px\" }}>\r\n                            <Icon\r\n                              name={copied === trove.ownerAddress ? \"clipboard-check\" : \"clipboard\"}\r\n                              size=\"sm\"\r\n                            />\r\n                          </Button>\r\n                        </CopyToClipboard>\r\n                      </td>\r\n                      <td>\r\n                        <Abbreviation short={trove.collateral.shorten()}>\r\n                          {trove.collateral.prettify(4)}\r\n                        </Abbreviation>\r\n                      </td>\r\n                      <td>\r\n                        <Abbreviation short={trove.debt.shorten()}>\r\n                          {trove.debt.prettify()}\r\n                        </Abbreviation>\r\n                      </td>\r\n                      <td>\r\n                        {(collateralRatio => (\r\n                          <Text\r\n                            color={\r\n                              collateralRatio.gt(CRITICAL_COLLATERAL_RATIO)\r\n                                ? \"success\"\r\n                                : collateralRatio.gt(1.2)\r\n                                ? \"warning\"\r\n                                : \"danger\"\r\n                            }\r\n                          >\r\n                            {new Percent(collateralRatio).prettify()}\r\n                          </Text>\r\n                        ))(trove.collateralRatio(price))}\r\n                      </td>\r\n                      <td>\r\n                        <Transaction\r\n                          id={`liquidate-${trove.ownerAddress}`}\r\n                          tooltip=\"Liquidate\"\r\n                          requires={[\r\n                            recoveryMode\r\n                              ? liquidatableInRecoveryMode(\r\n                                  trove,\r\n                                  price,\r\n                                  totalCollateralRatio,\r\n                                  lusdInStabilityPool\r\n                                )\r\n                              : liquidatableInNormalMode(trove, price)\r\n                          ]}\r\n                          send={liquity.send.liquidate.bind(liquity.send, trove.ownerAddress)}\r\n                        >\r\n                          <Button variant=\"dangerIcon\">\r\n                            <Icon name=\"trash\" />\r\n                          </Button>\r\n                        </Transaction>\r\n                      </td>\r\n                    </tr>\r\n                  )\r\n              )}\r\n            </tbody>\r\n          </Box>\r\n        </Box>\r\n      )}\r\n\r\n      {loading && <LoadingOverlay />}\r\n    </Card>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Container, Card, Box, Paragraph } from \"theme-ui\";\r\nimport { SystemStats } from \"../components/SystemStats\";\r\nimport { LiquidationManager } from \"../components/LiquidationManager\";\r\nimport { RiskyTroves } from \"../components/RiskyTroves\";\r\nimport { InfoMessage } from \"../components/InfoMessage\";\r\n\r\nexport const RiskyTrovesPage: React.FC = () => (\r\n  <Container variant=\"columns\">\r\n    <Container variant=\"left\">\r\n      <Card>\r\n        <Box sx={{ p: [2, 3] }}>\r\n          <InfoMessage title=\"Bot functionality\">\r\n            <Paragraph>Liquidation is expected to be carried out by bots.</Paragraph>\r\n            <Paragraph>\r\n              Early on you may be able to manually liquidate Troves, but as the system matures this\r\n              will become less likely.\r\n            </Paragraph>\r\n          </InfoMessage>\r\n        </Box>\r\n      </Card>\r\n      <LiquidationManager />\r\n    </Container>\r\n\r\n    <Container variant=\"right\">\r\n      <SystemStats />\r\n    </Container>\r\n    <RiskyTroves pageSize={10} />\r\n  </Container>\r\n);\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport { PieChart, Pie, ResponsiveContainer, Tooltip, Cell } from \"recharts\";\r\nimport { useBondView } from \"./Bonds/context/BondViewContext\";\r\n\r\nconst labels = [\"Pending\", \"Reserve\", \"Permanent\"];\r\nconst colors = [\"#7a77c2\", \"#6d6aad\", \"#5f5c97\"];\r\nconst RADIAN = Math.PI / 180;\r\n\r\nexport const TreasuryChart = () => {\r\n  const { protocolInfo } = useBondView();\r\n\r\n  if (protocolInfo === undefined) return null;\r\n\r\n  const treasuryChartData = [];\r\n\r\n  const buckets = [\r\n    parseFloat(protocolInfo.treasury.pending.toString()),\r\n    parseFloat(protocolInfo.treasury.reserve.toString()),\r\n    parseFloat(protocolInfo.treasury.permanent.toString())\r\n  ];\r\n\r\n  if (protocolInfo.treasury.pending !== Decimal.ZERO) {\r\n    treasuryChartData.push({\r\n      name: \"Pending\",\r\n      value: buckets[0]\r\n    });\r\n  }\r\n\r\n  if (protocolInfo.treasury.reserve !== Decimal.ZERO) {\r\n    treasuryChartData.push({\r\n      name: \"Reserve\",\r\n      value: buckets[1]\r\n    });\r\n  }\r\n\r\n  if (protocolInfo.treasury.permanent !== Decimal.ZERO) {\r\n    treasuryChartData.push({\r\n      name: \"Permanent\",\r\n      value: buckets[2]\r\n    });\r\n  }\r\n\r\n  return (\r\n    <ResponsiveContainer width=\"100%\" height={348}>\r\n      <PieChart>\r\n        <Tooltip isAnimationActive={false} />\r\n        <Pie\r\n          data={treasuryChartData}\r\n          dataKey=\"value\"\r\n          nameKey=\"name\"\r\n          cx=\"50%\"\r\n          cy=\"50%\"\r\n          outerRadius={110}\r\n          label={({ cx, cy, midAngle, innerRadius, outerRadius, index }) => {\r\n            const radius = innerRadius + (outerRadius - innerRadius) * 0.5;\r\n            const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n            const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n\r\n            return (\r\n              <text\r\n                fontSize={15}\r\n                fontWeight={300}\r\n                x={x * 1.078}\r\n                y={y * 0.985}\r\n                fill=\"white\"\r\n                textAnchor=\"middle\"\r\n                dominantBaseline=\"central\"\r\n              >\r\n                {buckets[index] > 0 ? labels[index] : \"\"}\r\n              </text>\r\n            );\r\n          }}\r\n          isAnimationActive={false}\r\n          strokeOpacity=\"0.55\"\r\n        >\r\n          {treasuryChartData.map((_, index) => (\r\n            <Cell key={`label-${index}`} fill={colors[index]} />\r\n          ))}\r\n        </Pie>\r\n        <Pie\r\n          data={treasuryChartData}\r\n          dataKey=\"value\"\r\n          nameKey=\"name\"\r\n          cx=\"50%\"\r\n          cy=\"50%\"\r\n          innerRadius={110}\r\n          outerRadius={132}\r\n          isAnimationActive={false}\r\n          strokeOpacity=\"0.55\"\r\n          label={({ x, y, percent, index }) => {\r\n            if (!(buckets[index] > 0)) return null;\r\n            return (\r\n              <g>\r\n                <circle\r\n                  textAnchor=\"middle\"\r\n                  cx={x < 131 ? x * 1.3 : x * 0.96}\r\n                  cy={y < 131 ? y * 1.3 : y * 0.99}\r\n                  r={19}\r\n                  fill={colors[index]}\r\n                />\r\n                <text\r\n                  x={x < 131 ? x * 1.3 : x * 0.96}\r\n                  y={y < 131 ? y * 1.3 : y * 0.99}\r\n                  fontSize={15.5}\r\n                  fill=\"white\"\r\n                  fontWeight={300}\r\n                  textAnchor=\"middle\"\r\n                  dominantBaseline=\"central\"\r\n                >\r\n                  {`${(percent * 100).toFixed(0)}%`}\r\n                </text>\r\n              </g>\r\n            );\r\n          }}\r\n          labelLine={false}\r\n        >\r\n          {treasuryChartData.map((_, index) => (\r\n            <Cell key={`share-${index}`} fill={colors[index]} />\r\n          ))}\r\n        </Pie>\r\n      </PieChart>\r\n    </ResponsiveContainer>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Card, Heading, Text, Flex } from \"theme-ui\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport * as l from \"../components/Bonds/lexicon\";\r\nimport { Statistic } from \"./Statistic\";\r\nimport { TreasuryChart } from \"./TreasuryChart\";\r\nimport { useBondView } from \"./Bonds/context/BondViewContext\";\r\n\r\ntype BondStatsProps = {\r\n  variant?: string;\r\n};\r\n\r\ntype MetricProps = {\r\n  value: string | undefined;\r\n  unit?: string;\r\n};\r\n\r\nconst Metric: React.FC<MetricProps> = ({ value, unit }) => {\r\n  return (\r\n    <>\r\n      {value}\r\n      &nbsp;\r\n      {unit && <Text sx={{ fontWeight: \"light\", fontSize: 1 }}>{unit}</Text>}\r\n    </>\r\n  );\r\n};\r\n\r\nexport const BondStats: React.FC<BondStatsProps> = () => {\r\n  const { stats, protocolInfo } = useBondView();\r\n\r\n  if (stats === undefined || protocolInfo === undefined) return null;\r\n\r\n  return (\r\n    <Card variant=\"info\">\r\n      <Heading sx={{ fontweight: \"bold\" }}>LUSD bonds</Heading>\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        bLUSD\r\n      </Heading>\r\n      <Statistic lexicon={l.BLUSD_MARKET_PRICE}>\r\n        <Metric value={protocolInfo.marketPrice.prettify(3)} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_FAIR_PRICE}>\r\n        <Metric\r\n          value={\r\n            protocolInfo.fairPrice.lower.eq(Decimal.INFINITY)\r\n              ? \"N/A\"\r\n              : `${protocolInfo.fairPrice.lower.prettify(\r\n                  2\r\n                )} - ${protocolInfo.fairPrice.upper.prettify(2)}`\r\n          }\r\n          unit=\"LUSD\"\r\n        />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_FLOOR_PRICE}>\r\n        <Metric value={protocolInfo.floorPriceWithoutPendingHarvests.prettify(4)} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_WIND_DOWN_PRICE}>\r\n        <Metric value={protocolInfo.windDownPrice.prettify(4)} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_APR}>\r\n        <Metric\r\n          value={\r\n            protocolInfo.bLusdApr && protocolInfo.bLusdSupply.gt(0)\r\n              ? protocolInfo.bLusdApr.mul(100).prettify(2)\r\n              : \"N/A\"\r\n          }\r\n          unit=\"%\"\r\n        />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_LP_APR}>\r\n        <Metric\r\n          value={\r\n            protocolInfo?.bLusdLpApr !== undefined ? protocolInfo.bLusdLpApr.prettify(2) : \"N/A\"\r\n          }\r\n          unit=\"%\"\r\n        />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_YIELD_AMPLIFICATION}>\r\n        <Metric\r\n          value={\r\n            protocolInfo.yieldAmplification && protocolInfo.bLusdSupply.gt(0)\r\n              ? protocolInfo.yieldAmplification.prettify(2)\r\n              : \"N/A\"\r\n          }\r\n          unit=\"x\"\r\n        />\r\n      </Statistic>\r\n      <Statistic lexicon={l.BLUSD_SUPPLY}>\r\n        <Metric value={protocolInfo.bLusdSupply.shorten()} unit=\"bLUSD\" />\r\n      </Statistic>\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Statistics\r\n      </Heading>\r\n      <Statistic lexicon={l.PENDING_BONDS_STATISTIC}>\r\n        <Metric value={stats.pendingBonds.prettify(0)} />\r\n      </Statistic>\r\n      <Statistic lexicon={l.CANCELLED_BONDS_STATISTIC}>\r\n        <Metric value={stats.cancelledBonds.prettify(0)} />\r\n      </Statistic>\r\n      <Statistic lexicon={l.CLAIMED_BONDS_STATISTIC}>\r\n        <Metric value={stats.claimedBonds.prettify(0)} />\r\n      </Statistic>\r\n      <Statistic lexicon={l.TOTAL_BONDS_STATISTIC}>\r\n        <Metric value={stats.totalBonds.prettify(0)} />\r\n      </Statistic>\r\n\r\n      <Heading as=\"h2\" sx={{ mt: 3, fontWeight: \"body\" }}>\r\n        Treasury\r\n      </Heading>\r\n      <Statistic lexicon={l.TREASURY_PENDING}>\r\n        <Metric value={protocolInfo.treasury.pending.shorten()} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.TREASURY_ACQUIRED}>\r\n        <Metric value={protocolInfo.treasury.reserve.shorten()} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.TREASURY_PERMANENT}>\r\n        <Metric value={protocolInfo.treasury.permanent.shorten()} unit=\"LUSD\" />\r\n      </Statistic>\r\n      <Statistic lexicon={l.TREASURY_TOTAL}>\r\n        <Metric value={protocolInfo.treasury.total.shorten()} unit=\"LUSD\" />\r\n      </Statistic>\r\n\r\n      <Flex mt={3}>\r\n        <TreasuryChart />\r\n      </Flex>\r\n    </Card>\r\n  );\r\n};\r\n","import { Flex } from \"theme-ui\";\r\nimport type { ThemeUIStyleObject } from \"theme-ui\";\r\nimport { keyframes } from \"@emotion/react\";\r\n\r\nconst loading = keyframes`\r\n  from {\r\n    left: -25%;\r\n  }\r\n  to {\r\n    left: 100%;\r\n  }\r\n`;\r\n\r\ntype PlaceholderProps = { style?: ThemeUIStyleObject };\r\n\r\nexport const Placeholder: React.FC<PlaceholderProps> = ({ style }) => {\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        position: \"relative\",\r\n        backgroundColor: \"rgb(225, 230, 230)\",\r\n        overflow: \"hidden\",\r\n        borderRadius: \"5px\",\r\n        height: \"100%\",\r\n        width: \"100%\",\r\n        ...style\r\n      }}\r\n    >\r\n      <Flex\r\n        sx={{\r\n          position: \"absolute\",\r\n          left: \"-25%\",\r\n          height: \"100%\",\r\n          width: \"45%\",\r\n          backgroundImage:\r\n            \"linear-gradient(to left, rgba(251,251,251, .05), rgba(251,251,251, .3), rgba(251,251,251, .6), rgba(251,251,251, .3), rgba(251,251,251, .05))\",\r\n          animation: `${loading} 1s infinite`\r\n        }}\r\n      />\r\n      &nbsp;\r\n    </Flex>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Box, Text } from \"theme-ui\";\r\nimport type { ThemeUIStyleObject } from \"theme-ui\";\r\nimport { InfoIcon } from \"./InfoIcon\";\r\nimport { Placeholder } from \"./Placeholder\";\r\n\r\nconst mutedGray = \"#d9d9d9\";\r\n\r\nconst defaultCircleStyle = {\r\n  height: \"12px\",\r\n  width: \"12px\",\r\n  mx: \"-1px\",\r\n  borderRadius: \"50%\",\r\n  border: \"2px solid\",\r\n  borderColor: mutedGray,\r\n  background: \"none\",\r\n  zIndex: 1\r\n};\r\nconst solidCircleStyle = {\r\n  backgroundColor: \"gray\",\r\n  borderColor: \"gray\"\r\n};\r\nconst transparentCircleStyle = {\r\n  width: \"0px\",\r\n  mx: \"-2px\",\r\n  opacity: 0\r\n};\r\nconst defaultLineStyle = {\r\n  height: 4,\r\n  flexGrow: 1,\r\n  border: 0,\r\n  backgroundColor: mutedGray,\r\n  margin: 0,\r\n  padding: 0\r\n};\r\n\r\nconst solidLineStyle = {\r\n  backgroundColor: \"gray\",\r\n  opacity: 1\r\n};\r\n\r\nconst fadeLineStyle = (leftColor: string, rightColor: string) => ({\r\n  background: `linear-gradient(to right, ${leftColor}, ${rightColor})`\r\n});\r\n\r\ntype CircleProps = {\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\nconst Circle: React.FC<CircleProps> = ({ style }) => {\r\n  return <Box sx={{ ...defaultCircleStyle, ...style }} />;\r\n};\r\n\r\ntype LineProps = {\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\nconst Line: React.FC<LineProps> = ({ style }) => {\r\n  return <Box sx={{ ...defaultLineStyle, ...style }} />;\r\n};\r\n\r\n// Use the maximum possible date to represent unknown\r\nexport const UNKNOWN_DATE = new Date(8640000000000000);\r\n\r\nexport type EventType = {\r\n  date: Date;\r\n  label: React.ReactNode;\r\n  isEndOfLife?: boolean;\r\n  isMilestone?: boolean;\r\n  isLoading?: boolean;\r\n};\r\n\r\ntype EventProps = EventType & {\r\n  isFirst: boolean;\r\n  isLast: boolean;\r\n  isPast: boolean;\r\n};\r\n\r\ntype LabelProps = {\r\n  subLabel?: React.ReactNode;\r\n  description?: React.ReactNode;\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\ntype SubLabelProps = { style?: ThemeUIStyleObject };\r\nexport const SubLabel: React.FC<SubLabelProps> = ({ style, children }) => (\r\n  <Flex\r\n    sx={{\r\n      fontWeight: 200,\r\n      fontSize: \"0.98em\",\r\n      alignSelf: \"center\",\r\n      justifyContent: \"center\",\r\n      flexGrow: 1,\r\n      ...style\r\n    }}\r\n  >\r\n    {children}\r\n  </Flex>\r\n);\r\n\r\nexport const Label: React.FC<LabelProps> = ({ children, description, style }) => {\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        fontWeight: 300,\r\n        alignSelf: \"center\",\r\n        alignContent: \"center\",\r\n        alignItems: \"center\",\r\n        ...style\r\n      }}\r\n    >\r\n      {children}\r\n      &nbsp;\r\n      {description ? <InfoIcon size=\"xs\" tooltip={description} /> : null}\r\n    </Flex>\r\n  );\r\n};\r\n\r\nconst LoadingEvent: React.FC<{ label: React.ReactNode }> = ({ label }) => {\r\n  return (\r\n    <Flex sx={{ flexDirection: \"column\", flexGrow: 1 }}>\r\n      <Flex sx={{ justifyContent: \"center\" }}>\r\n        <Placeholder style={{ mx: \"20%\" }} />\r\n      </Flex>\r\n      <Flex sx={{ my: 1, alignItems: \"center\" }}>\r\n        <Line style={defaultLineStyle} />\r\n        <Circle style={defaultCircleStyle} />\r\n        <Line style={defaultLineStyle} />\r\n      </Flex>\r\n\r\n      <Flex sx={{ flexDirection: \"column\" }}>{label}</Flex>\r\n    </Flex>\r\n  );\r\n};\r\nconst Event: React.FC<EventProps> = ({\r\n  isFirst,\r\n  isLast,\r\n  isPast,\r\n  date,\r\n  label,\r\n  isEndOfLife,\r\n  isMilestone = true,\r\n  isLoading\r\n}) => {\r\n  if (isLoading) return <LoadingEvent label={label} />;\r\n\r\n  const isToday = date.toLocaleDateString() === new Date().toLocaleDateString();\r\n  const isUnknownDate = date.toDateString() === UNKNOWN_DATE.toDateString();\r\n\r\n  let circleStyle: ThemeUIStyleObject = { ...defaultCircleStyle };\r\n  let leftLineStyle: ThemeUIStyleObject = { ...defaultLineStyle };\r\n  let rightLineStyle: ThemeUIStyleObject = { ...defaultLineStyle };\r\n\r\n  if (isPast || isEndOfLife) {\r\n    circleStyle = { ...solidCircleStyle };\r\n    leftLineStyle = { ...solidLineStyle };\r\n  }\r\n\r\n  if (isPast) {\r\n    rightLineStyle = { ...solidLineStyle };\r\n  }\r\n\r\n  if (!isMilestone) {\r\n    circleStyle = { ...transparentCircleStyle };\r\n  }\r\n\r\n  if (isFirst) {\r\n    leftLineStyle = { ...leftLineStyle, ...fadeLineStyle(\"white\", \"gray\") };\r\n  }\r\n\r\n  if (isLast) {\r\n    rightLineStyle = { ...rightLineStyle, ...fadeLineStyle(mutedGray, \"white\") };\r\n  }\r\n\r\n  const dateText =\r\n    isToday && isEndOfLife\r\n      ? \"Now\"\r\n      : isUnknownDate\r\n      ? \"Unknown\"\r\n      : date.toLocaleDateString(\"en-GB\", { month: \"short\", day: \"2-digit\", year: \"numeric\" });\r\n\r\n  return (\r\n    <Flex sx={{ flexDirection: \"column\", flexGrow: 1 }}>\r\n      <Flex sx={{ justifyContent: \"center\" }}>\r\n        <Text sx={{ fontWeight: 400, alignSelf: \"center\" }}>{dateText}</Text>\r\n      </Flex>\r\n      <Flex sx={{ my: 1, alignItems: \"center\" }}>\r\n        <Line style={leftLineStyle} />\r\n        <Circle style={circleStyle} />\r\n        <Line style={rightLineStyle} />\r\n      </Flex>\r\n\r\n      <Flex sx={{ flexDirection: \"column\" }}>{label}</Flex>\r\n    </Flex>\r\n  );\r\n};\r\n\r\ntype HorizontalTimelineProps = {\r\n  events: EventType[];\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\nexport const HorizontalTimeline: React.FC<HorizontalTimelineProps> = ({ events, style }) => {\r\n  // Order by date, then by whether its selected or not (selected is newer)\r\n  const orderedEvents = [...events].sort((a, b) =>\r\n    a.date.getTime() === b.date.getTime()\r\n      ? Number(a.isEndOfLife) - Number(b.isEndOfLife)\r\n      : a.date.getTime() > b.date.getTime()\r\n      ? 1\r\n      : -1\r\n  );\r\n\r\n  const endOfLifeIdx = orderedEvents.findIndex(event => event.isEndOfLife);\r\n\r\n  return (\r\n    <Flex sx={{ flexGrow: 1, ...style }}>\r\n      {orderedEvents.map((event, idx) => (\r\n        <Event\r\n          key={idx}\r\n          isFirst={idx === 0}\r\n          isLast={idx === orderedEvents.length - 1}\r\n          isPast={idx < endOfLifeIdx}\r\n          date={event.date}\r\n          label={event.label}\r\n          isEndOfLife={event.isEndOfLife}\r\n          isMilestone={event.isMilestone}\r\n          isLoading={event.isLoading}\r\n        />\r\n      ))}\r\n    </Flex>\r\n  );\r\n};\r\n","import { ThemeUIStyleObject, Flex, Text } from \"theme-ui\";\r\nimport { InfoIcon } from \"../InfoIcon\";\r\nimport { Placeholder } from \"../Placeholder\";\r\nimport type { Lexicon } from \"../../lexicon\";\r\n\r\ntype RecordType = {\r\n  lexicon: Lexicon;\r\n  description?: string;\r\n  value?: string;\r\n  type?: string;\r\n  style?: ThemeUIStyleObject;\r\n};\r\n\r\nexport const Record: React.FC<RecordType> = ({ lexicon, value, type, style }) => {\r\n  return (\r\n    <Flex sx={{ flexDirection: \"column\", ...style }}>\r\n      <Flex as=\"h4\" sx={{ fontWeight: \"300\", alignItems: \"baseline\", justifyContent: \"center\" }}>\r\n        {lexicon.term} <InfoIcon size=\"xs\" tooltip={lexicon.description} link={lexicon.link} />\r\n      </Flex>\r\n      <Text as=\"h3\" sx={{ display: \"flex\", justifyContent: \"center\" }}>\r\n        {value ? (\r\n          <Text sx={{ fontWeight: \"400\" }}>{value}</Text>\r\n        ) : (\r\n          <Placeholder style={{ mx: \"20%\" }} />\r\n        )}\r\n        &nbsp;\r\n        {value && <Text sx={{ fontWeight: \"light\", opacity: 0.8 }}>{type}</Text>}\r\n      </Text>\r\n    </Flex>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Button } from \"theme-ui\";\r\nimport Tippy from \"@tippyjs/react\";\r\nimport { useBondView } from \"../../../context/BondViewContext\";\r\nimport type { SelectBondPayload } from \"../../../context/transitions\";\r\nimport { CANCEL_BOND, CLAIM_BOND } from \"../../../lexicon\";\r\n\r\nconst CHICKEN_EMOJI_CURSOR = `url(\"data:image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'  style='font-size: 24px'><text y='20'>🐔</text></svg>\"), auto`;\r\ntype ActionsProps = {\r\n  bondId: string;\r\n  disabled?: boolean;\r\n};\r\n\r\nexport const Actions: React.FC<ActionsProps> = ({ bondId, disabled = false }) => {\r\n  const { dispatchEvent, isBootstrapPeriodActive } = useBondView();\r\n\r\n  const handleCancelBondPressed = () => {\r\n    dispatchEvent(\"CANCEL_BOND_PRESSED\", { bondId } as SelectBondPayload);\r\n  };\r\n\r\n  const handleClaimBondPressed = () => {\r\n    dispatchEvent(\"CLAIM_BOND_PRESSED\", { bondId } as SelectBondPayload);\r\n  };\r\n\r\n  const cursor = disabled ? \"auto\" : CHICKEN_EMOJI_CURSOR;\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        disabled={disabled}\r\n        variant=\"outline\"\r\n        sx={{ height: \"44px\" }}\r\n        style={{\r\n          cursor\r\n        }}\r\n        onClick={handleCancelBondPressed}\r\n      >\r\n        {CANCEL_BOND.term}\r\n      </Button>\r\n      {isBootstrapPeriodActive && (\r\n        <Tippy\r\n          interactive={true}\r\n          placement=\"right\"\r\n          content=\"Bonds can be claimed after the bootstrap period is complete.\"\r\n          maxWidth=\"268px\"\r\n        >\r\n          <span>\r\n            <Button disabled={true} variant=\"outline\" sx={{ height: \"44px\" }}>\r\n              {CLAIM_BOND.term}\r\n            </Button>\r\n          </span>\r\n        </Tippy>\r\n      )}\r\n      {!isBootstrapPeriodActive && (\r\n        <Button\r\n          disabled={disabled}\r\n          variant=\"outline\"\r\n          sx={{ height: \"44px\" }}\r\n          style={{\r\n            cursor: disabled ? \"auto\" : cursor\r\n          }}\r\n          onClick={handleClaimBondPressed}\r\n        >\r\n          {CLAIM_BOND.term}\r\n        </Button>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\n\r\ntype Idle = \"IDLE\";\r\ntype Creating = \"CREATING\";\r\ntype Cancelling = \"CANCELLING\";\r\ntype Claiming = \"CLAIMING\";\r\ntype Swapping = \"SWAPPING\";\r\ntype ManagingLiquidity = \"MANAGING_LIQUIDITY\";\r\n\r\nexport type BondView = Idle | Creating | Cancelling | Claiming | Swapping | ManagingLiquidity;\r\n\r\n/* UI events */\r\ntype CreateBondPressed = \"CREATE_BOND_PRESSED\";\r\ntype CancelPressed = \"ABORT_PRESSED\";\r\ntype BackPressed = \"BACK_PRESSED\";\r\ntype ApprovePressed = \"APPROVE_PRESSED\";\r\ntype ConfirmPressed = \"CONFIRM_PRESSED\";\r\ntype CancelBondPressed = \"CANCEL_BOND_PRESSED\";\r\ntype ClaimBondPressed = \"CLAIM_BOND_PRESSED\";\r\ntype SwapPressed = \"SWAP_PRESSED\";\r\ntype AddLiquidityPressed = \"ADD_LIQUIDITY_PRESSED\";\r\ntype ManageLiquidityPressed = \"MANAGE_LIQUIDITY_PRESSED\";\r\n\r\n/* On-chain events */\r\ntype CreateBondConfirmed = \"CREATE_BOND_CONFIRMED\";\r\ntype CancelBondConfirmed = \"CANCEL_BOND_CONFIRMED\";\r\ntype ClaimBondConfirmed = \"CLAIM_BOND_CONFIRMED\";\r\ntype SwapConfirmed = \"SWAP_CONFIRMED\";\r\ntype ManageLiquidityConfirmed = \"MANAGE_LIQUIDITY_CONFIRMED\";\r\n\r\nexport type BondEvent =\r\n  | CreateBondPressed\r\n  | CancelBondPressed\r\n  | ClaimBondPressed\r\n  | SwapPressed\r\n  | AddLiquidityPressed\r\n  | ManageLiquidityPressed\r\n  | ApprovePressed\r\n  | ConfirmPressed\r\n  | CancelPressed\r\n  | BackPressed\r\n  | CreateBondConfirmed\r\n  | CancelBondConfirmed\r\n  | ClaimBondConfirmed\r\n  | SwapConfirmed\r\n  | ManageLiquidityConfirmed;\r\n\r\ntype BondEventTransitions = Record<BondView, Partial<Record<BondEvent, BondView>>>;\r\n\r\nexport const transitions: BondEventTransitions = {\r\n  IDLE: {\r\n    CREATE_BOND_PRESSED: \"CREATING\",\r\n    CANCEL_BOND_PRESSED: \"CANCELLING\",\r\n    CLAIM_BOND_PRESSED: \"CLAIMING\",\r\n    SWAP_PRESSED: \"SWAPPING\",\r\n    MANAGE_LIQUIDITY_PRESSED: \"MANAGING_LIQUIDITY\"\r\n  },\r\n  CREATING: {\r\n    ABORT_PRESSED: \"IDLE\",\r\n    CREATE_BOND_CONFIRMED: \"IDLE\",\r\n    BACK_PRESSED: \"IDLE\",\r\n    CONFIRM_PRESSED: \"CREATING\"\r\n  },\r\n  CLAIMING: {\r\n    ABORT_PRESSED: \"IDLE\",\r\n    BACK_PRESSED: \"IDLE\",\r\n    CONFIRM_PRESSED: \"CLAIMING\",\r\n    CLAIM_BOND_CONFIRMED: \"IDLE\"\r\n  },\r\n  CANCELLING: {\r\n    ABORT_PRESSED: \"IDLE\",\r\n    BACK_PRESSED: \"IDLE\",\r\n    CONFIRM_PRESSED: \"CANCELLING\",\r\n    CANCEL_BOND_CONFIRMED: \"IDLE\"\r\n  },\r\n  SWAPPING: {\r\n    ABORT_PRESSED: \"IDLE\",\r\n    BACK_PRESSED: \"IDLE\",\r\n    APPROVE_PRESSED: \"SWAPPING\",\r\n    CONFIRM_PRESSED: \"SWAPPING\",\r\n    SWAP_CONFIRMED: \"IDLE\"\r\n  },\r\n  MANAGING_LIQUIDITY: {\r\n    ABORT_PRESSED: \"IDLE\",\r\n    BACK_PRESSED: \"IDLE\",\r\n    APPROVE_PRESSED: \"MANAGING_LIQUIDITY\",\r\n    CONFIRM_PRESSED: \"MANAGING_LIQUIDITY\",\r\n    MANAGE_LIQUIDITY_CONFIRMED: \"IDLE\"\r\n  }\r\n};\r\n\r\nexport enum BLusdAmmTokenIndex {\r\n  BLUSD,\r\n  LUSD,\r\n  BLUSD_LUSD_LP\r\n}\r\n\r\nexport type CreateBondPayload = { deposit: Decimal };\r\n\r\nexport type SelectBondPayload = { bondId: string };\r\n\r\nexport type SwapPressedPayload = {\r\n  inputToken: BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD;\r\n};\r\n\r\nexport type SwapPayload = {\r\n  inputAmount: Decimal;\r\n  minOutputAmount: Decimal;\r\n};\r\n\r\nexport type Address = string | null;\r\n\r\nexport type Addresses = {\r\n  BLUSD_AMM_ADDRESS: Address;\r\n  BLUSD_AMM_STAKING_ADDRESS: Address;\r\n  BLUSD_TOKEN_ADDRESS: Address;\r\n  BOND_NFT_ADDRESS: Address;\r\n  CHICKEN_BOND_MANAGER_ADDRESS: Address;\r\n  LUSD_OVERRIDE_ADDRESS: Address;\r\n  BLUSD_LP_ZAP_ADDRESS: Address;\r\n};\r\n\r\n// This payload is only dispatched by \"Manage liquidity\"\r\nexport type ApprovePressedPayload = {\r\n  tokensNeedingApproval: Map<BLusdAmmTokenIndex, Address>;\r\n};\r\n\r\nexport type AddLiquidityPayload = {\r\n  action: \"addLiquidity\";\r\n  bLusdAmount: Decimal;\r\n  lusdAmount: Decimal;\r\n  minLpTokens: Decimal;\r\n  shouldStakeInGauge: boolean;\r\n};\r\n\r\nexport type RemoveLiquidityPayload = {\r\n  action: \"removeLiquidity\";\r\n  burnLpTokens: Decimal;\r\n  minBLusdAmount: Decimal;\r\n  minLusdAmount: Decimal;\r\n};\r\n\r\nexport type RemoveLiquidityOneCoinPayload = {\r\n  action: \"removeLiquidityOneCoin\";\r\n  burnLpTokens: Decimal;\r\n  output: BLusdAmmTokenIndex;\r\n  minAmount: Decimal;\r\n};\r\n\r\nexport type StakeLiquidityPayload = {\r\n  action: \"stakeLiquidity\";\r\n  stakeAmount: Decimal;\r\n};\r\n\r\nexport type UnstakeLiquidityPayload = {\r\n  action: \"unstakeLiquidity\";\r\n  unstakeAmount: Decimal;\r\n};\r\n\r\nexport type ClaimLpRewardsPayload = {\r\n  action: \"claimLpRewards\";\r\n};\r\n\r\nexport type ManageLiquidityPayload =\r\n  | AddLiquidityPayload\r\n  | RemoveLiquidityPayload\r\n  | RemoveLiquidityOneCoinPayload\r\n  | StakeLiquidityPayload\r\n  | UnstakeLiquidityPayload\r\n  | ClaimLpRewardsPayload;\r\n\r\nexport type Payload =\r\n  | CreateBondPayload\r\n  | SelectBondPayload\r\n  | SwapPressedPayload\r\n  | SwapPayload\r\n  | ApprovePressedPayload\r\n  | ManageLiquidityPayload;\r\n\r\nexport type BondStatus = \"NON_EXISTENT\" | \"PENDING\" | \"CANCELLED\" | \"CLAIMED\";\r\n\r\nexport type Bond = {\r\n  id: string;\r\n  deposit: Decimal;\r\n  startTime: number;\r\n  endTime: number;\r\n  status: BondStatus;\r\n  tokenUri: string;\r\n  accrued: Decimal;\r\n  breakEvenAccrual: Decimal;\r\n  rebondAccrual: Decimal;\r\n  breakEvenTime: Date;\r\n  rebondTime: Date;\r\n  marketValue: Decimal;\r\n  rebondReturn: number;\r\n  rebondRoi: number;\r\n  rebondApr: number;\r\n  claimNowReturn: number;\r\n  claimedAmount?: Decimal;\r\n  bondAgeInDays: number;\r\n  remainingRebondDays: number;\r\n  remainingBreakEvenDays: number;\r\n};\r\n\r\nexport type OptimisticBond = Pick<Bond, \"id\" | \"deposit\" | \"startTime\" | \"status\">;\r\n\r\nexport type Treasury = {\r\n  pending: Decimal;\r\n  reserve: Decimal;\r\n  permanent: Decimal;\r\n  total: Decimal;\r\n};\r\n\r\nexport type Stats = {\r\n  pendingBonds: Decimal;\r\n  cancelledBonds: Decimal;\r\n  claimedBonds: Decimal;\r\n  totalBonds: Decimal;\r\n};\r\n\r\nexport type ProtocolInfo = {\r\n  treasury: Treasury;\r\n  bLusdSupply: Decimal;\r\n  marketPrice: Decimal;\r\n  fairPrice: { lower: Decimal; upper: Decimal };\r\n  floorPrice: Decimal;\r\n  claimBondFee: Decimal;\r\n  alphaAccrualFactor: Decimal;\r\n  marketPricePremium: Decimal;\r\n  hasMarketPremium: boolean;\r\n  simulatedMarketPrice: Decimal;\r\n  breakEvenAccrualFactor: Decimal;\r\n  rebondAccrualFactor: Decimal;\r\n  breakEvenPeriodInDays: Decimal;\r\n  rebondPeriodInDays: Decimal;\r\n  yieldAmplification?: Decimal;\r\n  bLusdApr?: Decimal;\r\n  bLusdLpApr?: Decimal;\r\n  controllerTargetAge: Decimal;\r\n  averageBondAge: Decimal;\r\n  floorPriceWithoutPendingHarvests: Decimal;\r\n  windDownPrice: Decimal;\r\n};\r\n\r\nexport type TransactionStatus = \"IDLE\" | \"PENDING\" | \"CONFIRMED\" | \"FAILED\";\r\n\r\nexport type BondTransaction =\r\n  | \"CREATE\"\r\n  | \"CANCEL\"\r\n  | \"CLAIM\"\r\n  | \"APPROVE_AMM\"\r\n  | \"APPROVE_SPENDER\"\r\n  | \"SWAP\"\r\n  | \"MANAGE_LIQUIDITY\";\r\n\r\nexport type BondTransactionStatuses = Record<BondTransaction, TransactionStatus>;\r\n\r\nexport type Maybe<T> = T | undefined;\r\n\r\nexport type BLusdLpRewards = Array<{ name: string; address: string; amount: Decimal }>;\r\n","import { Card, Flex, Button, Image, ThemeUIStyleObject } from \"theme-ui\";\r\nimport { EventType, HorizontalTimeline } from \"../../../HorizontalTimeline\";\r\nimport { Record } from \"../../Record\";\r\nimport { Actions } from \"./actions/Actions\";\r\nimport { BLusdAmmTokenIndex, Bond as BondType, SwapPressedPayload } from \"../../context/transitions\";\r\nimport { Label, SubLabel } from \"../../../HorizontalTimeline\";\r\nimport * as l from \"../../lexicon\";\r\nimport { statuses, useBondView } from \"../../context/BondViewContext\";\r\nimport { useBondAddresses } from \"../../context/BondAddressesContext\";\r\nimport { InfiniteEstimate } from \"../InfiniteEstimation\";\r\n\r\nconst getBondEvents = (bond: BondType): EventType[] => {\r\n  const events = [\r\n    {\r\n      date: new Date(bond.startTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.BOND_CREATED.description}>{l.BOND_CREATED.term}</Label>\r\n          <SubLabel>{`0.00 bLUSD`}</SubLabel>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      date: new Date(bond.status === \"PENDING\" ? Date.now() : bond?.endTime ?? 0),\r\n      label: (\r\n        <>\r\n          <Label\r\n            description={\r\n              bond.status === \"PENDING\"\r\n                ? l.ACCRUED_AMOUNT.description\r\n                : `The date you ${statuses[bond.status].toLowerCase()} your bond.`\r\n            }\r\n            style={{ fontWeight: 500 }}\r\n          >\r\n            {bond.status === \"PENDING\" ? l.ACCRUED_AMOUNT.term : statuses[bond.status]}\r\n          </Label>\r\n          <SubLabel style={{ fontWeight: 400 }}>\r\n            {bond.status === \"PENDING\"\r\n              ? `${bond.accrued.prettify(2)} bLUSD`\r\n              : bond.status === \"CLAIMED\"\r\n              ? `${bond?.claimedAmount?.prettify(2)} bLUSD`\r\n              : \"\"}\r\n          </SubLabel>\r\n        </>\r\n      ),\r\n      isEndOfLife: true,\r\n      isMilestone: bond.status !== \"PENDING\"\r\n    }\r\n  ];\r\n\r\n  if (bond.status === \"PENDING\") {\r\n    events.push({\r\n      date: new Date(bond.breakEvenTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.BREAK_EVEN_TIME.description}>{l.BREAK_EVEN_TIME.term}</Label>\r\n          <SubLabel>\r\n            <InfiniteEstimate estimate={bond?.breakEvenAccrual}>\r\n              {bond?.breakEvenAccrual?.prettify(2) ?? \"?\"} bLUSD\r\n            </InfiniteEstimate>\r\n          </SubLabel>\r\n        </>\r\n      )\r\n    });\r\n\r\n    events.push({\r\n      date: new Date(bond.rebondTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.OPTIMUM_REBOND_TIME.description}>{l.OPTIMUM_REBOND_TIME.term}</Label>\r\n          <SubLabel>\r\n            <InfiniteEstimate estimate={bond?.rebondAccrual}>\r\n              {bond?.rebondAccrual?.prettify(2) ?? \"?\"} bLUSD\r\n            </InfiniteEstimate>\r\n          </SubLabel>\r\n        </>\r\n      )\r\n    });\r\n  }\r\n  return events;\r\n};\r\n\r\ntype BondProps = { bond: BondType; style?: ThemeUIStyleObject };\r\n\r\nexport const Bond: React.FC<BondProps> = ({ bond, style }) => {\r\n  const events = getBondEvents(bond);\r\n  const { dispatchEvent } = useBondView();\r\n  const { BOND_NFT_ADDRESS } = useBondAddresses();\r\n\r\n  const handleSellBLusdPressed = () => {\r\n    dispatchEvent(\"SWAP_PRESSED\", { inputToken: BLusdAmmTokenIndex.BLUSD } as SwapPressedPayload);\r\n  };\r\n\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        gap: \"12px\",\r\n        ...style\r\n      }}\r\n    >\r\n      <Flex\r\n        sx={{\r\n          flexShrink: 0,\r\n          boxShadow: 2,\r\n          borderRadius: 8.5,\r\n          border: 1,\r\n          borderColor: \"muted\",\r\n          bg: \"background\"\r\n        }}\r\n      >\r\n        <Image\r\n          sx={{ cursor: \"pointer\", minWidth: \"150px\" }}\r\n          src={bond.tokenUri}\r\n          alt=\"NFT image representation of your bond.\"\r\n          onClick={() => {\r\n            window.open(\r\n              `https://looksrare.org/collections/${BOND_NFT_ADDRESS}/${bond.id}`,\r\n              \"_blank\"\r\n            );\r\n          }}\r\n        />\r\n      </Flex>\r\n      <Card mt={[0, 0, 0, 0]} sx={{ borderRadius: 12, flexGrow: 1 }}>\r\n        <Flex p={[2, 3]} sx={{ flexDirection: \"column\" }}>\r\n          <HorizontalTimeline\r\n            style={{ fontSize: \"14.5px\", justifyContent: \"center\", pt: 2, mx: 3 }}\r\n            events={events}\r\n          />\r\n\r\n          <Flex mt={4} pl={3} variant=\"layout.actions\" sx={{ justifyContent: \"flex-end\" }}>\r\n            <Flex\r\n              sx={{\r\n                justifyContent: \"flex-start\",\r\n                flexGrow: 1,\r\n                alignItems: \"center\",\r\n                gap: \"0 28px\",\r\n                fontSize: \"14.5px\"\r\n              }}\r\n            >\r\n              <Record lexicon={l.BOND_DEPOSIT} value={bond.deposit.prettify(2)} type=\"LUSD\" />\r\n              {bond.status === \"PENDING\" && (\r\n                <Record\r\n                  lexicon={l.MARKET_VALUE}\r\n                  value={bond?.marketValue?.prettify(2) ?? \"0\"}\r\n                  type=\"LUSD\"\r\n                />\r\n              )}\r\n            </Flex>\r\n            {bond.status === \"PENDING\" && <Actions bondId={bond.id} />}\r\n            {bond.status !== \"PENDING\" && bond.status === \"CLAIMED\" && (\r\n              <Button variant=\"outline\" sx={{ height: \"44px\" }} onClick={handleSellBLusdPressed}>\r\n                Sell bLUSD\r\n              </Button>\r\n            )}\r\n          </Flex>\r\n        </Flex>\r\n      </Card>\r\n    </Flex>\r\n  );\r\n};\r\n","import { Card, Flex, ThemeUIStyleObject } from \"theme-ui\";\r\nimport { EventType, HorizontalTimeline, UNKNOWN_DATE } from \"../../../HorizontalTimeline\";\r\nimport { Record } from \"../../Record\";\r\nimport { Actions } from \"./actions/Actions\";\r\nimport type { OptimisticBond as OptimisticBondType } from \"../../context/transitions\";\r\nimport { Label, SubLabel } from \"../../../HorizontalTimeline\";\r\nimport * as l from \"../../lexicon\";\r\nimport { Placeholder } from \"../../../Placeholder\";\r\n\r\nconst getBondEvents = (bond: OptimisticBondType): EventType[] => {\r\n  return [\r\n    {\r\n      date: new Date(bond.startTime),\r\n      label: (\r\n        <>\r\n          <Label description=\"bLUSD accrual starts off at 0 and increases over time.\">\r\n            {l.BOND_CREATED.term}\r\n          </Label>\r\n          <SubLabel>{`0.00 bLUSD`}</SubLabel>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      date: new Date(Date.now()),\r\n      label: (\r\n        <>\r\n          <Label description={l.ACCRUED_AMOUNT.description} style={{ fontWeight: 500 }}>\r\n            {l.ACCRUED_AMOUNT.term}\r\n          </Label>\r\n          <SubLabel style={{ fontWeight: 400 }}></SubLabel>\r\n        </>\r\n      ),\r\n      isEndOfLife: true\r\n    },\r\n    {\r\n      date: UNKNOWN_DATE,\r\n      label: (\r\n        <>\r\n          <Label description=\"How many bLUSD are required to break-even at the current market price.\">\r\n            {l.BREAK_EVEN_TIME.term}\r\n          </Label>\r\n          <SubLabel style={{ fontWeight: 400 }}></SubLabel>\r\n        </>\r\n      ),\r\n      isLoading: true\r\n    },\r\n    {\r\n      date: UNKNOWN_DATE,\r\n      label: (\r\n        <>\r\n          <Label description=\"How many bLUSD are recommended before claiming the bond, selling the bLUSD for LUSD, and then opening another bond.\">\r\n            {l.OPTIMUM_REBOND_TIME.term}\r\n          </Label>\r\n          <SubLabel style={{ fontWeight: 400 }}></SubLabel>\r\n        </>\r\n      ),\r\n      isLoading: true\r\n    }\r\n  ];\r\n};\r\n\r\ntype BondProps = { bond: OptimisticBondType; style?: ThemeUIStyleObject };\r\n\r\nexport const OptimisticBond: React.FC<BondProps> = ({ bond, style }) => {\r\n  const events = getBondEvents(bond);\r\n\r\n  return (\r\n    <Flex\r\n      sx={{\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        gap: \"12px\",\r\n        ...style\r\n      }}\r\n    >\r\n      <Flex sx={{ width: 150, height: 210 }}>\r\n        <Placeholder />\r\n      </Flex>\r\n      <Card mt={[0, 0, 0, 0]} sx={{ borderRadius: 12, flexGrow: 1 }}>\r\n        <Flex p={[2, 3]} sx={{ flexDirection: \"column\" }}>\r\n          <HorizontalTimeline\r\n            style={{ fontSize: \"14.5px\", justifyContent: \"center\", pt: 2, mx: 3 }}\r\n            events={events}\r\n          />\r\n\r\n          <Flex mt={4} variant=\"layout.actions\" sx={{ justifyContent: \"flex-end\" }}>\r\n            <Flex\r\n              sx={{\r\n                justifyContent: \"flex-start\",\r\n                flexGrow: 1,\r\n                alignItems: \"center\",\r\n                pl: 4,\r\n                gap: \"0 28px\",\r\n                fontSize: \"14.5px\"\r\n              }}\r\n            >\r\n              <Record lexicon={l.BOND_DEPOSIT} value={bond.deposit.prettify(2)} type=\"LUSD\" />\r\n\r\n              <Record lexicon={l.MARKET_VALUE} type=\"LUSD\" />\r\n            </Flex>\r\n            <Actions bondId={bond.id} disabled />\r\n          </Flex>\r\n        </Flex>\r\n      </Card>\r\n    </Flex>\r\n  );\r\n};\r\n","import { useParams } from \"react-router-dom\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport type { BondStatus, Bond as BondType } from \"../../context/transitions\";\r\nimport { Bond } from \"./Bond\";\r\nimport { OptimisticBond } from \"./OptimisticBond\";\r\nimport { ActionDescription } from \"../../../ActionDescription\";\r\nimport { Box } from \"theme-ui\";\r\n\r\ntype BondFilter = \"pending\" | \"claimed\" | \"cancelled\";\r\n\r\nconst bondFilterToBondStatusMap: Record<BondFilter, BondStatus> = {\r\n  pending: \"PENDING\",\r\n  claimed: \"CLAIMED\",\r\n  cancelled: \"CANCELLED\"\r\n};\r\n\r\nconst getFilteredBonds = (bonds: BondType[], bondFilter: BondFilter) =>\r\n  bonds.filter(bond => bond.status === bondFilterToBondStatusMap[bondFilter]);\r\n\r\ntype FilteredBondsParams = { bondFilter: BondFilter | \"all\" };\r\n\r\nexport const FilteredBondList = () => {\r\n  const { bonds, optimisticBond } = useBondView();\r\n  const { bondFilter } = useParams<FilteredBondsParams>();\r\n\r\n  if (bonds === undefined) return null;\r\n\r\n  const isAllOrPending = bondFilter === \"all\" || bondFilter === \"pending\";\r\n  const showOptimisticBond = optimisticBond !== undefined && isAllOrPending;\r\n\r\n  const filteredBonds = bondFilter === \"all\" ? bonds : getFilteredBonds(bonds, bondFilter);\r\n\r\n  return (\r\n    <>\r\n      {\r\n        // @ts-ignore (TS doesn't realise optimisticBond can't be undefined here)\r\n        showOptimisticBond && <OptimisticBond bond={optimisticBond} style={{ mt: \"16px\" }} />\r\n      }\r\n\r\n      {filteredBonds.map((bond: BondType, idx: number) => {\r\n        const isFirst = idx === 0 && !showOptimisticBond;\r\n        const style = { mt: isFirst ? \"16px\" : \"32px\" };\r\n        return <Bond bond={bond} key={idx} style={style} />;\r\n      })}\r\n\r\n      {!showOptimisticBond && filteredBonds.length === 0 && (\r\n        <Box mt={2}>\r\n          <ActionDescription>\r\n            You don't have any {bondFilter !== \"all\" ? bondFilter : null} bonds\r\n          </ActionDescription>\r\n        </Box>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex } from \"theme-ui\";\r\nimport { Redirect, Route, Switch, useRouteMatch } from \"react-router-dom\";\r\nimport { Link } from \"../../../Link\";\r\nimport { FilteredBondList } from \"./FilteredBondList\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\n\r\nexport const BondList: React.FC = () => {\r\n  const { bonds } = useBondView();\r\n  const { url, path } = useRouteMatch();\r\n\r\n  return (\r\n    <>\r\n      {bonds && (\r\n        <Flex as=\"nav\" mt={2}>\r\n          <Link to={`${url}/all`} p={2}>\r\n            All\r\n          </Link>\r\n          <Link to={`${url}/pending`} p={2}>\r\n            Pending\r\n          </Link>\r\n          <Link to={`${url}/claimed`} p={2}>\r\n            Claimed\r\n          </Link>\r\n          <Link to={`${url}/cancelled`} p={2}>\r\n            Cancelled\r\n          </Link>\r\n        </Flex>\r\n      )}\r\n\r\n      <Switch>\r\n        <Route exact path={path}>\r\n          <Redirect to={`${path}/pending`} />\r\n        </Route>\r\n        <Route path={`${path}/:bondFilter`}>\r\n          <FilteredBondList />\r\n        </Route>\r\n      </Switch>\r\n    </>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Card, Box, Heading, Flex, Button } from \"theme-ui\";\r\nimport { Empty } from \"./Empty\";\r\nimport { BondList } from \"./BondList\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { BONDS } from \"../../lexicon\";\r\nimport { InfoIcon } from \"../../../InfoIcon\";\r\nimport { BLusdAmmTokenIndex, SwapPressedPayload } from \"../../context/transitions\";\r\nimport { useLiquity } from \"../../../../hooks/LiquityContext\";\r\nimport { useBondAddresses } from \"../../context/BondAddressesContext\";\r\n\r\nexport const Idle: React.FC = () => {\r\n  const { liquity } = useLiquity();\r\n  const { LUSD_OVERRIDE_ADDRESS } = useBondAddresses();\r\n\r\n  const { dispatchEvent, bonds, getLusdFromFaucet, lusdBalance, hasLoaded } = useBondView();\r\n  const [chain, setChain] = useState<number>();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (liquity.connection.signer === undefined || chain !== undefined) return;\r\n      const chainId = await liquity.connection.signer.getChainId();\r\n      setChain(chainId);\r\n    })();\r\n  }, [chain, liquity.connection.signer]);\r\n\r\n  if (!hasLoaded) return null;\r\n\r\n  const hasBonds = bonds !== undefined && bonds.length > 0;\r\n\r\n  const showLusdFaucet = LUSD_OVERRIDE_ADDRESS !== null && lusdBalance?.eq(0);\r\n\r\n  const handleManageLiquidityPressed = () => dispatchEvent(\"MANAGE_LIQUIDITY_PRESSED\");\r\n\r\n  const handleBuyBLusdPressed = () =>\r\n    dispatchEvent(\"SWAP_PRESSED\", { inputToken: BLusdAmmTokenIndex.LUSD } as SwapPressedPayload);\r\n\r\n  const handleSellBLusdPressed = () =>\r\n    dispatchEvent(\"SWAP_PRESSED\", { inputToken: BLusdAmmTokenIndex.BLUSD } as SwapPressedPayload);\r\n\r\n  return (\r\n    <>\r\n      <Flex variant=\"layout.actions\" sx={{ mt: 4, mb: 3 }}>\r\n        <Button variant=\"outline\" onClick={handleManageLiquidityPressed}>\r\n          Manage liquidity\r\n        </Button>\r\n\r\n        <Button variant=\"outline\" onClick={handleBuyBLusdPressed}>\r\n          Buy bLUSD\r\n        </Button>\r\n\r\n        <Button variant=\"outline\" onClick={handleSellBLusdPressed}>\r\n          Sell bLUSD\r\n        </Button>\r\n\r\n        {showLusdFaucet && (\r\n          <Button variant={hasBonds ? \"outline\" : \"primary\"} onClick={() => getLusdFromFaucet()}>\r\n            Get 10k LUSD\r\n          </Button>\r\n        )}\r\n\r\n        {hasBonds && (\r\n          <Button variant=\"primary\" onClick={() => dispatchEvent(\"CREATE_BOND_PRESSED\")}>\r\n            Create another bond\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n\r\n      {!hasBonds && (\r\n        <Card>\r\n          <Heading>\r\n            <Flex>\r\n              {BONDS.term}\r\n              <InfoIcon\r\n                placement=\"left\"\r\n                size=\"xs\"\r\n                tooltip={<Card variant=\"tooltip\">{BONDS.description}</Card>}\r\n              />\r\n            </Flex>\r\n          </Heading>\r\n          <Box sx={{ p: [2, 3] }}>\r\n            <Empty />\r\n\r\n            <Flex variant=\"layout.actions\" mt={4}>\r\n              <Button variant=\"primary\" onClick={() => dispatchEvent(\"CREATE_BOND_PRESSED\")}>\r\n                Create bond\r\n              </Button>\r\n            </Flex>\r\n          </Box>\r\n        </Card>\r\n      )}\r\n\r\n      {hasBonds && <BondList />}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Button, Text, Spinner } from \"theme-ui\";\r\nimport { ActionDescription } from \"../../../../../ActionDescription\";\r\nimport { useBondView } from \"../../../../context/BondViewContext\";\r\n\r\nexport const Cancel: React.FC = () => {\r\n  const { dispatchEvent, selectedBond: bond, statuses } = useBondView();\r\n\r\n  const isProcessingTransaction = statuses.CANCEL === \"PENDING\";\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\");\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  if (bond === undefined) return null;\r\n\r\n  return (\r\n    <>\r\n      <ActionDescription>\r\n        You will receive your bonded{\" \"}\r\n        <Text sx={{ fontWeight: \"bold\" }}>{bond.deposit.prettify(2)} LUSD</Text> back and forgo{\" \"}\r\n        <Text sx={{ fontWeight: \"bold\" }}>{bond.accrued.shorten()} bLUSD</Text>\r\n      </ActionDescription>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBackPressed} disabled={isProcessingTransaction}>\r\n          Back\r\n        </Button>\r\n        <Button variant=\"primary\" onClick={handleConfirmPressed} disabled={isProcessingTransaction}>\r\n          {!isProcessingTransaction && <>Confirm</>}\r\n          {isProcessingTransaction && <Spinner size=\"28px\" sx={{ color: \"white\" }} />}\r\n        </Button>\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Button, Text, Spinner } from \"theme-ui\";\r\nimport { ActionDescription } from \"../../../../../ActionDescription\";\r\nimport { useBondView } from \"../../../../context/BondViewContext\";\r\n\r\nexport const Claim: React.FC = () => {\r\n  const { dispatchEvent, selectedBond: bond, statuses } = useBondView();\r\n\r\n  const isProcessingTransaction = statuses.CLAIM === \"PENDING\";\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\");\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  if (bond === undefined) return null;\r\n\r\n  return (\r\n    <>\r\n      <ActionDescription>\r\n        You will receive <Text sx={{ fontWeight: \"bold\" }}>{bond.accrued.prettify(2)} bLUSD</Text>{\" \"}\r\n        and forgo your bonded{\" \"}\r\n        <Text sx={{ fontWeight: \"bold\" }}>{bond.deposit.prettify(2)} LUSD</Text>\r\n      </ActionDescription>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBackPressed} disabled={isProcessingTransaction}>\r\n          Back\r\n        </Button>\r\n        <Button variant=\"primary\" onClick={handleConfirmPressed} disabled={isProcessingTransaction}>\r\n          {!isProcessingTransaction && <>Confirm</>}\r\n          {isProcessingTransaction && <Spinner size=\"28px\" sx={{ color: \"white\" }} />}\r\n        </Button>\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport Modal from \"react-modal\";\r\n\r\nconst modalStyle = {\r\n  content: {\r\n    top: \"50%\",\r\n    left: \"50%\",\r\n    right: \"auto\",\r\n    bottom: \"auto\",\r\n    marginRight: \"-50%\",\r\n    transform: \"translate(-50%, -50%)\",\r\n    maxWidth: \"620px\",\r\n    width: \"580px\",\r\n    maxHeight: \"94vh\",\r\n    overflow: \"visible\"\r\n  },\r\n  overlay: { zIndex: 2 }\r\n};\r\n\r\ntype ModalProps = {\r\n  onDismiss: () => void;\r\n  style?: React.CSSProperties;\r\n};\r\n\r\nexport const ReactModal: React.FC<ModalProps> = ({ children, onDismiss, style }) => {\r\n  const handleDismiss = () => onDismiss();\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={true}\r\n      onRequestClose={handleDismiss}\r\n      style={{\r\n        ...modalStyle,\r\n        content: { ...modalStyle.content, ...style }\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          position: \"static\",\r\n          overflowY: \"scroll\",\r\n          maxHeight: \"90vh\"\r\n        }}\r\n      >\r\n        {children}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport { BigNumber } from \"ethers\";\r\nimport { lambertW0 } from \"lambert-w-function\";\r\n\r\nconst milliseconds = (seconds: number) => seconds * 1000;\r\n\r\nconst toFloat = (decimal: Decimal): number => parseFloat(decimal.toString());\r\n\r\nconst numberify = (bigNumber: BigNumber): number => bigNumber.toNumber();\r\n\r\nconst decimalify = (bigNumber: BigNumber): Decimal =>\r\n  Decimal.fromBigNumberString(bigNumber.toHexString());\r\n\r\nconst percentify = (fraction: number): number => fraction * 100;\r\n\r\nconst secondsToDays = (seconds: number): number => seconds / 60 / 60 / 24;\r\n\r\nconst daysToMilliseconds = (days: number): number => days * 60 * 60 * 24 * 1000;\r\n\r\nconst getBondAgeInDays = (startTime: number): number =>\r\n  secondsToDays((Date.now() - startTime) / 1000);\r\n\r\nconst dateWithoutHours = (timestamp: number) => new Date(new Date(timestamp).toDateString());\r\n\r\n// Decimal type doesn't support negatives so use number instead\r\nconst getReturn = (accrued: Decimal, deposit: Decimal, marketPrice: Decimal): number => {\r\n  const accruedLusdValue = accrued.mul(marketPrice);\r\n  return parseFloat(accruedLusdValue.toString()) - parseFloat(deposit.toString());\r\n};\r\n\r\nconst dummyTokenUri =\r\n  \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NTAgMTA1MCI+PHN0eWxlPiNjYi1lZ2ctNTUgLmNiLWVnZyBwYXRoIHthbmltYXRpb246IHNoYWtlIDNzIGluZmluaXRlIGVhc2Utb3V0O3RyYW5zZm9ybS1vcmlnaW46IDUwJTt9QGtleWZyYW1lcyBzaGFrZSB7MCUgeyB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsgfTY1JSB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9NzAlIHsgdHJhbnNmb3JtOiByb3RhdGUoM2RlZyk7IH03NSUgeyB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsgfTgwJSB7IHRyYW5zZm9ybTogcm90YXRlKC0zZGVnKTsgfTg1JSB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9OTAlIHsgdHJhbnNmb3JtOiByb3RhdGUoM2RlZyk7IH0xMDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7IH19PC9zdHlsZT48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImNiLWVnZy01NS1jYXJkLWRpYWdvbmFsLWdyYWRpZW50IiB5MT0iMTAwJSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2ZmZDIwMCIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI2ZmMDA4NyIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxnIGlkPSJjYi1lZ2ctNTUiPjxyZWN0IGZpbGw9IiNjZDdmMzIiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJ4PSIzNy41Ii8+PHJlY3Qgc3R5bGU9ImZpbGw6IHVybCgjY2ItZWdnLTU1LWNhcmQtZGlhZ29uYWwtZ3JhZGllbnQpIiB4PSIzMCIgeT0iMzAiIHdpZHRoPSI2OTAiIGhlaWdodD0iOTkwIiByeD0iMzcuNSIvPjxlbGxpcHNlIGZpbGw9IiMwYTEwMmUiIGN4PSIzNzUiIGN5PSI1NjAuMjUiIHJ4PSI2MCIgcnk9IjExLjQiIC8+PGcgY2xhc3M9ImNiLWVnZyI+PHBhdGggZmlsbD0iI2NkN2YzMiIgZD0iTTI5My44NiA0NzguMTJjMCA0NS4zNiAzNi40IDgyLjEzIDgxLjI5IDgyLjEzczgxLjI5LTM2Ljc3IDgxLjI5LTgyLjEzUzQyMC4wNSAzNjUuODUgMzc1LjE1IDM2NS44NUMzMzIuNzQgMzY1Ljg1IDI5My44NiA0MzIuNzYgMjkzLjg2IDQ3OC4xMloiLz48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6IHNvZnQtbGlnaHQiIGZpbGw9IiNmZmYiIGQ9Ik0zMjguOTYgNDA5LjRjLTYgMTMuNTktNS40OCAyOS41MyAzLjI1IDM2LjExIDkuNzYgNy4zNSAyMy44OSA5IDM2Ljk4LTMuMTMgMTIuNTctMTEuNjYgMjMuNDgtNDMuOTQgMS4yNC01NS41QzM1OC4yNSAzODAuNTUgMzM1LjU5IDM5NC4zNSAzMjguOTYgNDA5LjRaIi8+PHBhdGggc3R5bGU9Im1peC1ibGVuZC1tb2RlOiBzb2Z0LWxpZ2h0IiBmaWxsPSIjMDAwIiBkPSJNNDE2LjE3IDM4NS4wMmMxMS45NCAyMC45MiAxOS4xNSA0NS4zNSAxOS4xNCA2NS41MiAwIDQ1LjM2LTM2LjQgODIuMTMtODEuMyA4Mi4xM2E4MC40NSA4MC40NSAwIDAgMS01Mi41Mi0xOS40NUMzMTQuNTIgNTQxLjAzIDM0Mi41NCA1NjAuMjcgMzc1IDU2MC4yN2M0NC45IDAgODEuMy0zNi43NyA4MS4zLTgyLjEzQzQ1Ni4zMSA0NDcuOTUgNDQwLjE4IDQwOC4yMiA0MTYuMTcgMzg1LjAyWiIvPjwvZz48dGV4dCBmaWxsPSIjZmZmIiBmb250LWZhbWlseT0iQXJpYWwgQmxhY2ssIEFyaWFsIiBmb250LXNpemU9IjcycHgiIGZvbnQtd2VpZ2h0PSI4MDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjUwJSIgeT0iMTQlIj5MVVNEPC90ZXh0Pjx0ZXh0IGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgQXJpYWwiIGZvbnQtc2l6ZT0iMzBweCIgZm9udC13ZWlnaHQ9IjgwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iNTAlIiB5PSIxOSUiPklEOiA1NTwvdGV4dD48dGV4dCBmaWxsPSIjZmZmIiBmb250LWZhbWlseT0iQXJpYWwgQmxhY2ssIEFyaWFsIiBmb250LXNpemU9IjQwcHgiIGZvbnQtd2VpZ2h0PSI4MDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjUwJSIgeT0iNzIlIj5CT05EIEFNT1VOVDwvdGV4dD48dGV4dCBmaWxsPSIjZmZmIiBmb250LWZhbWlseT0iQXJpYWwgQmxhY2ssIEFyaWFsIiBmb250LXNpemU9IjY0cHgiIGZvbnQtd2VpZ2h0PSI4MDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjUwJSIgeT0iODElIj40MDI8L3RleHQ+PHRleHQgZmlsbD0iI2ZmZiIgZm9udC1mYW1pbHk9IkFyaWFsIEJsYWNrLCBBcmlhbCIgZm9udC1zaXplPSIzMHB4IiBmb250LXdlaWdodD0iODAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiB4PSI1MCUiIHk9IjkxJSIgb3BhY2l0eT0iMC42Ij5TRVBURU1CRVIgNywgMjAyMjwvdGV4dD48L2c+PC9zdmc+\";\r\nconst getTokenUri = (encodedTokenUri: string): string => {\r\n  // HACK/TODO: new goerli deployment has fixed data format issue, switch to it\r\n  const dataStartIndex = encodedTokenUri.indexOf(\"base64,\") + \"base64,\".length;\r\n  if (dataStartIndex === -1) return \"TODO:\"; // TODO: should we render an error image?\r\n\r\n  const hack = atob(encodedTokenUri.slice(dataStartIndex))\r\n    .replace(`\"background_color\":`, `,\"background_color\":`) // Goerli fix\r\n    .replace(\",,\", \",\"); // Rinkeby fix\r\n\r\n  const tokenUri = hack ? JSON.parse(hack)?.image : dummyTokenUri; // for localhost testing\r\n  return tokenUri;\r\n};\r\n\r\nconst getBreakEvenPeriodInDays = (\r\n  alphaAccrualFactor: Decimal,\r\n  marketPricePremium: Decimal,\r\n  claimBondFee: Decimal\r\n): Decimal => {\r\n  const effectivePremium = marketPricePremium.mul(Decimal.ONE.sub(claimBondFee));\r\n  if (effectivePremium.lte(Decimal.ONE)) return Decimal.INFINITY;\r\n  return alphaAccrualFactor.div(effectivePremium.sub(Decimal.ONE));\r\n};\r\n\r\nconst getFutureBLusdAccrualFactor = (\r\n  floorPrice: Decimal,\r\n  daysInFuture: Decimal,\r\n  alphaAccrualFactor: Decimal,\r\n  bondAgeInDays = Decimal.ZERO\r\n): Decimal => {\r\n  const duration = daysInFuture.sub(bondAgeInDays);\r\n  return Decimal.ONE.div(floorPrice).mul(duration.div(duration.add(alphaAccrualFactor)));\r\n};\r\n\r\nconst getRebondPeriodInDays = (\r\n  alphaAccrualFactor: Decimal,\r\n  marketPricePremium: Decimal,\r\n  claimBondFee: Decimal\r\n): Decimal => {\r\n  const effectivePremium = Decimal.ONE.sub(claimBondFee).mul(marketPricePremium);\r\n  if (effectivePremium.lte(Decimal.ONE)) return Decimal.INFINITY;\r\n  const sqrt = Decimal.from(Math.sqrt(parseFloat(effectivePremium.toString())));\r\n  const dividend = Decimal.ONE.add(sqrt);\r\n  const divisor = effectivePremium.sub(Decimal.ONE);\r\n  return alphaAccrualFactor.mul(dividend.div(divisor));\r\n};\r\n\r\nconst getFutureDateInDays = (days: number): Date => {\r\n  return new Date(Math.round(Date.now() + daysToMilliseconds(days)));\r\n};\r\n\r\nconst getFloorPrice = (\r\n  bammLusdDebt: Decimal,\r\n  totalLusdInCurve: Decimal,\r\n  pendingLusd: Decimal,\r\n  permanentLusd: Decimal,\r\n  bLusdSupply: Decimal\r\n): Decimal => {\r\n  return bammLusdDebt.add(totalLusdInCurve).sub(pendingLusd).sub(permanentLusd).div(bLusdSupply);\r\n};\r\n\r\nconst getAverageBondAgeInSeconds = (\r\n  totalWeightedStartTimes: Decimal,\r\n  pendingBucketLusd: Decimal\r\n): Decimal => {\r\n  const averageStartTimeMs =\r\n    Math.round(parseFloat(totalWeightedStartTimes.div(pendingBucketLusd).toString())) * 1000;\r\n  const averageBondAgeInSeconds = Decimal.from(Date.now() - averageStartTimeMs).div(1000);\r\n\r\n  return averageBondAgeInSeconds;\r\n};\r\n\r\nconst getDaysUntilControllerStartsAdjusting = (\r\n  averageBondAgeInSeconds: Decimal,\r\n  targetBondAgeInSeconds: Decimal\r\n): Decimal => {\r\n  const secondsUntil = targetBondAgeInSeconds.gt(averageBondAgeInSeconds)\r\n    ? targetBondAgeInSeconds.sub(averageBondAgeInSeconds)\r\n    : Decimal.ZERO;\r\n  const daysUntil = secondsToDays(parseFloat(secondsUntil.toString()));\r\n  return Decimal.from(daysUntil);\r\n};\r\n\r\n/*\r\n  Given the current rebond/break-even period, work out how many days\r\n  until the bond age will meet the reduced rebond/break-even period\r\n\r\n  Formula:\r\n     bondAge + max((averageBondAge - targetBondAge), 0) + k = 0.99^k * rebondOrBreakEvenPeriod\r\n    (0.99 because the controller reduces alpha by 1% per day)\r\n  \r\n  Solved for k =\r\n    -(W(-(ln(0.99)x / 0.99^(bondAge + max((averageBondAge - targetBondAge), 0))) + ln(0.99) * (bondAge + max((averageBondAge - targetBondAge), 0))) / ln(0.99)\r\n  Where:\r\n    k = days until bond meets the reduced rebond/break-even period\r\n    W = lambert W function\r\n*/\r\nconst getRemainingRebondOrBreakEvenDays = (\r\n  bondAgeInSeconds: Decimal,\r\n  targetBondAgeInSeconds: Decimal,\r\n  averageBondAgeInSeconds: Decimal,\r\n  rebondOrBreakEvenPeriodInDays: Decimal\r\n): number => {\r\n  const bondAgeInDays = secondsToDays(toFloat(bondAgeInSeconds));\r\n  const daysUntilControllerStartsAdjusting = toFloat(\r\n    getDaysUntilControllerStartsAdjusting(averageBondAgeInSeconds, targetBondAgeInSeconds)\r\n  );\r\n  const rebondOrBreakEvenDaysRemaining = toFloat(rebondOrBreakEvenPeriodInDays) - bondAgeInDays;\r\n\r\n  if (rebondOrBreakEvenDaysRemaining < daysUntilControllerStartsAdjusting) {\r\n    return rebondOrBreakEvenDaysRemaining;\r\n  }\r\n\r\n  const lambertDividend = Math.log(0.99) * toFloat(rebondOrBreakEvenPeriodInDays);\r\n  const lambertDivisor = 0.99 ** (bondAgeInDays + daysUntilControllerStartsAdjusting);\r\n  const lambertQuotient = lambertW0(-(lambertDividend / lambertDivisor));\r\n\r\n  const formulaDividend =\r\n    lambertQuotient + Math.log(0.99) * (bondAgeInDays + daysUntilControllerStartsAdjusting);\r\n\r\n  const formulaDivisor = Math.log(0.99);\r\n\r\n  const daysUntilBondReachesRebondOrBreakEven = -(formulaDividend / formulaDivisor);\r\n\r\n  return daysUntilBondReachesRebondOrBreakEven;\r\n};\r\n\r\nconst getRebondOrBreakEvenTimeWithControllerAdjustment = (\r\n  bondAgeInSeconds: Decimal,\r\n  targetBondAgeInSeconds: Decimal,\r\n  averageBondAgeInSeconds: Decimal,\r\n  rebondOrBreakEvenPeriodInDays: Decimal\r\n): Date => {\r\n  const daysUntilBondReachesRebondOrBreakEven = getRemainingRebondOrBreakEvenDays(\r\n    bondAgeInSeconds,\r\n    targetBondAgeInSeconds,\r\n    averageBondAgeInSeconds,\r\n    rebondOrBreakEvenPeriodInDays\r\n  );\r\n\r\n  return getFutureDateInDays(daysUntilBondReachesRebondOrBreakEven);\r\n};\r\n\r\nexport {\r\n  milliseconds,\r\n  toFloat,\r\n  numberify,\r\n  decimalify,\r\n  percentify,\r\n  getBondAgeInDays,\r\n  daysToMilliseconds,\r\n  dateWithoutHours,\r\n  getReturn,\r\n  getTokenUri,\r\n  getFutureBLusdAccrualFactor,\r\n  getBreakEvenPeriodInDays,\r\n  getRebondPeriodInDays,\r\n  getAverageBondAgeInSeconds,\r\n  getRemainingRebondOrBreakEvenDays,\r\n  getRebondOrBreakEvenTimeWithControllerAdjustment,\r\n  getFloorPrice\r\n};\r\n","/** @jsxImportSource theme-ui */\r\nimport React from \"react\";\r\nimport { Flex, Heading, Grid, Close, Box } from \"theme-ui\";\r\nimport { Record } from \"../../Record\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { HorizontalTimeline, Label, SubLabel } from \"../../../HorizontalTimeline\";\r\nimport type { EventType } from \"../../../HorizontalTimeline\";\r\nimport * as l from \"../../lexicon\";\r\nimport { Cancel } from \"./actions/cancel/Cancel\";\r\nimport { Claim } from \"./actions/claim/Claim\";\r\nimport { Warning } from \"../../../Warning\";\r\nimport { ReactModal } from \"../../../ReactModal\";\r\nimport { percentify } from \"../../utils\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { InfiniteEstimate } from \"../InfiniteEstimation\";\r\n\r\nexport const Actioning: React.FC = () => {\r\n  const { dispatchEvent, view, selectedBond: bond } = useBondView();\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n\r\n  if (bond === undefined) return null;\r\n\r\n  let Actions;\r\n  switch (view) {\r\n    case \"CANCELLING\": {\r\n      Actions = <Cancel />;\r\n      break;\r\n    }\r\n    case \"CLAIMING\": {\r\n      Actions = <Claim />;\r\n      break;\r\n    }\r\n  }\r\n\r\n  const events: EventType[] = [\r\n    {\r\n      date: new Date(bond.startTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.BOND_CREATED.description}>{l.BOND_CREATED.term}</Label>\r\n          <SubLabel>{`0 bLUSD`}</SubLabel>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      date: new Date(bond.breakEvenTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.BREAK_EVEN_TIME.description}>{l.BREAK_EVEN_TIME.term}</Label>\r\n          <SubLabel>\r\n            <InfiniteEstimate estimate={bond.breakEvenAccrual}>\r\n              {bond.breakEvenAccrual.prettify(2)} bLUSD\r\n            </InfiniteEstimate>\r\n          </SubLabel>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      date: new Date(bond.rebondTime),\r\n      label: (\r\n        <>\r\n          <Label description={l.OPTIMUM_REBOND_TIME.description}>{l.OPTIMUM_REBOND_TIME.term}</Label>\r\n          <SubLabel>\r\n            <InfiniteEstimate estimate={bond.rebondAccrual}>\r\n              {bond.rebondAccrual.prettify(2)} bLUSD\r\n            </InfiniteEstimate>\r\n          </SubLabel>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      date: new Date(Date.now()),\r\n      label: (\r\n        <>\r\n          <Label description={l.ACCRUED_AMOUNT.description} style={{ fontWeight: 500 }}>\r\n            {l.ACCRUED_AMOUNT.term}\r\n          </Label>\r\n          <SubLabel style={{ fontWeight: 400 }}>{`${bond.accrued.prettify(2)} bLUSD`}</SubLabel>\r\n        </>\r\n      ),\r\n      isEndOfLife: true,\r\n      isMilestone: false\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <ReactModal onDismiss={handleDismiss}>\r\n      <Heading as=\"h2\" sx={{ pt: 2, pb: 3, px: 2 }}>\r\n        <Flex sx={{ justifyContent: \"center\" }}>\r\n          {view === \"CANCELLING\" ? l.CANCEL_BOND.term : l.CLAIM_BOND.term}\r\n        </Flex>\r\n        <Close\r\n          onClick={handleDismiss}\r\n          sx={{\r\n            position: \"absolute\",\r\n            right: \"24px\",\r\n            top: \"24px\"\r\n          }}\r\n        />\r\n      </Heading>\r\n      <Flex my={4} mx={2} sx={{ justifyContent: \"center\" }}>\r\n        <HorizontalTimeline events={events} />\r\n      </Flex>\r\n      <Grid gap=\"12px\" columns={3} sx={{ my: 4, justifyItems: \"center\" }}>\r\n        <Record lexicon={l.BOND_DEPOSIT} value={bond.deposit.prettify(2)} type=\"LUSD\" />\r\n\r\n        <Record lexicon={l.MARKET_VALUE} value={bond.marketValue.prettify(2)} type=\"LUSD\" />\r\n\r\n        {view === \"CLAIMING\" && (\r\n          <Record lexicon={l.BOND_RETURN} value={bond.claimNowReturn.toFixed(2)} type=\"LUSD\" />\r\n        )}\r\n      </Grid>\r\n      <details>\r\n        <summary sx={{ pl: 2, mt: 4, cursor: \"pointer\" }}>Rebond estimations</summary>\r\n        <Grid gap=\"20px\" columns={3} sx={{ my: 2, justifyItems: \"center\" }}>\r\n          <Record\r\n            lexicon={l.REBOND_RETURN}\r\n            value={bond.rebondAccrual.eq(Decimal.INFINITY) ? \"N/A\" : bond.rebondReturn.toFixed(2)}\r\n            type=\"LUSD\"\r\n          />\r\n\r\n          <Record\r\n            lexicon={l.REBOND_TIME_ROI}\r\n            value={\r\n              bond.rebondAccrual.eq(Decimal.INFINITY)\r\n                ? \"N/A\"\r\n                : percentify(bond.rebondRoi).toFixed(2) + \"%\"\r\n            }\r\n          />\r\n\r\n          <Record\r\n            lexicon={l.OPTIMUM_APY}\r\n            value={\r\n              bond.rebondAccrual.eq(Decimal.INFINITY)\r\n                ? \"N/A\"\r\n                : percentify(bond.rebondApr).toFixed(2) + \"%\"\r\n            }\r\n          />\r\n        </Grid>\r\n      </details>\r\n\r\n      <Box mt={3}>\r\n        {view === \"CLAIMING\" && bond.claimNowReturn < 0 && (\r\n          <Warning>You are claiming a bond which currently has a negative return</Warning>\r\n        )}\r\n        {view === \"CANCELLING\" && bond.accrued.gte(bond.breakEvenAccrual) && (\r\n          <Warning>Your are cancelling a bond which has accrued a positive return</Warning>\r\n        )}\r\n      </Box>\r\n\r\n      {Actions}\r\n    </ReactModal>\r\n  );\r\n};\r\n","import { createContext, useContext, useState } from \"react\";\r\n\r\ntype ReactComponent = Function & (React.FC<any> | React.ComponentClass);\r\n\r\nexport type WizardContextType = {\r\n  next: (() => void) | null;\r\n  back: (() => void) | null;\r\n  go: ((component: ReactComponent) => void) | null;\r\n};\r\n\r\nexport const WizardContext = createContext<WizardContextType | null>(null);\r\n\r\nexport const useWizard = (): WizardContextType => {\r\n  const context: WizardContextType | null = useContext(WizardContext);\r\n\r\n  if (context === null) {\r\n    return {\r\n      next: null,\r\n      back: null,\r\n      go: null\r\n    };\r\n  }\r\n\r\n  return context;\r\n};\r\n\r\nexport type WizardProviderProps = {\r\n  children: React.ReactComponentElement<any>[];\r\n  onCancel?: () => void;\r\n  onFinish?: () => void;\r\n};\r\n\r\nexport const WizardProvider: React.FC<WizardProviderProps> = ({ children, onCancel, onFinish }) => {\r\n  const [step, setStep] = useState<number>(0);\r\n  const [history, setHistory] = useState<number[]>([]);\r\n\r\n  const next = () => {\r\n    if (step === children.length - 1 && onFinish) return onFinish();\r\n    const nextStep = Math.min(children.length - 1, step + 1);\r\n    setStep(nextStep);\r\n    setHistory(history.concat(step));\r\n  };\r\n\r\n  const back = () => {\r\n    if (step === 0 && onCancel) return onCancel();\r\n    const prev = history.slice(history.length - 1)[0] ?? 0;\r\n    setStep(prev);\r\n    setHistory(history.slice(0, history.length - 1));\r\n  };\r\n\r\n  const go = (component: ReactComponent) => {\r\n    const idx = children.findIndex(child => child.type.name === component.name);\r\n    if (idx === -1) return;\r\n    setStep(idx);\r\n    setHistory(history.concat(step));\r\n  };\r\n\r\n  const provider: WizardContextType = {\r\n    next,\r\n    back,\r\n    go\r\n  };\r\n\r\n  return <WizardContext.Provider value={provider}>{children[step]}</WizardContext.Provider>;\r\n};\r\n","import React from \"react\";\r\nimport { WizardProvider } from \"./Context\";\r\nimport type { WizardProviderProps } from \"./Context\";\r\n\r\nexport const Wizard: React.FC<WizardProviderProps> = ({ children, onFinish, onCancel }) => {\r\n  return (\r\n    <WizardProvider onFinish={onFinish} onCancel={onCancel}>\r\n      {children}\r\n    </WizardProvider>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { ReactModal } from \"./ReactModal\";\r\nimport { Wizard } from \"./Wizard/Wizard\";\r\nimport type { WizardProviderProps } from \"./Wizard/Context\";\r\n\r\ntype ModalWizardProps = WizardProviderProps & {\r\n  onDismiss: () => void;\r\n  style?: React.CSSProperties;\r\n};\r\n\r\nexport const ModalWizard: React.FC<ModalWizardProps> = ({ children, onDismiss, style }) => {\r\n  const handleDismiss = () => onDismiss();\r\n\r\n  return (\r\n    <ReactModal onDismiss={handleDismiss} style={style}>\r\n      <Wizard onCancel={onDismiss}>{children}</Wizard>\r\n    </ReactModal>\r\n  );\r\n};\r\n","import {\r\n  BigNumber,\r\n  BigNumberish,\r\n  CallOverrides,\r\n  constants,\r\n  Contract,\r\n  ContractTransaction,\r\n  providers,\r\n  Signer\r\n} from \"ethers\";\r\nimport { splitSignature } from \"ethers/lib/utils\";\r\nimport type {\r\n  BLUSDToken,\r\n  BondNFT,\r\n  ChickenBondManager,\r\n  BLUSDLPZap\r\n} from \"@liquity/chicken-bonds/lusd/types\";\r\nimport {\r\n  CurveCryptoSwap2ETH,\r\n  CurveRegistrySwaps__factory\r\n} from \"@liquity/chicken-bonds/lusd/types/external\";\r\nimport type {\r\n  BondCreatedEventObject,\r\n  BondCreatedEvent,\r\n  BondCancelledEventObject,\r\n  BondCancelledEvent,\r\n  BondClaimedEventObject,\r\n  BondClaimedEvent\r\n} from \"@liquity/chicken-bonds/lusd/types/ChickenBondManager\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport type { LUSDToken } from \"@liquity/lib-ethers/dist/types\";\r\nimport type { ProtocolInfo, Bond, BondStatus, Stats, Maybe, BLusdLpRewards } from \"./transitions\";\r\nimport {\r\n  numberify,\r\n  decimalify,\r\n  getBondAgeInDays,\r\n  milliseconds,\r\n  toFloat,\r\n  getReturn,\r\n  getTokenUri,\r\n  getFutureBLusdAccrualFactor,\r\n  getRebondPeriodInDays,\r\n  getBreakEvenPeriodInDays,\r\n  getAverageBondAgeInSeconds,\r\n  getRemainingRebondOrBreakEvenDays,\r\n  getRebondOrBreakEvenTimeWithControllerAdjustment,\r\n  getFloorPrice\r\n} from \"../utils\";\r\nimport { UNKNOWN_DATE } from \"../../HorizontalTimeline\";\r\nimport { BLusdAmmTokenIndex } from \"./transitions\";\r\nimport {\r\n  TokenExchangeEvent,\r\n  TokenExchangeEventObject\r\n} from \"@liquity/chicken-bonds/lusd/types/external/CurveCryptoSwap2ETH\";\r\nimport type { EthersSigner } from \"@liquity/lib-ethers\";\r\nimport mainnet from \"@liquity/chicken-bonds/lusd/addresses/mainnet.json\";\r\nimport type {\r\n  CurveLiquidityGaugeV5,\r\n  DepositEvent,\r\n  DepositEventObject,\r\n  WithdrawEvent,\r\n  WithdrawEventObject\r\n} from \"@liquity/chicken-bonds/lusd/types/external/CurveLiquidityGaugeV5\";\r\n\r\nconst BOND_STATUS: BondStatus[] = [\"NON_EXISTENT\", \"PENDING\", \"CANCELLED\", \"CLAIMED\"];\r\n\r\nconst LUSD_3CRV_POOL_ADDRESS = \"0xEd279fDD11cA84bEef15AF5D39BB4d4bEE23F0cA\";\r\nconst LUSD_TOKEN_ADDRESS = \"0x5f98805A4E8be255a32880FDeC7F6728C6568bA0\";\r\nconst CURVE_REGISTRY_SWAPS_ADDRESS = \"0x81C46fECa27B31F3ADC2b91eE4be9717d1cd3DD7\";\r\nconst BLUSD_LUSD_3CRV_POOL_ADDRESS = \"0x74ED5d42203806c8CDCf2F04Ca5F60DC777b901c\";\r\nconst CRV_TOKEN_ADDRESS = \"0xD533a949740bb3306d119CC777fa900bA034cd52\";\r\n\r\nconst TOKEN_ADDRESS_NAME_MAP: Record<string, string> = {\r\n  [LUSD_TOKEN_ADDRESS]: \"LUSD\",\r\n  [CRV_TOKEN_ADDRESS]: \"CRV\"\r\n};\r\n\r\nconst LQTY_ISSUANCE_GAS_HEADROOM = BigNumber.from(50000);\r\n\r\n// [\r\n//   token_1,\r\n//   pool_1,\r\n//   token_2,\r\n//   pool_2,\r\n//   ...\r\n//   pool_{n-1},\r\n//   token_{n}\r\n// ]\r\nconst bLusdToLusdRoute: [string, string, string, string, string] = [\r\n  mainnet.BLUSD_TOKEN_ADDRESS ?? \"\",\r\n  mainnet.BLUSD_AMM_ADDRESS ?? \"\",\r\n  LUSD_3CRV_POOL_ADDRESS, // LP token of LUSD-3Crv-f has same address as pool\r\n  LUSD_3CRV_POOL_ADDRESS,\r\n  LUSD_TOKEN_ADDRESS\r\n];\r\n\r\nconst lusdToBLusdRoute = [...bLusdToLusdRoute].reverse() as typeof bLusdToLusdRoute;\r\n\r\ntype RouteAddresses = [string, string, string, string, string, string, string, string, string];\r\ntype RouteSwapParams = [BigNumberish, BigNumberish, BigNumberish];\r\ntype RouteSwaps = [RouteSwapParams, RouteSwapParams, RouteSwapParams, RouteSwapParams];\r\n\r\nconst getRoute = (inputToken: BLusdAmmTokenIndex): [RouteAddresses, RouteSwaps] => [\r\n  [\r\n    ...(inputToken === BLusdAmmTokenIndex.BLUSD ? bLusdToLusdRoute : lusdToBLusdRoute),\r\n    constants.AddressZero,\r\n    constants.AddressZero,\r\n    constants.AddressZero,\r\n    constants.AddressZero\r\n  ],\r\n  [\r\n    // Params:\r\n    // 1) input token index (unused by remove_liquidity_one_coin())\r\n    // 2) output token index (unused by add_liquidity())\r\n    // 3) function to call (see below)\r\n    //\r\n    // Functions:\r\n    // 3 = exchange() in crypto pool\r\n    // 6 = add_liquidity() single-sidedly to 2-pool\r\n    // 9 = remove_liquidity_one_coin()\r\n    //\r\n    // Indices:\r\n    // - bLUSD pool: { 0: bLUSD, 1: LUSD-3Crv-f }\r\n    // - LUSD-3Crv-f pool: { 0: LUSD, 1: 3Crv }\r\n\r\n    //                                          bLUSD        LUSD\r\n    inputToken === BLusdAmmTokenIndex.BLUSD ? [0, 1, 3] : [0, 0, 6], // step 1\r\n    inputToken === BLusdAmmTokenIndex.BLUSD ? [0, 0, 9] : [1, 0, 3], // step 2\r\n    [0, 0, 0], //                                LUSD       bLUSD\r\n    [0, 0, 0]\r\n  ]\r\n];\r\n\r\ntype CachedYearnApys = {\r\n  lusd3Crv: Decimal | undefined;\r\n  stabilityPool: Decimal | undefined;\r\n  bLusdLusd3Crv: Decimal | undefined;\r\n};\r\n\r\nlet cachedApys: CachedYearnApys = {\r\n  lusd3Crv: undefined,\r\n  stabilityPool: undefined,\r\n  bLusdLusd3Crv: undefined\r\n};\r\n\r\ntype YearnVault = Partial<{\r\n  token: {\r\n    address: string;\r\n  };\r\n  apy: {\r\n    net_apy: number;\r\n  };\r\n}>;\r\n\r\ntype CurvePoolData = Partial<{\r\n  data: {\r\n    poolData: Array<{ id: string; gaugeRewards: Array<{ apy: number }> }>;\r\n  };\r\n}>;\r\n\r\ntype CurvePoolDetails = Partial<{\r\n  data: {\r\n    poolDetails: Array<{ poolAddress: string; apy: number }>;\r\n  };\r\n}>;\r\n\r\nconst CURVE_POOL_ID = \"factory-crypto-134\";\r\n\r\nconst cacheCurveLpApy = async (): Promise<void> => {\r\n  try {\r\n    const curvePoolDataResponse = (await (\r\n      await window.fetch(\"https://api.curve.fi/api/getPools/ethereum/factory-crypto\")\r\n    ).json()) as CurvePoolData;\r\n\r\n    const curvePoolDetailsResponse = (await await (\r\n      await window.fetch(\"https://api.curve.fi/api/getFactoryAPYs?version=crypto\")\r\n    ).json()) as CurvePoolDetails;\r\n\r\n    const poolData = curvePoolDataResponse.data?.poolData.find(pool => pool.id === CURVE_POOL_ID);\r\n    const rewardsApr = poolData?.gaugeRewards.reduce((total, current) => total + current.apy, 0);\r\n    const baseApr = curvePoolDetailsResponse?.data?.poolDetails?.find(\r\n      pool => pool.poolAddress === BLUSD_LUSD_3CRV_POOL_ADDRESS\r\n    )?.apy;\r\n\r\n    if (rewardsApr === undefined && baseApr === undefined) return;\r\n\r\n    const apr = (rewardsApr ?? 0) + (baseApr ?? 0);\r\n\r\n    cachedApys.bLusdLusd3Crv = Decimal.from(apr);\r\n  } catch (error: unknown) {\r\n    console.log(\"cacheCurveLpApy failed\");\r\n    console.error(error);\r\n  }\r\n};\r\n\r\nconst cacheYearnVaultApys = async (): Promise<void> => {\r\n  try {\r\n    if (cachedApys.lusd3Crv !== undefined) return;\r\n\r\n    const yearnResponse = (await (\r\n      await window.fetch(\"https://api.yearn.finance/v1/chains/1/vaults/all\")\r\n    ).json()) as YearnVault[];\r\n\r\n    const lusd3CrvVault = yearnResponse.find(\r\n      vault => vault?.token?.address === LUSD_3CRV_POOL_ADDRESS\r\n    );\r\n\r\n    const stabilityPoolVault = yearnResponse.find(\r\n      vault => vault?.token?.address === LUSD_TOKEN_ADDRESS\r\n    );\r\n\r\n    if (\r\n      lusd3CrvVault?.apy?.net_apy === undefined ||\r\n      stabilityPoolVault?.apy?.net_apy === undefined\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    cachedApys.lusd3Crv = Decimal.from(lusd3CrvVault.apy.net_apy);\r\n    cachedApys.stabilityPool = Decimal.from(stabilityPoolVault.apy.net_apy);\r\n  } catch (error: unknown) {\r\n    console.log(\"cacheYearnVaultApys failed\");\r\n    console.error(error);\r\n  }\r\n};\r\n\r\nconst getAccountBonds = async (\r\n  account: string,\r\n  bondNft: BondNFT,\r\n  chickenBondManager: ChickenBondManager,\r\n  protocolInfo: ProtocolInfo\r\n): Promise<Bond[]> => {\r\n  try {\r\n    const {\r\n      marketPrice,\r\n      alphaAccrualFactor,\r\n      marketPricePremium,\r\n      claimBondFee,\r\n      floorPrice,\r\n      controllerTargetAge,\r\n      averageBondAge\r\n    } = protocolInfo;\r\n\r\n    const totalBonds = (await bondNft.balanceOf(account)).toNumber();\r\n\r\n    const bondIdRequests = Array.from(Array(totalBonds)).map((_, index) =>\r\n      bondNft.tokenOfOwnerByIndex(account, index)\r\n    );\r\n\r\n    const bondIds = await Promise.all(bondIdRequests);\r\n\r\n    const bondRequests = {\r\n      deposits: bondIds.map(bondId => bondNft.getBondAmount(bondId)),\r\n      accrueds: bondIds.map(bondId => chickenBondManager.calcAccruedBLUSD(bondId)),\r\n      startTimes: bondIds.map(bondId => bondNft.getBondStartTime(bondId)),\r\n      endTimes: bondIds.map(bondId => bondNft.getBondEndTime(bondId)),\r\n      statuses: bondIds.map(bondId => bondNft.getBondStatus(bondId)),\r\n      tokenUris: bondIds.map(bondId => bondNft.tokenURI(bondId)),\r\n      claimedAmounts: bondIds.map(bondId => bondNft.getBondClaimedBLUSD(bondId))\r\n    };\r\n\r\n    const bondDeposits = await Promise.all(bondRequests.deposits);\r\n    const bondAccrueds = await Promise.all(bondRequests.accrueds);\r\n    const bondStartTimes = await Promise.all(bondRequests.startTimes);\r\n    const bondEndTimes = await Promise.all(bondRequests.endTimes);\r\n    const bondStatuses = await Promise.all(bondRequests.statuses);\r\n    const bondTokenUris = await Promise.all(bondRequests.tokenUris);\r\n    const bondClaimedAmounts = await Promise.all(bondRequests.claimedAmounts);\r\n\r\n    const bonds = bondIds\r\n      .reduce<Bond[]>((accumulator, _, idx) => {\r\n        const id = numberify(bondIds[idx]).toString();\r\n        const deposit = decimalify(bondDeposits[idx]);\r\n        const accrued = decimalify(bondAccrueds[idx]);\r\n        const startTime = milliseconds(numberify(bondStartTimes[idx]));\r\n        const endTime = milliseconds(numberify(bondEndTimes[idx]));\r\n        const status = BOND_STATUS[bondStatuses[idx]];\r\n        const tokenUri = getTokenUri(bondTokenUris[idx]);\r\n        const bondAgeInDays = getBondAgeInDays(startTime);\r\n        const rebondPeriodInDays = getRebondPeriodInDays(\r\n          alphaAccrualFactor,\r\n          marketPricePremium,\r\n          claimBondFee\r\n        );\r\n        const bondAgeInSeconds = Decimal.from(Date.now() - startTime).div(1000);\r\n        const remainingRebondDays = getRemainingRebondOrBreakEvenDays(\r\n          bondAgeInSeconds,\r\n          controllerTargetAge,\r\n          averageBondAge,\r\n          rebondPeriodInDays\r\n        );\r\n\r\n        const breakEvenPeriodInDays = getBreakEvenPeriodInDays(\r\n          alphaAccrualFactor,\r\n          marketPricePremium,\r\n          claimBondFee\r\n        );\r\n        const remainingBreakEvenDays = getRemainingRebondOrBreakEvenDays(\r\n          bondAgeInSeconds,\r\n          controllerTargetAge,\r\n          averageBondAge,\r\n          breakEvenPeriodInDays\r\n        );\r\n\r\n        const depositMinusClaimBondFee = Decimal.ONE.sub(claimBondFee).mul(deposit);\r\n        const rebondAccrual =\r\n          rebondPeriodInDays === Decimal.INFINITY\r\n            ? Decimal.INFINITY\r\n            : getFutureBLusdAccrualFactor(floorPrice, rebondPeriodInDays, alphaAccrualFactor).mul(\r\n                depositMinusClaimBondFee\r\n              );\r\n\r\n        const breakEvenAccrual =\r\n          breakEvenPeriodInDays === Decimal.INFINITY\r\n            ? Decimal.INFINITY\r\n            : getFutureBLusdAccrualFactor(floorPrice, breakEvenPeriodInDays, alphaAccrualFactor).mul(\r\n                depositMinusClaimBondFee\r\n              );\r\n\r\n        const breakEvenTime =\r\n          breakEvenPeriodInDays === Decimal.INFINITY\r\n            ? UNKNOWN_DATE\r\n            : getRebondOrBreakEvenTimeWithControllerAdjustment(\r\n                bondAgeInSeconds,\r\n                controllerTargetAge,\r\n                averageBondAge,\r\n                breakEvenPeriodInDays\r\n              );\r\n\r\n        const rebondTime =\r\n          rebondPeriodInDays === Decimal.INFINITY\r\n            ? UNKNOWN_DATE\r\n            : getRebondOrBreakEvenTimeWithControllerAdjustment(\r\n                bondAgeInSeconds,\r\n                controllerTargetAge,\r\n                averageBondAge,\r\n                rebondPeriodInDays\r\n              );\r\n\r\n        const marketValue = decimalify(bondAccrueds[idx]).mul(marketPrice);\r\n\r\n        // Accrued bLUSD is 0 for cancelled/claimed bonds\r\n        const claimNowReturn = accrued.isZero ? 0 : getReturn(accrued, deposit, marketPrice);\r\n        const rebondReturn = accrued.isZero ? 0 : getReturn(rebondAccrual, deposit, marketPrice);\r\n        const rebondRoi = rebondReturn / toFloat(deposit);\r\n        const rebondApr = rebondRoi * (365 / (bondAgeInDays + remainingRebondDays));\r\n        const claimedAmount = Decimal.from(numberify(bondClaimedAmounts[idx]));\r\n\r\n        return [\r\n          ...accumulator,\r\n          {\r\n            id,\r\n            deposit,\r\n            accrued,\r\n            startTime,\r\n            endTime,\r\n            status,\r\n            tokenUri,\r\n            breakEvenAccrual,\r\n            rebondAccrual,\r\n            breakEvenTime,\r\n            rebondTime,\r\n            marketValue,\r\n            rebondReturn,\r\n            claimNowReturn,\r\n            rebondRoi,\r\n            rebondApr,\r\n            claimedAmount,\r\n            bondAgeInDays,\r\n            remainingRebondDays,\r\n            remainingBreakEvenDays\r\n          }\r\n        ];\r\n      }, [])\r\n      .sort((a, b) => (a.startTime > b.startTime ? -1 : a.startTime < b.startTime ? 1 : 0));\r\n\r\n    return bonds;\r\n  } catch (error: unknown) {\r\n    console.error(error);\r\n  }\r\n  return [];\r\n};\r\n\r\nexport const _getProtocolInfo = (\r\n  marketPrice: Decimal,\r\n  floorPrice: Decimal,\r\n  claimBondFee: Decimal,\r\n  alphaAccrualFactor: Decimal\r\n) => {\r\n  const marketPricePremium = marketPrice.div(floorPrice);\r\n  const hasMarketPremium = marketPricePremium.mul(Decimal.ONE.sub(claimBondFee)).gt(Decimal.ONE);\r\n\r\n  const breakEvenPeriodInDays = getBreakEvenPeriodInDays(\r\n    alphaAccrualFactor,\r\n    marketPricePremium,\r\n    claimBondFee\r\n  );\r\n  const rebondPeriodInDays = getRebondPeriodInDays(\r\n    alphaAccrualFactor,\r\n    marketPricePremium,\r\n    claimBondFee\r\n  );\r\n  const breakEvenAccrualFactor = getFutureBLusdAccrualFactor(\r\n    floorPrice,\r\n    breakEvenPeriodInDays,\r\n    alphaAccrualFactor\r\n  );\r\n  const rebondAccrualFactor = getFutureBLusdAccrualFactor(\r\n    floorPrice,\r\n    rebondPeriodInDays,\r\n    alphaAccrualFactor\r\n  );\r\n\r\n  return {\r\n    marketPricePremium,\r\n    hasMarketPremium,\r\n    breakEvenAccrualFactor,\r\n    rebondAccrualFactor,\r\n    breakEvenPeriodInDays,\r\n    rebondPeriodInDays\r\n  };\r\n};\r\n\r\nconst marginalInputAmount = Decimal.ONE.div(1000);\r\n\r\nconst getBlusdAmmPrice = async (bLusdAmm: CurveCryptoSwap2ETH): Promise<Decimal> => {\r\n  try {\r\n    const marginalOutputAmount = await getExpectedSwapOutput(\r\n      BLusdAmmTokenIndex.BLUSD,\r\n      marginalInputAmount,\r\n      bLusdAmm\r\n    );\r\n\r\n    return marginalOutputAmount.div(marginalInputAmount);\r\n  } catch (error: unknown) {\r\n    console.error(\"bLUSD AMM get_dy() price failed, probably has no liquidity?\", error);\r\n  }\r\n\r\n  return Decimal.ONE.div(decimalify(await bLusdAmm.price_oracle()));\r\n};\r\n\r\nconst getBlusdAmmPriceMainnet = async (bLusdAmm: CurveCryptoSwap2ETH): Promise<Decimal> => {\r\n  try {\r\n    const marginalOutputAmount = await getExpectedSwapOutputMainnet(\r\n      BLusdAmmTokenIndex.BLUSD,\r\n      marginalInputAmount,\r\n      bLusdAmm\r\n    );\r\n\r\n    return marginalOutputAmount.div(marginalInputAmount);\r\n  } catch (error: unknown) {\r\n    console.error(\"getExpectedSwapOutputMainnet() failed, probably no liquidity?\", error);\r\n  }\r\n\r\n  const lusd3CrvPool = new Contract(\r\n    LUSD_3CRV_POOL_ADDRESS,\r\n    [\r\n      \"function calc_withdraw_one_coin(uint256 burn_amount, int128 i) external view returns (uint256)\"\r\n    ],\r\n    bLusdAmm.provider\r\n  );\r\n\r\n  const [oraclePrice, marginalOutputAmount] = await Promise.all([\r\n    bLusdAmm.price_oracle().then(decimalify),\r\n    lusd3CrvPool.calc_withdraw_one_coin(marginalInputAmount.hex, 0 /* LUSD */).then(decimalify)\r\n  ]);\r\n\r\n  return marginalOutputAmount.div(marginalInputAmount).div(oraclePrice);\r\n};\r\n\r\nconst getProtocolInfo = async (\r\n  bLusdToken: BLUSDToken,\r\n  bLusdAmm: CurveCryptoSwap2ETH,\r\n  chickenBondManager: ChickenBondManager,\r\n  isMainnet: boolean\r\n): Promise<ProtocolInfo> => {\r\n  // TS breaks when including this call, or any more than 10 elements, in the Promise.all below.\r\n  const bammLusdDebtRequest = chickenBondManager.getBAMMLUSDDebt().then(decimalify);\r\n\r\n  const [\r\n    bLusdSupply,\r\n    marketPrice,\r\n    _treasury,\r\n    protocolOwnedLusdInStabilityPool,\r\n    protocolLusdInCurve,\r\n    _floorPrice,\r\n    claimBondFee,\r\n    alphaAccrualFactor,\r\n    controllerTargetAge,\r\n    totalWeightedStartTimes\r\n  ] = await Promise.all([\r\n    bLusdToken.totalSupply().then(decimalify),\r\n    isMainnet ? getBlusdAmmPriceMainnet(bLusdAmm) : getBlusdAmmPrice(bLusdAmm),\r\n    chickenBondManager.getTreasury().then(bucket => bucket.map(decimalify)),\r\n    chickenBondManager.getOwnedLUSDInSP().then(decimalify),\r\n    chickenBondManager.getTotalLUSDInCurve().then(decimalify),\r\n    chickenBondManager.calcSystemBackingRatio().then(decimalify),\r\n    chickenBondManager.CHICKEN_IN_AMM_FEE().then(decimalify),\r\n    chickenBondManager.calcUpdatedAccrualParameter().then(p => decimalify(p).div(24 * 60 * 60)),\r\n    chickenBondManager.targetAverageAgeSeconds().then(t => Decimal.from(t.toString())),\r\n    chickenBondManager.totalWeightedStartTimes().then(decimalify)\r\n  ]);\r\n\r\n  const bammLusdDebt = await bammLusdDebtRequest;\r\n\r\n  const treasury = {\r\n    pending: _treasury[0],\r\n    reserve: _treasury[1],\r\n    permanent: _treasury[2],\r\n    total: _treasury[0].add(_treasury[1]).add(_treasury[2])\r\n  };\r\n\r\n  const cachedApysRequests =\r\n    cachedApys.lusd3Crv === undefined ||\r\n    cachedApys.stabilityPool === undefined ||\r\n    cachedApys.bLusdLusd3Crv === undefined\r\n      ? [cacheYearnVaultApys(), cacheCurveLpApy()]\r\n      : null;\r\n\r\n  const protocolLusdInStabilityPool = treasury.pending.add(protocolOwnedLusdInStabilityPool);\r\n\r\n  const floorPrice = bLusdSupply.isZero ? Decimal.ONE : _floorPrice;\r\n\r\n  const floorPriceWithoutPendingHarvests = bLusdSupply.isZero\r\n    ? Decimal.ONE\r\n    : getFloorPrice(\r\n        bammLusdDebt,\r\n        protocolLusdInCurve,\r\n        treasury.pending,\r\n        treasury.permanent,\r\n        bLusdSupply\r\n      );\r\n\r\n  const averageBondAge = getAverageBondAgeInSeconds(totalWeightedStartTimes, treasury.pending);\r\n\r\n  let yieldAmplification: Maybe<Decimal> = undefined;\r\n  let bLusdApr: Maybe<Decimal> = undefined;\r\n  let bLusdLpApr: Maybe<Decimal> = cachedApys.bLusdLusd3Crv;\r\n\r\n  const fairPrice = {\r\n    lower: treasury.total.sub(treasury.pending).div(bLusdSupply),\r\n    upper: treasury.total.div(bLusdSupply)\r\n  };\r\n\r\n  const {\r\n    marketPricePremium,\r\n    hasMarketPremium,\r\n    breakEvenAccrualFactor,\r\n    rebondAccrualFactor,\r\n    breakEvenPeriodInDays,\r\n    rebondPeriodInDays\r\n  } = _getProtocolInfo(marketPrice, floorPrice, claimBondFee, alphaAccrualFactor);\r\n\r\n  const simulatedMarketPrice = marketPrice;\r\n\r\n  const windDownPrice = treasury.reserve.add(treasury.permanent).div(bLusdSupply);\r\n\r\n  // We need to know APYs to calculate the stats below\r\n  if (cachedApysRequests) await Promise.all(cachedApysRequests);\r\n\r\n  if (\r\n    cachedApys.lusd3Crv !== undefined &&\r\n    cachedApys.stabilityPool !== undefined &&\r\n    treasury.reserve.gt(0)\r\n  ) {\r\n    const protocolStabilityPoolYield = cachedApys.stabilityPool.mul(protocolLusdInStabilityPool);\r\n    const protocolCurveYield = cachedApys.lusd3Crv.mul(protocolLusdInCurve);\r\n    bLusdApr = protocolStabilityPoolYield.add(protocolCurveYield).div(treasury.reserve);\r\n    yieldAmplification = bLusdApr.div(cachedApys.stabilityPool);\r\n\r\n    fairPrice.lower = protocolLusdInStabilityPool\r\n      .sub(treasury.pending)\r\n      .add(protocolLusdInCurve.mul(cachedApys.lusd3Crv.div(cachedApys.stabilityPool)))\r\n      .div(bLusdSupply);\r\n\r\n    fairPrice.upper = protocolLusdInStabilityPool\r\n      .add(protocolLusdInCurve.mul(cachedApys.lusd3Crv.div(cachedApys.stabilityPool)))\r\n      .div(bLusdSupply);\r\n  }\r\n\r\n  return {\r\n    bLusdSupply,\r\n    marketPrice,\r\n    treasury,\r\n    fairPrice,\r\n    floorPrice,\r\n    claimBondFee,\r\n    alphaAccrualFactor,\r\n    marketPricePremium,\r\n    hasMarketPremium,\r\n    breakEvenAccrualFactor,\r\n    rebondAccrualFactor,\r\n    breakEvenPeriodInDays,\r\n    rebondPeriodInDays,\r\n    simulatedMarketPrice,\r\n    yieldAmplification,\r\n    bLusdApr,\r\n    bLusdLpApr,\r\n    controllerTargetAge,\r\n    averageBondAge,\r\n    floorPriceWithoutPendingHarvests,\r\n    windDownPrice\r\n  };\r\n};\r\n\r\nconst getStats = async (chickenBondManager: ChickenBondManager): Promise<Stats> => {\r\n  const [pendingBonds, cancelledBonds, claimedBonds] = await Promise.all([\r\n    chickenBondManager.getOpenBondCount(),\r\n    chickenBondManager.countChickenOut(),\r\n    chickenBondManager.countChickenIn()\r\n  ]);\r\n\r\n  const totalBonds = pendingBonds.add(cancelledBonds).add(claimedBonds);\r\n\r\n  return {\r\n    pendingBonds: Decimal.from(pendingBonds.toString()),\r\n    cancelledBonds: Decimal.from(cancelledBonds.toString()),\r\n    claimedBonds: Decimal.from(claimedBonds.toString()),\r\n    totalBonds: Decimal.from(totalBonds.toString())\r\n  };\r\n};\r\n\r\n// Very minimal type that only contains what we need\r\nexport interface ERC20 {\r\n  approve(\r\n    spender: string,\r\n    amount: BigNumber,\r\n    _overrides?: CallOverrides\r\n  ): Promise<ContractTransaction>;\r\n  allowance(account: string, spender: string, _overrides?: CallOverrides): Promise<BigNumber>;\r\n  balanceOf(account: string, _overrides?: CallOverrides): Promise<BigNumber>;\r\n  totalSupply(_overrides?: CallOverrides): Promise<BigNumber>;\r\n}\r\n\r\nconst erc20From = (tokenAddress: string, signerOrProvider: Signer | providers.Provider) =>\r\n  (new Contract(\r\n    tokenAddress,\r\n    [\r\n      \"function approve(address spender, uint256 amount) returns (bool)\",\r\n      \"function allowance(address owner, address spender) view returns (uint256)\",\r\n      \"function balanceOf(address) view returns (uint256)\",\r\n      \"function totalSupply() view returns (uint256)\"\r\n    ],\r\n    signerOrProvider\r\n  ) as unknown) as ERC20;\r\n\r\nconst getLpToken = async (pool: CurveCryptoSwap2ETH) =>\r\n  erc20From(await pool.token(), pool.signer ?? pool.provider);\r\n\r\nconst getTokenBalance = async (account: string, token: ERC20): Promise<Decimal> => {\r\n  return decimalify(await token.balanceOf(account));\r\n};\r\n\r\nconst getTokenTotalSupply = async (token: ERC20): Promise<Decimal> => {\r\n  return decimalify(await token.totalSupply());\r\n};\r\n\r\nconst createBond = async (\r\n  lusdAmount: Decimal,\r\n  owner: string,\r\n  lusdAddress: string,\r\n  lusdToken: LUSDToken | undefined,\r\n  chickenBondManager: ChickenBondManager | undefined,\r\n  signer: EthersSigner\r\n): Promise<BondCreatedEventObject> => {\r\n  if (chickenBondManager === undefined || lusdToken === undefined) {\r\n    throw new Error(\"createBond() failed: a dependency is null\");\r\n  }\r\n\r\n  const TEN_MINUTES_IN_SECONDS = 60 * 10;\r\n  const spender = chickenBondManager.address;\r\n  const deadline = Math.round(Date.now() / 1000) + TEN_MINUTES_IN_SECONDS;\r\n  const nonce = (await lusdToken.nonces(owner)).toNumber();\r\n  const domain = {\r\n    name: await lusdToken.name(),\r\n    version: \"1\",\r\n    chainId: await signer.getChainId(),\r\n    verifyingContract: lusdAddress\r\n  };\r\n  const types = {\r\n    Permit: [\r\n      { name: \"owner\", type: \"address\" },\r\n      { name: \"spender\", type: \"address\" },\r\n      { name: \"value\", type: \"uint256\" },\r\n      { name: \"nonce\", type: \"uint256\" },\r\n      { name: \"deadline\", type: \"uint256\" }\r\n    ]\r\n  };\r\n  const message = {\r\n    owner,\r\n    spender,\r\n    value: lusdAmount.hex,\r\n    nonce,\r\n    deadline\r\n  };\r\n\r\n  // @ts-ignore - Ethers private func as API not stable yet\r\n  const signature = await signer._signTypedData(domain, types, message);\r\n\r\n  const { v, r, s } = splitSignature(signature);\r\n\r\n  const gasEstimate = await chickenBondManager.estimateGas.createBondWithPermit(\r\n    owner,\r\n    lusdAmount.hex,\r\n    deadline,\r\n    v,\r\n    r,\r\n    s\r\n  );\r\n\r\n  const receipt = await (\r\n    await chickenBondManager.createBondWithPermit(owner, lusdAmount.hex, deadline, v, r, s, {\r\n      gasLimit: gasEstimate.add(LQTY_ISSUANCE_GAS_HEADROOM)\r\n    })\r\n  ).wait();\r\n\r\n  console.log(\r\n    \"CREATE BOND\",\r\n    receipt?.events,\r\n    receipt?.events?.map(c => c.event),\r\n    receipt?.events?.find(e => e.event === \"BondCreated\")\r\n  );\r\n  const createdEvent = receipt?.events?.find(\r\n    e => e.event === \"BondCreated\"\r\n  ) as Maybe<BondCreatedEvent>;\r\n\r\n  if (createdEvent === undefined) {\r\n    throw new Error(\"createBond() failed: couldn't find BondCreated event\");\r\n  }\r\n\r\n  console.log(\"createBond() finished:\", createdEvent.args);\r\n  return createdEvent.args;\r\n};\r\n\r\nconst cancelBond = async (\r\n  bondId: string,\r\n  minimumLusd: Decimal,\r\n  chickenBondManager: ChickenBondManager | undefined\r\n): Promise<BondCancelledEventObject> => {\r\n  if (chickenBondManager === undefined) throw new Error(\"cancelBond() failed: a dependency is null\");\r\n  console.log(\"cancelBond() started:\", bondId, minimumLusd.toString());\r\n\r\n  const gasEstimate = await chickenBondManager.estimateGas.chickenOut(bondId, minimumLusd.hex);\r\n\r\n  const receipt = await (\r\n    await chickenBondManager.chickenOut(bondId, minimumLusd.hex, {\r\n      gasLimit: gasEstimate.add(LQTY_ISSUANCE_GAS_HEADROOM)\r\n    })\r\n  ).wait();\r\n\r\n  const cancelledEvent = receipt?.events?.find(\r\n    e => e.event === \"BondCancelled\"\r\n  ) as Maybe<BondCancelledEvent>;\r\n\r\n  if (cancelledEvent === undefined) {\r\n    throw new Error(\"cancelBond() failed: couldn't find BondCancelled event\");\r\n  }\r\n  console.log(\"cancelBond() finished:\", cancelledEvent.args);\r\n  return cancelledEvent.args;\r\n};\r\n\r\nconst claimBond = async (\r\n  bondId: string,\r\n  chickenBondManager: ChickenBondManager | undefined\r\n): Promise<BondClaimedEventObject> => {\r\n  try {\r\n    if (chickenBondManager === undefined)\r\n      throw new Error(\"claimBond() failed: a dependency is null\");\r\n    console.log(\"claimBond() started\", bondId);\r\n\r\n    const gasEstimate = await chickenBondManager.estimateGas.chickenIn(bondId);\r\n\r\n    const receipt = await (\r\n      await chickenBondManager.chickenIn(bondId, {\r\n        gasLimit: gasEstimate.add(LQTY_ISSUANCE_GAS_HEADROOM)\r\n      })\r\n    ).wait();\r\n\r\n    const bondClaimedEvent = receipt.events?.find(\r\n      e => e.event === \"BondClaimed\"\r\n    ) as Maybe<BondClaimedEvent>;\r\n\r\n    if (bondClaimedEvent === undefined) {\r\n      throw new Error(\"claimBond() failed: couldn't find BondClaimed event\");\r\n    }\r\n\r\n    console.log(\"claimBond() finished\", bondClaimedEvent.args);\r\n    return bondClaimedEvent.args;\r\n  } catch (error: unknown) {\r\n    console.error(\"claimBond() failed:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst isTokenApprovedWithBLusdAmm = async (\r\n  account: string,\r\n  token: LUSDToken | BLUSDToken,\r\n  bLusdAmmAddress: string | null\r\n): Promise<boolean> => {\r\n  if (bLusdAmmAddress === null) {\r\n    throw new Error(\"isTokenApprovedWithBLusdAmm() failed: a dependency is null\");\r\n  }\r\n\r\n  const allowance = await token.allowance(account, bLusdAmmAddress);\r\n\r\n  // Unlike bLUSD, LUSD doesn't explicitly handle infinite approvals, therefore the allowance will\r\n  // start to decrease from 2**64.\r\n  // However, it is practically impossible that it would decrease below 2**63.\r\n  return allowance.gt(constants.MaxInt256);\r\n};\r\n\r\nconst isTokenApprovedWithBLusdAmmMainnet = async (\r\n  account: string,\r\n  token: LUSDToken | BLUSDToken\r\n): Promise<boolean> => {\r\n  const allowance = await token.allowance(account, CURVE_REGISTRY_SWAPS_ADDRESS);\r\n\r\n  // Unlike bLUSD, LUSD doesn't explicitly handle infinite approvals, therefore the allowance will\r\n  // start to decrease from 2**64.\r\n  // However, it is practically impossible that it would decrease below 2**63.\r\n  return allowance.gt(constants.MaxInt256);\r\n};\r\n\r\nconst isTokenApprovedWithAmmZapper = async (\r\n  account: string,\r\n  token: LUSDToken | BLUSDToken | ERC20,\r\n  ammZapperAddress: string | null\r\n): Promise<boolean> => {\r\n  if (ammZapperAddress === null) {\r\n    throw new Error(\"isTokenApprovedWithAmmZapper() failed: a dependency is null\");\r\n  }\r\n  const allowance = await token.allowance(account, ammZapperAddress);\r\n  return allowance.gt(constants.MaxInt256);\r\n};\r\n\r\nconst approveTokenWithBLusdAmm = async (\r\n  token: LUSDToken | BLUSDToken | undefined,\r\n  bLusdAmmAddress: string | null\r\n) => {\r\n  if (token === undefined || bLusdAmmAddress === null) {\r\n    throw new Error(\"approveTokenWithBLusdAmm() failed: a dependency is null\");\r\n  }\r\n\r\n  await (await token.approve(bLusdAmmAddress, constants.MaxUint256)).wait();\r\n  return;\r\n};\r\n\r\nconst approveToken = async (\r\n  token: LUSDToken | BLUSDToken | ERC20 | undefined,\r\n  spenderAddress: string | null\r\n) => {\r\n  if (token === undefined || spenderAddress === null) {\r\n    throw new Error(\"approveToken() failed: a dependency is null\");\r\n  }\r\n\r\n  await (await token.approve(spenderAddress, constants.MaxUint256)).wait();\r\n  return;\r\n};\r\n\r\nconst approveTokenWithBLusdAmmMainnet = async (token: LUSDToken | BLUSDToken | undefined) => {\r\n  if (token === undefined) {\r\n    throw new Error(\"approveTokenWithBLusdAmmMainnet() failed: a dependency is null\");\r\n  }\r\n\r\n  await (await token.approve(CURVE_REGISTRY_SWAPS_ADDRESS, constants.MaxUint256)).wait();\r\n  return;\r\n};\r\n\r\nconst getOtherToken = (thisToken: BLusdAmmTokenIndex) =>\r\n  thisToken === BLusdAmmTokenIndex.BLUSD ? BLusdAmmTokenIndex.LUSD : BLusdAmmTokenIndex.BLUSD;\r\n\r\nconst getExpectedSwapOutput = async (\r\n  inputToken: BLusdAmmTokenIndex,\r\n  inputAmount: Decimal,\r\n  bLusdAmm: CurveCryptoSwap2ETH\r\n): Promise<Decimal> =>\r\n  decimalify(await bLusdAmm.get_dy(inputToken, getOtherToken(inputToken), inputAmount.hex));\r\n\r\nconst getExpectedSwapOutputMainnet = async (\r\n  inputToken: BLusdAmmTokenIndex,\r\n  inputAmount: Decimal,\r\n  bLusdAmm: CurveCryptoSwap2ETH\r\n): Promise<Decimal> => {\r\n  const bLusdAmmBalance = await bLusdAmm.balances(0);\r\n  // Initial Curve bLUSD price before liquidity = 1.29, reciprocal expected\r\n  const reciprocal = Decimal.from(1).div(1.29);\r\n  if (bLusdAmmBalance.eq(0)) return inputAmount.div(reciprocal);\r\n\r\n  const swaps = CurveRegistrySwaps__factory.connect(CURVE_REGISTRY_SWAPS_ADDRESS, bLusdAmm.signer);\r\n\r\n  return decimalify(\r\n    await swaps[\"get_exchange_multiple_amount(address[9],uint256[3][4],uint256)\"](\r\n      ...getRoute(inputToken),\r\n      inputAmount.hex\r\n    )\r\n  );\r\n};\r\n\r\nconst swapTokens = async (\r\n  inputToken: BLusdAmmTokenIndex,\r\n  inputAmount: Decimal,\r\n  minOutputAmount: Decimal,\r\n  bLusdAmm: CurveCryptoSwap2ETH | undefined\r\n): Promise<TokenExchangeEventObject> => {\r\n  if (bLusdAmm === undefined) throw new Error(\"swapTokens() failed: a dependency is null\");\r\n\r\n  const gasEstimate = await bLusdAmm.estimateGas[\"exchange(uint256,uint256,uint256,uint256)\"](\r\n    inputToken,\r\n    getOtherToken(inputToken),\r\n    inputAmount.hex,\r\n    minOutputAmount.hex\r\n  );\r\n\r\n  const receipt = await (\r\n    await bLusdAmm[\"exchange(uint256,uint256,uint256,uint256)\"](\r\n      inputToken,\r\n      getOtherToken(inputToken),\r\n      inputAmount.hex,\r\n      minOutputAmount.hex,\r\n      { gasLimit: gasEstimate.mul(6).div(5) } // Add 20% overhead (we've seen it fail otherwise)\r\n    )\r\n  ).wait();\r\n\r\n  const exchangeEvent = receipt?.events?.find(\r\n    e => e.event === \"TokenExchange\"\r\n  ) as Maybe<TokenExchangeEvent>;\r\n\r\n  if (exchangeEvent === undefined) {\r\n    throw new Error(\"swapTokens() failed: couldn't find TokenExchange event\");\r\n  }\r\n\r\n  console.log(\"swapTokens() finished:\", exchangeEvent.args);\r\n  return exchangeEvent.args;\r\n};\r\n\r\nconst swapTokensMainnet = async (\r\n  inputToken: BLusdAmmTokenIndex,\r\n  inputAmount: Decimal,\r\n  minOutputAmount: Decimal,\r\n  bLusdAmm: CurveCryptoSwap2ETH | undefined\r\n): Promise<void> => {\r\n  if (bLusdAmm === undefined) throw new Error(\"swapTokensMainnet() failed: a dependency is null\");\r\n\r\n  const swaps = CurveRegistrySwaps__factory.connect(CURVE_REGISTRY_SWAPS_ADDRESS, bLusdAmm.signer);\r\n  const route = getRoute(inputToken);\r\n\r\n  const gasEstimate = await swaps.estimateGas[\r\n    \"exchange_multiple(address[9],uint256[3][4],uint256,uint256)\"\r\n  ](...route, inputAmount.hex, minOutputAmount.hex);\r\n\r\n  const receipt = await (\r\n    await swaps[\"exchange_multiple(address[9],uint256[3][4],uint256,uint256)\"](\r\n      ...route,\r\n      inputAmount.hex,\r\n      minOutputAmount.hex,\r\n      { gasLimit: gasEstimate.mul(6).div(5) } // Add 20% overhead (we've seen it fail otherwise)\r\n    )\r\n  ).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"swapTokensMainnet() failed\");\r\n  }\r\n\r\n  console.log(\"swapTokensMainnet() finished\");\r\n};\r\n\r\nconst getExpectedLpTokensAmountViaZapper = async (\r\n  bLusdAmount: Decimal,\r\n  lusdAmount: Decimal,\r\n  bLusdZapper: BLUSDLPZap\r\n): Promise<Decimal> => {\r\n  // allow 0.1% rounding error\r\n  return decimalify(await bLusdZapper.getMinLPTokens(bLusdAmount.hex, lusdAmount.hex)).mul(0.99);\r\n};\r\n\r\nconst getExpectedLpTokens = async (\r\n  bLusdAmount: Decimal,\r\n  lusdAmount: Decimal,\r\n  bLusdZapper: BLUSDLPZap\r\n): Promise<Decimal> => {\r\n  // Curve's calc_token_amount has rounding errors and they enforce a minimum 0.1% slippage\r\n  let expectedLpTokenAmount = Decimal.ZERO;\r\n  try {\r\n    // If the user is depositing bLUSD single sided, they won't have approved any.. TODO\r\n    expectedLpTokenAmount = await getExpectedLpTokensAmountViaZapper(\r\n      bLusdAmount,\r\n      lusdAmount,\r\n      bLusdZapper\r\n    );\r\n  } catch {\r\n    // Curve throws if there's no liquidity\r\n    return expectedLpTokenAmount;\r\n  }\r\n  return expectedLpTokenAmount;\r\n};\r\n\r\nconst addLiquidity = async (\r\n  bLusdAmount: Decimal,\r\n  lusdAmount: Decimal,\r\n  minLpTokens: Decimal,\r\n  shouldStakeInGauge: boolean,\r\n  bLusdZapper: BLUSDLPZap | undefined\r\n): Promise<void> => {\r\n  if (bLusdZapper === undefined) throw new Error(\"addLiquidity() failed: a dependency is null\");\r\n\r\n  const zapperFunction = shouldStakeInGauge ? \"addLiquidityAndStake\" : \"addLiquidity\";\r\n\r\n  const gasEstimate = await bLusdZapper.estimateGas[zapperFunction](\r\n    bLusdAmount.hex,\r\n    lusdAmount.hex,\r\n    minLpTokens.hex\r\n  );\r\n\r\n  const receipt = await (\r\n    await bLusdZapper[zapperFunction](\r\n      bLusdAmount.hex,\r\n      lusdAmount.hex,\r\n      minLpTokens.hex,\r\n      { gasLimit: gasEstimate.mul(6).div(5) } // Add 20% overhead (we've seen it fail otherwise)\r\n    )\r\n  ).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"addLiquidity() failed\");\r\n  }\r\n\r\n  console.log(\"addLiquidity() finished\");\r\n};\r\n\r\nconst getCoinBalances = (pool: CurveCryptoSwap2ETH) =>\r\n  Promise.all([pool.balances(0).then(decimalify), pool.balances(1).then(decimalify)]);\r\n\r\nconst getExpectedWithdrawal = async (\r\n  burnLp: Decimal,\r\n  output: BLusdAmmTokenIndex | \"both\",\r\n  bLusdZapper: BLUSDLPZap,\r\n  bLusdAmm: CurveCryptoSwap2ETH\r\n): Promise<Map<BLusdAmmTokenIndex, Decimal>> => {\r\n  if (output === \"both\") {\r\n    const [bLusdAmount, lusdAmount] = await bLusdZapper.getMinWithdrawBalanced(burnLp.hex);\r\n\r\n    return new Map([\r\n      [BLusdAmmTokenIndex.BLUSD, decimalify(bLusdAmount)],\r\n      [BLusdAmmTokenIndex.LUSD, decimalify(lusdAmount)]\r\n    ]);\r\n  } else {\r\n    const withdrawEstimatorFunction =\r\n      output === BLusdAmmTokenIndex.LUSD\r\n        ? () => bLusdZapper.getMinWithdrawLUSD(burnLp.hex)\r\n        : () => bLusdAmm.calc_withdraw_one_coin(burnLp.hex, 0);\r\n    return new Map([[output, await withdrawEstimatorFunction().then(decimalify)]]);\r\n  }\r\n};\r\n\r\nconst removeLiquidity = async (\r\n  burnLpTokens: Decimal,\r\n  minBLusdAmount: Decimal,\r\n  minLusdAmount: Decimal,\r\n  bLusdZapper: BLUSDLPZap | undefined\r\n): Promise<void> => {\r\n  if (bLusdZapper === undefined) throw new Error(\"removeLiquidity() failed: a dependency is null\");\r\n\r\n  const receipt = await (\r\n    await bLusdZapper.removeLiquidityBalanced(\r\n      burnLpTokens.hex,\r\n      minBLusdAmount.hex,\r\n      minLusdAmount.hex\r\n    )\r\n  ).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"removeLiquidity() failed\");\r\n  }\r\n\r\n  console.log(\"removeLiquidity() finished\");\r\n};\r\n\r\nconst removeLiquidityLUSD = async (\r\n  burnLpTokens: Decimal,\r\n  minAmount: Decimal,\r\n  bLusdZapper: BLUSDLPZap | undefined\r\n): Promise<void> => {\r\n  if (bLusdZapper === undefined)\r\n    throw new Error(\"removeLiquidityLUSD() failed: a dependency is null\");\r\n\r\n  const removeLiquidityFunction = \"removeLiquidityLUSD\";\r\n\r\n  const gasEstimate = await bLusdZapper.estimateGas[removeLiquidityFunction](\r\n    burnLpTokens.hex,\r\n    minAmount.hex\r\n  );\r\n\r\n  const receipt = await (\r\n    await bLusdZapper[removeLiquidityFunction](\r\n      burnLpTokens.hex,\r\n      minAmount.hex,\r\n      { gasLimit: gasEstimate.mul(6).div(5) } // Add 20% overhead (we've seen it fail otherwise)\r\n    )\r\n  ).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"removeLiquidityLUSD() failed\");\r\n  }\r\n\r\n  console.log(\"removeLiquidityLUSD() finished\");\r\n};\r\n\r\nconst removeLiquidityBLUSD = async (\r\n  burnLpTokens: Decimal,\r\n  minAmount: Decimal,\r\n  bLusdAmm: CurveCryptoSwap2ETH | undefined\r\n): Promise<void> => {\r\n  if (bLusdAmm === undefined) throw new Error(\"removeLiquidityBLUSD() failed: a dependency is null\");\r\n\r\n  const removeLiquidityFunction = \"remove_liquidity_one_coin(uint256,uint256,uint256,bool)\";\r\n\r\n  const gasEstimate = await bLusdAmm.estimateGas[removeLiquidityFunction](\r\n    burnLpTokens.hex,\r\n    0,\r\n    minAmount.hex,\r\n    false\r\n  );\r\n\r\n  const receipt = await (\r\n    await bLusdAmm[removeLiquidityFunction](\r\n      burnLpTokens.hex,\r\n      0,\r\n      minAmount.hex,\r\n      false,\r\n      { gasLimit: gasEstimate.mul(6).div(5) } // Add 20% overhead (we've seen it fail otherwise)\r\n    )\r\n  ).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"removeLiquidityBLUSD() failed\");\r\n  }\r\n\r\n  console.log(\"removeLiquidityBLUSD() finished\");\r\n};\r\n\r\nconst removeLiquidityOneCoin = async (\r\n  burnLpTokens: Decimal,\r\n  output: BLusdAmmTokenIndex,\r\n  minAmount: Decimal,\r\n  bLusdZapper: BLUSDLPZap | undefined,\r\n  bLusdAmm: CurveCryptoSwap2ETH | undefined\r\n): Promise<void> => {\r\n  if (output === BLusdAmmTokenIndex.LUSD) {\r\n    return removeLiquidityLUSD(burnLpTokens, minAmount, bLusdZapper);\r\n  } else {\r\n    return removeLiquidityBLUSD(burnLpTokens, minAmount, bLusdAmm);\r\n  }\r\n};\r\n\r\nconst stakeLiquidity = async (\r\n  stakeAmount: Decimal,\r\n  bLusdGauge: CurveLiquidityGaugeV5 | undefined\r\n): Promise<DepositEventObject> => {\r\n  if (bLusdGauge === undefined) {\r\n    throw new Error(\"stakeLiquidity() failed: a dependency is null\");\r\n  }\r\n  const receipt = await (await bLusdGauge[\"deposit(uint256)\"](stakeAmount.hex)).wait();\r\n\r\n  const depositEvent = receipt?.events?.find(e => e?.event === \"Deposit\") as Maybe<DepositEvent>;\r\n\r\n  if (depositEvent === undefined) {\r\n    throw new Error(\"stakeLiquidity() failed: couldn't find Withdraw event\");\r\n  }\r\n\r\n  console.log(\"stakeLiquidity() finished:\", depositEvent.args);\r\n  return depositEvent.args;\r\n};\r\n\r\nconst unstakeLiquidity = async (\r\n  unstakeAmount: Decimal,\r\n  bLusdGauge: CurveLiquidityGaugeV5 | undefined\r\n): Promise<WithdrawEventObject> => {\r\n  if (bLusdGauge === undefined) {\r\n    throw new Error(\"unstakeLiquidity() failed: a dependency is null\");\r\n  }\r\n  const claimRewards = true;\r\n  const receipt = await (\r\n    await bLusdGauge[\"withdraw(uint256,bool)\"](unstakeAmount.hex, claimRewards)\r\n  ).wait();\r\n\r\n  const withdrawEvent = receipt?.events?.find(e => e?.event === \"Withdraw\") as Maybe<WithdrawEvent>;\r\n\r\n  if (withdrawEvent === undefined) {\r\n    throw new Error(\"unstakeLiquidity() failed: couldn't find Withdraw event\");\r\n  }\r\n\r\n  console.log(\"unstakeLiquidity() finished:\", withdrawEvent.args);\r\n  return withdrawEvent.args;\r\n};\r\n\r\nconst claimLpRewards = async (bLusdGauge: CurveLiquidityGaugeV5 | undefined): Promise<void> => {\r\n  if (bLusdGauge === undefined) {\r\n    throw new Error(\"claimLpRewards() failed: a dependency is null\");\r\n  }\r\n\r\n  const receipt = await (await bLusdGauge[\"claim_rewards()\"]()).wait();\r\n\r\n  if (!receipt.status) {\r\n    throw new Error(\"claimLpRewards() failed: no transaction receipt status received.\");\r\n  }\r\n};\r\n\r\nconst getLpRewards = async (\r\n  account: string,\r\n  bLusdGauge: CurveLiquidityGaugeV5\r\n): Promise<BLusdLpRewards> => {\r\n  let rewards: BLusdLpRewards = [];\r\n\r\n  const totalRewardTokens = (await bLusdGauge.reward_count()).toNumber();\r\n\r\n  for (let tokenIndex = 0; tokenIndex < totalRewardTokens; tokenIndex++) {\r\n    const tokenAddress = await bLusdGauge.reward_tokens(tokenIndex);\r\n    const tokenRewards = decimalify(await bLusdGauge.claimable_reward(account, tokenAddress));\r\n    const tokenName =\r\n      TOKEN_ADDRESS_NAME_MAP[tokenAddress] ||\r\n      `${tokenAddress.slice(0, 5)}..${tokenAddress.slice(tokenAddress.length - 3)}`;\r\n\r\n    rewards.push({ name: tokenName, address: tokenAddress, amount: tokenRewards });\r\n  }\r\n  return rewards;\r\n};\r\n\r\nexport const api = {\r\n  getAccountBonds,\r\n  getStats,\r\n  erc20From,\r\n  getLpToken,\r\n  getTokenBalance,\r\n  getTokenTotalSupply,\r\n  getProtocolInfo,\r\n  createBond,\r\n  cancelBond,\r\n  claimBond,\r\n  isTokenApprovedWithBLusdAmm,\r\n  isTokenApprovedWithBLusdAmmMainnet,\r\n  approveTokenWithBLusdAmm,\r\n  approveTokenWithBLusdAmmMainnet,\r\n  isTokenApprovedWithAmmZapper,\r\n  approveToken,\r\n  getExpectedSwapOutput,\r\n  getExpectedSwapOutputMainnet,\r\n  swapTokens,\r\n  swapTokensMainnet,\r\n  getCoinBalances,\r\n  getExpectedLpTokens,\r\n  addLiquidity,\r\n  getExpectedWithdrawal,\r\n  removeLiquidity,\r\n  removeLiquidityOneCoin,\r\n  stakeLiquidity,\r\n  unstakeLiquidity,\r\n  getLpRewards,\r\n  claimLpRewards\r\n};\r\n\r\nexport type BondsApi = typeof api;\r\n","import { useState, useCallback, useEffect } from \"react\";\r\nimport { TransactionStatus } from \"../components/Bonds/context/transitions\";\r\n\r\nexport function useTransaction<T extends unknown[]>(\r\n  transactionFunction: (...params: T) => Promise<void>,\r\n  dependencies: unknown[]\r\n): [(...params: T) => Promise<void>, TransactionStatus] {\r\n  const [status, setStatus] = useState<TransactionStatus>(\"IDLE\");\r\n\r\n  useEffect(() => {\r\n    if (status === \"CONFIRMED\" || status === \"FAILED\") {\r\n      const timeout = setTimeout(() => {\r\n        setStatus(\"IDLE\");\r\n      }, 2600);\r\n      return () => clearTimeout(timeout);\r\n    }\r\n  }, [status]);\r\n\r\n  const transaction = useCallback(\r\n    async (...args: T) => {\r\n      try {\r\n        setStatus(\"PENDING\");\r\n        await transactionFunction(...args);\r\n        setStatus(\"CONFIRMED\");\r\n      } catch (error: unknown) {\r\n        setStatus(\"FAILED\");\r\n        throw new Error(`useTransaction(${args}) ${error}`);\r\n      }\r\n    },\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [transactionFunction, ...dependencies]\r\n  );\r\n\r\n  return [transaction, status];\r\n}\r\n","import { useState, useEffect } from \"react\";\r\nimport { ContractInterface, ethers } from \"ethers\";\r\nimport { useLiquity } from \"./LiquityContext\";\r\n\r\ntype ContractStatus = \"UNKNOWN\" | \"LOADED\" | \"FAILED\";\r\ntype Contract<TContractType> = { instance: TContractType | undefined; status: ContractStatus };\r\n\r\nexport function useContract<TContractType>(\r\n  address: string | null,\r\n  abi: ContractInterface\r\n): [TContractType | undefined, ContractStatus] {\r\n  const { provider, liquity } = useLiquity();\r\n  const [contract, setContract] = useState<Contract<TContractType>>();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (contract !== undefined) return;\r\n        if (address === null) {\r\n          setContract({ instance: undefined, status: \"FAILED\" });\r\n          return;\r\n        }\r\n\r\n        const exists = (await provider.getCode(address)) !== \"0x\";\r\n        if (!exists) throw new Error(`Contract ${address} doesn't exist.`);\r\n\r\n        const connectedContract = (new ethers.Contract(\r\n          address,\r\n          abi,\r\n          liquity.connection.signer\r\n        ) as unknown) as TContractType;\r\n\r\n        setContract({ instance: connectedContract, status: \"LOADED\" });\r\n      } catch (e) {\r\n        setContract({ instance: undefined, status: \"FAILED\" });\r\n        console.error(e);\r\n        console.error(\r\n          `Contract ${address} doesn't appear to be deployed. Did you forget to re-run yarn deploy:chicken-bonds?`\r\n        );\r\n      }\r\n    })();\r\n  }, [provider, liquity.connection.signer, address, abi, contract]);\r\n\r\n  return [contract?.instance, contract?.status || \"UNKNOWN\"];\r\n}\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport {\r\n  BLUSDLPZap,\r\n  BLUSDLPZap__factory,\r\n  BLUSDToken,\r\n  BondNFT,\r\n  ChickenBondManager,\r\n  ERC20Faucet,\r\n  ERC20Faucet__factory\r\n} from \"@liquity/chicken-bonds/lusd/types\";\r\nimport {\r\n  CurveCryptoSwap2ETH,\r\n  CurveLiquidityGaugeV5__factory\r\n} from \"@liquity/chicken-bonds/lusd/types/external\";\r\nimport { CurveCryptoSwap2ETH__factory } from \"@liquity/chicken-bonds/lusd/types/external\";\r\nimport {\r\n  BLUSDToken__factory,\r\n  BondNFT__factory,\r\n  ChickenBondManager__factory\r\n} from \"@liquity/chicken-bonds/lusd/types\";\r\nimport type { LUSDToken } from \"@liquity/lib-ethers/dist/types\";\r\nimport LUSDTokenAbi from \"@liquity/lib-ethers/abi/LUSDToken.json\";\r\nimport { useContract } from \"../../../hooks/useContract\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { useCallback } from \"react\";\r\nimport type { BondsApi } from \"./api\";\r\nimport type { BLusdLpRewards, Bond, ProtocolInfo, Stats } from \"./transitions\";\r\nimport { BLusdAmmTokenIndex } from \"./transitions\";\r\nimport type { Addresses } from \"./transitions\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\nimport { useBondAddresses } from \"./BondAddressesContext\";\r\nimport type { CurveLiquidityGaugeV5 } from \"@liquity/chicken-bonds/lusd/types/external/CurveLiquidityGaugeV5\";\r\n\r\ntype BondsInformation = {\r\n  protocolInfo: ProtocolInfo;\r\n  bonds: Bond[];\r\n  stats: Stats;\r\n  bLusdBalance: Decimal;\r\n  lusdBalance: Decimal;\r\n  lpTokenBalance: Decimal;\r\n  stakedLpTokenBalance: Decimal;\r\n  lpTokenSupply: Decimal;\r\n  bLusdAmmBLusdBalance: Decimal;\r\n  bLusdAmmLusdBalance: Decimal;\r\n  lpRewards: BLusdLpRewards;\r\n};\r\n\r\ntype BondContracts = {\r\n  addresses: Addresses;\r\n  lusdToken: LUSDToken | undefined;\r\n  bLusdToken: BLUSDToken | undefined;\r\n  bondNft: BondNFT | undefined;\r\n  chickenBondManager: ChickenBondManager | undefined;\r\n  bLusdAmm: CurveCryptoSwap2ETH | undefined;\r\n  bLusdAmmZapper: BLUSDLPZap | undefined;\r\n  bLusdGauge: CurveLiquidityGaugeV5 | undefined;\r\n  hasFoundContracts: boolean;\r\n  getLatestData: (account: string, api: BondsApi) => Promise<BondsInformation | undefined>;\r\n};\r\n\r\nexport const useBondContracts = (): BondContracts => {\r\n  const { liquity } = useLiquity();\r\n  const { chainId } = useWeb3React();\r\n  const isMainnet = chainId === 1;\r\n\r\n  const addresses = useBondAddresses();\r\n\r\n  const {\r\n    BLUSD_AMM_ADDRESS,\r\n    BLUSD_TOKEN_ADDRESS,\r\n    BOND_NFT_ADDRESS,\r\n    CHICKEN_BOND_MANAGER_ADDRESS,\r\n    LUSD_OVERRIDE_ADDRESS,\r\n    BLUSD_LP_ZAP_ADDRESS,\r\n    BLUSD_AMM_STAKING_ADDRESS\r\n  } = addresses;\r\n\r\n  const [lusdTokenDefault, lusdTokenDefaultStatus] = useContract<LUSDToken>(\r\n    liquity.connection.addresses.lusdToken,\r\n    LUSDTokenAbi\r\n  );\r\n\r\n  const [lusdTokenOverride, lusdTokenOverrideStatus] = useContract<ERC20Faucet>(\r\n    LUSD_OVERRIDE_ADDRESS,\r\n    ERC20Faucet__factory.abi\r\n  );\r\n\r\n  const [lusdToken, lusdTokenStatus] =\r\n    LUSD_OVERRIDE_ADDRESS === null\r\n      ? [lusdTokenDefault, lusdTokenDefaultStatus]\r\n      : [(lusdTokenOverride as unknown) as LUSDToken, lusdTokenOverrideStatus];\r\n\r\n  const [bLusdToken, bLusdTokenStatus] = useContract<BLUSDToken>(\r\n    BLUSD_TOKEN_ADDRESS,\r\n    BLUSDToken__factory.abi\r\n  );\r\n\r\n  const [bondNft, bondNftStatus] = useContract<BondNFT>(BOND_NFT_ADDRESS, BondNFT__factory.abi);\r\n  const [chickenBondManager, chickenBondManagerStatus] = useContract<ChickenBondManager>(\r\n    CHICKEN_BOND_MANAGER_ADDRESS,\r\n    ChickenBondManager__factory.abi\r\n  );\r\n\r\n  const [bLusdAmm, bLusdAmmStatus] = useContract<CurveCryptoSwap2ETH>(\r\n    BLUSD_AMM_ADDRESS,\r\n    CurveCryptoSwap2ETH__factory.abi\r\n  );\r\n\r\n  const [bLusdAmmZapper, bLusAmmZapperStatus] = useContract<BLUSDLPZap>(\r\n    BLUSD_LP_ZAP_ADDRESS,\r\n    BLUSDLPZap__factory.abi\r\n  );\r\n\r\n  const [bLusdGauge, bLusdGaugeStatus] = useContract<CurveLiquidityGaugeV5>(\r\n    BLUSD_AMM_STAKING_ADDRESS,\r\n    CurveLiquidityGaugeV5__factory.abi\r\n  );\r\n\r\n  const hasFoundContracts =\r\n    [\r\n      lusdTokenStatus,\r\n      bondNftStatus,\r\n      chickenBondManagerStatus,\r\n      bLusdTokenStatus,\r\n      bLusdAmmStatus,\r\n      bLusAmmZapperStatus,\r\n      bLusdGaugeStatus\r\n    ].find(status => status === \"FAILED\") === undefined;\r\n\r\n  const getLatestData = useCallback(\r\n    async (account: string, api: BondsApi): Promise<BondsInformation | undefined> => {\r\n      if (\r\n        lusdToken === undefined ||\r\n        bondNft === undefined ||\r\n        chickenBondManager === undefined ||\r\n        bLusdToken === undefined ||\r\n        bLusdAmm === undefined ||\r\n        bLusdGauge === undefined ||\r\n        BLUSD_AMM_STAKING_ADDRESS === null\r\n      ) {\r\n        return undefined;\r\n      }\r\n\r\n      const protocolInfoPromise = api.getProtocolInfo(\r\n        bLusdToken,\r\n        bLusdAmm,\r\n        chickenBondManager,\r\n        isMainnet\r\n      );\r\n\r\n      const bondsPromise = api.getAccountBonds(\r\n        account,\r\n        bondNft,\r\n        chickenBondManager,\r\n        await protocolInfoPromise\r\n      );\r\n\r\n      const [protocolInfo, stats, lpToken, lpStakingContract] = await Promise.all([\r\n        protocolInfoPromise,\r\n        api.getStats(chickenBondManager),\r\n        api.getLpToken(bLusdAmm),\r\n        api.erc20From(BLUSD_AMM_STAKING_ADDRESS, bLusdAmm.provider)\r\n      ]);\r\n\r\n      const [\r\n        bLusdBalance,\r\n        lusdBalance,\r\n        lpTokenBalance,\r\n        stakedLpTokenBalance,\r\n        lpTokenSupply,\r\n        bLusdAmmCoinBalances,\r\n        lpRewards\r\n      ] = await Promise.all([\r\n        api.getTokenBalance(account, bLusdToken),\r\n        api.getTokenBalance(account, lusdToken),\r\n        api.getTokenBalance(account, lpToken),\r\n        api.getTokenBalance(account, lpStakingContract),\r\n        api.getTokenTotalSupply(lpToken),\r\n        api.getCoinBalances(bLusdAmm),\r\n        api.getLpRewards(account, bLusdGauge)\r\n      ]);\r\n\r\n      const bonds = await bondsPromise;\r\n\r\n      return {\r\n        protocolInfo,\r\n        bonds,\r\n        stats,\r\n        bLusdBalance,\r\n        lusdBalance,\r\n        lpTokenBalance,\r\n        stakedLpTokenBalance,\r\n        lpTokenSupply,\r\n        bLusdAmmBLusdBalance: bLusdAmmCoinBalances[BLusdAmmTokenIndex.BLUSD],\r\n        bLusdAmmLusdBalance: bLusdAmmCoinBalances[BLusdAmmTokenIndex.LUSD],\r\n        lpRewards\r\n      };\r\n    },\r\n    [\r\n      chickenBondManager,\r\n      bondNft,\r\n      bLusdToken,\r\n      lusdToken,\r\n      bLusdAmm,\r\n      isMainnet,\r\n      BLUSD_AMM_STAKING_ADDRESS,\r\n      bLusdGauge\r\n    ]\r\n  );\r\n\r\n  return {\r\n    addresses,\r\n    lusdToken,\r\n    bLusdToken,\r\n    bondNft,\r\n    chickenBondManager,\r\n    bLusdAmm,\r\n    bLusdAmmZapper,\r\n    bLusdGauge,\r\n    getLatestData,\r\n    hasFoundContracts\r\n  };\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef, useMemo } from \"react\";\r\nimport { BondViewContext, BondViewContextType } from \"./BondViewContext\";\r\nimport type {\r\n  Stats,\r\n  BondView,\r\n  BondEvent,\r\n  Payload,\r\n  Bond,\r\n  BondTransactionStatuses,\r\n  CreateBondPayload,\r\n  ProtocolInfo,\r\n  OptimisticBond,\r\n  SwapPayload,\r\n  ApprovePressedPayload,\r\n  ManageLiquidityPayload,\r\n  BLusdLpRewards\r\n} from \"./transitions\";\r\nimport { BLusdAmmTokenIndex } from \"./transitions\";\r\nimport { transitions } from \"./transitions\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { useLiquity } from \"../../../hooks/LiquityContext\";\r\nimport { api, _getProtocolInfo } from \"./api\";\r\nimport { useTransaction } from \"../../../hooks/useTransaction\";\r\nimport type { ERC20Faucet } from \"@liquity/chicken-bonds/lusd/types\";\r\nimport { useBondContracts } from \"./useBondContracts\";\r\nimport { useWeb3React } from \"@web3-react/core\";\r\nimport { useBondAddresses } from \"./BondAddressesContext\";\r\n\r\n// Refresh backend values every 15 seconds\r\nconst SYNCHRONIZE_INTERVAL_MS = 15 * 1000;\r\n\r\nconst isValidEvent = (view: BondView, event: BondEvent): boolean => {\r\n  return transitions[view][event] !== undefined;\r\n};\r\n\r\nconst transition = (view: BondView, event: BondEvent): BondView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nexport const EXAMPLE_NFT = \"./bonds/egg-nft.png\";\r\n\r\nexport const BondViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const [view, setView] = useState<BondView>(\"IDLE\");\r\n  const viewRef = useRef<BondView>(view);\r\n  const [selectedBondId, setSelectedBondId] = useState<string>();\r\n  const [optimisticBond, setOptimisticBond] = useState<OptimisticBond>();\r\n  const [shouldSynchronize, setShouldSynchronize] = useState<boolean>(true);\r\n  const [bonds, setBonds] = useState<Bond[]>();\r\n  const [stats, setStats] = useState<Stats>();\r\n  const [protocolInfo, setProtocolInfo] = useState<ProtocolInfo>();\r\n  const [simulatedProtocolInfo, setSimulatedProtocolInfo] = useState<ProtocolInfo>();\r\n  const [lpRewards, setLpRewards] = useState<BLusdLpRewards>();\r\n  const [isLusdApprovedWithBlusdAmm, setIsLusdApprovedWithBlusdAmm] = useState(false);\r\n  const [isBLusdApprovedWithBlusdAmm, setIsBLusdApprovedWithBlusdAmm] = useState(false);\r\n  const [isLusdApprovedWithAmmZapper, setIsLusdApprovedWithAmmZapper] = useState(false);\r\n  const [isBLusdApprovedWithAmmZapper, setIsBLusdApprovedWithAmmZapper] = useState(false);\r\n  const [isBLusdLpApprovedWithAmmZapper, setIsBLusdLpApprovedWithAmmZapper] = useState(false);\r\n  const [isBLusdLpApprovedWithGauge, setIsBLusdLpApprovedWithGauge] = useState(false);\r\n  const [isSynchronizing, setIsSynchronizing] = useState(false);\r\n  const [inputToken, setInputToken] = useState<BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD>(\r\n    BLusdAmmTokenIndex.BLUSD\r\n  );\r\n  const [statuses, setStatuses] = useState<BondTransactionStatuses>({\r\n    CREATE: \"IDLE\",\r\n    CANCEL: \"IDLE\",\r\n    CLAIM: \"IDLE\",\r\n    APPROVE_AMM: \"IDLE\",\r\n    APPROVE_SPENDER: \"IDLE\",\r\n    SWAP: \"IDLE\",\r\n    MANAGE_LIQUIDITY: \"IDLE\"\r\n  });\r\n  const [bLusdBalance, setBLusdBalance] = useState<Decimal>();\r\n  const [lusdBalance, setLusdBalance] = useState<Decimal>();\r\n  const [lpTokenBalance, setLpTokenBalance] = useState<Decimal>();\r\n  const [stakedLpTokenBalance, setStakedLpTokenBalance] = useState<Decimal>();\r\n\r\n  const [lpTokenSupply, setLpTokenSupply] = useState<Decimal>();\r\n  const [bLusdAmmBLusdBalance, setBLusdAmmBLusdBalance] = useState<Decimal>();\r\n  const [bLusdAmmLusdBalance, setBLusdAmmLusdBalance] = useState<Decimal>();\r\n  const [isBootstrapPeriodActive, setIsBootstrapPeriodActive] = useState<boolean>();\r\n  const { account, liquity } = useLiquity();\r\n  const {\r\n    LUSD_OVERRIDE_ADDRESS,\r\n    BLUSD_AMM_ADDRESS,\r\n    BLUSD_LP_ZAP_ADDRESS,\r\n    BLUSD_AMM_STAKING_ADDRESS\r\n  } = useBondAddresses();\r\n  const contracts = useBondContracts();\r\n  const { chainId } = useWeb3React();\r\n  const isMainnet = chainId === 1;\r\n\r\n  const setSimulatedMarketPrice = useCallback(\r\n    (marketPrice: Decimal) => {\r\n      if (protocolInfo === undefined) return;\r\n      const simulatedProtocolInfo = _getProtocolInfo(\r\n        marketPrice,\r\n        protocolInfo.floorPrice,\r\n        protocolInfo.claimBondFee,\r\n        protocolInfo.alphaAccrualFactor\r\n      );\r\n\r\n      setSimulatedProtocolInfo({\r\n        ...protocolInfo,\r\n        ...simulatedProtocolInfo,\r\n        simulatedMarketPrice: marketPrice\r\n      });\r\n    },\r\n    [protocolInfo]\r\n  );\r\n\r\n  const resetSimulatedMarketPrice = useCallback(() => {\r\n    if (protocolInfo === undefined) return;\r\n\r\n    setSimulatedProtocolInfo({ ...protocolInfo });\r\n  }, [protocolInfo]);\r\n\r\n  const removeBondFromList = useCallback(\r\n    (bondId: string) => {\r\n      if (bonds === undefined) return;\r\n      const idx = bonds.findIndex(bond => bond.id === bondId);\r\n      const nextBonds = bonds.slice(0, idx).concat(bonds.slice(idx + 1));\r\n      setBonds(nextBonds);\r\n    },\r\n    [bonds]\r\n  );\r\n\r\n  const changeBondStatusToClaimed = useCallback(\r\n    (bondId: string) => {\r\n      if (bonds === undefined) return;\r\n      const idx = bonds.findIndex(bond => bond.id === bondId);\r\n      const updatedBond: Bond = { ...bonds[idx], status: \"CLAIMED\" };\r\n      const nextBonds = bonds\r\n        .slice(0, idx)\r\n        .concat(updatedBond)\r\n        .concat(bonds.slice(idx + 1));\r\n      setBonds(nextBonds);\r\n    },\r\n    [bonds]\r\n  );\r\n\r\n  const getLusdFromFaucet = useCallback(async () => {\r\n    if (contracts.lusdToken === undefined) return;\r\n    if (\r\n      LUSD_OVERRIDE_ADDRESS !== null &&\r\n      (await contracts.lusdToken.balanceOf(account)).eq(0) &&\r\n      \"tap\" in contracts.lusdToken\r\n    ) {\r\n      await (await ((contracts.lusdToken as unknown) as ERC20Faucet).tap()).wait();\r\n      setShouldSynchronize(true);\r\n    }\r\n  }, [contracts.lusdToken, account, LUSD_OVERRIDE_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (\r\n        BLUSD_AMM_ADDRESS === null ||\r\n        contracts.lusdToken === undefined ||\r\n        isLusdApprovedWithBlusdAmm\r\n      ) {\r\n        return;\r\n      }\r\n      const isApproved = await (isMainnet\r\n        ? api.isTokenApprovedWithBLusdAmmMainnet(account, contracts.lusdToken)\r\n        : api.isTokenApprovedWithBLusdAmm(account, contracts.lusdToken, BLUSD_AMM_ADDRESS));\r\n\r\n      setIsLusdApprovedWithBlusdAmm(isApproved);\r\n    })();\r\n  }, [contracts.lusdToken, account, isLusdApprovedWithBlusdAmm, isMainnet, BLUSD_AMM_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (\r\n        BLUSD_AMM_ADDRESS === null ||\r\n        contracts.bLusdToken === undefined ||\r\n        isBLusdApprovedWithBlusdAmm\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const isApproved = await (isMainnet\r\n        ? api.isTokenApprovedWithBLusdAmmMainnet(account, contracts.bLusdToken)\r\n        : api.isTokenApprovedWithBLusdAmm(account, contracts.bLusdToken, BLUSD_AMM_ADDRESS));\r\n\r\n      setIsBLusdApprovedWithBlusdAmm(isApproved);\r\n    })();\r\n  }, [contracts.bLusdToken, account, isBLusdApprovedWithBlusdAmm, isMainnet, BLUSD_AMM_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (\r\n        BLUSD_LP_ZAP_ADDRESS === null ||\r\n        contracts.lusdToken === undefined ||\r\n        isLusdApprovedWithAmmZapper\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const isLusdApproved = await api.isTokenApprovedWithAmmZapper(\r\n        account,\r\n        contracts.lusdToken,\r\n        BLUSD_LP_ZAP_ADDRESS\r\n      );\r\n\r\n      setIsLusdApprovedWithAmmZapper(isLusdApproved);\r\n    })();\r\n  }, [contracts.lusdToken, account, isLusdApprovedWithAmmZapper, BLUSD_LP_ZAP_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (contracts.bLusdAmm === undefined || isBLusdLpApprovedWithAmmZapper) return;\r\n      const lpToken = await api.getLpToken(contracts.bLusdAmm);\r\n      const isLpApproved = await api.isTokenApprovedWithAmmZapper(\r\n        account,\r\n        lpToken,\r\n        BLUSD_LP_ZAP_ADDRESS\r\n      );\r\n\r\n      setIsBLusdLpApprovedWithAmmZapper(isLpApproved);\r\n    })();\r\n  }, [contracts.bLusdAmm, account, isBLusdLpApprovedWithAmmZapper, BLUSD_LP_ZAP_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (\r\n        BLUSD_LP_ZAP_ADDRESS === null ||\r\n        contracts.bLusdToken === undefined ||\r\n        isBLusdApprovedWithAmmZapper\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const isBLusdApproved = await api.isTokenApprovedWithAmmZapper(\r\n        account,\r\n        contracts.bLusdToken,\r\n        BLUSD_LP_ZAP_ADDRESS\r\n      );\r\n\r\n      setIsLusdApprovedWithAmmZapper(isBLusdApproved);\r\n    })();\r\n  }, [contracts.bLusdToken, account, isBLusdApprovedWithAmmZapper, BLUSD_LP_ZAP_ADDRESS]);\r\n\r\n  useEffect(() => {\r\n    if (isSynchronizing) return;\r\n    const timer = setTimeout(() => setShouldSynchronize(true), SYNCHRONIZE_INTERVAL_MS);\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n    };\r\n  }, [isSynchronizing]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (\r\n          contracts.lusdToken === undefined ||\r\n          contracts.bondNft === undefined ||\r\n          contracts.chickenBondManager === undefined ||\r\n          contracts.bLusdToken === undefined ||\r\n          contracts.bLusdAmm === undefined ||\r\n          contracts.bLusdGauge === undefined ||\r\n          !shouldSynchronize ||\r\n          isSynchronizing\r\n        ) {\r\n          return;\r\n        }\r\n        setIsSynchronizing(true);\r\n\r\n        const latest = await contracts.getLatestData(account, api);\r\n        if (latest === undefined) {\r\n          setIsSynchronizing(false);\r\n          return;\r\n        }\r\n\r\n        const {\r\n          protocolInfo,\r\n          bonds,\r\n          stats,\r\n          bLusdBalance,\r\n          lusdBalance,\r\n          lpTokenBalance,\r\n          stakedLpTokenBalance,\r\n          lpTokenSupply,\r\n          bLusdAmmBLusdBalance,\r\n          bLusdAmmLusdBalance,\r\n          lpRewards\r\n        } = latest;\r\n\r\n        setProtocolInfo(protocolInfo);\r\n\r\n        // Don't change the simualted price if we already have one since only the user should change it\r\n        if (simulatedProtocolInfo === undefined) {\r\n          const simulatedProtocolInfo = _getProtocolInfo(\r\n            protocolInfo.simulatedMarketPrice,\r\n            protocolInfo.floorPrice,\r\n            protocolInfo.claimBondFee,\r\n            protocolInfo.alphaAccrualFactor\r\n          );\r\n          setSimulatedProtocolInfo({\r\n            ...protocolInfo,\r\n            ...simulatedProtocolInfo,\r\n            simulatedMarketPrice: protocolInfo.simulatedMarketPrice\r\n          });\r\n        }\r\n\r\n        setShouldSynchronize(false);\r\n        setLpRewards(lpRewards);\r\n        setBLusdBalance(bLusdBalance);\r\n        setLusdBalance(lusdBalance);\r\n        setLpTokenBalance(lpTokenBalance);\r\n        setStakedLpTokenBalance(stakedLpTokenBalance);\r\n        setLpTokenSupply(lpTokenSupply);\r\n        setBLusdAmmBLusdBalance(bLusdAmmBLusdBalance);\r\n        setBLusdAmmLusdBalance(bLusdAmmLusdBalance);\r\n        setStats(stats);\r\n        setBonds(bonds);\r\n        setOptimisticBond(undefined);\r\n      } catch (error: unknown) {\r\n        console.error(\"Synchronising effect exception\", error);\r\n      }\r\n\r\n      setIsSynchronizing(false);\r\n    })();\r\n  }, [isSynchronizing, shouldSynchronize, account, contracts, simulatedProtocolInfo]);\r\n\r\n  const [approveAmm, approveAmmStatus] = useTransaction(\r\n    async (tokensNeedingApproval: BLusdAmmTokenIndex[]) => {\r\n      for (const token of tokensNeedingApproval) {\r\n        if (token === BLusdAmmTokenIndex.BLUSD) {\r\n          await (isMainnet\r\n            ? api.approveTokenWithBLusdAmmMainnet(contracts.bLusdToken)\r\n            : api.approveTokenWithBLusdAmm(contracts.bLusdToken, BLUSD_AMM_ADDRESS));\r\n\r\n          setIsBLusdApprovedWithBlusdAmm(true);\r\n        } else {\r\n          await (isMainnet\r\n            ? api.approveTokenWithBLusdAmmMainnet(contracts.lusdToken)\r\n            : api.approveTokenWithBLusdAmm(contracts.lusdToken, BLUSD_AMM_ADDRESS));\r\n\r\n          setIsLusdApprovedWithBlusdAmm(true);\r\n        }\r\n      }\r\n    },\r\n    [contracts.bLusdToken, contracts.lusdToken, isMainnet, BLUSD_AMM_ADDRESS]\r\n  );\r\n\r\n  const [approveTokens, approveTokensStatus] = useTransaction(\r\n    async ({ tokensNeedingApproval }: ApprovePressedPayload) => {\r\n      if (contracts.bLusdAmm === undefined) return;\r\n      for (const [token, spender] of Array.from(tokensNeedingApproval)) {\r\n        if (token === BLusdAmmTokenIndex.BLUSD) {\r\n          await api.approveToken(contracts.bLusdToken, spender);\r\n          if (spender === BLUSD_AMM_ADDRESS) {\r\n            setIsBLusdApprovedWithBlusdAmm(true);\r\n          } else if (spender === BLUSD_LP_ZAP_ADDRESS) {\r\n            setIsBLusdApprovedWithAmmZapper(true);\r\n          }\r\n        } else if (token === BLusdAmmTokenIndex.LUSD) {\r\n          await api.approveToken(contracts.lusdToken, BLUSD_LP_ZAP_ADDRESS);\r\n          setIsLusdApprovedWithAmmZapper(true);\r\n        } else if (token === BLusdAmmTokenIndex.BLUSD_LUSD_LP && spender === undefined) {\r\n          const lpToken = await api.getLpToken(contracts.bLusdAmm);\r\n          await api.approveToken(lpToken, BLUSD_LP_ZAP_ADDRESS);\r\n          setIsBLusdLpApprovedWithAmmZapper(true);\r\n        } else if (token === BLusdAmmTokenIndex.BLUSD_LUSD_LP) {\r\n          const lpToken = await api.getLpToken(contracts.bLusdAmm);\r\n          await api.approveToken(lpToken, spender);\r\n          if (spender === BLUSD_LP_ZAP_ADDRESS) {\r\n            setIsBLusdLpApprovedWithAmmZapper(true);\r\n          } else if (spender === BLUSD_AMM_STAKING_ADDRESS) {\r\n            setIsBLusdLpApprovedWithGauge(true);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    [\r\n      contracts.bLusdAmm,\r\n      contracts.bLusdToken,\r\n      contracts.lusdToken,\r\n      BLUSD_LP_ZAP_ADDRESS,\r\n      BLUSD_AMM_STAKING_ADDRESS,\r\n      BLUSD_AMM_ADDRESS,\r\n      isBLusdApprovedWithAmmZapper,\r\n      isLusdApprovedWithAmmZapper\r\n    ]\r\n  );\r\n\r\n  const [createBond, createStatus] = useTransaction(\r\n    async (lusdAmount: Decimal) => {\r\n      if (liquity.connection.signer === undefined) return;\r\n\r\n      await api.createBond(\r\n        lusdAmount,\r\n        account,\r\n        LUSD_OVERRIDE_ADDRESS ?? liquity.connection.addresses.lusdToken,\r\n        contracts.lusdToken,\r\n        contracts.chickenBondManager,\r\n        liquity.connection.signer\r\n      );\r\n      const optimisticBond: OptimisticBond = {\r\n        id: \"OPTIMISTIC_BOND\",\r\n        deposit: lusdAmount,\r\n        startTime: Date.now(),\r\n        status: \"PENDING\"\r\n      };\r\n      setOptimisticBond(optimisticBond);\r\n      setShouldSynchronize(true);\r\n    },\r\n    [contracts.chickenBondManager, contracts.lusdToken, liquity.connection.signer, account]\r\n  );\r\n\r\n  const [cancelBond, cancelStatus] = useTransaction(\r\n    async (bondId: string, minimumLusd: Decimal) => {\r\n      await api.cancelBond(bondId, minimumLusd, contracts.chickenBondManager);\r\n      removeBondFromList(bondId);\r\n      setShouldSynchronize(true);\r\n    },\r\n    [contracts.chickenBondManager, removeBondFromList]\r\n  );\r\n\r\n  const [claimBond, claimStatus] = useTransaction(\r\n    async (bondId: string) => {\r\n      await api.claimBond(bondId, contracts.chickenBondManager);\r\n      changeBondStatusToClaimed(bondId);\r\n      setShouldSynchronize(true);\r\n    },\r\n    [contracts.chickenBondManager, changeBondStatusToClaimed]\r\n  );\r\n\r\n  const getExpectedSwapOutput = useCallback(\r\n    async (inputToken: BLusdAmmTokenIndex, inputAmount: Decimal) =>\r\n      contracts.bLusdAmm\r\n        ? (isMainnet ? api.getExpectedSwapOutputMainnet : api.getExpectedSwapOutput)(\r\n            inputToken,\r\n            inputAmount,\r\n            contracts.bLusdAmm\r\n          )\r\n        : Decimal.ZERO,\r\n    [contracts.bLusdAmm, isMainnet]\r\n  );\r\n\r\n  const [swapTokens, swapStatus] = useTransaction(\r\n    async (inputToken: BLusdAmmTokenIndex, inputAmount: Decimal, minOutputAmount: Decimal) => {\r\n      await (isMainnet ? api.swapTokensMainnet : api.swapTokens)(\r\n        inputToken,\r\n        inputAmount,\r\n        minOutputAmount,\r\n        contracts.bLusdAmm\r\n      );\r\n      setShouldSynchronize(true);\r\n    },\r\n    [contracts.bLusdAmm]\r\n  );\r\n\r\n  const getExpectedLpTokens = useCallback(\r\n    async (bLusdAmount: Decimal, lusdAmount: Decimal) => {\r\n      if (liquity.connection.signer === undefined) return Decimal.ZERO;\r\n\r\n      return contracts.bLusdAmmZapper\r\n        ? api.getExpectedLpTokens(bLusdAmount, lusdAmount, contracts.bLusdAmmZapper)\r\n        : Decimal.ZERO;\r\n    },\r\n    [contracts.bLusdAmmZapper, liquity.connection.signer]\r\n  );\r\n\r\n  const [manageLiquidity, manageLiquidityStatus] = useTransaction(\r\n    async (params: ManageLiquidityPayload) => {\r\n      if (params.action === \"addLiquidity\") {\r\n        await api.addLiquidity(\r\n          params.bLusdAmount,\r\n          params.lusdAmount,\r\n          params.minLpTokens,\r\n          params.shouldStakeInGauge,\r\n          contracts.bLusdAmmZapper\r\n        );\r\n      } else if (params.action === \"removeLiquidity\") {\r\n        await api.removeLiquidity(\r\n          params.burnLpTokens,\r\n          params.minBLusdAmount,\r\n          params.minLusdAmount,\r\n          contracts.bLusdAmmZapper\r\n        );\r\n      } else if (params.action === \"removeLiquidityOneCoin\") {\r\n        await api.removeLiquidityOneCoin(\r\n          params.burnLpTokens,\r\n          params.output,\r\n          params.minAmount,\r\n          contracts.bLusdAmmZapper,\r\n          contracts.bLusdAmm\r\n        );\r\n      } else if (params.action === \"stakeLiquidity\") {\r\n        await api.stakeLiquidity(params.stakeAmount, contracts.bLusdGauge);\r\n      } else if (params.action === \"unstakeLiquidity\") {\r\n        await api.unstakeLiquidity(params.unstakeAmount, contracts.bLusdGauge);\r\n      } else if (params.action === \"claimLpRewards\") {\r\n        await api.claimLpRewards(contracts.bLusdGauge);\r\n      }\r\n      setShouldSynchronize(true);\r\n    },\r\n    [contracts.bLusdAmmZapper, contracts.bLusdGauge]\r\n  );\r\n\r\n  const getExpectedWithdrawal = useCallback(\r\n    async (\r\n      burnLp: Decimal,\r\n      output: BLusdAmmTokenIndex | \"both\"\r\n    ): Promise<Map<BLusdAmmTokenIndex, Decimal>> => {\r\n      if (contracts.bLusdAmm === undefined)\r\n        return new Map([\r\n          [BLusdAmmTokenIndex.LUSD, Decimal.ZERO],\r\n          [BLusdAmmTokenIndex.BLUSD, Decimal.ZERO]\r\n        ]);\r\n\r\n      return contracts.bLusdAmmZapper\r\n        ? api.getExpectedWithdrawal(burnLp, output, contracts.bLusdAmmZapper, contracts.bLusdAmm)\r\n        : new Map();\r\n    },\r\n    [contracts.bLusdAmmZapper, contracts.bLusdAmm]\r\n  );\r\n\r\n  const selectedBond = useMemo(() => bonds?.find(bond => bond.id === selectedBondId), [\r\n    bonds,\r\n    selectedBondId\r\n  ]);\r\n\r\n  const dispatchEvent = useCallback(\r\n    async (event: BondEvent, payload?: Payload) => {\r\n      if (!isValidEvent(viewRef.current, event)) {\r\n        console.error(\"invalid event\", event, payload, \"in view\", viewRef.current);\r\n        return;\r\n      }\r\n\r\n      const nextView = transition(viewRef.current, event);\r\n      setView(nextView);\r\n\r\n      if (payload && \"bondId\" in payload && payload.bondId !== selectedBondId) {\r\n        setSelectedBondId(payload.bondId);\r\n      }\r\n\r\n      if (payload && \"inputToken\" in payload && payload.inputToken !== inputToken) {\r\n        setInputToken(payload.inputToken);\r\n      }\r\n\r\n      const isCurrentViewEvent = (_view: BondView, _event: BondEvent) =>\r\n        viewRef.current === _view && event === _event;\r\n\r\n      try {\r\n        if (isCurrentViewEvent(\"CREATING\", \"CONFIRM_PRESSED\")) {\r\n          await createBond((payload as CreateBondPayload).deposit);\r\n          await dispatchEvent(\"CREATE_BOND_CONFIRMED\");\r\n        } else if (isCurrentViewEvent(\"CANCELLING\", \"CONFIRM_PRESSED\")) {\r\n          if (selectedBond === undefined) {\r\n            console.error(\r\n              \"dispatchEvent() handler: attempted to cancel a bond without selecting a bond\"\r\n            );\r\n            return;\r\n          }\r\n          await cancelBond(selectedBond.id, selectedBond.deposit);\r\n          await dispatchEvent(\"CANCEL_BOND_CONFIRMED\");\r\n        } else if (isCurrentViewEvent(\"CLAIMING\", \"CONFIRM_PRESSED\")) {\r\n          if (selectedBond === undefined) {\r\n            console.error(\r\n              \"dispatchEvent() handler: attempted to claim a bond without selecting a bond\"\r\n            );\r\n            return;\r\n          }\r\n          await claimBond(selectedBond.id);\r\n          await dispatchEvent(\"CLAIM_BOND_CONFIRMED\");\r\n        } else if (isCurrentViewEvent(\"SWAPPING\", \"APPROVE_PRESSED\")) {\r\n          await approveAmm([inputToken]);\r\n        } else if (isCurrentViewEvent(\"SWAPPING\", \"CONFIRM_PRESSED\")) {\r\n          const { inputAmount, minOutputAmount } = payload as SwapPayload;\r\n          await swapTokens(inputToken, inputAmount, minOutputAmount);\r\n          await dispatchEvent(\"SWAP_CONFIRMED\");\r\n        } else if (isCurrentViewEvent(\"MANAGING_LIQUIDITY\", \"APPROVE_PRESSED\")) {\r\n          await approveTokens(payload as ApprovePressedPayload);\r\n        } else if (isCurrentViewEvent(\"MANAGING_LIQUIDITY\", \"CONFIRM_PRESSED\")) {\r\n          await manageLiquidity(payload as ManageLiquidityPayload);\r\n          await dispatchEvent(\"MANAGE_LIQUIDITY_CONFIRMED\");\r\n        }\r\n      } catch (error: unknown) {\r\n        console.error(\"dispatchEvent(), event handler failed\\n\\n\", error);\r\n      }\r\n    },\r\n    [\r\n      selectedBondId,\r\n      cancelBond,\r\n      createBond,\r\n      claimBond,\r\n      selectedBond,\r\n      approveAmm,\r\n      approveTokens,\r\n      swapTokens,\r\n      inputToken,\r\n      manageLiquidity\r\n    ]\r\n  );\r\n\r\n  useEffect(() => {\r\n    setStatuses(statuses => ({\r\n      ...statuses,\r\n      CREATE: createStatus,\r\n      CANCEL: cancelStatus,\r\n      CLAIM: claimStatus,\r\n      APPROVE_AMM: approveAmmStatus,\r\n      APPROVE_SPENDER: approveTokensStatus,\r\n      SWAP: swapStatus,\r\n      MANAGE_LIQUIDITY: manageLiquidityStatus\r\n    }));\r\n  }, [\r\n    createStatus,\r\n    cancelStatus,\r\n    claimStatus,\r\n    approveAmmStatus,\r\n    approveTokensStatus,\r\n    swapStatus,\r\n    manageLiquidityStatus\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (\r\n        bonds === undefined ||\r\n        protocolInfo === undefined ||\r\n        contracts.chickenBondManager === undefined\r\n      )\r\n        return;\r\n\r\n      if (protocolInfo.bLusdSupply.gt(0)) {\r\n        setIsBootstrapPeriodActive(false);\r\n        return;\r\n      }\r\n\r\n      const bootstrapPeriodMs =\r\n        (await contracts.chickenBondManager.BOOTSTRAP_PERIOD_CHICKEN_IN()).toNumber() * 1000;\r\n\r\n      const anyBondOlderThanBootstrapPeriod =\r\n        bonds.find(bond => Date.now() - bond.startTime > bootstrapPeriodMs) !== undefined;\r\n\r\n      setIsBootstrapPeriodActive(!anyBondOlderThanBootstrapPeriod);\r\n    })();\r\n  }, [bonds, protocolInfo, contracts.chickenBondManager]);\r\n\r\n  const provider: BondViewContextType = {\r\n    view,\r\n    dispatchEvent,\r\n    selectedBondId,\r\n    optimisticBond,\r\n    protocolInfo,\r\n    stats,\r\n    bonds,\r\n    statuses,\r\n    selectedBond,\r\n    bLusdBalance,\r\n    lusdBalance,\r\n    lpTokenBalance,\r\n    stakedLpTokenBalance,\r\n    lpTokenSupply,\r\n    bLusdAmmBLusdBalance,\r\n    bLusdAmmLusdBalance,\r\n    isSynchronizing,\r\n    getLusdFromFaucet,\r\n    setSimulatedMarketPrice,\r\n    resetSimulatedMarketPrice,\r\n    simulatedProtocolInfo,\r\n    hasFoundContracts: contracts.hasFoundContracts,\r\n    isBLusdApprovedWithBlusdAmm,\r\n    isLusdApprovedWithBlusdAmm,\r\n    isLusdApprovedWithAmmZapper,\r\n    isBLusdApprovedWithAmmZapper,\r\n    isBLusdLpApprovedWithAmmZapper,\r\n    isBLusdLpApprovedWithGauge,\r\n    inputToken,\r\n    isInputTokenApprovedWithBLusdAmm:\r\n      inputToken === BLusdAmmTokenIndex.BLUSD\r\n        ? isBLusdApprovedWithBlusdAmm\r\n        : isLusdApprovedWithBlusdAmm,\r\n    getExpectedSwapOutput,\r\n    getExpectedLpTokens,\r\n    getExpectedWithdrawal,\r\n    isBootstrapPeriodActive,\r\n    hasLoaded: protocolInfo !== undefined && bonds !== undefined,\r\n    addresses: contracts.addresses,\r\n    lpRewards\r\n  };\r\n\r\n  // @ts-ignore\r\n  window.__LIQUITY_BONDS__ = provider.current;\r\n\r\n  return <BondViewContext.Provider value={provider}>{children}</BondViewContext.Provider>;\r\n};\r\n","import { Flex, Text, Slider as ThemeUiSlider, Button } from \"theme-ui\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { toFloat } from \"./Bonds/utils\";\r\nimport { InfoIcon } from \"./InfoIcon\";\r\n\r\ntype SliderProps = {\r\n  name: string;\r\n  description?: string;\r\n  descriptionLink?: string;\r\n  value: Decimal;\r\n  type: string;\r\n  min: string;\r\n  max: string;\r\n  step?: number;\r\n  onSliderChange: (value: Decimal) => void;\r\n  onReset?: () => void;\r\n};\r\n\r\nexport const HorizontalSlider: React.FC<SliderProps> = ({\r\n  name,\r\n  description,\r\n  descriptionLink,\r\n  value,\r\n  type,\r\n  min,\r\n  max,\r\n  step = 0.01,\r\n  onSliderChange,\r\n  onReset\r\n}) => {\r\n  return (\r\n    <Flex mb={2} mx={1} sx={{ flexDirection: \"column\" }}>\r\n      <Flex\r\n        as=\"h4\"\r\n        sx={{\r\n          fontWeight: \"300\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\"\r\n        }}\r\n      >\r\n        {name}\r\n        {description && <InfoIcon size=\"xs\" tooltip={description} link={descriptionLink} />}\r\n        {onReset && (\r\n          <Button\r\n            variant=\"icon\"\r\n            sx={{\r\n              m: 0,\r\n              ml: \"24px\",\r\n              mt: 1,\r\n              border: \"none\",\r\n              fontSize: 1,\r\n              width: 0,\r\n              height: 0\r\n            }}\r\n            onClick={onReset}\r\n          >\r\n            Reset\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n\r\n      <Flex sx={{ flexGrow: 1, alignItems: \"center\" }}>\r\n        <Text mr={2} sx={{ fontSize: 1 }}>\r\n          {min}\r\n        </Text>\r\n        <ThemeUiSlider\r\n          value={toFloat(value)}\r\n          min={min}\r\n          max={max}\r\n          step={step}\r\n          onChange={e => onSliderChange(Decimal.from(e.target.value))}\r\n        ></ThemeUiSlider>\r\n        <Text ml={2} sx={{ fontSize: 1 }}>\r\n          {max}\r\n        </Text>\r\n      </Flex>\r\n      <Flex sx={{ fontWeight: \"400\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n        <Text>\r\n          {value.prettify(2)} {type}\r\n        </Text>\r\n      </Flex>\r\n    </Flex>\r\n  );\r\n};\r\n","/** @jsxImportSource theme-ui */\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Flex, Heading, Button, Card, Grid, Close, Image, Spinner } from \"theme-ui\";\r\nimport { Decimal } from \"@liquity/lib-base\";\r\nimport { EditableRow } from \"../../../Trove/Editor\";\r\nimport { Record } from \"../../Record\";\r\nimport { InfoIcon } from \"../../../InfoIcon\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { HorizontalTimeline, Label, SubLabel, UNKNOWN_DATE } from \"../../../HorizontalTimeline\";\r\nimport { EXAMPLE_NFT } from \"../../context/BondViewProvider\";\r\nimport * as l from \"../../lexicon\";\r\nimport { useWizard } from \"../../../Wizard/Context\";\r\nimport { Warning } from \"../../../Warning\";\r\nimport type { CreateBondPayload } from \"../../context/transitions\";\r\nimport {\r\n  dateWithoutHours,\r\n  getReturn,\r\n  percentify,\r\n  toFloat,\r\n  getRemainingRebondOrBreakEvenDays,\r\n  getBreakEvenPeriodInDays,\r\n  getRebondPeriodInDays,\r\n  getRebondOrBreakEvenTimeWithControllerAdjustment\r\n} from \"../../utils\";\r\nimport { HorizontalSlider } from \"../../../HorizontalSlider\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { InfiniteEstimate } from \"../InfiniteEstimation\";\r\nimport { LearnMoreLink } from \"../../../Tooltip\";\r\n\r\ntype DetailsProps = { onBack?: () => void };\r\n\r\nexport const Details: React.FC<DetailsProps> = ({ onBack }) => {\r\n  const {\r\n    dispatchEvent,\r\n    statuses,\r\n    lusdBalance,\r\n    simulatedProtocolInfo,\r\n    setSimulatedMarketPrice,\r\n    resetSimulatedMarketPrice,\r\n    protocolInfo\r\n  } = useBondView();\r\n  const { back } = useWizard();\r\n  const [deposit, setDeposit] = useState<Decimal>(lusdBalance ?? Decimal.ZERO);\r\n  const depositEditingState = useState<string>();\r\n  const isConfirming = useMemo(() => statuses.CREATE === \"PENDING\", [statuses.CREATE]);\r\n  const handleBack = back ?? onBack ?? (() => dispatchEvent(\"BACK_PRESSED\"));\r\n  const [isDepositEnough, setIsDepositEnough] = useState<boolean>(lusdBalance?.gte(100) ?? true);\r\n  const [doesDepositExceedBalance, setDoesDepositExceedBalance] = useState<boolean>(false);\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\", { deposit } as CreateBondPayload);\r\n  };\r\n\r\n  const handleDepositAmountChanged = (amount: Decimal) => {\r\n    const isDepositEnough = amount.gte(100);\r\n    const doesDepositExceedBalance = !!lusdBalance?.lt(amount);\r\n    setDeposit(amount);\r\n    setIsDepositEnough(isDepositEnough);\r\n    setDoesDepositExceedBalance(doesDepositExceedBalance);\r\n  };\r\n\r\n  useEffect(() => {\r\n    return () => resetSimulatedMarketPrice();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  if (protocolInfo === undefined || simulatedProtocolInfo === undefined || lusdBalance === undefined)\r\n    return null;\r\n\r\n  const hasMarketPremium = simulatedProtocolInfo.hasMarketPremium;\r\n  const depositMinusClaimBondFee = Decimal.ONE.sub(protocolInfo.claimBondFee).mul(deposit);\r\n  const rebondReturn = getReturn(\r\n    depositMinusClaimBondFee.mul(simulatedProtocolInfo.rebondAccrualFactor),\r\n    deposit,\r\n    simulatedProtocolInfo.simulatedMarketPrice\r\n  );\r\n  const rebondRoi = rebondReturn / toFloat(deposit) || 0;\r\n  const marketPriceMin = protocolInfo.floorPrice.mul(1.025).prettify(2); // Enough to display what happens below the 3% chicken in fee\r\n  const marketPriceMax = Decimal.max(\r\n    protocolInfo.marketPrice.mul(1.1),\r\n    protocolInfo.floorPrice.mul(1.5)\r\n  ).prettify(2);\r\n\r\n  const rebondDays = getRebondPeriodInDays(\r\n    simulatedProtocolInfo.alphaAccrualFactor,\r\n    simulatedProtocolInfo.marketPricePremium,\r\n    protocolInfo.claimBondFee\r\n  );\r\n\r\n  const controllerAdjustedRebondDays = getRemainingRebondOrBreakEvenDays(\r\n    Decimal.ZERO,\r\n    simulatedProtocolInfo.controllerTargetAge,\r\n    simulatedProtocolInfo.averageBondAge,\r\n    rebondDays\r\n  );\r\n\r\n  const breakEvenDays = getBreakEvenPeriodInDays(\r\n    simulatedProtocolInfo.alphaAccrualFactor,\r\n    simulatedProtocolInfo.marketPricePremium,\r\n    protocolInfo.claimBondFee\r\n  );\r\n\r\n  const breakEvenTime = breakEvenDays.eq(Decimal.INFINITY)\r\n    ? UNKNOWN_DATE\r\n    : getRebondOrBreakEvenTimeWithControllerAdjustment(\r\n        Decimal.ZERO,\r\n        simulatedProtocolInfo.controllerTargetAge,\r\n        simulatedProtocolInfo.averageBondAge,\r\n        breakEvenDays\r\n      );\r\n\r\n  const rebondTime = rebondDays.eq(Decimal.INFINITY)\r\n    ? UNKNOWN_DATE\r\n    : getRebondOrBreakEvenTimeWithControllerAdjustment(\r\n        Decimal.ZERO,\r\n        simulatedProtocolInfo.controllerTargetAge,\r\n        simulatedProtocolInfo.averageBondAge,\r\n        rebondDays\r\n      );\r\n\r\n  const breakEvenAccrual = hasMarketPremium\r\n    ? depositMinusClaimBondFee.mul(simulatedProtocolInfo.breakEvenAccrualFactor)\r\n    : Decimal.INFINITY;\r\n\r\n  const rebondAccrual = hasMarketPremium\r\n    ? depositMinusClaimBondFee.mul(simulatedProtocolInfo.rebondAccrualFactor)\r\n    : Decimal.INFINITY;\r\n\r\n  return (\r\n    <>\r\n      <Heading as=\"h2\" sx={{ pt: 1, pb: 3, px: 2 }}>\r\n        <Flex sx={{ justifyContent: \"center\" }}>Bond LUSD</Flex>\r\n        <Close\r\n          onClick={handleDismiss}\r\n          sx={{\r\n            position: \"absolute\",\r\n            right: \"24px\",\r\n            top: \"24px\"\r\n          }}\r\n        />\r\n      </Heading>\r\n\r\n      <Flex sx={{ justifyContent: \"center\", alignItems: \"center\" }}>\r\n        <Image\r\n          sx={{\r\n            height: 180,\r\n            border: \"10px solid white\",\r\n            borderRadius: \"14%\",\r\n            borderColor: \"white\"\r\n          }}\r\n          src={EXAMPLE_NFT}\r\n        />\r\n        <InfoIcon\r\n          tooltip={\r\n            <Card variant=\"tooltip\" sx={{ width: \"200px\" }}>\r\n              {l.BOND_NFT.description}\r\n            </Card>\r\n          }\r\n        />\r\n      </Flex>\r\n\r\n      <Flex my={4} sx={{ justifyContent: \"center\" }}>\r\n        <HorizontalTimeline\r\n          events={[\r\n            {\r\n              date: new Date(dateWithoutHours(Date.now())),\r\n              label: (\r\n                <>\r\n                  <Label subLabel=\"0 bLUSD\" description={l.BOND_CREATED.description}>\r\n                    {l.BOND_CREATED.term}\r\n                  </Label>\r\n                  <SubLabel>0 bLUSD</SubLabel>\r\n                </>\r\n              ),\r\n              isEndOfLife: true\r\n            },\r\n            {\r\n              date: breakEvenTime,\r\n              label: (\r\n                <>\r\n                  <Label description={l.BREAK_EVEN_TIME.description}>{l.BREAK_EVEN_TIME.term}</Label>\r\n                  <SubLabel>\r\n                    <InfiniteEstimate estimate={breakEvenAccrual}>\r\n                      {breakEvenAccrual.prettify(2)} bLUSD\r\n                    </InfiniteEstimate>\r\n                  </SubLabel>\r\n                </>\r\n              )\r\n            },\r\n            {\r\n              date: rebondTime,\r\n              label: (\r\n                <>\r\n                  <Label description={l.OPTIMUM_REBOND_TIME.description}>\r\n                    {l.OPTIMUM_REBOND_TIME.term}\r\n                  </Label>\r\n                  <SubLabel>\r\n                    <InfiniteEstimate estimate={rebondAccrual}>\r\n                      {rebondAccrual.prettify(2)} bLUSD\r\n                    </InfiniteEstimate>\r\n                  </SubLabel>\r\n                </>\r\n              )\r\n            }\r\n          ]}\r\n        />\r\n      </Flex>\r\n\r\n      <EditableRow\r\n        label={l.BOND_DEPOSIT.term}\r\n        inputId=\"bond-deposit-amount\"\r\n        amount={deposit.prettify(2)}\r\n        unit=\"LUSD\"\r\n        editingState={depositEditingState}\r\n        editedAmount={deposit.toString()}\r\n        setEditedAmount={amount => handleDepositAmountChanged(Decimal.from(amount))}\r\n        maxedOut={deposit.eq(lusdBalance)}\r\n        maxAmount={lusdBalance.toString()}\r\n      />\r\n\r\n      <Grid sx={{ my: 1, mb: 3, justifyItems: \"center\", pl: 2 }} gap=\"20px\" columns={3}>\r\n        <Record\r\n          lexicon={l.REBOND_RETURN}\r\n          value={hasMarketPremium ? rebondReturn.toFixed(2) : \"N/A\"}\r\n          type=\"LUSD\"\r\n        />\r\n\r\n        <Record\r\n          lexicon={l.REBOND_TIME_ROI}\r\n          value={hasMarketPremium ? percentify(rebondRoi).toFixed(2) + \"%\" : \"N/A\"}\r\n          type=\"\"\r\n        />\r\n\r\n        <Record\r\n          lexicon={l.OPTIMUM_APY}\r\n          value={\r\n            hasMarketPremium\r\n              ? percentify(rebondRoi * (365 / controllerAdjustedRebondDays)).toFixed(2) + \"%\"\r\n              : \"N/A\"\r\n          }\r\n          type=\"\"\r\n        />\r\n      </Grid>\r\n\r\n      <HorizontalSlider\r\n        name={\"Simulate market price\"}\r\n        description={`The market price of bLUSD impacts how long it will take to rebond and break even. The actual times may be overestimated as the simulator is based on the current bLUSD accrual rate, not taking into account potential rate adjustments.`}\r\n        descriptionLink=\"https://docs.chickenbonds.org/faq/economic-design#_44lrt4qpho3a\"\r\n        value={simulatedProtocolInfo.simulatedMarketPrice}\r\n        min={marketPriceMin}\r\n        max={marketPriceMax}\r\n        type=\"LUSD\"\r\n        onSliderChange={value => setSimulatedMarketPrice(value)}\r\n        onReset={() => resetSimulatedMarketPrice()}\r\n      />\r\n\r\n      {statuses.CREATE === \"FAILED\" && <Warning>Failed to create bond. Please try again.</Warning>}\r\n\r\n      {!protocolInfo.hasMarketPremium && (\r\n        <Warning>\r\n          When the bLUSD market price is less than 3% above the floor price, it's not profitable to\r\n          bond. Buying bLUSD from the market currently generates a higher return than bonding.{\" \"}\r\n          <LearnMoreLink link={l.INFINITE_ESTIMATION.link} />\r\n        </Warning>\r\n      )}\r\n\r\n      {!isDepositEnough && <ErrorDescription>The minimum bond amount is 100 LUSD.</ErrorDescription>}\r\n      {doesDepositExceedBalance && (\r\n        <ErrorDescription>\r\n          Amount exceeds your balance by <Amount>{deposit.sub(lusdBalance).prettify(2)} LUSD</Amount>\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      <Flex pb={2} sx={{ fontSize: \"15.5px\", justifyContent: \"center\", fontStyle: \"italic\" }}>\r\n        You can cancel your bond at any time to recover your deposited LUSD\r\n      </Flex>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBack} disabled={isConfirming}>\r\n          Back\r\n        </Button>\r\n        <Button onClick={handleConfirmPressed} disabled={isConfirming}>\r\n          {!isConfirming && <>Confirm</>}\r\n          {isConfirming && <Spinner size=\"28px\" sx={{ color: \"white\" }} />}\r\n        </Button>\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","/** @jsxImportSource theme-ui */\r\nimport React, { useRef } from \"react\";\r\nimport {\r\n  Box,\r\n  Button,\r\n  Checkbox,\r\n  Close,\r\n  Flex,\r\n  Heading,\r\n  Label,\r\n  Paragraph,\r\n  Link,\r\n  Image\r\n} from \"theme-ui\";\r\nimport { useWizard } from \"../../../Wizard/Context\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { Details } from \"./Details\";\r\n\r\nconst InformationContainer: React.FC = ({ children }) => {\r\n  const { dispatchEvent } = useBondView();\r\n  const handleDismiss = () => dispatchEvent(\"ABORT_PRESSED\");\r\n\r\n  return (\r\n    <>\r\n      <Heading as=\"h2\" sx={{ pt: 2, pb: 3, px: 2 }}>\r\n        <Flex sx={{ justifyContent: \"center\" }}>Bond LUSD</Flex>\r\n        <Close\r\n          onClick={handleDismiss}\r\n          sx={{\r\n            position: \"absolute\",\r\n            right: \"24px\",\r\n            top: \"24px\"\r\n          }}\r\n        />\r\n      </Heading>\r\n\r\n      <Flex sx={{ justifyContent: \"center\" }}>\r\n        <Image src=\"./bonds/bond-info.png\" sx={{ height: \"200px\" }} />\r\n      </Flex>\r\n\r\n      {children}\r\n    </>\r\n  );\r\n};\r\n\r\nexport const Information: React.FC = () => {\r\n  const hideMessageRef = useRef<HTMLInputElement>(null);\r\n\r\n  const { go, back } = useWizard();\r\n\r\n  const handleUnderstandPressed = () => {\r\n    if (hideMessageRef?.current?.checked) {\r\n      window.localStorage.setItem(\"LIQUITY.BOND_FAQ.VISISBLE\", \"true\");\r\n    }\r\n    go && go(Details);\r\n  };\r\n\r\n  return (\r\n    <InformationContainer>\r\n      <Box sx={{ p: [2, 3] }}>\r\n        <Paragraph sx={{ mt: 2 }}>\r\n          Bonds accrue a virtual balance of boosted LUSD tokens (bLUSD) over time. At any time, the\r\n          bonder may choose to claim their bLUSD in exchange for their LUSD, or cancel their bond to\r\n          recover their deposited LUSD.\r\n        </Paragraph>\r\n        <Paragraph sx={{ mt: 3 }}>\r\n          Please visit the&nbsp;\r\n          <Link href=\"https://docs.chickenbonds.org/\" target=\"_blank\">\r\n            docs\r\n          </Link>\r\n          &nbsp;to understand how bonds work.\r\n        </Paragraph>\r\n      </Box>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Flex sx={{ justifyContent: \"flex-end\", flexDirection: \"column\" }}>\r\n          <Label sx={{ fontSize: \"14px\" }}>\r\n            <Flex>\r\n              <Checkbox ref={hideMessageRef} />\r\n              Don't show this message again\r\n            </Flex>\r\n          </Label>\r\n        </Flex>\r\n        <Button variant=\"cancel\" onClick={back ? back : () => {}}>\r\n          Back\r\n        </Button>\r\n        <Button onClick={handleUnderstandPressed}>Continue</Button>\r\n      </Flex>\r\n    </InformationContainer>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { ModalWizard } from \"../../../ModalWizard\";\r\nimport { ReactModal } from \"../../../ReactModal\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { Information } from \"./Information\";\r\nimport { Details } from \"./Details\";\r\n\r\nexport const Creating: React.FC = () => {\r\n  const { dispatchEvent } = useBondView();\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n  const ignoreInformation = window.localStorage.getItem(\"LIQUITY.BOND_FAQ.VISISBLE\") === \"true\";\r\n\r\n  return !ignoreInformation ? (\r\n    <ModalWizard onDismiss={handleDismiss}>\r\n      <Information />\r\n      <Details />\r\n    </ModalWizard>\r\n  ) : (\r\n    <ReactModal onDismiss={handleDismiss}>\r\n      <Details />\r\n    </ReactModal>\r\n  );\r\n};\r\n","/** @jsxImportSource theme-ui */\r\n\r\nimport { Decimal, Percent } from \"@liquity/lib-base\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { Flex, Button, Spinner, Heading, Close, Box, Label, Radio, Input, Link } from \"theme-ui\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { Placeholder } from \"../../../Placeholder\";\r\nimport {\r\n  DisabledEditableAmounts,\r\n  DisabledEditableRow,\r\n  EditableRow,\r\n  StaticAmounts,\r\n  StaticRow\r\n} from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { BLusdAmmTokenIndex } from \"../../context/transitions\";\r\n\r\nconst tokenSymbol: Record<BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD, string> = {\r\n  [BLusdAmmTokenIndex.BLUSD]: \"bLUSD\",\r\n  [BLusdAmmTokenIndex.LUSD]: \"LUSD\"\r\n};\r\n\r\nconst outputToken: Record<\r\n  BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD,\r\n  BLusdAmmTokenIndex.BLUSD | BLusdAmmTokenIndex.LUSD\r\n> = {\r\n  [BLusdAmmTokenIndex.BLUSD]: BLusdAmmTokenIndex.LUSD,\r\n  [BLusdAmmTokenIndex.LUSD]: BLusdAmmTokenIndex.BLUSD\r\n};\r\n\r\nconst marginalAmount = Decimal.ONE.div(1000);\r\n\r\ntype SlippageTolerance = \"half\" | \"one\" | \"custom\";\r\n\r\nconst checkSlippageTolerance = (value: string): SlippageTolerance => {\r\n  if (value === \"half\" || value === \"one\" || value === \"custom\") {\r\n    return value;\r\n  }\r\n\r\n  throw new Error(`invalid slippage tolerance choice \"${value}\"`);\r\n};\r\n\r\nexport const SwapPane: React.FC = () => {\r\n  const {\r\n    dispatchEvent,\r\n    statuses,\r\n    inputToken,\r\n    lusdBalance,\r\n    bLusdBalance,\r\n    isInputTokenApprovedWithBLusdAmm,\r\n    bLusdAmmBLusdBalance,\r\n    bLusdAmmLusdBalance,\r\n    getExpectedSwapOutput\r\n  } = useBondView();\r\n  const editingState = useState<string>();\r\n  const inputTokenBalance =\r\n    (inputToken === BLusdAmmTokenIndex.BLUSD ? bLusdBalance : lusdBalance) ?? Decimal.ZERO;\r\n  const [inputAmount, setInputAmount] = useState<Decimal>(Decimal.ZERO);\r\n  const [outputAmount, setOutputAmount] = useState<Decimal>();\r\n  const [exchangeRate, setExchangeRate] = useState<Decimal>();\r\n  const [priceImpact, setPriceImpact] = useState<Decimal>();\r\n  const [slippageToleranceChoice, setSlippageToleranceChoice] = useState<SlippageTolerance>(\"half\");\r\n  const [customSlippageTolerance, setCustomSlippageTolerance] = useState<Decimal>();\r\n  const [customSlippageToleranceFocus, setCustomSlippageToleranceFocus] = useState(false);\r\n  const customSlippageToleranceRef = useRef<HTMLInputElement>(null);\r\n\r\n  const priceImpactPct = priceImpact && new Percent(priceImpact);\r\n  const isApprovePending = statuses.APPROVE_AMM === \"PENDING\";\r\n  const isSwapPending = statuses.SWAP === \"PENDING\";\r\n  const isBalanceInsufficient = inputAmount.gt(inputTokenBalance);\r\n  const isSlippageToleranceInvalid =\r\n    slippageToleranceChoice === \"custom\" &&\r\n    (!customSlippageTolerance ||\r\n      customSlippageTolerance.lt(0.001) ||\r\n      customSlippageTolerance.gt(Decimal.ONE));\r\n  const isSlippageToleranceHigh = customSlippageTolerance?.gt(0.05);\r\n\r\n  // Used in dependency list of effect to recalculate output amount in case of pool changes\r\n  const poolState = `${bLusdAmmBLusdBalance},${bLusdAmmLusdBalance}`;\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n\r\n  const handleApprovePressed = () => {\r\n    dispatchEvent(\"APPROVE_PRESSED\");\r\n  };\r\n\r\n  const handleConfirmPressed = () => {\r\n    if (!outputAmount) {\r\n      return;\r\n    }\r\n\r\n    const slippageTolerance =\r\n      slippageToleranceChoice === \"half\"\r\n        ? Decimal.from(0.005)\r\n        : slippageToleranceChoice === \"one\"\r\n        ? Decimal.from(0.01)\r\n        : customSlippageTolerance;\r\n\r\n    if (!slippageTolerance || isSlippageToleranceInvalid) {\r\n      return;\r\n    }\r\n\r\n    const minOutputFactor = Decimal.ONE.sub(slippageTolerance);\r\n\r\n    dispatchEvent(\"CONFIRM_PRESSED\", {\r\n      inputAmount,\r\n      minOutputAmount: outputAmount.mul(minOutputFactor)\r\n    });\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  const handleSlippageToleranceChange = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n    setSlippageToleranceChoice(checkSlippageTolerance(e.target.value));\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const timeoutId = setTimeout(async () => {\r\n      setOutputAmount(undefined);\r\n      setExchangeRate(undefined);\r\n      setPriceImpact(undefined);\r\n\r\n      try {\r\n        const [marginalOutput, outputAmount] = await Promise.all([\r\n          getExpectedSwapOutput(inputToken, marginalAmount),\r\n          inputAmount.nonZero && getExpectedSwapOutput(inputToken, inputAmount)\r\n        ]);\r\n\r\n        if (cancelled) return;\r\n\r\n        const marginalExchangeRate = marginalOutput.div(marginalAmount);\r\n        const exchangeRate = outputAmount?.div(inputAmount);\r\n        const priceImpact = exchangeRate?.lte(marginalExchangeRate)\r\n          ? marginalExchangeRate.sub(exchangeRate).div(marginalExchangeRate)\r\n          : Decimal.ZERO;\r\n\r\n        setOutputAmount(outputAmount ?? Decimal.ZERO);\r\n        setExchangeRate(exchangeRate ?? marginalExchangeRate);\r\n        setPriceImpact(priceImpact);\r\n      } catch (error) {\r\n        console.error(\"getExpectedSwapOutput() failed\");\r\n        console.log(error);\r\n      }\r\n    }, 200);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      cancelled = true;\r\n    };\r\n  }, [inputToken, inputAmount, getExpectedSwapOutput, poolState]);\r\n\r\n  return (\r\n    <>\r\n      <Heading as=\"h2\" sx={{ pt: 2, pb: 3, px: 2 }}>\r\n        <Flex sx={{ justifyContent: \"center\" }}>\r\n          {inputToken === BLusdAmmTokenIndex.BLUSD ? <>Sell</> : <>Buy</>} bLUSD\r\n        </Flex>\r\n        <Close\r\n          onClick={handleDismiss}\r\n          sx={{\r\n            position: \"absolute\",\r\n            right: \"24px\",\r\n            top: \"24px\"\r\n          }}\r\n        />\r\n      </Heading>\r\n\r\n      <EditableRow\r\n        label=\"Sell\"\r\n        inputId=\"swap-input-amount\"\r\n        amount={inputAmount.prettify(2)}\r\n        unit={tokenSymbol[inputToken]}\r\n        editingState={editingState}\r\n        editedAmount={inputAmount.toString()}\r\n        setEditedAmount={amount => setInputAmount(Decimal.from(amount))}\r\n        maxAmount={inputTokenBalance.toString()}\r\n        maxedOut={inputAmount.eq(inputTokenBalance)}\r\n      />\r\n\r\n      <Flex sx={{ justifyContent: \"center\", mb: 3 }}>\r\n        <Icon name=\"arrow-down\" size=\"lg\" />\r\n      </Flex>\r\n\r\n      <DisabledEditableRow label=\"Buy\">\r\n        {outputAmount ? (\r\n          <DisabledEditableAmounts\r\n            inputId=\"swap-output-amount\"\r\n            amount={outputAmount.prettify(2)}\r\n            unit={tokenSymbol[outputToken[inputToken]]}\r\n          />\r\n        ) : (\r\n          <DisabledEditableAmounts inputId=\"swap-output-amount\">\r\n            <Box sx={{ width: \"160px\", height: \"20px\", mt: \"10px\", mb: \"6px\" }}>\r\n              <Placeholder />\r\n            </Box>\r\n          </DisabledEditableAmounts>\r\n        )}\r\n      </DisabledEditableRow>\r\n\r\n      <StaticRow label=\"Exchange rate\">\r\n        {exchangeRate ? (\r\n          <StaticAmounts\r\n            inputId=\"swap-exchange-rate\"\r\n            amount={exchangeRate.prettify(4)}\r\n            unit={`${tokenSymbol[inputToken]}:${tokenSymbol[outputToken[inputToken]]}`}\r\n          />\r\n        ) : (\r\n          <StaticAmounts inputId=\"swap-exchange-rate\">\r\n            <Box sx={{ width: \"180px\", height: \"16px\", mt: \"9px\", mb: \"5px\" }}>\r\n              <Placeholder />\r\n            </Box>\r\n          </StaticAmounts>\r\n        )}\r\n      </StaticRow>\r\n\r\n      <StaticRow label=\"Price impact\">\r\n        {priceImpact && priceImpactPct ? (\r\n          <StaticAmounts\r\n            inputId=\"swap-price-impact\"\r\n            amount={priceImpactPct.toString(4)}\r\n            color={priceImpact.gte(0.005) ? \"danger\" : undefined}\r\n          />\r\n        ) : (\r\n          <StaticAmounts inputId=\"swap-price-impact\">\r\n            <Box sx={{ width: \"80px\", height: \"16px\", mt: \"9px\", mb: \"5px\" }}>\r\n              <Placeholder />\r\n            </Box>\r\n          </StaticAmounts>\r\n        )}\r\n      </StaticRow>\r\n\r\n      <details>\r\n        <summary sx={{ cursor: \"pointer\", mx: 2, mb: 2 }}>Slippage tolerance</summary>\r\n\r\n        <Flex sx={{ alignItems: \"center\", mx: 4, mb: 3 }}>\r\n          <Label variant=\"radioLabel\">\r\n            <Radio\r\n              name=\"swap-slippage-tolerance\"\r\n              value=\"half\"\r\n              checked={slippageToleranceChoice === \"half\"}\r\n              onChange={handleSlippageToleranceChange}\r\n            />\r\n            0.5%\r\n          </Label>\r\n\r\n          <Label variant=\"radioLabel\">\r\n            <Radio\r\n              name=\"swap-slippage-tolerance\"\r\n              value=\"one\"\r\n              checked={slippageToleranceChoice === \"one\"}\r\n              onChange={handleSlippageToleranceChange}\r\n            />\r\n            1%\r\n          </Label>\r\n\r\n          <Label variant=\"radioLabel\" sx={{ alignItems: \"center\" }}>\r\n            <Radio\r\n              name=\"swap-slippage-tolerance\"\r\n              value=\"custom\"\r\n              checked={slippageToleranceChoice === \"custom\"}\r\n              onChange={handleSlippageToleranceChange}\r\n            />\r\n            <Input\r\n              ref={customSlippageToleranceRef}\r\n              sx={{\r\n                py: \"6px\",\r\n                px: \"10px\",\r\n                width: \"110px\",\r\n                fontSize: 2,\r\n                ...(!customSlippageToleranceFocus\r\n                  ? isSlippageToleranceInvalid\r\n                    ? { bg: \"invalid\", borderColor: \"danger\" }\r\n                    : isSlippageToleranceHigh\r\n                    ? { borderColor: \"warning\" }\r\n                    : {}\r\n                  : {})\r\n              }}\r\n              type=\"number\"\r\n              min={0}\r\n              max={100}\r\n              step={0.1}\r\n              placeholder=\"Custom\"\r\n              onFocus={() => {\r\n                setSlippageToleranceChoice(\"custom\");\r\n                setCustomSlippageToleranceFocus(true);\r\n              }}\r\n              onKeyDown={e => {\r\n                if (e.key === \"Enter\") {\r\n                  customSlippageToleranceRef.current?.blur();\r\n                }\r\n              }}\r\n              onBlur={() => setCustomSlippageToleranceFocus(false)}\r\n              onChange={e => {\r\n                try {\r\n                  setCustomSlippageTolerance(Decimal.from(e.target.value).div(100));\r\n                } catch {\r\n                  setCustomSlippageTolerance(undefined);\r\n                }\r\n              }}\r\n            />\r\n            &nbsp;%\r\n          </Label>\r\n        </Flex>\r\n      </details>\r\n\r\n      {isBalanceInsufficient && (\r\n        <ErrorDescription>\r\n          Amount exceeds your balance by{\" \"}\r\n          <Amount>\r\n            {inputAmount.sub(inputTokenBalance).prettify(2)} {tokenSymbol[inputToken]}\r\n          </Amount>\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      {(bLusdAmmBLusdBalance?.isZero || bLusdAmmLusdBalance?.isZero) && (\r\n        <ErrorDescription>No liquidity in pool yet. Swap unavailable.</ErrorDescription>\r\n      )}\r\n\r\n      <Flex pb={2} sx={{ fontSize: \"15.5px\", justifyContent: \"center\", fontStyle: \"italic\" }}>\r\n        Your swap is performed directly in&nbsp;\r\n        <Link href=\"https://curve.fi/factory-crypto/134\" target=\"_blank\">\r\n          Curve\r\n        </Link>\r\n        &nbsp;protocol.\r\n      </Flex>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button\r\n          variant=\"cancel\"\r\n          onClick={handleBackPressed}\r\n          disabled={isApprovePending || isSwapPending}\r\n        >\r\n          Back\r\n        </Button>\r\n\r\n        {isInputTokenApprovedWithBLusdAmm ? (\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={handleConfirmPressed}\r\n            disabled={\r\n              inputAmount.isZero ||\r\n              !outputAmount ||\r\n              isBalanceInsufficient ||\r\n              isSlippageToleranceInvalid ||\r\n              isSwapPending\r\n            }\r\n          >\r\n            {isSwapPending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Confirm</>}\r\n          </Button>\r\n        ) : (\r\n          <Button variant=\"primary\" onClick={handleApprovePressed} disabled={isApprovePending}>\r\n            {isApprovePending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Approve</>}\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { ReactModal } from \"../../../ReactModal\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { SwapPane } from \"./SwapPane\";\r\n\r\nexport const Swapping: React.FC = () => {\r\n  const { dispatchEvent } = useBondView();\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n\r\n  return (\r\n    <ReactModal onDismiss={handleDismiss}>\r\n      <SwapPane />\r\n    </ReactModal>\r\n  );\r\n};\r\n","import { Text } from \"theme-ui\";\r\n\r\nexport const PoolBalance: React.FC<{ symbol: string }> = ({ symbol, children }) => (\r\n  <>\r\n    <Text sx={{ fontWeight: \"medium\" }}>{children}</Text>\r\n    &nbsp;\r\n    <Text sx={{ fontWeight: \"light\", opacity: 0.8 }}>{symbol}</Text>\r\n  </>\r\n);\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport { Text, Box, Flex } from \"theme-ui\";\r\nimport { StaticRow, StaticAmounts } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { PoolBalance } from \"./PoolBalance\";\r\n\r\nexport const PoolDetails: React.FC = () => {\r\n  const { lpTokenSupply, bLusdAmmBLusdBalance, bLusdAmmLusdBalance, protocolInfo } = useBondView();\r\n  const poolBalanceRatio =\r\n    bLusdAmmBLusdBalance && bLusdAmmLusdBalance\r\n      ? bLusdAmmLusdBalance.div(bLusdAmmBLusdBalance)\r\n      : Decimal.ONE;\r\n\r\n  return (\r\n    <details>\r\n      <Box as=\"summary\" sx={{ cursor: \"pointer\", mb: 3, ml: 2 }}>\r\n        Pool details\r\n      </Box>\r\n\r\n      <Box sx={{ mt: 3 }}>\r\n        <StaticRow label=\"Pool balance\">\r\n          <StaticAmounts\r\n            sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}\r\n            inputId=\"deposit-pool-balance\"\r\n          >\r\n            <PoolBalance symbol=\"bLUSD\">\r\n              {(bLusdAmmBLusdBalance ?? Decimal.ZERO).prettify(2)}\r\n            </PoolBalance>\r\n            <Text sx={{ fontWeight: \"light\", mx: \"12px\" }}>+</Text>\r\n            <PoolBalance symbol=\"LUSD-3CRV\">\r\n              {(bLusdAmmLusdBalance ?? Decimal.ZERO).prettify(2)}\r\n            </PoolBalance>\r\n          </StaticAmounts>\r\n        </StaticRow>\r\n\r\n        <StaticRow label=\"Pool balance ratio\">\r\n          <StaticAmounts\r\n            sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}\r\n            inputId=\"deposit-pool-ratio\"\r\n          >\r\n            <PoolBalance symbol=\"bLUSD\">1</PoolBalance>\r\n            <Text sx={{ fontWeight: \"thin\", mx: \"6px\" }}>:</Text>\r\n            <PoolBalance symbol=\"LUSD-3CRV\">{poolBalanceRatio.prettify(2)}</PoolBalance>\r\n          </StaticAmounts>\r\n        </StaticRow>\r\n\r\n        <Flex>\r\n          <StaticRow\r\n            label=\"LP token supply\"\r\n            inputId=\"deposit-mint-lp-tokens\"\r\n            amount={(lpTokenSupply ?? Decimal.ZERO).prettify(2)}\r\n          />\r\n\r\n          <StaticRow label=\"bLUSD price\">\r\n            <StaticAmounts sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}>\r\n              <PoolBalance symbol=\"LUSD\">\r\n                {(protocolInfo?.marketPrice ?? Decimal.INFINITY).prettify(2)}\r\n              </PoolBalance>{\" \"}\r\n            </StaticAmounts>\r\n          </StaticRow>\r\n\r\n          <StaticRow label=\"bLUSD LP APR\">\r\n            <StaticAmounts sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}>\r\n              <PoolBalance symbol=\"%\">\r\n                {(protocolInfo?.bLusdLpApr ?? Decimal.INFINITY).prettify(2)}\r\n              </PoolBalance>{\" \"}\r\n            </StaticAmounts>\r\n          </StaticRow>\r\n        </Flex>\r\n      </Box>\r\n    </details>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { Flex, Button, Spinner, Checkbox, Label, Card, Text } from \"theme-ui\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { InfoIcon } from \"../../../InfoIcon\";\r\nimport { DisabledEditableRow, EditableRow } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { BLusdAmmTokenIndex } from \"../../context/transitions\";\r\nimport { PoolDetails } from \"./PoolDetails\";\r\nimport type { Address, ApprovePressedPayload } from \"../../context/transitions\";\r\n\r\nexport const DepositPane: React.FC = () => {\r\n  const {\r\n    dispatchEvent,\r\n    statuses,\r\n    lusdBalance,\r\n    bLusdBalance,\r\n    isBLusdApprovedWithAmmZapper,\r\n    isLusdApprovedWithAmmZapper,\r\n    getExpectedLpTokens,\r\n    addresses,\r\n    bLusdAmmBLusdBalance,\r\n    bLusdAmmLusdBalance\r\n  } = useBondView();\r\n\r\n  const editingState = useState<string>();\r\n  const [bLusdAmount, setBLusdAmount] = useState<Decimal>(Decimal.ZERO);\r\n  const [lusdAmount, setLusdAmount] = useState<Decimal>(Decimal.ZERO);\r\n  const [lpTokens, setLpTokens] = useState<Decimal>(Decimal.ZERO);\r\n  const [shouldStakeInGauge, setShouldStakeInGauge] = useState(true);\r\n  const [shouldDepositBalanced, setShouldDepositBalanced] = useState(true);\r\n\r\n  const coalescedBLusdBalance = bLusdBalance ?? Decimal.ZERO;\r\n  const coalescedLusdBalance = lusdBalance ?? Decimal.ZERO;\r\n\r\n  const isApprovePending = statuses.APPROVE_SPENDER === \"PENDING\";\r\n  const isManageLiquidityPending = statuses.MANAGE_LIQUIDITY === \"PENDING\";\r\n  const isBLusdBalanceInsufficient = bLusdAmount.gt(coalescedBLusdBalance);\r\n  const isLusdBalanceInsufficient = lusdAmount.gt(coalescedLusdBalance);\r\n  const isAnyBalanceInsufficient = isBLusdBalanceInsufficient || isLusdBalanceInsufficient;\r\n\r\n  const isDepositingLusd = lusdAmount.gt(0);\r\n  const isDepositingBLusd = bLusdAmount.gt(0);\r\n\r\n  const zapperNeedsLusdApproval = isDepositingLusd && !isLusdApprovedWithAmmZapper;\r\n  const zapperNeedsBLusdApproval = isDepositingBLusd && !isBLusdApprovedWithAmmZapper;\r\n  const isApprovalNeeded = zapperNeedsLusdApproval || zapperNeedsBLusdApproval;\r\n\r\n  const poolBalanceRatio =\r\n    bLusdAmmBLusdBalance && bLusdAmmLusdBalance\r\n      ? bLusdAmmLusdBalance.div(bLusdAmmBLusdBalance)\r\n      : Decimal.ONE;\r\n\r\n  const handleApprovePressed = () => {\r\n    const tokensNeedingApproval = new Map<BLusdAmmTokenIndex, Address>();\r\n    if (zapperNeedsLusdApproval) {\r\n      tokensNeedingApproval.set(BLusdAmmTokenIndex.LUSD, addresses.BLUSD_LP_ZAP_ADDRESS);\r\n    }\r\n    if (zapperNeedsBLusdApproval) {\r\n      tokensNeedingApproval.set(BLusdAmmTokenIndex.BLUSD, addresses.BLUSD_LP_ZAP_ADDRESS);\r\n    }\r\n\r\n    dispatchEvent(\"APPROVE_PRESSED\", { tokensNeedingApproval } as ApprovePressedPayload);\r\n  };\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\", {\r\n      action: \"addLiquidity\",\r\n      bLusdAmount,\r\n      lusdAmount,\r\n      minLpTokens: lpTokens,\r\n      shouldStakeInGauge\r\n    });\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  const handleToggleShouldStakeInGauge = () => {\r\n    setShouldStakeInGauge(toggle => !toggle);\r\n  };\r\n\r\n  const handleToggleShouldDepositBalanced = () => {\r\n    if (!shouldDepositBalanced) {\r\n      setBLusdAmount(Decimal.ZERO);\r\n      setLusdAmount(Decimal.ZERO);\r\n    }\r\n    setShouldDepositBalanced(toggle => !toggle);\r\n  };\r\n\r\n  const handleSetAmount = (token: \"bLUSD\" | \"LUSD\", amount: Decimal) => {\r\n    if (shouldDepositBalanced) {\r\n      if (token === \"bLUSD\") setLusdAmount(poolBalanceRatio.mul(amount));\r\n      else if (token === \"LUSD\") setBLusdAmount(amount.div(poolBalanceRatio));\r\n    }\r\n\r\n    if (token === \"bLUSD\") setBLusdAmount(amount);\r\n    else if (token === \"LUSD\") setLusdAmount(amount);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (bLusdAmount.isZero && lusdAmount.isZero) {\r\n      setLpTokens(Decimal.ZERO);\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n\r\n    const timeoutId = setTimeout(async () => {\r\n      try {\r\n        const expectedLpTokens = await getExpectedLpTokens(bLusdAmount, lusdAmount);\r\n        if (cancelled) return;\r\n        setLpTokens(expectedLpTokens);\r\n      } catch (error) {\r\n        console.error(\"getExpectedLpTokens() failed\");\r\n        console.log(error);\r\n      }\r\n    }, 200);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      cancelled = true;\r\n    };\r\n  }, [bLusdAmount, lusdAmount, getExpectedLpTokens]);\r\n\r\n  return (\r\n    <>\r\n      <EditableRow\r\n        label=\"bLUSD amount\"\r\n        inputId=\"deposit-blusd\"\r\n        amount={bLusdAmount.prettify(2)}\r\n        unit=\"bLUSD\"\r\n        editingState={editingState}\r\n        editedAmount={bLusdAmount.toString()}\r\n        setEditedAmount={amount => handleSetAmount(\"bLUSD\", Decimal.from(amount))}\r\n        maxAmount={coalescedBLusdBalance.toString()}\r\n        maxedOut={bLusdAmount.eq(coalescedBLusdBalance)}\r\n      />\r\n\r\n      <EditableRow\r\n        label=\"LUSD amount\"\r\n        inputId=\"deposit-lusd\"\r\n        amount={lusdAmount.prettify(2)}\r\n        unit=\"LUSD\"\r\n        editingState={editingState}\r\n        editedAmount={lusdAmount.toString()}\r\n        setEditedAmount={amount => handleSetAmount(\"LUSD\", Decimal.from(amount))}\r\n        maxAmount={coalescedLusdBalance.toString()}\r\n        maxedOut={lusdAmount.eq(coalescedLusdBalance)}\r\n      />\r\n\r\n      <Flex sx={{ justifyContent: \"center\", mb: 3 }}>\r\n        <Icon name=\"arrow-down\" size=\"lg\" />\r\n      </Flex>\r\n\r\n      <DisabledEditableRow\r\n        label=\"Mint LP tokens\"\r\n        inputId=\"deposit-mint-lp-tokens\"\r\n        amount={lpTokens.prettify(2)}\r\n      />\r\n\r\n      <Label>\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          <Checkbox checked={shouldDepositBalanced} onChange={handleToggleShouldDepositBalanced} />\r\n          <Text sx={{ fontWeight: 300, fontSize: \"16px\" }}>Deposit tokens in a balanced ratio</Text>\r\n          <InfoIcon\r\n            placement=\"right\"\r\n            size=\"xs\"\r\n            tooltip={\r\n              <Card variant=\"tooltip\">\r\n                Tick this box to deposit bLUSD and LUSD-3CRV in the pool's current liquidity ratio.\r\n                Current ratio = 1 bLUSD : {poolBalanceRatio.prettify(2)} LUSD.\r\n              </Card>\r\n            }\r\n          />\r\n        </Flex>\r\n      </Label>\r\n\r\n      <Label mb={2}>\r\n        <Flex sx={{ alignItems: \"center\" }}>\r\n          <Checkbox checked={shouldStakeInGauge} onChange={handleToggleShouldStakeInGauge} />\r\n          <Text sx={{ fontWeight: 300, fontSize: \"16px\" }}>Stake LP tokens in Curve gauge</Text>\r\n          <InfoIcon\r\n            placement=\"right\"\r\n            size=\"xs\"\r\n            tooltip={\r\n              <Card variant=\"tooltip\">\r\n                Tick this box to have your Curve LP tokens staked in the bLUSD Curve gauge. Staked LP\r\n                tokens will earn protocol fees and Curve rewards.\r\n              </Card>\r\n            }\r\n          />\r\n        </Flex>\r\n      </Label>\r\n\r\n      <PoolDetails />\r\n\r\n      {isAnyBalanceInsufficient && (\r\n        <ErrorDescription>\r\n          Deposit exceeds your balance by{\" \"}\r\n          {isBLusdBalanceInsufficient && (\r\n            <>\r\n              <Amount>{bLusdAmount.sub(coalescedBLusdBalance).prettify(2)} bLUSD</Amount>\r\n              {isLusdBalanceInsufficient && <> and </>}\r\n            </>\r\n          )}\r\n          {isLusdBalanceInsufficient && (\r\n            <Amount>{lusdAmount.sub(coalescedLusdBalance).prettify(2)} LUSD</Amount>\r\n          )}\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button\r\n          variant=\"cancel\"\r\n          onClick={handleBackPressed}\r\n          disabled={isApprovePending || isManageLiquidityPending}\r\n        >\r\n          Back\r\n        </Button>\r\n\r\n        {!isApprovalNeeded ? (\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={handleConfirmPressed}\r\n            disabled={\r\n              (bLusdAmount.isZero && lusdAmount.isZero) ||\r\n              isAnyBalanceInsufficient ||\r\n              isManageLiquidityPending\r\n            }\r\n          >\r\n            {isManageLiquidityPending ? (\r\n              <Spinner size=\"28px\" sx={{ color: \"white\" }} />\r\n            ) : (\r\n              <>Confirm</>\r\n            )}\r\n          </Button>\r\n        ) : (\r\n          <Button variant=\"primary\" onClick={handleApprovePressed} disabled={isApprovePending}>\r\n            {isApprovePending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Approve</>}\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { Flex, Button, Spinner, Label, Radio, Text } from \"theme-ui\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { Icon } from \"../../../Icon\";\r\nimport { DisabledEditableAmounts, DisabledEditableRow, EditableRow } from \"../../../Trove/Editor\";\r\nimport { Warning } from \"../../../Warning\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { ApprovePressedPayload, BLusdAmmTokenIndex } from \"../../context/transitions\";\r\nimport { PoolDetails } from \"./PoolDetails\";\r\n\r\nconst tokenSymbol = new Map([\r\n  [BLusdAmmTokenIndex.BLUSD, \"bLUSD\"],\r\n  [BLusdAmmTokenIndex.LUSD, \"LUSD\"]\r\n]);\r\n\r\nconst WithdrawnAmount: React.FC<{ symbol: string }> = ({ symbol, children }) => (\r\n  <>\r\n    <Text sx={{ fontWeight: \"medium\" }}>{children}</Text>\r\n    &nbsp;\r\n    <Text sx={{ fontWeight: \"light\", opacity: 0.8 }}>{symbol}</Text>\r\n  </>\r\n);\r\n\r\nconst checkOutput = (value: string): BLusdAmmTokenIndex | \"both\" => {\r\n  if (value === \"both\") {\r\n    return \"both\";\r\n  }\r\n\r\n  const i = parseInt(value);\r\n  if (i === BLusdAmmTokenIndex.BLUSD || i === BLusdAmmTokenIndex.LUSD) {\r\n    return i;\r\n  }\r\n\r\n  throw new Error(`invalid output choice \"${value}\"`);\r\n};\r\n\r\nconst zeros = new Map<BLusdAmmTokenIndex, Decimal>([\r\n  [BLusdAmmTokenIndex.BLUSD, Decimal.ZERO],\r\n  [BLusdAmmTokenIndex.LUSD, Decimal.ZERO]\r\n]);\r\n\r\nexport const WithdrawPane: React.FC = () => {\r\n  const DISABLE_WITHDRAWALS = true;\r\n  const {\r\n    dispatchEvent,\r\n    statuses,\r\n    lpTokenBalance,\r\n    getExpectedWithdrawal,\r\n    isBLusdLpApprovedWithAmmZapper,\r\n    stakedLpTokenBalance,\r\n    addresses\r\n  } = useBondView();\r\n\r\n  const editingState = useState<string>();\r\n  const [burnLpTokens, setBurnLp] = useState<Decimal>(Decimal.ZERO);\r\n  const [output, setOutput] = useState<BLusdAmmTokenIndex | \"both\">(\"both\");\r\n  const [withdrawal, setWithdrawal] = useState<Map<BLusdAmmTokenIndex, Decimal>>(zeros);\r\n\r\n  const isApprovePending = statuses.APPROVE_SPENDER === \"PENDING\";\r\n  const coalescedLpTokenBalance = lpTokenBalance ?? Decimal.ZERO;\r\n  const isManageLiquidityPending = statuses.MANAGE_LIQUIDITY === \"PENDING\";\r\n  const isBalanceInsufficient = burnLpTokens.gt(coalescedLpTokenBalance);\r\n  const needsApproval = output !== BLusdAmmTokenIndex.BLUSD && !isBLusdLpApprovedWithAmmZapper;\r\n\r\n  const handleApprovePressed = () => {\r\n    const tokensNeedingApproval = new Map();\r\n    if (needsApproval) {\r\n      tokensNeedingApproval.set(BLusdAmmTokenIndex.BLUSD_LUSD_LP, addresses.BLUSD_LP_ZAP_ADDRESS);\r\n    }\r\n    dispatchEvent(\"APPROVE_PRESSED\", { tokensNeedingApproval } as ApprovePressedPayload);\r\n  };\r\n\r\n  const handleOutputChange = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n    setOutput(checkOutput(e.target.value));\r\n\r\n  const handleConfirmPressed = () => {\r\n    if (output === \"both\") {\r\n      dispatchEvent(\"CONFIRM_PRESSED\", {\r\n        action: \"removeLiquidity\",\r\n        burnLpTokens,\r\n        minBLusdAmount: Decimal.ZERO, // TODO\r\n        minLusdAmount: Decimal.ZERO // TODO\r\n      });\r\n    } else {\r\n      dispatchEvent(\"CONFIRM_PRESSED\", {\r\n        action: \"removeLiquidityOneCoin\",\r\n        burnLpTokens,\r\n        output,\r\n        minAmount: Decimal.ZERO // TODO\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (burnLpTokens.isZero) {\r\n      setWithdrawal(output === \"both\" ? zeros : new Map([[output, Decimal.ZERO]]));\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n\r\n    const timeoutId = setTimeout(async () => {\r\n      try {\r\n        const expectedWithdrawal = await getExpectedWithdrawal(burnLpTokens, output);\r\n        if (cancelled) return;\r\n        setWithdrawal(expectedWithdrawal);\r\n      } catch (error) {\r\n        console.error(\"getExpectedWithdrawal() failed\");\r\n        console.log(error);\r\n      }\r\n    }, 200);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      cancelled = true;\r\n    };\r\n  }, [burnLpTokens, getExpectedWithdrawal, output]);\r\n\r\n  return (\r\n    <>\r\n      {stakedLpTokenBalance?.nonZero && (\r\n        <Warning>\r\n          You {lpTokenBalance?.nonZero && \" also \"} have {stakedLpTokenBalance.shorten()} staked LP\r\n          tokens. Unstake them to withdraw liquidity from them.\r\n        </Warning>\r\n      )}\r\n      <EditableRow\r\n        label=\"Burn LP Tokens\"\r\n        inputId=\"withdraw-burn-lp\"\r\n        amount={burnLpTokens.prettify(2)}\r\n        editingState={editingState}\r\n        editedAmount={burnLpTokens.toString()}\r\n        setEditedAmount={amount => setBurnLp(Decimal.from(amount))}\r\n        maxAmount={coalescedLpTokenBalance.toString()}\r\n        maxedOut={burnLpTokens.eq(coalescedLpTokenBalance)}\r\n      />\r\n\r\n      <Flex sx={{ justifyContent: \"center\", mb: 3 }}>\r\n        <Icon name=\"arrow-down\" size=\"lg\" />\r\n      </Flex>\r\n\r\n      <Flex sx={{ justifyContent: \"center\", mb: 3 }}>\r\n        {Array.from(tokenSymbol.entries()).map(([key, symbol]) => (\r\n          <Label key={key} variant=\"radioLabel\">\r\n            <Radio\r\n              name=\"withdraw-output-choice\"\r\n              value={key}\r\n              checked={output === key}\r\n              onChange={handleOutputChange}\r\n            />\r\n            {symbol}\r\n          </Label>\r\n        ))}\r\n\r\n        <Label key=\"both\" variant=\"radioLabel\">\r\n          <Radio\r\n            name=\"withdraw-output-choice\"\r\n            value=\"both\"\r\n            checked={output === \"both\"}\r\n            onChange={handleOutputChange}\r\n          />\r\n          Both\r\n        </Label>\r\n      </Flex>\r\n\r\n      <DisabledEditableRow label=\"Withdraw\" inputId=\"withdraw-output-amount\">\r\n        <DisabledEditableAmounts sx={{ justifyContent: \"flex-start\" }}>\r\n          {Array.from(withdrawal.entries()).map(([token, amount], i) => (\r\n            <React.Fragment key={i}>\r\n              {i > 0 && <Text sx={{ fontWeight: \"light\", mx: \"12px\" }}>+</Text>}\r\n              <WithdrawnAmount symbol={tokenSymbol.get(token) ?? \"\"}>\r\n                {amount.prettify(2)}\r\n              </WithdrawnAmount>\r\n            </React.Fragment>\r\n          ))}\r\n        </DisabledEditableAmounts>\r\n      </DisabledEditableRow>\r\n\r\n      <PoolDetails />\r\n\r\n      {isBalanceInsufficient && (\r\n        <ErrorDescription>\r\n          LP Token amount exceeds your balance by{\" \"}\r\n          <Amount>{burnLpTokens.sub(coalescedLpTokenBalance).prettify(2)}</Amount>\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button\r\n          variant=\"cancel\"\r\n          onClick={handleBackPressed}\r\n          disabled={isApprovePending || isManageLiquidityPending}\r\n        >\r\n          Back\r\n        </Button>\r\n\r\n        {needsApproval && (\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={handleApprovePressed}\r\n            disabled={burnLpTokens.isZero || isApprovePending}\r\n          >\r\n            {isApprovePending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Approve</>}\r\n          </Button>\r\n        )}\r\n\r\n        {!needsApproval && (\r\n          <Button variant=\"primary\" onClick={handleConfirmPressed} disabled={DISABLE_WITHDRAWALS}>\r\n            {isManageLiquidityPending ? (\r\n              <Spinner size=\"28px\" sx={{ color: \"white\" }} />\r\n            ) : (\r\n              <>Confirm</>\r\n            )}\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport React, { useState } from \"react\";\r\nimport { Flex, Button, Spinner } from \"theme-ui\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { EditableRow, StaticAmounts, StaticRow } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { ApprovePressedPayload, BLusdAmmTokenIndex } from \"../../context/transitions\";\r\nimport { PoolBalance } from \"./PoolBalance\";\r\n\r\nexport const StakePane: React.FC = () => {\r\n  const {\r\n    dispatchEvent,\r\n    statuses,\r\n    lpTokenBalance,\r\n    isBLusdLpApprovedWithGauge,\r\n    addresses,\r\n    protocolInfo\r\n  } = useBondView();\r\n\r\n  const editingState = useState<string>();\r\n  const [stakeAmount, setStakeAmount] = useState<Decimal>(Decimal.ZERO);\r\n\r\n  const isApprovePending = statuses.APPROVE_SPENDER === \"PENDING\";\r\n  const coalescedLpTokenBalance = lpTokenBalance ?? Decimal.ZERO;\r\n  const isManageLiquidityPending = statuses.MANAGE_LIQUIDITY === \"PENDING\";\r\n  const isBalanceInsufficient = stakeAmount.gt(coalescedLpTokenBalance);\r\n\r\n  const handleApprovePressed = () => {\r\n    const tokensNeedingApproval = new Map();\r\n    if (!isBLusdLpApprovedWithGauge) {\r\n      tokensNeedingApproval.set(\r\n        BLusdAmmTokenIndex.BLUSD_LUSD_LP,\r\n        addresses.BLUSD_AMM_STAKING_ADDRESS\r\n      );\r\n    }\r\n    dispatchEvent(\"APPROVE_PRESSED\", {\r\n      tokensNeedingApproval\r\n    } as ApprovePressedPayload);\r\n  };\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\", {\r\n      action: \"stakeLiquidity\",\r\n      stakeAmount\r\n    });\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <EditableRow\r\n        label=\"Wallet LP Tokens\"\r\n        inputId=\"stake-lp\"\r\n        amount={stakeAmount.prettify(2)}\r\n        editingState={editingState}\r\n        editedAmount={stakeAmount.toString()}\r\n        setEditedAmount={amount => setStakeAmount(Decimal.from(amount))}\r\n        maxAmount={coalescedLpTokenBalance.toString()}\r\n        maxedOut={stakeAmount.eq(coalescedLpTokenBalance)}\r\n      />\r\n\r\n      <Flex mt={3}>\r\n        <StaticRow label=\"bLUSD LP APR\">\r\n          <StaticAmounts sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}>\r\n            <PoolBalance symbol=\"%\">\r\n              {(protocolInfo?.bLusdLpApr ?? Decimal.INFINITY).prettify(2)}\r\n            </PoolBalance>{\" \"}\r\n          </StaticAmounts>\r\n        </StaticRow>\r\n      </Flex>\r\n\r\n      <Flex my={3} sx={{ fontWeight: 300, fontSize: \"16px\" }}>\r\n        Your LP tokens will be staked in the bLUSD Curve gauge to earn protocol fees and Curve\r\n        rewards.\r\n      </Flex>\r\n\r\n      {isBalanceInsufficient && (\r\n        <ErrorDescription>\r\n          LP Token amount exceeds your balance by{\" \"}\r\n          <Amount>{stakeAmount.sub(coalescedLpTokenBalance).prettify(2)}</Amount>\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBackPressed} disabled={isManageLiquidityPending}>\r\n          Back\r\n        </Button>\r\n\r\n        {!isBLusdLpApprovedWithGauge && (\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={handleApprovePressed}\r\n            disabled={stakeAmount.isZero || isApprovePending}\r\n          >\r\n            {isApprovePending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Approve</>}\r\n          </Button>\r\n        )}\r\n\r\n        {isBLusdLpApprovedWithGauge && (\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={handleConfirmPressed}\r\n            disabled={stakeAmount.isZero || isBalanceInsufficient || isManageLiquidityPending}\r\n          >\r\n            {isManageLiquidityPending ? (\r\n              <Spinner size=\"28px\" sx={{ color: \"white\" }} />\r\n            ) : (\r\n              <>Confirm</>\r\n            )}\r\n          </Button>\r\n        )}\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import { Box, Card, Flex } from \"theme-ui\";\r\nimport { InfoIcon } from \"../../../InfoIcon\";\r\nimport { StaticRow } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\n\r\nexport const PendingRewards: React.FC = () => {\r\n  const { lpRewards } = useBondView();\r\n\r\n  return (\r\n    <>\r\n      <Box as=\"summary\" sx={{ cursor: \"pointer\", mt: 1, mb: 2, ml: 3 }}>\r\n        Rewards\r\n      </Box>\r\n\r\n      <Flex>\r\n        {lpRewards?.map(reward => {\r\n          return (\r\n            <StaticRow\r\n              amount={reward.amount.shorten()}\r\n              label={\r\n                <Flex>\r\n                  {reward.name}\r\n                  <InfoIcon\r\n                    placement=\"right\"\r\n                    size=\"xs\"\r\n                    tooltip={<Card variant=\"tooltip\">Reward token address: {reward.address}</Card>}\r\n                  />\r\n                </Flex>\r\n              }\r\n            />\r\n          );\r\n        })}\r\n        {(lpRewards === undefined || lpRewards?.length === 0) && (\r\n          <Flex>You have no pending rewards</Flex>\r\n        )}\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport React, { useState } from \"react\";\r\nimport { Flex, Button, Spinner } from \"theme-ui\";\r\nimport { Amount } from \"../../../ActionDescription\";\r\nimport { ErrorDescription } from \"../../../ErrorDescription\";\r\nimport { EditableRow, StaticAmounts, StaticRow } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { PendingRewards } from \"./PendingRewards\";\r\nimport { PoolBalance } from \"./PoolBalance\";\r\n\r\nexport const UnstakePane: React.FC = () => {\r\n  const { dispatchEvent, statuses, stakedLpTokenBalance, protocolInfo } = useBondView();\r\n\r\n  const editingState = useState<string>();\r\n  const [unstakeAmount, setUnstakeAmount] = useState<Decimal>(Decimal.ZERO);\r\n\r\n  const coalescedStakedLpTokenBalance = stakedLpTokenBalance ?? Decimal.ZERO;\r\n  const isManageLiquidityPending = statuses.MANAGE_LIQUIDITY === \"PENDING\";\r\n  const isBalanceInsufficient = unstakeAmount.gt(coalescedStakedLpTokenBalance);\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\", {\r\n      action: \"unstakeLiquidity\",\r\n      unstakeAmount\r\n    });\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <EditableRow\r\n        label=\"Staked LP Tokens\"\r\n        inputId=\"unstake-lp\"\r\n        amount={unstakeAmount.prettify(2)}\r\n        editingState={editingState}\r\n        editedAmount={unstakeAmount.toString()}\r\n        setEditedAmount={amount => setUnstakeAmount(Decimal.from(amount))}\r\n        maxAmount={coalescedStakedLpTokenBalance.toString()}\r\n        maxedOut={unstakeAmount.eq(coalescedStakedLpTokenBalance)}\r\n      />\r\n\r\n      <PendingRewards />\r\n\r\n      <StaticRow label=\"bLUSD LP APR\">\r\n        <StaticAmounts sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}>\r\n          <PoolBalance symbol=\"%\">\r\n            {(protocolInfo?.bLusdLpApr ?? Decimal.INFINITY).prettify(2)}\r\n          </PoolBalance>{\" \"}\r\n        </StaticAmounts>\r\n      </StaticRow>\r\n\r\n      <Flex mb={3} sx={{ fontWeight: 300, fontSize: \"16px\" }}>\r\n        Your staked LP tokens will be unstaked from the bLUSD Curve gauge and moved into your wallet.\r\n        Pending rewards will also be claimed and moved into your wallet.\r\n      </Flex>\r\n\r\n      {isBalanceInsufficient && (\r\n        <ErrorDescription>\r\n          LP Token amount exceeds your balance by{\" \"}\r\n          <Amount>{unstakeAmount.sub(coalescedStakedLpTokenBalance).prettify(2)}</Amount>\r\n        </ErrorDescription>\r\n      )}\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBackPressed} disabled={isManageLiquidityPending}>\r\n          Back\r\n        </Button>\r\n\r\n        <Button\r\n          variant=\"primary\"\r\n          onClick={handleConfirmPressed}\r\n          disabled={unstakeAmount.isZero || isBalanceInsufficient || isManageLiquidityPending}\r\n        >\r\n          {isManageLiquidityPending ? <Spinner size=\"28px\" sx={{ color: \"white\" }} /> : <>Confirm</>}\r\n        </Button>\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import { Decimal } from \"@liquity/lib-base\";\r\nimport React from \"react\";\r\nimport { Flex, Button, Spinner } from \"theme-ui\";\r\nimport { StaticRow, StaticAmounts } from \"../../../Trove/Editor\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { PendingRewards } from \"./PendingRewards\";\r\nimport { PoolBalance } from \"./PoolBalance\";\r\n\r\nexport const RewardsPane: React.FC = () => {\r\n  const { dispatchEvent, statuses, lpRewards, protocolInfo } = useBondView();\r\n\r\n  const isManageLiquidityPending = statuses.MANAGE_LIQUIDITY === \"PENDING\";\r\n  const hasRewards = lpRewards?.find(reward => reward.amount.gt(0)) !== undefined;\r\n\r\n  const handleConfirmPressed = () => {\r\n    dispatchEvent(\"CONFIRM_PRESSED\", {\r\n      action: \"claimLpRewards\"\r\n    });\r\n  };\r\n\r\n  const handleBackPressed = () => {\r\n    dispatchEvent(\"BACK_PRESSED\");\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <PendingRewards />\r\n\r\n      <StaticRow label=\"bLUSD LP APR\">\r\n        <StaticAmounts sx={{ alignItems: \"center\", justifyContent: \"flex-start\" }}>\r\n          <PoolBalance symbol=\"%\">\r\n            {(protocolInfo?.bLusdLpApr ?? Decimal.INFINITY).prettify(2)}\r\n          </PoolBalance>{\" \"}\r\n        </StaticAmounts>\r\n      </StaticRow>\r\n\r\n      <Flex variant=\"layout.actions\">\r\n        <Button variant=\"cancel\" onClick={handleBackPressed} disabled={isManageLiquidityPending}>\r\n          Back\r\n        </Button>\r\n\r\n        <Button variant=\"primary\" onClick={handleConfirmPressed} disabled={!hasRewards}>\r\n          {isManageLiquidityPending ? (\r\n            <Spinner size=\"28px\" sx={{ color: \"white\" }} />\r\n          ) : (\r\n            <>Claim all rewards</>\r\n          )}\r\n        </Button>\r\n      </Flex>\r\n    </>\r\n  );\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { Close, Flex, Heading, NavLink, NavLinkProps } from \"theme-ui\";\r\nimport { ReactModal } from \"../../../ReactModal\";\r\nimport { useBondView } from \"../../context/BondViewContext\";\r\nimport { DepositPane } from \"./DepositPane\";\r\nimport { WithdrawPane } from \"./WithdrawPane\";\r\nimport { StakePane } from \"./StakePane\";\r\nimport { UnstakePane } from \"./UnstakePane\";\r\nimport { RewardsPane } from \"./RewardsPane\";\r\n\r\ninterface LinkProps extends NavLinkProps {\r\n  active?: boolean;\r\n}\r\n\r\nconst Link: React.FC<LinkProps> = ({ active, children, ...props }) => (\r\n  <NavLink {...props} sx={{ cursor: \"pointer\", ...(active ? { color: \"primary\" } : {}) }}>\r\n    {children}\r\n  </NavLink>\r\n);\r\n\r\nexport const ManagingLiquidity: React.FC = () => {\r\n  const { dispatchEvent } = useBondView();\r\n  const [selectedPane, setSelectedPane] = useState<\r\n    \"deposit\" | \"withdraw\" | \"stake\" | \"unstake\" | \"claim\"\r\n  >(\"deposit\");\r\n\r\n  const handleDismiss = () => {\r\n    dispatchEvent(\"ABORT_PRESSED\");\r\n  };\r\n\r\n  return (\r\n    <ReactModal onDismiss={handleDismiss}>\r\n      <Heading as=\"h2\" sx={{ pt: 2, pb: 3, px: 2 }}>\r\n        <Flex sx={{ justifyContent: \"center\" }}>Manage liquidity</Flex>\r\n        <Close\r\n          onClick={handleDismiss}\r\n          sx={{\r\n            position: \"absolute\",\r\n            right: \"24px\",\r\n            top: \"24px\"\r\n          }}\r\n        />\r\n      </Heading>\r\n\r\n      <Flex as=\"nav\" sx={{ mb: 3 }}>\r\n        <Link active={selectedPane === \"deposit\"} onClick={() => setSelectedPane(\"deposit\")}>\r\n          Deposit\r\n        </Link>\r\n\r\n        <Link active={selectedPane === \"withdraw\"} onClick={() => setSelectedPane(\"withdraw\")}>\r\n          Withdraw\r\n        </Link>\r\n\r\n        <Link active={selectedPane === \"stake\"} onClick={() => setSelectedPane(\"stake\")}>\r\n          Stake\r\n        </Link>\r\n\r\n        <Link active={selectedPane === \"unstake\"} onClick={() => setSelectedPane(\"unstake\")}>\r\n          Unstake\r\n        </Link>\r\n\r\n        <Link active={selectedPane === \"claim\"} onClick={() => setSelectedPane(\"claim\")}>\r\n          Rewards\r\n        </Link>\r\n      </Flex>\r\n\r\n      {selectedPane === \"deposit\" && <DepositPane />}\r\n      {selectedPane === \"withdraw\" && <WithdrawPane />}\r\n      {selectedPane === \"stake\" && <StakePane />}\r\n      {selectedPane === \"unstake\" && <UnstakePane />}\r\n      {selectedPane === \"claim\" && <RewardsPane />}\r\n    </ReactModal>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { useBondView } from \"./context/BondViewContext\";\r\nimport { Idle } from \"./views/idle/Idle\";\r\nimport { Actioning } from \"./views/actioning/Actioning\";\r\nimport { Creating } from \"./views/creating/Creating\";\r\nimport { InfoMessage } from \"../InfoMessage\";\r\nimport { Container } from \"theme-ui\";\r\nimport { Swapping } from \"./views/swapping/Swapping\";\r\nimport { ManagingLiquidity } from \"./views/managing/ManagingLiquidity\";\r\n\r\nexport const Bonds: React.FC = () => {\r\n  const { view, hasFoundContracts } = useBondView();\r\n\r\n  if (!hasFoundContracts) {\r\n    return (\r\n      <Container sx={{ position: \"absolute\", left: \"30%\", top: \"40%\" }}>\r\n        <InfoMessage title=\"Unsupported network\">\r\n          LUSD Bonds don't seem to be deployed to this network.\r\n        </InfoMessage>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  let View = null;\r\n  switch (view) {\r\n    case \"CANCELLING\":\r\n    case \"CLAIMING\": {\r\n      View = <Actioning />;\r\n      break;\r\n    }\r\n    case \"CREATING\": {\r\n      View = <Creating />;\r\n      break;\r\n    }\r\n    case \"SWAPPING\": {\r\n      View = <Swapping />;\r\n      break;\r\n    }\r\n    case \"MANAGING_LIQUIDITY\": {\r\n      View = <ManagingLiquidity />;\r\n      break;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Idle />\r\n      {View}\r\n    </>\r\n  );\r\n};\r\n","import { Container } from \"theme-ui\";\r\nimport { BondStats } from \"../components/BondStats\";\r\nimport { Bonds as BondPanel } from \"../components/Bonds/Bonds\";\r\nimport { useBondView } from \"../components/Bonds/context/BondViewContext\";\r\nimport type {\r\n  BondTransaction,\r\n  TransactionStatus as TransactionStatusType\r\n} from \"../components/Bonds/context/transitions\";\r\nimport { TransactionStatus } from \"../components/TransactionStatus\";\r\nimport type { TransactionStateType } from \"../components/TransactionStatus\";\r\n\r\ntype BondTransactionStatusToTransactionStateMap = Record<\r\n  TransactionStatusType,\r\n  TransactionStateType\r\n>;\r\nconst statusMap: BondTransactionStatusToTransactionStateMap = {\r\n  IDLE: \"idle\",\r\n  PENDING: \"waitingForConfirmation\",\r\n  FAILED: \"failed\",\r\n  CONFIRMED: \"confirmed\"\r\n};\r\n\r\nexport const Bonds: React.FC = () => {\r\n  const { statuses } = useBondView();\r\n  const transaction = (Object.keys(statuses) as BondTransaction[]).find(\r\n    status => statuses[status] !== \"IDLE\"\r\n  );\r\n  const status = transaction ? statusMap[statuses[transaction]] : null;\r\n\r\n  return (\r\n    <>\r\n      <Container variant=\"columns\" sx={{ justifyContent: \"flex-start\" }}>\r\n        <Container variant=\"left\" sx={{ width: [\"100%\", \"70%\"] }}>\r\n          <BondPanel />\r\n        </Container>\r\n\r\n        <Container variant=\"right\" sx={{ width: [\"100%\", \"30%\"] }}>\r\n          <BondStats />\r\n        </Container>\r\n      </Container>\r\n      {status && <TransactionStatus state={status} style={{ zIndex: 9999999999 }} />}\r\n    </>\r\n  );\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState, UserTroveStatus } from \"@liquity/lib-base\";\r\nimport { TroveViewContext } from \"./TroveViewContext\";\r\nimport type { TroveView, TroveEvent } from \"./types\";\r\n\r\ntype TroveEventTransitions = Record<TroveView, Partial<Record<TroveEvent, TroveView>>>;\r\n\r\nconst transitions: TroveEventTransitions = {\r\n  NONE: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  LIQUIDATED: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_SURPLUS_COLLATERAL_CLAIMED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  REDEEMED: {\r\n    OPEN_TROVE_PRESSED: \"OPENING\",\r\n    TROVE_SURPLUS_COLLATERAL_CLAIMED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  OPENING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"NONE\",\r\n    TROVE_OPENED: \"ACTIVE\"\r\n  },\r\n  ADJUSTING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"ACTIVE\",\r\n    TROVE_ADJUSTED: \"ACTIVE\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  },\r\n  CLOSING: {\r\n    CANCEL_ADJUST_TROVE_PRESSED: \"ACTIVE\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_ADJUSTED: \"ACTIVE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  },\r\n  ACTIVE: {\r\n    ADJUST_TROVE_PRESSED: \"ADJUSTING\",\r\n    CLOSE_TROVE_PRESSED: \"CLOSING\",\r\n    TROVE_CLOSED: \"NONE\",\r\n    TROVE_LIQUIDATED: \"LIQUIDATED\",\r\n    TROVE_REDEEMED: \"REDEEMED\"\r\n  }\r\n};\r\n\r\ntype TroveStateEvents = Partial<Record<UserTroveStatus, TroveEvent>>;\r\n\r\nconst troveStatusEvents: TroveStateEvents = {\r\n  open: \"TROVE_OPENED\",\r\n  closedByOwner: \"TROVE_CLOSED\",\r\n  closedByLiquidation: \"TROVE_LIQUIDATED\",\r\n  closedByRedemption: \"TROVE_REDEEMED\"\r\n};\r\n\r\nconst transition = (view: TroveView, event: TroveEvent): TroveView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nconst getInitialView = (troveStatus: UserTroveStatus): TroveView => {\r\n  if (troveStatus === \"closedByLiquidation\") {\r\n    return \"LIQUIDATED\";\r\n  }\r\n  if (troveStatus === \"closedByRedemption\") {\r\n    return \"REDEEMED\";\r\n  }\r\n  if (troveStatus === \"open\") {\r\n    return \"ACTIVE\";\r\n  }\r\n  return \"NONE\";\r\n};\r\n\r\nconst select = ({ trove: { status } }: LiquityStoreState) => status;\r\n\r\nexport const TroveViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const troveStatus = useLiquitySelector(select);\r\n\r\n  const [view, setView] = useState<TroveView>(getInitialView(troveStatus));\r\n  const viewRef = useRef<TroveView>(view);\r\n\r\n  const dispatchEvent = useCallback((event: TroveEvent) => {\r\n    const nextView = transition(viewRef.current, event);\r\n\r\n    console.log(\r\n      \"dispatchEvent() [current-view, event, next-view]\",\r\n      viewRef.current,\r\n      event,\r\n      nextView\r\n    );\r\n    setView(nextView);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    const event = troveStatusEvents[troveStatus] ?? null;\r\n    if (event !== null) {\r\n      dispatchEvent(event);\r\n    }\r\n  }, [troveStatus, dispatchEvent]);\r\n\r\n  const provider = {\r\n    view,\r\n    dispatchEvent\r\n  };\r\n  return <TroveViewContext.Provider value={provider}>{children}</TroveViewContext.Provider>;\r\n};\r\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { useLiquitySelector } from \"@liquity/lib-react\";\r\nimport { LiquityStoreState, StabilityDeposit } from \"@liquity/lib-base\";\r\nimport { StabilityViewContext } from \"./StabilityViewContext\";\r\nimport type { StabilityView, StabilityEvent } from \"./types\";\r\n\r\ntype StabilityEventTransitions = Record<\r\n  StabilityView,\r\n  Partial<Record<StabilityEvent, StabilityView>>\r\n>;\r\n\r\nconst transitions: StabilityEventTransitions = {\r\n  NONE: {\r\n    DEPOSIT_PRESSED: \"DEPOSITING\"\r\n  },\r\n  DEPOSITING: {\r\n    CANCEL_PRESSED: \"NONE\",\r\n    DEPOSIT_CONFIRMED: \"ACTIVE\"\r\n  },\r\n  ACTIVE: {\r\n    REWARDS_CLAIMED: \"ACTIVE\",\r\n    ADJUST_DEPOSIT_PRESSED: \"ADJUSTING\",\r\n    DEPOSIT_EMPTIED: \"NONE\"\r\n  },\r\n  ADJUSTING: {\r\n    CANCEL_PRESSED: \"ACTIVE\",\r\n    DEPOSIT_CONFIRMED: \"ACTIVE\",\r\n    DEPOSIT_EMPTIED: \"NONE\"\r\n  }\r\n};\r\n\r\nconst transition = (view: StabilityView, event: StabilityEvent): StabilityView => {\r\n  const nextView = transitions[view][event] ?? view;\r\n  return nextView;\r\n};\r\n\r\nconst getInitialView = (stabilityDeposit: StabilityDeposit): StabilityView => {\r\n  return stabilityDeposit.isEmpty ? \"NONE\" : \"ACTIVE\";\r\n};\r\n\r\nconst select = ({ stabilityDeposit }: LiquityStoreState): StabilityDeposit => stabilityDeposit;\r\n\r\nexport const StabilityViewProvider: React.FC = props => {\r\n  const { children } = props;\r\n  const stabilityDeposit = useLiquitySelector(select);\r\n\r\n  const [view, setView] = useState<StabilityView>(getInitialView(stabilityDeposit));\r\n  const viewRef = useRef<StabilityView>(view);\r\n\r\n  const dispatchEvent = useCallback((event: StabilityEvent) => {\r\n    const nextView = transition(viewRef.current, event);\r\n\r\n    console.log(\r\n      \"dispatchEvent() [current-view, event, next-view]\",\r\n      viewRef.current,\r\n      event,\r\n      nextView\r\n    );\r\n    setView(nextView);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    viewRef.current = view;\r\n  }, [view]);\r\n\r\n  useEffect(() => {\r\n    if (stabilityDeposit.isEmpty) {\r\n      dispatchEvent(\"DEPOSIT_EMPTIED\");\r\n    }\r\n  }, [stabilityDeposit.isEmpty, dispatchEvent]);\r\n\r\n  const provider = {\r\n    view,\r\n    dispatchEvent\r\n  };\r\n\r\n  return <StabilityViewContext.Provider value={provider}>{children}</StabilityViewContext.Provider>;\r\n};\r\n","import { useEffect } from \"react\";\r\n\r\nimport { LiquityStoreState, LQTYStake } from \"@liquity/lib-base\";\r\nimport { LiquityStoreUpdate, useLiquityReducer } from \"@liquity/lib-react\";\r\n\r\nimport { useMyTransactionState } from \"../../Transaction\";\r\n\r\nimport { StakingViewAction, StakingViewContext } from \"./StakingViewContext\";\r\n\r\ntype StakingViewProviderAction =\r\n  | LiquityStoreUpdate\r\n  | StakingViewAction\r\n  | { type: \"startChange\" | \"abortChange\" };\r\n\r\ntype StakingViewProviderState = {\r\n  lqtyStake: LQTYStake;\r\n  changePending: boolean;\r\n  adjusting: boolean;\r\n};\r\n\r\nconst init = ({ lqtyStake }: LiquityStoreState): StakingViewProviderState => ({\r\n  lqtyStake,\r\n  changePending: false,\r\n  adjusting: false\r\n});\r\n\r\nconst reduce = (\r\n  state: StakingViewProviderState,\r\n  action: StakingViewProviderAction\r\n): StakingViewProviderState => {\r\n  // console.log(state);\r\n  // console.log(action);\r\n\r\n  switch (action.type) {\r\n    case \"startAdjusting\":\r\n      return { ...state, adjusting: true };\r\n\r\n    case \"cancelAdjusting\":\r\n      return { ...state, adjusting: false };\r\n\r\n    case \"startChange\":\r\n      return { ...state, changePending: true };\r\n\r\n    case \"abortChange\":\r\n      return { ...state, changePending: false };\r\n\r\n    case \"updateStore\": {\r\n      const {\r\n        oldState: { lqtyStake: oldStake },\r\n        stateChange: { lqtyStake: updatedStake }\r\n      } = action;\r\n\r\n      if (updatedStake) {\r\n        const changeCommitted =\r\n          !updatedStake.stakedLQTY.eq(oldStake.stakedLQTY) ||\r\n          updatedStake.collateralGain.lt(oldStake.collateralGain) ||\r\n          updatedStake.lusdGain.lt(oldStake.lusdGain);\r\n\r\n        return {\r\n          ...state,\r\n          lqtyStake: updatedStake,\r\n          adjusting: false,\r\n          changePending: changeCommitted ? false : state.changePending\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const StakingViewProvider: React.FC = ({ children }) => {\r\n  const stakingTransactionState = useMyTransactionState(\"stake\");\r\n  const [{ adjusting, changePending, lqtyStake }, dispatch] = useLiquityReducer(reduce, init);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      stakingTransactionState.type === \"waitingForApproval\" ||\r\n      stakingTransactionState.type === \"waitingForConfirmation\"\r\n    ) {\r\n      dispatch({ type: \"startChange\" });\r\n    } else if (\r\n      stakingTransactionState.type === \"failed\" ||\r\n      stakingTransactionState.type === \"cancelled\"\r\n    ) {\r\n      dispatch({ type: \"abortChange\" });\r\n    }\r\n  }, [stakingTransactionState.type, dispatch]);\r\n\r\n  return (\r\n    <StakingViewContext.Provider\r\n      value={{\r\n        view: adjusting ? \"ADJUSTING\" : lqtyStake.isEmpty ? \"NONE\" : \"ACTIVE\",\r\n        changePending,\r\n        dispatch\r\n      }}\r\n    >\r\n      {children}\r\n    </StakingViewContext.Provider>\r\n  );\r\n};\r\n","import { BondAddressesProvider } from \"./BondAddressesContext\";\r\nimport { BondViewProvider } from \"./BondViewProvider\";\r\n\r\nexport const BondsProvider: React.FC = ({ children }) => {\r\n  return (\r\n    <BondAddressesProvider>\r\n      <BondViewProvider>{children}</BondViewProvider>\r\n    </BondAddressesProvider>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Flex, Container } from \"theme-ui\";\r\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport { Wallet } from \"@ethersproject/wallet\";\r\n\r\nimport { Decimal, Difference, Trove } from \"@liquity/lib-base\";\r\nimport { LiquityStoreProvider } from \"@liquity/lib-react\";\r\n\r\nimport { useLiquity } from \"./hooks/LiquityContext\";\r\nimport { TransactionMonitor } from \"./components/Transaction\";\r\nimport { UserAccount } from \"./components/UserAccount\";\r\nimport { SystemStatsPopup } from \"./components/SystemStatsPopup\";\r\nimport { Header } from \"./components/Header\";\r\n\r\nimport { PageSwitcher } from \"./pages/PageSwitcher\";\r\nimport { RiskyTrovesPage } from \"./pages/RiskyTrovesPage\";\r\nimport { Bonds } from \"./pages/Bonds\";\r\n\r\nimport { TroveViewProvider } from \"./components/Trove/context/TroveViewProvider\";\r\nimport { StabilityViewProvider } from \"./components/Stability/context/StabilityViewProvider\";\r\nimport { StakingViewProvider } from \"./components/Staking/context/StakingViewProvider\";\r\nimport \"tippy.js/dist/tippy.css\"; // Tooltip default style\r\nimport { BondsProvider } from \"./components/Bonds/context/BondsProvider\";\r\n\r\ntype LiquityFrontendProps = {\r\n  loader?: React.ReactNode;\r\n};\r\nexport const LiquityFrontend: React.FC<LiquityFrontendProps> = ({ loader }) => {\r\n  const { account, provider, liquity } = useLiquity();\r\n\r\n  // For console tinkering ;-)\r\n  Object.assign(window, {\r\n    account,\r\n    provider,\r\n    liquity,\r\n    Trove,\r\n    Decimal,\r\n    Difference,\r\n    Wallet\r\n  });\r\n\r\n  return (\r\n    <LiquityStoreProvider {...{ loader }} store={liquity.store}>\r\n      <Router>\r\n        <TroveViewProvider>\r\n          <StabilityViewProvider>\r\n            <StakingViewProvider>\r\n              <BondsProvider>\r\n                <Flex sx={{ flexDirection: \"column\", minHeight: \"100%\" }}>\r\n                  <Header>\r\n                    <UserAccount />\r\n                    <SystemStatsPopup />\r\n                  </Header>\r\n\r\n                  <Container\r\n                    variant=\"main\"\r\n                    sx={{\r\n                      display: \"flex\",\r\n                      flexGrow: 1,\r\n                      flexDirection: \"column\",\r\n                      alignItems: \"center\"\r\n                    }}\r\n                  >\r\n                    <Switch>\r\n                      <Route path=\"/\" exact>\r\n                        <PageSwitcher />\r\n                      </Route>\r\n                      <Route path=\"/bonds\">\r\n                        <Bonds />\r\n                      </Route>\r\n                      <Route path=\"/risky-troves\">\r\n                        <RiskyTrovesPage />\r\n                      </Route>\r\n                    </Switch>\r\n                  </Container>\r\n                </Flex>\r\n              </BondsProvider>\r\n            </StakingViewProvider>\r\n          </StabilityViewProvider>\r\n        </TroveViewProvider>\r\n      </Router>\r\n      <TransactionMonitor />\r\n    </LiquityStoreProvider>\r\n  );\r\n};\r\n","import { Flex, Spinner, Heading } from \"theme-ui\";\r\n\r\nexport const AppLoader = () => (\r\n  <Flex sx={{ alignItems: \"center\", justifyContent: \"center\", height: \"100vh\" }}>\r\n    <Spinner sx={{ m: 2, color: \"text\" }} size=\"32px\" />\r\n    <Heading>Loading...</Heading>\r\n  </Flex>\r\n);\r\n","import React from \"react\";\r\nimport { Web3ReactProvider } from \"@web3-react/core\";\r\nimport { Flex, Heading, ThemeProvider, Paragraph, Link } from \"theme-ui\";\r\n\r\nimport { BatchedWebSocketAugmentedWeb3Provider } from \"@liquity/providers\";\r\nimport { LiquityProvider } from \"./hooks/LiquityContext\";\r\nimport { WalletConnector } from \"./components/WalletConnector\";\r\nimport { TransactionProvider } from \"./components/Transaction\";\r\nimport { Icon } from \"./components/Icon\";\r\nimport { getConfig } from \"./config\";\r\nimport theme from \"./theme\";\r\n\r\nimport { DisposableWalletProvider } from \"./testUtils/DisposableWalletProvider\";\r\nimport { LiquityFrontend } from \"./LiquityFrontend\";\r\nimport { AppLoader } from \"./components/AppLoader\";\r\n\r\nif (window.ethereum) {\r\n  // Silence MetaMask warning in console\r\n  Object.assign(window.ethereum, { autoRefreshOnNetworkChange: false });\r\n}\r\n\r\nif (process.env.REACT_APP_DEMO_MODE === \"true\") {\r\n  const ethereum = new DisposableWalletProvider(\r\n    process.env.REACT_APP_RPC_URL || `http://${window.location.hostname}:8545`,\r\n    \"0x4d5db4107d237df6a3d58ee5f70ae63d73d7658d4026f2eefd2f204c81682cb7\"\r\n  );\r\n\r\n  Object.assign(window, { ethereum });\r\n}\r\n\r\n// Start pre-fetching the config\r\ngetConfig().then(config => {\r\n  // console.log(\"Frontend config:\");\r\n  // console.log(config);\r\n  Object.assign(window, { config });\r\n});\r\n\r\nconst EthersWeb3ReactProvider: React.FC = ({ children }) => {\r\n  return (\r\n    <Web3ReactProvider getLibrary={provider => new BatchedWebSocketAugmentedWeb3Provider(provider)}>\r\n      {children}\r\n    </Web3ReactProvider>\r\n  );\r\n};\r\n\r\nconst UnsupportedMainnetFallback: React.FC = () => (\r\n  <Flex\r\n    sx={{\r\n      flexDirection: \"column\",\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      height: \"100vh\",\r\n      textAlign: \"center\"\r\n    }}\r\n  >\r\n    <Heading sx={{ mb: 3 }}>\r\n      <Icon name=\"exclamation-triangle\" /> This app is for testing purposes only.\r\n    </Heading>\r\n\r\n    <Paragraph sx={{ mb: 3 }}>\r\n      Please change your network to Ropsten, Rinkeby, Kovan, Görli or Kiln.\r\n    </Paragraph>\r\n\r\n    <Paragraph>\r\n      If you'd like to use the Liquity Protocol on mainnet, please pick a frontend{\" \"}\r\n      <Link href=\"https://www.liquity.org/frontend\">\r\n        here <Icon name=\"external-link-alt\" size=\"xs\" />\r\n      </Link>\r\n      .\r\n    </Paragraph>\r\n  </Flex>\r\n);\r\n\r\nconst App = () => {\r\n  const unsupportedNetworkFallback = (chainId: number) => (\r\n    <Flex\r\n      sx={{\r\n        flexDirection: \"column\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        height: \"100vh\",\r\n        textAlign: \"center\"\r\n      }}\r\n    >\r\n      <Heading sx={{ mb: 3 }}>\r\n        <Icon name=\"exclamation-triangle\" /> Liquity is not yet deployed to{\" \"}\r\n        {chainId === 1 ? \"mainnet\" : \"this network\"}.\r\n      </Heading>\r\n      Please switch to Ropsten, Rinkeby, Kovan, Görli or Kiln.\r\n    </Flex>\r\n  );\r\n\r\n  return (\r\n    <EthersWeb3ReactProvider>\r\n      <ThemeProvider theme={theme}>\r\n        <WalletConnector loader={<AppLoader />}>\r\n          <LiquityProvider\r\n            loader={<AppLoader />}\r\n            unsupportedNetworkFallback={unsupportedNetworkFallback}\r\n            unsupportedMainnetFallback={<UnsupportedMainnetFallback />}\r\n          >\r\n            <TransactionProvider>\r\n              <LiquityFrontend loader={<AppLoader />} />\r\n            </TransactionProvider>\r\n          </LiquityProvider>\r\n        </WalletConnector>\r\n      </ThemeProvider>\r\n    </EthersWeb3ReactProvider>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Modal from \"react-modal\";\r\n\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nModal.setAppElement(\"#root\");\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}